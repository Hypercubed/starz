const sa={DEV:!0,PROD:!1},ee=750,qt=750,aa="Orthographic",la=500,ua=2,ca=25,fa=1,ha=1,So=40,da=!0,ga=384,Eo=1,bo=8,T0=Eo+bo,pa=.1,Io=sa||{},ie=Io.DEV??!0,ma=Io.PROD??!1,N0=ma,ya=ie,va=ie;function Ao(t,n){let e,i;for(const r of t)r!=null&&(e===void 0?r>=r&&(e=i=r):(e>r&&(e=r),i<r&&(i=r)));return[e,i]}class vt{constructor(){this._partials=new Float64Array(32),this._n=0}add(n){const e=this._partials;let i=0;for(let r=0;r<this._n&&r<32;r++){const o=e[r],s=n+o,a=Math.abs(n)<Math.abs(o)?n-(s-o):o-(s-n);a&&(e[i++]=a),n=s}return e[i]=n,this._n=i+1,this}valueOf(){const n=this._partials;let e=this._n,i,r,o,s=0;if(e>0){for(s=n[--e];e>0&&(i=s,r=n[--e],s=i+r,o=r-(s-i),!o););e>0&&(o<0&&n[e-1]<0||o>0&&n[e-1]>0)&&(r=o*2,i=s+r,r==i-s&&(s=i))}return s}}function lr(t,n){let e=0,i=0;if(n===void 0)for(let r of t)r!=null&&(r=+r)>=r&&(++e,i+=r);else{let r=-1;for(let o of t)(o=n(o,++r,t))!=null&&(o=+o)>=o&&(++e,i+=o)}if(e)return i/e}function*_a(t){for(const n of t)yield*n}function $o(t){return Array.from(_a(t))}function Qt(t,n,e){t=+t,n=+n,e=(r=arguments.length)<2?(n=t,t=0,1):r<3?1:+e;for(var i=-1,r=Math.max(0,Math.ceil((n-t)/e))|0,o=new Array(r);++i<r;)o[i]=t+i*e;return o}var wa={value:()=>{}};function Ce(){for(var t=0,n=arguments.length,e={},i;t<n;++t){if(!(i=arguments[t]+"")||i in e||/[\s.]/.test(i))throw new Error("illegal type: "+i);e[i]=[]}return new Kn(e)}function Kn(t){this._=t}function Ma(t,n){return t.trim().split(/^|\s+/).map(function(e){var i="",r=e.indexOf(".");if(r>=0&&(i=e.slice(r+1),e=e.slice(0,r)),e&&!n.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:i}})}Kn.prototype=Ce.prototype={constructor:Kn,on:function(t,n){var e=this._,i=Ma(t+"",e),r,o=-1,s=i.length;if(arguments.length<2){for(;++o<s;)if((r=(t=i[o]).type)&&(r=xa(e[r],t.name)))return r;return}if(n!=null&&typeof n!="function")throw new Error("invalid callback: "+n);for(;++o<s;)if(r=(t=i[o]).type)e[r]=ur(e[r],t.name,n);else if(n==null)for(r in e)e[r]=ur(e[r],t.name,null);return this},copy:function(){var t={},n=this._;for(var e in n)t[e]=n[e].slice();return new Kn(t)},call:function(t,n){if((r=arguments.length-2)>0)for(var e=new Array(r),i=0,r,o;i<r;++i)e[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=this._[t],i=0,r=o.length;i<r;++i)o[i].value.apply(n,e)},apply:function(t,n,e){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,o=i.length;r<o;++r)i[r].value.apply(n,e)}};function xa(t,n){for(var e=0,i=t.length,r;e<i;++e)if((r=t[e]).name===n)return r.value}function ur(t,n,e){for(var i=0,r=t.length;i<r;++i)if(t[i].name===n){t[i]=wa,t=t.slice(0,i).concat(t.slice(i+1));break}return e!=null&&t.push({name:n,value:e}),t}var ei="http://www.w3.org/1999/xhtml";const cr={svg:"http://www.w3.org/2000/svg",xhtml:ei,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Re(t){var n=t+="",e=n.indexOf(":");return e>=0&&(n=t.slice(0,e))!=="xmlns"&&(t=t.slice(e+1)),cr.hasOwnProperty(n)?{space:cr[n],local:t}:t}function Sa(t){return function(){var n=this.ownerDocument,e=this.namespaceURI;return e===ei&&n.documentElement.namespaceURI===ei?n.createElement(t):n.createElementNS(e,t)}}function Ea(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function To(t){var n=Re(t);return(n.local?Ea:Sa)(n)}function ba(){}function Bi(t){return t==null?ba:function(){return this.querySelector(t)}}function Ia(t){typeof t!="function"&&(t=Bi(t));for(var n=this._groups,e=n.length,i=new Array(e),r=0;r<e;++r)for(var o=n[r],s=o.length,a=i[r]=new Array(s),l,u,f=0;f<s;++f)(l=o[f])&&(u=t.call(l,l.__data__,f,o))&&("__data__"in l&&(u.__data__=l.__data__),a[f]=u);return new lt(i,this._parents)}function Aa(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function $a(){return[]}function No(t){return t==null?$a:function(){return this.querySelectorAll(t)}}function Ta(t){return function(){return Aa(t.apply(this,arguments))}}function Na(t){typeof t=="function"?t=Ta(t):t=No(t);for(var n=this._groups,e=n.length,i=[],r=[],o=0;o<e;++o)for(var s=n[o],a=s.length,l,u=0;u<a;++u)(l=s[u])&&(i.push(t.call(l,l.__data__,u,s)),r.push(l));return new lt(i,r)}function Po(t){return function(){return this.matches(t)}}function ko(t){return function(n){return n.matches(t)}}var Pa=Array.prototype.find;function ka(t){return function(){return Pa.call(this.children,t)}}function Ca(){return this.firstElementChild}function Ra(t){return this.select(t==null?Ca:ka(typeof t=="function"?t:ko(t)))}var La=Array.prototype.filter;function Da(){return Array.from(this.children)}function za(t){return function(){return La.call(this.children,t)}}function Oa(t){return this.selectAll(t==null?Da:za(typeof t=="function"?t:ko(t)))}function Fa(t){typeof t!="function"&&(t=Po(t));for(var n=this._groups,e=n.length,i=new Array(e),r=0;r<e;++r)for(var o=n[r],s=o.length,a=i[r]=[],l,u=0;u<s;++u)(l=o[u])&&t.call(l,l.__data__,u,o)&&a.push(l);return new lt(i,this._parents)}function Co(t){return new Array(t.length)}function qa(){return new lt(this._enter||this._groups.map(Co),this._parents)}function re(t,n){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=n}re.prototype={constructor:re,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,n){return this._parent.insertBefore(t,n)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Ga(t){return function(){return t}}function Ba(t,n,e,i,r,o){for(var s=0,a,l=n.length,u=o.length;s<u;++s)(a=n[s])?(a.__data__=o[s],i[s]=a):e[s]=new re(t,o[s]);for(;s<l;++s)(a=n[s])&&(r[s]=a)}function Ya(t,n,e,i,r,o,s){var a,l,u=new Map,f=n.length,c=o.length,h=new Array(f),d;for(a=0;a<f;++a)(l=n[a])&&(h[a]=d=s.call(l,l.__data__,a,n)+"",u.has(d)?r[a]=l:u.set(d,l));for(a=0;a<c;++a)d=s.call(t,o[a],a,o)+"",(l=u.get(d))?(i[a]=l,l.__data__=o[a],u.delete(d)):e[a]=new re(t,o[a]);for(a=0;a<f;++a)(l=n[a])&&u.get(h[a])===l&&(r[a]=l)}function Ha(t){return t.__data__}function Xa(t,n){if(!arguments.length)return Array.from(this,Ha);var e=n?Ya:Ba,i=this._parents,r=this._groups;typeof t!="function"&&(t=Ga(t));for(var o=r.length,s=new Array(o),a=new Array(o),l=new Array(o),u=0;u<o;++u){var f=i[u],c=r[u],h=c.length,d=Ua(t.call(f,f&&f.__data__,u,i)),g=d.length,p=a[u]=new Array(g),M=s[u]=new Array(g),m=l[u]=new Array(h);e(f,c,p,M,m,d,n);for(var E=0,x=0,w,b;E<g;++E)if(w=p[E]){for(E>=x&&(x=E+1);!(b=M[x])&&++x<g;);w._next=b||null}}return s=new lt(s,i),s._enter=a,s._exit=l,s}function Ua(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Va(){return new lt(this._exit||this._groups.map(Co),this._parents)}function Ka(t,n,e){var i=this.enter(),r=this,o=this.exit();return typeof t=="function"?(i=t(i),i&&(i=i.selection())):i=i.append(t+""),n!=null&&(r=n(r),r&&(r=r.selection())),e==null?o.remove():e(o),i&&r?i.merge(r).order():r}function ja(t){for(var n=t.selection?t.selection():t,e=this._groups,i=n._groups,r=e.length,o=i.length,s=Math.min(r,o),a=new Array(r),l=0;l<s;++l)for(var u=e[l],f=i[l],c=u.length,h=a[l]=new Array(c),d,g=0;g<c;++g)(d=u[g]||f[g])&&(h[g]=d);for(;l<r;++l)a[l]=e[l];return new lt(a,this._parents)}function Wa(){for(var t=this._groups,n=-1,e=t.length;++n<e;)for(var i=t[n],r=i.length-1,o=i[r],s;--r>=0;)(s=i[r])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function Qa(t){t||(t=Za);function n(c,h){return c&&h?t(c.__data__,h.__data__):!c-!h}for(var e=this._groups,i=e.length,r=new Array(i),o=0;o<i;++o){for(var s=e[o],a=s.length,l=r[o]=new Array(a),u,f=0;f<a;++f)(u=s[f])&&(l[f]=u);l.sort(n)}return new lt(r,this._parents).order()}function Za(t,n){return t<n?-1:t>n?1:t>=n?0:NaN}function Ja(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function tl(){return Array.from(this)}function nl(){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var i=t[n],r=0,o=i.length;r<o;++r){var s=i[r];if(s)return s}return null}function el(){let t=0;for(const n of this)++t;return t}function il(){return!this.node()}function rl(t){for(var n=this._groups,e=0,i=n.length;e<i;++e)for(var r=n[e],o=0,s=r.length,a;o<s;++o)(a=r[o])&&t.call(a,a.__data__,o,r);return this}function ol(t){return function(){this.removeAttribute(t)}}function sl(t){return function(){this.removeAttributeNS(t.space,t.local)}}function al(t,n){return function(){this.setAttribute(t,n)}}function ll(t,n){return function(){this.setAttributeNS(t.space,t.local,n)}}function ul(t,n){return function(){var e=n.apply(this,arguments);e==null?this.removeAttribute(t):this.setAttribute(t,e)}}function cl(t,n){return function(){var e=n.apply(this,arguments);e==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,e)}}function fl(t,n){var e=Re(t);if(arguments.length<2){var i=this.node();return e.local?i.getAttributeNS(e.space,e.local):i.getAttribute(e)}return this.each((n==null?e.local?sl:ol:typeof n=="function"?e.local?cl:ul:e.local?ll:al)(e,n))}function Ro(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function hl(t){return function(){this.style.removeProperty(t)}}function dl(t,n,e){return function(){this.style.setProperty(t,n,e)}}function gl(t,n,e){return function(){var i=n.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,e)}}function pl(t,n,e){return arguments.length>1?this.each((n==null?hl:typeof n=="function"?gl:dl)(t,n,e??"")):en(this.node(),t)}function en(t,n){return t.style.getPropertyValue(n)||Ro(t).getComputedStyle(t,null).getPropertyValue(n)}function ml(t){return function(){delete this[t]}}function yl(t,n){return function(){this[t]=n}}function vl(t,n){return function(){var e=n.apply(this,arguments);e==null?delete this[t]:this[t]=e}}function _l(t,n){return arguments.length>1?this.each((n==null?ml:typeof n=="function"?vl:yl)(t,n)):this.node()[t]}function Lo(t){return t.trim().split(/^|\s+/)}function Yi(t){return t.classList||new Do(t)}function Do(t){this._node=t,this._names=Lo(t.getAttribute("class")||"")}Do.prototype={add:function(t){var n=this._names.indexOf(t);n<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var n=this._names.indexOf(t);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function zo(t,n){for(var e=Yi(t),i=-1,r=n.length;++i<r;)e.add(n[i])}function Oo(t,n){for(var e=Yi(t),i=-1,r=n.length;++i<r;)e.remove(n[i])}function wl(t){return function(){zo(this,t)}}function Ml(t){return function(){Oo(this,t)}}function xl(t,n){return function(){(n.apply(this,arguments)?zo:Oo)(this,t)}}function Sl(t,n){var e=Lo(t+"");if(arguments.length<2){for(var i=Yi(this.node()),r=-1,o=e.length;++r<o;)if(!i.contains(e[r]))return!1;return!0}return this.each((typeof n=="function"?xl:n?wl:Ml)(e,n))}function El(){this.textContent=""}function bl(t){return function(){this.textContent=t}}function Il(t){return function(){var n=t.apply(this,arguments);this.textContent=n??""}}function Al(t){return arguments.length?this.each(t==null?El:(typeof t=="function"?Il:bl)(t)):this.node().textContent}function $l(){this.innerHTML=""}function Tl(t){return function(){this.innerHTML=t}}function Nl(t){return function(){var n=t.apply(this,arguments);this.innerHTML=n??""}}function Pl(t){return arguments.length?this.each(t==null?$l:(typeof t=="function"?Nl:Tl)(t)):this.node().innerHTML}function kl(){this.nextSibling&&this.parentNode.appendChild(this)}function Cl(){return this.each(kl)}function Rl(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Ll(){return this.each(Rl)}function Dl(t){var n=typeof t=="function"?t:To(t);return this.select(function(){return this.appendChild(n.apply(this,arguments))})}function zl(){return null}function Ol(t,n){var e=typeof t=="function"?t:To(t),i=n==null?zl:typeof n=="function"?n:Bi(n);return this.select(function(){return this.insertBefore(e.apply(this,arguments),i.apply(this,arguments)||null)})}function Fl(){var t=this.parentNode;t&&t.removeChild(this)}function ql(){return this.each(Fl)}function Gl(){var t=this.cloneNode(!1),n=this.parentNode;return n?n.insertBefore(t,this.nextSibling):t}function Bl(){var t=this.cloneNode(!0),n=this.parentNode;return n?n.insertBefore(t,this.nextSibling):t}function Yl(t){return this.select(t?Bl:Gl)}function Hl(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Xl(t){return function(n){t.call(this,n,this.__data__)}}function Ul(t){return t.trim().split(/^|\s+/).map(function(n){var e="",i=n.indexOf(".");return i>=0&&(e=n.slice(i+1),n=n.slice(0,i)),{type:n,name:e}})}function Vl(t){return function(){var n=this.__on;if(n){for(var e=0,i=-1,r=n.length,o;e<r;++e)o=n[e],(!t.type||o.type===t.type)&&o.name===t.name?this.removeEventListener(o.type,o.listener,o.options):n[++i]=o;++i?n.length=i:delete this.__on}}}function Kl(t,n,e){return function(){var i=this.__on,r,o=Xl(n);if(i){for(var s=0,a=i.length;s<a;++s)if((r=i[s]).type===t.type&&r.name===t.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=e),r.value=n;return}}this.addEventListener(t.type,o,e),r={type:t.type,name:t.name,value:n,listener:o,options:e},i?i.push(r):this.__on=[r]}}function jl(t,n,e){var i=Ul(t+""),r,o=i.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,u=a.length,f;l<u;++l)for(r=0,f=a[l];r<o;++r)if((s=i[r]).type===f.type&&s.name===f.name)return f.value}return}for(a=n?Kl:Vl,r=0;r<o;++r)this.each(a(i[r],n,e));return this}function Fo(t,n,e){var i=Ro(t),r=i.CustomEvent;typeof r=="function"?r=new r(n,e):(r=i.document.createEvent("Event"),e?(r.initEvent(n,e.bubbles,e.cancelable),r.detail=e.detail):r.initEvent(n,!1,!1)),t.dispatchEvent(r)}function Wl(t,n){return function(){return Fo(this,t,n)}}function Ql(t,n){return function(){return Fo(this,t,n.apply(this,arguments))}}function Zl(t,n){return this.each((typeof n=="function"?Ql:Wl)(t,n))}function*Jl(){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var i=t[n],r=0,o=i.length,s;r<o;++r)(s=i[r])&&(yield s)}var qo=[null];function lt(t,n){this._groups=t,this._parents=n}function Nn(){return new lt([[document.documentElement]],qo)}function tu(){return this}lt.prototype=Nn.prototype={constructor:lt,select:Ia,selectAll:Na,selectChild:Ra,selectChildren:Oa,filter:Fa,data:Xa,enter:qa,exit:Va,join:Ka,merge:ja,selection:tu,order:Wa,sort:Qa,call:Ja,nodes:tl,node:nl,size:el,empty:il,each:rl,attr:fl,style:pl,property:_l,classed:Sl,text:Al,html:Pl,raise:Cl,lower:Ll,append:Dl,insert:Ol,remove:ql,clone:Yl,datum:Hl,on:jl,dispatch:Zl,[Symbol.iterator]:Jl};function pt(t){return typeof t=="string"?new lt([[document.querySelector(t)]],[document.documentElement]):new lt([[t]],qo)}function Go(t){let n;for(;n=t.sourceEvent;)t=n;return t}function Mt(t,n){if(t=Go(t),n===void 0&&(n=t.currentTarget),n){var e=n.ownerSVGElement||n;if(e.createSVGPoint){var i=e.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i=i.matrixTransform(n.getScreenCTM().inverse()),[i.x,i.y]}if(n.getBoundingClientRect){var r=n.getBoundingClientRect();return[t.clientX-r.left-n.clientLeft,t.clientY-r.top-n.clientTop]}}return[t.pageX,t.pageY]}function nu(t,n){return t.target&&(t=Go(t),n===void 0&&(n=t.currentTarget),t=t.touches||[t]),Array.from(t,e=>Mt(e,n))}const eu={passive:!1},Sn={capture:!0,passive:!1};function He(t){t.stopImmediatePropagation()}function tn(t){t.preventDefault(),t.stopImmediatePropagation()}function Bo(t){var n=t.document.documentElement,e=pt(t).on("dragstart.drag",tn,Sn);"onselectstart"in n?e.on("selectstart.drag",tn,Sn):(n.__noselect=n.style.MozUserSelect,n.style.MozUserSelect="none")}function Yo(t,n){var e=t.document.documentElement,i=pt(t).on("dragstart.drag",null);n&&(i.on("click.drag",tn,Sn),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in e?i.on("selectstart.drag",null):(e.style.MozUserSelect=e.__noselect,delete e.__noselect)}const Rn=t=>()=>t;function ii(t,{sourceEvent:n,subject:e,target:i,identifier:r,active:o,x:s,y:a,dx:l,dy:u,dispatch:f}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},subject:{value:e,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:f}})}ii.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function iu(t){return!t.ctrlKey&&!t.button}function ru(){return this.parentNode}function ou(t,n){return n??{x:t.x,y:t.y}}function su(){return navigator.maxTouchPoints||"ontouchstart"in this}function au(){var t=iu,n=ru,e=ou,i=su,r={},o=Ce("start","drag","end"),s=0,a,l,u,f,c=0;function h(w){w.on("mousedown.drag",d).filter(i).on("touchstart.drag",M).on("touchmove.drag",m,eu).on("touchend.drag touchcancel.drag",E).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function d(w,b){if(!(f||!t.call(this,w,b))){var $=x(this,n.call(this,w,b),w,b,"mouse");$&&(pt(w.view).on("mousemove.drag",g,Sn).on("mouseup.drag",p,Sn),Bo(w.view),He(w),u=!1,a=w.clientX,l=w.clientY,$("start",w))}}function g(w){if(tn(w),!u){var b=w.clientX-a,$=w.clientY-l;u=b*b+$*$>c}r.mouse("drag",w)}function p(w){pt(w.view).on("mousemove.drag mouseup.drag",null),Yo(w.view,u),tn(w),r.mouse("end",w)}function M(w,b){if(t.call(this,w,b)){var $=w.changedTouches,T=n.call(this,w,b),N=$.length,I,P;for(I=0;I<N;++I)(P=x(this,T,w,b,$[I].identifier,$[I]))&&(He(w),P("start",w,$[I]))}}function m(w){var b=w.changedTouches,$=b.length,T,N;for(T=0;T<$;++T)(N=r[b[T].identifier])&&(tn(w),N("drag",w,b[T]))}function E(w){var b=w.changedTouches,$=b.length,T,N;for(f&&clearTimeout(f),f=setTimeout(function(){f=null},500),T=0;T<$;++T)(N=r[b[T].identifier])&&(He(w),N("end",w,b[T]))}function x(w,b,$,T,N,I){var P=o.copy(),S=Mt(I||$,b),L,R,y;if((y=e.call(w,new ii("beforestart",{sourceEvent:$,target:h,identifier:N,active:s,x:S[0],y:S[1],dx:0,dy:0,dispatch:P}),T))!=null)return L=y.x-S[0]||0,R=y.y-S[1]||0,function v(_,A,C){var k=S,D;switch(_){case"start":r[N]=v,D=s++;break;case"end":delete r[N],--s;case"drag":S=Mt(C||A,b),D=s;break}P.call(_,w,new ii(_,{sourceEvent:A,subject:y,target:h,identifier:N,active:D,x:S[0]+L,y:S[1]+R,dx:S[0]-k[0],dy:S[1]-k[1],dispatch:P}),T)}}return h.filter=function(w){return arguments.length?(t=typeof w=="function"?w:Rn(!!w),h):t},h.container=function(w){return arguments.length?(n=typeof w=="function"?w:Rn(w),h):n},h.subject=function(w){return arguments.length?(e=typeof w=="function"?w:Rn(w),h):e},h.touchable=function(w){return arguments.length?(i=typeof w=="function"?w:Rn(!!w),h):i},h.on=function(){var w=o.on.apply(o,arguments);return w===o?h:w},h.clickDistance=function(w){return arguments.length?(c=(w=+w)*w,h):Math.sqrt(c)},h}function Hi(t,n,e){t.prototype=n.prototype=e,e.constructor=t}function Ho(t,n){var e=Object.create(t.prototype);for(var i in n)e[i]=n[i];return e}function Pn(){}var En=.7,oe=1/En,nn="\\s*([+-]?\\d+)\\s*",bn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Et="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",lu=/^#([0-9a-f]{3,8})$/,uu=new RegExp(`^rgb\\(${nn},${nn},${nn}\\)$`),cu=new RegExp(`^rgb\\(${Et},${Et},${Et}\\)$`),fu=new RegExp(`^rgba\\(${nn},${nn},${nn},${bn}\\)$`),hu=new RegExp(`^rgba\\(${Et},${Et},${Et},${bn}\\)$`),du=new RegExp(`^hsl\\(${bn},${Et},${Et}\\)$`),gu=new RegExp(`^hsla\\(${bn},${Et},${Et},${bn}\\)$`),fr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Hi(Pn,In,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:hr,formatHex:hr,formatHex8:pu,formatHsl:mu,formatRgb:dr,toString:dr});function hr(){return this.rgb().formatHex()}function pu(){return this.rgb().formatHex8()}function mu(){return Xo(this).formatHsl()}function dr(){return this.rgb().formatRgb()}function In(t){var n,e;return t=(t+"").trim().toLowerCase(),(n=lu.exec(t))?(e=n[1].length,n=parseInt(n[1],16),e===6?gr(n):e===3?new rt(n>>8&15|n>>4&240,n>>4&15|n&240,(n&15)<<4|n&15,1):e===8?Ln(n>>24&255,n>>16&255,n>>8&255,(n&255)/255):e===4?Ln(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|n&240,((n&15)<<4|n&15)/255):null):(n=uu.exec(t))?new rt(n[1],n[2],n[3],1):(n=cu.exec(t))?new rt(n[1]*255/100,n[2]*255/100,n[3]*255/100,1):(n=fu.exec(t))?Ln(n[1],n[2],n[3],n[4]):(n=hu.exec(t))?Ln(n[1]*255/100,n[2]*255/100,n[3]*255/100,n[4]):(n=du.exec(t))?yr(n[1],n[2]/100,n[3]/100,1):(n=gu.exec(t))?yr(n[1],n[2]/100,n[3]/100,n[4]):fr.hasOwnProperty(t)?gr(fr[t]):t==="transparent"?new rt(NaN,NaN,NaN,0):null}function gr(t){return new rt(t>>16&255,t>>8&255,t&255,1)}function Ln(t,n,e,i){return i<=0&&(t=n=e=NaN),new rt(t,n,e,i)}function yu(t){return t instanceof Pn||(t=In(t)),t?(t=t.rgb(),new rt(t.r,t.g,t.b,t.opacity)):new rt}function ri(t,n,e,i){return arguments.length===1?yu(t):new rt(t,n,e,i??1)}function rt(t,n,e,i){this.r=+t,this.g=+n,this.b=+e,this.opacity=+i}Hi(rt,ri,Ho(Pn,{brighter(t){return t=t==null?oe:Math.pow(oe,t),new rt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?En:Math.pow(En,t),new rt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new rt(Ut(this.r),Ut(this.g),Ut(this.b),se(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:pr,formatHex:pr,formatHex8:vu,formatRgb:mr,toString:mr}));function pr(){return`#${Bt(this.r)}${Bt(this.g)}${Bt(this.b)}`}function vu(){return`#${Bt(this.r)}${Bt(this.g)}${Bt(this.b)}${Bt((isNaN(this.opacity)?1:this.opacity)*255)}`}function mr(){const t=se(this.opacity);return`${t===1?"rgb(":"rgba("}${Ut(this.r)}, ${Ut(this.g)}, ${Ut(this.b)}${t===1?")":`, ${t})`}`}function se(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Ut(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Bt(t){return t=Ut(t),(t<16?"0":"")+t.toString(16)}function yr(t,n,e,i){return i<=0?t=n=e=NaN:e<=0||e>=1?t=n=NaN:n<=0&&(t=NaN),new mt(t,n,e,i)}function Xo(t){if(t instanceof mt)return new mt(t.h,t.s,t.l,t.opacity);if(t instanceof Pn||(t=In(t)),!t)return new mt;if(t instanceof mt)return t;t=t.rgb();var n=t.r/255,e=t.g/255,i=t.b/255,r=Math.min(n,e,i),o=Math.max(n,e,i),s=NaN,a=o-r,l=(o+r)/2;return a?(n===o?s=(e-i)/a+(e<i)*6:e===o?s=(i-n)/a+2:s=(n-e)/a+4,a/=l<.5?o+r:2-o-r,s*=60):a=l>0&&l<1?0:s,new mt(s,a,l,t.opacity)}function _u(t,n,e,i){return arguments.length===1?Xo(t):new mt(t,n,e,i??1)}function mt(t,n,e,i){this.h=+t,this.s=+n,this.l=+e,this.opacity=+i}Hi(mt,_u,Ho(Pn,{brighter(t){return t=t==null?oe:Math.pow(oe,t),new mt(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?En:Math.pow(En,t),new mt(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,n=isNaN(t)||isNaN(this.s)?0:this.s,e=this.l,i=e+(e<.5?e:1-e)*n,r=2*e-i;return new rt(Xe(t>=240?t-240:t+120,r,i),Xe(t,r,i),Xe(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new mt(vr(this.h),Dn(this.s),Dn(this.l),se(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=se(this.opacity);return`${t===1?"hsl(":"hsla("}${vr(this.h)}, ${Dn(this.s)*100}%, ${Dn(this.l)*100}%${t===1?")":`, ${t})`}`}}));function vr(t){return t=(t||0)%360,t<0?t+360:t}function Dn(t){return Math.max(0,Math.min(1,t||0))}function Xe(t,n,e){return(t<60?n+(e-n)*t/60:t<180?e:t<240?n+(e-n)*(240-t)/60:n)*255}const Uo=t=>()=>t;function wu(t,n){return function(e){return t+e*n}}function Mu(t,n,e){return t=Math.pow(t,e),n=Math.pow(n,e)-t,e=1/e,function(i){return Math.pow(t+i*n,e)}}function xu(t){return(t=+t)==1?Vo:function(n,e){return e-n?Mu(n,e,t):Uo(isNaN(n)?e:n)}}function Vo(t,n){var e=n-t;return e?wu(t,e):Uo(isNaN(t)?n:t)}const _r=(function t(n){var e=xu(n);function i(r,o){var s=e((r=ri(r)).r,(o=ri(o)).r),a=e(r.g,o.g),l=e(r.b,o.b),u=Vo(r.opacity,o.opacity);return function(f){return r.r=s(f),r.g=a(f),r.b=l(f),r.opacity=u(f),r+""}}return i.gamma=t,i})(1);function Ot(t,n){return t=+t,n=+n,function(e){return t*(1-e)+n*e}}var oi=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ue=new RegExp(oi.source,"g");function Su(t){return function(){return t}}function Eu(t){return function(n){return t(n)+""}}function bu(t,n){var e=oi.lastIndex=Ue.lastIndex=0,i,r,o,s=-1,a=[],l=[];for(t=t+"",n=n+"";(i=oi.exec(t))&&(r=Ue.exec(n));)(o=r.index)>e&&(o=n.slice(e,o),a[s]?a[s]+=o:a[++s]=o),(i=i[0])===(r=r[0])?a[s]?a[s]+=r:a[++s]=r:(a[++s]=null,l.push({i:s,x:Ot(i,r)})),e=Ue.lastIndex;return e<n.length&&(o=n.slice(e),a[s]?a[s]+=o:a[++s]=o),a.length<2?l[0]?Eu(l[0].x):Su(n):(n=l.length,function(u){for(var f=0,c;f<n;++f)a[(c=l[f]).i]=c.x(u);return a.join("")})}var wr=180/Math.PI,si={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ko(t,n,e,i,r,o){var s,a,l;return(s=Math.sqrt(t*t+n*n))&&(t/=s,n/=s),(l=t*e+n*i)&&(e-=t*l,i-=n*l),(a=Math.sqrt(e*e+i*i))&&(e/=a,i/=a,l/=a),t*i<n*e&&(t=-t,n=-n,l=-l,s=-s),{translateX:r,translateY:o,rotate:Math.atan2(n,t)*wr,skewX:Math.atan(l)*wr,scaleX:s,scaleY:a}}var zn;function Iu(t){const n=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return n.isIdentity?si:Ko(n.a,n.b,n.c,n.d,n.e,n.f)}function Au(t){return t==null||(zn||(zn=document.createElementNS("http://www.w3.org/2000/svg","g")),zn.setAttribute("transform",t),!(t=zn.transform.baseVal.consolidate()))?si:(t=t.matrix,Ko(t.a,t.b,t.c,t.d,t.e,t.f))}function jo(t,n,e,i){function r(u){return u.length?u.pop()+" ":""}function o(u,f,c,h,d,g){if(u!==c||f!==h){var p=d.push("translate(",null,n,null,e);g.push({i:p-4,x:Ot(u,c)},{i:p-2,x:Ot(f,h)})}else(c||h)&&d.push("translate("+c+n+h+e)}function s(u,f,c,h){u!==f?(u-f>180?f+=360:f-u>180&&(u+=360),h.push({i:c.push(r(c)+"rotate(",null,i)-2,x:Ot(u,f)})):f&&c.push(r(c)+"rotate("+f+i)}function a(u,f,c,h){u!==f?h.push({i:c.push(r(c)+"skewX(",null,i)-2,x:Ot(u,f)}):f&&c.push(r(c)+"skewX("+f+i)}function l(u,f,c,h,d,g){if(u!==c||f!==h){var p=d.push(r(d)+"scale(",null,",",null,")");g.push({i:p-4,x:Ot(u,c)},{i:p-2,x:Ot(f,h)})}else(c!==1||h!==1)&&d.push(r(d)+"scale("+c+","+h+")")}return function(u,f){var c=[],h=[];return u=t(u),f=t(f),o(u.translateX,u.translateY,f.translateX,f.translateY,c,h),s(u.rotate,f.rotate,c,h),a(u.skewX,f.skewX,c,h),l(u.scaleX,u.scaleY,f.scaleX,f.scaleY,c,h),u=f=null,function(d){for(var g=-1,p=h.length,M;++g<p;)c[(M=h[g]).i]=M.x(d);return c.join("")}}}var $u=jo(Iu,"px, ","px)","deg)"),Tu=jo(Au,", ",")",")"),Nu=1e-12;function Mr(t){return((t=Math.exp(t))+1/t)/2}function Pu(t){return((t=Math.exp(t))-1/t)/2}function ku(t){return((t=Math.exp(2*t))-1)/(t+1)}const Cu=(function t(n,e,i){function r(o,s){var a=o[0],l=o[1],u=o[2],f=s[0],c=s[1],h=s[2],d=f-a,g=c-l,p=d*d+g*g,M,m;if(p<Nu)m=Math.log(h/u)/n,M=function(T){return[a+T*d,l+T*g,u*Math.exp(n*T*m)]};else{var E=Math.sqrt(p),x=(h*h-u*u+i*p)/(2*u*e*E),w=(h*h-u*u-i*p)/(2*h*e*E),b=Math.log(Math.sqrt(x*x+1)-x),$=Math.log(Math.sqrt(w*w+1)-w);m=($-b)/n,M=function(T){var N=T*m,I=Mr(b),P=u/(e*E)*(I*ku(n*N+b)-Pu(b));return[a+P*d,l+P*g,u*I/Mr(n*N+b)]}}return M.duration=m*1e3*n/Math.SQRT2,M}return r.rho=function(o){var s=Math.max(.001,+o),a=s*s,l=a*a;return t(s,a,l)},r})(Math.SQRT2,2,4);var rn=0,gn=0,cn=0,Wo=1e3,ae,pn,le=0,Vt=0,Le=0,An=typeof performance=="object"&&performance.now?performance:Date,Qo=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Xi(){return Vt||(Qo(Ru),Vt=An.now()+Le)}function Ru(){Vt=0}function ue(){this._call=this._time=this._next=null}ue.prototype=Zo.prototype={constructor:ue,restart:function(t,n,e){if(typeof t!="function")throw new TypeError("callback is not a function");e=(e==null?Xi():+e)+(n==null?0:+n),!this._next&&pn!==this&&(pn?pn._next=this:ae=this,pn=this),this._call=t,this._time=e,ai()},stop:function(){this._call&&(this._call=null,this._time=1/0,ai())}};function Zo(t,n,e){var i=new ue;return i.restart(t,n,e),i}function Lu(){Xi(),++rn;for(var t=ae,n;t;)(n=Vt-t._time)>=0&&t._call.call(void 0,n),t=t._next;--rn}function xr(){Vt=(le=An.now())+Le,rn=gn=0;try{Lu()}finally{rn=0,zu(),Vt=0}}function Du(){var t=An.now(),n=t-le;n>Wo&&(Le-=n,le=t)}function zu(){for(var t,n=ae,e,i=1/0;n;)n._call?(i>n._time&&(i=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:ae=e);pn=t,ai(i)}function ai(t){if(!rn){gn&&(gn=clearTimeout(gn));var n=t-Vt;n>24?(t<1/0&&(gn=setTimeout(xr,t-An.now()-Le)),cn&&(cn=clearInterval(cn))):(cn||(le=An.now(),cn=setInterval(Du,Wo)),rn=1,Qo(xr))}}function Sr(t,n,e){var i=new ue;return n=n==null?0:+n,i.restart(r=>{i.stop(),t(r+n)},n,e),i}var Ou=Ce("start","end","cancel","interrupt"),Fu=[],Jo=0,Er=1,li=2,jn=3,br=4,ui=5,Wn=6;function De(t,n,e,i,r,o){var s=t.__transition;if(!s)t.__transition={};else if(e in s)return;qu(t,e,{name:n,index:i,group:r,on:Ou,tween:Fu,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:Jo})}function Ui(t,n){var e=wt(t,n);if(e.state>Jo)throw new Error("too late; already scheduled");return e}function It(t,n){var e=wt(t,n);if(e.state>jn)throw new Error("too late; already running");return e}function wt(t,n){var e=t.__transition;if(!e||!(e=e[n]))throw new Error("transition not found");return e}function qu(t,n,e){var i=t.__transition,r;i[n]=e,e.timer=Zo(o,0,e.time);function o(u){e.state=Er,e.timer.restart(s,e.delay,e.time),e.delay<=u&&s(u-e.delay)}function s(u){var f,c,h,d;if(e.state!==Er)return l();for(f in i)if(d=i[f],d.name===e.name){if(d.state===jn)return Sr(s);d.state===br?(d.state=Wn,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete i[f]):+f<n&&(d.state=Wn,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete i[f])}if(Sr(function(){e.state===jn&&(e.state=br,e.timer.restart(a,e.delay,e.time),a(u))}),e.state=li,e.on.call("start",t,t.__data__,e.index,e.group),e.state===li){for(e.state=jn,r=new Array(h=e.tween.length),f=0,c=-1;f<h;++f)(d=e.tween[f].value.call(t,t.__data__,e.index,e.group))&&(r[++c]=d);r.length=c+1}}function a(u){for(var f=u<e.duration?e.ease.call(null,u/e.duration):(e.timer.restart(l),e.state=ui,1),c=-1,h=r.length;++c<h;)r[c].call(t,f);e.state===ui&&(e.on.call("end",t,t.__data__,e.index,e.group),l())}function l(){e.state=Wn,e.timer.stop(),delete i[n];for(var u in i)return;delete t.__transition}}function Qn(t,n){var e=t.__transition,i,r,o=!0,s;if(e){n=n==null?null:n+"";for(s in e){if((i=e[s]).name!==n){o=!1;continue}r=i.state>li&&i.state<ui,i.state=Wn,i.timer.stop(),i.on.call(r?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete e[s]}o&&delete t.__transition}}function Gu(t){return this.each(function(){Qn(this,t)})}function Bu(t,n){var e,i;return function(){var r=It(this,t),o=r.tween;if(o!==e){i=e=o;for(var s=0,a=i.length;s<a;++s)if(i[s].name===n){i=i.slice(),i.splice(s,1);break}}r.tween=i}}function Yu(t,n,e){var i,r;if(typeof e!="function")throw new Error;return function(){var o=It(this,t),s=o.tween;if(s!==i){r=(i=s).slice();for(var a={name:n,value:e},l=0,u=r.length;l<u;++l)if(r[l].name===n){r[l]=a;break}l===u&&r.push(a)}o.tween=r}}function Hu(t,n){var e=this._id;if(t+="",arguments.length<2){for(var i=wt(this.node(),e).tween,r=0,o=i.length,s;r<o;++r)if((s=i[r]).name===t)return s.value;return null}return this.each((n==null?Bu:Yu)(e,t,n))}function Vi(t,n,e){var i=t._id;return t.each(function(){var r=It(this,i);(r.value||(r.value={}))[n]=e.apply(this,arguments)}),function(r){return wt(r,i).value[n]}}function ts(t,n){var e;return(typeof n=="number"?Ot:n instanceof In?_r:(e=In(n))?(n=e,_r):bu)(t,n)}function Xu(t){return function(){this.removeAttribute(t)}}function Uu(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Vu(t,n,e){var i,r=e+"",o;return function(){var s=this.getAttribute(t);return s===r?null:s===i?o:o=n(i=s,e)}}function Ku(t,n,e){var i,r=e+"",o;return function(){var s=this.getAttributeNS(t.space,t.local);return s===r?null:s===i?o:o=n(i=s,e)}}function ju(t,n,e){var i,r,o;return function(){var s,a=e(this),l;return a==null?void this.removeAttribute(t):(s=this.getAttribute(t),l=a+"",s===l?null:s===i&&l===r?o:(r=l,o=n(i=s,a)))}}function Wu(t,n,e){var i,r,o;return function(){var s,a=e(this),l;return a==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),l=a+"",s===l?null:s===i&&l===r?o:(r=l,o=n(i=s,a)))}}function Qu(t,n){var e=Re(t),i=e==="transform"?Tu:ts;return this.attrTween(t,typeof n=="function"?(e.local?Wu:ju)(e,i,Vi(this,"attr."+t,n)):n==null?(e.local?Uu:Xu)(e):(e.local?Ku:Vu)(e,i,n))}function Zu(t,n){return function(e){this.setAttribute(t,n.call(this,e))}}function Ju(t,n){return function(e){this.setAttributeNS(t.space,t.local,n.call(this,e))}}function tc(t,n){var e,i;function r(){var o=n.apply(this,arguments);return o!==i&&(e=(i=o)&&Ju(t,o)),e}return r._value=n,r}function nc(t,n){var e,i;function r(){var o=n.apply(this,arguments);return o!==i&&(e=(i=o)&&Zu(t,o)),e}return r._value=n,r}function ec(t,n){var e="attr."+t;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;var i=Re(t);return this.tween(e,(i.local?tc:nc)(i,n))}function ic(t,n){return function(){Ui(this,t).delay=+n.apply(this,arguments)}}function rc(t,n){return n=+n,function(){Ui(this,t).delay=n}}function oc(t){var n=this._id;return arguments.length?this.each((typeof t=="function"?ic:rc)(n,t)):wt(this.node(),n).delay}function sc(t,n){return function(){It(this,t).duration=+n.apply(this,arguments)}}function ac(t,n){return n=+n,function(){It(this,t).duration=n}}function lc(t){var n=this._id;return arguments.length?this.each((typeof t=="function"?sc:ac)(n,t)):wt(this.node(),n).duration}function uc(t,n){if(typeof n!="function")throw new Error;return function(){It(this,t).ease=n}}function cc(t){var n=this._id;return arguments.length?this.each(uc(n,t)):wt(this.node(),n).ease}function fc(t,n){return function(){var e=n.apply(this,arguments);if(typeof e!="function")throw new Error;It(this,t).ease=e}}function hc(t){if(typeof t!="function")throw new Error;return this.each(fc(this._id,t))}function dc(t){typeof t!="function"&&(t=Po(t));for(var n=this._groups,e=n.length,i=new Array(e),r=0;r<e;++r)for(var o=n[r],s=o.length,a=i[r]=[],l,u=0;u<s;++u)(l=o[u])&&t.call(l,l.__data__,u,o)&&a.push(l);return new Rt(i,this._parents,this._name,this._id)}function gc(t){if(t._id!==this._id)throw new Error;for(var n=this._groups,e=t._groups,i=n.length,r=e.length,o=Math.min(i,r),s=new Array(i),a=0;a<o;++a)for(var l=n[a],u=e[a],f=l.length,c=s[a]=new Array(f),h,d=0;d<f;++d)(h=l[d]||u[d])&&(c[d]=h);for(;a<i;++a)s[a]=n[a];return new Rt(s,this._parents,this._name,this._id)}function pc(t){return(t+"").trim().split(/^|\s+/).every(function(n){var e=n.indexOf(".");return e>=0&&(n=n.slice(0,e)),!n||n==="start"})}function mc(t,n,e){var i,r,o=pc(n)?Ui:It;return function(){var s=o(this,t),a=s.on;a!==i&&(r=(i=a).copy()).on(n,e),s.on=r}}function yc(t,n){var e=this._id;return arguments.length<2?wt(this.node(),e).on.on(t):this.each(mc(e,t,n))}function vc(t){return function(){var n=this.parentNode;for(var e in this.__transition)if(+e!==t)return;n&&n.removeChild(this)}}function _c(){return this.on("end.remove",vc(this._id))}function wc(t){var n=this._name,e=this._id;typeof t!="function"&&(t=Bi(t));for(var i=this._groups,r=i.length,o=new Array(r),s=0;s<r;++s)for(var a=i[s],l=a.length,u=o[s]=new Array(l),f,c,h=0;h<l;++h)(f=a[h])&&(c=t.call(f,f.__data__,h,a))&&("__data__"in f&&(c.__data__=f.__data__),u[h]=c,De(u[h],n,e,h,u,wt(f,e)));return new Rt(o,this._parents,n,e)}function Mc(t){var n=this._name,e=this._id;typeof t!="function"&&(t=No(t));for(var i=this._groups,r=i.length,o=[],s=[],a=0;a<r;++a)for(var l=i[a],u=l.length,f,c=0;c<u;++c)if(f=l[c]){for(var h=t.call(f,f.__data__,c,l),d,g=wt(f,e),p=0,M=h.length;p<M;++p)(d=h[p])&&De(d,n,e,p,h,g);o.push(h),s.push(f)}return new Rt(o,s,n,e)}var xc=Nn.prototype.constructor;function Sc(){return new xc(this._groups,this._parents)}function Ec(t,n){var e,i,r;return function(){var o=en(this,t),s=(this.style.removeProperty(t),en(this,t));return o===s?null:o===e&&s===i?r:r=n(e=o,i=s)}}function ns(t){return function(){this.style.removeProperty(t)}}function bc(t,n,e){var i,r=e+"",o;return function(){var s=en(this,t);return s===r?null:s===i?o:o=n(i=s,e)}}function Ic(t,n,e){var i,r,o;return function(){var s=en(this,t),a=e(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(t),en(this,t))),s===l?null:s===i&&l===r?o:(r=l,o=n(i=s,a))}}function Ac(t,n){var e,i,r,o="style."+n,s="end."+o,a;return function(){var l=It(this,t),u=l.on,f=l.value[o]==null?a||(a=ns(n)):void 0;(u!==e||r!==f)&&(i=(e=u).copy()).on(s,r=f),l.on=i}}function $c(t,n,e){var i=(t+="")=="transform"?$u:ts;return n==null?this.styleTween(t,Ec(t,i)).on("end.style."+t,ns(t)):typeof n=="function"?this.styleTween(t,Ic(t,i,Vi(this,"style."+t,n))).each(Ac(this._id,t)):this.styleTween(t,bc(t,i,n),e).on("end.style."+t,null)}function Tc(t,n,e){return function(i){this.style.setProperty(t,n.call(this,i),e)}}function Nc(t,n,e){var i,r;function o(){var s=n.apply(this,arguments);return s!==r&&(i=(r=s)&&Tc(t,s,e)),i}return o._value=n,o}function Pc(t,n,e){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(n==null)return this.tween(i,null);if(typeof n!="function")throw new Error;return this.tween(i,Nc(t,n,e??""))}function kc(t){return function(){this.textContent=t}}function Cc(t){return function(){var n=t(this);this.textContent=n??""}}function Rc(t){return this.tween("text",typeof t=="function"?Cc(Vi(this,"text",t)):kc(t==null?"":t+""))}function Lc(t){return function(n){this.textContent=t.call(this,n)}}function Dc(t){var n,e;function i(){var r=t.apply(this,arguments);return r!==e&&(n=(e=r)&&Lc(r)),n}return i._value=t,i}function zc(t){var n="text";if(arguments.length<1)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,Dc(t))}function Oc(){for(var t=this._name,n=this._id,e=es(),i=this._groups,r=i.length,o=0;o<r;++o)for(var s=i[o],a=s.length,l,u=0;u<a;++u)if(l=s[u]){var f=wt(l,n);De(l,t,e,u,s,{time:f.time+f.delay+f.duration,delay:0,duration:f.duration,ease:f.ease})}return new Rt(i,this._parents,t,e)}function Fc(){var t,n,e=this,i=e._id,r=e.size();return new Promise(function(o,s){var a={value:s},l={value:function(){--r===0&&o()}};e.each(function(){var u=It(this,i),f=u.on;f!==t&&(n=(t=f).copy(),n._.cancel.push(a),n._.interrupt.push(a),n._.end.push(l)),u.on=n}),r===0&&o()})}var qc=0;function Rt(t,n,e,i){this._groups=t,this._parents=n,this._name=e,this._id=i}function es(){return++qc}var Nt=Nn.prototype;Rt.prototype={constructor:Rt,select:wc,selectAll:Mc,selectChild:Nt.selectChild,selectChildren:Nt.selectChildren,filter:dc,merge:gc,selection:Sc,transition:Oc,call:Nt.call,nodes:Nt.nodes,node:Nt.node,size:Nt.size,empty:Nt.empty,each:Nt.each,on:yc,attr:Qu,attrTween:ec,style:$c,styleTween:Pc,text:Rc,textTween:zc,remove:_c,tween:Hu,delay:oc,duration:lc,ease:cc,easeVarying:hc,end:Fc,[Symbol.iterator]:Nt[Symbol.iterator]};function Gc(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Bc={time:null,delay:0,duration:250,ease:Gc};function Yc(t,n){for(var e;!(e=t.__transition)||!(e=e[n]);)if(!(t=t.parentNode))throw new Error(`transition ${n} not found`);return e}function Hc(t){var n,e;t instanceof Rt?(n=t._id,t=t._name):(n=es(),(e=Bc).time=Xi(),t=t==null?null:t+"");for(var i=this._groups,r=i.length,o=0;o<r;++o)for(var s=i[o],a=s.length,l,u=0;u<a;++u)(l=s[u])&&De(l,t,n,u,s,e||Yc(l,n));return new Rt(i,this._parents,t,n)}Nn.prototype.interrupt=Gu;Nn.prototype.transition=Hc;const Ct=11102230246251565e-32,Q=134217729,Xc=(3+8*Ct)*Ct;function Ve(t,n,e,i,r){let o,s,a,l,u=n[0],f=i[0],c=0,h=0;f>u==f>-u?(o=u,u=n[++c]):(o=f,f=i[++h]);let d=0;if(c<t&&h<e)for(f>u==f>-u?(s=u+o,a=o-(s-u),u=n[++c]):(s=f+o,a=o-(s-f),f=i[++h]),o=s,a!==0&&(r[d++]=a);c<t&&h<e;)f>u==f>-u?(s=o+u,l=s-o,a=o-(s-l)+(u-l),u=n[++c]):(s=o+f,l=s-o,a=o-(s-l)+(f-l),f=i[++h]),o=s,a!==0&&(r[d++]=a);for(;c<t;)s=o+u,l=s-o,a=o-(s-l)+(u-l),u=n[++c],o=s,a!==0&&(r[d++]=a);for(;h<e;)s=o+f,l=s-o,a=o-(s-l)+(f-l),f=i[++h],o=s,a!==0&&(r[d++]=a);return(o!==0||d===0)&&(r[d++]=o),d}function Uc(t,n){let e=n[0];for(let i=1;i<t;i++)e+=n[i];return e}function kn(t){return new Float64Array(t)}const Vc=(3+16*Ct)*Ct,Kc=(2+12*Ct)*Ct,jc=(9+64*Ct)*Ct*Ct,jt=kn(4),Ir=kn(8),Ar=kn(12),$r=kn(16),J=kn(4);function Wc(t,n,e,i,r,o,s){let a,l,u,f,c,h,d,g,p,M,m,E,x,w,b,$,T,N;const I=t-r,P=e-r,S=n-o,L=i-o;w=I*L,h=Q*I,d=h-(h-I),g=I-d,h=Q*L,p=h-(h-L),M=L-p,b=g*M-(w-d*p-g*p-d*M),$=S*P,h=Q*S,d=h-(h-S),g=S-d,h=Q*P,p=h-(h-P),M=P-p,T=g*M-($-d*p-g*p-d*M),m=b-T,c=b-m,jt[0]=b-(m+c)+(c-T),E=w+m,c=E-w,x=w-(E-c)+(m-c),m=x-$,c=x-m,jt[1]=x-(m+c)+(c-$),N=E+m,c=N-E,jt[2]=E-(N-c)+(m-c),jt[3]=N;let R=Uc(4,jt),y=Kc*s;if(R>=y||-R>=y||(c=t-I,a=t-(I+c)+(c-r),c=e-P,u=e-(P+c)+(c-r),c=n-S,l=n-(S+c)+(c-o),c=i-L,f=i-(L+c)+(c-o),a===0&&l===0&&u===0&&f===0)||(y=jc*s+Xc*Math.abs(R),R+=I*f+L*a-(S*u+P*l),R>=y||-R>=y))return R;w=a*L,h=Q*a,d=h-(h-a),g=a-d,h=Q*L,p=h-(h-L),M=L-p,b=g*M-(w-d*p-g*p-d*M),$=l*P,h=Q*l,d=h-(h-l),g=l-d,h=Q*P,p=h-(h-P),M=P-p,T=g*M-($-d*p-g*p-d*M),m=b-T,c=b-m,J[0]=b-(m+c)+(c-T),E=w+m,c=E-w,x=w-(E-c)+(m-c),m=x-$,c=x-m,J[1]=x-(m+c)+(c-$),N=E+m,c=N-E,J[2]=E-(N-c)+(m-c),J[3]=N;const v=Ve(4,jt,4,J,Ir);w=I*f,h=Q*I,d=h-(h-I),g=I-d,h=Q*f,p=h-(h-f),M=f-p,b=g*M-(w-d*p-g*p-d*M),$=S*u,h=Q*S,d=h-(h-S),g=S-d,h=Q*u,p=h-(h-u),M=u-p,T=g*M-($-d*p-g*p-d*M),m=b-T,c=b-m,J[0]=b-(m+c)+(c-T),E=w+m,c=E-w,x=w-(E-c)+(m-c),m=x-$,c=x-m,J[1]=x-(m+c)+(c-$),N=E+m,c=N-E,J[2]=E-(N-c)+(m-c),J[3]=N;const _=Ve(v,Ir,4,J,Ar);w=a*f,h=Q*a,d=h-(h-a),g=a-d,h=Q*f,p=h-(h-f),M=f-p,b=g*M-(w-d*p-g*p-d*M),$=l*u,h=Q*l,d=h-(h-l),g=l-d,h=Q*u,p=h-(h-u),M=u-p,T=g*M-($-d*p-g*p-d*M),m=b-T,c=b-m,J[0]=b-(m+c)+(c-T),E=w+m,c=E-w,x=w-(E-c)+(m-c),m=x-$,c=x-m,J[1]=x-(m+c)+(c-$),N=E+m,c=N-E,J[2]=E-(N-c)+(m-c),J[3]=N;const A=Ve(_,Ar,4,J,$r);return $r[A-1]}function On(t,n,e,i,r,o){const s=(n-o)*(e-r),a=(t-r)*(i-o),l=s-a,u=Math.abs(s+a);return Math.abs(l)>=Vc*u?l:-Wc(t,n,e,i,r,o,u)}const Tr=Math.pow(2,-52),Fn=new Uint32Array(512);class ce{static from(n,e=nf,i=ef){const r=n.length,o=new Float64Array(r*2);for(let s=0;s<r;s++){const a=n[s];o[2*s]=e(a),o[2*s+1]=i(a)}return new ce(o)}constructor(n){const e=n.length>>1;if(e>0&&typeof n[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=n;const i=Math.max(2*e-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:n,_hullPrev:e,_hullNext:i,_hullTri:r,_hullHash:o}=this,s=n.length>>1;let a=1/0,l=1/0,u=-1/0,f=-1/0;for(let I=0;I<s;I++){const P=n[2*I],S=n[2*I+1];P<a&&(a=P),S<l&&(l=S),P>u&&(u=P),S>f&&(f=S),this._ids[I]=I}const c=(a+u)/2,h=(l+f)/2;let d,g,p;for(let I=0,P=1/0;I<s;I++){const S=Ke(c,h,n[2*I],n[2*I+1]);S<P&&(d=I,P=S)}const M=n[2*d],m=n[2*d+1];for(let I=0,P=1/0;I<s;I++){if(I===d)continue;const S=Ke(M,m,n[2*I],n[2*I+1]);S<P&&S>0&&(g=I,P=S)}let E=n[2*g],x=n[2*g+1],w=1/0;for(let I=0;I<s;I++){if(I===d||I===g)continue;const P=Jc(M,m,E,x,n[2*I],n[2*I+1]);P<w&&(p=I,w=P)}let b=n[2*p],$=n[2*p+1];if(w===1/0){for(let S=0;S<s;S++)this._dists[S]=n[2*S]-n[0]||n[2*S+1]-n[1];Zt(this._ids,this._dists,0,s-1);const I=new Uint32Array(s);let P=0;for(let S=0,L=-1/0;S<s;S++){const R=this._ids[S],y=this._dists[R];y>L&&(I[P++]=R,L=y)}this.hull=I.subarray(0,P),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(On(M,m,E,x,b,$)<0){const I=g,P=E,S=x;g=p,E=b,x=$,p=I,b=P,$=S}const T=tf(M,m,E,x,b,$);this._cx=T.x,this._cy=T.y;for(let I=0;I<s;I++)this._dists[I]=Ke(n[2*I],n[2*I+1],T.x,T.y);Zt(this._ids,this._dists,0,s-1),this._hullStart=d;let N=3;i[d]=e[p]=g,i[g]=e[d]=p,i[p]=e[g]=d,r[d]=0,r[g]=1,r[p]=2,o.fill(-1),o[this._hashKey(M,m)]=d,o[this._hashKey(E,x)]=g,o[this._hashKey(b,$)]=p,this.trianglesLen=0,this._addTriangle(d,g,p,-1,-1,-1);for(let I=0,P,S;I<this._ids.length;I++){const L=this._ids[I],R=n[2*L],y=n[2*L+1];if(I>0&&Math.abs(R-P)<=Tr&&Math.abs(y-S)<=Tr||(P=R,S=y,L===d||L===g||L===p))continue;let v=0;for(let D=0,O=this._hashKey(R,y);D<this._hashSize&&(v=o[(O+D)%this._hashSize],!(v!==-1&&v!==i[v]));D++);v=e[v];let _=v,A;for(;A=i[_],On(R,y,n[2*_],n[2*_+1],n[2*A],n[2*A+1])>=0;)if(_=A,_===v){_=-1;break}if(_===-1)continue;let C=this._addTriangle(_,L,i[_],-1,-1,r[_]);r[L]=this._legalize(C+2),r[_]=C,N++;let k=i[_];for(;A=i[k],On(R,y,n[2*k],n[2*k+1],n[2*A],n[2*A+1])<0;)C=this._addTriangle(k,L,A,r[L],-1,r[k]),r[L]=this._legalize(C+2),i[k]=k,N--,k=A;if(_===v)for(;A=e[_],On(R,y,n[2*A],n[2*A+1],n[2*_],n[2*_+1])<0;)C=this._addTriangle(A,L,_,-1,r[_],r[A]),this._legalize(C+2),r[A]=C,i[_]=_,N--,_=A;this._hullStart=e[L]=_,i[_]=e[k]=L,i[L]=k,o[this._hashKey(R,y)]=L,o[this._hashKey(n[2*_],n[2*_+1])]=_}this.hull=new Uint32Array(N);for(let I=0,P=this._hullStart;I<N;I++)this.hull[I]=P,P=i[P];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(n,e){return Math.floor(Qc(n-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(n){const{_triangles:e,_halfedges:i,coords:r}=this;let o=0,s=0;for(;;){const a=i[n],l=n-n%3;if(s=l+(n+2)%3,a===-1){if(o===0)break;n=Fn[--o];continue}const u=a-a%3,f=l+(n+1)%3,c=u+(a+2)%3,h=e[s],d=e[n],g=e[f],p=e[c];if(Zc(r[2*h],r[2*h+1],r[2*d],r[2*d+1],r[2*g],r[2*g+1],r[2*p],r[2*p+1])){e[n]=p,e[a]=h;const m=i[c];if(m===-1){let x=this._hullStart;do{if(this._hullTri[x]===c){this._hullTri[x]=n;break}x=this._hullPrev[x]}while(x!==this._hullStart)}this._link(n,m),this._link(a,i[s]),this._link(s,c);const E=u+(a+1)%3;o<Fn.length&&(Fn[o++]=E)}else{if(o===0)break;n=Fn[--o]}}return s}_link(n,e){this._halfedges[n]=e,e!==-1&&(this._halfedges[e]=n)}_addTriangle(n,e,i,r,o,s){const a=this.trianglesLen;return this._triangles[a]=n,this._triangles[a+1]=e,this._triangles[a+2]=i,this._link(a,r),this._link(a+1,o),this._link(a+2,s),this.trianglesLen+=3,a}}function Qc(t,n){const e=t/(Math.abs(t)+Math.abs(n));return(n>0?3-e:1+e)/4}function Ke(t,n,e,i){const r=t-e,o=n-i;return r*r+o*o}function Zc(t,n,e,i,r,o,s,a){const l=t-s,u=n-a,f=e-s,c=i-a,h=r-s,d=o-a,g=l*l+u*u,p=f*f+c*c,M=h*h+d*d;return l*(c*M-p*d)-u*(f*M-p*h)+g*(f*d-c*h)<0}function Jc(t,n,e,i,r,o){const s=e-t,a=i-n,l=r-t,u=o-n,f=s*s+a*a,c=l*l+u*u,h=.5/(s*u-a*l),d=(u*f-a*c)*h,g=(s*c-l*f)*h;return d*d+g*g}function tf(t,n,e,i,r,o){const s=e-t,a=i-n,l=r-t,u=o-n,f=s*s+a*a,c=l*l+u*u,h=.5/(s*u-a*l),d=t+(u*f-a*c)*h,g=n+(s*c-l*f)*h;return{x:d,y:g}}function Zt(t,n,e,i){if(i-e<=20)for(let r=e+1;r<=i;r++){const o=t[r],s=n[o];let a=r-1;for(;a>=e&&n[t[a]]>s;)t[a+1]=t[a--];t[a+1]=o}else{const r=e+i>>1;let o=e+1,s=i;fn(t,r,o),n[t[e]]>n[t[i]]&&fn(t,e,i),n[t[o]]>n[t[i]]&&fn(t,o,i),n[t[e]]>n[t[o]]&&fn(t,e,o);const a=t[o],l=n[a];for(;;){do o++;while(n[t[o]]<l);do s--;while(n[t[s]]>l);if(s<o)break;fn(t,o,s)}t[e+1]=t[s],t[s]=a,i-o+1>=s-e?(Zt(t,n,o,i),Zt(t,n,e,s-1)):(Zt(t,n,e,s-1),Zt(t,n,o,i))}}function fn(t,n,e){const i=t[n];t[n]=t[e],t[e]=i}function nf(t){return t[0]}function ef(t){return t[1]}const Nr=1e-6;class Yt{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(n,e){this._+=`M${this._x0=this._x1=+n},${this._y0=this._y1=+e}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(n,e){this._+=`L${this._x1=+n},${this._y1=+e}`}arc(n,e,i){n=+n,e=+e,i=+i;const r=n+i,o=e;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${r},${o}`:(Math.abs(this._x1-r)>Nr||Math.abs(this._y1-o)>Nr)&&(this._+="L"+r+","+o),i&&(this._+=`A${i},${i},0,1,1,${n-i},${e}A${i},${i},0,1,1,${this._x1=r},${this._y1=o}`)}rect(n,e,i,r){this._+=`M${this._x0=this._x1=+n},${this._y0=this._y1=+e}h${+i}v${+r}h${-i}Z`}value(){return this._||null}}class ci{constructor(){this._=[]}moveTo(n,e){this._.push([n,e])}closePath(){this._.push(this._[0].slice())}lineTo(n,e){this._.push([n,e])}value(){return this._.length?this._:null}}class rf{constructor(n,[e,i,r,o]=[0,0,960,500]){if(!((r=+r)>=(e=+e))||!((o=+o)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=n,this._circumcenters=new Float64Array(n.points.length*2),this.vectors=new Float64Array(n.points.length*2),this.xmax=r,this.xmin=e,this.ymax=o,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:n,hull:e,triangles:i},vectors:r}=this;let o,s;const a=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let p=0,M=0,m=i.length,E,x;p<m;p+=3,M+=2){const w=i[p]*2,b=i[p+1]*2,$=i[p+2]*2,T=n[w],N=n[w+1],I=n[b],P=n[b+1],S=n[$],L=n[$+1],R=I-T,y=P-N,v=S-T,_=L-N,A=(R*_-y*v)*2;if(Math.abs(A)<1e-9){if(o===void 0){o=s=0;for(const k of e)o+=n[k*2],s+=n[k*2+1];o/=e.length,s/=e.length}const C=1e9*Math.sign((o-T)*_-(s-N)*v);E=(T+S)/2-C*_,x=(N+L)/2+C*v}else{const C=1/A,k=R*R+y*y,D=v*v+_*_;E=T+(_*k-y*D)*C,x=N+(R*D-v*k)*C}a[M]=E,a[M+1]=x}let l=e[e.length-1],u,f=l*4,c,h=n[2*l],d,g=n[2*l+1];r.fill(0);for(let p=0;p<e.length;++p)l=e[p],u=f,c=h,d=g,f=l*4,h=n[2*l],g=n[2*l+1],r[u+2]=r[f]=d-g,r[u+3]=r[f+1]=h-c}render(n){const e=n==null?n=new Yt:void 0,{delaunay:{halfedges:i,inedges:r,hull:o},circumcenters:s,vectors:a}=this;if(o.length<=1)return null;for(let f=0,c=i.length;f<c;++f){const h=i[f];if(h<f)continue;const d=Math.floor(f/3)*2,g=Math.floor(h/3)*2,p=s[d],M=s[d+1],m=s[g],E=s[g+1];this._renderSegment(p,M,m,E,n)}let l,u=o[o.length-1];for(let f=0;f<o.length;++f){l=u,u=o[f];const c=Math.floor(r[u]/3)*2,h=s[c],d=s[c+1],g=l*4,p=this._project(h,d,a[g+2],a[g+3]);p&&this._renderSegment(h,d,p[0],p[1],n)}return e&&e.value()}renderBounds(n){const e=n==null?n=new Yt:void 0;return n.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),e&&e.value()}renderCell(n,e){const i=e==null?e=new Yt:void 0,r=this._clip(n);if(r===null||!r.length)return;e.moveTo(r[0],r[1]);let o=r.length;for(;r[0]===r[o-2]&&r[1]===r[o-1]&&o>1;)o-=2;for(let s=2;s<o;s+=2)(r[s]!==r[s-2]||r[s+1]!==r[s-1])&&e.lineTo(r[s],r[s+1]);return e.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:n}}=this;for(let e=0,i=n.length/2;e<i;++e){const r=this.cellPolygon(e);r&&(r.index=e,yield r)}}cellPolygon(n){const e=new ci;return this.renderCell(n,e),e.value()}_renderSegment(n,e,i,r,o){let s;const a=this._regioncode(n,e),l=this._regioncode(i,r);a===0&&l===0?(o.moveTo(n,e),o.lineTo(i,r)):(s=this._clipSegment(n,e,i,r,a,l))&&(o.moveTo(s[0],s[1]),o.lineTo(s[2],s[3]))}contains(n,e,i){return e=+e,e!==e||(i=+i,i!==i)?!1:this.delaunay._step(n,e,i)===n}*neighbors(n){const e=this._clip(n);if(e)for(const i of this.delaunay.neighbors(n)){const r=this._clip(i);if(r){t:for(let o=0,s=e.length;o<s;o+=2)for(let a=0,l=r.length;a<l;a+=2)if(e[o]===r[a]&&e[o+1]===r[a+1]&&e[(o+2)%s]===r[(a+l-2)%l]&&e[(o+3)%s]===r[(a+l-1)%l]){yield i;break t}}}}_cell(n){const{circumcenters:e,delaunay:{inedges:i,halfedges:r,triangles:o}}=this,s=i[n];if(s===-1)return null;const a=[];let l=s;do{const u=Math.floor(l/3);if(a.push(e[u*2],e[u*2+1]),l=l%3===2?l-2:l+1,o[l]!==n)break;l=r[l]}while(l!==s&&l!==-1);return a}_clip(n){if(n===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(n);if(e===null)return null;const{vectors:i}=this,r=n*4;return this._simplify(i[r]||i[r+1]?this._clipInfinite(n,e,i[r],i[r+1],i[r+2],i[r+3]):this._clipFinite(n,e))}_clipFinite(n,e){const i=e.length;let r=null,o,s,a=e[i-2],l=e[i-1],u,f=this._regioncode(a,l),c,h=0;for(let d=0;d<i;d+=2)if(o=a,s=l,a=e[d],l=e[d+1],u=f,f=this._regioncode(a,l),u===0&&f===0)c=h,h=0,r?r.push(a,l):r=[a,l];else{let g,p,M,m,E;if(u===0){if((g=this._clipSegment(o,s,a,l,u,f))===null)continue;[p,M,m,E]=g}else{if((g=this._clipSegment(a,l,o,s,f,u))===null)continue;[m,E,p,M]=g,c=h,h=this._edgecode(p,M),c&&h&&this._edge(n,c,h,r,r.length),r?r.push(p,M):r=[p,M]}c=h,h=this._edgecode(m,E),c&&h&&this._edge(n,c,h,r,r.length),r?r.push(m,E):r=[m,E]}if(r)c=h,h=this._edgecode(r[0],r[1]),c&&h&&this._edge(n,c,h,r,r.length);else if(this.contains(n,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return r}_clipSegment(n,e,i,r,o,s){const a=o<s;for(a&&([n,e,i,r,o,s]=[i,r,n,e,s,o]);;){if(o===0&&s===0)return a?[i,r,n,e]:[n,e,i,r];if(o&s)return null;let l,u,f=o||s;f&8?(l=n+(i-n)*(this.ymax-e)/(r-e),u=this.ymax):f&4?(l=n+(i-n)*(this.ymin-e)/(r-e),u=this.ymin):f&2?(u=e+(r-e)*(this.xmax-n)/(i-n),l=this.xmax):(u=e+(r-e)*(this.xmin-n)/(i-n),l=this.xmin),o?(n=l,e=u,o=this._regioncode(n,e)):(i=l,r=u,s=this._regioncode(i,r))}}_clipInfinite(n,e,i,r,o,s){let a=Array.from(e),l;if((l=this._project(a[0],a[1],i,r))&&a.unshift(l[0],l[1]),(l=this._project(a[a.length-2],a[a.length-1],o,s))&&a.push(l[0],l[1]),a=this._clipFinite(n,a))for(let u=0,f=a.length,c,h=this._edgecode(a[f-2],a[f-1]);u<f;u+=2)c=h,h=this._edgecode(a[u],a[u+1]),c&&h&&(u=this._edge(n,c,h,a,u),f=a.length);else this.contains(n,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(n,e,i,r,o){for(;e!==i;){let s,a;switch(e){case 5:e=4;continue;case 4:e=6,s=this.xmax,a=this.ymin;break;case 6:e=2;continue;case 2:e=10,s=this.xmax,a=this.ymax;break;case 10:e=8;continue;case 8:e=9,s=this.xmin,a=this.ymax;break;case 9:e=1;continue;case 1:e=5,s=this.xmin,a=this.ymin;break}(r[o]!==s||r[o+1]!==a)&&this.contains(n,s,a)&&(r.splice(o,0,s,a),o+=2)}return o}_project(n,e,i,r){let o=1/0,s,a,l;if(r<0){if(e<=this.ymin)return null;(s=(this.ymin-e)/r)<o&&(l=this.ymin,a=n+(o=s)*i)}else if(r>0){if(e>=this.ymax)return null;(s=(this.ymax-e)/r)<o&&(l=this.ymax,a=n+(o=s)*i)}if(i>0){if(n>=this.xmax)return null;(s=(this.xmax-n)/i)<o&&(a=this.xmax,l=e+(o=s)*r)}else if(i<0){if(n<=this.xmin)return null;(s=(this.xmin-n)/i)<o&&(a=this.xmin,l=e+(o=s)*r)}return[a,l]}_edgecode(n,e){return(n===this.xmin?1:n===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(n,e){return(n<this.xmin?1:n>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}_simplify(n){if(n&&n.length>4){for(let e=0;e<n.length;e+=2){const i=(e+2)%n.length,r=(e+4)%n.length;(n[e]===n[i]&&n[i]===n[r]||n[e+1]===n[i+1]&&n[i+1]===n[r+1])&&(n.splice(i,2),e-=2)}n.length||(n=null)}return n}}const of=2*Math.PI,Wt=Math.pow;function sf(t){return t[0]}function af(t){return t[1]}function lf(t){const{triangles:n,coords:e}=t;for(let i=0;i<n.length;i+=3){const r=2*n[i],o=2*n[i+1],s=2*n[i+2];if((e[s]-e[r])*(e[o+1]-e[r+1])-(e[o]-e[r])*(e[s+1]-e[r+1])>1e-10)return!1}return!0}function uf(t,n,e){return[t+Math.sin(t+n)*e,n+Math.cos(t-n)*e]}class Ki{static from(n,e=sf,i=af,r){return new Ki("length"in n?cf(n,e,i,r):Float64Array.from(ff(n,e,i,r)))}constructor(n){this._delaunator=new ce(n),this.inedges=new Int32Array(n.length/2),this._hullIndex=new Int32Array(n.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const n=this._delaunator,e=this.points;if(n.hull&&n.hull.length>2&&lf(n)){this.collinear=Int32Array.from({length:e.length/2},(h,d)=>d).sort((h,d)=>e[2*h]-e[2*d]||e[2*h+1]-e[2*d+1]);const l=this.collinear[0],u=this.collinear[this.collinear.length-1],f=[e[2*l],e[2*l+1],e[2*u],e[2*u+1]],c=1e-8*Math.hypot(f[3]-f[1],f[2]-f[0]);for(let h=0,d=e.length/2;h<d;++h){const g=uf(e[2*h],e[2*h+1],c);e[2*h]=g[0],e[2*h+1]=g[1]}this._delaunator=new ce(e)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,o=this.triangles=this._delaunator.triangles,s=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let l=0,u=i.length;l<u;++l){const f=o[l%3===2?l-2:l+1];(i[l]===-1||s[f]===-1)&&(s[f]=l)}for(let l=0,u=r.length;l<u;++l)a[r[l]]=l;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],s[r[0]]=1,r.length===2&&(s[r[1]]=0,this.triangles[1]=r[1],this.triangles[2]=r[1]))}voronoi(n){return new rf(this,n)}*neighbors(n){const{inedges:e,hull:i,_hullIndex:r,halfedges:o,triangles:s,collinear:a}=this;if(a){const c=a.indexOf(n);c>0&&(yield a[c-1]),c<a.length-1&&(yield a[c+1]);return}const l=e[n];if(l===-1)return;let u=l,f=-1;do{if(yield f=s[u],u=u%3===2?u-2:u+1,s[u]!==n)return;if(u=o[u],u===-1){const c=i[(r[n]+1)%i.length];c!==f&&(yield c);return}}while(u!==l)}find(n,e,i=0){if(n=+n,n!==n||(e=+e,e!==e))return-1;const r=i;let o;for(;(o=this._step(i,n,e))>=0&&o!==i&&o!==r;)i=o;return o}_step(n,e,i){const{inedges:r,hull:o,_hullIndex:s,halfedges:a,triangles:l,points:u}=this;if(r[n]===-1||!u.length)return(n+1)%(u.length>>1);let f=n,c=Wt(e-u[n*2],2)+Wt(i-u[n*2+1],2);const h=r[n];let d=h;do{let g=l[d];const p=Wt(e-u[g*2],2)+Wt(i-u[g*2+1],2);if(p<c&&(c=p,f=g),d=d%3===2?d-2:d+1,l[d]!==n)break;if(d=a[d],d===-1){if(d=o[(s[n]+1)%o.length],d!==g&&Wt(e-u[d*2],2)+Wt(i-u[d*2+1],2)<c)return d;break}}while(d!==h);return f}render(n){const e=n==null?n=new Yt:void 0,{points:i,halfedges:r,triangles:o}=this;for(let s=0,a=r.length;s<a;++s){const l=r[s];if(l<s)continue;const u=o[s]*2,f=o[l]*2;n.moveTo(i[u],i[u+1]),n.lineTo(i[f],i[f+1])}return this.renderHull(n),e&&e.value()}renderPoints(n,e){e===void 0&&(!n||typeof n.moveTo!="function")&&(e=n,n=null),e=e==null?2:+e;const i=n==null?n=new Yt:void 0,{points:r}=this;for(let o=0,s=r.length;o<s;o+=2){const a=r[o],l=r[o+1];n.moveTo(a+e,l),n.arc(a,l,e,0,of)}return i&&i.value()}renderHull(n){const e=n==null?n=new Yt:void 0,{hull:i,points:r}=this,o=i[0]*2,s=i.length;n.moveTo(r[o],r[o+1]);for(let a=1;a<s;++a){const l=2*i[a];n.lineTo(r[l],r[l+1])}return n.closePath(),e&&e.value()}hullPolygon(){const n=new ci;return this.renderHull(n),n.value()}renderTriangle(n,e){const i=e==null?e=new Yt:void 0,{points:r,triangles:o}=this,s=o[n*=3]*2,a=o[n+1]*2,l=o[n+2]*2;return e.moveTo(r[s],r[s+1]),e.lineTo(r[a],r[a+1]),e.lineTo(r[l],r[l+1]),e.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:n}=this;for(let e=0,i=n.length/3;e<i;++e)yield this.trianglePolygon(e)}trianglePolygon(n){const e=new ci;return this.renderTriangle(n,e),e.value()}}function cf(t,n,e,i){const r=t.length,o=new Float64Array(r*2);for(let s=0;s<r;++s){const a=t[s];o[s*2]=n.call(i,a,s,t),o[s*2+1]=e.call(i,a,s,t)}return o}function*ff(t,n,e,i){let r=0;for(const o of t)yield n.call(i,o,r,t),yield e.call(i,o,r,t),++r}function hf(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function fe(t,n){if((e=(t=n?t.toExponential(n-1):t.toExponential()).indexOf("e"))<0)return null;var e,i=t.slice(0,e);return[i.length>1?i[0]+i.slice(2):i,+t.slice(e+1)]}function df(t){return t=fe(Math.abs(t)),t?t[1]:NaN}function gf(t,n){return function(e,i){for(var r=e.length,o=[],s=0,a=t[0],l=0;r>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),o.push(e.substring(r-=a,r+a)),!((l+=a+1)>i));)a=t[s=(s+1)%t.length];return o.reverse().join(n)}}function pf(t){return function(n){return n.replace(/[0-9]/g,function(e){return t[+e]})}}var mf=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function fi(t){if(!(n=mf.exec(t)))throw new Error("invalid format: "+t);var n;return new ji({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}fi.prototype=ji.prototype;function ji(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}ji.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function yf(t){t:for(var n=t.length,e=1,i=-1,r;e<n;++e)switch(t[e]){case".":i=r=e;break;case"0":i===0&&(i=e),r=e;break;default:if(!+t[e])break t;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(r+1):t}var is;function vf(t,n){var e=fe(t,n);if(!e)return t+"";var i=e[0],r=e[1],o=r-(is=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,s=i.length;return o===s?i:o>s?i+new Array(o-s+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+fe(t,Math.max(0,n+o-1))[0]}function Pr(t,n){var e=fe(t,n);if(!e)return t+"";var i=e[0],r=e[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const kr={"%":(t,n)=>(t*100).toFixed(n),b:t=>Math.round(t).toString(2),c:t=>t+"",d:hf,e:(t,n)=>t.toExponential(n),f:(t,n)=>t.toFixed(n),g:(t,n)=>t.toPrecision(n),o:t=>Math.round(t).toString(8),p:(t,n)=>Pr(t*100,n),r:Pr,s:vf,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Cr(t){return t}var Rr=Array.prototype.map,Lr=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function _f(t){var n=t.grouping===void 0||t.thousands===void 0?Cr:gf(Rr.call(t.grouping,Number),t.thousands+""),e=t.currency===void 0?"":t.currency[0]+"",i=t.currency===void 0?"":t.currency[1]+"",r=t.decimal===void 0?".":t.decimal+"",o=t.numerals===void 0?Cr:pf(Rr.call(t.numerals,String)),s=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"":t.minus+"",l=t.nan===void 0?"NaN":t.nan+"";function u(c){c=fi(c);var h=c.fill,d=c.align,g=c.sign,p=c.symbol,M=c.zero,m=c.width,E=c.comma,x=c.precision,w=c.trim,b=c.type;b==="n"?(E=!0,b="g"):kr[b]||(x===void 0&&(x=12),w=!0,b="g"),(M||h==="0"&&d==="=")&&(M=!0,h="0",d="=");var $=p==="$"?e:p==="#"&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",T=p==="$"?i:/[%p]/.test(b)?s:"",N=kr[b],I=/[defgprs%]/.test(b);x=x===void 0?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,x)):Math.max(0,Math.min(20,x));function P(S){var L=$,R=T,y,v,_;if(b==="c")R=N(S)+R,S="";else{S=+S;var A=S<0||1/S<0;if(S=isNaN(S)?l:N(Math.abs(S),x),w&&(S=yf(S)),A&&+S==0&&g!=="+"&&(A=!1),L=(A?g==="("?g:a:g==="-"||g==="("?"":g)+L,R=(b==="s"?Lr[8+is/3]:"")+R+(A&&g==="("?")":""),I){for(y=-1,v=S.length;++y<v;)if(_=S.charCodeAt(y),48>_||_>57){R=(_===46?r+S.slice(y+1):S.slice(y))+R,S=S.slice(0,y);break}}}E&&!M&&(S=n(S,1/0));var C=L.length+S.length+R.length,k=C<m?new Array(m-C+1).join(h):"";switch(E&&M&&(S=n(k+S,k.length?m-R.length:1/0),k=""),d){case"<":S=L+S+R+k;break;case"=":S=L+k+S+R;break;case"^":S=k.slice(0,C=k.length>>1)+L+S+R+k.slice(C);break;default:S=k+L+S+R;break}return o(S)}return P.toString=function(){return c+""},P}function f(c,h){var d=u((c=fi(c),c.type="f",c)),g=Math.max(-8,Math.min(8,Math.floor(df(h)/3)))*3,p=Math.pow(10,-g),M=Lr[8+g/3];return function(m){return d(p*m)+M}}return{format:u,formatPrefix:f}}var qn,rs;wf({thousands:",",grouping:[3],currency:["$",""]});function wf(t){return qn=_f(t),rs=qn.format,qn.formatPrefix,qn}var q=1e-6,hi=1e-12,G=Math.PI,Z=G/2,Dr=G/4,ut=G*2,tt=180/G,B=G/180,H=Math.abs,ze=Math.atan,Lt=Math.atan2,F=Math.cos,Gn=Math.ceil,os=Math.exp,di=Math.hypot,ss=Math.log,z=Math.sin,Mf=Math.sign||function(t){return t>0?1:t<0?-1:0},At=Math.sqrt,as=Math.tan;function xf(t){return t>1?0:t<-1?G:Math.acos(t)}function Dt(t){return t>1?Z:t<-1?-Z:Math.asin(t)}function K(){}function he(t,n){t&&Or.hasOwnProperty(t.type)&&Or[t.type](t,n)}var zr={Feature:function(t,n){he(t.geometry,n)},FeatureCollection:function(t,n){for(var e=t.features,i=-1,r=e.length;++i<r;)he(e[i].geometry,n)}},Or={Sphere:function(t,n){n.sphere()},Point:function(t,n){t=t.coordinates,n.point(t[0],t[1],t[2])},MultiPoint:function(t,n){for(var e=t.coordinates,i=-1,r=e.length;++i<r;)t=e[i],n.point(t[0],t[1],t[2])},LineString:function(t,n){gi(t.coordinates,n,0)},MultiLineString:function(t,n){for(var e=t.coordinates,i=-1,r=e.length;++i<r;)gi(e[i],n,0)},Polygon:function(t,n){Fr(t.coordinates,n)},MultiPolygon:function(t,n){for(var e=t.coordinates,i=-1,r=e.length;++i<r;)Fr(e[i],n)},GeometryCollection:function(t,n){for(var e=t.geometries,i=-1,r=e.length;++i<r;)he(e[i],n)}};function gi(t,n,e){var i=-1,r=t.length-e,o;for(n.lineStart();++i<r;)o=t[i],n.point(o[0],o[1],o[2]);n.lineEnd()}function Fr(t,n){var e=-1,i=t.length;for(n.polygonStart();++e<i;)gi(t[e],n,1);n.polygonEnd()}function Ft(t,n){t&&zr.hasOwnProperty(t.type)?zr[t.type](t,n):he(t,n)}function pi(t){return[Lt(t[1],t[0]),Dt(t[2])]}function on(t){var n=t[0],e=t[1],i=F(e);return[i*F(n),i*z(n),z(e)]}function Bn(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function de(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]}function je(t,n){t[0]+=n[0],t[1]+=n[1],t[2]+=n[2]}function Yn(t,n){return[t[0]*n,t[1]*n,t[2]*n]}function mi(t){var n=At(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=n,t[1]/=n,t[2]/=n}var mn,ge,pe,me,ye,ve,_e,we,yi,vi,_i,ls,us,nt,et,it,yt={sphere:K,point:Wi,lineStart:qr,lineEnd:Gr,polygonStart:function(){yt.lineStart=bf,yt.lineEnd=If},polygonEnd:function(){yt.lineStart=qr,yt.lineEnd=Gr}};function Wi(t,n){t*=B,n*=B;var e=F(n);Cn(e*F(t),e*z(t),z(n))}function Cn(t,n,e){++mn,pe+=(t-pe)/mn,me+=(n-me)/mn,ye+=(e-ye)/mn}function qr(){yt.point=Sf}function Sf(t,n){t*=B,n*=B;var e=F(n);nt=e*F(t),et=e*z(t),it=z(n),yt.point=Ef,Cn(nt,et,it)}function Ef(t,n){t*=B,n*=B;var e=F(n),i=e*F(t),r=e*z(t),o=z(n),s=Lt(At((s=et*o-it*r)*s+(s=it*i-nt*o)*s+(s=nt*r-et*i)*s),nt*i+et*r+it*o);ge+=s,ve+=s*(nt+(nt=i)),_e+=s*(et+(et=r)),we+=s*(it+(it=o)),Cn(nt,et,it)}function Gr(){yt.point=Wi}function bf(){yt.point=Af}function If(){cs(ls,us),yt.point=Wi}function Af(t,n){ls=t,us=n,t*=B,n*=B,yt.point=cs;var e=F(n);nt=e*F(t),et=e*z(t),it=z(n),Cn(nt,et,it)}function cs(t,n){t*=B,n*=B;var e=F(n),i=e*F(t),r=e*z(t),o=z(n),s=et*o-it*r,a=it*i-nt*o,l=nt*r-et*i,u=di(s,a,l),f=Dt(u),c=u&&-f/u;yi.add(c*s),vi.add(c*a),_i.add(c*l),ge+=f,ve+=f*(nt+(nt=i)),_e+=f*(et+(et=r)),we+=f*(it+(it=o)),Cn(nt,et,it)}function Br(t){mn=ge=pe=me=ye=ve=_e=we=0,yi=new vt,vi=new vt,_i=new vt,Ft(t,yt);var n=+yi,e=+vi,i=+_i,r=di(n,e,i);return r<hi&&(n=ve,e=_e,i=we,ge<q&&(n=pe,e=me,i=ye),r=di(n,e,i),r<hi)?[NaN,NaN]:[Lt(e,n)*tt,Dt(i/r)*tt]}function wi(t,n){function e(i,r){return i=t(i,r),n(i[0],i[1])}return t.invert&&n.invert&&(e.invert=function(i,r){return i=n.invert(i,r),i&&t.invert(i[0],i[1])}),e}function Mi(t,n){return H(t)>G&&(t-=Math.round(t/ut)*ut),[t,n]}Mi.invert=Mi;function fs(t,n,e){return(t%=ut)?n||e?wi(Hr(t),Xr(n,e)):Hr(t):n||e?Xr(n,e):Mi}function Yr(t){return function(n,e){return n+=t,H(n)>G&&(n-=Math.round(n/ut)*ut),[n,e]}}function Hr(t){var n=Yr(t);return n.invert=Yr(-t),n}function Xr(t,n){var e=F(t),i=z(t),r=F(n),o=z(n);function s(a,l){var u=F(l),f=F(a)*u,c=z(a)*u,h=z(l),d=h*e+f*i;return[Lt(c*r-d*o,f*e-h*i),Dt(d*r+c*o)]}return s.invert=function(a,l){var u=F(l),f=F(a)*u,c=z(a)*u,h=z(l),d=h*r-c*o;return[Lt(c*r+h*o,f*e+d*i),Dt(d*e-f*i)]},s}function Me(t){t=fs(t[0]*B,t[1]*B,t.length>2?t[2]*B:0);function n(e){return e=t(e[0]*B,e[1]*B),e[0]*=tt,e[1]*=tt,e}return n.invert=function(e){return e=t.invert(e[0]*B,e[1]*B),e[0]*=tt,e[1]*=tt,e},n}function $f(t,n,e,i,r,o){if(e){var s=F(n),a=z(n),l=i*e;r==null?(r=n+i*ut,o=n-l/2):(r=Ur(s,r),o=Ur(s,o),(i>0?r<o:r>o)&&(r+=i*ut));for(var u,f=r;i>0?f>o:f<o;f-=l)u=pi([s,-a*F(f),-a*z(f)]),t.point(u[0],u[1])}}function Ur(t,n){n=on(n),n[0]-=t,mi(n);var e=xf(-n[1]);return((-n[2]<0?-e:e)+ut-q)%ut}function hs(){var t=[],n;return{point:function(e,i,r){n.push([e,i,r])},lineStart:function(){t.push(n=[])},lineEnd:K,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var e=t;return t=[],n=null,e}}}function Zn(t,n){return H(t[0]-n[0])<q&&H(t[1]-n[1])<q}function Hn(t,n,e,i){this.x=t,this.z=n,this.o=e,this.e=i,this.v=!1,this.n=this.p=null}function ds(t,n,e,i,r){var o=[],s=[],a,l;if(t.forEach(function(g){if(!((p=g.length-1)<=0)){var p,M=g[0],m=g[p],E;if(Zn(M,m)){if(!M[2]&&!m[2]){for(r.lineStart(),a=0;a<p;++a)r.point((M=g[a])[0],M[1]);r.lineEnd();return}m[0]+=2*q}o.push(E=new Hn(M,g,null,!0)),s.push(E.o=new Hn(M,null,E,!1)),o.push(E=new Hn(m,g,null,!1)),s.push(E.o=new Hn(m,null,E,!0))}}),!!o.length){for(s.sort(n),Vr(o),Vr(s),a=0,l=s.length;a<l;++a)s[a].e=e=!e;for(var u=o[0],f,c;;){for(var h=u,d=!0;h.v;)if((h=h.n)===u)return;f=h.z,r.lineStart();do{if(h.v=h.o.v=!0,h.e){if(d)for(a=0,l=f.length;a<l;++a)r.point((c=f[a])[0],c[1]);else i(h.x,h.n.x,1,r);h=h.n}else{if(d)for(f=h.p.z,a=f.length-1;a>=0;--a)r.point((c=f[a])[0],c[1]);else i(h.x,h.p.x,-1,r);h=h.p}h=h.o,f=h.z,d=!d}while(!h.v);r.lineEnd()}}}function Vr(t){if(n=t.length){for(var n,e=0,i=t[0],r;++e<n;)i.n=r=t[e],r.p=i,i=r;i.n=r=t[0],r.p=i}}function We(t){return H(t[0])<=G?t[0]:Mf(t[0])*((H(t[0])+G)%ut-G)}function Tf(t,n){var e=We(n),i=n[1],r=z(i),o=[z(e),-F(e),0],s=0,a=0,l=new vt;r===1?i=Z+q:r===-1&&(i=-Z-q);for(var u=0,f=t.length;u<f;++u)if(h=(c=t[u]).length)for(var c,h,d=c[h-1],g=We(d),p=d[1]/2+Dr,M=z(p),m=F(p),E=0;E<h;++E,g=w,M=$,m=T,d=x){var x=c[E],w=We(x),b=x[1]/2+Dr,$=z(b),T=F(b),N=w-g,I=N>=0?1:-1,P=I*N,S=P>G,L=M*$;if(l.add(Lt(L*I*z(P),m*T+L*F(P))),s+=S?N+I*ut:N,S^g>=e^w>=e){var R=de(on(d),on(x));mi(R);var y=de(o,R);mi(y);var v=(S^N>=0?-1:1)*Dt(y[2]);(i>v||i===v&&(R[0]||R[1]))&&(a+=S^N>=0?1:-1)}}return(s<-q||s<q&&l<-hi)^a&1}function gs(t,n,e,i){return function(r){var o=n(r),s=hs(),a=n(s),l=!1,u,f,c,h={point:d,lineStart:p,lineEnd:M,polygonStart:function(){h.point=m,h.lineStart=E,h.lineEnd=x,f=[],u=[]},polygonEnd:function(){h.point=d,h.lineStart=p,h.lineEnd=M,f=$o(f);var w=Tf(u,i);f.length?(l||(r.polygonStart(),l=!0),ds(f,Pf,w,e,r)):w&&(l||(r.polygonStart(),l=!0),r.lineStart(),e(null,null,1,r),r.lineEnd()),l&&(r.polygonEnd(),l=!1),f=u=null},sphere:function(){r.polygonStart(),r.lineStart(),e(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function d(w,b){t(w,b)&&r.point(w,b)}function g(w,b){o.point(w,b)}function p(){h.point=g,o.lineStart()}function M(){h.point=d,o.lineEnd()}function m(w,b){c.push([w,b]),a.point(w,b)}function E(){a.lineStart(),c=[]}function x(){m(c[0][0],c[0][1]),a.lineEnd();var w=a.clean(),b=s.result(),$,T=b.length,N,I,P;if(c.pop(),u.push(c),c=null,!!T){if(w&1){if(I=b[0],(N=I.length-1)>0){for(l||(r.polygonStart(),l=!0),r.lineStart(),$=0;$<N;++$)r.point((P=I[$])[0],P[1]);r.lineEnd()}return}T>1&&w&2&&b.push(b.pop().concat(b.shift())),f.push(b.filter(Nf))}}return h}}function Nf(t){return t.length>1}function Pf(t,n){return((t=t.x)[0]<0?t[1]-Z-q:Z-t[1])-((n=n.x)[0]<0?n[1]-Z-q:Z-n[1])}const Kr=gs(function(){return!0},kf,Rf,[-G,-Z]);function kf(t){var n=NaN,e=NaN,i=NaN,r;return{lineStart:function(){t.lineStart(),r=1},point:function(o,s){var a=o>0?G:-G,l=H(o-n);H(l-G)<q?(t.point(n,e=(e+s)/2>0?Z:-Z),t.point(i,e),t.lineEnd(),t.lineStart(),t.point(a,e),t.point(o,e),r=0):i!==a&&l>=G&&(H(n-i)<q&&(n-=i*q),H(o-a)<q&&(o-=a*q),e=Cf(n,e,o,s),t.point(i,e),t.lineEnd(),t.lineStart(),t.point(a,e),r=0),t.point(n=o,e=s),i=a},lineEnd:function(){t.lineEnd(),n=e=NaN},clean:function(){return 2-r}}}function Cf(t,n,e,i){var r,o,s=z(t-e);return H(s)>q?ze((z(n)*(o=F(i))*z(e)-z(i)*(r=F(n))*z(t))/(r*o*s)):(n+i)/2}function Rf(t,n,e,i){var r;if(t==null)r=e*Z,i.point(-G,r),i.point(0,r),i.point(G,r),i.point(G,0),i.point(G,-r),i.point(0,-r),i.point(-G,-r),i.point(-G,0),i.point(-G,r);else if(H(t[0]-n[0])>q){var o=t[0]<n[0]?G:-G;r=e*o/2,i.point(-o,r),i.point(0,r),i.point(o,r)}else i.point(n[0],n[1])}function Lf(t){var n=F(t),e=2*B,i=n>0,r=H(n)>q;function o(f,c,h,d){$f(d,t,e,h,f,c)}function s(f,c){return F(f)*F(c)>n}function a(f){var c,h,d,g,p;return{lineStart:function(){g=d=!1,p=1},point:function(M,m){var E=[M,m],x,w=s(M,m),b=i?w?0:u(M,m):w?u(M+(M<0?G:-G),m):0;if(!c&&(g=d=w)&&f.lineStart(),w!==d&&(x=l(c,E),(!x||Zn(c,x)||Zn(E,x))&&(E[2]=1)),w!==d)p=0,w?(f.lineStart(),x=l(E,c),f.point(x[0],x[1])):(x=l(c,E),f.point(x[0],x[1],2),f.lineEnd()),c=x;else if(r&&c&&i^w){var $;!(b&h)&&($=l(E,c,!0))&&(p=0,i?(f.lineStart(),f.point($[0][0],$[0][1]),f.point($[1][0],$[1][1]),f.lineEnd()):(f.point($[1][0],$[1][1]),f.lineEnd(),f.lineStart(),f.point($[0][0],$[0][1],3)))}w&&(!c||!Zn(c,E))&&f.point(E[0],E[1]),c=E,d=w,h=b},lineEnd:function(){d&&f.lineEnd(),c=null},clean:function(){return p|(g&&d)<<1}}}function l(f,c,h){var d=on(f),g=on(c),p=[1,0,0],M=de(d,g),m=Bn(M,M),E=M[0],x=m-E*E;if(!x)return!h&&f;var w=n*m/x,b=-n*E/x,$=de(p,M),T=Yn(p,w),N=Yn(M,b);je(T,N);var I=$,P=Bn(T,I),S=Bn(I,I),L=P*P-S*(Bn(T,T)-1);if(!(L<0)){var R=At(L),y=Yn(I,(-P-R)/S);if(je(y,T),y=pi(y),!h)return y;var v=f[0],_=c[0],A=f[1],C=c[1],k;_<v&&(k=v,v=_,_=k);var D=_-v,O=H(D-G)<q,Y=O||D<q;if(!O&&C<A&&(k=A,A=C,C=k),Y?O?A+C>0^y[1]<(H(y[0]-v)<q?A:C):A<=y[1]&&y[1]<=C:D>G^(v<=y[0]&&y[0]<=_)){var V=Yn(I,(-P+R)/S);return je(V,T),[y,pi(V)]}}}function u(f,c){var h=i?t:G-t,d=0;return f<-h?d|=1:f>h&&(d|=2),c<-h?d|=4:c>h&&(d|=8),d}return gs(s,a,o,i?[0,-t]:[-G,t-G])}function Df(t,n,e,i,r,o){var s=t[0],a=t[1],l=n[0],u=n[1],f=0,c=1,h=l-s,d=u-a,g;if(g=e-s,!(!h&&g>0)){if(g/=h,h<0){if(g<f)return;g<c&&(c=g)}else if(h>0){if(g>c)return;g>f&&(f=g)}if(g=r-s,!(!h&&g<0)){if(g/=h,h<0){if(g>c)return;g>f&&(f=g)}else if(h>0){if(g<f)return;g<c&&(c=g)}if(g=i-a,!(!d&&g>0)){if(g/=d,d<0){if(g<f)return;g<c&&(c=g)}else if(d>0){if(g>c)return;g>f&&(f=g)}if(g=o-a,!(!d&&g<0)){if(g/=d,d<0){if(g>c)return;g>f&&(f=g)}else if(d>0){if(g<f)return;g<c&&(c=g)}return f>0&&(t[0]=s+f*h,t[1]=a+f*d),c<1&&(n[0]=s+c*h,n[1]=a+c*d),!0}}}}}var yn=1e9,Xn=-yn;function zf(t,n,e,i){function r(u,f){return t<=u&&u<=e&&n<=f&&f<=i}function o(u,f,c,h){var d=0,g=0;if(u==null||(d=s(u,c))!==(g=s(f,c))||l(u,f)<0^c>0)do h.point(d===0||d===3?t:e,d>1?i:n);while((d=(d+c+4)%4)!==g);else h.point(f[0],f[1])}function s(u,f){return H(u[0]-t)<q?f>0?0:3:H(u[0]-e)<q?f>0?2:1:H(u[1]-n)<q?f>0?1:0:f>0?3:2}function a(u,f){return l(u.x,f.x)}function l(u,f){var c=s(u,1),h=s(f,1);return c!==h?c-h:c===0?f[1]-u[1]:c===1?u[0]-f[0]:c===2?u[1]-f[1]:f[0]-u[0]}return function(u){var f=u,c=hs(),h,d,g,p,M,m,E,x,w,b,$,T={point:N,lineStart:L,lineEnd:R,polygonStart:P,polygonEnd:S};function N(v,_){r(v,_)&&f.point(v,_)}function I(){for(var v=0,_=0,A=d.length;_<A;++_)for(var C=d[_],k=1,D=C.length,O=C[0],Y,V,U=O[0],j=O[1];k<D;++k)Y=U,V=j,O=C[k],U=O[0],j=O[1],V<=i?j>i&&(U-Y)*(i-V)>(j-V)*(t-Y)&&++v:j<=i&&(U-Y)*(i-V)<(j-V)*(t-Y)&&--v;return v}function P(){f=c,h=[],d=[],$=!0}function S(){var v=I(),_=$&&v,A=(h=$o(h)).length;(_||A)&&(u.polygonStart(),_&&(u.lineStart(),o(null,null,1,u),u.lineEnd()),A&&ds(h,a,v,o,u),u.polygonEnd()),f=u,h=d=g=null}function L(){T.point=y,d&&d.push(g=[]),b=!0,w=!1,E=x=NaN}function R(){h&&(y(p,M),m&&w&&c.rejoin(),h.push(c.result())),T.point=N,w&&f.lineEnd()}function y(v,_){var A=r(v,_);if(d&&g.push([v,_]),b)p=v,M=_,m=A,b=!1,A&&(f.lineStart(),f.point(v,_));else if(A&&w)f.point(v,_);else{var C=[E=Math.max(Xn,Math.min(yn,E)),x=Math.max(Xn,Math.min(yn,x))],k=[v=Math.max(Xn,Math.min(yn,v)),_=Math.max(Xn,Math.min(yn,_))];Df(C,k,t,n,e,i)?(w||(f.lineStart(),f.point(C[0],C[1])),f.point(k[0],k[1]),A||f.lineEnd(),$=!1):A&&(f.lineStart(),f.point(v,_),$=!1)}E=v,x=_,w=A}return T}}var xi,Si,Jn,te,sn={sphere:K,point:K,lineStart:Of,lineEnd:K,polygonStart:K,polygonEnd:K};function Of(){sn.point=qf,sn.lineEnd=Ff}function Ff(){sn.point=sn.lineEnd=K}function qf(t,n){t*=B,n*=B,Si=t,Jn=z(n),te=F(n),sn.point=Gf}function Gf(t,n){t*=B,n*=B;var e=z(n),i=F(n),r=H(t-Si),o=F(r),s=z(r),a=i*s,l=te*e-Jn*i*o,u=Jn*e+te*i*o;xi.add(Lt(At(a*a+l*l),u)),Si=t,Jn=e,te=i}function Bf(t){return xi=new vt,Ft(t,sn),+xi}var Ei=[null,null],Yf={type:"LineString",coordinates:Ei};function xe(t,n){return Ei[0]=t,Ei[1]=n,Bf(Yf)}function jr(t,n,e){var i=Qt(t,n-q,e).concat(n);return function(r){return i.map(function(o){return[r,o]})}}function Wr(t,n,e){var i=Qt(t,n-q,e).concat(n);return function(r){return i.map(function(o){return[o,r]})}}function Hf(){var t,n,e,i,r,o,s,a,l=10,u=l,f=90,c=360,h,d,g,p,M=2.5;function m(){return{type:"MultiLineString",coordinates:E()}}function E(){return Qt(Gn(i/f)*f,e,f).map(g).concat(Qt(Gn(a/c)*c,s,c).map(p)).concat(Qt(Gn(n/l)*l,t,l).filter(function(x){return H(x%f)>q}).map(h)).concat(Qt(Gn(o/u)*u,r,u).filter(function(x){return H(x%c)>q}).map(d))}return m.lines=function(){return E().map(function(x){return{type:"LineString",coordinates:x}})},m.outline=function(){return{type:"Polygon",coordinates:[g(i).concat(p(s).slice(1),g(e).reverse().slice(1),p(a).reverse().slice(1))]}},m.extent=function(x){return arguments.length?m.extentMajor(x).extentMinor(x):m.extentMinor()},m.extentMajor=function(x){return arguments.length?(i=+x[0][0],e=+x[1][0],a=+x[0][1],s=+x[1][1],i>e&&(x=i,i=e,e=x),a>s&&(x=a,a=s,s=x),m.precision(M)):[[i,a],[e,s]]},m.extentMinor=function(x){return arguments.length?(n=+x[0][0],t=+x[1][0],o=+x[0][1],r=+x[1][1],n>t&&(x=n,n=t,t=x),o>r&&(x=o,o=r,r=x),m.precision(M)):[[n,o],[t,r]]},m.step=function(x){return arguments.length?m.stepMajor(x).stepMinor(x):m.stepMinor()},m.stepMajor=function(x){return arguments.length?(f=+x[0],c=+x[1],m):[f,c]},m.stepMinor=function(x){return arguments.length?(l=+x[0],u=+x[1],m):[l,u]},m.precision=function(x){return arguments.length?(M=+x,h=jr(o,r,90),d=Wr(n,t,M),g=jr(a,s,90),p=Wr(i,e,M),m):M},m.extentMajor([[-180,-90+q],[180,90-q]]).extentMinor([[-180,-80-q],[180,80+q]])}const bi=t=>t;var Qe=new vt,Ii=new vt,ps,ms,Ai,$i,Pt={point:K,lineStart:K,lineEnd:K,polygonStart:function(){Pt.lineStart=Xf,Pt.lineEnd=Vf},polygonEnd:function(){Pt.lineStart=Pt.lineEnd=Pt.point=K,Qe.add(H(Ii)),Ii=new vt},result:function(){var t=Qe/2;return Qe=new vt,t}};function Xf(){Pt.point=Uf}function Uf(t,n){Pt.point=ys,ps=Ai=t,ms=$i=n}function ys(t,n){Ii.add($i*t-Ai*n),Ai=t,$i=n}function Vf(){ys(ps,ms)}var an=1/0,Se=an,$n=-an,Ee=$n,be={point:Kf,lineStart:K,lineEnd:K,polygonStart:K,polygonEnd:K,result:function(){var t=[[an,Se],[$n,Ee]];return $n=Ee=-(Se=an=1/0),t}};function Kf(t,n){t<an&&(an=t),t>$n&&($n=t),n<Se&&(Se=n),n>Ee&&(Ee=n)}var Ti=0,Ni=0,vn=0,Ie=0,Ae=0,Jt=0,Pi=0,ki=0,_n=0,vs,_s,xt,St,ft={point:Kt,lineStart:Qr,lineEnd:Zr,polygonStart:function(){ft.lineStart=Qf,ft.lineEnd=Zf},polygonEnd:function(){ft.point=Kt,ft.lineStart=Qr,ft.lineEnd=Zr},result:function(){var t=_n?[Pi/_n,ki/_n]:Jt?[Ie/Jt,Ae/Jt]:vn?[Ti/vn,Ni/vn]:[NaN,NaN];return Ti=Ni=vn=Ie=Ae=Jt=Pi=ki=_n=0,t}};function Kt(t,n){Ti+=t,Ni+=n,++vn}function Qr(){ft.point=jf}function jf(t,n){ft.point=Wf,Kt(xt=t,St=n)}function Wf(t,n){var e=t-xt,i=n-St,r=At(e*e+i*i);Ie+=r*(xt+t)/2,Ae+=r*(St+n)/2,Jt+=r,Kt(xt=t,St=n)}function Zr(){ft.point=Kt}function Qf(){ft.point=Jf}function Zf(){ws(vs,_s)}function Jf(t,n){ft.point=ws,Kt(vs=xt=t,_s=St=n)}function ws(t,n){var e=t-xt,i=n-St,r=At(e*e+i*i);Ie+=r*(xt+t)/2,Ae+=r*(St+n)/2,Jt+=r,r=St*t-xt*n,Pi+=r*(xt+t),ki+=r*(St+n),_n+=r*3,Kt(xt=t,St=n)}function Ms(t){this._context=t}Ms.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(t,n){switch(this._point){case 0:{this._context.moveTo(t,n),this._point=1;break}case 1:{this._context.lineTo(t,n);break}default:{this._context.moveTo(t+this._radius,n),this._context.arc(t,n,this._radius,0,ut);break}}},result:K};var Ci=new vt,Ze,xs,Ss,wn,Mn,Tn={point:K,lineStart:function(){Tn.point=th},lineEnd:function(){Ze&&Es(xs,Ss),Tn.point=K},polygonStart:function(){Ze=!0},polygonEnd:function(){Ze=null},result:function(){var t=+Ci;return Ci=new vt,t}};function th(t,n){Tn.point=Es,xs=wn=t,Ss=Mn=n}function Es(t,n){wn-=t,Mn-=n,Ci.add(At(wn*wn+Mn*Mn)),wn=t,Mn=n}let Jr,$e,to,no;class eo{constructor(n){this._append=n==null?bs:nh(n),this._radius=4.5,this._=""}pointRadius(n){return this._radius=+n,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(n,e){switch(this._point){case 0:{this._append`M${n},${e}`,this._point=1;break}case 1:{this._append`L${n},${e}`;break}default:{if(this._append`M${n},${e}`,this._radius!==to||this._append!==$e){const i=this._radius,r=this._;this._="",this._append`m0,${i}a${i},${i} 0 1,1 0,${-2*i}a${i},${i} 0 1,1 0,${2*i}z`,to=i,$e=this._append,no=this._,this._=r}this._+=no;break}}}result(){const n=this._;return this._="",n.length?n:null}}function bs(t){let n=1;this._+=t[0];for(const e=t.length;n<e;++n)this._+=arguments[n]+t[n]}function nh(t){const n=Math.floor(t);if(!(n>=0))throw new RangeError(`invalid digits: ${t}`);if(n>15)return bs;if(n!==Jr){const e=10**n;Jr=n,$e=function(r){let o=1;this._+=r[0];for(const s=r.length;o<s;++o)this._+=Math.round(arguments[o]*e)/e+r[o]}}return $e}function Qi(t,n){let e=3,i=4.5,r,o;function s(a){return a&&(typeof i=="function"&&o.pointRadius(+i.apply(this,arguments)),Ft(a,r(o))),o.result()}return s.area=function(a){return Ft(a,r(Pt)),Pt.result()},s.measure=function(a){return Ft(a,r(Tn)),Tn.result()},s.bounds=function(a){return Ft(a,r(be)),be.result()},s.centroid=function(a){return Ft(a,r(ft)),ft.result()},s.projection=function(a){return arguments.length?(r=a==null?(t=null,bi):(t=a).stream,s):t},s.context=function(a){return arguments.length?(o=a==null?(n=null,new eo(e)):new Ms(n=a),typeof i!="function"&&o.pointRadius(i),s):n},s.pointRadius=function(a){return arguments.length?(i=typeof a=="function"?a:(o.pointRadius(+a),+a),s):i},s.digits=function(a){if(!arguments.length)return e;if(a==null)e=null;else{const l=Math.floor(a);if(!(l>=0))throw new RangeError(`invalid digits: ${a}`);e=l}return n===null&&(o=new eo(e)),s},s.projection(t).digits(e).context(n)}function Zi(t){return function(n){var e=new Ri;for(var i in t)e[i]=t[i];return e.stream=n,e}}function Ri(){}Ri.prototype={constructor:Ri,point:function(t,n){this.stream.point(t,n)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Ji(t,n,e){var i=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),i!=null&&t.clipExtent(null),Ft(e,t.stream(be)),n(be.result()),i!=null&&t.clipExtent(i),t}function Is(t,n,e){return Ji(t,function(i){var r=n[1][0]-n[0][0],o=n[1][1]-n[0][1],s=Math.min(r/(i[1][0]-i[0][0]),o/(i[1][1]-i[0][1])),a=+n[0][0]+(r-s*(i[1][0]+i[0][0]))/2,l=+n[0][1]+(o-s*(i[1][1]+i[0][1]))/2;t.scale(150*s).translate([a,l])},e)}function eh(t,n,e){return Is(t,[[0,0],n],e)}function ih(t,n,e){return Ji(t,function(i){var r=+n,o=r/(i[1][0]-i[0][0]),s=(r-o*(i[1][0]+i[0][0]))/2,a=-o*i[0][1];t.scale(150*o).translate([s,a])},e)}function rh(t,n,e){return Ji(t,function(i){var r=+n,o=r/(i[1][1]-i[0][1]),s=-o*i[0][0],a=(r-o*(i[1][1]+i[0][1]))/2;t.scale(150*o).translate([s,a])},e)}var io=16,oh=F(30*B);function ro(t,n){return+n?ah(t,n):sh(t)}function sh(t){return Zi({point:function(n,e){n=t(n,e),this.stream.point(n[0],n[1])}})}function ah(t,n){function e(i,r,o,s,a,l,u,f,c,h,d,g,p,M){var m=u-i,E=f-r,x=m*m+E*E;if(x>4*n&&p--){var w=s+h,b=a+d,$=l+g,T=At(w*w+b*b+$*$),N=Dt($/=T),I=H(H($)-1)<q||H(o-c)<q?(o+c)/2:Lt(b,w),P=t(I,N),S=P[0],L=P[1],R=S-i,y=L-r,v=E*R-m*y;(v*v/x>n||H((m*R+E*y)/x-.5)>.3||s*h+a*d+l*g<oh)&&(e(i,r,o,s,a,l,S,L,I,w/=T,b/=T,$,p,M),M.point(S,L),e(S,L,I,w,b,$,u,f,c,h,d,g,p,M))}}return function(i){var r,o,s,a,l,u,f,c,h,d,g,p,M={point:m,lineStart:E,lineEnd:w,polygonStart:function(){i.polygonStart(),M.lineStart=b},polygonEnd:function(){i.polygonEnd(),M.lineStart=E}};function m(N,I){N=t(N,I),i.point(N[0],N[1])}function E(){c=NaN,M.point=x,i.lineStart()}function x(N,I){var P=on([N,I]),S=t(N,I);e(c,h,f,d,g,p,c=S[0],h=S[1],f=N,d=P[0],g=P[1],p=P[2],io,i),i.point(c,h)}function w(){M.point=m,i.lineEnd()}function b(){E(),M.point=$,M.lineEnd=T}function $(N,I){x(r=N,I),o=c,s=h,a=d,l=g,u=p,M.point=x}function T(){e(c,h,f,d,g,p,o,s,r,a,l,u,io,i),M.lineEnd=w,w()}return M}}var lh=Zi({point:function(t,n){this.stream.point(t*B,n*B)}});function uh(t){return Zi({point:function(n,e){var i=t(n,e);return this.stream.point(i[0],i[1])}})}function ch(t,n,e,i,r){function o(s,a){return s*=i,a*=r,[n+t*s,e-t*a]}return o.invert=function(s,a){return[(s-n)/t*i,(e-a)/t*r]},o}function oo(t,n,e,i,r,o){if(!o)return ch(t,n,e,i,r);var s=F(o),a=z(o),l=s*t,u=a*t,f=s/t,c=a/t,h=(a*e-s*n)/t,d=(a*n+s*e)/t;function g(p,M){return p*=i,M*=r,[l*p-u*M+n,e-u*p-l*M]}return g.invert=function(p,M){return[i*(f*p-c*M+h),r*(d-c*p-f*M)]},g}function tr(t){return fh(function(){return t})()}function fh(t){var n,e=150,i=480,r=250,o=0,s=0,a=0,l=0,u=0,f,c=0,h=1,d=1,g=null,p=Kr,M=null,m,E,x,w=bi,b=.5,$,T,N,I,P;function S(v){return N(v[0]*B,v[1]*B)}function L(v){return v=N.invert(v[0],v[1]),v&&[v[0]*tt,v[1]*tt]}S.stream=function(v){return I&&P===v?I:I=lh(uh(f)(p($(w(P=v)))))},S.preclip=function(v){return arguments.length?(p=v,g=void 0,y()):p},S.postclip=function(v){return arguments.length?(w=v,M=m=E=x=null,y()):w},S.clipAngle=function(v){return arguments.length?(p=+v?Lf(g=v*B):(g=null,Kr),y()):g*tt},S.clipExtent=function(v){return arguments.length?(w=v==null?(M=m=E=x=null,bi):zf(M=+v[0][0],m=+v[0][1],E=+v[1][0],x=+v[1][1]),y()):M==null?null:[[M,m],[E,x]]},S.scale=function(v){return arguments.length?(e=+v,R()):e},S.translate=function(v){return arguments.length?(i=+v[0],r=+v[1],R()):[i,r]},S.center=function(v){return arguments.length?(o=v[0]%360*B,s=v[1]%360*B,R()):[o*tt,s*tt]},S.rotate=function(v){return arguments.length?(a=v[0]%360*B,l=v[1]%360*B,u=v.length>2?v[2]%360*B:0,R()):[a*tt,l*tt,u*tt]},S.angle=function(v){return arguments.length?(c=v%360*B,R()):c*tt},S.reflectX=function(v){return arguments.length?(h=v?-1:1,R()):h<0},S.reflectY=function(v){return arguments.length?(d=v?-1:1,R()):d<0},S.precision=function(v){return arguments.length?($=ro(T,b=v*v),y()):At(b)},S.fitExtent=function(v,_){return Is(S,v,_)},S.fitSize=function(v,_){return eh(S,v,_)},S.fitWidth=function(v,_){return ih(S,v,_)},S.fitHeight=function(v,_){return rh(S,v,_)};function R(){var v=oo(e,0,0,h,d,c).apply(null,n(o,s)),_=oo(e,i-v[0],r-v[1],h,d,c);return f=fs(a,l,u),T=wi(n,_),N=wi(f,T),$=ro(T,b),y()}function y(){return I=P=null,S}return function(){return n=t.apply(this,arguments),S.invert=n.invert&&L,R()}}function As(t){return function(n,e){var i=At(n*n+e*e),r=t(i),o=z(r),s=F(r);return[Lt(n*o,i*s),Dt(i&&e*o/i)]}}function nr(t,n){return[t,ss(as((Z+n)/2))]}nr.invert=function(t,n){return[t,2*ze(os(n))-Z]};function hh(){return $s(nr).scale(961/ut)}function $s(t){var n=tr(t),e=n.center,i=n.scale,r=n.translate,o=n.clipExtent,s=null,a,l,u;n.scale=function(c){return arguments.length?(i(c),f()):i()},n.translate=function(c){return arguments.length?(r(c),f()):r()},n.center=function(c){return arguments.length?(e(c),f()):e()},n.clipExtent=function(c){return arguments.length?(c==null?s=a=l=u=null:(s=+c[0][0],a=+c[0][1],l=+c[1][0],u=+c[1][1]),f()):s==null?null:[[s,a],[l,u]]};function f(){var c=G*i(),h=n(Me(n.rotate()).invert([0,0]));return o(s==null?[[h[0]-c,h[1]-c],[h[0]+c,h[1]+c]]:t===nr?[[Math.max(h[0]-c,s),a],[Math.min(h[0]+c,l),u]]:[[s,Math.max(h[1]-c,a)],[l,Math.min(h[1]+c,u)]])}return f()}function Ts(t,n){return[F(n)*z(t),z(n)]}Ts.invert=As(Dt);function dh(){return tr(Ts).scale(249.5).clipAngle(90+q)}function Ns(t,n){var e=F(n),i=1+F(t)*e;return[e*z(t)/i,z(n)/i]}Ns.invert=As(function(t){return 2*ze(t)});function Ps(){return tr(Ns).scale(250).clipAngle(142)}function ks(t,n){return[ss(as((Z+n)/2)),-t]}ks.invert=function(t,n){return[-n,2*ze(os(t))-Z]};function gh(){var t=$s(ks),n=t.center,e=t.rotate;return t.center=function(i){return arguments.length?n([-i[1],i[0]]):(i=n(),[i[1],-i[0]])},t.rotate=function(i){return arguments.length?e([i[0],i[1],i.length>2?i[2]+90:90]):(i=e(),[i[0],i[1],i[2]-90])},e([0,0,90]).scale(159.155)}const Un=t=>()=>t;function ph(t,{sourceEvent:n,target:e,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},target:{value:e,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function kt(t,n,e){this.k=t,this.x=n,this.y=e}kt.prototype={constructor:kt,scale:function(t){return t===1?this:new kt(this.k*t,this.x,this.y)},translate:function(t,n){return t===0&n===0?this:new kt(this.k,this.x+this.k*t,this.y+this.k*n)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Cs=new kt(1,0,0);kt.prototype;function Je(t){t.stopImmediatePropagation()}function hn(t){t.preventDefault(),t.stopImmediatePropagation()}function mh(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function yh(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function so(){return this.__zoom||Cs}function vh(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function _h(){return navigator.maxTouchPoints||"ontouchstart"in this}function wh(t,n,e){var i=t.invertX(n[0][0])-e[0][0],r=t.invertX(n[1][0])-e[1][0],o=t.invertY(n[0][1])-e[0][1],s=t.invertY(n[1][1])-e[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),s>o?(o+s)/2:Math.min(0,o)||Math.max(0,s))}function Mh(){var t=mh,n=yh,e=wh,i=vh,r=_h,o=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,l=Cu,u=Ce("start","zoom","end"),f,c,h,d=500,g=150,p=0,M=10;function m(y){y.property("__zoom",so).on("wheel.zoom",N,{passive:!1}).on("mousedown.zoom",I).on("dblclick.zoom",P).filter(r).on("touchstart.zoom",S).on("touchmove.zoom",L).on("touchend.zoom touchcancel.zoom",R).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}m.transform=function(y,v,_,A){var C=y.selection?y.selection():y;C.property("__zoom",so),y!==C?b(y,v,_,A):C.interrupt().each(function(){$(this,arguments).event(A).start().zoom(null,typeof v=="function"?v.apply(this,arguments):v).end()})},m.scaleBy=function(y,v,_,A){m.scaleTo(y,function(){var C=this.__zoom.k,k=typeof v=="function"?v.apply(this,arguments):v;return C*k},_,A)},m.scaleTo=function(y,v,_,A){m.transform(y,function(){var C=n.apply(this,arguments),k=this.__zoom,D=_==null?w(C):typeof _=="function"?_.apply(this,arguments):_,O=k.invert(D),Y=typeof v=="function"?v.apply(this,arguments):v;return e(x(E(k,Y),D,O),C,s)},_,A)},m.translateBy=function(y,v,_,A){m.transform(y,function(){return e(this.__zoom.translate(typeof v=="function"?v.apply(this,arguments):v,typeof _=="function"?_.apply(this,arguments):_),n.apply(this,arguments),s)},null,A)},m.translateTo=function(y,v,_,A,C){m.transform(y,function(){var k=n.apply(this,arguments),D=this.__zoom,O=A==null?w(k):typeof A=="function"?A.apply(this,arguments):A;return e(Cs.translate(O[0],O[1]).scale(D.k).translate(typeof v=="function"?-v.apply(this,arguments):-v,typeof _=="function"?-_.apply(this,arguments):-_),k,s)},A,C)};function E(y,v){return v=Math.max(o[0],Math.min(o[1],v)),v===y.k?y:new kt(v,y.x,y.y)}function x(y,v,_){var A=v[0]-_[0]*y.k,C=v[1]-_[1]*y.k;return A===y.x&&C===y.y?y:new kt(y.k,A,C)}function w(y){return[(+y[0][0]+ +y[1][0])/2,(+y[0][1]+ +y[1][1])/2]}function b(y,v,_,A){y.on("start.zoom",function(){$(this,arguments).event(A).start()}).on("interrupt.zoom end.zoom",function(){$(this,arguments).event(A).end()}).tween("zoom",function(){var C=this,k=arguments,D=$(C,k).event(A),O=n.apply(C,k),Y=_==null?w(O):typeof _=="function"?_.apply(C,k):_,V=Math.max(O[1][0]-O[0][0],O[1][1]-O[0][1]),U=C.__zoom,j=typeof v=="function"?v.apply(C,k):v,$t=l(U.invert(Y).concat(V/U.k),j.invert(Y).concat(V/j.k));return function(ht){if(ht===1)ht=j;else{var Tt=$t(ht),Ye=V/Tt[2];ht=new kt(Ye,Y[0]-Tt[0]*Ye,Y[1]-Tt[1]*Ye)}D.zoom(null,ht)}})}function $(y,v,_){return!_&&y.__zooming||new T(y,v)}function T(y,v){this.that=y,this.args=v,this.active=0,this.sourceEvent=null,this.extent=n.apply(y,v),this.taps=0}T.prototype={event:function(y){return y&&(this.sourceEvent=y),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(y,v){return this.mouse&&y!=="mouse"&&(this.mouse[1]=v.invert(this.mouse[0])),this.touch0&&y!=="touch"&&(this.touch0[1]=v.invert(this.touch0[0])),this.touch1&&y!=="touch"&&(this.touch1[1]=v.invert(this.touch1[0])),this.that.__zoom=v,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(y){var v=pt(this.that).datum();u.call(y,this.that,new ph(y,{sourceEvent:this.sourceEvent,target:m,transform:this.that.__zoom,dispatch:u}),v)}};function N(y,...v){if(!t.apply(this,arguments))return;var _=$(this,v).event(y),A=this.__zoom,C=Math.max(o[0],Math.min(o[1],A.k*Math.pow(2,i.apply(this,arguments)))),k=Mt(y);if(_.wheel)(_.mouse[0][0]!==k[0]||_.mouse[0][1]!==k[1])&&(_.mouse[1]=A.invert(_.mouse[0]=k)),clearTimeout(_.wheel);else{if(A.k===C)return;_.mouse=[k,A.invert(k)],Qn(this),_.start()}hn(y),_.wheel=setTimeout(D,g),_.zoom("mouse",e(x(E(A,C),_.mouse[0],_.mouse[1]),_.extent,s));function D(){_.wheel=null,_.end()}}function I(y,...v){if(h||!t.apply(this,arguments))return;var _=y.currentTarget,A=$(this,v,!0).event(y),C=pt(y.view).on("mousemove.zoom",Y,!0).on("mouseup.zoom",V,!0),k=Mt(y,_),D=y.clientX,O=y.clientY;Bo(y.view),Je(y),A.mouse=[k,this.__zoom.invert(k)],Qn(this),A.start();function Y(U){if(hn(U),!A.moved){var j=U.clientX-D,$t=U.clientY-O;A.moved=j*j+$t*$t>p}A.event(U).zoom("mouse",e(x(A.that.__zoom,A.mouse[0]=Mt(U,_),A.mouse[1]),A.extent,s))}function V(U){C.on("mousemove.zoom mouseup.zoom",null),Yo(U.view,A.moved),hn(U),A.event(U).end()}}function P(y,...v){if(t.apply(this,arguments)){var _=this.__zoom,A=Mt(y.changedTouches?y.changedTouches[0]:y,this),C=_.invert(A),k=_.k*(y.shiftKey?.5:2),D=e(x(E(_,k),A,C),n.apply(this,v),s);hn(y),a>0?pt(this).transition().duration(a).call(b,D,A,y):pt(this).call(m.transform,D,A,y)}}function S(y,...v){if(t.apply(this,arguments)){var _=y.touches,A=_.length,C=$(this,v,y.changedTouches.length===A).event(y),k,D,O,Y;for(Je(y),D=0;D<A;++D)O=_[D],Y=Mt(O,this),Y=[Y,this.__zoom.invert(Y),O.identifier],C.touch0?!C.touch1&&C.touch0[2]!==Y[2]&&(C.touch1=Y,C.taps=0):(C.touch0=Y,k=!0,C.taps=1+!!f);f&&(f=clearTimeout(f)),k&&(C.taps<2&&(c=Y[0],f=setTimeout(function(){f=null},d)),Qn(this),C.start())}}function L(y,...v){if(this.__zooming){var _=$(this,v).event(y),A=y.changedTouches,C=A.length,k,D,O,Y;for(hn(y),k=0;k<C;++k)D=A[k],O=Mt(D,this),_.touch0&&_.touch0[2]===D.identifier?_.touch0[0]=O:_.touch1&&_.touch1[2]===D.identifier&&(_.touch1[0]=O);if(D=_.that.__zoom,_.touch1){var V=_.touch0[0],U=_.touch0[1],j=_.touch1[0],$t=_.touch1[1],ht=(ht=j[0]-V[0])*ht+(ht=j[1]-V[1])*ht,Tt=(Tt=$t[0]-U[0])*Tt+(Tt=$t[1]-U[1])*Tt;D=E(D,Math.sqrt(ht/Tt)),O=[(V[0]+j[0])/2,(V[1]+j[1])/2],Y=[(U[0]+$t[0])/2,(U[1]+$t[1])/2]}else if(_.touch0)O=_.touch0[0],Y=_.touch0[1];else return;_.zoom("touch",e(x(D,O,Y),_.extent,s))}}function R(y,...v){if(this.__zooming){var _=$(this,v).event(y),A=y.changedTouches,C=A.length,k,D;for(Je(y),h&&clearTimeout(h),h=setTimeout(function(){h=null},d),k=0;k<C;++k)D=A[k],_.touch0&&_.touch0[2]===D.identifier?delete _.touch0:_.touch1&&_.touch1[2]===D.identifier&&delete _.touch1;if(_.touch1&&!_.touch0&&(_.touch0=_.touch1,delete _.touch1),_.touch0)_.touch0[1]=this.__zoom.invert(_.touch0[0]);else if(_.end(),_.taps===2&&(D=Mt(D,this),Math.hypot(c[0]-D[0],c[1]-D[1])<M)){var O=pt(this).on("dblclick.zoom");O&&O.apply(this,arguments)}}}return m.wheelDelta=function(y){return arguments.length?(i=typeof y=="function"?y:Un(+y),m):i},m.filter=function(y){return arguments.length?(t=typeof y=="function"?y:Un(!!y),m):t},m.touchable=function(y){return arguments.length?(r=typeof y=="function"?y:Un(!!y),m):r},m.extent=function(y){return arguments.length?(n=typeof y=="function"?y:Un([[+y[0][0],+y[0][1]],[+y[1][0],+y[1][1]]]),m):n},m.scaleExtent=function(y){return arguments.length?(o[0]=+y[0],o[1]=+y[1],m):[o[0],o[1]]},m.translateExtent=function(y){return arguments.length?(s[0][0]=+y[0][0],s[1][0]=+y[1][0],s[0][1]=+y[0][1],s[1][1]=+y[1][1],m):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},m.constrain=function(y){return arguments.length?(e=y,m):e},m.duration=function(y){return arguments.length?(a=+y,m):a},m.interpolate=function(y){return arguments.length?(l=y,m):l},m.on=function(){var y=u.on.apply(u,arguments);return y===u?m:y},m.clickDistance=function(y){return arguments.length?(p=(y=+y)*y,m):Math.sqrt(p)},m.tapDistance=function(y){return arguments.length?(M=+y,m):M},m}function Oe(){return{systemMap:new Map,laneMap:new Map,neighborMap:new Map}}function Rs(t,n){t.systemMap.set(n.id,n)}function Li(t,n,e){const i=[n.id,e.id].sort((o,s)=>o.localeCompare(s)).join("-");if(t.laneMap.has(i))return;const r={id:i,fromId:n.id,toId:e.id,movement:[0,0]};t.laneMap.set(i,r)}function Fe(t){const n=new Map;for(const e of t.laneMap.values())n.has(e.fromId)||n.set(e.fromId,[]),n.get(e.fromId)?.push(e.toId),n.has(e.toId)||n.set(e.toId,[]),n.get(e.toId)?.push(e.fromId);t.neighborMap=n}function st(t,n){const e=t.systemMap.get(n);if(!e)return[];(!t.neighborMap||t.neighborMap.size===0)&&Fe(t);const i=t.neighborMap.get(e.id);return i?i.map(r=>t.systemMap.get(r)).filter(r=>!!r):[]}function qe(t,n,e){return t.neighborMap.get(n)?.includes(e)||!1}function Ls(t,n){return er(n,Array.from(t.systemMap.values()))}function er(t,n){if(n.length===0)return null;let e=null,i=1/0;return n.forEach(r=>{if(r.location[0]===t[0]&&r.location[1]===t[1])return;const o=xe(t,r.location);o<i&&(i=o,e=r)}),e}function xh(t){console.log("Loading world from JSON...",t);const n=Oe();return n.systemMap=new Map(t.systems),n.laneMap=new Map(t.lanes),Fe(n),n}function Sh(t){return{systems:Array.from(t.systemMap.entries()),lanes:Array.from(t.laneMap.entries())}}const ao=["Commander","Admiral","Marshal","Commodore","General","Colonel","Warden","Sentinel","Vanguard","Overseer","Legate","Centurion","Praetor","Brigadier","Ambassador","Director","Chancellor","Prefect"],lo=["Raxis","Vex","Thane","Zephyr","Korr","Lyra","Dax","Kael","Nova","Orion","Astra","Cade","Ryker","Vega","Nyx","Crusher","Wheaton","Szilard","Coloma"];function Di(){const t=ao[Math.floor(Math.random()*ao.length)],n=lo[Math.floor(Math.random()*lo.length)];return`${t}-${n}`}function P0(t){let n=Di();for(;t.includes(n);)n=Di();return n}function Ds(){return{playerName:Di(),numBots:0,fow:da,numSystems:ga,timeScale:1}}function ir(){return{world:Oe(),playerMap:new Map}}function zs(t,n){t.playerMap.set(n.id,n)}function rr(t){const{C:n}=globalThis.gameManager.getFnContext();if(!n.playerId)return null;for(const e of t.world.systemMap.values())if(e.homeworld===n.playerId)return e;return null}function Ge(t,n){const{P:e}=globalThis.gameManager.getFnContext();if(!e)return;e.revealedSystems.add(n.id),e.visitedSystems.add(n.id);const i=st(t.world,n.id);if(i)return i.forEach(r=>e.revealedSystems.add(r.id)),t}function Eh(t){const{P:n}=globalThis.gameManager.getFnContext();if(n)for(const e of t.world.systemMap.values())n.revealedSystems.add(e.id)}function Os(t,n,e,i,r){t.moveQueue.push({ships:e,toId:n.id,fromId:t.id,playerId:i,message:r})}function bh(t){return Array.from(t.values()).map(qs)}function Ih(t){return t.map(n=>Fs(n))}function Fs(t){return{...t,visitedSystems:new Set(t.visitedSystems),revealedSystems:new Set(t.revealedSystems)}}function qs(t){return{...t,bot:void 0,visitedSystems:Array.from(t.visitedSystems),revealedSystems:Array.from(t.revealedSystems)}}function Gs(t,n,e,i){if(i!==0){if(i<0){if(n.ownerId!==e.ownerId)return;const r=n;n=e,e=r,i=-i}n.ships<i||(e.ownerId===n.ownerId?Th(t,n,e,i):Ah(t,n,e,i))}}function Ah(t,n,e,i){const r=n.ownerId,o=e.ships??0;if(Ys(t.S.world,n,e,i),i>o){const s=i-o;n.ships=n.ships-i,e.ships=s,$h(t,r,e)}else n.ships=n.ships-i,e.ships=o-i}function $h(t,n,e){e.ownerId=n,e.moveQueue=[],n===t.C.playerId&&Ge(t.S,e),e.homeworld&&e.homeworld!==n&&Bs(t,e.homeworld,n)}function Bs({S:t,E:n,C:e},i,r=null){const o=t.playerMap.get(i);if(o.isAlive){o.isAlive=!1;for(const s of t.world.systemMap.values())s.ownerId===i&&(s.ownerId=r,s.ships=Math.max(Math.floor((s.ships??0)/2),1),s.homeworld=null,s.moveQueue=[],r===e.playerId&&Ge(t,s)),s.homeworld===i&&(s.homeworld=null);n.emit("PLAYER_ELIMINATED",{loserId:i,winnerId:r})}}function Ys(t,n,e,i){n.movement=[n.movement[0],n.movement[1]+i],e.movement=[e.movement[0]+i,e.movement[1]];for(const r of t.laneMap.values())r.fromId===n.id&&r.toId===e.id?r.movement=[r.movement[0]+i,r.movement[1]]:r.fromId===e.id&&r.toId===n.id&&(r.movement=[r.movement[0],r.movement[1]+i])}function Th({S:t,C:n},e,i,r){e.ships<r||(e.ships-=r,i.ships+=r,Ys(t.world,e,i,r),i.ownerId===n.playerId&&Ge(t,i))}function Hs(t){for(const n of t.S.world.systemMap.values())for(n.lastMove=null;n.moveQueue.length>0;){const e=n.moveQueue.shift();e&&Xs(t,e)}}function Xs(t,n){n.playerId===t.C.playerId&&t.E.emit("LOG",{message:"player move",params:[n]});const e=t.S.world.systemMap.get(n.fromId),i=t.S.world.systemMap.get(n.toId);Gs(t,e,i,n.ships),e.lastMove=n,t.E.emit("MOVE_COMPLETED",n)}function Nh(t,n){const e=Us(t.S,n);e&&Xs(t,e)}function Ph(t,n){const e=t.world.systemMap.get(n.fromId);return!(e.ownerId!==n.playerId||!qe(t.world,n.fromId,n.toId)||e.ships<=1)}function Us(t,n){if(!Ph(t,n))return null;switch(n.type){case"MASS_MOVE":return e(n.fromId,n.toId);case"BALANCED_MOVE":return i(n.fromId,n.toId)}return null;function e(r,o){const{C:s}=globalThis.gameManager.getFnContext(),l=t.world.systemMap.get(r).ships-1;return l<=0?null:{message:`Move ${l} ships from ${r} to ${o}`,ships:l,toId:o,fromId:r,playerId:s.playerId}}function i(r,o){const{C:s}=globalThis.gameManager.getFnContext(),a=t.world.systemMap.get(r),l=t.world.systemMap.get(o),u=l.ownerId===a.ownerId?Math.floor((a.ships-l.ships)/2):Math.floor(a.ships/2);return u<=0?null:{message:`Move ${u} ships from ${a.id} to ${l.id}`,ships:u,toId:l.id,fromId:a.id,playerId:s.playerId}}}const Vn=100,ti={territory:{aggression:.3,expansion:1,defensiveness:.5,riskTolerance:.4,speed:Vn},rusher:{aggression:1,expansion:.4,defensiveness:.1,riskTolerance:.7,speed:Vn},turtle:{aggression:.1,expansion:.3,defensiveness:.95,riskTolerance:.2,speed:Vn},balanced:{aggression:.5,expansion:.5,defensiveness:.5,riskTolerance:.5,speed:Vn}};function kh({S:t}){for(const n of t.playerMap.values())n.bot&&n.bot.makeMoves()}let Ch=0;class k0{constructor(n={}){this.queuedMoves=0,this.threatLevels=new Map,this.frontline=new Set,this.backline=new Set;const e=Ch++;if(this.id=n.id??`${e}`,this.name=n.personality,!this.name&&this.name!=="idle"){const i=Object.keys(ti);this.name=i[e%i.length]}this.personality=this.name==="idle"?ti.balanced:ti[this.name]}makeMoves(){if(this.name==="idle")return;const e=gameManager.getState().world.systemMap.values();if(this.botSystems=Array.from(e).filter(l=>l.ownerId===this.id),this.botSystems.length===0)return;for(const l of this.botSystems)l.moveQueue=[];this.queuedMoves=0,this.analyzeMap();const i=this.getDefensiveMoves();if(this.chooseMoves(i,1-this.personality.defensiveness),this.queuedMoves>=this.personality.speed)return;const r=this.getCoordinatedAttackMoves();if(this.chooseMoves(r,this.personality.aggression),this.queuedMoves>=this.personality.speed)return;const o=this.getExterminateMoves();if(this.chooseMoves(o,this.personality.defensiveness),this.queuedMoves>=this.personality.speed)return;const s=this.getExploreMoves();if(this.chooseMoves(s,this.personality.expansion),this.queuedMoves>=this.personality.speed)return;const a=this.getLogisticsMoves();this.chooseMoves(a,1),this.queuedMoves>=this.personality.speed}analyzeMap(){this.threatLevels.clear(),this.frontline.clear(),this.backline.clear();const n=gameManager.getState();this.botSystems.forEach(e=>{const i=st(n.world,e.id),r=i.filter(a=>a.ownerId&&a.ownerId!==this.id),o=i.filter(a=>!a.ownerId),s=r.reduce((a,l)=>a+l.ships,0);this.threatLevels.set(e.id,s),r.length>0||o.length>0?this.frontline.add(e.id):this.backline.add(e.id)})}getDefensiveMoves(){const n=gameManager.getState();return this.botSystems.map(e=>{if(e.moveQueue.length>0)return[];const i=[],r=this.threatLevels.get(e.id)??0;if(r>0){const o=r*1.1;if(e.ships<o)if(e.ships<r*.5){const s=st(n.world,e.id).filter(a=>a.ownerId===this.id).sort((a,l)=>(this.threatLevels.get(a.id)||0)-(this.threatLevels.get(l.id)||0))[0];s&&i.push({message:`Retreating from ${e.id}`,from:e,to:s,units:e.ships-1,score:1e3})}else i.push({message:`Holding ${e.id}`,from:e,to:e,units:0,score:r});else e.ships<o*1.5&&i.push({message:`Defending ${e.id} from threat level ${r}`,from:e,to:e,units:0,score:r})}return i})}getCoordinatedAttackMoves(){const n=gameManager.getState(),e=new Map;this.botSystems.forEach(r=>{if(r.moveQueue.length>0||r.ships<5)return;const o=st(n.world,r.id);o&&o.forEach(s=>{if(s.ownerId!==null&&s.ownerId!==this.id){if(st(n.world,r.id).filter(l=>l.ownerId&&l.ownerId!==this.id&&l.id!==s.id).length>0)return;e.has(s.id)||e.set(s.id,{target:s,attackers:[]}),e.get(s.id).attackers.push(r)}})});const i=[];return e.forEach(({target:r,attackers:o})=>{const a=st(n.world,r.id).filter(c=>c.ownerId===r.ownerId).length===0?1.5:1,l=o.reduce((c,h)=>{const d=this.threatLevels.get(h.id)||0,g=Math.max(0,h.ships-d*1.1);return c+Math.floor(g*(1-this.personality.defensiveness))},0),f=(r.ships+(r.homeworld?10:0))*(1.3-this.personality.riskTolerance);l>f&&o.forEach(c=>{if(c.moveQueue.length>0)return;const h=this.threatLevels.get(c.id)||0,d=Math.max(0,c.ships-h*1.1),g=Math.floor(d*(1-this.personality.defensiveness)),p=this.getBestMoveAmount(c,r,g);p>0&&i.push([{message:`Coordinated attack on ${r.id}`,from:c,to:r,units:p,score:(100+(r.homeworld?50:0))*a}])})}),i}getExterminateMoves(){const n=gameManager.getState();return this.botSystems.map(e=>e.moveQueue.length>0?[]:e.ships<3?[]:st(n.world,e.id).flatMap(r=>{if(r.ownerId===this.id)return[];if(r.ownerId===null&&r.type==="UNINHABITED")return[];if(e.ships>r.ships*1.5+5){const o=e.ships-2;return[{message:`Crushing weak neighbor ${r.id}`,from:e,to:r,units:o,score:40}]}return[]}))}getExploreMoves(){const n=gameManager.getState();return this.botSystems.map(e=>e.moveQueue.length>0?[]:e.ships<2?[]:st(n.world,e.id).flatMap(r=>{if(r.ownerId!==null)return[];if(r.type==="INHABITED")return[];const o=Math.max(1,Math.floor(e.ships*.3));return[{message:`Exploring ${r.id}`,from:e,to:r,units:o,score:30}]}))}getLogisticsMoves(){const n=gameManager.getState();return this.botSystems.map(e=>{if(e.moveQueue.length>0)return[];if(e.ships<2)return[];if(this.backline.has(e.id)){const i=st(n.world,e.id).filter(s=>this.frontline.has(s.id)&&s.ownerId===this.id);if(i.length>0){const s=i.sort((a,l)=>a.ships-l.ships)[0];return[{message:"Logistics: Frontline Support",from:e,to:s,units:e.ships-1,score:10}]}const o=st(n.world,e.id).filter(s=>s.ownerId===this.id).sort((s,a)=>s.ships-a.ships)[0];if(o&&o.ships<e.ships-2)return[{message:"Logistics: Balancing",from:e,to:o,units:Math.floor((e.ships-o.ships)/2),score:5}]}if(this.frontline.has(e.id)){const i=st(n.world,e.id).filter(r=>r.ownerId===this.id&&(this.threatLevels.get(r.id)||0)>r.ships);if(i.length>0&&(this.threatLevels.get(e.id)||0)<e.ships){const r=i[0];return[{message:"Logistics: Emergency Reinforce",from:e,to:r,units:Math.floor(e.ships/2),score:50}]}}return[]})}getBestMoveAmount(n,e,i){const r=Math.max(0,n.ships-1);let o=0;return e.ownerId===n.ownerId?o=Math.floor((n.ships-e.ships)/2):o=Math.floor(n.ships/2),o=Math.max(0,o),Math.abs(r-i)<Math.abs(o-i)?r:o}chooseMoves(n,e=1){if(n.length===0)return;const i=n.flat().sort(Rh);for(const r of i){if(this.queuedMoves>=this.personality.speed)return;if(Math.random()<e){if(r.from.moveQueue.length>0)continue;Os(r.from,r.to,r.units,this.id,r.message),r.units>0&&this.queuedMoves++}}}}function Rh(t,n){return t.score!==n.score?n.score-t.score:Math.random()-.5}function Vs(t){for(const n of t.playerMap.values()){const e={playerId:n.id,systems:0,ships:0,homeworld:0};for(const i of t.world.systemMap.values())i.ownerId===n.id&&(e.systems+=1,e.ships+=i.ships??0,i.homeworld===n.id&&(e.homeworld=i.ships??0));n.stats=e}}function Ks(t){for(const n of t.world.systemMap.values())n.type==="INHABITED"&&(n.ownerId||n.ships<So)&&(n.ships=(n.ships??0)+fa)}function js(t){for(const n of t.world.systemMap.values())n.ownerId!=null&&(n.ships=(n.ships??0)+ha)}function Lh({S:t,C:n,E:e,P:i}){if(n.status==="PLAYING"&&i)if(t.playerMap.size>1){const r=Array.from(t.playerMap.values());if(r.reduce((s,a)=>(s+=a.stats.homeworld>0?1:0,s),0)===1){const s=r.find(l=>l.stats.homeworld>0).id,a=t.playerMap.get(s);e.emit("PLAYER_WON",{playerId:s,message:`${a.name} has conquered The Bubble!`}),e.emit("GAME_STOPPED",void 0)}}else Array.from(t.world.systemMap.values()).filter(o=>o.ownerId!==n.playerId).length===0&&(e.emit("PLAYER_WON",{playerId:n.playerId,message:`${i.name} has conquered The Bubble!`}),e.emit("GAME_STOPPED",void 0))}function Dh(t){const{S:n,C:e}=t;e.tick%ua===0&&Ks(n),e.tick%ca===0&&js(n);for(const i of n.world.systemMap.values())i.movement=[0,0];for(const i of n.world.laneMap.values())i.movement=[0,0];kh(t),Hs(t),Vs(n)}const zh="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Oh=t=>crypto.getRandomValues(new Uint8Array(t)),Fh=(t,n,e)=>{let i=(2<<Math.log2(t.length-1))-1,r=-~(1.6*i*n/t.length);return(o=n)=>{let s="";for(;;){let a=e(r),l=r|0;for(;l--;)if(s+=t[a[l]&i]||"",s.length>=o)return s}}},C0=(t,n=21)=>Fh(t,n|0,Oh),qh=(t=21)=>{let n="",e=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)n+=zh[e[t]&63];return n};const Gh=()=>qh(5);function Ws({S:t,C:n,E:e}){t.world=Oe();const i=qt/(n.config.numSystems-1),r=-qt/2,o=qt/2;e.emit("LOG",{message:"Generating map..."});const s=Math.min(.08,Math.sqrt(Math.PI/n.config.numSystems));for(let c=r;c<o;c+=i){const h=Math.asin(c/(qt/2))*(180/Math.PI),g=[Math.random()*360-180,h],p=Yh(g),M=Ls(t.world,p.location);if(M){if(xe(g,M.location)<s){c-=i;continue}Li(t.world,p,M)}Rs(t.world,p)}const a=Array.from(t.world.systemMap.values()),l=[a[a.length-1]];for(let c=a.length-2;c>=0;c--){const h=a[c],d=er(h.location,l);d&&Li(t.world,h,d),l.push(h)}Fe(t.world),e.emit("LOG",{message:`Generated ${t.world.systemMap.size} systems and ${t.world.laneMap.size} lanes.`});const u=[...a],f=Math.max(pa*n.config.numSystems,Eo+bo);for(let c=0;c<f&&u.length!==0;c++){const h=Math.floor(Math.random()*u.length);if(h===0){c--;continue}const d=u[h];d.ownerId=null,d.type="INHABITED",d.ships=So+Math.floor(Math.random()*10),d.homeworld=null,u.splice(h,1)}}function Bh(t,n){const e=Array.from(t.world.systemMap.values()).filter(o=>!o.ownerId&&o.type==="INHABITED");if(e.length===0)throw"No available homeworlds to join.";const i=Math.floor(Math.random()*e.length),r=e[i];return r.ships=1,r.ownerId=r.homeworld=n,r.type="INHABITED",r}function Yh(t){return{id:"s"+Gh(),type:"UNINHABITED",location:t,ownerId:null,ships:0,homeworld:null,moveQueue:[],lastMove:null,movement:[0,0]}}function Hh(t){const n=ir();return Ws({...t,S:n}),n}const Xh=Object.freeze(Object.defineProperty({__proto__:null,addLane:Li,addPlayer:zs,addSystem:Rs,assignSystem:Bh,buildNeighborMap:Fe,checkVictory:Lh,createWorld:Oe,defaultConfig:Ds,doQueuedMoves:Hs,eliminatePlayer:Bs,findClosestSystem:Ls,findClosestSystemInList:er,gameTick:Dh,generateMap:Ws,getAdjacentSystems:st,getPlayersHomeworld:rr,hasLane:qe,initalState:ir,moveShips:Gs,orderToMove:Us,playerFromJson:Fs,playerToJson:qs,playersFromJson:Ih,playersToJson:bh,queueMove:Os,revealAllSystems:Eh,roundUpdate:js,setup:Hh,takeOrder:Nh,turnUpdate:Ks,updateStats:Vs,visitSystem:Ge,worldFromJson:xh,worldToJson:Sh},Symbol.toStringTag,{value:"Module"})),W={all:new Set,last:null};function Qs(){W.all.clear(),W.last=null}function Te(t){W.all.add(t),W.last=t}function Uh(t){W.all.clear(),W.all.add(t),W.last=t}function Vh(t){W.all.delete(t),W.last===t&&(W.last=null)}function Zs(t){return W.all.has(t)}function Kh(t){Zs(t)?Vh(t):Te(t)}function jh({S:t,C:n},e){if(W.last==null)return;const i=[[W.last]],r=new Set;for(r.add(W.last);i.length>0;){const o=i.shift(),s=o[o.length-1];if(s===e){o.forEach(a=>W.all.add(a)),W.last=e;return}for(const a of st(t.world,s))!r.has(a.id)&&a.ownerId===n.playerId&&(r.add(a.id),i.push([...o,a.id]))}}function uo(t,n){const{S:e,C:i}=globalThis.gameManager.getFnContext();if(i.status==="PLAYING")switch(t.button){case 0:break;case 2:{let r=e.world.systemMap.get(n.fromId),o=e.world.systemMap.get(n.toId);if(r.ownerId!==i.playerId&&o.ownerId!==i.playerId)return;if(r.ownerId!==i.playerId){const s=r;r=o,o=s}else if(r.ownerId===r.ownerId&&o.ships>r.ships){const s=r;r=o,o=s}if(Wh(r.id,o.id),o.ownerId!==i.playerId)return;t.altKey||(!t.ctrlKey&&!t.shiftKey&&Qs(),Te(r.id),o.ownerId===i.playerId&&Te(o.id));break}}}function Ne(t,n){const e=globalThis.gameManager.getFnContext();if(e.C.status==="PLAYING")switch(va&&t.altKey&&globalThis.gameManager.getFnContext().E.emit("LOG",{message:""+n.id,params:[n.lastMove?.message??"none",n.lastMove?.ships??0,n]}),t.button){case 0:if(n.ownerId!==e.C.playerId)return;t.ctrlKey||t.metaKey?Kh(n.id):t.shiftKey?jh(e,n.id):Uh(n.id);break;case-1:case 2:{const i=Array.from(W.all);if(i.length===0)return;i.forEach(r=>{Qh(r,n.id),n.ownerId===e.C.playerId&&(t.altKey||(!t.ctrlKey&&!t.shiftKey&&Qs(),Te(n.id)))});break}}}function Wh(t,n){const{S:e,E:i,C:r}=globalThis.gameManager.getFnContext();if(!qe(e.world,t,n))return;const o={type:"BALANCED_MOVE",message:`Balanced move from ${t} to ${n}`,toId:n,fromId:t,playerId:r.playerId};i.emit("PROCESS_ORDER",o)}function Qh(t,n){const{S:e,E:i,C:r}=globalThis.gameManager.getFnContext();if(!qe(e.world,t,n))return;const o={type:"MASS_MOVE",toId:n,fromId:t,playerId:r.playerId,message:`Mass move from ${t} to ${n}`};i.emit("PROCESS_ORDER",o)}const or=Math.PI,co=or/2,fo=180/or,ho=or/180,Zh=Math.atan2,go=Math.cos,Jh=Math.max,t0=Math.min,po=Math.sin,n0=Math.sign||function(t){return t>0?1:t<0?-1:0},Js=Math.sqrt;function e0(t){return t>1?co:t<-1?-co:Math.asin(t)}function ta(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function at(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]}function Pe(t,n){return[t[0]+n[0],t[1]+n[1],t[2]+n[2]]}function ke(t){var n=Js(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return[t[0]/n,t[1]/n,t[2]/n]}function sr(t){return[Zh(t[1],t[0])*fo,e0(Jh(-1,t0(1,t[2])))*fo]}function bt(t){const n=t[0]*ho,e=t[1]*ho,i=go(e);return[i*go(n),i*po(n),po(e)]}function ar(t){return t=t.map(n=>bt(n)),ta(t[0],at(t[2],t[1]))}function i0(t){const n=o0(t),e=a0(n),i=s0(e,t),r=u0(e,t.length),o=r0(r,t),s=l0(e,t),{polygons:a,centers:l}=c0(s,e,t),u=f0(a),f=d0(e,t),c=h0(i,e);return{delaunay:n,edges:i,triangles:e,centers:l,neighbors:r,polygons:a,mesh:u,hull:f,urquhart:c,find:o}}function r0(t,n){function e(i,r){let o=i[0]-r[0],s=i[1]-r[1],a=i[2]-r[2];return o*o+s*s+a*a}return function(r,o,s){s===void 0&&(s=0);let a,l,u=s;const f=bt([r,o]);do a=s,s=null,l=e(f,bt(n[a])),t[a].forEach(c=>{let h=e(f,bt(n[c]));if(h<l){l=h,s=c,u=c;return}});while(s!==null);return u}}function o0(t){if(t.length<2)return{};let n=0;for(;isNaN(t[n][0]+t[n][1])&&n++<t.length;);const e=Me(t[n]),i=Ps().translate([0,0]).scale(1).rotate(e.invert([180,0]));t=t.map(i);const r=[];let o=1;for(let c=0,h=t.length;c<h;c++){let d=t[c][0]**2+t[c][1]**2;!isFinite(d)||d>1e32?r.push(c):d>o&&(o=d)}const s=1e6*Js(o);r.forEach(c=>t[c]=[s,0]),t.push([0,s]),t.push([-s,0]),t.push([0,-s]);const a=Ki.from(t);a.projection=i;const{triangles:l,halfedges:u,inedges:f}=a;for(let c=0,h=u.length;c<h;c++)if(u[c]<0){const d=c%3==2?c-2:c+1,g=c%3==0?c+2:c-1,p=u[d],M=u[g];u[p]=M,u[M]=p,u[d]=u[g]=-1,l[c]=l[d]=l[g]=n,f[l[p]]=p%3==0?p+2:p-1,f[l[M]]=M%3==0?M+2:M-1,c+=2-c%3}else l[c]>t.length-3-1&&(l[c]=n);return a}function s0(t,n){const e=new Set;return n.length===2?[[0,1]]:(t.forEach(i=>{if(i[0]!==i[1]&&!(ar(i.map(r=>n[r]))<0))for(let r=0,o;r<3;r++)o=(r+1)%3,e.add(Ao([i[r],i[o]]).join("-"))}),Array.from(e,i=>i.split("-").map(Number)))}function a0(t){const{triangles:n}=t;if(!n)return[];const e=[];for(let i=0,r=n.length/3;i<r;i++){const o=n[3*i],s=n[3*i+1],a=n[3*i+2];o!==s&&s!==a&&e.push([o,a,s])}return e}function l0(t,n){return t.map(e=>{const i=e.map(o=>n[o]).map(bt),r=Pe(Pe(at(i[1],i[0]),at(i[2],i[1])),at(i[0],i[2]));return sr(ke(r))})}function u0(t,n){const e=[];return t.forEach(i=>{for(let r=0;r<3;r++){const o=i[r],s=i[(r+1)%3];e[o]=e[o]||[],e[o].push(s)}}),t.length===0&&(n===2?(e[0]=[1],e[1]=[0]):n===1&&(e[0]=[])),e}function c0(t,n,e){const i=[],r=t.slice();if(n.length===0){if(e.length<2)return{polygons:i,centers:r};if(e.length===2){const a=bt(e[0]),l=bt(e[1]),u=ke(Pe(a,l)),f=ke(at(a,l)),c=at(u,f),h=[u,at(u,c),at(at(u,c),c),at(at(at(u,c),c),c)].map(sr).map(s);return i.push(h),i.push(h.slice().reverse()),{polygons:i,centers:r}}}n.forEach((a,l)=>{for(let u=0;u<3;u++){const f=a[u],c=a[(u+1)%3],h=a[(u+2)%3];i[f]=i[f]||[],i[f].push([c,h,l,[f,c,h]])}});const o=i.map(a=>{const l=[a[0][2]];let u=a[0][1];for(let f=1;f<a.length;f++)for(let c=0;c<a.length;c++)if(a[c][0]==u){u=a[c][1],l.push(a[c][2]);break}if(l.length>2)return l;if(l.length==2){const f=mo(e[a[0][3][0]],e[a[0][3][1]],r[l[0]]),c=mo(e[a[0][3][2]],e[a[0][3][0]],r[l[0]]),h=s(f),d=s(c);return[l[0],d,l[1],h]}});function s(a){let l=-1;return r.slice(n.length,1/0).forEach((u,f)=>{u[0]===a[0]&&u[1]===a[1]&&(l=f+n.length)}),l<0&&(l=r.length,r.push(a)),l}return{polygons:o,centers:r}}function mo(t,n,e){t=bt(t),n=bt(n),e=bt(e);const i=n0(ta(at(n,t),e));return sr(ke(Pe(t,n)).map(r=>i*r))}function f0(t){const n=[];return t.forEach(e=>{if(!e)return;let i=e[e.length-1];for(let r of e)r>i&&n.push([i,r]),i=r}),n}function h0(t,n){return function(e){const i=new Map,r=new Map;return t.forEach((o,s)=>{const a=o.join("-");i.set(a,e[s]),r.set(a,!0)}),n.forEach(o=>{let s=0,a=-1;for(let l=0;l<3;l++){let u=Ao([o[l],o[(l+1)%3]]).join("-");i.get(u)>s&&(s=i.get(u),a=u)}r.set(a,!1)}),t.map(o=>r.get(o.join("-")))}}function d0(t,n){const e=new Set,i=[];t.map(a=>{if(!(ar(a.map(l=>n[l>n.length?0:l]))>1e-12))for(let l=0;l<3;l++){let u=[a[l],a[(l+1)%3]],f=`${u[0]}-${u[1]}`;e.has(f)?e.delete(f):e.add(`${u[1]}-${u[0]}`)}});const r=new Map;let o;if(e.forEach(a=>{a=a.split("-").map(Number),r.set(a[0],a[1]),o=a[0]}),o===void 0)return i;let s=o;do{i.push(s);let a=r.get(s);r.set(s,-1),s=a}while(s>-1&&s!==o);return i}function g0(t){const n=function(e){if(n.delaunay=null,n._data=e,typeof n._data=="object"&&n._data.type==="FeatureCollection"&&(n._data=n._data.features),typeof n._data=="object"){const i=n._data.map(r=>[n._vx(r),n._vy(r),r]).filter(r=>isFinite(r[0]+r[1]));n.points=i.map(r=>[r[0],r[1]]),n.valid=i.map(r=>r[2]),n.delaunay=i0(n.points)}return n};return n._vx=function(e){if(typeof e=="object"&&"type"in e)return Br(e)[0];if(0 in e)return e[0]},n._vy=function(e){if(typeof e=="object"&&"type"in e)return Br(e)[1];if(1 in e)return e[1]},n.x=function(e){return e?(n._vx=e,n):n._vx},n.y=function(e){return e?(n._vy=e,n):n._vy},n.polygons=function(e){if(e!==void 0&&n(e),!n.delaunay)return!1;const i={type:"FeatureCollection",features:[]};return n.valid.length===0||(n.delaunay.polygons.forEach((r,o)=>i.features.push({type:"Feature",geometry:r?{type:"Polygon",coordinates:[[...r,r[0]].map(s=>n.delaunay.centers[s])]}:null,properties:{site:n.valid[o],sitecoordinates:n.points[o],neighbours:n.delaunay.neighbors[o]}})),n.valid.length===1&&i.features.push({type:"Feature",geometry:{type:"Sphere"},properties:{site:n.valid[0],sitecoordinates:n.points[0],neighbours:[]}})),i},n.triangles=function(e){return e!==void 0&&n(e),n.delaunay?{type:"FeatureCollection",features:n.delaunay.triangles.map((i,r)=>(i=i.map(o=>n.points[o]),i.center=n.delaunay.centers[r],i)).filter(i=>ar(i)>0).map(i=>({type:"Feature",properties:{circumcenter:i.center},geometry:{type:"Polygon",coordinates:[[...i,i[0]]]}}))}:!1},n.links=function(e){if(e!==void 0&&n(e),!n.delaunay)return!1;const i=n.delaunay.edges.map(o=>xe(n.points[o[0]],n.points[o[1]])),r=n.delaunay.urquhart(i);return{type:"FeatureCollection",features:n.delaunay.edges.map((o,s)=>({type:"Feature",properties:{source:n.valid[o[0]],target:n.valid[o[1]],length:i[s],urquhart:!!r[s]},geometry:{type:"LineString",coordinates:[n.points[o[0]],n.points[o[1]]]}}))}},n.mesh=function(e){return e!==void 0&&n(e),n.delaunay?{type:"MultiLineString",coordinates:n.delaunay.edges.map(i=>[n.points[i[0]],n.points[i[1]]])}:!1},n.cellMesh=function(e){if(e!==void 0&&n(e),!n.delaunay)return!1;const{centers:i,polygons:r}=n.delaunay,o=[];for(const s of r)if(s)for(let a=s.length,l=s[a-1],u=s[0],f=0;f<a;l=u,u=s[++f])u>l&&o.push([i[l],i[u]]);return{type:"MultiLineString",coordinates:o}},n._found=void 0,n.find=function(e,i,r){if(n._found=n.delaunay.find(e,i,n._found),!r||xe([e,i],n.points[n._found])<r)return n._found},n.hull=function(e){e!==void 0&&n(e);const i=n.delaunay.hull,r=n.points;return i.length===0?null:{type:"Polygon",coordinates:[[...i.map(o=>r[o]),r[i[0]]]]}},t?n(t):n}const na=Math.acos,p0=Math.asin,yo=Math.atan2,Ht=Math.cos,vo=Math.hypot,zi=Math.max,Oi=Math.min,ea=Math.PI,Xt=Math.sin,xn=ea/180,ni=180/ea;class dt{static fromCartesian([n,e,i]){return[0,i,-e,n]}static fromAngles([n,e,i]){n*=xn/2,e*=xn/2,i=(i||0)*xn/2;const r=Xt(n),o=Ht(n),s=Xt(e),a=Ht(e),l=Xt(i),u=Ht(i);return[o*a*u+r*s*l,r*a*u-o*s*l,o*s*u+r*a*l,o*a*l-r*s*u]}static toAngles([n,e,i,r]){return[yo(2*(n*e+i*r),1-2*(e*e+i*i))*ni,p0(zi(-1,Oi(1,2*(n*i-r*e))))*ni,yo(2*(n*r+e*i),1-2*(i*i+r*r))*ni]}static interpolateAngles(n,e){const i=dt.interpolate(dt.fromAngles(n),dt.fromAngles(e));return r=>dt.toAngles(i(r))}static interpolateLinear([n,e,i,r],[o,s,a,l]){o-=n,s-=e,a-=i,l-=r;const u=new Array(4);return f=>{const c=vo(u[0]=n+o*f,u[1]=e+s*f,u[2]=i+a*f,u[3]=r+l*f);return u[0]/=c,u[1]/=c,u[2]/=c,u[3]/=c,u}}static interpolate([n,e,i,r],[o,s,a,l]){let u=dt.dot([n,e,i,r],[o,s,a,l]);if(u<0&&(o=-o,s=-s,a=-a,l=-l,u=-u),u>.9995)return dt.interpolateLinear([n,e,i,r],[o,s,a,l]);const f=na(zi(-1,Oi(1,u))),c=new Array(4),h=vo(o-=n*u,s-=e*u,a-=i*u,l-=r*u);return o/=h,s/=h,a/=h,l/=h,d=>{const g=f*d,p=Xt(g),M=Ht(g);return c[0]=n*M+o*p,c[1]=e*M+s*p,c[2]=i*M+a*p,c[3]=r*M+l*p,c}}static dot([n,e,i,r],[o,s,a,l]){return n*o+e*s+i*a+r*l}static multiply([n,e,i,r],[o,s,a,l]){return[n*o-e*s-i*a-r*l,n*s+e*o+i*l-r*a,n*a-e*l+i*o+r*s,n*l+e*a-i*s+r*o]}}const ct=dt.fromAngles;ct.multiply=dt.multiply;ct.rotation=dt.toAngles;ct.interpolate=dt.interpolateAngles;ct.cartesian=function(t){const n=t[0]*xn,e=t[1]*xn,i=Ht(e);return[i*Ht(n),i*Xt(n),Xt(e)]};ct.delta=function(t,n,e){arguments.length==2&&(e=1);const i=Math.sqrt;function r(f,c){return[f[1]*c[2]-f[2]*c[1],f[2]*c[0]-f[0]*c[2],f[0]*c[1]-f[1]*c[0]]}function o(f,c){return f[0]*c[0]+f[1]*c[1]+f[2]*c[2]}const s=r(t,n),a=i(o(s,s));if(!a)return[1,0,0,0];const l=e*na(zi(-1,Oi(1,o(t,n))))/2,u=Xt(l);return[Ht(l),s[2]/a*u,-s[1]/a*u,s[0]/a*u]};const _o=.5,m0=.25,y0=100,v0=20,_0=rs(".3~s"),ln={Orthographic:dh,Stereographic:Ps,Mercator:hh,TransverseMercator:gh};let Fi,gt,un=ln[aa],X=un().translate([0,0]),zt=X.scale(),Be=Qi().projection(X),ne;const w0=g0().x(t=>t.location[0]).y(t=>t.location[1]);function R0(){const t=Object.keys(ln),e=(t.findIndex(i=>ln[i]===un)+1)%t.length;M0(t[e])}function M0(t){un=ln[t],X=un(),X.translate([0,0]).rotate([0,0,0]).scale(zt),zt=X.scale(),Be=Qi().projection(X)}function L0(t){const n=X.rotate();n[0]+=t[0],n[1]+=t[1],t.length===3&&(n[2]+=t[2]),X.rotate(n)}function D0(t,n){Fi=pt(t),gt=Fi.select("svg"),gt.attr("width","100vw").attr("height","100vh").attr("viewBox",`-${ee/2} -${qt/2} ${ee} ${qt}`).on("contextmenu",s=>s.preventDefault()),qi(n.S),ra(n),oa(n),ia(n),gt.call(e()),gt.call(i()),window.addEventListener("resize",o);function e(){return r().on("drag.render",()=>_t()).on("end.render",()=>_t())}function i(){return Mh().filter(s=>s.type==="wheel").on("zoom",s=>{if(s.transform.k>_o){const a=zt*s.transform.k;X.scale(a),_t()}else s.transform.k=_o})}function r(){let s,a,l,u,f;function c(p,M){const m=nu(p,M);if(m.length!==f&&(f=m.length,f>1&&(u=Math.atan2(m[1][1]-m[0][1],m[1][0]-m[0][0])),h.apply(M,[p,M])),f>1){const E=lr(m,b=>b[0]),x=lr(m,b=>b[1]),w=Math.atan2(m[1][1]-m[0][1],m[1][0]-m[0][0]);return[E,x,w]}return m[0]}function h({x:p,y:M}){const m=g([p,M]);s=ct.cartesian(X.invert(m)),l=X.rotate(),a=ct(l)}function d(p){const M=g([p.x,p.y]),m=ct.cartesian(X.rotate(l).invert(M)),E=ct.delta(s,m);let x=ct.multiply(a,E);const w=c(p,this);if(w[2]){const b=(w[2]-u)/2,$=-Math.sin(b),T=Math.sign(Math.cos(b));x=ct.multiply([Math.sqrt(1-$*$),0,0,T*$],x)}X.rotate(ct.rotation(x)),E[0]<.7&&h.apply(this,[p,this])}function g(p){const M=parseInt(gt.style("width")),m=parseInt(gt.style("height"));return[p[0]-M/2,p[1]-m/2]}return au().filter(p=>p.button===1||p.touches).on("start",h).on("drag",d)}function o(){qi(globalThis.gameManager.getState())}}function qi(t){const n=gt.node()?.getBoundingClientRect(),e=window.devicePixelRatio||1,i=n?.height||qt,r=n?.width||ee,a=Fi.selectAll("canvas").data([null]).join(f=>f.append("canvas").style("position","absolute").style("top",0).style("left",0).style("z-index",-1).style("pointer-events","none")).attr("width",r*e).attr("height",i*e).style("width",`${r}px`).style("height",`${i}px`).node().getContext("2d");a.setTransform(1,0,0,1,0,0),a.scale(e,e),a.translate(r/2,i/2);const l=Math.min(r/ee,i/qt);a.scale(l,l);const u="#FFFFFF48";if(un===ln.Orthographic){const f=X.scale();a.strokeStyle=u,a.lineWidth=1,a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=10,a.shadowColor=u,a.beginPath(),a.arc(0,0,f,0,Math.PI*2),a.stroke(),a.fill()}{a.shadowBlur=0,a.strokeStyle="rgba(51, 51, 51, 0.5)";const f=x0(t),c=Qi().projection(X).context(a);a.beginPath(),c(f),a.stroke()}}function x0(t){const n=Hf(),e=rr(t);if(e){if(!ne){const i=Me([0,90+e.location[1],0]),r=Me([e.location[0],0,0]);ne={type:"FeatureCollection",features:n.lines().map(o=>({type:"Feature",geometry:{type:"LineString",coordinates:o.coordinates.map(s=>r(i(s)))}}))}}return ne}return n()}function z0(t){const n=X.scale()*t;n<zt*m0||n>zt*y0||(X.scale(n),_t())}function O0(){const t=globalThis.gameManager.getState(),n=rr(t);if(!n)return;ne=null;const e=n.location;un===ln.Orthographic?Gi([e[0],e[1]-45]):Gi(e),X.scale(zt)}function F0(t){const e=globalThis.gameManager.getState().world.systemMap.get(t);e&&(Gi(e.location),X.scale(zt))}function Gi(t){X.rotate([-t[0],-t[1],0]),_t()}let wo=null;function _t(){return cancelAnimationFrame(wo),wo=requestAnimationFrame(()=>t());function t(n){gt&&(n??=globalThis.gameManager.getFnContext(),ra(n),qi(n.S),ia(n),oa(n))}}function ia({S:t,C:n,P:e}){const r=X.scale()/zt<1;let o=t.world.systemMap.values();e&&n.config.fow&&(o=e.revealedSystems.values().map(l=>t.world.systemMap.get(l))),o=o.filter(l=>!!Be({type:"Point",coordinates:l.location}));const a=gt.selectAll("g#systems").data([null]).join(l=>l.append("g").attr("id","systems")).classed("reduced-size",r).classed("hidden",!1).selectAll(".system").data(o,l=>l.id).join(l=>{const u=l.append("g").attr("class","system").attr("id",f=>f.id).on("click",(f,c)=>{Ne(f,c),_t()}).on("contextmenu",(f,c)=>{f.preventDefault(),Ne(f,c),_t()});return u.append("circle").attr("class","system-outline").attr("cx",0).attr("cy",0).attr("r",v0/2),u.append("text").attr("class","ship-count").attr("y",-10).attr("x",0).attr("text-anchor","start"),u.append("text").attr("class","system-icon").attr("y",0).attr("x",0).attr("text-anchor","end"),u});a.style("--owner-color",l=>t.playerMap.get(l.ownerId)?.color??null).classed("own",l=>l.ownerId===n.playerId).classed("selected",l=>Zs(l.id)).classed("moved",l=>l.movement[0]>0||l.movement[1]>0).classed("inhabited",l=>l.type==="INHABITED").classed("homeworld",l=>!!l.homeworld&&l.ownerId===l.homeworld).classed("visited",l=>e?e.visitedSystems.has(l.id):!0).attr("transform",l=>`translate(${X(l.location)})`),a.select(".system-icon").text(l=>l.homeworld&&l.ownerId===l.homeworld?"":l.type==="INHABITED"?"":""),a.select(".ship-count").text(l=>r?"":(l.type==="INHABITED"?"":"")+(l.ships?_0(l.ships):""))}const S0=(()=>{let t=[],n;return e=>{if(!t||n!==e.world.systemMap){n=e.world.systemMap;const i=Array.from(n.values());t=w0.polygons(i).features}return t}})();function ra({S:t,C:n,P:e}){const r=X.scale()/zt<1;let o=S0(t);e&&n.config.fow&&(o=o.filter(l=>{const u=l.properties?.site;return e.revealedSystems.has(u.id)})),gt.selectAll("g#mesh").data([null]).join(l=>l.append("g").attr("id","mesh")).classed("reduced-size",r).classed("hidden",!1).selectAll("path").data(o).join(l=>l.append("path").classed("region",!0).on("click",(u,f)=>{Ne(u,f),_t()}).on("contextmenu",(u,f)=>{u.preventDefault(),Ne(u,f),_t()})).attr("d",l=>Be(l)).datum(l=>l.properties.site).classed("visited",l=>e?e.visitedSystems.has(l.id):!0).style("--owner-color",l=>t.playerMap.get(l.ownerId)?.color??null)}function oa({S:t,C:n,P:e}){let i=t.world.laneMap.values();e&&n.config.fow&&(i=i.filter(s=>e.revealedSystems.has(s.fromId)&&e.revealedSystems.has(s.toId)));const o=gt.selectAll("g#lanes").data([null]).join(s=>s.append("g").attr("id","lanes")).selectAll("g.lane-group").data(i,s=>s.id).join(s=>{const a=s.append("g").attr("class","lane-group").attr("id",l=>l.id).on("click",(l,u)=>{uo(l,u),_t()}).on("contextmenu",(l,u)=>{l.preventDefault(),uo(l,u),_t()});return a.append("path").attr("class","lane"),a.append("path").attr("class","pulse"),a}).datum(s=>{const a=t.world.systemMap.get(s.toId),l=t.world.systemMap.get(s.fromId),u=Be({type:"LineString",coordinates:[l.location,a.location]});return{...s,from:t.world.systemMap.get(s.fromId),to:t.world.systemMap.get(s.toId),path:u}});o.style("--owner-color",s=>{const a=s.from;if(!a.ownerId)return null;const l=s.to;return!l.ownerId||a.ownerId!==l.ownerId?null:t.playerMap.get(a.ownerId)?.color??null}),o.select("path.lane").attr("d",s=>s.path).classed("own",s=>{const a=s.from,l=s.to;return a.ownerId===n.playerId||l.ownerId===n.playerId}).style("--path-length",s=>{const a=pt(`#${s.id} .lane`).node();return a?a.getTotalLength():200}),o.select("path.pulse").attr("d",s=>s.path).classed("moved",s=>s.movement[0]>0||s.movement[1]>0).style("stroke-width",s=>{if(s.movement[0]===0&&s.movement[1]===0)return null;const a=2,l=Math.floor(Math.log2(Math.max(s.movement[0],s.movement[1])));return`${(a+l)*2}px`}).classed("moved--fwd",s=>s.movement[0]>s.movement[1]).classed("moved--bak",s=>s.movement[1]>s.movement[0])}var Gt={},dn={},Mo;function E0(){if(Mo)return dn;Mo=1,Object.defineProperty(dn,"__esModule",{value:!0}),dn.MiniSignal=void 0;const t=Symbol("SIGNAL");function n(i){return typeof i=="object"&&t in i}class e{constructor(){this._symbol=Symbol("MiniSignal"),this._refMap=new WeakMap,this._head=void 0,this._tail=void 0,this._dispatching=!1}hasListeners(){return this._head!=null}dispatch(...r){if(this._dispatching)throw new Error("MiniSignal#dispatch(): Signal already dispatching.");let o=this._head;if(o==null)return!1;for(this._dispatching=!0;o!=null;)o.fn(...r),o=o.next;return this._dispatching=!1,!0}add(r){if(typeof r!="function")throw new Error("MiniSignal#add(): First arg must be a Function.");return this._createRef(this._addNode({fn:r}))}detach(r){if(!n(r))throw new Error("MiniSignal#detach(): First arg must be a MiniSignal listener reference.");if(r[t]!==this._symbol)throw new Error("MiniSignal#detach(): MiniSignal listener does not belong to this MiniSignal.");const o=this._refMap.get(r);return o?(this._refMap.delete(r),this._disconnectNode(o),this._destroyNode(o),this):this}detachAll(){let r=this._head;if(r==null)return this;for(this._head=this._tail=void 0,this._refMap=new WeakMap;r!=null;)this._destroyNode(r),r=r.next;return this}_destroyNode(r){r.fn=void 0,r.prev=void 0}_disconnectNode(r){r===this._head?(this._head=r.next,r.next==null&&(this._tail=void 0)):r===this._tail&&(this._tail=r.prev,this._tail!=null&&(this._tail.next=void 0)),r.prev!=null&&(r.prev.next=r.next),r.next!=null&&(r.next.prev=r.prev)}_addNode(r){return this._head==null?(this._head=r,this._tail=r):(this._tail.next=r,r.prev=this._tail,this._tail=r),r}_createRef(r){const o={[t]:this._symbol};return this._refMap.set(o,r),o}_getRef(r){return this._refMap.get(r)}}return dn.MiniSignal=e,dn}var xo;function b0(){return xo||(xo=1,(function(t){var n=Gt&&Gt.__createBinding||(Object.create?(function(i,r,o,s){s===void 0&&(s=o);var a=Object.getOwnPropertyDescriptor(r,o);(!a||("get"in a?!r.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return r[o]}}),Object.defineProperty(i,s,a)}):(function(i,r,o,s){s===void 0&&(s=o),i[s]=r[o]})),e=Gt&&Gt.__exportStar||function(i,r){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(r,o)&&n(r,i,o)};Object.defineProperty(t,"__esModule",{value:!0}),e(E0(),t)})(Gt)),Gt}var I0=b0();class A0{constructor(n){this.events=n}addEvents(n){this.events={...this.events,...n}}on(n,e){const i=this.events[n].add(e);return()=>{this.events[n].detach(i)}}emit(n,...e){this.events[n].dispatch(e[0])}clear(){for(const n in this.events)this.events[n].detachAll()}}function ot(){return new I0.MiniSignal}const $0=()=>({GAME_INIT:ot(),GAME_STARTED:ot(),GAME_STOPPED:ot(),GAME_TICK:ot(),STATE_UPDATED:ot(),CONFIG_UPDATED:ot(),PLAYER_UPDATED:ot(),PLAYER_ELIMINATED:ot(),PLAYER_WON:ot(),PLAYER_LOST:ot(),PROCESS_ORDER:ot(),MOVE_COMPLETED:ot(),LOG:ot()});class q0 extends A0{constructor(){super($0()),this.name="GameManager",this.game=Xh,this.state=ir(),this.config=Ds(),this.tick=0,this.status="WAITING",this.runningInterval=null,this.#n()}getState(){return ie?Object.freeze({...this.state}):this.state}getConfig(){return ie?Object.freeze({...this.config}):this.config}async setConfig(n){this.config={...this.config,...n},this.events.CONFIG_UPDATED.dispatch()}getPlayer(){return this.state.playerMap.get(this.playerId)??null}getContext(){return{tick:this.tick,status:this.status,playerId:this.playerId,config:this.getConfig()}}getFnContext(){return{S:this.state,E:this,P:this.state.playerMap.get(this.playerId),C:this.getContext()}}addPlayer(n){if(this.state.playerMap.has(n.id))return this.state.playerMap.get(n.id);const e=n.score??{userId:n.id,playerName:n.name??`Player ${this.state.playerMap.size+1}`,score:0,tick:0,timestamp:Date.now()},i={name:n.name??`Player ${this.state.playerMap.size+1}`,score:e,color:"#000000",...n,stats:{playerId:n.id,systems:0,ships:0,homeworld:0},isAlive:!0,visitedSystems:new Set,revealedSystems:new Set};return zs(this.state,i),i}gameStart(){this.status="PLAYING",this.tick=0,this.events.GAME_STARTED.dispatch(),this.#t()}gameStop(){this.status="FINISHED",this.stopGameLoop()}gameTick(){this.tick++,this.game.gameTick(this.getFnContext()),this.game.checkVictory(this.getFnContext()),this.events.STATE_UPDATED.dispatch()}#t(){if(this.status!=="PLAYING"){this.gameStop();return}this.stopGameLoop(),this.gameTick(),this.events.GAME_TICK.dispatch({tick:this.tick}),this.runningInterval=setTimeout(()=>this.#t(),la/this.config.timeScale)}startGameLoop(){this.#t()}stopGameLoop(){this.runningInterval&&(clearTimeout(this.runningInterval),this.runningInterval=null)}#n(){this.events.GAME_STOPPED.add(()=>{this.gameStop()}),this.events.PROCESS_ORDER.add(n=>{this.game.takeOrder(this.getFnContext(),n),this.events.STATE_UPDATED.dispatch()}),ya&&this.events.LOG.add(({message:n,params:e})=>{console.log(`[DEBUG][Tick ${this.tick}] ${n}`,...e??[])})}}export{k0 as B,va as E,q0 as G,T0 as M,Eh as a,R0 as b,Qs as c,O0 as d,F0 as e,L0 as f,z0 as g,rs as h,D0 as i,C0 as j,bo as k,P0 as l,Te as m,qh as n,N0 as o,ot as p,_t as r,W as s};

(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const Va="0.0.8";let Ya=class extends Event{constructor(t,n,r,i){super("context-request",{bubbles:!0,composed:!0}),this.context=t,this.contextTarget=n,this.callback=r,this.subscribe=i??!1}};let oo=class{constructor(t,n,r,i){if(this.subscribe=!1,this.provided=!1,this.value=void 0,this.t=(s,o)=>{this.unsubscribe&&(this.unsubscribe!==o&&(this.provided=!1,this.unsubscribe()),this.subscribe||this.unsubscribe()),this.value=s,this.host.requestUpdate(),this.provided&&!this.subscribe||(this.provided=!0,this.callback&&this.callback(s,o)),this.unsubscribe=o},this.host=t,n.context!==void 0){const s=n;this.context=s.context,this.callback=s.callback,this.subscribe=s.subscribe??!1}else this.context=n,this.callback=r,this.subscribe=i??!1;this.host.addController(this)}hostConnected(){this.dispatchRequest()}hostDisconnected(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=void 0)}dispatchRequest(){this.host.dispatchEvent(new Ya(this.context,this.host,this.t,this.subscribe))}};let ou=class{get value(){return this.o}set value(t){this.setValue(t)}setValue(t,n=!1){const r=n||!Object.is(t,this.o);this.o=t,r&&this.updateObservers()}constructor(t){this.subscriptions=new Map,this.updateObservers=()=>{for(const[n,{disposer:r}]of this.subscriptions)n(this.o,r)},t!==void 0&&(this.value=t)}addCallback(t,n,r){if(!r)return void t(this.value);this.subscriptions.has(t)||this.subscriptions.set(t,{disposer:()=>{this.subscriptions.delete(t)},consumerHost:n});const{disposer:i}=this.subscriptions.get(t);t(this.value,i)}clearCallbacks(){this.subscriptions.clear()}};let au=class extends Event{constructor(t,n){super("context-provider",{bubbles:!0,composed:!0}),this.context=t,this.contextTarget=n}},ao=class extends ou{constructor(t,n,r){super(n.context!==void 0?n.initialValue:r),this.onContextRequest=i=>{if(i.context!==this.context)return;const s=i.contextTarget??i.composedPath()[0];s!==this.host&&(i.stopPropagation(),this.addCallback(i.callback,s,i.subscribe))},this.onProviderRequest=i=>{if(i.context!==this.context||(i.contextTarget??i.composedPath()[0])===this.host)return;const s=new Set;for(const[o,{consumerHost:a}]of this.subscriptions)s.has(o)||(s.add(o),a.dispatchEvent(new Ya(this.context,a,o,!0)));i.stopPropagation()},this.host=t,n.context!==void 0?this.context=n.context:this.context=n,this.attachListeners(),this.host.addController?.(this)}attachListeners(){this.host.addEventListener("context-request",this.onContextRequest),this.host.addEventListener("context-provider",this.onProviderRequest)}hostConnected(){this.host.dispatchEvent(new au(this.context,this.host))}};function In({context:e}){return(t,n)=>{const r=new WeakMap;if(typeof n=="object")return{get(){return t.get.call(this)},set(i){return r.get(this).setValue(i),t.set.call(this,i)},init(i){return r.set(this,new ao(this,{context:e,initialValue:i})),i}};{t.constructor.addInitializer((o=>{r.set(o,new ao(o,{context:e}))}));const i=Object.getOwnPropertyDescriptor(t,n);let s;if(i===void 0){const o=new WeakMap;s={get(){return o.get(this)},set(a){r.get(this).setValue(a),o.set(this,a)},configurable:!0,enumerable:!0}}else{const o=i.set;s={...i,set(a){r.get(this).setValue(a),o?.call(this,a)}}}return void Object.defineProperty(t,n,s)}}}function Tn({context:e,subscribe:t}){return(n,r)=>{typeof r=="object"?r.addInitializer((function(){new oo(this,{context:e,callback:i=>{n.set.call(this,i)},subscribe:t})})):n.constructor.addInitializer((i=>{new oo(i,{context:e,callback:s=>{i[r]=s},subscribe:t})}))}}const nr=globalThis,Es=nr.ShadowRoot&&(nr.ShadyCSS===void 0||nr.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Wa=Symbol(),lo=new WeakMap;let lu=class{constructor(t,n,r){if(this._$cssResult$=!0,r!==Wa)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=n}get styleSheet(){let t=this.o;const n=this.t;if(Es&&t===void 0){const r=n!==void 0&&n.length===1;r&&(t=lo.get(n)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),r&&lo.set(n,t))}return t}toString(){return this.cssText}};const cu=e=>new lu(typeof e=="string"?e:e+"",void 0,Wa),uu=(e,t)=>{if(Es)e.adoptedStyleSheets=t.map((n=>n instanceof CSSStyleSheet?n:n.styleSheet));else for(const n of t){const r=document.createElement("style"),i=nr.litNonce;i!==void 0&&r.setAttribute("nonce",i),r.textContent=n.cssText,e.appendChild(r)}},co=Es?e=>e:e=>e instanceof CSSStyleSheet?(t=>{let n="";for(const r of t.cssRules)n+=r.cssText;return cu(n)})(e):e;const{is:hu,defineProperty:fu,getOwnPropertyDescriptor:du,getOwnPropertyNames:pu,getOwnPropertySymbols:gu,getPrototypeOf:mu}=Object,Kr=globalThis,uo=Kr.trustedTypes,yu=uo?uo.emptyScript:"",_u=Kr.reactiveElementPolyfillSupport,pn=(e,t)=>e,dr={toAttribute(e,t){switch(t){case Boolean:e=e?yu:null;break;case Object:case Array:e=e==null?e:JSON.stringify(e)}return e},fromAttribute(e,t){let n=e;switch(t){case Boolean:n=e!==null;break;case Number:n=e===null?null:Number(e);break;case Object:case Array:try{n=JSON.parse(e)}catch{n=null}}return n}},$s=(e,t)=>!hu(e,t),ho={attribute:!0,type:String,converter:dr,reflect:!1,useDefault:!1,hasChanged:$s};Symbol.metadata??=Symbol("metadata"),Kr.litPropertyMetadata??=new WeakMap;let Le=class extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,n=ho){if(n.state&&(n.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((n=Object.create(n)).wrapped=!0),this.elementProperties.set(t,n),!n.noAccessor){const r=Symbol(),i=this.getPropertyDescriptor(t,r,n);i!==void 0&&fu(this.prototype,t,i)}}static getPropertyDescriptor(t,n,r){const{get:i,set:s}=du(this.prototype,t)??{get(){return this[n]},set(o){this[n]=o}};return{get:i,set(o){const a=i?.call(this);s?.call(this,o),this.requestUpdate(t,a,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??ho}static _$Ei(){if(this.hasOwnProperty(pn("elementProperties")))return;const t=mu(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(pn("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(pn("properties"))){const n=this.properties,r=[...pu(n),...gu(n)];for(const i of r)this.createProperty(i,n[i])}const t=this[Symbol.metadata];if(t!==null){const n=litPropertyMetadata.get(t);if(n!==void 0)for(const[r,i]of n)this.elementProperties.set(r,i)}this._$Eh=new Map;for(const[n,r]of this.elementProperties){const i=this._$Eu(n,r);i!==void 0&&this._$Eh.set(i,n)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const n=[];if(Array.isArray(t)){const r=new Set(t.flat(1/0).reverse());for(const i of r)n.unshift(co(i))}else t!==void 0&&n.push(co(t));return n}static _$Eu(t,n){const r=n.attribute;return r===!1?void 0:typeof r=="string"?r:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((t=>t(this)))}addController(t){(this._$EO??=new Set).add(t),this.renderRoot!==void 0&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,n=this.constructor.elementProperties;for(const r of n.keys())this.hasOwnProperty(r)&&(t.set(r,this[r]),delete this[r]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return uu(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((t=>t.hostConnected?.()))}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach((t=>t.hostDisconnected?.()))}attributeChangedCallback(t,n,r){this._$AK(t,r)}_$ET(t,n){const r=this.constructor.elementProperties.get(t),i=this.constructor._$Eu(t,r);if(i!==void 0&&r.reflect===!0){const s=(r.converter?.toAttribute!==void 0?r.converter:dr).toAttribute(n,r.type);this._$Em=t,s==null?this.removeAttribute(i):this.setAttribute(i,s),this._$Em=null}}_$AK(t,n){const r=this.constructor,i=r._$Eh.get(t);if(i!==void 0&&this._$Em!==i){const s=r.getPropertyOptions(i),o=typeof s.converter=="function"?{fromAttribute:s.converter}:s.converter?.fromAttribute!==void 0?s.converter:dr;this._$Em=i;const a=o.fromAttribute(n,s.type);this[i]=a??this._$Ej?.get(i)??a,this._$Em=null}}requestUpdate(t,n,r){if(t!==void 0){const i=this.constructor,s=this[t];if(r??=i.getPropertyOptions(t),!((r.hasChanged??$s)(s,n)||r.useDefault&&r.reflect&&s===this._$Ej?.get(t)&&!this.hasAttribute(i._$Eu(t,r))))return;this.C(t,n,r)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(t,n,{useDefault:r,reflect:i,wrapped:s},o){r&&!(this._$Ej??=new Map).has(t)&&(this._$Ej.set(t,o??n??this[t]),s!==!0||o!==void 0)||(this._$AL.has(t)||(this.hasUpdated||r||(n=void 0),this._$AL.set(t,n)),i===!0&&this._$Em!==t&&(this._$Eq??=new Set).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(n){Promise.reject(n)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[i,s]of this._$Ep)this[i]=s;this._$Ep=void 0}const r=this.constructor.elementProperties;if(r.size>0)for(const[i,s]of r){const{wrapped:o}=s,a=this[i];o!==!0||this._$AL.has(i)||a===void 0||this.C(i,void 0,s,a)}}let t=!1;const n=this._$AL;try{t=this.shouldUpdate(n),t?(this.willUpdate(n),this._$EO?.forEach((r=>r.hostUpdate?.())),this.update(n)):this._$EM()}catch(r){throw t=!1,this._$EM(),r}t&&this._$AE(n)}willUpdate(t){}_$AE(t){this._$EO?.forEach((n=>n.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&=this._$Eq.forEach((n=>this._$ET(n,this[n]))),this._$EM()}updated(t){}firstUpdated(t){}};Le.elementStyles=[],Le.shadowRootOptions={mode:"open"},Le[pn("elementProperties")]=new Map,Le[pn("finalized")]=new Map,_u?.({ReactiveElement:Le}),(Kr.reactiveElementVersions??=[]).push("2.1.1");const As=globalThis,pr=As.trustedTypes,fo=pr?pr.createPolicy("lit-html",{createHTML:e=>e}):void 0,Ka="$lit$",le=`lit$${Math.random().toFixed(9).slice(2)}$`,Xa="?"+le,wu=`<${Xa}>`,Ee=document,mn=()=>Ee.createComment(""),yn=e=>e===null||typeof e!="object"&&typeof e!="function",Is=Array.isArray,vu=e=>Is(e)||typeof e?.[Symbol.iterator]=="function",hi=`[ 	
\f\r]`,tn=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,po=/-->/g,go=/>/g,de=RegExp(`>|${hi}(?:([^\\s"'>=/]+)(${hi}*=${hi}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),mo=/'/g,yo=/"/g,Qa=/^(?:script|style|textarea|title)$/i,xu=e=>(t,...n)=>({_$litType$:e,strings:t,values:n}),at=xu(1),$e=Symbol.for("lit-noChange"),ot=Symbol.for("lit-nothing"),_o=new WeakMap,ye=Ee.createTreeWalker(Ee,129);function Za(e,t){if(!Is(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return fo!==void 0?fo.createHTML(t):t}const bu=(e,t)=>{const n=e.length-1,r=[];let i,s=t===2?"<svg>":t===3?"<math>":"",o=tn;for(let a=0;a<n;a++){const l=e[a];let u,h,c=-1,f=0;for(;f<l.length&&(o.lastIndex=f,h=o.exec(l),h!==null);)f=o.lastIndex,o===tn?h[1]==="!--"?o=po:h[1]!==void 0?o=go:h[2]!==void 0?(Qa.test(h[2])&&(i=RegExp("</"+h[2],"g")),o=de):h[3]!==void 0&&(o=de):o===de?h[0]===">"?(o=i??tn,c=-1):h[1]===void 0?c=-2:(c=o.lastIndex-h[2].length,u=h[1],o=h[3]===void 0?de:h[3]==='"'?yo:mo):o===yo||o===mo?o=de:o===po||o===go?o=tn:(o=de,i=void 0);const d=o===de&&e[a+1].startsWith("/>")?" ":"";s+=o===tn?l+wu:c>=0?(r.push(u),l.slice(0,c)+Ka+l.slice(c)+le+d):l+le+(c===-2?a:d)}return[Za(e,s+(e[n]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),r]};class _n{constructor({strings:t,_$litType$:n},r){let i;this.parts=[];let s=0,o=0;const a=t.length-1,l=this.parts,[u,h]=bu(t,n);if(this.el=_n.createElement(u,r),ye.currentNode=this.el.content,n===2||n===3){const c=this.el.content.firstChild;c.replaceWith(...c.childNodes)}for(;(i=ye.nextNode())!==null&&l.length<a;){if(i.nodeType===1){if(i.hasAttributes())for(const c of i.getAttributeNames())if(c.endsWith(Ka)){const f=h[o++],d=i.getAttribute(c).split(le),y=/([.?@])?(.*)/.exec(f);l.push({type:1,index:s,name:y[2],strings:d,ctor:y[1]==="."?Mu:y[1]==="?"?Eu:y[1]==="@"?$u:Xr}),i.removeAttribute(c)}else c.startsWith(le)&&(l.push({type:6,index:s}),i.removeAttribute(c));if(Qa.test(i.tagName)){const c=i.textContent.split(le),f=c.length-1;if(f>0){i.textContent=pr?pr.emptyScript:"";for(let d=0;d<f;d++)i.append(c[d],mn()),ye.nextNode(),l.push({type:2,index:++s});i.append(c[f],mn())}}}else if(i.nodeType===8)if(i.data===Xa)l.push({type:2,index:s});else{let c=-1;for(;(c=i.data.indexOf(le,c+1))!==-1;)l.push({type:7,index:s}),c+=le.length-1}s++}}static createElement(t,n){const r=Ee.createElement("template");return r.innerHTML=t,r}}function He(e,t,n=e,r){if(t===$e)return t;let i=r!==void 0?n._$Co?.[r]:n._$Cl;const s=yn(t)?void 0:t._$litDirective$;return i?.constructor!==s&&(i?._$AO?.(!1),s===void 0?i=void 0:(i=new s(e),i._$AT(e,n,r)),r!==void 0?(n._$Co??=[])[r]=i:n._$Cl=i),i!==void 0&&(t=He(e,i._$AS(e,t.values),i,r)),t}class Su{constructor(t,n){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:n},parts:r}=this._$AD,i=(t?.creationScope??Ee).importNode(n,!0);ye.currentNode=i;let s=ye.nextNode(),o=0,a=0,l=r[0];for(;l!==void 0;){if(o===l.index){let u;l.type===2?u=new kn(s,s.nextSibling,this,t):l.type===1?u=new l.ctor(s,l.name,l.strings,this,t):l.type===6&&(u=new Au(s,this,t)),this._$AV.push(u),l=r[++a]}o!==l?.index&&(s=ye.nextNode(),o++)}return ye.currentNode=Ee,i}p(t){let n=0;for(const r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(t,r,n),n+=r.strings.length-2):r._$AI(t[n])),n++}}class kn{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,n,r,i){this.type=2,this._$AH=ot,this._$AN=void 0,this._$AA=t,this._$AB=n,this._$AM=r,this.options=i,this._$Cv=i?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const n=this._$AM;return n!==void 0&&t?.nodeType===11&&(t=n.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,n=this){t=He(this,t,n),yn(t)?t===ot||t==null||t===""?(this._$AH!==ot&&this._$AR(),this._$AH=ot):t!==this._$AH&&t!==$e&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):vu(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==ot&&yn(this._$AH)?this._$AA.nextSibling.data=t:this.T(Ee.createTextNode(t)),this._$AH=t}$(t){const{values:n,_$litType$:r}=t,i=typeof r=="number"?this._$AC(t):(r.el===void 0&&(r.el=_n.createElement(Za(r.h,r.h[0]),this.options)),r);if(this._$AH?._$AD===i)this._$AH.p(n);else{const s=new Su(i,this),o=s.u(this.options);s.p(n),this.T(o),this._$AH=s}}_$AC(t){let n=_o.get(t.strings);return n===void 0&&_o.set(t.strings,n=new _n(t)),n}k(t){Is(this._$AH)||(this._$AH=[],this._$AR());const n=this._$AH;let r,i=0;for(const s of t)i===n.length?n.push(r=new kn(this.O(mn()),this.O(mn()),this,this.options)):r=n[i],r._$AI(s),i++;i<n.length&&(this._$AR(r&&r._$AB.nextSibling,i),n.length=i)}_$AR(t=this._$AA.nextSibling,n){for(this._$AP?.(!1,!0,n);t!==this._$AB;){const r=t.nextSibling;t.remove(),t=r}}setConnected(t){this._$AM===void 0&&(this._$Cv=t,this._$AP?.(t))}}class Xr{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,n,r,i,s){this.type=1,this._$AH=ot,this._$AN=void 0,this.element=t,this.name=n,this._$AM=i,this.options=s,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=ot}_$AI(t,n=this,r,i){const s=this.strings;let o=!1;if(s===void 0)t=He(this,t,n,0),o=!yn(t)||t!==this._$AH&&t!==$e,o&&(this._$AH=t);else{const a=t;let l,u;for(t=s[0],l=0;l<s.length-1;l++)u=He(this,a[r+l],n,l),u===$e&&(u=this._$AH[l]),o||=!yn(u)||u!==this._$AH[l],u===ot?t=ot:t!==ot&&(t+=(u??"")+s[l+1]),this._$AH[l]=u}o&&!i&&this.j(t)}j(t){t===ot?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class Mu extends Xr{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===ot?void 0:t}}class Eu extends Xr{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==ot)}}class $u extends Xr{constructor(t,n,r,i,s){super(t,n,r,i,s),this.type=5}_$AI(t,n=this){if((t=He(this,t,n,0)??ot)===$e)return;const r=this._$AH,i=t===ot&&r!==ot||t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive,s=t!==ot&&(r===ot||i);i&&this.element.removeEventListener(this.name,this,r),s&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class Au{constructor(t,n,r){this.element=t,this.type=6,this._$AN=void 0,this._$AM=n,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(t){He(this,t)}}const Iu=As.litHtmlPolyfillSupport;Iu?.(_n,kn),(As.litHtmlVersions??=[]).push("3.3.1");const Tu=(e,t,n)=>{const r=n?.renderBefore??t;let i=r._$litPart$;if(i===void 0){const s=n?.renderBefore??null;r._$litPart$=i=new kn(t.insertBefore(mn(),s),s,void 0,n??{})}return i._$AI(e),i};const Ts=globalThis;let Lt=class extends Le{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const n=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=Tu(n,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return $e}};Lt._$litElement$=!0,Lt.finalized=!0,Ts.litElementHydrateSupport?.({LitElement:Lt});const ku=Ts.litElementPolyfillSupport;ku?.({LitElement:Lt});(Ts.litElementVersions??=[]).push("4.2.1");const ke=e=>(t,n)=>{n!==void 0?n.addInitializer((()=>{customElements.define(e,t)})):customElements.define(e,t)};const Pu={attribute:!0,type:String,converter:dr,reflect:!1,hasChanged:$s},Cu=(e=Pu,t,n)=>{const{kind:r,metadata:i}=n;let s=globalThis.litPropertyMetadata.get(i);if(s===void 0&&globalThis.litPropertyMetadata.set(i,s=new Map),r==="setter"&&((e=Object.create(e)).wrapped=!0),s.set(n.name,e),r==="accessor"){const{name:o}=n;return{set(a){const l=t.get.call(this);t.set.call(this,a),this.requestUpdate(o,l,e)},init(a){return a!==void 0&&this.C(o,void 0,e,a),a}}}if(r==="setter"){const{name:o}=n;return function(a){const l=this[o];t.call(this,a),this.requestUpdate(o,l,e)}}throw Error("Unsupported decorator location: "+r)};function ks(e){return(t,n)=>typeof n=="object"?Cu(e,t,n):((r,i,s)=>{const o=i.hasOwnProperty(s);return i.constructor.createProperty(s,r),o?Object.getOwnPropertyDescriptor(i,s):void 0})(e,t,n)}function gt(e){return ks({...e,state:!0,attribute:!1})}const Nu=(e,t,n)=>(n.configurable=!0,n.enumerable=!0,Reflect.decorate&&typeof t!="object"&&Object.defineProperty(e,t,n),n);function Ps(e,t){return(n,r,i)=>{const s=o=>o.renderRoot?.querySelector(e)??null;return Nu(n,r,{get(){return s(this)}})}}const Ou={CHILD:2},Ru=e=>(...t)=>({_$litDirective$:e,values:t});class Lu{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,n,r){this._$Ct=t,this._$AM=n,this._$Ci=r}_$AS(t,n){return this.update(t,n)}update(t,n){return this.render(...n)}}class ki extends Lu{constructor(t){if(super(t),this.it=ot,t.type!==Ou.CHILD)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(t){if(t===ot||t==null)return this._t=void 0,this.it=t;if(t===$e)return t;if(typeof t!="string")throw Error(this.constructor.directiveName+"() called with a non-string value");if(t===this.it)return this._t;this.it=t;const n=[t];return n.raw=n,this._t={_$litType$:this.constructor.resultType,strings:n,values:[]}}}ki.directiveName="unsafeHTML",ki.resultType=1;const _e=Ru(ki),Du={DEV:!1,PROD:!0},gr=750,ue=750,zu="Orthographic",Uu=500,Bu=2,Fu=25,Hu=1,qu=1,Ja=40,Gu=!0,ju=384,tl=1,el=8,Vu=tl+el,Yu=.1,nl=Du||{},mr=nl.DEV??!0,Wu=nl.PROD??!1,Ku=Wu,Xu=mr,rl=mr,Qu=["#c0392b","#f1c40f","#9b59b6","#00b386","#cc6600","#0a4c8c","#e74c3c","#f39c12","#8e44ad","#27ae60","#d35400","#2980b9"];function qe(e,...t){const n=globalThis.gameManager?.getContext()?.tick??null;Xu&&console.log(`[DEBUG][Tick ${n}] ${e}`,...t)}function fi(e,t={}){if(!Ku)return;const n=globalThis.gameManager?.getContext()?.tick??null;let r=1;try{r=parseInt(localStorage.getItem(e)??"0",10)+1}catch(i){console.error("Error reading event count from localStorage:",i)}if(localStorage.setItem(e,r+""),window&&window.sa_event)try{window.sa_event(e,{[e]:r,tick:n,...t})}catch(i){console.error("Error tracking event:",i)}}function il(e,t){let n,r;for(const i of e)i!=null&&(n===void 0?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)));return[n,r]}class Dt{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let r=0;for(let i=0;i<this._n&&i<32;i++){const s=n[i],o=t+s,a=Math.abs(t)<Math.abs(s)?t-(o-s):s-(o-t);a&&(n[r++]=a),t=o}return n[r]=t,this._n=r+1,this}valueOf(){const t=this._partials;let n=this._n,r,i,s,o=0;if(n>0){for(o=t[--n];n>0&&(r=o,i=t[--n],o=r+i,s=i-(o-r),!s););n>0&&(s<0&&t[n-1]<0||s>0&&t[n-1]>0)&&(i=s*2,r=o+i,i==r-o&&(o=r))}return o}}function wo(e,t){let n=0,r=0;if(t===void 0)for(let i of e)i!=null&&(i=+i)>=i&&(++n,r+=i);else{let i=-1;for(let s of e)(s=t(s,++i,e))!=null&&(s=+s)>=s&&(++n,r+=s)}if(n)return r/n}function*Zu(e){for(const t of e)yield*t}function sl(e){return Array.from(Zu(e))}function De(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,s=new Array(i);++r<i;)s[r]=e+r*n;return s}var Ju={value:()=>{}};function Qr(){for(var e=0,t=arguments.length,n={},r;e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new rr(n)}function rr(e){this._=e}function th(e,t){return e.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}rr.prototype=Qr.prototype={constructor:rr,on:function(e,t){var n=this._,r=th(e+"",n),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(e=r[s]).type)&&(i=eh(n[i],e.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<o;)if(i=(e=r[s]).type)n[i]=vo(n[i],e.name,t);else if(t==null)for(i in n)n[i]=vo(n[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new rr(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,s;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],r=0,i=s.length;r<i;++r)s[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,s=r.length;i<s;++i)r[i].value.apply(t,n)}};function eh(e,t){for(var n=0,r=e.length,i;n<r;++n)if((i=e[n]).name===t)return i.value}function vo(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=Ju,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}var Pi="http://www.w3.org/1999/xhtml";const xo={svg:"http://www.w3.org/2000/svg",xhtml:Pi,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Zr(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),xo.hasOwnProperty(t)?{space:xo[t],local:e}:e}function nh(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Pi&&t.documentElement.namespaceURI===Pi?t.createElement(e):t.createElementNS(n,e)}}function rh(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function ol(e){var t=Zr(e);return(t.local?rh:nh)(t)}function ih(){}function Cs(e){return e==null?ih:function(){return this.querySelector(e)}}function sh(e){typeof e!="function"&&(e=Cs(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,a=r[i]=new Array(o),l,u,h=0;h<o;++h)(l=s[h])&&(u=e.call(l,l.__data__,h,s))&&("__data__"in l&&(u.__data__=l.__data__),a[h]=u);return new Et(r,this._parents)}function oh(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function ah(){return[]}function al(e){return e==null?ah:function(){return this.querySelectorAll(e)}}function lh(e){return function(){return oh(e.apply(this,arguments))}}function ch(e){typeof e=="function"?e=lh(e):e=al(e);for(var t=this._groups,n=t.length,r=[],i=[],s=0;s<n;++s)for(var o=t[s],a=o.length,l,u=0;u<a;++u)(l=o[u])&&(r.push(e.call(l,l.__data__,u,o)),i.push(l));return new Et(r,i)}function ll(e){return function(){return this.matches(e)}}function cl(e){return function(t){return t.matches(e)}}var uh=Array.prototype.find;function hh(e){return function(){return uh.call(this.children,e)}}function fh(){return this.firstElementChild}function dh(e){return this.select(e==null?fh:hh(typeof e=="function"?e:cl(e)))}var ph=Array.prototype.filter;function gh(){return Array.from(this.children)}function mh(e){return function(){return ph.call(this.children,e)}}function yh(e){return this.selectAll(e==null?gh:mh(typeof e=="function"?e:cl(e)))}function _h(e){typeof e!="function"&&(e=ll(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,a=r[i]=[],l,u=0;u<o;++u)(l=s[u])&&e.call(l,l.__data__,u,s)&&a.push(l);return new Et(r,this._parents)}function ul(e){return new Array(e.length)}function wh(){return new Et(this._enter||this._groups.map(ul),this._parents)}function yr(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}yr.prototype={constructor:yr,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function vh(e){return function(){return e}}function xh(e,t,n,r,i,s){for(var o=0,a,l=t.length,u=s.length;o<u;++o)(a=t[o])?(a.__data__=s[o],r[o]=a):n[o]=new yr(e,s[o]);for(;o<l;++o)(a=t[o])&&(i[o]=a)}function bh(e,t,n,r,i,s,o){var a,l,u=new Map,h=t.length,c=s.length,f=new Array(h),d;for(a=0;a<h;++a)(l=t[a])&&(f[a]=d=o.call(l,l.__data__,a,t)+"",u.has(d)?i[a]=l:u.set(d,l));for(a=0;a<c;++a)d=o.call(e,s[a],a,s)+"",(l=u.get(d))?(r[a]=l,l.__data__=s[a],u.delete(d)):n[a]=new yr(e,s[a]);for(a=0;a<h;++a)(l=t[a])&&u.get(f[a])===l&&(i[a]=l)}function Sh(e){return e.__data__}function Mh(e,t){if(!arguments.length)return Array.from(this,Sh);var n=t?bh:xh,r=this._parents,i=this._groups;typeof e!="function"&&(e=vh(e));for(var s=i.length,o=new Array(s),a=new Array(s),l=new Array(s),u=0;u<s;++u){var h=r[u],c=i[u],f=c.length,d=Eh(e.call(h,h&&h.__data__,u,r)),y=d.length,w=a[u]=new Array(y),E=o[u]=new Array(y),v=l[u]=new Array(f);n(h,c,w,E,v,d,t);for(var T=0,A=0,b,C;T<y;++T)if(b=w[T]){for(T>=A&&(A=T+1);!(C=E[A])&&++A<y;);b._next=C||null}}return o=new Et(o,r),o._enter=a,o._exit=l,o}function Eh(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function $h(){return new Et(this._exit||this._groups.map(ul),this._parents)}function Ah(e,t,n){var r=this.enter(),i=this,s=this.exit();return typeof e=="function"?(r=e(r),r&&(r=r.selection())):r=r.append(e+""),t!=null&&(i=t(i),i&&(i=i.selection())),n==null?s.remove():n(s),r&&i?r.merge(i).order():i}function Ih(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,i=n.length,s=r.length,o=Math.min(i,s),a=new Array(i),l=0;l<o;++l)for(var u=n[l],h=r[l],c=u.length,f=a[l]=new Array(c),d,y=0;y<c;++y)(d=u[y]||h[y])&&(f[y]=d);for(;l<i;++l)a[l]=n[l];return new Et(a,this._parents)}function Th(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r=e[t],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function kh(e){e||(e=Ph);function t(c,f){return c&&f?e(c.__data__,f.__data__):!c-!f}for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o=n[s],a=o.length,l=i[s]=new Array(a),u,h=0;h<a;++h)(u=o[h])&&(l[h]=u);l.sort(t)}return new Et(i,this._parents).order()}function Ph(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Ch(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Nh(){return Array.from(this)}function Oh(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function Rh(){let e=0;for(const t of this)++e;return e}function Lh(){return!this.node()}function Dh(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i=t[n],s=0,o=i.length,a;s<o;++s)(a=i[s])&&e.call(a,a.__data__,s,i);return this}function zh(e){return function(){this.removeAttribute(e)}}function Uh(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Bh(e,t){return function(){this.setAttribute(e,t)}}function Fh(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Hh(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function qh(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Gh(e,t){var n=Zr(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((t==null?n.local?Uh:zh:typeof t=="function"?n.local?qh:Hh:n.local?Fh:Bh)(n,t))}function hl(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function jh(e){return function(){this.style.removeProperty(e)}}function Vh(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Yh(e,t,n){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function Wh(e,t,n){return arguments.length>1?this.each((t==null?jh:typeof t=="function"?Yh:Vh)(e,t,n??"")):Ge(this.node(),e)}function Ge(e,t){return e.style.getPropertyValue(t)||hl(e).getComputedStyle(e,null).getPropertyValue(t)}function Kh(e){return function(){delete this[e]}}function Xh(e,t){return function(){this[e]=t}}function Qh(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function Zh(e,t){return arguments.length>1?this.each((t==null?Kh:typeof t=="function"?Qh:Xh)(e,t)):this.node()[e]}function fl(e){return e.trim().split(/^|\s+/)}function Ns(e){return e.classList||new dl(e)}function dl(e){this._node=e,this._names=fl(e.getAttribute("class")||"")}dl.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function pl(e,t){for(var n=Ns(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function gl(e,t){for(var n=Ns(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function Jh(e){return function(){pl(this,e)}}function tf(e){return function(){gl(this,e)}}function ef(e,t){return function(){(t.apply(this,arguments)?pl:gl)(this,e)}}function nf(e,t){var n=fl(e+"");if(arguments.length<2){for(var r=Ns(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof t=="function"?ef:t?Jh:tf)(n,t))}function rf(){this.textContent=""}function sf(e){return function(){this.textContent=e}}function of(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function af(e){return arguments.length?this.each(e==null?rf:(typeof e=="function"?of:sf)(e)):this.node().textContent}function lf(){this.innerHTML=""}function cf(e){return function(){this.innerHTML=e}}function uf(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function hf(e){return arguments.length?this.each(e==null?lf:(typeof e=="function"?uf:cf)(e)):this.node().innerHTML}function ff(){this.nextSibling&&this.parentNode.appendChild(this)}function df(){return this.each(ff)}function pf(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function gf(){return this.each(pf)}function mf(e){var t=typeof e=="function"?e:ol(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function yf(){return null}function _f(e,t){var n=typeof e=="function"?e:ol(e),r=t==null?yf:typeof t=="function"?t:Cs(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function wf(){var e=this.parentNode;e&&e.removeChild(this)}function vf(){return this.each(wf)}function xf(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function bf(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Sf(e){return this.select(e?bf:xf)}function Mf(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Ef(e){return function(t){e.call(this,t,this.__data__)}}function $f(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}function Af(e){return function(){var t=this.__on;if(t){for(var n=0,r=-1,i=t.length,s;n<i;++n)s=t[n],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.options):t[++r]=s;++r?t.length=r:delete this.__on}}}function If(e,t,n){return function(){var r=this.__on,i,s=Ef(t);if(r){for(var o=0,a=r.length;o<a;++o)if((i=r[o]).type===e.type&&i.name===e.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=n),i.value=t;return}}this.addEventListener(e.type,s,n),i={type:e.type,name:e.name,value:t,listener:s,options:n},r?r.push(i):this.__on=[i]}}function Tf(e,t,n){var r=$f(e+""),i,s=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,u=a.length,h;l<u;++l)for(i=0,h=a[l];i<s;++i)if((o=r[i]).type===h.type&&o.name===h.name)return h.value}return}for(a=t?If:Af,i=0;i<s;++i)this.each(a(r[i],t,n));return this}function ml(e,t,n){var r=hl(e),i=r.CustomEvent;typeof i=="function"?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function kf(e,t){return function(){return ml(this,e,t)}}function Pf(e,t){return function(){return ml(this,e,t.apply(this,arguments))}}function Cf(e,t){return this.each((typeof t=="function"?Pf:kf)(e,t))}function*Nf(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var yl=[null];function Et(e,t){this._groups=e,this._parents=t}function Pn(){return new Et([[document.documentElement]],yl)}function Of(){return this}Et.prototype=Pn.prototype={constructor:Et,select:sh,selectAll:ch,selectChild:dh,selectChildren:yh,filter:_h,data:Mh,enter:wh,exit:$h,join:Ah,merge:Ih,selection:Of,order:Th,sort:kh,call:Ch,nodes:Nh,node:Oh,size:Rh,empty:Lh,each:Dh,attr:Gh,style:Wh,property:Zh,classed:nf,text:af,html:hf,raise:df,lower:gf,append:mf,insert:_f,remove:vf,clone:Sf,datum:Mf,on:Tf,dispatch:Cf,[Symbol.iterator]:Nf};function Nt(e){return typeof e=="string"?new Et([[document.querySelector(e)]],[document.documentElement]):new Et([[e]],yl)}function _l(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Ut(e,t){if(e=_l(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}function Rf(e,t){return e.target&&(e=_l(e),t===void 0&&(t=e.currentTarget),e=e.touches||[e]),Array.from(e,n=>Ut(n,t))}const Lf={passive:!1},wn={capture:!0,passive:!1};function di(e){e.stopImmediatePropagation()}function Be(e){e.preventDefault(),e.stopImmediatePropagation()}function wl(e){var t=e.document.documentElement,n=Nt(e).on("dragstart.drag",Be,wn);"onselectstart"in t?n.on("selectstart.drag",Be,wn):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function vl(e,t){var n=e.document.documentElement,r=Nt(e).on("dragstart.drag",null);t&&(r.on("click.drag",Be,wn),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Ln=e=>()=>e;function Ci(e,{sourceEvent:t,subject:n,target:r,identifier:i,active:s,x:o,y:a,dx:l,dy:u,dispatch:h}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:h}})}Ci.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function Df(e){return!e.ctrlKey&&!e.button}function zf(){return this.parentNode}function Uf(e,t){return t??{x:e.x,y:e.y}}function Bf(){return navigator.maxTouchPoints||"ontouchstart"in this}function Ff(){var e=Df,t=zf,n=Uf,r=Bf,i={},s=Qr("start","drag","end"),o=0,a,l,u,h,c=0;function f(b){b.on("mousedown.drag",d).filter(r).on("touchstart.drag",E).on("touchmove.drag",v,Lf).on("touchend.drag touchcancel.drag",T).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function d(b,C){if(!(h||!e.call(this,b,C))){var R=A(this,t.call(this,b,C),b,C,"mouse");R&&(Nt(b.view).on("mousemove.drag",y,wn).on("mouseup.drag",w,wn),wl(b.view),di(b),u=!1,a=b.clientX,l=b.clientY,R("start",b))}}function y(b){if(Be(b),!u){var C=b.clientX-a,R=b.clientY-l;u=C*C+R*R>c}i.mouse("drag",b)}function w(b){Nt(b.view).on("mousemove.drag mouseup.drag",null),vl(b.view,u),Be(b),i.mouse("end",b)}function E(b,C){if(e.call(this,b,C)){var R=b.changedTouches,D=t.call(this,b,C),L=R.length,N,z;for(N=0;N<L;++N)(z=A(this,D,b,C,R[N].identifier,R[N]))&&(di(b),z("start",b,R[N]))}}function v(b){var C=b.changedTouches,R=C.length,D,L;for(D=0;D<R;++D)(L=i[C[D].identifier])&&(Be(b),L("drag",b,C[D]))}function T(b){var C=b.changedTouches,R=C.length,D,L;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),D=0;D<R;++D)(L=i[C[D].identifier])&&(di(b),L("end",b,C[D]))}function A(b,C,R,D,L,N){var z=s.copy(),I=Ut(N||R,C),F,_,p;if((p=n.call(b,new Ci("beforestart",{sourceEvent:R,target:f,identifier:L,active:o,x:I[0],y:I[1],dx:0,dy:0,dispatch:z}),D))!=null)return F=p.x-I[0]||0,_=p.y-I[1]||0,function m(g,x,P){var k=I,O;switch(g){case"start":i[L]=m,O=o++;break;case"end":delete i[L],--o;case"drag":I=Ut(P||x,C),O=o;break}z.call(g,b,new Ci(g,{sourceEvent:x,subject:p,target:f,identifier:L,active:O,x:I[0]+F,y:I[1]+_,dx:I[0]-k[0],dy:I[1]-k[1],dispatch:z}),D)}}return f.filter=function(b){return arguments.length?(e=typeof b=="function"?b:Ln(!!b),f):e},f.container=function(b){return arguments.length?(t=typeof b=="function"?b:Ln(b),f):t},f.subject=function(b){return arguments.length?(n=typeof b=="function"?b:Ln(b),f):n},f.touchable=function(b){return arguments.length?(r=typeof b=="function"?b:Ln(!!b),f):r},f.on=function(){var b=s.on.apply(s,arguments);return b===s?f:b},f.clickDistance=function(b){return arguments.length?(c=(b=+b)*b,f):Math.sqrt(c)},f}function Os(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function xl(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Cn(){}var vn=.7,_r=1/vn,Fe="\\s*([+-]?\\d+)\\s*",xn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",qt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Hf=/^#([0-9a-f]{3,8})$/,qf=new RegExp(`^rgb\\(${Fe},${Fe},${Fe}\\)$`),Gf=new RegExp(`^rgb\\(${qt},${qt},${qt}\\)$`),jf=new RegExp(`^rgba\\(${Fe},${Fe},${Fe},${xn}\\)$`),Vf=new RegExp(`^rgba\\(${qt},${qt},${qt},${xn}\\)$`),Yf=new RegExp(`^hsl\\(${xn},${qt},${qt}\\)$`),Wf=new RegExp(`^hsla\\(${xn},${qt},${qt},${xn}\\)$`),bo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Os(Cn,bn,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:So,formatHex:So,formatHex8:Kf,formatHsl:Xf,formatRgb:Mo,toString:Mo});function So(){return this.rgb().formatHex()}function Kf(){return this.rgb().formatHex8()}function Xf(){return bl(this).formatHsl()}function Mo(){return this.rgb().formatRgb()}function bn(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Hf.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Eo(t):n===3?new xt(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?Dn(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?Dn(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=qf.exec(e))?new xt(t[1],t[2],t[3],1):(t=Gf.exec(e))?new xt(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=jf.exec(e))?Dn(t[1],t[2],t[3],t[4]):(t=Vf.exec(e))?Dn(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Yf.exec(e))?Io(t[1],t[2]/100,t[3]/100,1):(t=Wf.exec(e))?Io(t[1],t[2]/100,t[3]/100,t[4]):bo.hasOwnProperty(e)?Eo(bo[e]):e==="transparent"?new xt(NaN,NaN,NaN,0):null}function Eo(e){return new xt(e>>16&255,e>>8&255,e&255,1)}function Dn(e,t,n,r){return r<=0&&(e=t=n=NaN),new xt(e,t,n,r)}function Qf(e){return e instanceof Cn||(e=bn(e)),e?(e=e.rgb(),new xt(e.r,e.g,e.b,e.opacity)):new xt}function Ni(e,t,n,r){return arguments.length===1?Qf(e):new xt(e,t,n,r??1)}function xt(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}Os(xt,Ni,xl(Cn,{brighter(e){return e=e==null?_r:Math.pow(_r,e),new xt(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?vn:Math.pow(vn,e),new xt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new xt(Me(this.r),Me(this.g),Me(this.b),wr(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:$o,formatHex:$o,formatHex8:Zf,formatRgb:Ao,toString:Ao}));function $o(){return`#${we(this.r)}${we(this.g)}${we(this.b)}`}function Zf(){return`#${we(this.r)}${we(this.g)}${we(this.b)}${we((isNaN(this.opacity)?1:this.opacity)*255)}`}function Ao(){const e=wr(this.opacity);return`${e===1?"rgb(":"rgba("}${Me(this.r)}, ${Me(this.g)}, ${Me(this.b)}${e===1?")":`, ${e})`}`}function wr(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Me(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function we(e){return e=Me(e),(e<16?"0":"")+e.toString(16)}function Io(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Ot(e,t,n,r)}function bl(e){if(e instanceof Ot)return new Ot(e.h,e.s,e.l,e.opacity);if(e instanceof Cn||(e=bn(e)),!e)return new Ot;if(e instanceof Ot)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),s=Math.max(t,n,r),o=NaN,a=s-i,l=(s+i)/2;return a?(t===s?o=(n-r)/a+(n<r)*6:n===s?o=(r-t)/a+2:o=(t-n)/a+4,a/=l<.5?s+i:2-s-i,o*=60):a=l>0&&l<1?0:o,new Ot(o,a,l,e.opacity)}function Jf(e,t,n,r){return arguments.length===1?bl(e):new Ot(e,t,n,r??1)}function Ot(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}Os(Ot,Jf,xl(Cn,{brighter(e){return e=e==null?_r:Math.pow(_r,e),new Ot(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?vn:Math.pow(vn,e),new Ot(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new xt(pi(e>=240?e-240:e+120,i,r),pi(e,i,r),pi(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new Ot(To(this.h),zn(this.s),zn(this.l),wr(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=wr(this.opacity);return`${e===1?"hsl(":"hsla("}${To(this.h)}, ${zn(this.s)*100}%, ${zn(this.l)*100}%${e===1?")":`, ${e})`}`}}));function To(e){return e=(e||0)%360,e<0?e+360:e}function zn(e){return Math.max(0,Math.min(1,e||0))}function pi(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Sl=e=>()=>e;function t0(e,t){return function(n){return e+n*t}}function e0(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function n0(e){return(e=+e)==1?Ml:function(t,n){return n-t?e0(t,n,e):Sl(isNaN(t)?n:t)}}function Ml(e,t){var n=t-e;return n?t0(e,n):Sl(isNaN(e)?t:e)}const ko=(function e(t){var n=n0(t);function r(i,s){var o=n((i=Ni(i)).r,(s=Ni(s)).r),a=n(i.g,s.g),l=n(i.b,s.b),u=Ml(i.opacity,s.opacity);return function(h){return i.r=o(h),i.g=a(h),i.b=l(h),i.opacity=u(h),i+""}}return r.gamma=e,r})(1);function ae(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var Oi=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,gi=new RegExp(Oi.source,"g");function r0(e){return function(){return e}}function i0(e){return function(t){return e(t)+""}}function s0(e,t){var n=Oi.lastIndex=gi.lastIndex=0,r,i,s,o=-1,a=[],l=[];for(e=e+"",t=t+"";(r=Oi.exec(e))&&(i=gi.exec(t));)(s=i.index)>n&&(s=t.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,l.push({i:o,x:ae(r,i)})),n=gi.lastIndex;return n<t.length&&(s=t.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?i0(l[0].x):r0(t):(t=l.length,function(u){for(var h=0,c;h<t;++h)a[(c=l[h]).i]=c.x(u);return a.join("")})}var Po=180/Math.PI,Ri={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function El(e,t,n,r,i,s){var o,a,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,l/=a),e*r<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*Po,skewX:Math.atan(l)*Po,scaleX:o,scaleY:a}}var Un;function o0(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Ri:El(t.a,t.b,t.c,t.d,t.e,t.f)}function a0(e){return e==null||(Un||(Un=document.createElementNS("http://www.w3.org/2000/svg","g")),Un.setAttribute("transform",e),!(e=Un.transform.baseVal.consolidate()))?Ri:(e=e.matrix,El(e.a,e.b,e.c,e.d,e.e,e.f))}function $l(e,t,n,r){function i(u){return u.length?u.pop()+" ":""}function s(u,h,c,f,d,y){if(u!==c||h!==f){var w=d.push("translate(",null,t,null,n);y.push({i:w-4,x:ae(u,c)},{i:w-2,x:ae(h,f)})}else(c||f)&&d.push("translate("+c+t+f+n)}function o(u,h,c,f){u!==h?(u-h>180?h+=360:h-u>180&&(u+=360),f.push({i:c.push(i(c)+"rotate(",null,r)-2,x:ae(u,h)})):h&&c.push(i(c)+"rotate("+h+r)}function a(u,h,c,f){u!==h?f.push({i:c.push(i(c)+"skewX(",null,r)-2,x:ae(u,h)}):h&&c.push(i(c)+"skewX("+h+r)}function l(u,h,c,f,d,y){if(u!==c||h!==f){var w=d.push(i(d)+"scale(",null,",",null,")");y.push({i:w-4,x:ae(u,c)},{i:w-2,x:ae(h,f)})}else(c!==1||f!==1)&&d.push(i(d)+"scale("+c+","+f+")")}return function(u,h){var c=[],f=[];return u=e(u),h=e(h),s(u.translateX,u.translateY,h.translateX,h.translateY,c,f),o(u.rotate,h.rotate,c,f),a(u.skewX,h.skewX,c,f),l(u.scaleX,u.scaleY,h.scaleX,h.scaleY,c,f),u=h=null,function(d){for(var y=-1,w=f.length,E;++y<w;)c[(E=f[y]).i]=E.x(d);return c.join("")}}}var l0=$l(o0,"px, ","px)","deg)"),c0=$l(a0,", ",")",")"),u0=1e-12;function Co(e){return((e=Math.exp(e))+1/e)/2}function h0(e){return((e=Math.exp(e))-1/e)/2}function f0(e){return((e=Math.exp(2*e))-1)/(e+1)}const d0=(function e(t,n,r){function i(s,o){var a=s[0],l=s[1],u=s[2],h=o[0],c=o[1],f=o[2],d=h-a,y=c-l,w=d*d+y*y,E,v;if(w<u0)v=Math.log(f/u)/t,E=function(D){return[a+D*d,l+D*y,u*Math.exp(t*D*v)]};else{var T=Math.sqrt(w),A=(f*f-u*u+r*w)/(2*u*n*T),b=(f*f-u*u-r*w)/(2*f*n*T),C=Math.log(Math.sqrt(A*A+1)-A),R=Math.log(Math.sqrt(b*b+1)-b);v=(R-C)/t,E=function(D){var L=D*v,N=Co(C),z=u/(n*T)*(N*f0(t*L+C)-h0(C));return[a+z*d,l+z*y,u*N/Co(t*L+C)]}}return E.duration=v*1e3*t/Math.SQRT2,E}return i.rho=function(s){var o=Math.max(.001,+s),a=o*o,l=a*a;return e(o,a,l)},i})(Math.SQRT2,2,4);var je=0,on=0,en=0,Al=1e3,vr,an,xr=0,Ae=0,Jr=0,Sn=typeof performance=="object"&&performance.now?performance:Date,Il=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Rs(){return Ae||(Il(p0),Ae=Sn.now()+Jr)}function p0(){Ae=0}function br(){this._call=this._time=this._next=null}br.prototype=Tl.prototype={constructor:br,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Rs():+n)+(t==null?0:+t),!this._next&&an!==this&&(an?an._next=this:vr=this,an=this),this._call=e,this._time=n,Li()},stop:function(){this._call&&(this._call=null,this._time=1/0,Li())}};function Tl(e,t,n){var r=new br;return r.restart(e,t,n),r}function g0(){Rs(),++je;for(var e=vr,t;e;)(t=Ae-e._time)>=0&&e._call.call(void 0,t),e=e._next;--je}function No(){Ae=(xr=Sn.now())+Jr,je=on=0;try{g0()}finally{je=0,y0(),Ae=0}}function m0(){var e=Sn.now(),t=e-xr;t>Al&&(Jr-=t,xr=e)}function y0(){for(var e,t=vr,n,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:vr=n);an=e,Li(r)}function Li(e){if(!je){on&&(on=clearTimeout(on));var t=e-Ae;t>24?(e<1/0&&(on=setTimeout(No,e-Sn.now()-Jr)),en&&(en=clearInterval(en))):(en||(xr=Sn.now(),en=setInterval(m0,Al)),je=1,Il(No))}}function Oo(e,t,n){var r=new br;return t=t==null?0:+t,r.restart(i=>{r.stop(),e(i+t)},t,n),r}var _0=Qr("start","end","cancel","interrupt"),w0=[],kl=0,Ro=1,Di=2,ir=3,Lo=4,zi=5,sr=6;function ti(e,t,n,r,i,s){var o=e.__transition;if(!o)e.__transition={};else if(n in o)return;v0(e,n,{name:t,index:r,group:i,on:_0,tween:w0,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:kl})}function Ls(e,t){var n=zt(e,t);if(n.state>kl)throw new Error("too late; already scheduled");return n}function Yt(e,t){var n=zt(e,t);if(n.state>ir)throw new Error("too late; already running");return n}function zt(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function v0(e,t,n){var r=e.__transition,i;r[t]=n,n.timer=Tl(s,0,n.time);function s(u){n.state=Ro,n.timer.restart(o,n.delay,n.time),n.delay<=u&&o(u-n.delay)}function o(u){var h,c,f,d;if(n.state!==Ro)return l();for(h in r)if(d=r[h],d.name===n.name){if(d.state===ir)return Oo(o);d.state===Lo?(d.state=sr,d.timer.stop(),d.on.call("interrupt",e,e.__data__,d.index,d.group),delete r[h]):+h<t&&(d.state=sr,d.timer.stop(),d.on.call("cancel",e,e.__data__,d.index,d.group),delete r[h])}if(Oo(function(){n.state===ir&&(n.state=Lo,n.timer.restart(a,n.delay,n.time),a(u))}),n.state=Di,n.on.call("start",e,e.__data__,n.index,n.group),n.state===Di){for(n.state=ir,i=new Array(f=n.tween.length),h=0,c=-1;h<f;++h)(d=n.tween[h].value.call(e,e.__data__,n.index,n.group))&&(i[++c]=d);i.length=c+1}}function a(u){for(var h=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(l),n.state=zi,1),c=-1,f=i.length;++c<f;)i[c].call(e,h);n.state===zi&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){n.state=sr,n.timer.stop(),delete r[t];for(var u in r)return;delete e.__transition}}function or(e,t){var n=e.__transition,r,i,s=!0,o;if(n){t=t==null?null:t+"";for(o in n){if((r=n[o]).name!==t){s=!1;continue}i=r.state>Di&&r.state<zi,r.state=sr,r.timer.stop(),r.on.call(i?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete n[o]}s&&delete e.__transition}}function x0(e){return this.each(function(){or(this,e)})}function b0(e,t){var n,r;return function(){var i=Yt(this,e),s=i.tween;if(s!==n){r=n=s;for(var o=0,a=r.length;o<a;++o)if(r[o].name===t){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function S0(e,t,n){var r,i;if(typeof n!="function")throw new Error;return function(){var s=Yt(this,e),o=s.tween;if(o!==r){i=(r=o).slice();for(var a={name:t,value:n},l=0,u=i.length;l<u;++l)if(i[l].name===t){i[l]=a;break}l===u&&i.push(a)}s.tween=i}}function M0(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r=zt(this.node(),n).tween,i=0,s=r.length,o;i<s;++i)if((o=r[i]).name===e)return o.value;return null}return this.each((t==null?b0:S0)(n,e,t))}function Ds(e,t,n){var r=e._id;return e.each(function(){var i=Yt(this,r);(i.value||(i.value={}))[t]=n.apply(this,arguments)}),function(i){return zt(i,r).value[t]}}function Pl(e,t){var n;return(typeof t=="number"?ae:t instanceof bn?ko:(n=bn(t))?(t=n,ko):s0)(e,t)}function E0(e){return function(){this.removeAttribute(e)}}function $0(e){return function(){this.removeAttributeNS(e.space,e.local)}}function A0(e,t,n){var r,i=n+"",s;return function(){var o=this.getAttribute(e);return o===i?null:o===r?s:s=t(r=o,n)}}function I0(e,t,n){var r,i=n+"",s;return function(){var o=this.getAttributeNS(e.space,e.local);return o===i?null:o===r?s:s=t(r=o,n)}}function T0(e,t,n){var r,i,s;return function(){var o,a=n(this),l;return a==null?void this.removeAttribute(e):(o=this.getAttribute(e),l=a+"",o===l?null:o===r&&l===i?s:(i=l,s=t(r=o,a)))}}function k0(e,t,n){var r,i,s;return function(){var o,a=n(this),l;return a==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),l=a+"",o===l?null:o===r&&l===i?s:(i=l,s=t(r=o,a)))}}function P0(e,t){var n=Zr(e),r=n==="transform"?c0:Pl;return this.attrTween(e,typeof t=="function"?(n.local?k0:T0)(n,r,Ds(this,"attr."+e,t)):t==null?(n.local?$0:E0)(n):(n.local?I0:A0)(n,r,t))}function C0(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function N0(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function O0(e,t){var n,r;function i(){var s=t.apply(this,arguments);return s!==r&&(n=(r=s)&&N0(e,s)),n}return i._value=t,i}function R0(e,t){var n,r;function i(){var s=t.apply(this,arguments);return s!==r&&(n=(r=s)&&C0(e,s)),n}return i._value=t,i}function L0(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var r=Zr(e);return this.tween(n,(r.local?O0:R0)(r,t))}function D0(e,t){return function(){Ls(this,e).delay=+t.apply(this,arguments)}}function z0(e,t){return t=+t,function(){Ls(this,e).delay=t}}function U0(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?D0:z0)(t,e)):zt(this.node(),t).delay}function B0(e,t){return function(){Yt(this,e).duration=+t.apply(this,arguments)}}function F0(e,t){return t=+t,function(){Yt(this,e).duration=t}}function H0(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?B0:F0)(t,e)):zt(this.node(),t).duration}function q0(e,t){if(typeof t!="function")throw new Error;return function(){Yt(this,e).ease=t}}function G0(e){var t=this._id;return arguments.length?this.each(q0(t,e)):zt(this.node(),t).ease}function j0(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Yt(this,e).ease=n}}function V0(e){if(typeof e!="function")throw new Error;return this.each(j0(this._id,e))}function Y0(e){typeof e!="function"&&(e=ll(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,a=r[i]=[],l,u=0;u<o;++u)(l=s[u])&&e.call(l,l.__data__,u,s)&&a.push(l);return new ne(r,this._parents,this._name,this._id)}function W0(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,i=n.length,s=Math.min(r,i),o=new Array(r),a=0;a<s;++a)for(var l=t[a],u=n[a],h=l.length,c=o[a]=new Array(h),f,d=0;d<h;++d)(f=l[d]||u[d])&&(c[d]=f);for(;a<r;++a)o[a]=t[a];return new ne(o,this._parents,this._name,this._id)}function K0(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function X0(e,t,n){var r,i,s=K0(t)?Ls:Yt;return function(){var o=s(this,e),a=o.on;a!==r&&(i=(r=a).copy()).on(t,n),o.on=i}}function Q0(e,t){var n=this._id;return arguments.length<2?zt(this.node(),n).on.on(e):this.each(X0(n,e,t))}function Z0(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function J0(){return this.on("end.remove",Z0(this._id))}function td(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Cs(e));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var a=r[o],l=a.length,u=s[o]=new Array(l),h,c,f=0;f<l;++f)(h=a[f])&&(c=e.call(h,h.__data__,f,a))&&("__data__"in h&&(c.__data__=h.__data__),u[f]=c,ti(u[f],t,n,f,u,zt(h,n)));return new ne(s,this._parents,t,n)}function ed(e){var t=this._name,n=this._id;typeof e!="function"&&(e=al(e));for(var r=this._groups,i=r.length,s=[],o=[],a=0;a<i;++a)for(var l=r[a],u=l.length,h,c=0;c<u;++c)if(h=l[c]){for(var f=e.call(h,h.__data__,c,l),d,y=zt(h,n),w=0,E=f.length;w<E;++w)(d=f[w])&&ti(d,t,n,w,f,y);s.push(f),o.push(h)}return new ne(s,o,t,n)}var nd=Pn.prototype.constructor;function rd(){return new nd(this._groups,this._parents)}function id(e,t){var n,r,i;return function(){var s=Ge(this,e),o=(this.style.removeProperty(e),Ge(this,e));return s===o?null:s===n&&o===r?i:i=t(n=s,r=o)}}function Cl(e){return function(){this.style.removeProperty(e)}}function sd(e,t,n){var r,i=n+"",s;return function(){var o=Ge(this,e);return o===i?null:o===r?s:s=t(r=o,n)}}function od(e,t,n){var r,i,s;return function(){var o=Ge(this,e),a=n(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(e),Ge(this,e))),o===l?null:o===r&&l===i?s:(i=l,s=t(r=o,a))}}function ad(e,t){var n,r,i,s="style."+t,o="end."+s,a;return function(){var l=Yt(this,e),u=l.on,h=l.value[s]==null?a||(a=Cl(t)):void 0;(u!==n||i!==h)&&(r=(n=u).copy()).on(o,i=h),l.on=r}}function ld(e,t,n){var r=(e+="")=="transform"?l0:Pl;return t==null?this.styleTween(e,id(e,r)).on("end.style."+e,Cl(e)):typeof t=="function"?this.styleTween(e,od(e,r,Ds(this,"style."+e,t))).each(ad(this._id,e)):this.styleTween(e,sd(e,r,t),n).on("end.style."+e,null)}function cd(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function ud(e,t,n){var r,i;function s(){var o=t.apply(this,arguments);return o!==i&&(r=(i=o)&&cd(e,o,n)),r}return s._value=t,s}function hd(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,ud(e,t,n??""))}function fd(e){return function(){this.textContent=e}}function dd(e){return function(){var t=e(this);this.textContent=t??""}}function pd(e){return this.tween("text",typeof e=="function"?dd(Ds(this,"text",e)):fd(e==null?"":e+""))}function gd(e){return function(t){this.textContent=e.call(this,t)}}function md(e){var t,n;function r(){var i=e.apply(this,arguments);return i!==n&&(t=(n=i)&&gd(i)),t}return r._value=e,r}function yd(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,md(e))}function _d(){for(var e=this._name,t=this._id,n=Nl(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],a=o.length,l,u=0;u<a;++u)if(l=o[u]){var h=zt(l,t);ti(l,e,n,u,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new ne(r,this._parents,e,n)}function wd(){var e,t,n=this,r=n._id,i=n.size();return new Promise(function(s,o){var a={value:o},l={value:function(){--i===0&&s()}};n.each(function(){var u=Yt(this,r),h=u.on;h!==e&&(t=(e=h).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),u.on=t}),i===0&&s()})}var vd=0;function ne(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function Nl(){return++vd}var Qt=Pn.prototype;ne.prototype={constructor:ne,select:td,selectAll:ed,selectChild:Qt.selectChild,selectChildren:Qt.selectChildren,filter:Y0,merge:W0,selection:rd,transition:_d,call:Qt.call,nodes:Qt.nodes,node:Qt.node,size:Qt.size,empty:Qt.empty,each:Qt.each,on:Q0,attr:P0,attrTween:L0,style:ld,styleTween:hd,text:pd,textTween:yd,remove:J0,tween:M0,delay:U0,duration:H0,ease:G0,easeVarying:V0,end:wd,[Symbol.iterator]:Qt[Symbol.iterator]};function xd(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var bd={time:null,delay:0,duration:250,ease:xd};function Sd(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Md(e){var t,n;e instanceof ne?(t=e._id,e=e._name):(t=Nl(),(n=bd).time=Rs(),e=e==null?null:e+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],a=o.length,l,u=0;u<a;++u)(l=o[u])&&ti(l,e,t,u,o,n||Sd(l,t));return new ne(r,this._parents,e,t)}Pn.prototype.interrupt=x0;Pn.prototype.transition=Md;const te=11102230246251565e-32,ft=134217729,Ed=(3+8*te)*te;function mi(e,t,n,r,i){let s,o,a,l,u=t[0],h=r[0],c=0,f=0;h>u==h>-u?(s=u,u=t[++c]):(s=h,h=r[++f]);let d=0;if(c<e&&f<n)for(h>u==h>-u?(o=u+s,a=s-(o-u),u=t[++c]):(o=h+s,a=s-(o-h),h=r[++f]),s=o,a!==0&&(i[d++]=a);c<e&&f<n;)h>u==h>-u?(o=s+u,l=o-s,a=s-(o-l)+(u-l),u=t[++c]):(o=s+h,l=o-s,a=s-(o-l)+(h-l),h=r[++f]),s=o,a!==0&&(i[d++]=a);for(;c<e;)o=s+u,l=o-s,a=s-(o-l)+(u-l),u=t[++c],s=o,a!==0&&(i[d++]=a);for(;f<n;)o=s+h,l=o-s,a=s-(o-l)+(h-l),h=r[++f],s=o,a!==0&&(i[d++]=a);return(s!==0||d===0)&&(i[d++]=s),d}function $d(e,t){let n=t[0];for(let r=1;r<e;r++)n+=t[r];return n}function Nn(e){return new Float64Array(e)}const Ad=(3+16*te)*te,Id=(2+12*te)*te,Td=(9+64*te)*te*te,Pe=Nn(4),Do=Nn(8),zo=Nn(12),Uo=Nn(16),mt=Nn(4);function kd(e,t,n,r,i,s,o){let a,l,u,h,c,f,d,y,w,E,v,T,A,b,C,R,D,L;const N=e-i,z=n-i,I=t-s,F=r-s;b=N*F,f=ft*N,d=f-(f-N),y=N-d,f=ft*F,w=f-(f-F),E=F-w,C=y*E-(b-d*w-y*w-d*E),R=I*z,f=ft*I,d=f-(f-I),y=I-d,f=ft*z,w=f-(f-z),E=z-w,D=y*E-(R-d*w-y*w-d*E),v=C-D,c=C-v,Pe[0]=C-(v+c)+(c-D),T=b+v,c=T-b,A=b-(T-c)+(v-c),v=A-R,c=A-v,Pe[1]=A-(v+c)+(c-R),L=T+v,c=L-T,Pe[2]=T-(L-c)+(v-c),Pe[3]=L;let _=$d(4,Pe),p=Id*o;if(_>=p||-_>=p||(c=e-N,a=e-(N+c)+(c-i),c=n-z,u=n-(z+c)+(c-i),c=t-I,l=t-(I+c)+(c-s),c=r-F,h=r-(F+c)+(c-s),a===0&&l===0&&u===0&&h===0)||(p=Td*o+Ed*Math.abs(_),_+=N*h+F*a-(I*u+z*l),_>=p||-_>=p))return _;b=a*F,f=ft*a,d=f-(f-a),y=a-d,f=ft*F,w=f-(f-F),E=F-w,C=y*E-(b-d*w-y*w-d*E),R=l*z,f=ft*l,d=f-(f-l),y=l-d,f=ft*z,w=f-(f-z),E=z-w,D=y*E-(R-d*w-y*w-d*E),v=C-D,c=C-v,mt[0]=C-(v+c)+(c-D),T=b+v,c=T-b,A=b-(T-c)+(v-c),v=A-R,c=A-v,mt[1]=A-(v+c)+(c-R),L=T+v,c=L-T,mt[2]=T-(L-c)+(v-c),mt[3]=L;const m=mi(4,Pe,4,mt,Do);b=N*h,f=ft*N,d=f-(f-N),y=N-d,f=ft*h,w=f-(f-h),E=h-w,C=y*E-(b-d*w-y*w-d*E),R=I*u,f=ft*I,d=f-(f-I),y=I-d,f=ft*u,w=f-(f-u),E=u-w,D=y*E-(R-d*w-y*w-d*E),v=C-D,c=C-v,mt[0]=C-(v+c)+(c-D),T=b+v,c=T-b,A=b-(T-c)+(v-c),v=A-R,c=A-v,mt[1]=A-(v+c)+(c-R),L=T+v,c=L-T,mt[2]=T-(L-c)+(v-c),mt[3]=L;const g=mi(m,Do,4,mt,zo);b=a*h,f=ft*a,d=f-(f-a),y=a-d,f=ft*h,w=f-(f-h),E=h-w,C=y*E-(b-d*w-y*w-d*E),R=l*u,f=ft*l,d=f-(f-l),y=l-d,f=ft*u,w=f-(f-u),E=u-w,D=y*E-(R-d*w-y*w-d*E),v=C-D,c=C-v,mt[0]=C-(v+c)+(c-D),T=b+v,c=T-b,A=b-(T-c)+(v-c),v=A-R,c=A-v,mt[1]=A-(v+c)+(c-R),L=T+v,c=L-T,mt[2]=T-(L-c)+(v-c),mt[3]=L;const x=mi(g,zo,4,mt,Uo);return Uo[x-1]}function Bn(e,t,n,r,i,s){const o=(t-s)*(n-i),a=(e-i)*(r-s),l=o-a,u=Math.abs(o+a);return Math.abs(l)>=Ad*u?l:-kd(e,t,n,r,i,s,u)}const Bo=Math.pow(2,-52),Fn=new Uint32Array(512);class Sr{static from(t,n=Rd,r=Ld){const i=t.length,s=new Float64Array(i*2);for(let o=0;o<i;o++){const a=t[o];s[2*o]=n(a),s[2*o+1]=r(a)}return new Sr(s)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const r=Math.max(2*n-5,0);this._triangles=new Uint32Array(r*3),this._halfedges=new Int32Array(r*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:r,_hullTri:i,_hullHash:s}=this,o=t.length>>1;let a=1/0,l=1/0,u=-1/0,h=-1/0;for(let N=0;N<o;N++){const z=t[2*N],I=t[2*N+1];z<a&&(a=z),I<l&&(l=I),z>u&&(u=z),I>h&&(h=I),this._ids[N]=N}const c=(a+u)/2,f=(l+h)/2;let d,y,w;for(let N=0,z=1/0;N<o;N++){const I=yi(c,f,t[2*N],t[2*N+1]);I<z&&(d=N,z=I)}const E=t[2*d],v=t[2*d+1];for(let N=0,z=1/0;N<o;N++){if(N===d)continue;const I=yi(E,v,t[2*N],t[2*N+1]);I<z&&I>0&&(y=N,z=I)}let T=t[2*y],A=t[2*y+1],b=1/0;for(let N=0;N<o;N++){if(N===d||N===y)continue;const z=Nd(E,v,T,A,t[2*N],t[2*N+1]);z<b&&(w=N,b=z)}let C=t[2*w],R=t[2*w+1];if(b===1/0){for(let I=0;I<o;I++)this._dists[I]=t[2*I]-t[0]||t[2*I+1]-t[1];ze(this._ids,this._dists,0,o-1);const N=new Uint32Array(o);let z=0;for(let I=0,F=-1/0;I<o;I++){const _=this._ids[I],p=this._dists[_];p>F&&(N[z++]=_,F=p)}this.hull=N.subarray(0,z),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(Bn(E,v,T,A,C,R)<0){const N=y,z=T,I=A;y=w,T=C,A=R,w=N,C=z,R=I}const D=Od(E,v,T,A,C,R);this._cx=D.x,this._cy=D.y;for(let N=0;N<o;N++)this._dists[N]=yi(t[2*N],t[2*N+1],D.x,D.y);ze(this._ids,this._dists,0,o-1),this._hullStart=d;let L=3;r[d]=n[w]=y,r[y]=n[d]=w,r[w]=n[y]=d,i[d]=0,i[y]=1,i[w]=2,s.fill(-1),s[this._hashKey(E,v)]=d,s[this._hashKey(T,A)]=y,s[this._hashKey(C,R)]=w,this.trianglesLen=0,this._addTriangle(d,y,w,-1,-1,-1);for(let N=0,z,I;N<this._ids.length;N++){const F=this._ids[N],_=t[2*F],p=t[2*F+1];if(N>0&&Math.abs(_-z)<=Bo&&Math.abs(p-I)<=Bo||(z=_,I=p,F===d||F===y||F===w))continue;let m=0;for(let O=0,B=this._hashKey(_,p);O<this._hashSize&&(m=s[(B+O)%this._hashSize],!(m!==-1&&m!==r[m]));O++);m=n[m];let g=m,x;for(;x=r[g],Bn(_,p,t[2*g],t[2*g+1],t[2*x],t[2*x+1])>=0;)if(g=x,g===m){g=-1;break}if(g===-1)continue;let P=this._addTriangle(g,F,r[g],-1,-1,i[g]);i[F]=this._legalize(P+2),i[g]=P,L++;let k=r[g];for(;x=r[k],Bn(_,p,t[2*k],t[2*k+1],t[2*x],t[2*x+1])<0;)P=this._addTriangle(k,F,x,i[F],-1,i[k]),i[F]=this._legalize(P+2),r[k]=k,L--,k=x;if(g===m)for(;x=n[g],Bn(_,p,t[2*x],t[2*x+1],t[2*g],t[2*g+1])<0;)P=this._addTriangle(x,F,g,-1,i[g],i[x]),this._legalize(P+2),i[x]=P,r[g]=g,L--,g=x;this._hullStart=n[F]=g,r[g]=n[k]=F,r[F]=k,s[this._hashKey(_,p)]=F,s[this._hashKey(t[2*g],t[2*g+1])]=g}this.hull=new Uint32Array(L);for(let N=0,z=this._hullStart;N<L;N++)this.hull[N]=z,z=r[z];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(Pd(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:r,coords:i}=this;let s=0,o=0;for(;;){const a=r[t],l=t-t%3;if(o=l+(t+2)%3,a===-1){if(s===0)break;t=Fn[--s];continue}const u=a-a%3,h=l+(t+1)%3,c=u+(a+2)%3,f=n[o],d=n[t],y=n[h],w=n[c];if(Cd(i[2*f],i[2*f+1],i[2*d],i[2*d+1],i[2*y],i[2*y+1],i[2*w],i[2*w+1])){n[t]=w,n[a]=f;const v=r[c];if(v===-1){let A=this._hullStart;do{if(this._hullTri[A]===c){this._hullTri[A]=t;break}A=this._hullPrev[A]}while(A!==this._hullStart)}this._link(t,v),this._link(a,r[o]),this._link(o,c);const T=u+(a+1)%3;s<Fn.length&&(Fn[s++]=T)}else{if(s===0)break;t=Fn[--s]}}return o}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,r,i,s,o){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=n,this._triangles[a+2]=r,this._link(a,i),this._link(a+1,s),this._link(a+2,o),this.trianglesLen+=3,a}}function Pd(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function yi(e,t,n,r){const i=e-n,s=t-r;return i*i+s*s}function Cd(e,t,n,r,i,s,o,a){const l=e-o,u=t-a,h=n-o,c=r-a,f=i-o,d=s-a,y=l*l+u*u,w=h*h+c*c,E=f*f+d*d;return l*(c*E-w*d)-u*(h*E-w*f)+y*(h*d-c*f)<0}function Nd(e,t,n,r,i,s){const o=n-e,a=r-t,l=i-e,u=s-t,h=o*o+a*a,c=l*l+u*u,f=.5/(o*u-a*l),d=(u*h-a*c)*f,y=(o*c-l*h)*f;return d*d+y*y}function Od(e,t,n,r,i,s){const o=n-e,a=r-t,l=i-e,u=s-t,h=o*o+a*a,c=l*l+u*u,f=.5/(o*u-a*l),d=e+(u*h-a*c)*f,y=t+(o*c-l*h)*f;return{x:d,y}}function ze(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const s=e[i],o=t[s];let a=i-1;for(;a>=n&&t[e[a]]>o;)e[a+1]=e[a--];e[a+1]=s}else{const i=n+r>>1;let s=n+1,o=r;nn(e,i,s),t[e[n]]>t[e[r]]&&nn(e,n,r),t[e[s]]>t[e[r]]&&nn(e,s,r),t[e[n]]>t[e[s]]&&nn(e,n,s);const a=e[s],l=t[a];for(;;){do s++;while(t[e[s]]<l);do o--;while(t[e[o]]>l);if(o<s)break;nn(e,s,o)}e[n+1]=e[o],e[o]=a,r-s+1>=o-n?(ze(e,t,s,r),ze(e,t,n,o-1)):(ze(e,t,n,o-1),ze(e,t,s,r))}}function nn(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function Rd(e){return e[0]}function Ld(e){return e[1]}const Fo=1e-6;class ve{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,r){t=+t,n=+n,r=+r;const i=t+r,s=n;if(r<0)throw new Error("negative radius");this._x1===null?this._+=`M${i},${s}`:(Math.abs(this._x1-i)>Fo||Math.abs(this._y1-s)>Fo)&&(this._+="L"+i+","+s),r&&(this._+=`A${r},${r},0,1,1,${t-r},${n}A${r},${r},0,1,1,${this._x1=i},${this._y1=s}`)}rect(t,n,r,i){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+r}v${+i}h${-r}Z`}value(){return this._||null}}class Ui{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}class Dd{constructor(t,[n,r,i,s]=[0,0,960,500]){if(!((i=+i)>=(n=+n))||!((s=+s)>=(r=+r)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=i,this.xmin=n,this.ymax=s,this.ymin=r,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:r},vectors:i}=this;let s,o;const a=this.circumcenters=this._circumcenters.subarray(0,r.length/3*2);for(let w=0,E=0,v=r.length,T,A;w<v;w+=3,E+=2){const b=r[w]*2,C=r[w+1]*2,R=r[w+2]*2,D=t[b],L=t[b+1],N=t[C],z=t[C+1],I=t[R],F=t[R+1],_=N-D,p=z-L,m=I-D,g=F-L,x=(_*g-p*m)*2;if(Math.abs(x)<1e-9){if(s===void 0){s=o=0;for(const k of n)s+=t[k*2],o+=t[k*2+1];s/=n.length,o/=n.length}const P=1e9*Math.sign((s-D)*g-(o-L)*m);T=(D+I)/2-P*g,A=(L+F)/2+P*m}else{const P=1/x,k=_*_+p*p,O=m*m+g*g;T=D+(g*k-p*O)*P,A=L+(_*O-m*k)*P}a[E]=T,a[E+1]=A}let l=n[n.length-1],u,h=l*4,c,f=t[2*l],d,y=t[2*l+1];i.fill(0);for(let w=0;w<n.length;++w)l=n[w],u=h,c=f,d=y,h=l*4,f=t[2*l],y=t[2*l+1],i[u+2]=i[h]=d-y,i[u+3]=i[h+1]=f-c}render(t){const n=t==null?t=new ve:void 0,{delaunay:{halfedges:r,inedges:i,hull:s},circumcenters:o,vectors:a}=this;if(s.length<=1)return null;for(let h=0,c=r.length;h<c;++h){const f=r[h];if(f<h)continue;const d=Math.floor(h/3)*2,y=Math.floor(f/3)*2,w=o[d],E=o[d+1],v=o[y],T=o[y+1];this._renderSegment(w,E,v,T,t)}let l,u=s[s.length-1];for(let h=0;h<s.length;++h){l=u,u=s[h];const c=Math.floor(i[u]/3)*2,f=o[c],d=o[c+1],y=l*4,w=this._project(f,d,a[y+2],a[y+3]);w&&this._renderSegment(f,d,w[0],w[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new ve:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const r=n==null?n=new ve:void 0,i=this._clip(t);if(i===null||!i.length)return;n.moveTo(i[0],i[1]);let s=i.length;for(;i[0]===i[s-2]&&i[1]===i[s-1]&&s>1;)s-=2;for(let o=2;o<s;o+=2)(i[o]!==i[o-2]||i[o+1]!==i[o-1])&&n.lineTo(i[o],i[o+1]);return n.closePath(),r&&r.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,r=t.length/2;n<r;++n){const i=this.cellPolygon(n);i&&(i.index=n,yield i)}}cellPolygon(t){const n=new Ui;return this.renderCell(t,n),n.value()}_renderSegment(t,n,r,i,s){let o;const a=this._regioncode(t,n),l=this._regioncode(r,i);a===0&&l===0?(s.moveTo(t,n),s.lineTo(r,i)):(o=this._clipSegment(t,n,r,i,a,l))&&(s.moveTo(o[0],o[1]),s.lineTo(o[2],o[3]))}contains(t,n,r){return n=+n,n!==n||(r=+r,r!==r)?!1:this.delaunay._step(t,n,r)===t}*neighbors(t){const n=this._clip(t);if(n)for(const r of this.delaunay.neighbors(t)){const i=this._clip(r);if(i){t:for(let s=0,o=n.length;s<o;s+=2)for(let a=0,l=i.length;a<l;a+=2)if(n[s]===i[a]&&n[s+1]===i[a+1]&&n[(s+2)%o]===i[(a+l-2)%l]&&n[(s+3)%o]===i[(a+l-1)%l]){yield r;break t}}}}_cell(t){const{circumcenters:n,delaunay:{inedges:r,halfedges:i,triangles:s}}=this,o=r[t];if(o===-1)return null;const a=[];let l=o;do{const u=Math.floor(l/3);if(a.push(n[u*2],n[u*2+1]),l=l%3===2?l-2:l+1,s[l]!==t)break;l=i[l]}while(l!==o&&l!==-1);return a}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:r}=this,i=t*4;return this._simplify(r[i]||r[i+1]?this._clipInfinite(t,n,r[i],r[i+1],r[i+2],r[i+3]):this._clipFinite(t,n))}_clipFinite(t,n){const r=n.length;let i=null,s,o,a=n[r-2],l=n[r-1],u,h=this._regioncode(a,l),c,f=0;for(let d=0;d<r;d+=2)if(s=a,o=l,a=n[d],l=n[d+1],u=h,h=this._regioncode(a,l),u===0&&h===0)c=f,f=0,i?i.push(a,l):i=[a,l];else{let y,w,E,v,T;if(u===0){if((y=this._clipSegment(s,o,a,l,u,h))===null)continue;[w,E,v,T]=y}else{if((y=this._clipSegment(a,l,s,o,h,u))===null)continue;[v,T,w,E]=y,c=f,f=this._edgecode(w,E),c&&f&&this._edge(t,c,f,i,i.length),i?i.push(w,E):i=[w,E]}c=f,f=this._edgecode(v,T),c&&f&&this._edge(t,c,f,i,i.length),i?i.push(v,T):i=[v,T]}if(i)c=f,f=this._edgecode(i[0],i[1]),c&&f&&this._edge(t,c,f,i,i.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return i}_clipSegment(t,n,r,i,s,o){const a=s<o;for(a&&([t,n,r,i,s,o]=[r,i,t,n,o,s]);;){if(s===0&&o===0)return a?[r,i,t,n]:[t,n,r,i];if(s&o)return null;let l,u,h=s||o;h&8?(l=t+(r-t)*(this.ymax-n)/(i-n),u=this.ymax):h&4?(l=t+(r-t)*(this.ymin-n)/(i-n),u=this.ymin):h&2?(u=n+(i-n)*(this.xmax-t)/(r-t),l=this.xmax):(u=n+(i-n)*(this.xmin-t)/(r-t),l=this.xmin),s?(t=l,n=u,s=this._regioncode(t,n)):(r=l,i=u,o=this._regioncode(r,i))}}_clipInfinite(t,n,r,i,s,o){let a=Array.from(n),l;if((l=this._project(a[0],a[1],r,i))&&a.unshift(l[0],l[1]),(l=this._project(a[a.length-2],a[a.length-1],s,o))&&a.push(l[0],l[1]),a=this._clipFinite(t,a))for(let u=0,h=a.length,c,f=this._edgecode(a[h-2],a[h-1]);u<h;u+=2)c=f,f=this._edgecode(a[u],a[u+1]),c&&f&&(u=this._edge(t,c,f,a,u),h=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,n,r,i,s){for(;n!==r;){let o,a;switch(n){case 5:n=4;continue;case 4:n=6,o=this.xmax,a=this.ymin;break;case 6:n=2;continue;case 2:n=10,o=this.xmax,a=this.ymax;break;case 10:n=8;continue;case 8:n=9,o=this.xmin,a=this.ymax;break;case 9:n=1;continue;case 1:n=5,o=this.xmin,a=this.ymin;break}(i[s]!==o||i[s+1]!==a)&&this.contains(t,o,a)&&(i.splice(s,0,o,a),s+=2)}return s}_project(t,n,r,i){let s=1/0,o,a,l;if(i<0){if(n<=this.ymin)return null;(o=(this.ymin-n)/i)<s&&(l=this.ymin,a=t+(s=o)*r)}else if(i>0){if(n>=this.ymax)return null;(o=(this.ymax-n)/i)<s&&(l=this.ymax,a=t+(s=o)*r)}if(r>0){if(t>=this.xmax)return null;(o=(this.xmax-t)/r)<s&&(a=this.xmax,l=n+(s=o)*i)}else if(r<0){if(t<=this.xmin)return null;(o=(this.xmin-t)/r)<s&&(a=this.xmin,l=n+(s=o)*i)}return[a,l]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}_simplify(t){if(t&&t.length>4){for(let n=0;n<t.length;n+=2){const r=(n+2)%t.length,i=(n+4)%t.length;(t[n]===t[r]&&t[r]===t[i]||t[n+1]===t[r+1]&&t[r+1]===t[i+1])&&(t.splice(r,2),n-=2)}t.length||(t=null)}return t}}const zd=2*Math.PI,Ce=Math.pow;function Ud(e){return e[0]}function Bd(e){return e[1]}function Fd(e){const{triangles:t,coords:n}=e;for(let r=0;r<t.length;r+=3){const i=2*t[r],s=2*t[r+1],o=2*t[r+2];if((n[o]-n[i])*(n[s+1]-n[i+1])-(n[s]-n[i])*(n[o+1]-n[i+1])>1e-10)return!1}return!0}function Hd(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class zs{static from(t,n=Ud,r=Bd,i){return new zs("length"in t?qd(t,n,r,i):Float64Array.from(Gd(t,n,r,i)))}constructor(t){this._delaunator=new Sr(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&Fd(t)){this.collinear=Int32Array.from({length:n.length/2},(f,d)=>d).sort((f,d)=>n[2*f]-n[2*d]||n[2*f+1]-n[2*d+1]);const l=this.collinear[0],u=this.collinear[this.collinear.length-1],h=[n[2*l],n[2*l+1],n[2*u],n[2*u+1]],c=1e-8*Math.hypot(h[3]-h[1],h[2]-h[0]);for(let f=0,d=n.length/2;f<d;++f){const y=Hd(n[2*f],n[2*f+1],c);n[2*f]=y[0],n[2*f+1]=y[1]}this._delaunator=new Sr(n)}else delete this.collinear;const r=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let l=0,u=r.length;l<u;++l){const h=s[l%3===2?l-2:l+1];(r[l]===-1||o[h]===-1)&&(o[h]=l)}for(let l=0,u=i.length;l<u;++l)a[i[l]]=l;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],o[i[0]]=1,i.length===2&&(o[i[1]]=0,this.triangles[1]=i[1],this.triangles[2]=i[1]))}voronoi(t){return new Dd(this,t)}*neighbors(t){const{inedges:n,hull:r,_hullIndex:i,halfedges:s,triangles:o,collinear:a}=this;if(a){const c=a.indexOf(t);c>0&&(yield a[c-1]),c<a.length-1&&(yield a[c+1]);return}const l=n[t];if(l===-1)return;let u=l,h=-1;do{if(yield h=o[u],u=u%3===2?u-2:u+1,o[u]!==t)return;if(u=s[u],u===-1){const c=r[(i[t]+1)%r.length];c!==h&&(yield c);return}}while(u!==l)}find(t,n,r=0){if(t=+t,t!==t||(n=+n,n!==n))return-1;const i=r;let s;for(;(s=this._step(r,t,n))>=0&&s!==r&&s!==i;)r=s;return s}_step(t,n,r){const{inedges:i,hull:s,_hullIndex:o,halfedges:a,triangles:l,points:u}=this;if(i[t]===-1||!u.length)return(t+1)%(u.length>>1);let h=t,c=Ce(n-u[t*2],2)+Ce(r-u[t*2+1],2);const f=i[t];let d=f;do{let y=l[d];const w=Ce(n-u[y*2],2)+Ce(r-u[y*2+1],2);if(w<c&&(c=w,h=y),d=d%3===2?d-2:d+1,l[d]!==t)break;if(d=a[d],d===-1){if(d=s[(o[t]+1)%s.length],d!==y&&Ce(n-u[d*2],2)+Ce(r-u[d*2+1],2)<c)return d;break}}while(d!==f);return h}render(t){const n=t==null?t=new ve:void 0,{points:r,halfedges:i,triangles:s}=this;for(let o=0,a=i.length;o<a;++o){const l=i[o];if(l<o)continue;const u=s[o]*2,h=s[l]*2;t.moveTo(r[u],r[u+1]),t.lineTo(r[h],r[h+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n){n===void 0&&(!t||typeof t.moveTo!="function")&&(n=t,t=null),n=n==null?2:+n;const r=t==null?t=new ve:void 0,{points:i}=this;for(let s=0,o=i.length;s<o;s+=2){const a=i[s],l=i[s+1];t.moveTo(a+n,l),t.arc(a,l,n,0,zd)}return r&&r.value()}renderHull(t){const n=t==null?t=new ve:void 0,{hull:r,points:i}=this,s=r[0]*2,o=r.length;t.moveTo(i[s],i[s+1]);for(let a=1;a<o;++a){const l=2*r[a];t.lineTo(i[l],i[l+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new Ui;return this.renderHull(t),t.value()}renderTriangle(t,n){const r=n==null?n=new ve:void 0,{points:i,triangles:s}=this,o=s[t*=3]*2,a=s[t+1]*2,l=s[t+2]*2;return n.moveTo(i[o],i[o+1]),n.lineTo(i[a],i[a+1]),n.lineTo(i[l],i[l+1]),n.closePath(),r&&r.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,r=t.length/3;n<r;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new Ui;return this.renderTriangle(t,n),n.value()}}function qd(e,t,n,r){const i=e.length,s=new Float64Array(i*2);for(let o=0;o<i;++o){const a=e[o];s[o*2]=t.call(r,a,o,e),s[o*2+1]=n.call(r,a,o,e)}return s}function*Gd(e,t,n,r){let i=0;for(const s of e)yield t.call(r,s,i,e),yield n.call(r,s,i,e),++i}function jd(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Mr(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function Vd(e){return e=Mr(Math.abs(e)),e?e[1]:NaN}function Yd(e,t){return function(n,r){for(var i=n.length,s=[],o=0,a=e[0],l=0;i>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),s.push(n.substring(i-=a,i+a)),!((l+=a+1)>r));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function Wd(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var Kd=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Bi(e){if(!(t=Kd.exec(e)))throw new Error("invalid format: "+e);var t;return new Us({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Bi.prototype=Us.prototype;function Us(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Us.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Xd(e){t:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+e[n])break t;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(i+1):e}var Ol;function Qd(e,t){var n=Mr(e,t);if(!n)return e+"";var r=n[0],i=n[1],s=i-(Ol=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+Mr(e,Math.max(0,t+s-1))[0]}function Ho(e,t){var n=Mr(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const qo={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:jd,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Ho(e*100,t),r:Ho,s:Qd,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Go(e){return e}var jo=Array.prototype.map,Vo=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Zd(e){var t=e.grouping===void 0||e.thousands===void 0?Go:Yd(jo.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",r=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?Go:Wd(jo.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function u(c){c=Bi(c);var f=c.fill,d=c.align,y=c.sign,w=c.symbol,E=c.zero,v=c.width,T=c.comma,A=c.precision,b=c.trim,C=c.type;C==="n"?(T=!0,C="g"):qo[C]||(A===void 0&&(A=12),b=!0,C="g"),(E||f==="0"&&d==="=")&&(E=!0,f="0",d="=");var R=w==="$"?n:w==="#"&&/[boxX]/.test(C)?"0"+C.toLowerCase():"",D=w==="$"?r:/[%p]/.test(C)?o:"",L=qo[C],N=/[defgprs%]/.test(C);A=A===void 0?6:/[gprs]/.test(C)?Math.max(1,Math.min(21,A)):Math.max(0,Math.min(20,A));function z(I){var F=R,_=D,p,m,g;if(C==="c")_=L(I)+_,I="";else{I=+I;var x=I<0||1/I<0;if(I=isNaN(I)?l:L(Math.abs(I),A),b&&(I=Xd(I)),x&&+I==0&&y!=="+"&&(x=!1),F=(x?y==="("?y:a:y==="-"||y==="("?"":y)+F,_=(C==="s"?Vo[8+Ol/3]:"")+_+(x&&y==="("?")":""),N){for(p=-1,m=I.length;++p<m;)if(g=I.charCodeAt(p),48>g||g>57){_=(g===46?i+I.slice(p+1):I.slice(p))+_,I=I.slice(0,p);break}}}T&&!E&&(I=t(I,1/0));var P=F.length+I.length+_.length,k=P<v?new Array(v-P+1).join(f):"";switch(T&&E&&(I=t(k+I,k.length?v-_.length:1/0),k=""),d){case"<":I=F+I+_+k;break;case"=":I=F+k+I+_;break;case"^":I=k.slice(0,P=k.length>>1)+F+I+_+k.slice(P);break;default:I=k+F+I+_;break}return s(I)}return z.toString=function(){return c+""},z}function h(c,f){var d=u((c=Bi(c),c.type="f",c)),y=Math.max(-8,Math.min(8,Math.floor(Vd(f)/3)))*3,w=Math.pow(10,-y),E=Vo[8+y/3];return function(v){return d(w*v)+E}}return{format:u,formatPrefix:h}}var Hn,ei;Jd({thousands:",",grouping:[3],currency:["$",""]});function Jd(e){return Hn=Zd(e),ei=Hn.format,Hn.formatPrefix,Hn}var V=1e-6,Fi=1e-12,W=Math.PI,pt=W/2,Yo=W/4,$t=W*2,yt=180/W,K=W/180,et=Math.abs,ni=Math.atan,re=Math.atan2,G=Math.cos,qn=Math.ceil,Rl=Math.exp,Hi=Math.hypot,Ll=Math.log,q=Math.sin,tp=Math.sign||function(e){return e>0?1:e<0?-1:0},Wt=Math.sqrt,Dl=Math.tan;function ep(e){return e>1?0:e<-1?W:Math.acos(e)}function ie(e){return e>1?pt:e<-1?-pt:Math.asin(e)}function lt(){}function Er(e,t){e&&Ko.hasOwnProperty(e.type)&&Ko[e.type](e,t)}var Wo={Feature:function(e,t){Er(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)Er(n[r].geometry,t)}},Ko={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){qi(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)qi(n[r],t,0)},Polygon:function(e,t){Xo(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)Xo(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)Er(n[r],t)}};function qi(e,t,n){var r=-1,i=e.length-n,s;for(t.lineStart();++r<i;)s=e[r],t.point(s[0],s[1],s[2]);t.lineEnd()}function Xo(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)qi(e[n],t,1);t.polygonEnd()}function ce(e,t){e&&Wo.hasOwnProperty(e.type)?Wo[e.type](e,t):Er(e,t)}function Gi(e){return[re(e[1],e[0]),ie(e[2])]}function Ve(e){var t=e[0],n=e[1],r=G(n);return[r*G(t),r*q(t),q(n)]}function Gn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function $r(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function _i(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function jn(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function ji(e){var t=Wt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var ln,Ar,Ir,Tr,kr,Pr,Cr,Nr,Vi,Yi,Wi,zl,Ul,_t,wt,vt,Rt={sphere:lt,point:Bs,lineStart:Qo,lineEnd:Zo,polygonStart:function(){Rt.lineStart=ip,Rt.lineEnd=sp},polygonEnd:function(){Rt.lineStart=Qo,Rt.lineEnd=Zo}};function Bs(e,t){e*=K,t*=K;var n=G(t);On(n*G(e),n*q(e),q(t))}function On(e,t,n){++ln,Ir+=(e-Ir)/ln,Tr+=(t-Tr)/ln,kr+=(n-kr)/ln}function Qo(){Rt.point=np}function np(e,t){e*=K,t*=K;var n=G(t);_t=n*G(e),wt=n*q(e),vt=q(t),Rt.point=rp,On(_t,wt,vt)}function rp(e,t){e*=K,t*=K;var n=G(t),r=n*G(e),i=n*q(e),s=q(t),o=re(Wt((o=wt*s-vt*i)*o+(o=vt*r-_t*s)*o+(o=_t*i-wt*r)*o),_t*r+wt*i+vt*s);Ar+=o,Pr+=o*(_t+(_t=r)),Cr+=o*(wt+(wt=i)),Nr+=o*(vt+(vt=s)),On(_t,wt,vt)}function Zo(){Rt.point=Bs}function ip(){Rt.point=op}function sp(){Bl(zl,Ul),Rt.point=Bs}function op(e,t){zl=e,Ul=t,e*=K,t*=K,Rt.point=Bl;var n=G(t);_t=n*G(e),wt=n*q(e),vt=q(t),On(_t,wt,vt)}function Bl(e,t){e*=K,t*=K;var n=G(t),r=n*G(e),i=n*q(e),s=q(t),o=wt*s-vt*i,a=vt*r-_t*s,l=_t*i-wt*r,u=Hi(o,a,l),h=ie(u),c=u&&-h/u;Vi.add(c*o),Yi.add(c*a),Wi.add(c*l),Ar+=h,Pr+=h*(_t+(_t=r)),Cr+=h*(wt+(wt=i)),Nr+=h*(vt+(vt=s)),On(_t,wt,vt)}function Jo(e){ln=Ar=Ir=Tr=kr=Pr=Cr=Nr=0,Vi=new Dt,Yi=new Dt,Wi=new Dt,ce(e,Rt);var t=+Vi,n=+Yi,r=+Wi,i=Hi(t,n,r);return i<Fi&&(t=Pr,n=Cr,r=Nr,Ar<V&&(t=Ir,n=Tr,r=kr),i=Hi(t,n,r),i<Fi)?[NaN,NaN]:[re(n,t)*yt,ie(r/i)*yt]}function Ki(e,t){function n(r,i){return r=e(r,i),t(r[0],r[1])}return e.invert&&t.invert&&(n.invert=function(r,i){return r=t.invert(r,i),r&&e.invert(r[0],r[1])}),n}function Xi(e,t){return et(e)>W&&(e-=Math.round(e/$t)*$t),[e,t]}Xi.invert=Xi;function Fl(e,t,n){return(e%=$t)?t||n?Ki(ea(e),na(t,n)):ea(e):t||n?na(t,n):Xi}function ta(e){return function(t,n){return t+=e,et(t)>W&&(t-=Math.round(t/$t)*$t),[t,n]}}function ea(e){var t=ta(e);return t.invert=ta(-e),t}function na(e,t){var n=G(e),r=q(e),i=G(t),s=q(t);function o(a,l){var u=G(l),h=G(a)*u,c=q(a)*u,f=q(l),d=f*n+h*r;return[re(c*i-d*s,h*n-f*r),ie(d*i+c*s)]}return o.invert=function(a,l){var u=G(l),h=G(a)*u,c=q(a)*u,f=q(l),d=f*i-c*s;return[re(c*i+f*s,h*n+d*r),ie(d*n-h*r)]},o}function Or(e){e=Fl(e[0]*K,e[1]*K,e.length>2?e[2]*K:0);function t(n){return n=e(n[0]*K,n[1]*K),n[0]*=yt,n[1]*=yt,n}return t.invert=function(n){return n=e.invert(n[0]*K,n[1]*K),n[0]*=yt,n[1]*=yt,n},t}function ap(e,t,n,r,i,s){if(n){var o=G(t),a=q(t),l=r*n;i==null?(i=t+r*$t,s=t-l/2):(i=ra(o,i),s=ra(o,s),(r>0?i<s:i>s)&&(i+=r*$t));for(var u,h=i;r>0?h>s:h<s;h-=l)u=Gi([o,-a*G(h),-a*q(h)]),e.point(u[0],u[1])}}function ra(e,t){t=Ve(t),t[0]-=e,ji(t);var n=ep(-t[1]);return((-t[2]<0?-n:n)+$t-V)%$t}function Hl(){var e=[],t;return{point:function(n,r,i){t.push([n,r,i])},lineStart:function(){e.push(t=[])},lineEnd:lt,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function ar(e,t){return et(e[0]-t[0])<V&&et(e[1]-t[1])<V}function Vn(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function ql(e,t,n,r,i){var s=[],o=[],a,l;if(e.forEach(function(y){if(!((w=y.length-1)<=0)){var w,E=y[0],v=y[w],T;if(ar(E,v)){if(!E[2]&&!v[2]){for(i.lineStart(),a=0;a<w;++a)i.point((E=y[a])[0],E[1]);i.lineEnd();return}v[0]+=2*V}s.push(T=new Vn(E,y,null,!0)),o.push(T.o=new Vn(E,null,T,!1)),s.push(T=new Vn(v,y,null,!1)),o.push(T.o=new Vn(v,null,T,!0))}}),!!s.length){for(o.sort(t),ia(s),ia(o),a=0,l=o.length;a<l;++a)o[a].e=n=!n;for(var u=s[0],h,c;;){for(var f=u,d=!0;f.v;)if((f=f.n)===u)return;h=f.z,i.lineStart();do{if(f.v=f.o.v=!0,f.e){if(d)for(a=0,l=h.length;a<l;++a)i.point((c=h[a])[0],c[1]);else r(f.x,f.n.x,1,i);f=f.n}else{if(d)for(h=f.p.z,a=h.length-1;a>=0;--a)i.point((c=h[a])[0],c[1]);else r(f.x,f.p.x,-1,i);f=f.p}f=f.o,h=f.z,d=!d}while(!f.v);i.lineEnd()}}}function ia(e){if(t=e.length){for(var t,n=0,r=e[0],i;++n<t;)r.n=i=e[n],i.p=r,r=i;r.n=i=e[0],i.p=r}}function wi(e){return et(e[0])<=W?e[0]:tp(e[0])*((et(e[0])+W)%$t-W)}function lp(e,t){var n=wi(t),r=t[1],i=q(r),s=[q(n),-G(n),0],o=0,a=0,l=new Dt;i===1?r=pt+V:i===-1&&(r=-pt-V);for(var u=0,h=e.length;u<h;++u)if(f=(c=e[u]).length)for(var c,f,d=c[f-1],y=wi(d),w=d[1]/2+Yo,E=q(w),v=G(w),T=0;T<f;++T,y=b,E=R,v=D,d=A){var A=c[T],b=wi(A),C=A[1]/2+Yo,R=q(C),D=G(C),L=b-y,N=L>=0?1:-1,z=N*L,I=z>W,F=E*R;if(l.add(re(F*N*q(z),v*D+F*G(z))),o+=I?L+N*$t:L,I^y>=n^b>=n){var _=$r(Ve(d),Ve(A));ji(_);var p=$r(s,_);ji(p);var m=(I^L>=0?-1:1)*ie(p[2]);(r>m||r===m&&(_[0]||_[1]))&&(a+=I^L>=0?1:-1)}}return(o<-V||o<V&&l<-Fi)^a&1}function Gl(e,t,n,r){return function(i){var s=t(i),o=Hl(),a=t(o),l=!1,u,h,c,f={point:d,lineStart:w,lineEnd:E,polygonStart:function(){f.point=v,f.lineStart=T,f.lineEnd=A,h=[],u=[]},polygonEnd:function(){f.point=d,f.lineStart=w,f.lineEnd=E,h=sl(h);var b=lp(u,r);h.length?(l||(i.polygonStart(),l=!0),ql(h,up,b,n,i)):b&&(l||(i.polygonStart(),l=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),l&&(i.polygonEnd(),l=!1),h=u=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function d(b,C){e(b,C)&&i.point(b,C)}function y(b,C){s.point(b,C)}function w(){f.point=y,s.lineStart()}function E(){f.point=d,s.lineEnd()}function v(b,C){c.push([b,C]),a.point(b,C)}function T(){a.lineStart(),c=[]}function A(){v(c[0][0],c[0][1]),a.lineEnd();var b=a.clean(),C=o.result(),R,D=C.length,L,N,z;if(c.pop(),u.push(c),c=null,!!D){if(b&1){if(N=C[0],(L=N.length-1)>0){for(l||(i.polygonStart(),l=!0),i.lineStart(),R=0;R<L;++R)i.point((z=N[R])[0],z[1]);i.lineEnd()}return}D>1&&b&2&&C.push(C.pop().concat(C.shift())),h.push(C.filter(cp))}}return f}}function cp(e){return e.length>1}function up(e,t){return((e=e.x)[0]<0?e[1]-pt-V:pt-e[1])-((t=t.x)[0]<0?t[1]-pt-V:pt-t[1])}const sa=Gl(function(){return!0},hp,dp,[-W,-pt]);function hp(e){var t=NaN,n=NaN,r=NaN,i;return{lineStart:function(){e.lineStart(),i=1},point:function(s,o){var a=s>0?W:-W,l=et(s-t);et(l-W)<V?(e.point(t,n=(n+o)/2>0?pt:-pt),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(a,n),e.point(s,n),i=0):r!==a&&l>=W&&(et(t-r)<V&&(t-=r*V),et(s-a)<V&&(s-=a*V),n=fp(t,n,s,o),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(a,n),i=0),e.point(t=s,n=o),r=a},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-i}}}function fp(e,t,n,r){var i,s,o=q(e-n);return et(o)>V?ni((q(t)*(s=G(r))*q(n)-q(r)*(i=G(t))*q(e))/(i*s*o)):(t+r)/2}function dp(e,t,n,r){var i;if(e==null)i=n*pt,r.point(-W,i),r.point(0,i),r.point(W,i),r.point(W,0),r.point(W,-i),r.point(0,-i),r.point(-W,-i),r.point(-W,0),r.point(-W,i);else if(et(e[0]-t[0])>V){var s=e[0]<t[0]?W:-W;i=n*s/2,r.point(-s,i),r.point(0,i),r.point(s,i)}else r.point(t[0],t[1])}function pp(e){var t=G(e),n=2*K,r=t>0,i=et(t)>V;function s(h,c,f,d){ap(d,e,n,f,h,c)}function o(h,c){return G(h)*G(c)>t}function a(h){var c,f,d,y,w;return{lineStart:function(){y=d=!1,w=1},point:function(E,v){var T=[E,v],A,b=o(E,v),C=r?b?0:u(E,v):b?u(E+(E<0?W:-W),v):0;if(!c&&(y=d=b)&&h.lineStart(),b!==d&&(A=l(c,T),(!A||ar(c,A)||ar(T,A))&&(T[2]=1)),b!==d)w=0,b?(h.lineStart(),A=l(T,c),h.point(A[0],A[1])):(A=l(c,T),h.point(A[0],A[1],2),h.lineEnd()),c=A;else if(i&&c&&r^b){var R;!(C&f)&&(R=l(T,c,!0))&&(w=0,r?(h.lineStart(),h.point(R[0][0],R[0][1]),h.point(R[1][0],R[1][1]),h.lineEnd()):(h.point(R[1][0],R[1][1]),h.lineEnd(),h.lineStart(),h.point(R[0][0],R[0][1],3)))}b&&(!c||!ar(c,T))&&h.point(T[0],T[1]),c=T,d=b,f=C},lineEnd:function(){d&&h.lineEnd(),c=null},clean:function(){return w|(y&&d)<<1}}}function l(h,c,f){var d=Ve(h),y=Ve(c),w=[1,0,0],E=$r(d,y),v=Gn(E,E),T=E[0],A=v-T*T;if(!A)return!f&&h;var b=t*v/A,C=-t*T/A,R=$r(w,E),D=jn(w,b),L=jn(E,C);_i(D,L);var N=R,z=Gn(D,N),I=Gn(N,N),F=z*z-I*(Gn(D,D)-1);if(!(F<0)){var _=Wt(F),p=jn(N,(-z-_)/I);if(_i(p,D),p=Gi(p),!f)return p;var m=h[0],g=c[0],x=h[1],P=c[1],k;g<m&&(k=m,m=g,g=k);var O=g-m,B=et(O-W)<V,H=B||O<V;if(!B&&P<x&&(k=x,x=P,P=k),H?B?x+P>0^p[1]<(et(p[0]-m)<V?x:P):x<=p[1]&&p[1]<=P:O>W^(m<=p[0]&&p[0]<=g)){var X=jn(N,(-z+_)/I);return _i(X,D),[p,Gi(X)]}}}function u(h,c){var f=r?e:W-e,d=0;return h<-f?d|=1:h>f&&(d|=2),c<-f?d|=4:c>f&&(d|=8),d}return Gl(o,a,s,r?[0,-e]:[-W,e-W])}function gp(e,t,n,r,i,s){var o=e[0],a=e[1],l=t[0],u=t[1],h=0,c=1,f=l-o,d=u-a,y;if(y=n-o,!(!f&&y>0)){if(y/=f,f<0){if(y<h)return;y<c&&(c=y)}else if(f>0){if(y>c)return;y>h&&(h=y)}if(y=i-o,!(!f&&y<0)){if(y/=f,f<0){if(y>c)return;y>h&&(h=y)}else if(f>0){if(y<h)return;y<c&&(c=y)}if(y=r-a,!(!d&&y>0)){if(y/=d,d<0){if(y<h)return;y<c&&(c=y)}else if(d>0){if(y>c)return;y>h&&(h=y)}if(y=s-a,!(!d&&y<0)){if(y/=d,d<0){if(y>c)return;y>h&&(h=y)}else if(d>0){if(y<h)return;y<c&&(c=y)}return h>0&&(e[0]=o+h*f,e[1]=a+h*d),c<1&&(t[0]=o+c*f,t[1]=a+c*d),!0}}}}}var cn=1e9,Yn=-cn;function mp(e,t,n,r){function i(u,h){return e<=u&&u<=n&&t<=h&&h<=r}function s(u,h,c,f){var d=0,y=0;if(u==null||(d=o(u,c))!==(y=o(h,c))||l(u,h)<0^c>0)do f.point(d===0||d===3?e:n,d>1?r:t);while((d=(d+c+4)%4)!==y);else f.point(h[0],h[1])}function o(u,h){return et(u[0]-e)<V?h>0?0:3:et(u[0]-n)<V?h>0?2:1:et(u[1]-t)<V?h>0?1:0:h>0?3:2}function a(u,h){return l(u.x,h.x)}function l(u,h){var c=o(u,1),f=o(h,1);return c!==f?c-f:c===0?h[1]-u[1]:c===1?u[0]-h[0]:c===2?u[1]-h[1]:h[0]-u[0]}return function(u){var h=u,c=Hl(),f,d,y,w,E,v,T,A,b,C,R,D={point:L,lineStart:F,lineEnd:_,polygonStart:z,polygonEnd:I};function L(m,g){i(m,g)&&h.point(m,g)}function N(){for(var m=0,g=0,x=d.length;g<x;++g)for(var P=d[g],k=1,O=P.length,B=P[0],H,X,Q=B[0],nt=B[1];k<O;++k)H=Q,X=nt,B=P[k],Q=B[0],nt=B[1],X<=r?nt>r&&(Q-H)*(r-X)>(nt-X)*(e-H)&&++m:nt<=r&&(Q-H)*(r-X)<(nt-X)*(e-H)&&--m;return m}function z(){h=c,f=[],d=[],R=!0}function I(){var m=N(),g=R&&m,x=(f=sl(f)).length;(g||x)&&(u.polygonStart(),g&&(u.lineStart(),s(null,null,1,u),u.lineEnd()),x&&ql(f,a,m,s,u),u.polygonEnd()),h=u,f=d=y=null}function F(){D.point=p,d&&d.push(y=[]),C=!0,b=!1,T=A=NaN}function _(){f&&(p(w,E),v&&b&&c.rejoin(),f.push(c.result())),D.point=L,b&&h.lineEnd()}function p(m,g){var x=i(m,g);if(d&&y.push([m,g]),C)w=m,E=g,v=x,C=!1,x&&(h.lineStart(),h.point(m,g));else if(x&&b)h.point(m,g);else{var P=[T=Math.max(Yn,Math.min(cn,T)),A=Math.max(Yn,Math.min(cn,A))],k=[m=Math.max(Yn,Math.min(cn,m)),g=Math.max(Yn,Math.min(cn,g))];gp(P,k,e,t,n,r)?(b||(h.lineStart(),h.point(P[0],P[1])),h.point(k[0],k[1]),x||h.lineEnd(),R=!1):x&&(h.lineStart(),h.point(m,g),R=!1)}T=m,A=g,b=x}return D}}var Qi,Zi,lr,cr,Ye={sphere:lt,point:lt,lineStart:yp,lineEnd:lt,polygonStart:lt,polygonEnd:lt};function yp(){Ye.point=wp,Ye.lineEnd=_p}function _p(){Ye.point=Ye.lineEnd=lt}function wp(e,t){e*=K,t*=K,Zi=e,lr=q(t),cr=G(t),Ye.point=vp}function vp(e,t){e*=K,t*=K;var n=q(t),r=G(t),i=et(e-Zi),s=G(i),o=q(i),a=r*o,l=cr*n-lr*r*s,u=lr*n+cr*r*s;Qi.add(re(Wt(a*a+l*l),u)),Zi=e,lr=n,cr=r}function xp(e){return Qi=new Dt,ce(e,Ye),+Qi}var Ji=[null,null],bp={type:"LineString",coordinates:Ji};function Rr(e,t){return Ji[0]=e,Ji[1]=t,xp(bp)}function oa(e,t,n){var r=De(e,t-V,n).concat(t);return function(i){return r.map(function(s){return[i,s]})}}function aa(e,t,n){var r=De(e,t-V,n).concat(t);return function(i){return r.map(function(s){return[s,i]})}}function Sp(){var e,t,n,r,i,s,o,a,l=10,u=l,h=90,c=360,f,d,y,w,E=2.5;function v(){return{type:"MultiLineString",coordinates:T()}}function T(){return De(qn(r/h)*h,n,h).map(y).concat(De(qn(a/c)*c,o,c).map(w)).concat(De(qn(t/l)*l,e,l).filter(function(A){return et(A%h)>V}).map(f)).concat(De(qn(s/u)*u,i,u).filter(function(A){return et(A%c)>V}).map(d))}return v.lines=function(){return T().map(function(A){return{type:"LineString",coordinates:A}})},v.outline=function(){return{type:"Polygon",coordinates:[y(r).concat(w(o).slice(1),y(n).reverse().slice(1),w(a).reverse().slice(1))]}},v.extent=function(A){return arguments.length?v.extentMajor(A).extentMinor(A):v.extentMinor()},v.extentMajor=function(A){return arguments.length?(r=+A[0][0],n=+A[1][0],a=+A[0][1],o=+A[1][1],r>n&&(A=r,r=n,n=A),a>o&&(A=a,a=o,o=A),v.precision(E)):[[r,a],[n,o]]},v.extentMinor=function(A){return arguments.length?(t=+A[0][0],e=+A[1][0],s=+A[0][1],i=+A[1][1],t>e&&(A=t,t=e,e=A),s>i&&(A=s,s=i,i=A),v.precision(E)):[[t,s],[e,i]]},v.step=function(A){return arguments.length?v.stepMajor(A).stepMinor(A):v.stepMinor()},v.stepMajor=function(A){return arguments.length?(h=+A[0],c=+A[1],v):[h,c]},v.stepMinor=function(A){return arguments.length?(l=+A[0],u=+A[1],v):[l,u]},v.precision=function(A){return arguments.length?(E=+A,f=oa(s,i,90),d=aa(t,e,E),y=oa(a,o,90),w=aa(r,n,E),v):E},v.extentMajor([[-180,-90+V],[180,90-V]]).extentMinor([[-180,-80-V],[180,80+V]])}const ts=e=>e;var vi=new Dt,es=new Dt,jl,Vl,ns,rs,Zt={point:lt,lineStart:lt,lineEnd:lt,polygonStart:function(){Zt.lineStart=Mp,Zt.lineEnd=$p},polygonEnd:function(){Zt.lineStart=Zt.lineEnd=Zt.point=lt,vi.add(et(es)),es=new Dt},result:function(){var e=vi/2;return vi=new Dt,e}};function Mp(){Zt.point=Ep}function Ep(e,t){Zt.point=Yl,jl=ns=e,Vl=rs=t}function Yl(e,t){es.add(rs*e-ns*t),ns=e,rs=t}function $p(){Yl(jl,Vl)}var We=1/0,Lr=We,Mn=-We,Dr=Mn,zr={point:Ap,lineStart:lt,lineEnd:lt,polygonStart:lt,polygonEnd:lt,result:function(){var e=[[We,Lr],[Mn,Dr]];return Mn=Dr=-(Lr=We=1/0),e}};function Ap(e,t){e<We&&(We=e),e>Mn&&(Mn=e),t<Lr&&(Lr=t),t>Dr&&(Dr=t)}var is=0,ss=0,un=0,Ur=0,Br=0,Ue=0,os=0,as=0,hn=0,Wl,Kl,Bt,Ft,Tt={point:Ie,lineStart:la,lineEnd:ca,polygonStart:function(){Tt.lineStart=kp,Tt.lineEnd=Pp},polygonEnd:function(){Tt.point=Ie,Tt.lineStart=la,Tt.lineEnd=ca},result:function(){var e=hn?[os/hn,as/hn]:Ue?[Ur/Ue,Br/Ue]:un?[is/un,ss/un]:[NaN,NaN];return is=ss=un=Ur=Br=Ue=os=as=hn=0,e}};function Ie(e,t){is+=e,ss+=t,++un}function la(){Tt.point=Ip}function Ip(e,t){Tt.point=Tp,Ie(Bt=e,Ft=t)}function Tp(e,t){var n=e-Bt,r=t-Ft,i=Wt(n*n+r*r);Ur+=i*(Bt+e)/2,Br+=i*(Ft+t)/2,Ue+=i,Ie(Bt=e,Ft=t)}function ca(){Tt.point=Ie}function kp(){Tt.point=Cp}function Pp(){Xl(Wl,Kl)}function Cp(e,t){Tt.point=Xl,Ie(Wl=Bt=e,Kl=Ft=t)}function Xl(e,t){var n=e-Bt,r=t-Ft,i=Wt(n*n+r*r);Ur+=i*(Bt+e)/2,Br+=i*(Ft+t)/2,Ue+=i,i=Ft*e-Bt*t,os+=i*(Bt+e),as+=i*(Ft+t),hn+=i*3,Ie(Bt=e,Ft=t)}function Ql(e){this._context=e}Ql.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,$t);break}}},result:lt};var ls=new Dt,xi,Zl,Jl,fn,dn,En={point:lt,lineStart:function(){En.point=Np},lineEnd:function(){xi&&tc(Zl,Jl),En.point=lt},polygonStart:function(){xi=!0},polygonEnd:function(){xi=null},result:function(){var e=+ls;return ls=new Dt,e}};function Np(e,t){En.point=tc,Zl=fn=e,Jl=dn=t}function tc(e,t){fn-=e,dn-=t,ls.add(Wt(fn*fn+dn*dn)),fn=e,dn=t}let ua,Fr,ha,fa;class da{constructor(t){this._append=t==null?ec:Op(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,n){switch(this._point){case 0:{this._append`M${t},${n}`,this._point=1;break}case 1:{this._append`L${t},${n}`;break}default:{if(this._append`M${t},${n}`,this._radius!==ha||this._append!==Fr){const r=this._radius,i=this._;this._="",this._append`m0,${r}a${r},${r} 0 1,1 0,${-2*r}a${r},${r} 0 1,1 0,${2*r}z`,ha=r,Fr=this._append,fa=this._,this._=i}this._+=fa;break}}}result(){const t=this._;return this._="",t.length?t:null}}function ec(e){let t=1;this._+=e[0];for(const n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function Op(e){const t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return ec;if(t!==ua){const n=10**t;ua=t,Fr=function(i){let s=1;this._+=i[0];for(const o=i.length;s<o;++s)this._+=Math.round(arguments[s]*n)/n+i[s]}}return Fr}function Fs(e,t){let n=3,r=4.5,i,s;function o(a){return a&&(typeof r=="function"&&s.pointRadius(+r.apply(this,arguments)),ce(a,i(s))),s.result()}return o.area=function(a){return ce(a,i(Zt)),Zt.result()},o.measure=function(a){return ce(a,i(En)),En.result()},o.bounds=function(a){return ce(a,i(zr)),zr.result()},o.centroid=function(a){return ce(a,i(Tt)),Tt.result()},o.projection=function(a){return arguments.length?(i=a==null?(e=null,ts):(e=a).stream,o):e},o.context=function(a){return arguments.length?(s=a==null?(t=null,new da(n)):new Ql(t=a),typeof r!="function"&&s.pointRadius(r),o):t},o.pointRadius=function(a){return arguments.length?(r=typeof a=="function"?a:(s.pointRadius(+a),+a),o):r},o.digits=function(a){if(!arguments.length)return n;if(a==null)n=null;else{const l=Math.floor(a);if(!(l>=0))throw new RangeError(`invalid digits: ${a}`);n=l}return t===null&&(s=new da(n)),o},o.projection(e).digits(n).context(t)}function Hs(e){return function(t){var n=new cs;for(var r in e)n[r]=e[r];return n.stream=t,n}}function cs(){}cs.prototype={constructor:cs,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function qs(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),r!=null&&e.clipExtent(null),ce(n,e.stream(zr)),t(zr.result()),r!=null&&e.clipExtent(r),e}function nc(e,t,n){return qs(e,function(r){var i=t[1][0]-t[0][0],s=t[1][1]-t[0][1],o=Math.min(i/(r[1][0]-r[0][0]),s/(r[1][1]-r[0][1])),a=+t[0][0]+(i-o*(r[1][0]+r[0][0]))/2,l=+t[0][1]+(s-o*(r[1][1]+r[0][1]))/2;e.scale(150*o).translate([a,l])},n)}function Rp(e,t,n){return nc(e,[[0,0],t],n)}function Lp(e,t,n){return qs(e,function(r){var i=+t,s=i/(r[1][0]-r[0][0]),o=(i-s*(r[1][0]+r[0][0]))/2,a=-s*r[0][1];e.scale(150*s).translate([o,a])},n)}function Dp(e,t,n){return qs(e,function(r){var i=+t,s=i/(r[1][1]-r[0][1]),o=-s*r[0][0],a=(i-s*(r[1][1]+r[0][1]))/2;e.scale(150*s).translate([o,a])},n)}var pa=16,zp=G(30*K);function ga(e,t){return+t?Bp(e,t):Up(e)}function Up(e){return Hs({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function Bp(e,t){function n(r,i,s,o,a,l,u,h,c,f,d,y,w,E){var v=u-r,T=h-i,A=v*v+T*T;if(A>4*t&&w--){var b=o+f,C=a+d,R=l+y,D=Wt(b*b+C*C+R*R),L=ie(R/=D),N=et(et(R)-1)<V||et(s-c)<V?(s+c)/2:re(C,b),z=e(N,L),I=z[0],F=z[1],_=I-r,p=F-i,m=T*_-v*p;(m*m/A>t||et((v*_+T*p)/A-.5)>.3||o*f+a*d+l*y<zp)&&(n(r,i,s,o,a,l,I,F,N,b/=D,C/=D,R,w,E),E.point(I,F),n(I,F,N,b,C,R,u,h,c,f,d,y,w,E))}}return function(r){var i,s,o,a,l,u,h,c,f,d,y,w,E={point:v,lineStart:T,lineEnd:b,polygonStart:function(){r.polygonStart(),E.lineStart=C},polygonEnd:function(){r.polygonEnd(),E.lineStart=T}};function v(L,N){L=e(L,N),r.point(L[0],L[1])}function T(){c=NaN,E.point=A,r.lineStart()}function A(L,N){var z=Ve([L,N]),I=e(L,N);n(c,f,h,d,y,w,c=I[0],f=I[1],h=L,d=z[0],y=z[1],w=z[2],pa,r),r.point(c,f)}function b(){E.point=v,r.lineEnd()}function C(){T(),E.point=R,E.lineEnd=D}function R(L,N){A(i=L,N),s=c,o=f,a=d,l=y,u=w,E.point=A}function D(){n(c,f,h,d,y,w,s,o,i,a,l,u,pa,r),E.lineEnd=b,b()}return E}}var Fp=Hs({point:function(e,t){this.stream.point(e*K,t*K)}});function Hp(e){return Hs({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}function qp(e,t,n,r,i){function s(o,a){return o*=r,a*=i,[t+e*o,n-e*a]}return s.invert=function(o,a){return[(o-t)/e*r,(n-a)/e*i]},s}function ma(e,t,n,r,i,s){if(!s)return qp(e,t,n,r,i);var o=G(s),a=q(s),l=o*e,u=a*e,h=o/e,c=a/e,f=(a*n-o*t)/e,d=(a*t+o*n)/e;function y(w,E){return w*=r,E*=i,[l*w-u*E+t,n-u*w-l*E]}return y.invert=function(w,E){return[r*(h*w-c*E+f),i*(d-c*w-h*E)]},y}function Gs(e){return Gp(function(){return e})()}function Gp(e){var t,n=150,r=480,i=250,s=0,o=0,a=0,l=0,u=0,h,c=0,f=1,d=1,y=null,w=sa,E=null,v,T,A,b=ts,C=.5,R,D,L,N,z;function I(m){return L(m[0]*K,m[1]*K)}function F(m){return m=L.invert(m[0],m[1]),m&&[m[0]*yt,m[1]*yt]}I.stream=function(m){return N&&z===m?N:N=Fp(Hp(h)(w(R(b(z=m)))))},I.preclip=function(m){return arguments.length?(w=m,y=void 0,p()):w},I.postclip=function(m){return arguments.length?(b=m,E=v=T=A=null,p()):b},I.clipAngle=function(m){return arguments.length?(w=+m?pp(y=m*K):(y=null,sa),p()):y*yt},I.clipExtent=function(m){return arguments.length?(b=m==null?(E=v=T=A=null,ts):mp(E=+m[0][0],v=+m[0][1],T=+m[1][0],A=+m[1][1]),p()):E==null?null:[[E,v],[T,A]]},I.scale=function(m){return arguments.length?(n=+m,_()):n},I.translate=function(m){return arguments.length?(r=+m[0],i=+m[1],_()):[r,i]},I.center=function(m){return arguments.length?(s=m[0]%360*K,o=m[1]%360*K,_()):[s*yt,o*yt]},I.rotate=function(m){return arguments.length?(a=m[0]%360*K,l=m[1]%360*K,u=m.length>2?m[2]%360*K:0,_()):[a*yt,l*yt,u*yt]},I.angle=function(m){return arguments.length?(c=m%360*K,_()):c*yt},I.reflectX=function(m){return arguments.length?(f=m?-1:1,_()):f<0},I.reflectY=function(m){return arguments.length?(d=m?-1:1,_()):d<0},I.precision=function(m){return arguments.length?(R=ga(D,C=m*m),p()):Wt(C)},I.fitExtent=function(m,g){return nc(I,m,g)},I.fitSize=function(m,g){return Rp(I,m,g)},I.fitWidth=function(m,g){return Lp(I,m,g)},I.fitHeight=function(m,g){return Dp(I,m,g)};function _(){var m=ma(n,0,0,f,d,c).apply(null,t(s,o)),g=ma(n,r-m[0],i-m[1],f,d,c);return h=Fl(a,l,u),D=Ki(t,g),L=Ki(h,D),R=ga(D,C),p()}function p(){return N=z=null,I}return function(){return t=e.apply(this,arguments),I.invert=t.invert&&F,_()}}function rc(e){return function(t,n){var r=Wt(t*t+n*n),i=e(r),s=q(i),o=G(i);return[re(t*s,r*o),ie(r&&n*s/r)]}}function js(e,t){return[e,Ll(Dl((pt+t)/2))]}js.invert=function(e,t){return[e,2*ni(Rl(t))-pt]};function jp(){return ic(js).scale(961/$t)}function ic(e){var t=Gs(e),n=t.center,r=t.scale,i=t.translate,s=t.clipExtent,o=null,a,l,u;t.scale=function(c){return arguments.length?(r(c),h()):r()},t.translate=function(c){return arguments.length?(i(c),h()):i()},t.center=function(c){return arguments.length?(n(c),h()):n()},t.clipExtent=function(c){return arguments.length?(c==null?o=a=l=u=null:(o=+c[0][0],a=+c[0][1],l=+c[1][0],u=+c[1][1]),h()):o==null?null:[[o,a],[l,u]]};function h(){var c=W*r(),f=t(Or(t.rotate()).invert([0,0]));return s(o==null?[[f[0]-c,f[1]-c],[f[0]+c,f[1]+c]]:e===js?[[Math.max(f[0]-c,o),a],[Math.min(f[0]+c,l),u]]:[[o,Math.max(f[1]-c,a)],[l,Math.min(f[1]+c,u)]])}return h()}function sc(e,t){return[G(t)*q(e),q(t)]}sc.invert=rc(ie);function Vp(){return Gs(sc).scale(249.5).clipAngle(90+V)}function oc(e,t){var n=G(t),r=1+G(e)*n;return[n*q(e)/r,q(t)/r]}oc.invert=rc(function(e){return 2*ni(e)});function ac(){return Gs(oc).scale(250).clipAngle(142)}function lc(e,t){return[Ll(Dl((pt+t)/2)),-e]}lc.invert=function(e,t){return[-t,2*ni(Rl(e))-pt]};function Yp(){var e=ic(lc),t=e.center,n=e.rotate;return e.center=function(r){return arguments.length?t([-r[1],r[0]]):(r=t(),[r[1],-r[0]])},e.rotate=function(r){return arguments.length?n([r[0],r[1],r.length>2?r[2]+90:90]):(r=n(),[r[0],r[1],r[2]-90])},n([0,0,90]).scale(159.155)}const Wn=e=>()=>e;function Wp(e,{sourceEvent:t,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function Jt(e,t,n){this.k=e,this.x=t,this.y=n}Jt.prototype={constructor:Jt,scale:function(e){return e===1?this:new Jt(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Jt(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var cc=new Jt(1,0,0);Jt.prototype;function bi(e){e.stopImmediatePropagation()}function rn(e){e.preventDefault(),e.stopImmediatePropagation()}function Kp(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function Xp(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function ya(){return this.__zoom||cc}function Qp(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function Zp(){return navigator.maxTouchPoints||"ontouchstart"in this}function Jp(e,t,n){var r=e.invertX(t[0][0])-n[0][0],i=e.invertX(t[1][0])-n[1][0],s=e.invertY(t[0][1])-n[0][1],o=e.invertY(t[1][1])-n[1][1];return e.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function tg(){var e=Kp,t=Xp,n=Jp,r=Qp,i=Zp,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,l=d0,u=Qr("start","zoom","end"),h,c,f,d=500,y=150,w=0,E=10;function v(p){p.property("__zoom",ya).on("wheel.zoom",L,{passive:!1}).on("mousedown.zoom",N).on("dblclick.zoom",z).filter(i).on("touchstart.zoom",I).on("touchmove.zoom",F).on("touchend.zoom touchcancel.zoom",_).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}v.transform=function(p,m,g,x){var P=p.selection?p.selection():p;P.property("__zoom",ya),p!==P?C(p,m,g,x):P.interrupt().each(function(){R(this,arguments).event(x).start().zoom(null,typeof m=="function"?m.apply(this,arguments):m).end()})},v.scaleBy=function(p,m,g,x){v.scaleTo(p,function(){var P=this.__zoom.k,k=typeof m=="function"?m.apply(this,arguments):m;return P*k},g,x)},v.scaleTo=function(p,m,g,x){v.transform(p,function(){var P=t.apply(this,arguments),k=this.__zoom,O=g==null?b(P):typeof g=="function"?g.apply(this,arguments):g,B=k.invert(O),H=typeof m=="function"?m.apply(this,arguments):m;return n(A(T(k,H),O,B),P,o)},g,x)},v.translateBy=function(p,m,g,x){v.transform(p,function(){return n(this.__zoom.translate(typeof m=="function"?m.apply(this,arguments):m,typeof g=="function"?g.apply(this,arguments):g),t.apply(this,arguments),o)},null,x)},v.translateTo=function(p,m,g,x,P){v.transform(p,function(){var k=t.apply(this,arguments),O=this.__zoom,B=x==null?b(k):typeof x=="function"?x.apply(this,arguments):x;return n(cc.translate(B[0],B[1]).scale(O.k).translate(typeof m=="function"?-m.apply(this,arguments):-m,typeof g=="function"?-g.apply(this,arguments):-g),k,o)},x,P)};function T(p,m){return m=Math.max(s[0],Math.min(s[1],m)),m===p.k?p:new Jt(m,p.x,p.y)}function A(p,m,g){var x=m[0]-g[0]*p.k,P=m[1]-g[1]*p.k;return x===p.x&&P===p.y?p:new Jt(p.k,x,P)}function b(p){return[(+p[0][0]+ +p[1][0])/2,(+p[0][1]+ +p[1][1])/2]}function C(p,m,g,x){p.on("start.zoom",function(){R(this,arguments).event(x).start()}).on("interrupt.zoom end.zoom",function(){R(this,arguments).event(x).end()}).tween("zoom",function(){var P=this,k=arguments,O=R(P,k).event(x),B=t.apply(P,k),H=g==null?b(B):typeof g=="function"?g.apply(P,k):g,X=Math.max(B[1][0]-B[0][0],B[1][1]-B[0][1]),Q=P.__zoom,nt=typeof m=="function"?m.apply(P,k):m,Kt=l(Q.invert(H).concat(X/Q.k),nt.invert(H).concat(X/nt.k));return function(kt){if(kt===1)kt=nt;else{var Xt=Kt(kt),ui=X/Xt[2];kt=new Jt(ui,H[0]-Xt[0]*ui,H[1]-Xt[1]*ui)}O.zoom(null,kt)}})}function R(p,m,g){return!g&&p.__zooming||new D(p,m)}function D(p,m){this.that=p,this.args=m,this.active=0,this.sourceEvent=null,this.extent=t.apply(p,m),this.taps=0}D.prototype={event:function(p){return p&&(this.sourceEvent=p),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(p,m){return this.mouse&&p!=="mouse"&&(this.mouse[1]=m.invert(this.mouse[0])),this.touch0&&p!=="touch"&&(this.touch0[1]=m.invert(this.touch0[0])),this.touch1&&p!=="touch"&&(this.touch1[1]=m.invert(this.touch1[0])),this.that.__zoom=m,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(p){var m=Nt(this.that).datum();u.call(p,this.that,new Wp(p,{sourceEvent:this.sourceEvent,target:v,transform:this.that.__zoom,dispatch:u}),m)}};function L(p,...m){if(!e.apply(this,arguments))return;var g=R(this,m).event(p),x=this.__zoom,P=Math.max(s[0],Math.min(s[1],x.k*Math.pow(2,r.apply(this,arguments)))),k=Ut(p);if(g.wheel)(g.mouse[0][0]!==k[0]||g.mouse[0][1]!==k[1])&&(g.mouse[1]=x.invert(g.mouse[0]=k)),clearTimeout(g.wheel);else{if(x.k===P)return;g.mouse=[k,x.invert(k)],or(this),g.start()}rn(p),g.wheel=setTimeout(O,y),g.zoom("mouse",n(A(T(x,P),g.mouse[0],g.mouse[1]),g.extent,o));function O(){g.wheel=null,g.end()}}function N(p,...m){if(f||!e.apply(this,arguments))return;var g=p.currentTarget,x=R(this,m,!0).event(p),P=Nt(p.view).on("mousemove.zoom",H,!0).on("mouseup.zoom",X,!0),k=Ut(p,g),O=p.clientX,B=p.clientY;wl(p.view),bi(p),x.mouse=[k,this.__zoom.invert(k)],or(this),x.start();function H(Q){if(rn(Q),!x.moved){var nt=Q.clientX-O,Kt=Q.clientY-B;x.moved=nt*nt+Kt*Kt>w}x.event(Q).zoom("mouse",n(A(x.that.__zoom,x.mouse[0]=Ut(Q,g),x.mouse[1]),x.extent,o))}function X(Q){P.on("mousemove.zoom mouseup.zoom",null),vl(Q.view,x.moved),rn(Q),x.event(Q).end()}}function z(p,...m){if(e.apply(this,arguments)){var g=this.__zoom,x=Ut(p.changedTouches?p.changedTouches[0]:p,this),P=g.invert(x),k=g.k*(p.shiftKey?.5:2),O=n(A(T(g,k),x,P),t.apply(this,m),o);rn(p),a>0?Nt(this).transition().duration(a).call(C,O,x,p):Nt(this).call(v.transform,O,x,p)}}function I(p,...m){if(e.apply(this,arguments)){var g=p.touches,x=g.length,P=R(this,m,p.changedTouches.length===x).event(p),k,O,B,H;for(bi(p),O=0;O<x;++O)B=g[O],H=Ut(B,this),H=[H,this.__zoom.invert(H),B.identifier],P.touch0?!P.touch1&&P.touch0[2]!==H[2]&&(P.touch1=H,P.taps=0):(P.touch0=H,k=!0,P.taps=1+!!h);h&&(h=clearTimeout(h)),k&&(P.taps<2&&(c=H[0],h=setTimeout(function(){h=null},d)),or(this),P.start())}}function F(p,...m){if(this.__zooming){var g=R(this,m).event(p),x=p.changedTouches,P=x.length,k,O,B,H;for(rn(p),k=0;k<P;++k)O=x[k],B=Ut(O,this),g.touch0&&g.touch0[2]===O.identifier?g.touch0[0]=B:g.touch1&&g.touch1[2]===O.identifier&&(g.touch1[0]=B);if(O=g.that.__zoom,g.touch1){var X=g.touch0[0],Q=g.touch0[1],nt=g.touch1[0],Kt=g.touch1[1],kt=(kt=nt[0]-X[0])*kt+(kt=nt[1]-X[1])*kt,Xt=(Xt=Kt[0]-Q[0])*Xt+(Xt=Kt[1]-Q[1])*Xt;O=T(O,Math.sqrt(kt/Xt)),B=[(X[0]+nt[0])/2,(X[1]+nt[1])/2],H=[(Q[0]+Kt[0])/2,(Q[1]+Kt[1])/2]}else if(g.touch0)B=g.touch0[0],H=g.touch0[1];else return;g.zoom("touch",n(A(O,B,H),g.extent,o))}}function _(p,...m){if(this.__zooming){var g=R(this,m).event(p),x=p.changedTouches,P=x.length,k,O;for(bi(p),f&&clearTimeout(f),f=setTimeout(function(){f=null},d),k=0;k<P;++k)O=x[k],g.touch0&&g.touch0[2]===O.identifier?delete g.touch0:g.touch1&&g.touch1[2]===O.identifier&&delete g.touch1;if(g.touch1&&!g.touch0&&(g.touch0=g.touch1,delete g.touch1),g.touch0)g.touch0[1]=this.__zoom.invert(g.touch0[0]);else if(g.end(),g.taps===2&&(O=Ut(O,this),Math.hypot(c[0]-O[0],c[1]-O[1])<E)){var B=Nt(this).on("dblclick.zoom");B&&B.apply(this,arguments)}}}return v.wheelDelta=function(p){return arguments.length?(r=typeof p=="function"?p:Wn(+p),v):r},v.filter=function(p){return arguments.length?(e=typeof p=="function"?p:Wn(!!p),v):e},v.touchable=function(p){return arguments.length?(i=typeof p=="function"?p:Wn(!!p),v):i},v.extent=function(p){return arguments.length?(t=typeof p=="function"?p:Wn([[+p[0][0],+p[0][1]],[+p[1][0],+p[1][1]]]),v):t},v.scaleExtent=function(p){return arguments.length?(s[0]=+p[0],s[1]=+p[1],v):[s[0],s[1]]},v.translateExtent=function(p){return arguments.length?(o[0][0]=+p[0][0],o[1][0]=+p[1][0],o[0][1]=+p[0][1],o[1][1]=+p[1][1],v):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},v.constrain=function(p){return arguments.length?(n=p,v):n},v.duration=function(p){return arguments.length?(a=+p,v):a},v.interpolate=function(p){return arguments.length?(l=p,v):l},v.on=function(){var p=u.on.apply(u,arguments);return p===u?v:p},v.clickDistance=function(p){return arguments.length?(w=(p=+p)*p,v):Math.sqrt(w)},v.tapDistance=function(p){return arguments.length?(E=+p,v):E},v}function ri(){return{systemMap:new Map,laneMap:new Map,neighborMap:new Map}}function uc(e,t){e.systemMap.set(t.id,t)}function us(e,t,n){const r=[t.id,n.id].sort((s,o)=>s.localeCompare(o)).join("-");if(e.laneMap.has(r))return;const i={id:r,fromId:t.id,toId:n.id,movement:[0,0]};e.laneMap.set(r,i)}function ii(e){const t=new Map;for(const n of e.laneMap.values())t.has(n.fromId)||t.set(n.fromId,[]),t.get(n.fromId)?.push(n.toId),t.has(n.toId)||t.set(n.toId,[]),t.get(n.toId)?.push(n.fromId);e.neighborMap=t}function St(e,t){const n=e.systemMap.get(t);if(!n)return[];(!e.neighborMap||e.neighborMap.size===0)&&ii(e);const r=e.neighborMap.get(n.id);return r?r.map(i=>e.systemMap.get(i)).filter(i=>!!i):[]}function si(e,t,n){return e.neighborMap.get(t)?.includes(n)||!1}function hc(e,t){return Vs(t,Array.from(e.systemMap.values()))}function Vs(e,t){if(t.length===0)return null;let n=null,r=1/0;return t.forEach(i=>{if(i.location[0]===e[0]&&i.location[1]===e[1])return;const s=Rr(e,i.location);s<r&&(r=s,n=i)}),n}function eg(e){console.log("Loading world from JSON...",e);const t=ri();return t.systemMap=new Map(e.systems),t.laneMap=new Map(e.lanes),ii(t),t}function ng(e){return{systems:Array.from(e.systemMap.entries()),lanes:Array.from(e.laneMap.entries())}}function fc(){return{playerName:"",numBots:0,fow:Gu,numSystems:ju,timeScale:1}}function Ys(){return{world:ri(),playerMap:new Map}}function dc(e,t){e.playerMap.set(t.id,t)}function Ws(e){const{C:t}=globalThis.gameManager.getFnContext();if(!t.playerId)return null;for(const n of e.world.systemMap.values())if(n.homeworld===t.playerId)return n;return null}function oi(e,t){const{P:n}=globalThis.gameManager.getFnContext();if(!n)return;n.revealedSystems.add(t.id),n.visitedSystems.add(t.id);const r=St(e.world,t.id);if(r)return r.forEach(i=>n.revealedSystems.add(i.id)),e}function pc(e){const{P:t}=globalThis.gameManager.getFnContext();if(t)for(const n of e.world.systemMap.values())t.revealedSystems.add(n.id)}function gc(e,t,n,r,i){e.moveQueue.push({ships:n,toId:t.id,fromId:e.id,playerId:r,message:i})}function mc(e,t,n,r){if(r!==0){if(r<0){if(t.ownerId!==n.ownerId)return;const i=t;t=n,n=i,r=-r}t.ships<r||(n.ownerId===t.ownerId?sg(e,t,n,r):rg(e,t,n,r))}}function rg(e,t,n,r){const i=t.ownerId,s=n.ships??0;if(_c(e.S.world,t,n,r),r>s){const o=r-s;t.ships=t.ships-r,n.ships=o,ig(e,i,n)}else t.ships=t.ships-r,n.ships=s-r}function ig(e,t,n){n.ownerId=t,n.moveQueue=[],t===e.C.playerId&&oi(e.S,n),n.homeworld&&n.homeworld!==t&&yc(e,n.homeworld,t)}function yc({S:e,E:t,C:n},r,i=null){for(const o of e.world.systemMap.values())o.ownerId===r&&(o.ownerId=i,o.ships=Math.max(Math.floor((o.ships??0)/2),1),o.homeworld=null,o.moveQueue=[],i===n.playerId&&oi(e,o)),o.homeworld===r&&(o.homeworld=null);const s=e.playerMap.get(r);s.isAlive=!1,t.emit("PLAYER_ELIMINATED",{loserId:r,winnerId:i})}function _c(e,t,n,r){t.movement=[t.movement[0],t.movement[1]+r],n.movement=[n.movement[0]+r,n.movement[1]];for(const i of e.laneMap.values())i.fromId===t.id&&i.toId===n.id?i.movement=[i.movement[0]+r,i.movement[1]]:i.fromId===n.id&&i.toId===t.id&&(i.movement=[i.movement[0],i.movement[1]+r])}function sg({S:e,C:t},n,r,i){n.ships<i||(n.ships-=i,r.ships+=i,_c(e.world,n,r,i),r.ownerId===t.playerId&&oi(e,r))}function wc(e){for(const t of e.S.world.systemMap.values())for(t.lastMove=null;t.moveQueue.length>0;){const n=t.moveQueue.shift();n&&vc(e,n)}}function vc(e,t){t.playerId===e.C.playerId&&qe(`player move: ${JSON.stringify(t)}`);const n=e.S.world.systemMap.get(t.fromId),r=e.S.world.systemMap.get(t.toId);mc(e,n,r,t.ships),n.lastMove=t,e.E.emit("MAKE_MOVE",t)}function og(e,t){const n=xc(e.S,t);n&&vc(e,n)}function ag(e,t){const n=e.world.systemMap.get(t.fromId);return!(n.ownerId!==t.playerId||!si(e.world,t.fromId,t.toId)||n.ships<=1)}function xc(e,t){if(!ag(e,t))return null;switch(t.type){case"MASS_MOVE":return n(t.fromId,t.toId);case"BALANCED_MOVE":return r(t.fromId,t.toId)}return null;function n(i,s){const{C:o}=globalThis.gameManager.getFnContext(),l=e.world.systemMap.get(i).ships-1;return l<=0?null:{message:`Move ${l} ships from ${i} to ${s}`,ships:l,toId:s,fromId:i,playerId:o.playerId}}function r(i,s){const{C:o}=globalThis.gameManager.getFnContext(),a=e.world.systemMap.get(i),l=e.world.systemMap.get(s),u=l.ownerId===a.ownerId?Math.floor((a.ships-l.ships)/2):Math.floor(a.ships/2);return u<=0?null:{message:`Move ${u} ships from ${a.id} to ${l.id}`,ships:u,toId:l.id,fromId:a.id,playerId:o.playerId}}}const Kn=100,Si={territory:{aggression:.3,expansion:1,defensiveness:.5,riskTolerance:.4,speed:Kn},rusher:{aggression:1,expansion:.4,defensiveness:.1,riskTolerance:.7,speed:Kn},turtle:{aggression:.1,expansion:.3,defensiveness:.95,riskTolerance:.2,speed:Kn},balanced:{aggression:.5,expansion:.5,defensiveness:.5,riskTolerance:.5,speed:Kn}};function lg({S:e}){for(const t of e.playerMap.values())t.bot?.makeMoves()}let cg=0;class ug{constructor(t={}){this.queuedMoves=0,this.threatLevels=new Map,this.frontline=new Set,this.backline=new Set;const n=t.playerIndex??cg++;this.id=t.id??`${n}`;let r=t.personality;if(!r){const i=Object.keys(Si);r=i[n%i.length]}this.name=t.name??r,this.personality=r==="idle"?Si.balanced:Si[r]}makeMoves(){if(this.name==="idle")return;const n=gameManager.getState().world.systemMap.values();if(this.botSystems=Array.from(n).filter(l=>l.ownerId===this.id),this.botSystems.length===0)return;for(const l of this.botSystems)l.moveQueue=[];this.queuedMoves=0,this.analyzeMap();const r=this.getDefensiveMoves();if(this.chooseMoves(r,1-this.personality.defensiveness),this.queuedMoves>=this.personality.speed)return;const i=this.getCoordinatedAttackMoves();if(this.chooseMoves(i,this.personality.aggression),this.queuedMoves>=this.personality.speed)return;const s=this.getExterminateMoves();if(this.chooseMoves(s,this.personality.defensiveness),this.queuedMoves>=this.personality.speed)return;const o=this.getExploreMoves();if(this.chooseMoves(o,this.personality.expansion),this.queuedMoves>=this.personality.speed)return;const a=this.getLogisticsMoves();this.chooseMoves(a,1),this.queuedMoves>=this.personality.speed}analyzeMap(){this.threatLevels.clear(),this.frontline.clear(),this.backline.clear();const t=gameManager.getState();this.botSystems.forEach(n=>{const r=St(t.world,n.id),i=r.filter(a=>a.ownerId&&a.ownerId!==this.id),s=r.filter(a=>!a.ownerId),o=i.reduce((a,l)=>a+l.ships,0);this.threatLevels.set(n.id,o),i.length>0||s.length>0?this.frontline.add(n.id):this.backline.add(n.id)})}getDefensiveMoves(){const t=gameManager.getState();return this.botSystems.map(n=>{if(n.moveQueue.length>0)return[];const r=[],i=this.threatLevels.get(n.id)??0;if(i>0){const s=i*1.1;if(n.ships<s)if(n.ships<i*.5){const o=St(t.world,n.id).filter(a=>a.ownerId===this.id).sort((a,l)=>(this.threatLevels.get(a.id)||0)-(this.threatLevels.get(l.id)||0))[0];o&&r.push({message:`Retreating from ${n.id}`,from:n,to:o,units:n.ships-1,score:1e3})}else r.push({message:`Holding ${n.id}`,from:n,to:n,units:0,score:i});else n.ships<s*1.5&&r.push({message:`Defending ${n.id} from threat level ${i}`,from:n,to:n,units:0,score:i})}return r})}getCoordinatedAttackMoves(){const t=gameManager.getState(),n=new Map;this.botSystems.forEach(i=>{if(i.moveQueue.length>0||i.ships<5)return;const s=St(t.world,i.id);s&&s.forEach(o=>{if(o.ownerId!==null&&o.ownerId!==this.id){if(St(t.world,i.id).filter(l=>l.ownerId&&l.ownerId!==this.id&&l.id!==o.id).length>0)return;n.has(o.id)||n.set(o.id,{target:o,attackers:[]}),n.get(o.id).attackers.push(i)}})});const r=[];return n.forEach(({target:i,attackers:s})=>{const a=St(t.world,i.id).filter(c=>c.ownerId===i.ownerId).length===0?1.5:1,l=s.reduce((c,f)=>{const d=this.threatLevels.get(f.id)||0,y=Math.max(0,f.ships-d*1.1);return c+Math.floor(y*(1-this.personality.defensiveness))},0),h=(i.ships+(i.homeworld?10:0))*(1.3-this.personality.riskTolerance);l>h&&s.forEach(c=>{if(c.moveQueue.length>0)return;const f=this.threatLevels.get(c.id)||0,d=Math.max(0,c.ships-f*1.1),y=Math.floor(d*(1-this.personality.defensiveness)),w=this.getBestMoveAmount(c,i,y);w>0&&r.push([{message:`Coordinated attack on ${i.id}`,from:c,to:i,units:w,score:(100+(i.homeworld?50:0))*a}])})}),r}getExterminateMoves(){const t=gameManager.getState();return this.botSystems.map(n=>n.moveQueue.length>0?[]:n.ships<3?[]:St(t.world,n.id).flatMap(i=>{if(i.ownerId===this.id)return[];if(i.ownerId===null&&i.type==="UNINHABITED")return[];if(n.ships>i.ships*1.5+5){const s=n.ships-2;return[{message:`Crushing weak neighbor ${i.id}`,from:n,to:i,units:s,score:40}]}return[]}))}getExploreMoves(){const t=gameManager.getState();return this.botSystems.map(n=>n.moveQueue.length>0?[]:n.ships<2?[]:St(t.world,n.id).flatMap(i=>{if(i.ownerId!==null)return[];if(i.type==="INHABITED")return[];const s=Math.max(1,Math.floor(n.ships*.3));return[{message:`Exploring ${i.id}`,from:n,to:i,units:s,score:30}]}))}getLogisticsMoves(){const t=gameManager.getState();return this.botSystems.map(n=>{if(n.moveQueue.length>0)return[];if(n.ships<2)return[];if(this.backline.has(n.id)){const r=St(t.world,n.id).filter(o=>this.frontline.has(o.id)&&o.ownerId===this.id);if(r.length>0){const o=r.sort((a,l)=>a.ships-l.ships)[0];return[{message:"Logistics: Frontline Support",from:n,to:o,units:n.ships-1,score:10}]}const s=St(t.world,n.id).filter(o=>o.ownerId===this.id).sort((o,a)=>o.ships-a.ships)[0];if(s&&s.ships<n.ships-2)return[{message:"Logistics: Balancing",from:n,to:s,units:Math.floor((n.ships-s.ships)/2),score:5}]}if(this.frontline.has(n.id)){const r=St(t.world,n.id).filter(i=>i.ownerId===this.id&&(this.threatLevels.get(i.id)||0)>i.ships);if(r.length>0&&(this.threatLevels.get(n.id)||0)<n.ships){const i=r[0];return[{message:"Logistics: Emergency Reinforce",from:n,to:i,units:Math.floor(n.ships/2),score:50}]}}return[]})}getBestMoveAmount(t,n,r){const i=Math.max(0,t.ships-1);let s=0;return n.ownerId===t.ownerId?s=Math.floor((t.ships-n.ships)/2):s=Math.floor(t.ships/2),s=Math.max(0,s),Math.abs(i-r)<Math.abs(s-r)?i:s}chooseMoves(t,n=1){if(t.length===0)return;const r=t.flat().sort(hg);for(const i of r){if(this.queuedMoves>=this.personality.speed)return;if(Math.random()<n){if(i.from.moveQueue.length>0)continue;gc(i.from,i.to,i.units,this.id,i.message),i.units>0&&this.queuedMoves++}}}}function hg(e,t){return e.score!==t.score?t.score-e.score:Math.random()-.5}function bc(e){for(const t of e.playerMap.values()){const n={playerId:t.id,systems:0,ships:0,homeworld:0};for(const r of e.world.systemMap.values())r.ownerId===t.id&&(n.systems+=1,n.ships+=r.ships??0,r.homeworld===t.id&&(n.homeworld=r.ships??0));t.stats=n}}function Sc(e){for(const t of e.world.systemMap.values())t.type==="INHABITED"&&(t.ownerId||t.ships<Ja)&&(t.ships=(t.ships??0)+Hu)}function Mc(e){for(const t of e.world.systemMap.values())t.ownerId!=null&&(t.ships=(t.ships??0)+qu)}function fg({S:e,C:t,E:n,P:r}){if(t.status==="PLAYING"&&r)if(e.playerMap.size>1){const i=Array.from(e.playerMap.values());if(i.reduce((o,a)=>(o+=a.stats.homeworld>0?1:0,o),0)===1){const o=i.find(l=>l.stats.homeworld>0).id,a=e.playerMap.get(o);n.emit("PLAYER_WIN",{playerId:o,message:`${a.name} has conquered The Bubble!`}),n.emit("GAME_STOP",void 0)}}else Array.from(e.world.systemMap.values()).filter(s=>s.ownerId!==t.playerId).length===0&&(n.emit("PLAYER_WIN",{playerId:t.playerId,message:`${r.name} has conquered The Bubble!`}),n.emit("GAME_STOP",void 0))}function dg(e,t=!1){const{S:n,C:r}=e;r.tick%Bu===0&&Sc(n),r.tick%Fu===0&&Mc(n);for(const i of n.world.systemMap.values())i.movement=[0,0];for(const i of n.world.laneMap.values())i.movement=[0,0];t||(lg(e),wc(e)),bc(n)}const pg="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let gg=e=>crypto.getRandomValues(new Uint8Array(e)),mg=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),l=i|0;for(;l--;)if(o+=e[a[l]&r]||"",o.length>=s)return o}}},Ec=(e,t=21)=>mg(e,t|0,gg),$c=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=pg[n[e]&63];return t};const yg=()=>$c(5);function Ac({S:e,C:t}){e.world=ri();const n=ue/(t.config.numSystems-1),r=-ue/2,i=ue/2;qe("Generating map...");const s=Math.min(.08,Math.sqrt(Math.PI/t.config.numSystems));for(let h=r;h<i;h+=n){const c=Math.asin(h/(ue/2))*(180/Math.PI),d=[Math.random()*360-180,c],y=wg(d),w=hc(e.world,y.location);if(w){if(Rr(d,w.location)<s){h-=n;continue}us(e.world,y,w)}uc(e.world,y)}const o=Array.from(e.world.systemMap.values()),a=[o[o.length-1]];for(let h=o.length-2;h>=0;h--){const c=o[h],f=Vs(c.location,a);f&&us(e.world,c,f),a.push(c)}ii(e.world),qe(`Generated ${e.world.systemMap.size} systems and ${e.world.laneMap.size} lanes.`);const l=[...o],u=Math.max(Yu*t.config.numSystems,tl+el);for(let h=0;h<u&&l.length!==0;h++){const c=Math.floor(Math.random()*l.length);if(c===0){h--;continue}const f=l[c];f.ownerId=null,f.type="INHABITED",f.ships=Ja+Math.floor(Math.random()*10),f.homeworld=null,l.splice(c,1)}}function _g(e,t){const n=Array.from(e.world.systemMap.values()).filter(s=>!s.ownerId&&s.type==="INHABITED");if(n.length===0)throw"No available homeworlds to join.";const r=Math.floor(Math.random()*n.length),i=n[r];return i.ships=1,i.ownerId=i.homeworld=t,i.type="INHABITED",i}function wg(e){return{id:"s"+yg(),type:"UNINHABITED",location:e,ownerId:null,ships:0,homeworld:null,moveQueue:[],lastMove:null,movement:[0,0]}}function vg(e){const t=Ys();return Ac({...e,S:t}),t}const xg=Object.freeze(Object.defineProperty({__proto__:null,addLane:us,addPlayer:dc,addSystem:uc,assignSystem:_g,buildNeighborMap:ii,checkVictory:fg,createWorld:ri,defaultConfig:fc,doQueuedMoves:wc,eliminatePlayer:yc,findClosestSystem:hc,findClosestSystemInList:Vs,gameTick:dg,generateMap:Ac,getAdjacentSystems:St,getPlayersHomeworld:Ws,hasLane:si,initalState:Ys,moveShips:mc,orderToMove:xc,queueMove:gc,revealAllSystems:pc,roundUpdate:Mc,setup:vg,takeOrder:og,turnUpdate:Sc,updateStats:bc,visitSystem:oi,worldFromJson:eg,worldToJson:ng},Symbol.toStringTag,{value:"Module"})),ct={all:new Set,last:null};function xe(){ct.all.clear(),ct.last=null}function $n(e){ct.all.add(e),ct.last=e}function bg(e){ct.all.clear(),ct.all.add(e),ct.last=e}function Sg(e){ct.all.delete(e),ct.last===e&&(ct.last=null)}function Ic(e){return ct.all.has(e)}function Mg(e){Ic(e)?Sg(e):$n(e)}function Eg({S:e,C:t},n){if(ct.last==null)return;const r=[[ct.last]],i=new Set;for(i.add(ct.last);r.length>0;){const s=r.shift(),o=s[s.length-1];if(o===n){s.forEach(a=>ct.all.add(a)),ct.last=n;return}for(const a of St(e.world,o))!i.has(a.id)&&a.ownerId===t.playerId&&(i.add(a.id),r.push([...s,a.id]))}}function _a(e,t){const{S:n,C:r}=globalThis.gameManager.getFnContext();if(r.status==="PLAYING")switch(e.button){case 0:break;case 2:{let i=n.world.systemMap.get(t.fromId),s=n.world.systemMap.get(t.toId);if(i.ownerId!==r.playerId&&s.ownerId!==r.playerId)return;if(i.ownerId!==r.playerId){const o=i;i=s,s=o}else if(i.ownerId===i.ownerId&&s.ships>i.ships){const o=i;i=s,s=o}if($g(i.id,s.id),s.ownerId!==r.playerId)return;e.altKey||(!e.ctrlKey&&!e.shiftKey&&xe(),$n(i.id),s.ownerId===r.playerId&&$n(s.id));break}}}function Hr(e,t){const n=globalThis.gameManager.getFnContext();if(n.C.status==="PLAYING")switch(rl&&e.altKey&&(qe(""+t.id,t.lastMove?.message??"none",t.lastMove?.ships??0),console.log(t)),e.button){case 0:if(t.ownerId!==n.C.playerId)return;e.ctrlKey||e.metaKey?Mg(t.id):e.shiftKey?Eg(n,t.id):bg(t.id);break;case-1:case 2:{const r=Array.from(ct.all);if(r.length===0)return;r.forEach(i=>{Ag(i,t.id),t.ownerId===n.C.playerId&&(e.altKey||(!e.ctrlKey&&!e.shiftKey&&xe(),$n(t.id)))});break}}}function $g(e,t){const{S:n,E:r,C:i}=globalThis.gameManager.getFnContext();if(!si(n.world,e,t))return;const s={type:"BALANCED_MOVE",message:`Balanced move from ${e} to ${t}`,toId:t,fromId:e,playerId:i.playerId};r.emit("TAKE_ORDER",s)}function Ag(e,t){const{S:n,E:r,C:i}=globalThis.gameManager.getFnContext();if(!si(n.world,e,t))return;const s={type:"MASS_MOVE",toId:t,fromId:e,playerId:i.playerId,message:`Mass move from ${e} to ${t}`};r.emit("TAKE_ORDER",s)}let Tc=0;const qr=[];function Ig(){Tc=0,qr.length=0;const{E:e}=globalThis.gameManager.getFnContext();e.emit("MESSAGES_UPDATED",{messages:qr})}function Xn(e){const{C:t,E:n}=globalThis.gameManager.getFnContext();qr.push({id:Tc++,message:e,tick:t.tick}),n.emit("MESSAGES_UPDATED",{messages:qr})}const Ks=Math.PI,wa=Ks/2,va=180/Ks,xa=Ks/180,Tg=Math.atan2,ba=Math.cos,kg=Math.max,Pg=Math.min,Sa=Math.sin,Cg=Math.sign||function(e){return e>0?1:e<0?-1:0},kc=Math.sqrt;function Ng(e){return e>1?wa:e<-1?-wa:Math.asin(e)}function Pc(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Mt(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Gr(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]}function jr(e){var t=kc(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]}function Xs(e){return[Tg(e[1],e[0])*va,Ng(kg(-1,Pg(1,e[2])))*va]}function Gt(e){const t=e[0]*xa,n=e[1]*xa,r=ba(n);return[r*ba(t),r*Sa(t),Sa(n)]}function Qs(e){return e=e.map(t=>Gt(t)),Pc(e[0],Mt(e[2],e[1]))}function Og(e){const t=Lg(e),n=zg(t),r=Dg(n,e),i=Bg(n,e.length),s=Rg(i,e),o=Ug(n,e),{polygons:a,centers:l}=Fg(o,n,e),u=Hg(a),h=Gg(n,e),c=qg(r,n);return{delaunay:t,edges:r,triangles:n,centers:l,neighbors:i,polygons:a,mesh:u,hull:h,urquhart:c,find:s}}function Rg(e,t){function n(r,i){let s=r[0]-i[0],o=r[1]-i[1],a=r[2]-i[2];return s*s+o*o+a*a}return function(i,s,o){o===void 0&&(o=0);let a,l,u=o;const h=Gt([i,s]);do a=o,o=null,l=n(h,Gt(t[a])),e[a].forEach(c=>{let f=n(h,Gt(t[c]));if(f<l){l=f,o=c,u=c;return}});while(o!==null);return u}}function Lg(e){if(e.length<2)return{};let t=0;for(;isNaN(e[t][0]+e[t][1])&&t++<e.length;);const n=Or(e[t]),r=ac().translate([0,0]).scale(1).rotate(n.invert([180,0]));e=e.map(r);const i=[];let s=1;for(let c=0,f=e.length;c<f;c++){let d=e[c][0]**2+e[c][1]**2;!isFinite(d)||d>1e32?i.push(c):d>s&&(s=d)}const o=1e6*kc(s);i.forEach(c=>e[c]=[o,0]),e.push([0,o]),e.push([-o,0]),e.push([0,-o]);const a=zs.from(e);a.projection=r;const{triangles:l,halfedges:u,inedges:h}=a;for(let c=0,f=u.length;c<f;c++)if(u[c]<0){const d=c%3==2?c-2:c+1,y=c%3==0?c+2:c-1,w=u[d],E=u[y];u[w]=E,u[E]=w,u[d]=u[y]=-1,l[c]=l[d]=l[y]=t,h[l[w]]=w%3==0?w+2:w-1,h[l[E]]=E%3==0?E+2:E-1,c+=2-c%3}else l[c]>e.length-3-1&&(l[c]=t);return a}function Dg(e,t){const n=new Set;return t.length===2?[[0,1]]:(e.forEach(r=>{if(r[0]!==r[1]&&!(Qs(r.map(i=>t[i]))<0))for(let i=0,s;i<3;i++)s=(i+1)%3,n.add(il([r[i],r[s]]).join("-"))}),Array.from(n,r=>r.split("-").map(Number)))}function zg(e){const{triangles:t}=e;if(!t)return[];const n=[];for(let r=0,i=t.length/3;r<i;r++){const s=t[3*r],o=t[3*r+1],a=t[3*r+2];s!==o&&o!==a&&n.push([s,a,o])}return n}function Ug(e,t){return e.map(n=>{const r=n.map(s=>t[s]).map(Gt),i=Gr(Gr(Mt(r[1],r[0]),Mt(r[2],r[1])),Mt(r[0],r[2]));return Xs(jr(i))})}function Bg(e,t){const n=[];return e.forEach(r=>{for(let i=0;i<3;i++){const s=r[i],o=r[(i+1)%3];n[s]=n[s]||[],n[s].push(o)}}),e.length===0&&(t===2?(n[0]=[1],n[1]=[0]):t===1&&(n[0]=[])),n}function Fg(e,t,n){const r=[],i=e.slice();if(t.length===0){if(n.length<2)return{polygons:r,centers:i};if(n.length===2){const a=Gt(n[0]),l=Gt(n[1]),u=jr(Gr(a,l)),h=jr(Mt(a,l)),c=Mt(u,h),f=[u,Mt(u,c),Mt(Mt(u,c),c),Mt(Mt(Mt(u,c),c),c)].map(Xs).map(o);return r.push(f),r.push(f.slice().reverse()),{polygons:r,centers:i}}}t.forEach((a,l)=>{for(let u=0;u<3;u++){const h=a[u],c=a[(u+1)%3],f=a[(u+2)%3];r[h]=r[h]||[],r[h].push([c,f,l,[h,c,f]])}});const s=r.map(a=>{const l=[a[0][2]];let u=a[0][1];for(let h=1;h<a.length;h++)for(let c=0;c<a.length;c++)if(a[c][0]==u){u=a[c][1],l.push(a[c][2]);break}if(l.length>2)return l;if(l.length==2){const h=Ma(n[a[0][3][0]],n[a[0][3][1]],i[l[0]]),c=Ma(n[a[0][3][2]],n[a[0][3][0]],i[l[0]]),f=o(h),d=o(c);return[l[0],d,l[1],f]}});function o(a){let l=-1;return i.slice(t.length,1/0).forEach((u,h)=>{u[0]===a[0]&&u[1]===a[1]&&(l=h+t.length)}),l<0&&(l=i.length,i.push(a)),l}return{polygons:s,centers:i}}function Ma(e,t,n){e=Gt(e),t=Gt(t),n=Gt(n);const r=Cg(Pc(Mt(t,e),n));return Xs(jr(Gr(e,t)).map(i=>r*i))}function Hg(e){const t=[];return e.forEach(n=>{if(!n)return;let r=n[n.length-1];for(let i of n)i>r&&t.push([r,i]),r=i}),t}function qg(e,t){return function(n){const r=new Map,i=new Map;return e.forEach((s,o)=>{const a=s.join("-");r.set(a,n[o]),i.set(a,!0)}),t.forEach(s=>{let o=0,a=-1;for(let l=0;l<3;l++){let u=il([s[l],s[(l+1)%3]]).join("-");r.get(u)>o&&(o=r.get(u),a=u)}i.set(a,!1)}),e.map(s=>i.get(s.join("-")))}}function Gg(e,t){const n=new Set,r=[];e.map(a=>{if(!(Qs(a.map(l=>t[l>t.length?0:l]))>1e-12))for(let l=0;l<3;l++){let u=[a[l],a[(l+1)%3]],h=`${u[0]}-${u[1]}`;n.has(h)?n.delete(h):n.add(`${u[1]}-${u[0]}`)}});const i=new Map;let s;if(n.forEach(a=>{a=a.split("-").map(Number),i.set(a[0],a[1]),s=a[0]}),s===void 0)return r;let o=s;do{r.push(o);let a=i.get(o);i.set(o,-1),o=a}while(o>-1&&o!==s);return r}function jg(e){const t=function(n){if(t.delaunay=null,t._data=n,typeof t._data=="object"&&t._data.type==="FeatureCollection"&&(t._data=t._data.features),typeof t._data=="object"){const r=t._data.map(i=>[t._vx(i),t._vy(i),i]).filter(i=>isFinite(i[0]+i[1]));t.points=r.map(i=>[i[0],i[1]]),t.valid=r.map(i=>i[2]),t.delaunay=Og(t.points)}return t};return t._vx=function(n){if(typeof n=="object"&&"type"in n)return Jo(n)[0];if(0 in n)return n[0]},t._vy=function(n){if(typeof n=="object"&&"type"in n)return Jo(n)[1];if(1 in n)return n[1]},t.x=function(n){return n?(t._vx=n,t):t._vx},t.y=function(n){return n?(t._vy=n,t):t._vy},t.polygons=function(n){if(n!==void 0&&t(n),!t.delaunay)return!1;const r={type:"FeatureCollection",features:[]};return t.valid.length===0||(t.delaunay.polygons.forEach((i,s)=>r.features.push({type:"Feature",geometry:i?{type:"Polygon",coordinates:[[...i,i[0]].map(o=>t.delaunay.centers[o])]}:null,properties:{site:t.valid[s],sitecoordinates:t.points[s],neighbours:t.delaunay.neighbors[s]}})),t.valid.length===1&&r.features.push({type:"Feature",geometry:{type:"Sphere"},properties:{site:t.valid[0],sitecoordinates:t.points[0],neighbours:[]}})),r},t.triangles=function(n){return n!==void 0&&t(n),t.delaunay?{type:"FeatureCollection",features:t.delaunay.triangles.map((r,i)=>(r=r.map(s=>t.points[s]),r.center=t.delaunay.centers[i],r)).filter(r=>Qs(r)>0).map(r=>({type:"Feature",properties:{circumcenter:r.center},geometry:{type:"Polygon",coordinates:[[...r,r[0]]]}}))}:!1},t.links=function(n){if(n!==void 0&&t(n),!t.delaunay)return!1;const r=t.delaunay.edges.map(s=>Rr(t.points[s[0]],t.points[s[1]])),i=t.delaunay.urquhart(r);return{type:"FeatureCollection",features:t.delaunay.edges.map((s,o)=>({type:"Feature",properties:{source:t.valid[s[0]],target:t.valid[s[1]],length:r[o],urquhart:!!i[o]},geometry:{type:"LineString",coordinates:[t.points[s[0]],t.points[s[1]]]}}))}},t.mesh=function(n){return n!==void 0&&t(n),t.delaunay?{type:"MultiLineString",coordinates:t.delaunay.edges.map(r=>[t.points[r[0]],t.points[r[1]]])}:!1},t.cellMesh=function(n){if(n!==void 0&&t(n),!t.delaunay)return!1;const{centers:r,polygons:i}=t.delaunay,s=[];for(const o of i)if(o)for(let a=o.length,l=o[a-1],u=o[0],h=0;h<a;l=u,u=o[++h])u>l&&s.push([r[l],r[u]]);return{type:"MultiLineString",coordinates:s}},t._found=void 0,t.find=function(n,r,i){if(t._found=t.delaunay.find(n,r,t._found),!i||Rr([n,r],t.points[t._found])<i)return t._found},t.hull=function(n){n!==void 0&&t(n);const r=t.delaunay.hull,i=t.points;return r.length===0?null:{type:"Polygon",coordinates:[[...r.map(s=>i[s]),i[r[0]]]]}},e?t(e):t}const Cc=Math.acos,Vg=Math.asin,Ea=Math.atan2,be=Math.cos,$a=Math.hypot,hs=Math.max,fs=Math.min,Nc=Math.PI,Se=Math.sin,gn=Nc/180,Mi=180/Nc;class Pt{static fromCartesian([t,n,r]){return[0,r,-n,t]}static fromAngles([t,n,r]){t*=gn/2,n*=gn/2,r=(r||0)*gn/2;const i=Se(t),s=be(t),o=Se(n),a=be(n),l=Se(r),u=be(r);return[s*a*u+i*o*l,i*a*u-s*o*l,s*o*u+i*a*l,s*a*l-i*o*u]}static toAngles([t,n,r,i]){return[Ea(2*(t*n+r*i),1-2*(n*n+r*r))*Mi,Vg(hs(-1,fs(1,2*(t*r-i*n))))*Mi,Ea(2*(t*i+n*r),1-2*(r*r+i*i))*Mi]}static interpolateAngles(t,n){const r=Pt.interpolate(Pt.fromAngles(t),Pt.fromAngles(n));return i=>Pt.toAngles(r(i))}static interpolateLinear([t,n,r,i],[s,o,a,l]){s-=t,o-=n,a-=r,l-=i;const u=new Array(4);return h=>{const c=$a(u[0]=t+s*h,u[1]=n+o*h,u[2]=r+a*h,u[3]=i+l*h);return u[0]/=c,u[1]/=c,u[2]/=c,u[3]/=c,u}}static interpolate([t,n,r,i],[s,o,a,l]){let u=Pt.dot([t,n,r,i],[s,o,a,l]);if(u<0&&(s=-s,o=-o,a=-a,l=-l,u=-u),u>.9995)return Pt.interpolateLinear([t,n,r,i],[s,o,a,l]);const h=Cc(hs(-1,fs(1,u))),c=new Array(4),f=$a(s-=t*u,o-=n*u,a-=r*u,l-=i*u);return s/=f,o/=f,a/=f,l/=f,d=>{const y=h*d,w=Se(y),E=be(y);return c[0]=t*E+s*w,c[1]=n*E+o*w,c[2]=r*E+a*w,c[3]=i*E+l*w,c}}static dot([t,n,r,i],[s,o,a,l]){return t*s+n*o+r*a+i*l}static multiply([t,n,r,i],[s,o,a,l]){return[t*s-n*o-r*a-i*l,t*o+n*s+r*l-i*a,t*a-n*l+r*s+i*o,t*l+n*a-r*o+i*s]}}const It=Pt.fromAngles;It.multiply=Pt.multiply;It.rotation=Pt.toAngles;It.interpolate=Pt.interpolateAngles;It.cartesian=function(e){const t=e[0]*gn,n=e[1]*gn,r=be(n);return[r*be(t),r*Se(t),Se(n)]};It.delta=function(e,t,n){arguments.length==2&&(n=1);const r=Math.sqrt;function i(h,c){return[h[1]*c[2]-h[2]*c[1],h[2]*c[0]-h[0]*c[2],h[0]*c[1]-h[1]*c[0]]}function s(h,c){return h[0]*c[0]+h[1]*c[1]+h[2]*c[2]}const o=i(e,t),a=r(s(o,o));if(!a)return[1,0,0,0];const l=n*Cc(hs(-1,fs(1,s(e,t))))/2,u=Se(l);return[be(l),o[2]/a*u,-o[1]/a*u,o[0]/a*u]};const Aa=.5,Yg=.25,Wg=100,Kg=20,Xg=ei(".3~s"),Ke={Orthographic:Vp,Stereographic:ac,Mercator:jp,TransverseMercator:Yp};let ds,Ct,Xe=Ke[zu],it=Xe().translate([0,0]),se=it.scale(),ai=Fs().projection(it),ur;const Qg=jg().x(e=>e.location[0]).y(e=>e.location[1]);function Zg(){const e=Object.keys(Ke),n=(e.findIndex(r=>Ke[r]===Xe)+1)%e.length;Jg(e[n])}function Jg(e){Xe=Ke[e],it=Xe(),it.translate([0,0]).rotate([0,0,0]).scale(se),se=it.scale(),ai=Fs().projection(it)}function Ne(e){const t=it.rotate();t[0]+=e[0],t[1]+=e[1],e.length===3&&(t[2]+=e[2]),it.rotate(t)}function tm(e,t){ds=Nt(e),Ct=ds.select("svg"),Ct.attr("width","100vw").attr("height","100vh").attr("viewBox",`-${gr/2} -${ue/2} ${gr} ${ue}`).on("contextmenu",o=>o.preventDefault()),ps(t.S),Rc(t),Lc(t),Oc(t),Ct.call(n()),Ct.call(r()),window.addEventListener("resize",s);function n(){return i().on("drag.render",()=>Z()).on("end.render",()=>Z())}function r(){return tg().filter(o=>o.type==="wheel").on("zoom",o=>{if(o.transform.k>Aa){const a=se*o.transform.k;it.scale(a),Z()}else o.transform.k=Aa})}function i(){let o,a,l,u,h;function c(w,E){const v=Rf(w,E);if(v.length!==h&&(h=v.length,h>1&&(u=Math.atan2(v[1][1]-v[0][1],v[1][0]-v[0][0])),f.apply(E,[w,E])),h>1){const T=wo(v,C=>C[0]),A=wo(v,C=>C[1]),b=Math.atan2(v[1][1]-v[0][1],v[1][0]-v[0][0]);return[T,A,b]}return v[0]}function f({x:w,y:E}){const v=y([w,E]);o=It.cartesian(it.invert(v)),l=it.rotate(),a=It(l)}function d(w){const E=y([w.x,w.y]),v=It.cartesian(it.rotate(l).invert(E)),T=It.delta(o,v);let A=It.multiply(a,T);const b=c(w,this);if(b[2]){const C=(b[2]-u)/2,R=-Math.sin(C),D=Math.sign(Math.cos(C));A=It.multiply([Math.sqrt(1-R*R),0,0,D*R],A)}it.rotate(It.rotation(A)),T[0]<.7&&f.apply(this,[w,this])}function y(w){const E=parseInt(Ct.style("width")),v=parseInt(Ct.style("height"));return[w[0]-E/2,w[1]-v/2]}return Ff().filter(w=>w.button===1||w.touches).on("start",f).on("drag",d)}function s(){ps(globalThis.gameManager.getState())}}function ps(e){const t=Ct.node()?.getBoundingClientRect(),n=window.devicePixelRatio||1,r=t?.height||ue,i=t?.width||gr,a=ds.selectAll("canvas").data([null]).join(h=>h.append("canvas").style("position","absolute").style("top",0).style("left",0).style("z-index",-1).style("pointer-events","none")).attr("width",i*n).attr("height",r*n).style("width",`${i}px`).style("height",`${r}px`).node().getContext("2d");a.setTransform(1,0,0,1,0,0),a.scale(n,n),a.translate(i/2,r/2);const l=Math.min(i/gr,r/ue);a.scale(l,l);const u="#FFFFFF48";if(Xe===Ke.Orthographic){const h=it.scale();a.strokeStyle=u,a.lineWidth=1,a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=10,a.shadowColor=u,a.beginPath(),a.arc(0,0,h,0,Math.PI*2),a.stroke(),a.fill()}{a.shadowBlur=0,a.strokeStyle="rgba(51, 51, 51, 0.5)";const h=em(e),c=Fs().projection(it).context(a);a.beginPath(),c(h),a.stroke()}}function em(e){const t=Sp(),n=Ws(e);if(n){if(!ur){const r=Or([0,90+n.location[1],0]),i=Or([n.location[0],0,0]);ur={type:"FeatureCollection",features:t.lines().map(s=>({type:"Feature",geometry:{type:"LineString",coordinates:s.coordinates.map(o=>i(r(o)))}}))}}return ur}return t()}function Ia(e){const t=it.scale()*e;t<se*Yg||t>se*Wg||(it.scale(t),Z())}function gs(){const e=globalThis.gameManager.getState(),t=Ws(e);if(!t)return;ur=null;const n=t.location;Xe===Ke.Orthographic?ms([n[0],n[1]-45]):ms(n),it.scale(se)}function nm(e){const n=globalThis.gameManager.getState().world.systemMap.get(e);n&&(ms(n.location),it.scale(se))}function ms(e){it.rotate([-e[0],-e[1],0]),Z()}let Ta=null;function Z(){return cancelAnimationFrame(Ta),Ta=requestAnimationFrame(()=>e());function e(t){Ct&&(t??=globalThis.gameManager.getFnContext(),Rc(t),ps(t.S),Oc(t),Lc(t))}}function Oc({S:e,C:t,P:n}){const i=it.scale()/se<1;let s=e.world.systemMap.values();n&&t.config.fow&&(s=n.revealedSystems.values().map(l=>e.world.systemMap.get(l))),s=s.filter(l=>!!ai({type:"Point",coordinates:l.location}));const a=Ct.selectAll("g#systems").data([null]).join(l=>l.append("g").attr("id","systems")).classed("reduced-size",i).classed("hidden",!1).selectAll(".system").data(s,l=>l.id).join(l=>{const u=l.append("g").attr("class","system").attr("id",h=>h.id).on("click",(h,c)=>{Hr(h,c),Z()}).on("contextmenu",(h,c)=>{h.preventDefault(),Hr(h,c),Z()});return u.append("circle").attr("class","system-outline").attr("cx",0).attr("cy",0).attr("r",Kg/2),u.append("text").attr("class","ship-count").attr("y",-10).attr("x",0).attr("text-anchor","start"),u.append("text").attr("class","system-icon").attr("y",0).attr("x",0).attr("text-anchor","end"),u});a.style("--owner-color",l=>e.playerMap.get(l.ownerId)?.color??null).classed("own",l=>l.ownerId===t.playerId).classed("selected",l=>Ic(l.id)).classed("moved",l=>l.movement[0]>0||l.movement[1]>0).classed("inhabited",l=>l.type==="INHABITED").classed("homeworld",l=>!!l.homeworld&&l.ownerId===l.homeworld).classed("visited",l=>n?n.visitedSystems.has(l.id):!0).attr("transform",l=>`translate(${it(l.location)})`),a.select(".system-icon").text(l=>l.homeworld&&l.ownerId===l.homeworld?"":l.type==="INHABITED"?"":""),a.select(".ship-count").text(l=>i?"":(l.type==="INHABITED"?"":"")+(l.ships?Xg(l.ships):""))}const rm=(()=>{let e=[],t;return n=>{if(!e||t!==n.world.systemMap){t=n.world.systemMap;const r=Array.from(t.values());e=Qg.polygons(r).features}return e}})();function Rc({S:e,C:t,P:n}){const i=it.scale()/se<1;let s=rm(e);n&&t.config.fow&&(s=s.filter(l=>{const u=l.properties?.site;return n.revealedSystems.has(u.id)})),Ct.selectAll("g#mesh").data([null]).join(l=>l.append("g").attr("id","mesh")).classed("reduced-size",i).classed("hidden",!1).selectAll("path").data(s).join(l=>l.append("path").classed("region",!0).on("click",(u,h)=>{Hr(u,h),Z()}).on("contextmenu",(u,h)=>{u.preventDefault(),Hr(u,h),Z()})).attr("d",l=>ai(l)).datum(l=>l.properties.site).classed("visited",l=>n?n.visitedSystems.has(l.id):!0).style("--owner-color",l=>e.playerMap.get(l.ownerId)?.color??null)}function Lc({S:e,C:t,P:n}){let r=e.world.laneMap.values();n&&t.config.fow&&(r=r.filter(o=>n.revealedSystems.has(o.fromId)&&n.revealedSystems.has(o.toId)));const s=Ct.selectAll("g#lanes").data([null]).join(o=>o.append("g").attr("id","lanes")).selectAll("g.lane-group").data(r,o=>o.id).join(o=>{const a=o.append("g").attr("class","lane-group").attr("id",l=>l.id).on("click",(l,u)=>{_a(l,u),Z()}).on("contextmenu",(l,u)=>{l.preventDefault(),_a(l,u),Z()});return a.append("path").attr("class","lane"),a.append("path").attr("class","pulse"),a}).datum(o=>{const a=e.world.systemMap.get(o.toId),l=e.world.systemMap.get(o.fromId),u=ai({type:"LineString",coordinates:[l.location,a.location]});return{...o,from:e.world.systemMap.get(o.fromId),to:e.world.systemMap.get(o.toId),path:u}});s.style("--owner-color",o=>{const a=o.from;if(!a.ownerId)return null;const l=o.to;return!l.ownerId||a.ownerId!==l.ownerId?null:e.playerMap.get(a.ownerId)?.color??null}),s.select("path.lane").attr("d",o=>o.path).classed("own",o=>{const a=o.from,l=o.to;return a.ownerId===t.playerId||l.ownerId===t.playerId}).style("--path-length",o=>{const a=Nt(`#${o.id} .lane`).node();return a?a.getTotalLength():200}),s.select("path.pulse").attr("d",o=>o.path).classed("moved",o=>o.movement[0]>0||o.movement[1]>0).style("stroke-width",o=>{if(o.movement[0]===0&&o.movement[1]===0)return null;const a=2,l=Math.floor(Math.log2(Math.max(o.movement[0],o.movement[1])));return`${(a+l)*2}px`}).classed("moved--fwd",o=>o.movement[0]>o.movement[1]).classed("moved--bak",o=>o.movement[1]>o.movement[0])}const im=`<!-- @license lucide-static v0.562.0 - ISC -->
<svg
  class="lucide lucide-github"
  xmlns="http://www.w3.org/2000/svg"
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
>
  <path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4" />
  <path d="M9 18c-4.51 2-5-2-7-2" />
</svg>
`;class sm{constructor(){this.listeners={}}on(t,n){return this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(n),()=>{this.listeners[t]=this.listeners[t].filter(r=>r!==n)}}emit(t,n){const r=this.listeners[t];if(r)for(const i of r)try{i(n)}catch(s){console.error(`Error in listener for event ${String(t)}:`,s)}}clear(){this.listeners={}}}class Dc{constructor(){this.events=new sm,this.game=xg,this.state=Ys(),this.config=fc(),this.tick=0,this.status="WAITING",this.runningInterval=null,this.#e()}getState(){return mr?Object.freeze({...this.state}):this.state}getConfig(){return mr?Object.freeze({...this.config}):this.config}async setConfig(t){this.config={...this.config,...t},this.events.emit("CONFIG_UPDATED",{config:this.config})}getPlayer(){return this.state.playerMap.get(this.playerId)??null}getContext(){return{tick:this.tick,status:this.status,playerId:this.playerId,config:this.getConfig()}}getFnContext(){return{S:this.state,E:this.events,P:this.state.playerMap.get(this.playerId),C:this.getContext()}}addPlayer(t){if(this.state.playerMap.has(t.id))return this.state.playerMap.get(t.id);const n=t.score??{userId:t.id,playerName:t.name??`Player ${this.state.playerMap.size+1}`,score:0,tick:0,timestamp:Date.now()},r={name:t.name??`Player ${this.state.playerMap.size+1}`,score:n,color:"#000000",...t,stats:{playerId:t.id,systems:0,ships:0,homeworld:0},isAlive:!0,visitedSystems:new Set,revealedSystems:new Set};return dc(this.state,r),r}gameStart(){this.status="PLAYING",this.tick=0,this.events.emit("GAME_START",void 0),this.#t()}gameStop(){this.status="FINISHED",this.stopGameLoop()}gameTick(){this.tick++,this.game.gameTick(this.getFnContext()),this.game.checkVictory(this.getFnContext()),this.events.emit("STATE_UPDATED",{state:this.state,status:this.status})}#t(){if(this.status!=="PLAYING"){this.gameStop();return}this.stopGameLoop(),this.gameTick(),this.events.emit("GAME_TICK",{tick:this.tick}),this.runningInterval=setTimeout(()=>this.#t(),Uu/this.config.timeScale)}startGameLoop(){this.#t()}stopGameLoop(){this.runningInterval&&(clearTimeout(this.runningInterval),this.runningInterval=null)}#e(){this.events.on("GAME_STOP",()=>{this.gameStop()}),this.events.on("TAKE_ORDER",t=>{this.game.takeOrder(this.getFnContext(),t),this.events.emit("STATE_UPDATED",{state:this.state,status:this.status})})}}const Ze=Dc,om=Symbol("config"),am=Symbol("state"),lm=Symbol("player"),cm=Symbol("context"),um=`<dialog id="optionsDialog">
  <form id="optionsForm" method="dialog">
    <!-- label for="numBotsInput">
      Number of Bots

      <div class="btn-group" data-toggle="buttons" role="group">
        <label role="button" class="btn btn-primary">
          <input type="radio" name="numBots" id="option1" value="0">
          None
        </label>
        <label role="button" class="btn btn-primary">
          <input type="radio" name="numBots" id="option2" value="1">
          1
        </label>
        <label role="button" class="btn btn-primary">
          <input type="radio" name="numBots" id="option2" value="1">
          2
        </label>
        <label role="button" class="btn btn-primary">
          <input type="radio" name="numBots" id="option3" value="4" checked>
          4
        </label>
        <label role="button" class="btn btn-primary">
          <input type="radio" name="numBots" id="option3" value="8">
          8
        </label>
      </div>
    </label -->

    <label for="fowInput">
      Fog of War
      <input name="fow" type="checkbox" role="switch" checked />
    </label>

    <label for="numSystemsInput">
      Bubble Size
      <input name="numSystems" min="0" max="4" step="1" type="range" list="steplist">
      <datalist id="steplist">
        <option value="48">Tiny</option>
        <option value="96"></option>
        <option value="192">Med</option>
        <option value="384"></option>
        <option value="768">Large</option>
      </datalist>
    </label>

    <p />&nbsp;
    <p />
    <button id="optionsOkButton">OK</button>
    <button id="optionsCancelButton" type="reset">Reset</button>
  </form>
</dialog>`;var hm=Object.defineProperty,fm=Object.getOwnPropertyDescriptor,zc=e=>{throw TypeError(e)},oe=(e,t,n,r)=>{for(var i=r>1?void 0:r?fm(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&hm(t,n,i),i},dm=(e,t,n)=>t.has(e)||zc("Cannot "+n),pm=(e,t,n)=>t.has(e)?zc("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),ka=(e,t,n)=>(dm(e,t,"access private method"),n),hr,Uc,Bc;const Oe=5;let Vt=class extends Lt{constructor(){super(...arguments),pm(this,hr)}async connectedCallback(){super.connectedCallback(),ka(this,hr,Uc).call(this),ka(this,hr,Bc).call(this)}createRenderRoot(){return this}render(){return at`
      <dialog id="startDialog" closedby="none">
        <start-dialog-content
          @startClicked=${this.onStart}
        ></start-dialog-content>
      </dialog>
      <dialog id="endDialog">
        <p id="endMessage"></p>
        <form method="dialog">
          <button id="restartButton">Yes</button>
        </form>
      </dialog>
      <dialog id="helpDialog">${this.renderHelp()}</dialog>
      ${_e(um)}
      <game-canvas id="app"></game-canvas>
      <tick-box tick="${this.context?.tick}"></tick-box>
      <leaderboard-element></leaderboard-element>
      <message-box></message-box>
      <button id="helpButton" @click=${this.showHelp}>?</button>
    `}renderHelp(){return at`<article>
      <h2>Introduction</h2>

      <p>
        This is a simple strategy game where you control a number of star
        systems and try to conquer the the Bubble. The Bubble is a cluster of
        star systems connected by hyperspace lanes. You start with one system
        and must expand your control by sending ships to capture other systems.
      </p>

      <h3>Gameplay</h3>
      <ul>
        <li>
          The game is played in real-time, with each turn lasting 1 second.
        </li>
        <li>You begin the game controlling one system, your homeworld.</li>
        <li>
          Each turn, your homeworld and any other inhabited systems you control,
          will produce an additional ship.
        </li>
        <li>You can send these ships to other systems to capture them.</li>
        <li>
          Each controlled system receives an additional ship each 25 turns.
        </li>
        <li>
          To transfer ships, left click on a system you control and then right
          click on a target system.
        </li>
        <li>
          This will send all available ships, less one, from the source system
          to the target system.
        </li>
        <li>
          Right click on the hyperspace lane between the systems to send half of
          the available ships.
        </li>
        <li>
          If the target system is uninhabited, you will capture it
          automatically.
        </li>
        <li>
          If the target system is controlled by another player, a battle will
          ensue.
        </li>
        <li>
          The player with the most ships on the target system after all ships
          have arrived will take control of the system.
        </li>
      </ul>
      <h3>Objective</h3>
      <p>
        The goal is to eliminate all other player's homeworlds and control the
        entire Bubble.
      </p>

      <p>
        <a href="https://github.com/Hypercubed/starz">
          ${_e(im)}
        </a>
      </p>

      <form method="dialog">
        <button>Exit</button>
      </form>
    </article>`}showStartDialog(){this.startDialog?.showModal()}onStart(){this.startDialog.close(),this.gameManager.start()}async onKeyup(e){const t=e.target?.tagName;if(!(t==="INPUT"||t==="TEXTAREA")){switch(e.key){case"?":this.showHelp();return;case"Escape":xe(),Z();return;case"x":{if(!e.ctrlKey)return;this.gameManager.quit();return}}if(rl&&e.altKey){e.preventDefault();const{S:n,C:r}=globalThis.gameManager.getFnContext();switch(e.code){case"KeyC":for(const i of n.world.systemMap.values())i.ownerId===r.playerId&&(i.ships*=2);Z();return;case"KeyR":pc(n),Z();return;case"NumpadAdd":case"Equal":{const i=Math.min(16,r.config.timeScale*2);globalThis.gameManager.setConfig({timeScale:i}),qe(`Time scale increased to ${r.config.timeScale}x`);return}case"NumpadSubtract":case"Minus":{const i=Math.max(.25,r.config.timeScale/2);globalThis.gameManager.setConfig({timeScale:i}),qe(`Time scale decreased to ${r.config.timeScale}x`);return}}}}}async onKeypress(e){const t=e.target?.tagName;if(!(t==="INPUT"||t==="TEXTAREA"))switch(e.code){case"Space":"pauseToggle"in globalThis.gameManager&&globalThis.gameManager.pauseToggle();return;case"Equal":case"NumpadAdd":Ia(1.2),Z();return;case"Minus":case"NumpadSubtract":Ia(.8),Z();return;case"KeyW":Ne([0,Oe]),Z();return;case"KeyA":Ne([-Oe,0]),Z();return;case"KeyS":Ne([0,-Oe]),Z();return;case"KeyD":Ne([Oe,0]),Z();return;case"KeyQ":Ne([0,0,Oe]),Z();break;case"KeyE":Ne([0,0,-Oe]),Z();break;case"KeyH":gs(),Z();return;case"KeyC":ct.last&&(nm(ct.last),Z());return;case"KeyP":Zg(),gs(),Z();return}}showHelp(){this.helpDialog.showModal()}async showEndGame(e){return this.endDialog.showModal(),this.endDialog.querySelector("p#endMessage").textContent=e,new Promise(t=>{this.endDialog.addEventListener("close",()=>t(!0)),this.endDialog.addEventListener("cancel",()=>t(!1))})}};hr=new WeakSet;Uc=function(){window.document.addEventListener("keyup",e=>this.onKeyup(e)),window.document.addEventListener("keypress",e=>this.onKeypress(e))};Bc=function(){this.config=this.gameManager.getConfig(),this.state=this.gameManager.getState(),this.player=this.gameManager.getPlayer(),this.context=this.gameManager.getContext(),this.gameManager.events.on("GAME_INIT",()=>{this.config=this.gameManager.getConfig(),this.state=this.gameManager.getState(),this.player=this.gameManager.getPlayer(),this.context=this.gameManager.getContext()}),this.gameManager.events.on("CONFIG_UPDATED",({config:e})=>{this.config=e,this.player=this.gameManager.getPlayer(),this.context=this.gameManager.getContext()}),this.gameManager.events.on("STATE_UPDATED",({state:e})=>this.state=e),this.gameManager.events.on("GAME_TICK",()=>{this.context=this.gameManager.getContext()})};oe([In({context:Ze}),ks({attribute:!1})],Vt.prototype,"gameManager",2);oe([In({context:om}),gt()],Vt.prototype,"config",2);oe([In({context:am}),gt()],Vt.prototype,"state",2);oe([In({context:lm}),gt()],Vt.prototype,"player",2);oe([In({context:cm}),gt()],Vt.prototype,"context",2);oe([Ps("#helpDialog")],Vt.prototype,"helpDialog",2);oe([Ps("#startDialog")],Vt.prototype,"startDialog",2);oe([Ps("#endDialog")],Vt.prototype,"endDialog",2);Vt=oe([ke("app-root")],Vt);var gm=Object.defineProperty,mm=Object.getOwnPropertyDescriptor,Zs=(e,t,n,r)=>{for(var i=r>1?void 0:r?mm(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&gm(t,n,i),i};const ym=ei(".3~s");let Vr=class extends Lt{createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this.gameManager.events.on("GAME_TICK",()=>this.updateStats()),this.gameManager.events.on("STATE_UPDATED",()=>this.updateStats())}updateStats(){const e=this.gameManager.getState()?.playerMap;e&&(this.stats=Array.from(e.values()).sort((t,n)=>n.stats.systems-t.stats.systems||n.stats.ships-t.stats.ships))}render(){return at`
      <table id="leaderbox">
        ${this.renderHeader()} ${this.renderBody()}
      </table>
    `}renderBody(){return at`<tbody>
      ${this.stats?.map(t=>at`<tr
            style="--owner-color: ${t.color||null}"
            title="${t.bot?t.bot.name:"Human"}"
            class="${t.isAlive?"":"eliminated"}"
          >
            <td>${""}${t.name}${""}</td>
            <td>${""}${t.stats.systems}${""}</td>
            <td>${""}${ym(t.stats.ships)}${""}</td>
          </tr>`)}
    </tbody>`}renderHeader(){return at`<thead>
        <tr>
          <th>Player</th>
          <th>Systems</th>
          <th>Ships</th>
        </tr>
      </thead>
      <tbody></tbody>`}};Zs([Tn({context:Ze}),gt()],Vr.prototype,"gameManager",2);Zs([gt()],Vr.prototype,"stats",2);Vr=Zs([ke("leaderboard-element")],Vr);var ys;try{ys=new TextDecoder}catch{}var U,jt,S=0,tt={},Y,he,At=0,Ht=0,ht,ee,bt=[],j,Pa={useRecords:!1,mapsAsObjects:!0};class Fc{}const Hc=new Fc;Hc.name="MessagePack 0xC1";var fe=!1,qc=2,_m;try{new Function("")}catch{qc=1/0}class An{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(U)return Kc(()=>(ws(),this?this.unpack(t,n):An.prototype.unpack.call(Pa,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof Buffer<"u"?Buffer.from(t):new Uint8Array(t)),typeof n=="object"?(jt=n.end||t.length,S=n.start||0):(S=0,jt=n>-1?n:t.length),Ht=0,he=null,ht=null,U=t;try{j=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw U=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof An){if(tt=this,this.structures)return Y=this.structures,Qn(n);(!Y||Y.length>0)&&(Y=[])}else tt=Pa,(!Y||Y.length>0)&&(Y=[]);return Qn(n)}unpackMultiple(t,n){let r,i=0;try{fe=!0;let s=t.length,o=this?this.unpack(t,s):li.unpack(t,s);if(n){if(n(o,i,S)===!1)return;for(;S<s;)if(i=S,n(Qn(),i,S)===!1)return}else{for(r=[o];S<s;)i=S,r.push(Qn());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{fe=!1,ws()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function Qn(e){try{if(!tt.trusted&&!fe){let n=Y.sharedLength||0;n<Y.length&&(Y.length=n)}let t;if(tt.randomAccessStructure&&U[S]<64&&U[S]>=32&&_m||(t=st()),ht&&(S=ht.postBundlePosition,ht=null),fe&&(Y.restoreStructures=null),S==jt)Y&&Y.restoreStructures&&Ca(),Y=null,U=null,ee&&(ee=null);else{if(S>jt)throw new Error("Unexpected end of MessagePack data");if(!fe){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw Y&&Y.restoreStructures&&Ca(),ws(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||S>jt)&&(t.incomplete=!0),t}}function Ca(){for(let e in Y.restoreStructures)Y[e]=Y.restoreStructures[e];Y.restoreStructures=null}function st(){let e=U[S++];if(e<160)if(e<128){if(e<64)return e;{let t=Y[e&63]||tt.getStructures&&Gc()[e&63];return t?(t.read||(t.read=Js(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,tt.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Vc();r==="__proto__"&&(r="__proto_"),t[r]=st()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(st(),st());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=st();return tt.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(Ht>=S)return he.slice(S-At,(S+=t)-At);if(Ht==0&&jt<140){let n=t<16?to(t):jc(t);if(n!=null)return n}return _s(t)}else{let t;switch(e){case 192:return null;case 193:return ht?(t=st(),t>0?ht[1].slice(ht.position1,ht.position1+=t):ht[0].slice(ht.position0,ht.position0-=t)):Hc;case 194:return!1;case 195:return!0;case 196:if(t=U[S++],t===void 0)throw new Error("Unexpected end of buffer");return Ei(t);case 197:return t=j.getUint16(S),S+=2,Ei(t);case 198:return t=j.getUint32(S),S+=4,Ei(t);case 199:return pe(U[S++]);case 200:return t=j.getUint16(S),S+=2,pe(t);case 201:return t=j.getUint32(S),S+=4,pe(t);case 202:if(t=j.getFloat32(S),tt.useFloat32>2){let n=eo[(U[S]&127)<<1|U[S+1]>>7];return S+=4,(n*t+(t>0?.5:-.5)>>0)/n}return S+=4,t;case 203:return t=j.getFloat64(S),S+=8,t;case 204:return U[S++];case 205:return t=j.getUint16(S),S+=2,t;case 206:return t=j.getUint32(S),S+=4,t;case 207:return tt.int64AsType==="number"?(t=j.getUint32(S)*4294967296,t+=j.getUint32(S+4)):tt.int64AsType==="string"?t=j.getBigUint64(S).toString():tt.int64AsType==="auto"?(t=j.getBigUint64(S),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=j.getBigUint64(S),S+=8,t;case 208:return j.getInt8(S++);case 209:return t=j.getInt16(S),S+=2,t;case 210:return t=j.getInt32(S),S+=4,t;case 211:return tt.int64AsType==="number"?(t=j.getInt32(S)*4294967296,t+=j.getUint32(S+4)):tt.int64AsType==="string"?t=j.getBigInt64(S).toString():tt.int64AsType==="auto"?(t=j.getBigInt64(S),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=j.getBigInt64(S),S+=8,t;case 212:if(t=U[S++],t==114)return za(U[S++]&63);{let n=bt[t];if(n)return n.read?(S++,n.read(st())):n.noBuffer?(S++,n()):n(U.subarray(S,++S));throw new Error("Unknown extension "+t)}case 213:return t=U[S],t==114?(S++,za(U[S++]&63,U[S++])):pe(2);case 214:return pe(4);case 215:return pe(8);case 216:return pe(16);case 217:return t=U[S++],Ht>=S?he.slice(S-At,(S+=t)-At):vm(t);case 218:return t=j.getUint16(S),S+=2,Ht>=S?he.slice(S-At,(S+=t)-At):xm(t);case 219:return t=j.getUint32(S),S+=4,Ht>=S?he.slice(S-At,(S+=t)-At):bm(t);case 220:return t=j.getUint16(S),S+=2,Oa(t);case 221:return t=j.getUint32(S),S+=4,Oa(t);case 222:return t=j.getUint16(S),S+=2,Ra(t);case 223:return t=j.getUint32(S),S+=4,Ra(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const wm=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Js(e,t){function n(){if(n.count++>qc){let i=e.read=new Function("r","return function(){return "+(tt.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":wm.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(st);return e.highByte===0&&(e.read=Na(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=st()}return tt.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?Na(t,n):n}const Na=(e,t)=>function(){let n=U[S++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=Y[r]||Gc()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=Js(i,e)),i.read()};function Gc(){let e=Kc(()=>(U=null,tt.getStructures()));return Y=tt._mergeStructures(e,Y)}var _s=Rn,vm=Rn,xm=Rn,bm=Rn;function Rn(e){let t;if(e<16&&(t=to(e)))return t;if(e>64&&ys)return ys.decode(U.subarray(S,S+=e));const n=S+e,r=[];for(t="";S<n;){const i=U[S++];if((i&128)===0)r.push(i);else if((i&224)===192){const s=U[S++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=U[S++]&63,o=U[S++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=U[S++]&63,o=U[S++]&63,a=U[S++]&63;let l=(i&7)<<18|s<<12|o<<6|a;l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|l&1023),r.push(l)}else r.push(i);r.length>=4096&&(t+=ut.apply(String,r),r.length=0)}return r.length>0&&(t+=ut.apply(String,r)),t}function Oa(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=st();return tt.freezeData?Object.freeze(t):t}function Ra(e){if(tt.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Vc();r==="__proto__"&&(r="__proto_"),t[r]=st()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(st(),st());return t}}var ut=String.fromCharCode;function jc(e){let t=S,n=new Array(e);for(let r=0;r<e;r++){const i=U[S++];if((i&128)>0){S=t;return}n[r]=i}return ut.apply(String,n)}function to(e){if(e<4)if(e<2){if(e===0)return"";{let t=U[S++];if((t&128)>1){S-=1;return}return ut(t)}}else{let t=U[S++],n=U[S++];if((t&128)>0||(n&128)>0){S-=2;return}if(e<3)return ut(t,n);let r=U[S++];if((r&128)>0){S-=3;return}return ut(t,n,r)}else{let t=U[S++],n=U[S++],r=U[S++],i=U[S++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){S-=4;return}if(e<6){if(e===4)return ut(t,n,r,i);{let s=U[S++];if((s&128)>0){S-=5;return}return ut(t,n,r,i,s)}}else if(e<8){let s=U[S++],o=U[S++];if((s&128)>0||(o&128)>0){S-=6;return}if(e<7)return ut(t,n,r,i,s,o);let a=U[S++];if((a&128)>0){S-=7;return}return ut(t,n,r,i,s,o,a)}else{let s=U[S++],o=U[S++],a=U[S++],l=U[S++];if((s&128)>0||(o&128)>0||(a&128)>0||(l&128)>0){S-=8;return}if(e<10){if(e===8)return ut(t,n,r,i,s,o,a,l);{let u=U[S++];if((u&128)>0){S-=9;return}return ut(t,n,r,i,s,o,a,l,u)}}else if(e<12){let u=U[S++],h=U[S++];if((u&128)>0||(h&128)>0){S-=10;return}if(e<11)return ut(t,n,r,i,s,o,a,l,u,h);let c=U[S++];if((c&128)>0){S-=11;return}return ut(t,n,r,i,s,o,a,l,u,h,c)}else{let u=U[S++],h=U[S++],c=U[S++],f=U[S++];if((u&128)>0||(h&128)>0||(c&128)>0||(f&128)>0){S-=12;return}if(e<14){if(e===12)return ut(t,n,r,i,s,o,a,l,u,h,c,f);{let d=U[S++];if((d&128)>0){S-=13;return}return ut(t,n,r,i,s,o,a,l,u,h,c,f,d)}}else{let d=U[S++],y=U[S++];if((d&128)>0||(y&128)>0){S-=14;return}if(e<15)return ut(t,n,r,i,s,o,a,l,u,h,c,f,d,y);let w=U[S++];if((w&128)>0){S-=15;return}return ut(t,n,r,i,s,o,a,l,u,h,c,f,d,y,w)}}}}}function La(){let e=U[S++],t;if(e<192)t=e-160;else switch(e){case 217:t=U[S++];break;case 218:t=j.getUint16(S),S+=2;break;case 219:t=j.getUint32(S),S+=4;break;default:throw new Error("Expected string")}return Rn(t)}function Ei(e){return tt.copyBuffers?Uint8Array.prototype.slice.call(U,S,S+=e):U.subarray(S,S+=e)}function pe(e){let t=U[S++];if(bt[t]){let n;return bt[t](U.subarray(S,n=S+=e),r=>{S=r;try{return st()}finally{S=n}})}else throw new Error("Unknown extension type "+t)}var Da=new Array(4096);function Vc(){let e=U[S++];if(e>=160&&e<192){if(e=e-160,Ht>=S)return he.slice(S-At,(S+=e)-At);if(!(Ht==0&&jt<180))return _s(e)}else return S--,Yc(st());let t=(e<<5^(e>1?j.getUint16(S):e>0?U[S]:0))&4095,n=Da[t],r=S,i=S+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=j.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=U[r++],s!=n[o++]){r=1879048192;break}if(r===i)return S=r,n.string;i-=3,r=S}for(n=[],Da[t]=n,n.bytes=e;r<i;)s=j.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=U[r++],n.push(s);let a=e<16?to(e):jc(e);return a!=null?n.string=a:n.string=_s(e)}function Yc(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";if(tt.allowArraysInMapKeys&&Array.isArray(e)&&e.flat().every(t=>["string","number","boolean","bigint"].includes(typeof t)))return e.flat().toString();throw new Error(`Invalid property type for record: ${typeof e}`)}const za=(e,t)=>{let n=st().map(Yc),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=Y[e];return i&&(i.isShared||fe)&&((Y.restoreStructures||(Y.restoreStructures=[]))[e]=i),Y[e]=n,n.read=Js(n,r),n.read()};bt[0]=()=>{};bt[0].noBuffer=!0;bt[66]=e=>{let t=e.byteLength%8||8,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);if(e.byteLength!==t){let r=new DataView(e.buffer,e.byteOffset,e.byteLength),i=(s,o)=>{let a=o-s;if(a<=40){let c=r.getBigUint64(s);for(let f=s+8;f<o;f+=8)c<<=64n,c|=r.getBigUint64(f);return c}let l=s+(a>>4<<3),u=i(s,l),h=i(l,o);return u<<BigInt((o-l)*8)|h};n=n<<BigInt((r.byteLength-t)*8)|i(t,r.byteLength)}return n};let Ua={Error,EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,AggregateError:typeof AggregateError=="function"?AggregateError:null};bt[101]=()=>{let e=st();if(!Ua[e[0]]){let t=Error(e[1],{cause:e[2]});return t.name=e[0],t}return Ua[e[0]](e[1],{cause:e[2]})};bt[105]=e=>{if(tt.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=j.getUint32(S-4);ee||(ee=new Map);let n=U[S],r;n>=144&&n<160||n==220||n==221?r=[]:n>=128&&n<144||n==222||n==223?r=new Map:(n>=199&&n<=201||n>=212&&n<=216)&&U[S+1]===115?r=new Set:r={};let i={target:r};ee.set(t,i);let s=st();if(i.used)Object.assign(r,s);else return i.target=s;if(r instanceof Map)for(let[o,a]of s.entries())r.set(o,a);if(r instanceof Set)for(let o of Array.from(s))r.add(o);return r};bt[112]=e=>{if(tt.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=j.getUint32(S-4),n=ee.get(t);return n.used=!0,n.target};bt[115]=()=>new Set(st());const Wc=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let Sm=typeof globalThis=="object"?globalThis:window;bt[116]=e=>{let t=e[0],n=Uint8Array.prototype.slice.call(e,1).buffer,r=Wc[t];if(!r){if(t===16)return n;if(t===17)return new DataView(n);throw new Error("Could not find typed array for code "+t)}return new Sm[r](n)};bt[120]=()=>{let e=st();return new RegExp(e[0],e[1])};const Mm=[];bt[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=S;return S+=t-e.length,ht=Mm,ht=[La(),La()],ht.position0=0,ht.position1=0,ht.postBundlePosition=S,S=n,st()};bt[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function Kc(e){let t=jt,n=S,r=At,i=Ht,s=he,o=ee,a=ht,l=new Uint8Array(U.slice(0,jt)),u=Y,h=Y.slice(0,Y.length),c=tt,f=fe,d=e();return jt=t,S=n,At=r,Ht=i,he=s,ee=o,ht=a,U=l,fe=f,Y=u,Y.splice(0,Y.length,...h),tt=c,j=new DataView(U.buffer,U.byteOffset,U.byteLength),d}function ws(){U=null,ee=null,Y=null}const eo=new Array(147);for(let e=0;e<256;e++)eo[e]=+("1e"+Math.floor(45.15-e*.30103));var li=new An({useRecords:!1});const Em=li.unpack;li.unpackMultiple;li.unpack;let $m=new Float32Array(1);new Uint8Array($m.buffer,0,4);let fr;try{fr=new TextEncoder}catch{}let vs,xs;const Qe=typeof Buffer<"u",Zn=Qe?function(e){return Buffer.allocUnsafeSlow(e)}:Uint8Array,Xc=Qe?Buffer:Uint8Array,Ba=Qe?4294967296:2144337920;let $,sn,J,M=0,dt,rt=null,Am;const Im=21760,Tm=/[\u0080-\uFFFF]/,Re=Symbol("record-id");class km extends An{constructor(t){super(t),this.offset=0;let n,r,i,s,o=Xc.prototype.utf8Write?function(_,p){return $.utf8Write(_,p,$.byteLength-p)}:fr&&fr.encodeInto?function(_,p){return fr.encodeInto(_,$.subarray(p)).written}:!1,a=this;t||(t={});let l=t&&t.sequential,u=t.structures||t.saveStructures,h=t.maxSharedStructures;if(h==null&&(h=u?32:0),h>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let c=t.maxOwnStructures;c==null&&(c=u?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let f=h>32||c+h>64,d=h+64,y=h+c+64;if(y>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let w=[],E=0,v=0;this.pack=this.encode=function(_,p){if($||($=new Zn(8192),J=$.dataView||($.dataView=new DataView($.buffer,0,8192)),M=0),dt=$.length-10,dt-M<2048?($=new Zn($.length),J=$.dataView||($.dataView=new DataView($.buffer,0,$.length)),dt=$.length-10,M=0):M=M+7&2147483640,n=M,p&Rm&&(M+=p&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof _!="string"?(rt=[],rt.size=1/0):rt=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let g=i.sharedLength||0;if(g>h)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let x=0;x<g;x++){let P=i[x];if(!P)continue;let k,O=i.transitions;for(let B=0,H=P.length;B<H;B++){let X=P[B];k=O[X],k||(k=O[X]=Object.create(null)),O=k}O[Re]=x+64}this.lastNamedStructuresLength=g}l||(i.nextId=g+64)}r&&(r=!1);let m;try{a.randomAccessStructure&&_&&typeof _=="object"?_.constructor===Object?F(_):_.constructor!==Map&&!Array.isArray(_)&&!xs.some(x=>_ instanceof x)?F(_.toJSON?_.toJSON():_):b(_):b(_);let g=rt;if(rt&&Ha(n,b,0),s&&s.idsToInsert){let x=s.idsToInsert.sort((B,H)=>B.offset>H.offset?1:-1),P=x.length,k=-1;for(;g&&P>0;){let B=x[--P].offset+n;B<g.stringsPosition+n&&k===-1&&(k=0),B>g.position+n?k>=0&&(k+=6):(k>=0&&(J.setUint32(g.position+n,J.getUint32(g.position+n)+k),k=-1),g=g.previous,P++)}k>=0&&g&&J.setUint32(g.position+n,J.getUint32(g.position+n)+k),M+=x.length*6,M>dt&&N(M),a.offset=M;let O=Pm($.subarray(n,M),x);return s=null,O}return a.offset=M,p&Nm?($.start=n,$.end=M,$):$.subarray(n,M)}catch(g){throw m=g,g}finally{if(i&&(T(),r&&a.saveStructures)){let g=i.sharedLength||0,x=$.subarray(n,M),P=Cm(i,a);if(!m)return a.saveStructures(P,P.isCompatible)===!1?a.pack(_,p):(a.lastNamedStructuresLength=g,$.length>1073741824&&($=null),x)}$.length>1073741824&&($=null),p&Om&&(M=n)}};const T=()=>{v<10&&v++;let _=i.sharedLength||0;if(i.length>_&&!l&&(i.length=_),E>1e4)i.transitions=null,v=0,E=0,w.length>0&&(w=[]);else if(w.length>0&&!l){for(let p=0,m=w.length;p<m;p++)w[p][Re]=0;w=[]}},A=_=>{var p=_.length;p<16?$[M++]=144|p:p<65536?($[M++]=220,$[M++]=p>>8,$[M++]=p&255):($[M++]=221,J.setUint32(M,p),M+=4);for(let m=0;m<p;m++)b(_[m])},b=_=>{M>dt&&($=N(M));var p=typeof _,m;if(p==="string"){let g=_.length;if(rt&&g>=4&&g<4096){if((rt.size+=g)>Im){let O,B=(rt[0]?rt[0].length*3+rt[1].length:0)+10;M+B>dt&&($=N(M+B));let H;rt.position?(H=rt,$[M]=200,M+=3,$[M++]=98,O=M-n,M+=4,Ha(n,b,0),J.setUint16(O+n-3,M-n-O)):($[M++]=214,$[M++]=98,O=M-n,M+=4),rt=["",""],rt.previous=H,rt.size=0,rt.position=O}let k=Tm.test(_);rt[k?0:1]+=_,$[M++]=193,b(k?-g:g);return}let x;g<32?x=1:g<256?x=2:g<65536?x=3:x=5;let P=g*3;if(M+P>dt&&($=N(M+P)),g<64||!o){let k,O,B,H=M+x;for(k=0;k<g;k++)O=_.charCodeAt(k),O<128?$[H++]=O:O<2048?($[H++]=O>>6|192,$[H++]=O&63|128):(O&64512)===55296&&((B=_.charCodeAt(k+1))&64512)===56320?(O=65536+((O&1023)<<10)+(B&1023),k++,$[H++]=O>>18|240,$[H++]=O>>12&63|128,$[H++]=O>>6&63|128,$[H++]=O&63|128):($[H++]=O>>12|224,$[H++]=O>>6&63|128,$[H++]=O&63|128);m=H-M-x}else m=o(_,M+x);m<32?$[M++]=160|m:m<256?(x<2&&$.copyWithin(M+2,M+1,M+1+m),$[M++]=217,$[M++]=m):m<65536?(x<3&&$.copyWithin(M+3,M+2,M+2+m),$[M++]=218,$[M++]=m>>8,$[M++]=m&255):(x<5&&$.copyWithin(M+5,M+3,M+3+m),$[M++]=219,J.setUint32(M,m),M+=4),M+=m}else if(p==="number")if(_>>>0===_)_<32||_<128&&this.useRecords===!1||_<64&&!this.randomAccessStructure?$[M++]=_:_<256?($[M++]=204,$[M++]=_):_<65536?($[M++]=205,$[M++]=_>>8,$[M++]=_&255):($[M++]=206,J.setUint32(M,_),M+=4);else if(_>>0===_)_>=-32?$[M++]=256+_:_>=-128?($[M++]=208,$[M++]=_+256):_>=-32768?($[M++]=209,J.setInt16(M,_),M+=2):($[M++]=210,J.setInt32(M,_),M+=4);else{let g;if((g=this.useFloat32)>0&&_<4294967296&&_>=-2147483648){$[M++]=202,J.setFloat32(M,_);let x;if(g<4||(x=_*eo[($[M]&127)<<1|$[M+1]>>7])>>0===x){M+=4;return}else M--}$[M++]=203,J.setFloat64(M,_),M+=8}else if(p==="object"||p==="function")if(!_)$[M++]=192;else{if(s){let x=s.get(_);if(x){if(!x.id){let P=s.idsToInsert||(s.idsToInsert=[]);x.id=P.push(x)}$[M++]=214,$[M++]=112,J.setUint32(M,x.id),M+=4;return}else s.set(_,{offset:M-n})}let g=_.constructor;if(g===Object)L(_);else if(g===Array)A(_);else if(g===Map)if(this.mapAsEmptyObject)$[M++]=128;else{m=_.size,m<16?$[M++]=128|m:m<65536?($[M++]=222,$[M++]=m>>8,$[M++]=m&255):($[M++]=223,J.setUint32(M,m),M+=4);for(let[x,P]of _)b(x),b(P)}else{for(let x=0,P=vs.length;x<P;x++){let k=xs[x];if(_ instanceof k){let O=vs[x];if(O.write){O.type&&($[M++]=212,$[M++]=O.type,$[M++]=0);let nt=O.write.call(this,_);nt===_?Array.isArray(_)?A(_):L(_):b(nt);return}let B=$,H=J,X=M;$=null;let Q;try{Q=O.pack.call(this,_,nt=>($=B,B=null,M+=nt,M>dt&&N(M),{target:$,targetView:J,position:M-nt}),b)}finally{B&&($=B,J=H,M=X,dt=$.length-10)}Q&&(Q.length+M>dt&&N(Q.length+M),M=Fa(Q,$,M,O.type));return}}if(Array.isArray(_))A(_);else{if(_.toJSON){const x=_.toJSON();if(x!==_)return b(x)}if(p==="function")return b(this.writeFunction&&this.writeFunction(_));L(_)}}}else if(p==="boolean")$[M++]=_?195:194;else if(p==="bigint"){if(_<9223372036854776e3&&_>=-9223372036854776e3)$[M++]=211,J.setBigInt64(M,_);else if(_<18446744073709552e3&&_>0)$[M++]=207,J.setBigUint64(M,_);else if(this.largeBigIntToFloat)$[M++]=203,J.setFloat64(M,Number(_));else{if(this.largeBigIntToString)return b(_.toString());if(this.useBigIntExtension||this.moreTypes){let g=_<0?BigInt(-1):BigInt(0),x;if(_>>BigInt(65536)===g){let P=BigInt(18446744073709552e3)-BigInt(1),k=[];for(;k.push(_&P),_>>BigInt(63)!==g;)_>>=BigInt(64);x=new Uint8Array(new BigUint64Array(k).buffer),x.reverse()}else{let P=_<0,k=(P?~_:_).toString(16);if(k.length%2?k="0"+k:parseInt(k.charAt(0),16)>=8&&(k="00"+k),Qe)x=Buffer.from(k,"hex");else{x=new Uint8Array(k.length/2);for(let O=0;O<x.length;O++)x[O]=parseInt(k.slice(O*2,O*2+2),16)}if(P)for(let O=0;O<x.length;O++)x[O]=~x[O]}x.length+M>dt&&N(x.length+M),M=Fa(x,$,M,66);return}else throw new RangeError(_+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}M+=8}else if(p==="undefined")this.encodeUndefinedAsNil?$[M++]=192:($[M++]=212,$[M++]=0,$[M++]=0);else throw new Error("Unknown type: "+p)},C=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?_=>{let p;if(this.skipValues){p=[];for(let x in _)(typeof _.hasOwnProperty!="function"||_.hasOwnProperty(x))&&!this.skipValues.includes(_[x])&&p.push(x)}else p=Object.keys(_);let m=p.length;m<16?$[M++]=128|m:m<65536?($[M++]=222,$[M++]=m>>8,$[M++]=m&255):($[M++]=223,J.setUint32(M,m),M+=4);let g;if(this.coercibleKeyAsNumber)for(let x=0;x<m;x++){g=p[x];let P=Number(g);b(isNaN(P)?g:P),b(_[g])}else for(let x=0;x<m;x++)b(g=p[x]),b(_[g])}:_=>{$[M++]=222;let p=M-n;M+=2;let m=0;for(let g in _)(typeof _.hasOwnProperty!="function"||_.hasOwnProperty(g))&&(b(g),b(_[g]),m++);if(m>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');$[p+++n]=m>>8,$[p+n]=m&255},R=this.useRecords===!1?C:t.progressiveRecords&&!f?_=>{let p,m=i.transitions||(i.transitions=Object.create(null)),g=M++-n,x;for(let P in _)if(typeof _.hasOwnProperty!="function"||_.hasOwnProperty(P)){if(p=m[P],p)m=p;else{let k=Object.keys(_),O=m;m=i.transitions;let B=0;for(let H=0,X=k.length;H<X;H++){let Q=k[H];p=m[Q],p||(p=m[Q]=Object.create(null),B++),m=p}g+n+1==M?(M--,z(m,k,B)):I(m,k,g,B),x=!0,m=O[P]}b(_[P])}if(!x){let P=m[Re];P?$[g+n]=P:I(m,Object.keys(_),g,0)}}:_=>{let p,m=i.transitions||(i.transitions=Object.create(null)),g=0;for(let P in _)(typeof _.hasOwnProperty!="function"||_.hasOwnProperty(P))&&(p=m[P],p||(p=m[P]=Object.create(null),g++),m=p);let x=m[Re];x?x>=96&&f?($[M++]=((x-=96)&31)+96,$[M++]=x>>5):$[M++]=x:z(m,m.__keys__||Object.keys(_),g);for(let P in _)(typeof _.hasOwnProperty!="function"||_.hasOwnProperty(P))&&b(_[P])},D=typeof this.useRecords=="function"&&this.useRecords,L=D?_=>{D(_)?R(_):C(_)}:R,N=_=>{let p;if(_>16777216){if(_-n>Ba)throw new Error("Packed buffer would be larger than maximum buffer size");p=Math.min(Ba,Math.round(Math.max((_-n)*(_>67108864?1.25:2),4194304)/4096)*4096)}else p=(Math.max(_-n<<2,$.length-1)>>12)+1<<12;let m=new Zn(p);return J=m.dataView||(m.dataView=new DataView(m.buffer,0,p)),_=Math.min(_,$.length),$.copy?$.copy(m,0,n,_):m.set($.slice(n,_)),M-=n,n=0,dt=m.length-10,$=m},z=(_,p,m)=>{let g=i.nextId;g||(g=64),g<d&&this.shouldShareStructure&&!this.shouldShareStructure(p)?(g=i.nextOwnId,g<y||(g=d),i.nextOwnId=g+1):(g>=y&&(g=d),i.nextId=g+1);let x=p.highByte=g>=96&&f?g-96>>5:-1;_[Re]=g,_.__keys__=p,i[g-64]=p,g<d?(p.isShared=!0,i.sharedLength=g-63,r=!0,x>=0?($[M++]=(g&31)+96,$[M++]=x):$[M++]=g):(x>=0?($[M++]=213,$[M++]=114,$[M++]=(g&31)+96,$[M++]=x):($[M++]=212,$[M++]=114,$[M++]=g),m&&(E+=v*m),w.length>=c&&(w.shift()[Re]=0),w.push(_),b(p))},I=(_,p,m,g)=>{let x=$,P=M,k=dt,O=n;$=sn,M=0,n=0,$||(sn=$=new Zn(8192)),dt=$.length-10,z(_,p,g),sn=$;let B=M;if($=x,M=P,dt=k,n=O,B>1){let H=M+B-1;H>dt&&N(H);let X=m+n;$.copyWithin(X+B,X+1,M),$.set(sn.slice(0,B),X),M=H}else $[m+n]=sn[0]},F=_=>{let p=Am(_,$,n,M,i,N,(m,g,x)=>{if(x)return r=!0;M=g;let P=$;return b(m),T(),P!==$?{position:M,targetView:J,target:$}:M},this);if(p===0)return L(_);M=p}}useBuffer(t){$=t,$.dataView||($.dataView=new DataView($.buffer,$.byteOffset,$.byteLength)),J=$.dataView,M=0}set position(t){M=t}get position(){return M}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}xs=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,DataView,Fc];vs=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?$i(e,16,t):Ai(Qe?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==Xc&&this.moreTypes?$i(e,Wc.indexOf(n.name),t):Ai(e,t)}},{pack(e,t){this.moreTypes?$i(e,17,t):Ai(Qe?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function $i(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function Ai(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function Fa(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function Pm(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function Ha(e,t,n){if(rt.length>0){J.setUint32(rt.position+e,M+n-rt.position-e),rt.stringsPosition=M-e;let r=rt;rt=null,t(r[0]),t(r[1])}}function Cm(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let Qc=new km({useRecords:!1});Qc.pack;Qc.pack;const Nm=512,Om=1024,Rm=2048;(!globalThis.EventTarget||!globalThis.Event)&&console.error(`
  PartySocket requires a global 'EventTarget' class to be available!
  You can polyfill this global by adding this to your code before any partysocket imports: 
  
  \`\`\`
  import 'partysocket/event-target-polyfill';
  \`\`\`
  Please file an issue at https://github.com/partykit/partykit if you're still having trouble.
`);var Zc=class extends Event{message;error;constructor(e,t){super("error",t),this.message=e.message,this.error=e}},Jc=class extends Event{code;reason;wasClean=!0;constructor(e=1e3,t="",n){super("close",n),this.code=e,this.reason=t}};const Ii={Event,ErrorEvent:Zc,CloseEvent:Jc};function Lm(e,t){if(!e)throw new Error(t)}function Dm(e){return new e.constructor(e.type,e)}function zm(e){return"data"in e?new MessageEvent(e.type,e):"code"in e||"reason"in e?new Jc(e.code||1999,e.reason||"unknown reason",e):"error"in e?new Zc(e.error,e):new Event(e.type,e)}const Jn=typeof process<"u"&&typeof process.versions?.node<"u"&&typeof document>"u"?zm:Dm,ge={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:Number.POSITIVE_INFINITY,maxEnqueuedMessages:Number.POSITIVE_INFINITY};let qa=!1;var Um=class me extends EventTarget{_ws;_retryCount=-1;_uptimeTimeout;_connectTimeout;_shouldReconnect=!0;_connectLock=!1;_binaryType="blob";_closeCalled=!1;_messageQueue=[];_debugLogger=console.log.bind(console);_url;_protocols;_options;constructor(t,n,r={}){super(),this._url=t,this._protocols=n,this._options=r,this._options.startClosed&&(this._shouldReconnect=!1),this._options.debugLogger&&(this._debugLogger=this._options.debugLogger),this._connect()}static get CONNECTING(){return 0}static get OPEN(){return 1}static get CLOSING(){return 2}static get CLOSED(){return 3}get CONNECTING(){return me.CONNECTING}get OPEN(){return me.OPEN}get CLOSING(){return me.CLOSING}get CLOSED(){return me.CLOSED}get binaryType(){return this._ws?this._ws.binaryType:this._binaryType}set binaryType(t){this._binaryType=t,this._ws&&(this._ws.binaryType=t)}get retryCount(){return Math.max(this._retryCount,0)}get bufferedAmount(){return this._messageQueue.reduce((t,n)=>(typeof n=="string"?t+=n.length:n instanceof Blob?t+=n.size:t+=n.byteLength,t),0)+(this._ws?this._ws.bufferedAmount:0)}get extensions(){return this._ws?this._ws.extensions:""}get protocol(){return this._ws?this._ws.protocol:""}get readyState(){return this._ws?this._ws.readyState:this._options.startClosed?me.CLOSED:me.CONNECTING}get url(){return this._ws?this._ws.url:""}get shouldReconnect(){return this._shouldReconnect}onclose=null;onerror=null;onmessage=null;onopen=null;close(t=1e3,n){if(this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(t,n)}reconnect(t,n){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(t,n),this._connect())}send(t){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",t),this._ws.send(t);else{const{maxEnqueuedMessages:n=ge.maxEnqueuedMessages}=this._options;this._messageQueue.length<n&&(this._debug("enqueue",t),this._messageQueue.push(t))}}_debug(...t){this._options.debug&&this._debugLogger("RWS>",...t)}_getNextDelay(){const{reconnectionDelayGrowFactor:t=ge.reconnectionDelayGrowFactor,minReconnectionDelay:n=ge.minReconnectionDelay,maxReconnectionDelay:r=ge.maxReconnectionDelay}=this._options;let i=0;return this._retryCount>0&&(i=n*t**(this._retryCount-1),i>r&&(i=r)),this._debug("next delay",i),i}_wait(){return new Promise(t=>{setTimeout(t,this._getNextDelay())})}_getNextProtocols(t){if(!t)return Promise.resolve(null);if(typeof t=="string"||Array.isArray(t))return Promise.resolve(t);if(typeof t=="function"){const n=t();if(!n)return Promise.resolve(null);if(typeof n=="string"||Array.isArray(n))return Promise.resolve(n);if(n.then)return n}throw Error("Invalid protocols")}_getNextUrl(t){if(typeof t=="string")return Promise.resolve(t);if(typeof t=="function"){const n=t();if(typeof n=="string")return Promise.resolve(n);if(n.then)return n}throw Error("Invalid URL")}_connect(){if(this._connectLock||!this._shouldReconnect)return;this._connectLock=!0;const{maxRetries:t=ge.maxRetries,connectionTimeout:n=ge.connectionTimeout}=this._options;if(this._retryCount>=t){this._debug("max retries reached",this._retryCount,">=",t);return}this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),this._wait().then(()=>Promise.all([this._getNextUrl(this._url),this._getNextProtocols(this._protocols||null)])).then(([r,i])=>{if(this._closeCalled){this._connectLock=!1;return}!this._options.WebSocket&&typeof WebSocket>"u"&&!qa&&(console.error(` No WebSocket implementation available. You should define options.WebSocket. 

For example, if you're using node.js, run \`npm install ws\`, and then in your code:

import PartySocket from 'partysocket';
import WS from 'ws';

const partysocket = new PartySocket({
  host: "127.0.0.1:1999",
  room: "test-room",
  WebSocket: WS
});

`),qa=!0);const s=this._options.WebSocket||WebSocket;this._debug("connect",{url:r,protocols:i}),this._ws=i?new s(r,i):new s(r),this._ws.binaryType=this._binaryType,this._connectLock=!1,this._addListeners(),this._connectTimeout=setTimeout(()=>this._handleTimeout(),n)}).catch(r=>{this._connectLock=!1,this._handleError(new Ii.ErrorEvent(Error(r.message),this))})}_handleTimeout(){this._debug("timeout event"),this._handleError(new Ii.ErrorEvent(Error("TIMEOUT"),this))}_disconnect(t=1e3,n){if(this._clearTimeouts(),!!this._ws){this._removeListeners();try{(this._ws.readyState===this.OPEN||this._ws.readyState===this.CONNECTING)&&this._ws.close(t,n),this._handleClose(new Ii.CloseEvent(t,n,this))}catch{}}}_acceptOpen(){this._debug("accept open"),this._retryCount=0}_handleOpen=t=>{this._debug("open event");const{minUptime:n=ge.minUptime}=this._options;clearTimeout(this._connectTimeout),this._uptimeTimeout=setTimeout(()=>this._acceptOpen(),n),Lm(this._ws,"WebSocket is not defined"),this._ws.binaryType=this._binaryType,this._messageQueue.forEach(r=>{this._ws?.send(r)}),this._messageQueue=[],this.onopen&&this.onopen(t),this.dispatchEvent(Jn(t))};_handleMessage=t=>{this._debug("message event"),this.onmessage&&this.onmessage(t),this.dispatchEvent(Jn(t))};_handleError=t=>{this._debug("error event",t.message),this._disconnect(void 0,t.message==="TIMEOUT"?"timeout":void 0),this.onerror&&this.onerror(t),this._debug("exec error listeners"),this.dispatchEvent(Jn(t)),this._connect()};_handleClose=t=>{this._debug("close event"),this._clearTimeouts(),this._shouldReconnect&&this._connect(),this.onclose&&this.onclose(t),this.dispatchEvent(Jn(t))};_removeListeners(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))}_addListeners(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))}_clearTimeouts(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)}};const Bm=e=>e[1]!==null&&e[1]!==void 0;function Fm(){if(crypto?.randomUUID)return crypto.randomUUID();let e=Date.now(),t=performance?.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){let r=Math.random()*16;return e>0?(r=(e+r)%16|0,e=Math.floor(e/16)):(r=(t+r)%16|0,t=Math.floor(t/16)),(n==="x"?r:r&3|8).toString(16)})}function tu(e,t,n={}){const{host:r,path:i,protocol:s,room:o,party:a,basePath:l,prefix:u,query:h}=e;let c=r.replace(/^(http|https|ws|wss):\/\//,"");if(c.endsWith("/")&&(c=c.slice(0,-1)),i?.startsWith("/"))throw new Error("path must not start with a slash");const f=a??"main",d=i?`/${i}`:"",y=s||(c.startsWith("localhost:")||c.startsWith("127.0.0.1:")||c.startsWith("192.168.")||c.startsWith("10.")||c.startsWith("172.")&&c.split(".")[1]>="16"&&c.split(".")[1]<="31"||c.startsWith("[::ffff:7f00:1]:")?t:`${t}s`),w=`${y}://${c}/${l||`${u||"parties"}/${f}/${o}`}${d}`,E=(T={})=>`${w}?${new URLSearchParams([...Object.entries(n),...Object.entries(T).filter(Bm)])}`,v=typeof h=="function"?async()=>E(await h()):E(h);return{host:c,path:d,room:o,name:f,protocol:y,partyUrl:w,urlProvider:v}}var tr=class extends Um{_pk;_pkurl;name;room;host;path;constructor(e){const t=Ga(e);super(t.urlProvider,t.protocols,t.socketOptions),this.partySocketOptions=e,this.setWSProperties(t),e.disableNameValidation||(e.party?.includes("/")&&console.warn(`PartySocket: party name "${e.party}" contains forward slash which may cause routing issues. Consider using a name without forward slashes or set disableNameValidation: true to bypass this warning.`),e.room?.includes("/")&&console.warn(`PartySocket: room name "${e.room}" contains forward slash which may cause routing issues. Consider using a name without forward slashes or set disableNameValidation: true to bypass this warning.`))}updateProperties(e){const t=Ga({...this.partySocketOptions,...e,host:e.host??this.host,room:e.room??this.room,path:e.path??this.path});this._url=t.urlProvider,this._protocols=t.protocols,this._options=t.socketOptions,this.setWSProperties(t)}setWSProperties(e){const{_pk:t,_pkurl:n,name:r,room:i,host:s,path:o}=e;this._pk=t,this._pkurl=n,this.name=r,this.room=i,this.host=s,this.path=o}reconnect(e,t){if(!this.room||!this.host)throw new Error("The room and host must be set before connecting, use `updateProperties` method to set them or pass them to the constructor.");super.reconnect(e,t)}get id(){return this._pk}get roomUrl(){return this._pkurl}static async fetch(e,t){const n=tu(e,"http"),r=typeof n.urlProvider=="string"?n.urlProvider:await n.urlProvider();return(e.fetch??fetch)(r,t)}};function Ga(e){const{id:t,host:n,path:r,party:i,room:s,protocol:o,query:a,protocols:l,...u}=e,h=t||Fm(),c=tu(e,"ws",{_pk:h});return{_pk:h,_pkurl:c.partyUrl,name:c.name,room:c.room,host:c.host,path:c.path,protocols:l,socketOptions:u,urlProvider:c.urlProvider}}const Ti=()=>$c(5);class Hm extends Dc{mount(t){this.appRoot=t,this.appRoot.gameManager=this,this.#t()}async connect(){this.gameStop(),this.status="WAITING";const t=await this.initializePlayer();this.thisPlayer=this.addPlayer(t),this.playerId=this.thisPlayer.id,this.events.emit("GAME_INIT",void 0),this.appRoot.showStartDialog()}async start(){localStorage.setItem("starz_playerId",this.playerId),localStorage.setItem("starz_playerName",this.thisPlayer.name),localStorage.setItem("starz_score",this.thisPlayer.score?.toString()??"0"),this.gameSetup(this.thisPlayer),this.gameStart(),Z()}addBot(){const t=this.state.playerMap.size;if(t>=Vu)return;const n=Ti(),r=`Bot ${t}`,i=new ug({id:n,name:r});return this.onPlayerJoin(t,{id:n,name:r,bot:i})}gameSetup(t){const n=this.getFnContext(),r=Array.from(n.S.playerMap.values());this.state=this.game.setup(n),Ig(),t.name=this.config.playerName,console.log("Starting game with players:",r),this.state.playerMap.clear();for(let s=0;s<r.length;s++){const o=r[s];this.onPlayerJoin(s,o),this.game.assignSystem(this.state,o.id),console.log(`Player ${o.name} assigned to homeworld.`,o)}const i=this.state.playerMap.get(t.id);this.setupThisPlayer(i.id),localStorage.setItem("starz_playerId",i.id),localStorage.setItem("starz_playerName",i.name),localStorage.setItem("starz_score",i.score.score.toString())}async initializePlayer(){const t=this.playerId=localStorage.getItem("starz_playerId")??Ti(),n=localStorage.getItem("starz_playerName")??this.config.playerName,r=+(localStorage.getItem("starz_score")??0);return localStorage.setItem("starz_playerId",t),localStorage.setItem("starz_playerName",n),localStorage.setItem("starz_score",r.toString()),{id:t,name:n,score:{score:r}}}gameStart(){fi("starz_gamesStarted"),super.gameStart(),Xn("Game started.");const t=this.state.playerMap.get(this.playerId);t&&Xn(`You are ${t.name}.`)}gameStop(){super.gameStop(),xe(),Z()}onPlayerJoin(t,n={}){const r=Qu[t],i=n.name??"Anonymous Player",s=Ti();return this.addPlayer({id:s,name:i,color:r,...n})}pauseToggle(){this.status==="PAUSED"?(this.status="PLAYING",super.startGameLoop()):this.status==="PLAYING"&&(this.status="PAUSED",super.stopGameLoop())}showEndGame(t){return this.appRoot.showEndGame(t)}async quit(){await this.showEndGame("Are you sure you want to quit?")&&this.game.eliminatePlayer(this.getFnContext(),this.playerId)}async onPlayerWin(t,n){n&&Xn(n),this.game.revealAllSystems(this.state),xe();let r=!1;t===this.playerId?(fi("starz_gamesWon"),r=await this.showEndGame("You have conquered The Bubble!")):(fi("starz_gamesLost",{winnerId:t}),r=await this.showEndGame("You have lost your homeworld! Click to return to lobby.  ESC to spectate.")),r&&this.restart()}restart(){this.stopGameLoop(),xe(),this.tick=0,this.state=this.game.initalState(),this.connect()}onEliminatePlayer(t,n){const r=this.state.playerMap.get(t),i=this.state.playerMap.get(n),s=n===null?`${r.name} has been eliminated!`:`${i.name} has eliminated ${r.name}!`;Xn(s),t===this.playerId?(this.submitWinLoss(-1),this.onPlayerWin(n)):n===this.playerId&&this.submitWinLoss(1)}async submitWinLoss(t){const n=+(localStorage.getItem("starz_score")??0)+t;localStorage.setItem("starz_score",n.toString())}addPlayer(t){const n=super.addPlayer({color:t.color??qm(),...t});return document.documentElement.style.setProperty(`--player-${n.id}`,n.color),this.events.emit("PLAYER_ADDED",{player:n}),n}setupThisPlayer(t){this.playerId=t;const n=this.state.playerMap.get(t),r=this.game.getPlayersHomeworld(this.state);this.game.visitSystem(this.state,r),gs(),n.bot||(xe(),$n(r.id))}#t(){this.events.on("PLAYER_WIN",({playerId:t,message:n})=>{this.onPlayerWin(t,n)}),this.events.on("PLAYER_ELIMINATED",({loserId:t,winnerId:n})=>{this.onEliminatePlayer(t,n)})}}function qm(){const e="0123456789ABCDEF";let t="#";for(let n=0;n<6;n++)t+=e[Math.floor(Math.random()*16)];return t}const eu="ABCDEFGHJKLMNPQRSTUVWXYZ234567",Gm=Ec(eu,15),jm=Ec(eu,15),er={host:"https://starz.hypercubed.dev/",party:"lobby-server",room:"starz-game-room-leaderboard-prod"};class no extends Hm{constructor(){super(...arguments),this.user=null}playkitConnect(){this.lobbySocket=new tr(er),this.#t()}async start(){const t=this.state.playerMap.get(this.playerId);t.name=this.user?.name??t.name,t.score={score:this.user?.score??0,rank:this.user?.rank??void 0},t.id=this.user?.uid??t.id,localStorage.setItem("starz_playerToken",this.playerToken),localStorage.setItem("starz_rank",this.user?.rank?.toString()??""),super.start()}async setConfig(t){const n=t.playerName;if(n)if(n.includes("::")){const[r,i]=n.split("::");await this.loadPlayer(i,r),delete t.playerName,t.playerName=this.user?.name??this.config.playerName}else this.user??={},this.user.name=n,this.thisPlayer.name=n,localStorage.setItem("starz_playerName",n);await super.setConfig(t)}getHeaders(){return{"Content-Type":"application/json",Authorization:`Bearer ${this.playerToken}`}}async loadPlayer(t,n){this.playerToken=t,this.user??={uid:n},this.user.score??=0;const r=await this.getScore(n);r&&(this.user.uid=n,this.user.score=r.score,this.user.rank=r.rank,this.user.name=r.name,localStorage.setItem("starz_playerToken",this.playerToken),localStorage.setItem("starz_playerId",n),localStorage.setItem("starz_playerName",this.user.name??this.config.playerName),localStorage.setItem("starz_score",this.user.score?.toString()??"0"),localStorage.setItem("starz_rank",this.user.rank?.toString()??""));const i=this.state.playerMap.get(this.playerId);i&&(i.id=n,i.name=this.user.name??i.name,i.score={score:this.user.score??0,rank:this.user.rank??void 0},this.state.playerMap.delete(this.playerId),this.state.playerMap.set(n,i)),this.playerId=n}async initializePlayer(){console.log("Initializing player..."),this.playkitConnect(),this.playerToken=localStorage.getItem("starz_playerToken"),this.playerId=localStorage.getItem("starz_playerId");let t=localStorage.getItem("starz_playerName")??this.config.playerName,n=+(localStorage.getItem("starz_score")??"0"),r=localStorage.getItem("starz_rank")?+localStorage.getItem("starz_rank"):void 0;return this.playerToken&&this.playerId&&(await this.loadPlayer(this.playerToken,this.playerId),this.playerId=this.user?.uid??this.playerId,t=this.user?.name??t,n=this.user?.score??n,r=this.user?.rank??r),this.playerToken??=jm(),this.playerId??=Gm(),localStorage.setItem("starz_playerToken",this.playerToken),localStorage.setItem("starz_playerId",this.playerId),localStorage.setItem("starz_playerName",t),localStorage.setItem("starz_score",n.toString()),localStorage.setItem("starz_rank",r?.toString()??""),{id:this.playerId,name:t,score:{score:n,rank:r}}}async getScore(t){return this.lobbySocket?await(await tr.fetch({...er,path:"score",query:{playerId:t}},{method:"GET",headers:this.getHeaders()})).json():void 0}async submitWinLoss(t){if(super.submitWinLoss(t),!this.lobbySocket||t===0)return;console.assert(t===1||t===-1,"deltaScore must be 1 or -1");const n=this.state.playerMap.get(this.playerId);if(!n)return;const r={type:t>0?"increment":"decrement",uid:this.playerId,name:n.name};tr.fetch({...er,path:"score"},{method:"POST",body:JSON.stringify(r),headers:this.getHeaders()})}async loadLeaderboard(){return this.lobbySocket?await(await tr.fetch({...er},{method:"GET",headers:{"Content-Type":"application/json"}})).json():[]}#t(){if(!this.lobbySocket)return null;this.lobbySocket.addEventListener("message",async t=>{const n=t.data instanceof Blob?Em(await t.data.arrayBuffer()):JSON.parse(t.data);switch(n.type){default:"message"in n?console.log(n.message):"error"in n&&console.error("PartyKit error:",n.error);break}})}}var Vm=Object.defineProperty,Ym=Object.getOwnPropertyDescriptor,ro=(e,t,n,r)=>{for(var i=r>1?void 0:r?Ym(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&Vm(t,n,i),i};const Wm=ei(".3~s");let Yr=class extends Lt{constructor(){super(...arguments),this.leaderboard=[]}createRenderRoot(){return this}async connectedCallback(){super.connectedCallback(),this.gameManager instanceof no&&(this.leaderboard=await this.gameManager.loadLeaderboard(),this.gameManager.events.on("GAME_INIT",async()=>{this.leaderboard=await this.gameManager.loadLeaderboard(),this.requestUpdate()}))}render(){return at`
      <table id="leaderbox">
        ${this.renderHeader()} ${this.renderBody()}
      </table>
    `}renderBody(){return at`<tbody>
      ${this.leaderboard.map(t=>{const n=t.uid?.slice(0,4)??"";return at`<tr>
          <td>${""}${t.rank}${""}</td>
          <td>${""}${t.name}<span class="short-id">#${n}</span>${""}</td>
          <td>${""}${Wm(t.score)}${""}</td>
        </tr>`})}
    </tbody>`}renderHeader(){return at`<thead>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th></th>
        </tr>
      </thead>
      <tbody></tbody>`}};ro([Tn({context:Ze}),gt()],Yr.prototype,"gameManager",2);ro([gt()],Yr.prototype,"leaderboard",2);Yr=ro([ke("lobby-leaderboard-element")],Yr);var Km=Object.defineProperty,Xm=Object.getOwnPropertyDescriptor,nu=(e,t,n,r)=>{for(var i=r>1?void 0:r?Xm(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&Km(t,n,i),i};let bs=class extends Lt{constructor(){super(...arguments),this.tick=0}createRenderRoot(){return this}render(){const e=~~(this.tick/2),t=this.tick%2===1?".":"";return at`${e}${t}`}};nu([ks({type:Number})],bs.prototype,"tick",2);bs=nu([ke("tick-box")],bs);const Qm=`<div class="lore">
  <p>
    Nobody knows why <i>The Bubble</i> exists, or who built the lattice
    of hyperspace lanes threading its hundreds of star systems together
    like a cosmic web. Its discovery was accidental - a distortion
    ripple detected on the edge of settled space, leading explorers to
    the shimmering boundary of a region where physics seemed... wrong.
  </p>
  <p>
    What <i>is</i> known is this: control of <i>The Bubble</i> means
    control of immense resources and power. Rival factions flood its
    systems, each desperate to carve out their claim before somebody
    else does.
  </p>
  <p>
    As a commander, you are the spearhead of your faction's ambitions:
    tasked with expanding your influence, capturing systems, and
    ultimately dominating <i>The Bubble</i>.
  </p>
</div>

<h3>Protect our homeworld. Capture the enemy systems.</h3>`,Zm=`<!-- @license lucide-static v0.562.0 - ISC -->
<svg
  class="lucide lucide-play"
  xmlns="http://www.w3.org/2000/svg"
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
>
  <path d="M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z" />
</svg>
`,Jm=`<!-- @license lucide-static v0.562.0 - ISC -->
<svg
  class="lucide lucide-cog"
  xmlns="http://www.w3.org/2000/svg"
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
>
  <path d="M11 10.27 7 3.34" />
  <path d="m11 13.73-4 6.93" />
  <path d="M12 22v-2" />
  <path d="M12 2v2" />
  <path d="M14 12h8" />
  <path d="m17 20.66-1-1.73" />
  <path d="m17 3.34-1 1.73" />
  <path d="M2 12h2" />
  <path d="m20.66 17-1.73-1" />
  <path d="m20.66 7-1.73 1" />
  <path d="m3.34 17 1.73-1" />
  <path d="m3.34 7 1.73 1" />
  <circle cx="12" cy="12" r="2" />
  <circle cx="12" cy="12" r="8" />
</svg>
`,ty=`<!-- @license lucide-static v0.562.0 - ISC -->
<svg
  class="lucide lucide-plus"
  xmlns="http://www.w3.org/2000/svg"
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
>
  <path d="M5 12h14" />
  <path d="M12 5v14" />
</svg>
`;var ey=Object.defineProperty,ny=Object.getOwnPropertyDescriptor,ru=e=>{throw TypeError(e)},Je=(e,t,n,r)=>{for(var i=r>1?void 0:r?ny(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&ey(t,n,i),i},ry=(e,t,n)=>t.has(e)||ru("Cannot "+n),iy=(e,t,n)=>t.has(e)?ru("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),sy=(e,t,n)=>(ry(e,t,"access private method"),n),Ss,iu;let Te=class extends Lt{constructor(){super(...arguments),iy(this,Ss),this.players=[],this.version=Va,this.page="start",this.keyText="Click to copy your save key. Use this key to restore your player data later."}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),sy(this,Ss,iu).call(this)}startPage(){const e=ja(this.player),t=oy(this.player?.id,this.gameManager.playerToken);return at` <h1>STARZ!</h1>
      <small class="version">v${this.version}</small>

      ${_e(Qm)}

      <form method="dialog">
        <div class="grid">
          <div>
            <input
              name="playerName"
              id="playerNameInput"
              type="text"
              .value=${this.player?.name??""}
              @input="${this.onChange}"
              placeholder="Name or Save Key"
              minlength="1"
              maxlength="32"
              required
            />
            <small>(Name will be used in leaderboard)</small>
          </div>
          <div>
            <span>${this.player?.name??""}</span
            ><span
              class="short-id"
              data-tooltip="${this.keyText}"
              @click="${()=>this.copyText(t)}"
              >${e}</span
            >
            ${this.player?.score?at`<span> ${this.player.score.score}</span>`:""}
            <br /><small
              >${this.player?.score?.rank?`Rank: ${this.player.score.rank}`:""}</small
            >
          </div>
        </div>

        <button type="button" @click="${this.onTest}">Name Game</button>
      </form>`}roomPage(){return at` <h4>Welcome, ${this.player?.name??""}</h4>
      <p>Players ${this.players.length}</p>
      <ul class="player-list">
        ${this.players.map(e=>at`<li>
              ${e.name}<span class="short-id"
                >${ja(e)}</span
              >
            </li>`)}
      </ul>
      <button type="button" @click="${this.onAddBot}">
        ${_e(ty)} Add Bot
      </button>
      <button type="button" @click="${this.onPlay}">
        ${_e(Zm)}
      </button>
      <button type="button" @click="${this.onOptions}">
        ${_e(Jm)}
      </button>`}renderInner(){switch(this.page){case"start":return this.startPage();case"room":return this.roomPage()}}render(){return at`
      <lobby-leaderboard-element></lobby-leaderboard-element>
      <article>${this.renderInner()}</article>
    `}onTest(){this.page="room"}async onAddBot(){this.gameManager instanceof no&&this.gameManager.addBot()}async onPlay(){await this.gameManager.setConfig({playerName:this.player?.name??""}),this.dispatchEvent(new Event("startClicked"))}async onOptions(){if(await this.showOptions()){const t=document.getElementById("optionsForm"),n=new FormData(t),r=globalThis.gameManager,i=+n.get("numBots"),s=n.get("playerName"),o=n.get("fow")==="on",a=+n.get("numSystems");r.setConfig({numBots:i,playerName:s,fow:o,numSystems:48*2**a})}}showOptions(){const e=document.getElementById("optionsDialog");return e.showModal(),new Promise(t=>{e.addEventListener("close",()=>t(!0)),e.addEventListener("cancel",()=>t(!1))})}onChange(e){e.stopPropagation(),e.stopImmediatePropagation(),this.setName(e.target.value)}async setName(e){e=e.trim(),await this.gameManager.setConfig({playerName:e}),this.requestUpdate()}async copyText(e){try{await navigator.clipboard.writeText(e),this.keyText="Copied to clipboard!",this.requestUpdate(),setTimeout(()=>{this.keyText="Use this key to restore your player data later.  Click to copy.",this.requestUpdate()},2e3)}catch{}}};Ss=new WeakSet;iu=function(){this.player=this.gameManager.getPlayer(),this.players=Array.from(this.gameManager.getState().playerMap.values()),this.gameManager.events.on("PLAYER_ADDED",()=>{this.players=Array.from(this.gameManager.getState().playerMap.values())}),this.gameManager.events.on("CONFIG_UPDATED",()=>{this.player=this.gameManager.getPlayer()}),this.gameManager.events.on("GAME_INIT",()=>{this.player=this.gameManager.getPlayer()})};Je([Tn({context:Ze}),gt()],Te.prototype,"gameManager",2);Je([gt()],Te.prototype,"player",2);Je([gt()],Te.prototype,"players",2);Je([gt()],Te.prototype,"version",2);Je([gt()],Te.prototype,"page",2);Te=Je([ke("start-dialog-content")],Te);function ja(e){return!e||e.bot?"":e.id?"#"+e.id.slice(0,4):""}function oy(e,t){return!e||!t?"":`${e}::${t}`}var ay=Object.defineProperty,ly=Object.getOwnPropertyDescriptor,io=(e,t,n,r)=>{for(var i=r>1?void 0:r?ly(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&ay(t,n,i),i};let Wr=class extends Lt{constructor(){super(...arguments),this.messages=[]}connectedCallback(){super.connectedCallback(),this.gameManager.events.on("MESSAGES_UPDATED",({messages:e})=>{this.messages=(e??[]).slice(-5)})}createRenderRoot(){return this}render(){return this.messages.length>0?at`${this.messages.map(e=>{const t=~~(e.tick/2),n=e.tick%2===1?".":"";return at`<div>
          ${_e(e.message)} <small>${t}${n}</small>
        </div>`})}`:at``}};io([Tn({context:Ze}),gt()],Wr.prototype,"gameManager",2);io([gt()],Wr.prototype,"messages",2);Wr=io([ke("message-box")],Wr);var cy=Object.defineProperty,uy=Object.getOwnPropertyDescriptor,su=(e,t,n,r)=>{for(var i=r>1?void 0:r?uy(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&cy(t,n,i),i};let Ms=class extends Lt{connectedCallback(){super.connectedCallback(),this.gameManager.events.on("GAME_START",()=>{tm(document.getElementById("app"),this.gameManager.getFnContext())}),this.gameManager.events.on("STATE_UPDATED",()=>{Z()}),this.gameManager.events.on("GAME_TICK",()=>{Z()})}createRenderRoot(){return this}render(){return at`
      <canvas></canvas>
      <svg></svg>
    `}};su([Tn({context:Ze}),gt()],Ms.prototype,"gameManager",2);Ms=su([ke("game-canvas")],Ms);const so=document.createElement("app-root"),ci=new no;globalThis.gameManager=ci;so.gameManager=ci;document.body.appendChild(so);ci.mount(so);console.log(`starz.io version ${Va}`);ci.connect();

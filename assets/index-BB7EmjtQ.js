(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const el="0.0.9";let nl=class extends Event{constructor(t,n,r,i){super("context-request",{bubbles:!0,composed:!0}),this.context=t,this.contextTarget=n,this.callback=r,this.subscribe=i??!1}};let ho=class{constructor(t,n,r,i){if(this.subscribe=!1,this.provided=!1,this.value=void 0,this.t=(s,o)=>{this.unsubscribe&&(this.unsubscribe!==o&&(this.provided=!1,this.unsubscribe()),this.subscribe||this.unsubscribe()),this.value=s,this.host.requestUpdate(),this.provided&&!this.subscribe||(this.provided=!0,this.callback&&this.callback(s,o)),this.unsubscribe=o},this.host=t,n.context!==void 0){const s=n;this.context=s.context,this.callback=s.callback,this.subscribe=s.subscribe??!1}else this.context=n,this.callback=r,this.subscribe=i??!1;this.host.addController(this)}hostConnected(){this.dispatchRequest()}hostDisconnected(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=void 0)}dispatchRequest(){this.host.dispatchEvent(new nl(this.context,this.host,this.t,this.subscribe))}};let pu=class{get value(){return this.o}set value(t){this.setValue(t)}setValue(t,n=!1){const r=n||!Object.is(t,this.o);this.o=t,r&&this.updateObservers()}constructor(t){this.subscriptions=new Map,this.updateObservers=()=>{for(const[n,{disposer:r}]of this.subscriptions)n(this.o,r)},t!==void 0&&(this.value=t)}addCallback(t,n,r){if(!r)return void t(this.value);this.subscriptions.has(t)||this.subscriptions.set(t,{disposer:()=>{this.subscriptions.delete(t)},consumerHost:n});const{disposer:i}=this.subscriptions.get(t);t(this.value,i)}clearCallbacks(){this.subscriptions.clear()}};let gu=class extends Event{constructor(t,n){super("context-provider",{bubbles:!0,composed:!0}),this.context=t,this.contextTarget=n}},fo=class extends pu{constructor(t,n,r){super(n.context!==void 0?n.initialValue:r),this.onContextRequest=i=>{if(i.context!==this.context)return;const s=i.contextTarget??i.composedPath()[0];s!==this.host&&(i.stopPropagation(),this.addCallback(i.callback,s,i.subscribe))},this.onProviderRequest=i=>{if(i.context!==this.context||(i.contextTarget??i.composedPath()[0])===this.host)return;const s=new Set;for(const[o,{consumerHost:a}]of this.subscriptions)s.has(o)||(s.add(o),a.dispatchEvent(new nl(this.context,a,o,!0)));i.stopPropagation()},this.host=t,n.context!==void 0?this.context=n.context:this.context=n,this.attachListeners(),this.host.addController?.(this)}attachListeners(){this.host.addEventListener("context-request",this.onContextRequest),this.host.addEventListener("context-provider",this.onProviderRequest)}hostConnected(){this.host.dispatchEvent(new gu(this.context,this.host))}};function Cn({context:e}){return(t,n)=>{const r=new WeakMap;if(typeof n=="object")return{get(){return t.get.call(this)},set(i){return r.get(this).setValue(i),t.set.call(this,i)},init(i){return r.set(this,new fo(this,{context:e,initialValue:i})),i}};{t.constructor.addInitializer((o=>{r.set(o,new fo(o,{context:e}))}));const i=Object.getOwnPropertyDescriptor(t,n);let s;if(i===void 0){const o=new WeakMap;s={get(){return o.get(this)},set(a){r.get(this).setValue(a),o.set(this,a)},configurable:!0,enumerable:!0}}else{const o=i.set;s={...i,set(a){r.get(this).setValue(a),o?.call(this,a)}}}return void Object.defineProperty(t,n,s)}}}function Nn({context:e,subscribe:t}){return(n,r)=>{typeof r=="object"?r.addInitializer((function(){new ho(this,{context:e,callback:i=>{n.set.call(this,i)},subscribe:t})})):n.constructor.addInitializer((i=>{new ho(i,{context:e,callback:s=>{i[r]=s},subscribe:t})}))}}const or=globalThis,Cs=or.ShadowRoot&&(or.ShadyCSS===void 0||or.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,rl=Symbol(),po=new WeakMap;let mu=class{constructor(t,n,r){if(this._$cssResult$=!0,r!==rl)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=n}get styleSheet(){let t=this.o;const n=this.t;if(Cs&&t===void 0){const r=n!==void 0&&n.length===1;r&&(t=po.get(n)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),r&&po.set(n,t))}return t}toString(){return this.cssText}};const yu=e=>new mu(typeof e=="string"?e:e+"",void 0,rl),_u=(e,t)=>{if(Cs)e.adoptedStyleSheets=t.map((n=>n instanceof CSSStyleSheet?n:n.styleSheet));else for(const n of t){const r=document.createElement("style"),i=or.litNonce;i!==void 0&&r.setAttribute("nonce",i),r.textContent=n.cssText,e.appendChild(r)}},go=Cs?e=>e:e=>e instanceof CSSStyleSheet?(t=>{let n="";for(const r of t.cssRules)n+=r.cssText;return yu(n)})(e):e;const{is:wu,defineProperty:vu,getOwnPropertyDescriptor:xu,getOwnPropertyNames:bu,getOwnPropertySymbols:Su,getPrototypeOf:Eu}=Object,Zr=globalThis,mo=Zr.trustedTypes,Mu=mo?mo.emptyScript:"",$u=Zr.reactiveElementPolyfillSupport,mn=(e,t)=>e,_r={toAttribute(e,t){switch(t){case Boolean:e=e?Mu:null;break;case Object:case Array:e=e==null?e:JSON.stringify(e)}return e},fromAttribute(e,t){let n=e;switch(t){case Boolean:n=e!==null;break;case Number:n=e===null?null:Number(e);break;case Object:case Array:try{n=JSON.parse(e)}catch{n=null}}return n}},Ns=(e,t)=>!wu(e,t),yo={attribute:!0,type:String,converter:_r,reflect:!1,useDefault:!1,hasChanged:Ns};Symbol.metadata??=Symbol("metadata"),Zr.litPropertyMetadata??=new WeakMap;let Be=class extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,n=yo){if(n.state&&(n.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((n=Object.create(n)).wrapped=!0),this.elementProperties.set(t,n),!n.noAccessor){const r=Symbol(),i=this.getPropertyDescriptor(t,r,n);i!==void 0&&vu(this.prototype,t,i)}}static getPropertyDescriptor(t,n,r){const{get:i,set:s}=xu(this.prototype,t)??{get(){return this[n]},set(o){this[n]=o}};return{get:i,set(o){const a=i?.call(this);s?.call(this,o),this.requestUpdate(t,a,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??yo}static _$Ei(){if(this.hasOwnProperty(mn("elementProperties")))return;const t=Eu(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(mn("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(mn("properties"))){const n=this.properties,r=[...bu(n),...Su(n)];for(const i of r)this.createProperty(i,n[i])}const t=this[Symbol.metadata];if(t!==null){const n=litPropertyMetadata.get(t);if(n!==void 0)for(const[r,i]of n)this.elementProperties.set(r,i)}this._$Eh=new Map;for(const[n,r]of this.elementProperties){const i=this._$Eu(n,r);i!==void 0&&this._$Eh.set(i,n)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const n=[];if(Array.isArray(t)){const r=new Set(t.flat(1/0).reverse());for(const i of r)n.unshift(go(i))}else t!==void 0&&n.push(go(t));return n}static _$Eu(t,n){const r=n.attribute;return r===!1?void 0:typeof r=="string"?r:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((t=>t(this)))}addController(t){(this._$EO??=new Set).add(t),this.renderRoot!==void 0&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,n=this.constructor.elementProperties;for(const r of n.keys())this.hasOwnProperty(r)&&(t.set(r,this[r]),delete this[r]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return _u(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((t=>t.hostConnected?.()))}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach((t=>t.hostDisconnected?.()))}attributeChangedCallback(t,n,r){this._$AK(t,r)}_$ET(t,n){const r=this.constructor.elementProperties.get(t),i=this.constructor._$Eu(t,r);if(i!==void 0&&r.reflect===!0){const s=(r.converter?.toAttribute!==void 0?r.converter:_r).toAttribute(n,r.type);this._$Em=t,s==null?this.removeAttribute(i):this.setAttribute(i,s),this._$Em=null}}_$AK(t,n){const r=this.constructor,i=r._$Eh.get(t);if(i!==void 0&&this._$Em!==i){const s=r.getPropertyOptions(i),o=typeof s.converter=="function"?{fromAttribute:s.converter}:s.converter?.fromAttribute!==void 0?s.converter:_r;this._$Em=i;const a=o.fromAttribute(n,s.type);this[i]=a??this._$Ej?.get(i)??a,this._$Em=null}}requestUpdate(t,n,r){if(t!==void 0){const i=this.constructor,s=this[t];if(r??=i.getPropertyOptions(t),!((r.hasChanged??Ns)(s,n)||r.useDefault&&r.reflect&&s===this._$Ej?.get(t)&&!this.hasAttribute(i._$Eu(t,r))))return;this.C(t,n,r)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(t,n,{useDefault:r,reflect:i,wrapped:s},o){r&&!(this._$Ej??=new Map).has(t)&&(this._$Ej.set(t,o??n??this[t]),s!==!0||o!==void 0)||(this._$AL.has(t)||(this.hasUpdated||r||(n=void 0),this._$AL.set(t,n)),i===!0&&this._$Em!==t&&(this._$Eq??=new Set).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(n){Promise.reject(n)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[i,s]of this._$Ep)this[i]=s;this._$Ep=void 0}const r=this.constructor.elementProperties;if(r.size>0)for(const[i,s]of r){const{wrapped:o}=s,a=this[i];o!==!0||this._$AL.has(i)||a===void 0||this.C(i,void 0,s,a)}}let t=!1;const n=this._$AL;try{t=this.shouldUpdate(n),t?(this.willUpdate(n),this._$EO?.forEach((r=>r.hostUpdate?.())),this.update(n)):this._$EM()}catch(r){throw t=!1,this._$EM(),r}t&&this._$AE(n)}willUpdate(t){}_$AE(t){this._$EO?.forEach((n=>n.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&=this._$Eq.forEach((n=>this._$ET(n,this[n]))),this._$EM()}updated(t){}firstUpdated(t){}};Be.elementStyles=[],Be.shadowRootOptions={mode:"open"},Be[mn("elementProperties")]=new Map,Be[mn("finalized")]=new Map,$u?.({ReactiveElement:Be}),(Zr.reactiveElementVersions??=[]).push("2.1.1");const Ds=globalThis,wr=Ds.trustedTypes,_o=wr?wr.createPolicy("lit-html",{createHTML:e=>e}):void 0,il="$lit$",ue=`lit$${Math.random().toFixed(9).slice(2)}$`,sl="?"+ue,Au=`<${sl}>`,Ie=document,wn=()=>Ie.createComment(""),vn=e=>e===null||typeof e!="object"&&typeof e!="function",Rs=Array.isArray,Iu=e=>Rs(e)||typeof e?.[Symbol.iterator]=="function",yi=`[ 	
\f\r]`,nn=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,wo=/-->/g,vo=/>/g,ye=RegExp(`>|${yi}(?:([^\\s"'>=/]+)(${yi}*=${yi}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),xo=/'/g,bo=/"/g,ol=/^(?:script|style|textarea|title)$/i,Tu=e=>(t,...n)=>({_$litType$:e,strings:t,values:n}),ot=Tu(1),Te=Symbol.for("lit-noChange"),lt=Symbol.for("lit-nothing"),So=new WeakMap,xe=Ie.createTreeWalker(Ie,129);function al(e,t){if(!Rs(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return _o!==void 0?_o.createHTML(t):t}const Pu=(e,t)=>{const n=e.length-1,r=[];let i,s=t===2?"<svg>":t===3?"<math>":"",o=nn;for(let a=0;a<n;a++){const l=e[a];let u,h,c=-1,f=0;for(;f<l.length&&(o.lastIndex=f,h=o.exec(l),h!==null);)f=o.lastIndex,o===nn?h[1]==="!--"?o=wo:h[1]!==void 0?o=vo:h[2]!==void 0?(ol.test(h[2])&&(i=RegExp("</"+h[2],"g")),o=ye):h[3]!==void 0&&(o=ye):o===ye?h[0]===">"?(o=i??nn,c=-1):h[1]===void 0?c=-2:(c=o.lastIndex-h[2].length,u=h[1],o=h[3]===void 0?ye:h[3]==='"'?bo:xo):o===bo||o===xo?o=ye:o===wo||o===vo?o=nn:(o=ye,i=void 0);const d=o===ye&&e[a+1].startsWith("/>")?" ":"";s+=o===nn?l+Au:c>=0?(r.push(u),l.slice(0,c)+il+l.slice(c)+ue+d):l+ue+(c===-2?a:d)}return[al(e,s+(e[n]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),r]};class xn{constructor({strings:t,_$litType$:n},r){let i;this.parts=[];let s=0,o=0;const a=t.length-1,l=this.parts,[u,h]=Pu(t,n);if(this.el=xn.createElement(u,r),xe.currentNode=this.el.content,n===2||n===3){const c=this.el.content.firstChild;c.replaceWith(...c.childNodes)}for(;(i=xe.nextNode())!==null&&l.length<a;){if(i.nodeType===1){if(i.hasAttributes())for(const c of i.getAttributeNames())if(c.endsWith(il)){const f=h[o++],d=i.getAttribute(c).split(ue),y=/([.?@])?(.*)/.exec(f);l.push({type:1,index:s,name:y[2],strings:d,ctor:y[1]==="."?Cu:y[1]==="?"?Nu:y[1]==="@"?Du:ti}),i.removeAttribute(c)}else c.startsWith(ue)&&(l.push({type:6,index:s}),i.removeAttribute(c));if(ol.test(i.tagName)){const c=i.textContent.split(ue),f=c.length-1;if(f>0){i.textContent=wr?wr.emptyScript:"";for(let d=0;d<f;d++)i.append(c[d],wn()),xe.nextNode(),l.push({type:2,index:++s});i.append(c[f],wn())}}}else if(i.nodeType===8)if(i.data===sl)l.push({type:2,index:s});else{let c=-1;for(;(c=i.data.indexOf(ue,c+1))!==-1;)l.push({type:7,index:s}),c+=ue.length-1}s++}}static createElement(t,n){const r=Ie.createElement("template");return r.innerHTML=t,r}}function Ve(e,t,n=e,r){if(t===Te)return t;let i=r!==void 0?n._$Co?.[r]:n._$Cl;const s=vn(t)?void 0:t._$litDirective$;return i?.constructor!==s&&(i?._$AO?.(!1),s===void 0?i=void 0:(i=new s(e),i._$AT(e,n,r)),r!==void 0?(n._$Co??=[])[r]=i:n._$Cl=i),i!==void 0&&(t=Ve(e,i._$AS(e,t.values),i,r)),t}class ku{constructor(t,n){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:n},parts:r}=this._$AD,i=(t?.creationScope??Ie).importNode(n,!0);xe.currentNode=i;let s=xe.nextNode(),o=0,a=0,l=r[0];for(;l!==void 0;){if(o===l.index){let u;l.type===2?u=new Dn(s,s.nextSibling,this,t):l.type===1?u=new l.ctor(s,l.name,l.strings,this,t):l.type===6&&(u=new Ru(s,this,t)),this._$AV.push(u),l=r[++a]}o!==l?.index&&(s=xe.nextNode(),o++)}return xe.currentNode=Ie,i}p(t){let n=0;for(const r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(t,r,n),n+=r.strings.length-2):r._$AI(t[n])),n++}}class Dn{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,n,r,i){this.type=2,this._$AH=lt,this._$AN=void 0,this._$AA=t,this._$AB=n,this._$AM=r,this.options=i,this._$Cv=i?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const n=this._$AM;return n!==void 0&&t?.nodeType===11&&(t=n.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,n=this){t=Ve(this,t,n),vn(t)?t===lt||t==null||t===""?(this._$AH!==lt&&this._$AR(),this._$AH=lt):t!==this._$AH&&t!==Te&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):Iu(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==lt&&vn(this._$AH)?this._$AA.nextSibling.data=t:this.T(Ie.createTextNode(t)),this._$AH=t}$(t){const{values:n,_$litType$:r}=t,i=typeof r=="number"?this._$AC(t):(r.el===void 0&&(r.el=xn.createElement(al(r.h,r.h[0]),this.options)),r);if(this._$AH?._$AD===i)this._$AH.p(n);else{const s=new ku(i,this),o=s.u(this.options);s.p(n),this.T(o),this._$AH=s}}_$AC(t){let n=So.get(t.strings);return n===void 0&&So.set(t.strings,n=new xn(t)),n}k(t){Rs(this._$AH)||(this._$AH=[],this._$AR());const n=this._$AH;let r,i=0;for(const s of t)i===n.length?n.push(r=new Dn(this.O(wn()),this.O(wn()),this,this.options)):r=n[i],r._$AI(s),i++;i<n.length&&(this._$AR(r&&r._$AB.nextSibling,i),n.length=i)}_$AR(t=this._$AA.nextSibling,n){for(this._$AP?.(!1,!0,n);t!==this._$AB;){const r=t.nextSibling;t.remove(),t=r}}setConnected(t){this._$AM===void 0&&(this._$Cv=t,this._$AP?.(t))}}class ti{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,n,r,i,s){this.type=1,this._$AH=lt,this._$AN=void 0,this.element=t,this.name=n,this._$AM=i,this.options=s,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=lt}_$AI(t,n=this,r,i){const s=this.strings;let o=!1;if(s===void 0)t=Ve(this,t,n,0),o=!vn(t)||t!==this._$AH&&t!==Te,o&&(this._$AH=t);else{const a=t;let l,u;for(t=s[0],l=0;l<s.length-1;l++)u=Ve(this,a[r+l],n,l),u===Te&&(u=this._$AH[l]),o||=!vn(u)||u!==this._$AH[l],u===lt?t=lt:t!==lt&&(t+=(u??"")+s[l+1]),this._$AH[l]=u}o&&!i&&this.j(t)}j(t){t===lt?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class Cu extends ti{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===lt?void 0:t}}class Nu extends ti{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==lt)}}class Du extends ti{constructor(t,n,r,i,s){super(t,n,r,i,s),this.type=5}_$AI(t,n=this){if((t=Ve(this,t,n,0)??lt)===Te)return;const r=this._$AH,i=t===lt&&r!==lt||t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive,s=t!==lt&&(r===lt||i);i&&this.element.removeEventListener(this.name,this,r),s&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class Ru{constructor(t,n,r){this.element=t,this.type=6,this._$AN=void 0,this._$AM=n,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(t){Ve(this,t)}}const Ou=Ds.litHtmlPolyfillSupport;Ou?.(xn,Dn),(Ds.litHtmlVersions??=[]).push("3.3.1");const Lu=(e,t,n)=>{const r=n?.renderBefore??t;let i=r._$litPart$;if(i===void 0){const s=n?.renderBefore??null;r._$litPart$=i=new Dn(t.insertBefore(wn(),s),s,void 0,n??{})}return i._$AI(e),i};const Os=globalThis;let Lt=class extends Be{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const n=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=Lu(n,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return Te}};Lt._$litElement$=!0,Lt.finalized=!0,Os.litElementHydrateSupport?.({LitElement:Lt});const Uu=Os.litElementPolyfillSupport;Uu?.({LitElement:Lt});(Os.litElementVersions??=[]).push("4.2.1");const Ce=e=>(t,n)=>{n!==void 0?n.addInitializer((()=>{customElements.define(e,t)})):customElements.define(e,t)};const Bu={attribute:!0,type:String,converter:_r,reflect:!1,hasChanged:Ns},zu=(e=Bu,t,n)=>{const{kind:r,metadata:i}=n;let s=globalThis.litPropertyMetadata.get(i);if(s===void 0&&globalThis.litPropertyMetadata.set(i,s=new Map),r==="setter"&&((e=Object.create(e)).wrapped=!0),s.set(n.name,e),r==="accessor"){const{name:o}=n;return{set(a){const l=t.get.call(this);t.set.call(this,a),this.requestUpdate(o,l,e)},init(a){return a!==void 0&&this.C(o,void 0,e,a),a}}}if(r==="setter"){const{name:o}=n;return function(a){const l=this[o];t.call(this,a),this.requestUpdate(o,l,e)}}throw Error("Unsupported decorator location: "+r)};function Ls(e){return(t,n)=>typeof n=="object"?zu(e,t,n):((r,i,s)=>{const o=i.hasOwnProperty(s);return i.constructor.createProperty(s,r),o?Object.getOwnPropertyDescriptor(i,s):void 0})(e,t,n)}function dt(e){return Ls({...e,state:!0,attribute:!1})}const Fu=(e,t,n)=>(n.configurable=!0,n.enumerable=!0,Reflect.decorate&&typeof t!="object"&&Object.defineProperty(e,t,n),n);function ei(e,t){return(n,r,i)=>{const s=o=>o.renderRoot?.querySelector(e)??null;return Fu(n,r,{get(){return s(this)}})}}const Hu={CHILD:2},qu=e=>(...t)=>({_$litDirective$:e,values:t});class Gu{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,n,r){this._$Ct=t,this._$AM=n,this._$Ci=r}_$AS(t,n){return this.update(t,n)}update(t,n){return this.render(...n)}}class Oi extends Gu{constructor(t){if(super(t),this.it=lt,t.type!==Hu.CHILD)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(t){if(t===lt||t==null)return this._t=void 0,this.it=t;if(t===Te)return t;if(typeof t!="string")throw Error(this.constructor.directiveName+"() called with a non-string value");if(t===this.it)return this._t;this.it=t;const n=[t];return n.raw=n,this._t={_$litType$:this.constructor.resultType,strings:n,values:[]}}}Oi.directiveName="unsafeHTML",Oi.resultType=1;const he=qu(Oi),Vu={DEV:!1,PROD:!0},vr=750,de=750,ju="Orthographic",Yu=500,Wu=2,Ku=25,Xu=1,Ju=1,ll=40,Qu=!0,Zu=384,cl=1,Us=8,th=cl+Us,eh=.1,ul=Vu||{},xr=ul.DEV??!0,nh=ul.PROD??!1,rh=nh,ih=xr,hl=xr,sh=["#c0392b","#f1c40f","#9b59b6","#00b386","#cc6600","#0a4c8c","#e74c3c","#f39c12","#8e44ad","#27ae60","#d35400","#2980b9"];function je(e,...t){const n=globalThis.gameManager?.getContext()?.tick??null;ih&&console.log(`[DEBUG][Tick ${n}] ${e}`,...t)}function _i(e,t={}){if(!rh)return;const n=globalThis.gameManager?.getContext()?.tick??null;let r=1;try{r=parseInt(localStorage.getItem(e)??"0",10)+1}catch(i){console.error("Error reading event count from localStorage:",i)}if(localStorage.setItem(e,r+""),window&&window.sa_event)try{window.sa_event(e,{[e]:r,tick:n,...t})}catch(i){console.error("Error tracking event:",i)}}function fl(e,t){let n,r;for(const i of e)i!=null&&(n===void 0?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)));return[n,r]}class Ut{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let r=0;for(let i=0;i<this._n&&i<32;i++){const s=n[i],o=t+s,a=Math.abs(t)<Math.abs(s)?t-(o-s):s-(o-t);a&&(n[r++]=a),t=o}return n[r]=t,this._n=r+1,this}valueOf(){const t=this._partials;let n=this._n,r,i,s,o=0;if(n>0){for(o=t[--n];n>0&&(r=o,i=t[--n],o=r+i,s=i-(o-r),!s););n>0&&(s<0&&t[n-1]<0||s>0&&t[n-1]>0)&&(i=s*2,r=o+i,i==r-o&&(o=r))}return o}}function Eo(e,t){let n=0,r=0;if(t===void 0)for(let i of e)i!=null&&(i=+i)>=i&&(++n,r+=i);else{let i=-1;for(let s of e)(s=t(s,++i,e))!=null&&(s=+s)>=s&&(++n,r+=s)}if(n)return r/n}function*oh(e){for(const t of e)yield*t}function dl(e){return Array.from(oh(e))}function ze(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,s=new Array(i);++r<i;)s[r]=e+r*n;return s}var ah={value:()=>{}};function ni(){for(var e=0,t=arguments.length,n={},r;e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new ar(n)}function ar(e){this._=e}function lh(e,t){return e.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}ar.prototype=ni.prototype={constructor:ar,on:function(e,t){var n=this._,r=lh(e+"",n),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(e=r[s]).type)&&(i=ch(n[i],e.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<o;)if(i=(e=r[s]).type)n[i]=Mo(n[i],e.name,t);else if(t==null)for(i in n)n[i]=Mo(n[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new ar(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,s;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],r=0,i=s.length;r<i;++r)s[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,s=r.length;i<s;++i)r[i].value.apply(t,n)}};function ch(e,t){for(var n=0,r=e.length,i;n<r;++n)if((i=e[n]).name===t)return i.value}function Mo(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=ah,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}var Li="http://www.w3.org/1999/xhtml";const $o={svg:"http://www.w3.org/2000/svg",xhtml:Li,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ri(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),$o.hasOwnProperty(t)?{space:$o[t],local:e}:e}function uh(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Li&&t.documentElement.namespaceURI===Li?t.createElement(e):t.createElementNS(n,e)}}function hh(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function pl(e){var t=ri(e);return(t.local?hh:uh)(t)}function fh(){}function Bs(e){return e==null?fh:function(){return this.querySelector(e)}}function dh(e){typeof e!="function"&&(e=Bs(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,a=r[i]=new Array(o),l,u,h=0;h<o;++h)(l=s[h])&&(u=e.call(l,l.__data__,h,s))&&("__data__"in l&&(u.__data__=l.__data__),a[h]=u);return new $t(r,this._parents)}function ph(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function gh(){return[]}function gl(e){return e==null?gh:function(){return this.querySelectorAll(e)}}function mh(e){return function(){return ph(e.apply(this,arguments))}}function yh(e){typeof e=="function"?e=mh(e):e=gl(e);for(var t=this._groups,n=t.length,r=[],i=[],s=0;s<n;++s)for(var o=t[s],a=o.length,l,u=0;u<a;++u)(l=o[u])&&(r.push(e.call(l,l.__data__,u,o)),i.push(l));return new $t(r,i)}function ml(e){return function(){return this.matches(e)}}function yl(e){return function(t){return t.matches(e)}}var _h=Array.prototype.find;function wh(e){return function(){return _h.call(this.children,e)}}function vh(){return this.firstElementChild}function xh(e){return this.select(e==null?vh:wh(typeof e=="function"?e:yl(e)))}var bh=Array.prototype.filter;function Sh(){return Array.from(this.children)}function Eh(e){return function(){return bh.call(this.children,e)}}function Mh(e){return this.selectAll(e==null?Sh:Eh(typeof e=="function"?e:yl(e)))}function $h(e){typeof e!="function"&&(e=ml(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,a=r[i]=[],l,u=0;u<o;++u)(l=s[u])&&e.call(l,l.__data__,u,s)&&a.push(l);return new $t(r,this._parents)}function _l(e){return new Array(e.length)}function Ah(){return new $t(this._enter||this._groups.map(_l),this._parents)}function br(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}br.prototype={constructor:br,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Ih(e){return function(){return e}}function Th(e,t,n,r,i,s){for(var o=0,a,l=t.length,u=s.length;o<u;++o)(a=t[o])?(a.__data__=s[o],r[o]=a):n[o]=new br(e,s[o]);for(;o<l;++o)(a=t[o])&&(i[o]=a)}function Ph(e,t,n,r,i,s,o){var a,l,u=new Map,h=t.length,c=s.length,f=new Array(h),d;for(a=0;a<h;++a)(l=t[a])&&(f[a]=d=o.call(l,l.__data__,a,t)+"",u.has(d)?i[a]=l:u.set(d,l));for(a=0;a<c;++a)d=o.call(e,s[a],a,s)+"",(l=u.get(d))?(r[a]=l,l.__data__=s[a],u.delete(d)):n[a]=new br(e,s[a]);for(a=0;a<h;++a)(l=t[a])&&u.get(f[a])===l&&(i[a]=l)}function kh(e){return e.__data__}function Ch(e,t){if(!arguments.length)return Array.from(this,kh);var n=t?Ph:Th,r=this._parents,i=this._groups;typeof e!="function"&&(e=Ih(e));for(var s=i.length,o=new Array(s),a=new Array(s),l=new Array(s),u=0;u<s;++u){var h=r[u],c=i[u],f=c.length,d=Nh(e.call(h,h&&h.__data__,u,r)),y=d.length,w=a[u]=new Array(y),M=o[u]=new Array(y),v=l[u]=new Array(f);n(h,c,w,M,v,d,t);for(var T=0,A=0,b,C;T<y;++T)if(b=w[T]){for(T>=A&&(A=T+1);!(C=M[A])&&++A<y;);b._next=C||null}}return o=new $t(o,r),o._enter=a,o._exit=l,o}function Nh(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Dh(){return new $t(this._exit||this._groups.map(_l),this._parents)}function Rh(e,t,n){var r=this.enter(),i=this,s=this.exit();return typeof e=="function"?(r=e(r),r&&(r=r.selection())):r=r.append(e+""),t!=null&&(i=t(i),i&&(i=i.selection())),n==null?s.remove():n(s),r&&i?r.merge(i).order():i}function Oh(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,i=n.length,s=r.length,o=Math.min(i,s),a=new Array(i),l=0;l<o;++l)for(var u=n[l],h=r[l],c=u.length,f=a[l]=new Array(c),d,y=0;y<c;++y)(d=u[y]||h[y])&&(f[y]=d);for(;l<i;++l)a[l]=n[l];return new $t(a,this._parents)}function Lh(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r=e[t],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function Uh(e){e||(e=Bh);function t(c,f){return c&&f?e(c.__data__,f.__data__):!c-!f}for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o=n[s],a=o.length,l=i[s]=new Array(a),u,h=0;h<a;++h)(u=o[h])&&(l[h]=u);l.sort(t)}return new $t(i,this._parents).order()}function Bh(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function zh(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Fh(){return Array.from(this)}function Hh(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function qh(){let e=0;for(const t of this)++e;return e}function Gh(){return!this.node()}function Vh(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i=t[n],s=0,o=i.length,a;s<o;++s)(a=i[s])&&e.call(a,a.__data__,s,i);return this}function jh(e){return function(){this.removeAttribute(e)}}function Yh(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Wh(e,t){return function(){this.setAttribute(e,t)}}function Kh(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Xh(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function Jh(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Qh(e,t){var n=ri(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((t==null?n.local?Yh:jh:typeof t=="function"?n.local?Jh:Xh:n.local?Kh:Wh)(n,t))}function wl(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Zh(e){return function(){this.style.removeProperty(e)}}function tf(e,t,n){return function(){this.style.setProperty(e,t,n)}}function ef(e,t,n){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function nf(e,t,n){return arguments.length>1?this.each((t==null?Zh:typeof t=="function"?ef:tf)(e,t,n??"")):Ye(this.node(),e)}function Ye(e,t){return e.style.getPropertyValue(t)||wl(e).getComputedStyle(e,null).getPropertyValue(t)}function rf(e){return function(){delete this[e]}}function sf(e,t){return function(){this[e]=t}}function of(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function af(e,t){return arguments.length>1?this.each((t==null?rf:typeof t=="function"?of:sf)(e,t)):this.node()[e]}function vl(e){return e.trim().split(/^|\s+/)}function zs(e){return e.classList||new xl(e)}function xl(e){this._node=e,this._names=vl(e.getAttribute("class")||"")}xl.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function bl(e,t){for(var n=zs(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function Sl(e,t){for(var n=zs(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function lf(e){return function(){bl(this,e)}}function cf(e){return function(){Sl(this,e)}}function uf(e,t){return function(){(t.apply(this,arguments)?bl:Sl)(this,e)}}function hf(e,t){var n=vl(e+"");if(arguments.length<2){for(var r=zs(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof t=="function"?uf:t?lf:cf)(n,t))}function ff(){this.textContent=""}function df(e){return function(){this.textContent=e}}function pf(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function gf(e){return arguments.length?this.each(e==null?ff:(typeof e=="function"?pf:df)(e)):this.node().textContent}function mf(){this.innerHTML=""}function yf(e){return function(){this.innerHTML=e}}function _f(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function wf(e){return arguments.length?this.each(e==null?mf:(typeof e=="function"?_f:yf)(e)):this.node().innerHTML}function vf(){this.nextSibling&&this.parentNode.appendChild(this)}function xf(){return this.each(vf)}function bf(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Sf(){return this.each(bf)}function Ef(e){var t=typeof e=="function"?e:pl(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Mf(){return null}function $f(e,t){var n=typeof e=="function"?e:pl(e),r=t==null?Mf:typeof t=="function"?t:Bs(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function Af(){var e=this.parentNode;e&&e.removeChild(this)}function If(){return this.each(Af)}function Tf(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Pf(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function kf(e){return this.select(e?Pf:Tf)}function Cf(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Nf(e){return function(t){e.call(this,t,this.__data__)}}function Df(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}function Rf(e){return function(){var t=this.__on;if(t){for(var n=0,r=-1,i=t.length,s;n<i;++n)s=t[n],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.options):t[++r]=s;++r?t.length=r:delete this.__on}}}function Of(e,t,n){return function(){var r=this.__on,i,s=Nf(t);if(r){for(var o=0,a=r.length;o<a;++o)if((i=r[o]).type===e.type&&i.name===e.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=n),i.value=t;return}}this.addEventListener(e.type,s,n),i={type:e.type,name:e.name,value:t,listener:s,options:n},r?r.push(i):this.__on=[i]}}function Lf(e,t,n){var r=Df(e+""),i,s=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,u=a.length,h;l<u;++l)for(i=0,h=a[l];i<s;++i)if((o=r[i]).type===h.type&&o.name===h.name)return h.value}return}for(a=t?Of:Rf,i=0;i<s;++i)this.each(a(r[i],t,n));return this}function El(e,t,n){var r=wl(e),i=r.CustomEvent;typeof i=="function"?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function Uf(e,t){return function(){return El(this,e,t)}}function Bf(e,t){return function(){return El(this,e,t.apply(this,arguments))}}function zf(e,t){return this.each((typeof t=="function"?Bf:Uf)(e,t))}function*Ff(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var Ml=[null];function $t(e,t){this._groups=e,this._parents=t}function Rn(){return new $t([[document.documentElement]],Ml)}function Hf(){return this}$t.prototype=Rn.prototype={constructor:$t,select:dh,selectAll:yh,selectChild:xh,selectChildren:Mh,filter:$h,data:Ch,enter:Ah,exit:Dh,join:Rh,merge:Oh,selection:Hf,order:Lh,sort:Uh,call:zh,nodes:Fh,node:Hh,size:qh,empty:Gh,each:Vh,attr:Qh,style:nf,property:af,classed:hf,text:gf,html:wf,raise:xf,lower:Sf,append:Ef,insert:$f,remove:If,clone:kf,datum:Cf,on:Lf,dispatch:zf,[Symbol.iterator]:Ff};function Dt(e){return typeof e=="string"?new $t([[document.querySelector(e)]],[document.documentElement]):new $t([[e]],Ml)}function $l(e){let t;for(;t=e.sourceEvent;)e=t;return e}function zt(e,t){if(e=$l(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}function qf(e,t){return e.target&&(e=$l(e),t===void 0&&(t=e.currentTarget),e=e.touches||[e]),Array.from(e,n=>zt(n,t))}const Gf={passive:!1},bn={capture:!0,passive:!1};function wi(e){e.stopImmediatePropagation()}function qe(e){e.preventDefault(),e.stopImmediatePropagation()}function Al(e){var t=e.document.documentElement,n=Dt(e).on("dragstart.drag",qe,bn);"onselectstart"in t?n.on("selectstart.drag",qe,bn):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Il(e,t){var n=e.document.documentElement,r=Dt(e).on("dragstart.drag",null);t&&(r.on("click.drag",qe,bn),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const zn=e=>()=>e;function Ui(e,{sourceEvent:t,subject:n,target:r,identifier:i,active:s,x:o,y:a,dx:l,dy:u,dispatch:h}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:h}})}Ui.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function Vf(e){return!e.ctrlKey&&!e.button}function jf(){return this.parentNode}function Yf(e,t){return t??{x:e.x,y:e.y}}function Wf(){return navigator.maxTouchPoints||"ontouchstart"in this}function Kf(){var e=Vf,t=jf,n=Yf,r=Wf,i={},s=ni("start","drag","end"),o=0,a,l,u,h,c=0;function f(b){b.on("mousedown.drag",d).filter(r).on("touchstart.drag",M).on("touchmove.drag",v,Gf).on("touchend.drag touchcancel.drag",T).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function d(b,C){if(!(h||!e.call(this,b,C))){var R=A(this,t.call(this,b,C),b,C,"mouse");R&&(Dt(b.view).on("mousemove.drag",y,bn).on("mouseup.drag",w,bn),Al(b.view),wi(b),u=!1,a=b.clientX,l=b.clientY,R("start",b))}}function y(b){if(qe(b),!u){var C=b.clientX-a,R=b.clientY-l;u=C*C+R*R>c}i.mouse("drag",b)}function w(b){Dt(b.view).on("mousemove.drag mouseup.drag",null),Il(b.view,u),qe(b),i.mouse("end",b)}function M(b,C){if(e.call(this,b,C)){var R=b.changedTouches,L=t.call(this,b,C),O=R.length,N,U;for(N=0;N<O;++N)(U=A(this,L,b,C,R[N].identifier,R[N]))&&(wi(b),U("start",b,R[N]))}}function v(b){var C=b.changedTouches,R=C.length,L,O;for(L=0;L<R;++L)(O=i[C[L].identifier])&&(qe(b),O("drag",b,C[L]))}function T(b){var C=b.changedTouches,R=C.length,L,O;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),L=0;L<R;++L)(O=i[C[L].identifier])&&(wi(b),O("end",b,C[L]))}function A(b,C,R,L,O,N){var U=s.copy(),I=zt(N||R,C),F,_,p;if((p=n.call(b,new Ui("beforestart",{sourceEvent:R,target:f,identifier:O,active:o,x:I[0],y:I[1],dx:0,dy:0,dispatch:U}),L))!=null)return F=p.x-I[0]||0,_=p.y-I[1]||0,function m(g,x,k){var P=I,D;switch(g){case"start":i[O]=m,D=o++;break;case"end":delete i[O],--o;case"drag":I=zt(k||x,C),D=o;break}U.call(g,b,new Ui(g,{sourceEvent:x,subject:p,target:f,identifier:O,active:D,x:I[0]+F,y:I[1]+_,dx:I[0]-P[0],dy:I[1]-P[1],dispatch:U}),L)}}return f.filter=function(b){return arguments.length?(e=typeof b=="function"?b:zn(!!b),f):e},f.container=function(b){return arguments.length?(t=typeof b=="function"?b:zn(b),f):t},f.subject=function(b){return arguments.length?(n=typeof b=="function"?b:zn(b),f):n},f.touchable=function(b){return arguments.length?(r=typeof b=="function"?b:zn(!!b),f):r},f.on=function(){var b=s.on.apply(s,arguments);return b===s?f:b},f.clickDistance=function(b){return arguments.length?(c=(b=+b)*b,f):Math.sqrt(c)},f}function Fs(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Tl(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function On(){}var Sn=.7,Sr=1/Sn,Ge="\\s*([+-]?\\d+)\\s*",En="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Gt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Xf=/^#([0-9a-f]{3,8})$/,Jf=new RegExp(`^rgb\\(${Ge},${Ge},${Ge}\\)$`),Qf=new RegExp(`^rgb\\(${Gt},${Gt},${Gt}\\)$`),Zf=new RegExp(`^rgba\\(${Ge},${Ge},${Ge},${En}\\)$`),t0=new RegExp(`^rgba\\(${Gt},${Gt},${Gt},${En}\\)$`),e0=new RegExp(`^hsl\\(${En},${Gt},${Gt}\\)$`),n0=new RegExp(`^hsla\\(${En},${Gt},${Gt},${En}\\)$`),Ao={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Fs(On,Mn,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Io,formatHex:Io,formatHex8:r0,formatHsl:i0,formatRgb:To,toString:To});function Io(){return this.rgb().formatHex()}function r0(){return this.rgb().formatHex8()}function i0(){return Pl(this).formatHsl()}function To(){return this.rgb().formatRgb()}function Mn(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Xf.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Po(t):n===3?new bt(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?Fn(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?Fn(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Jf.exec(e))?new bt(t[1],t[2],t[3],1):(t=Qf.exec(e))?new bt(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Zf.exec(e))?Fn(t[1],t[2],t[3],t[4]):(t=t0.exec(e))?Fn(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=e0.exec(e))?No(t[1],t[2]/100,t[3]/100,1):(t=n0.exec(e))?No(t[1],t[2]/100,t[3]/100,t[4]):Ao.hasOwnProperty(e)?Po(Ao[e]):e==="transparent"?new bt(NaN,NaN,NaN,0):null}function Po(e){return new bt(e>>16&255,e>>8&255,e&255,1)}function Fn(e,t,n,r){return r<=0&&(e=t=n=NaN),new bt(e,t,n,r)}function s0(e){return e instanceof On||(e=Mn(e)),e?(e=e.rgb(),new bt(e.r,e.g,e.b,e.opacity)):new bt}function Bi(e,t,n,r){return arguments.length===1?s0(e):new bt(e,t,n,r??1)}function bt(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}Fs(bt,Bi,Tl(On,{brighter(e){return e=e==null?Sr:Math.pow(Sr,e),new bt(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Sn:Math.pow(Sn,e),new bt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new bt(Ae(this.r),Ae(this.g),Ae(this.b),Er(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ko,formatHex:ko,formatHex8:o0,formatRgb:Co,toString:Co}));function ko(){return`#${be(this.r)}${be(this.g)}${be(this.b)}`}function o0(){return`#${be(this.r)}${be(this.g)}${be(this.b)}${be((isNaN(this.opacity)?1:this.opacity)*255)}`}function Co(){const e=Er(this.opacity);return`${e===1?"rgb(":"rgba("}${Ae(this.r)}, ${Ae(this.g)}, ${Ae(this.b)}${e===1?")":`, ${e})`}`}function Er(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Ae(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function be(e){return e=Ae(e),(e<16?"0":"")+e.toString(16)}function No(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Rt(e,t,n,r)}function Pl(e){if(e instanceof Rt)return new Rt(e.h,e.s,e.l,e.opacity);if(e instanceof On||(e=Mn(e)),!e)return new Rt;if(e instanceof Rt)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),s=Math.max(t,n,r),o=NaN,a=s-i,l=(s+i)/2;return a?(t===s?o=(n-r)/a+(n<r)*6:n===s?o=(r-t)/a+2:o=(t-n)/a+4,a/=l<.5?s+i:2-s-i,o*=60):a=l>0&&l<1?0:o,new Rt(o,a,l,e.opacity)}function a0(e,t,n,r){return arguments.length===1?Pl(e):new Rt(e,t,n,r??1)}function Rt(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}Fs(Rt,a0,Tl(On,{brighter(e){return e=e==null?Sr:Math.pow(Sr,e),new Rt(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Sn:Math.pow(Sn,e),new Rt(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new bt(vi(e>=240?e-240:e+120,i,r),vi(e,i,r),vi(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new Rt(Do(this.h),Hn(this.s),Hn(this.l),Er(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Er(this.opacity);return`${e===1?"hsl(":"hsla("}${Do(this.h)}, ${Hn(this.s)*100}%, ${Hn(this.l)*100}%${e===1?")":`, ${e})`}`}}));function Do(e){return e=(e||0)%360,e<0?e+360:e}function Hn(e){return Math.max(0,Math.min(1,e||0))}function vi(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const kl=e=>()=>e;function l0(e,t){return function(n){return e+n*t}}function c0(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function u0(e){return(e=+e)==1?Cl:function(t,n){return n-t?c0(t,n,e):kl(isNaN(t)?n:t)}}function Cl(e,t){var n=t-e;return n?l0(e,n):kl(isNaN(e)?t:e)}const Ro=(function e(t){var n=u0(t);function r(i,s){var o=n((i=Bi(i)).r,(s=Bi(s)).r),a=n(i.g,s.g),l=n(i.b,s.b),u=Cl(i.opacity,s.opacity);return function(h){return i.r=o(h),i.g=a(h),i.b=l(h),i.opacity=u(h),i+""}}return r.gamma=e,r})(1);function ce(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var zi=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,xi=new RegExp(zi.source,"g");function h0(e){return function(){return e}}function f0(e){return function(t){return e(t)+""}}function d0(e,t){var n=zi.lastIndex=xi.lastIndex=0,r,i,s,o=-1,a=[],l=[];for(e=e+"",t=t+"";(r=zi.exec(e))&&(i=xi.exec(t));)(s=i.index)>n&&(s=t.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,l.push({i:o,x:ce(r,i)})),n=xi.lastIndex;return n<t.length&&(s=t.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?f0(l[0].x):h0(t):(t=l.length,function(u){for(var h=0,c;h<t;++h)a[(c=l[h]).i]=c.x(u);return a.join("")})}var Oo=180/Math.PI,Fi={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Nl(e,t,n,r,i,s){var o,a,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,l/=a),e*r<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*Oo,skewX:Math.atan(l)*Oo,scaleX:o,scaleY:a}}var qn;function p0(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Fi:Nl(t.a,t.b,t.c,t.d,t.e,t.f)}function g0(e){return e==null||(qn||(qn=document.createElementNS("http://www.w3.org/2000/svg","g")),qn.setAttribute("transform",e),!(e=qn.transform.baseVal.consolidate()))?Fi:(e=e.matrix,Nl(e.a,e.b,e.c,e.d,e.e,e.f))}function Dl(e,t,n,r){function i(u){return u.length?u.pop()+" ":""}function s(u,h,c,f,d,y){if(u!==c||h!==f){var w=d.push("translate(",null,t,null,n);y.push({i:w-4,x:ce(u,c)},{i:w-2,x:ce(h,f)})}else(c||f)&&d.push("translate("+c+t+f+n)}function o(u,h,c,f){u!==h?(u-h>180?h+=360:h-u>180&&(u+=360),f.push({i:c.push(i(c)+"rotate(",null,r)-2,x:ce(u,h)})):h&&c.push(i(c)+"rotate("+h+r)}function a(u,h,c,f){u!==h?f.push({i:c.push(i(c)+"skewX(",null,r)-2,x:ce(u,h)}):h&&c.push(i(c)+"skewX("+h+r)}function l(u,h,c,f,d,y){if(u!==c||h!==f){var w=d.push(i(d)+"scale(",null,",",null,")");y.push({i:w-4,x:ce(u,c)},{i:w-2,x:ce(h,f)})}else(c!==1||f!==1)&&d.push(i(d)+"scale("+c+","+f+")")}return function(u,h){var c=[],f=[];return u=e(u),h=e(h),s(u.translateX,u.translateY,h.translateX,h.translateY,c,f),o(u.rotate,h.rotate,c,f),a(u.skewX,h.skewX,c,f),l(u.scaleX,u.scaleY,h.scaleX,h.scaleY,c,f),u=h=null,function(d){for(var y=-1,w=f.length,M;++y<w;)c[(M=f[y]).i]=M.x(d);return c.join("")}}}var m0=Dl(p0,"px, ","px)","deg)"),y0=Dl(g0,", ",")",")"),_0=1e-12;function Lo(e){return((e=Math.exp(e))+1/e)/2}function w0(e){return((e=Math.exp(e))-1/e)/2}function v0(e){return((e=Math.exp(2*e))-1)/(e+1)}const x0=(function e(t,n,r){function i(s,o){var a=s[0],l=s[1],u=s[2],h=o[0],c=o[1],f=o[2],d=h-a,y=c-l,w=d*d+y*y,M,v;if(w<_0)v=Math.log(f/u)/t,M=function(L){return[a+L*d,l+L*y,u*Math.exp(t*L*v)]};else{var T=Math.sqrt(w),A=(f*f-u*u+r*w)/(2*u*n*T),b=(f*f-u*u-r*w)/(2*f*n*T),C=Math.log(Math.sqrt(A*A+1)-A),R=Math.log(Math.sqrt(b*b+1)-b);v=(R-C)/t,M=function(L){var O=L*v,N=Lo(C),U=u/(n*T)*(N*v0(t*O+C)-w0(C));return[a+U*d,l+U*y,u*N/Lo(t*O+C)]}}return M.duration=v*1e3*t/Math.SQRT2,M}return i.rho=function(s){var o=Math.max(.001,+s),a=o*o,l=a*a;return e(o,a,l)},i})(Math.SQRT2,2,4);var We=0,ln=0,rn=0,Rl=1e3,Mr,cn,$r=0,Pe=0,ii=0,$n=typeof performance=="object"&&performance.now?performance:Date,Ol=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Hs(){return Pe||(Ol(b0),Pe=$n.now()+ii)}function b0(){Pe=0}function Ar(){this._call=this._time=this._next=null}Ar.prototype=Ll.prototype={constructor:Ar,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Hs():+n)+(t==null?0:+t),!this._next&&cn!==this&&(cn?cn._next=this:Mr=this,cn=this),this._call=e,this._time=n,Hi()},stop:function(){this._call&&(this._call=null,this._time=1/0,Hi())}};function Ll(e,t,n){var r=new Ar;return r.restart(e,t,n),r}function S0(){Hs(),++We;for(var e=Mr,t;e;)(t=Pe-e._time)>=0&&e._call.call(void 0,t),e=e._next;--We}function Uo(){Pe=($r=$n.now())+ii,We=ln=0;try{S0()}finally{We=0,M0(),Pe=0}}function E0(){var e=$n.now(),t=e-$r;t>Rl&&(ii-=t,$r=e)}function M0(){for(var e,t=Mr,n,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Mr=n);cn=e,Hi(r)}function Hi(e){if(!We){ln&&(ln=clearTimeout(ln));var t=e-Pe;t>24?(e<1/0&&(ln=setTimeout(Uo,e-$n.now()-ii)),rn&&(rn=clearInterval(rn))):(rn||($r=$n.now(),rn=setInterval(E0,Rl)),We=1,Ol(Uo))}}function Bo(e,t,n){var r=new Ar;return t=t==null?0:+t,r.restart(i=>{r.stop(),e(i+t)},t,n),r}var $0=ni("start","end","cancel","interrupt"),A0=[],Ul=0,zo=1,qi=2,lr=3,Fo=4,Gi=5,cr=6;function si(e,t,n,r,i,s){var o=e.__transition;if(!o)e.__transition={};else if(n in o)return;I0(e,n,{name:t,index:r,group:i,on:$0,tween:A0,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:Ul})}function qs(e,t){var n=Bt(e,t);if(n.state>Ul)throw new Error("too late; already scheduled");return n}function Wt(e,t){var n=Bt(e,t);if(n.state>lr)throw new Error("too late; already running");return n}function Bt(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function I0(e,t,n){var r=e.__transition,i;r[t]=n,n.timer=Ll(s,0,n.time);function s(u){n.state=zo,n.timer.restart(o,n.delay,n.time),n.delay<=u&&o(u-n.delay)}function o(u){var h,c,f,d;if(n.state!==zo)return l();for(h in r)if(d=r[h],d.name===n.name){if(d.state===lr)return Bo(o);d.state===Fo?(d.state=cr,d.timer.stop(),d.on.call("interrupt",e,e.__data__,d.index,d.group),delete r[h]):+h<t&&(d.state=cr,d.timer.stop(),d.on.call("cancel",e,e.__data__,d.index,d.group),delete r[h])}if(Bo(function(){n.state===lr&&(n.state=Fo,n.timer.restart(a,n.delay,n.time),a(u))}),n.state=qi,n.on.call("start",e,e.__data__,n.index,n.group),n.state===qi){for(n.state=lr,i=new Array(f=n.tween.length),h=0,c=-1;h<f;++h)(d=n.tween[h].value.call(e,e.__data__,n.index,n.group))&&(i[++c]=d);i.length=c+1}}function a(u){for(var h=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(l),n.state=Gi,1),c=-1,f=i.length;++c<f;)i[c].call(e,h);n.state===Gi&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){n.state=cr,n.timer.stop(),delete r[t];for(var u in r)return;delete e.__transition}}function ur(e,t){var n=e.__transition,r,i,s=!0,o;if(n){t=t==null?null:t+"";for(o in n){if((r=n[o]).name!==t){s=!1;continue}i=r.state>qi&&r.state<Gi,r.state=cr,r.timer.stop(),r.on.call(i?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete n[o]}s&&delete e.__transition}}function T0(e){return this.each(function(){ur(this,e)})}function P0(e,t){var n,r;return function(){var i=Wt(this,e),s=i.tween;if(s!==n){r=n=s;for(var o=0,a=r.length;o<a;++o)if(r[o].name===t){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function k0(e,t,n){var r,i;if(typeof n!="function")throw new Error;return function(){var s=Wt(this,e),o=s.tween;if(o!==r){i=(r=o).slice();for(var a={name:t,value:n},l=0,u=i.length;l<u;++l)if(i[l].name===t){i[l]=a;break}l===u&&i.push(a)}s.tween=i}}function C0(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r=Bt(this.node(),n).tween,i=0,s=r.length,o;i<s;++i)if((o=r[i]).name===e)return o.value;return null}return this.each((t==null?P0:k0)(n,e,t))}function Gs(e,t,n){var r=e._id;return e.each(function(){var i=Wt(this,r);(i.value||(i.value={}))[t]=n.apply(this,arguments)}),function(i){return Bt(i,r).value[t]}}function Bl(e,t){var n;return(typeof t=="number"?ce:t instanceof Mn?Ro:(n=Mn(t))?(t=n,Ro):d0)(e,t)}function N0(e){return function(){this.removeAttribute(e)}}function D0(e){return function(){this.removeAttributeNS(e.space,e.local)}}function R0(e,t,n){var r,i=n+"",s;return function(){var o=this.getAttribute(e);return o===i?null:o===r?s:s=t(r=o,n)}}function O0(e,t,n){var r,i=n+"",s;return function(){var o=this.getAttributeNS(e.space,e.local);return o===i?null:o===r?s:s=t(r=o,n)}}function L0(e,t,n){var r,i,s;return function(){var o,a=n(this),l;return a==null?void this.removeAttribute(e):(o=this.getAttribute(e),l=a+"",o===l?null:o===r&&l===i?s:(i=l,s=t(r=o,a)))}}function U0(e,t,n){var r,i,s;return function(){var o,a=n(this),l;return a==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),l=a+"",o===l?null:o===r&&l===i?s:(i=l,s=t(r=o,a)))}}function B0(e,t){var n=ri(e),r=n==="transform"?y0:Bl;return this.attrTween(e,typeof t=="function"?(n.local?U0:L0)(n,r,Gs(this,"attr."+e,t)):t==null?(n.local?D0:N0)(n):(n.local?O0:R0)(n,r,t))}function z0(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function F0(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function H0(e,t){var n,r;function i(){var s=t.apply(this,arguments);return s!==r&&(n=(r=s)&&F0(e,s)),n}return i._value=t,i}function q0(e,t){var n,r;function i(){var s=t.apply(this,arguments);return s!==r&&(n=(r=s)&&z0(e,s)),n}return i._value=t,i}function G0(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var r=ri(e);return this.tween(n,(r.local?H0:q0)(r,t))}function V0(e,t){return function(){qs(this,e).delay=+t.apply(this,arguments)}}function j0(e,t){return t=+t,function(){qs(this,e).delay=t}}function Y0(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?V0:j0)(t,e)):Bt(this.node(),t).delay}function W0(e,t){return function(){Wt(this,e).duration=+t.apply(this,arguments)}}function K0(e,t){return t=+t,function(){Wt(this,e).duration=t}}function X0(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?W0:K0)(t,e)):Bt(this.node(),t).duration}function J0(e,t){if(typeof t!="function")throw new Error;return function(){Wt(this,e).ease=t}}function Q0(e){var t=this._id;return arguments.length?this.each(J0(t,e)):Bt(this.node(),t).ease}function Z0(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Wt(this,e).ease=n}}function td(e){if(typeof e!="function")throw new Error;return this.each(Z0(this._id,e))}function ed(e){typeof e!="function"&&(e=ml(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,a=r[i]=[],l,u=0;u<o;++u)(l=s[u])&&e.call(l,l.__data__,u,s)&&a.push(l);return new re(r,this._parents,this._name,this._id)}function nd(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,i=n.length,s=Math.min(r,i),o=new Array(r),a=0;a<s;++a)for(var l=t[a],u=n[a],h=l.length,c=o[a]=new Array(h),f,d=0;d<h;++d)(f=l[d]||u[d])&&(c[d]=f);for(;a<r;++a)o[a]=t[a];return new re(o,this._parents,this._name,this._id)}function rd(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function id(e,t,n){var r,i,s=rd(t)?qs:Wt;return function(){var o=s(this,e),a=o.on;a!==r&&(i=(r=a).copy()).on(t,n),o.on=i}}function sd(e,t){var n=this._id;return arguments.length<2?Bt(this.node(),n).on.on(e):this.each(id(n,e,t))}function od(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function ad(){return this.on("end.remove",od(this._id))}function ld(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Bs(e));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var a=r[o],l=a.length,u=s[o]=new Array(l),h,c,f=0;f<l;++f)(h=a[f])&&(c=e.call(h,h.__data__,f,a))&&("__data__"in h&&(c.__data__=h.__data__),u[f]=c,si(u[f],t,n,f,u,Bt(h,n)));return new re(s,this._parents,t,n)}function cd(e){var t=this._name,n=this._id;typeof e!="function"&&(e=gl(e));for(var r=this._groups,i=r.length,s=[],o=[],a=0;a<i;++a)for(var l=r[a],u=l.length,h,c=0;c<u;++c)if(h=l[c]){for(var f=e.call(h,h.__data__,c,l),d,y=Bt(h,n),w=0,M=f.length;w<M;++w)(d=f[w])&&si(d,t,n,w,f,y);s.push(f),o.push(h)}return new re(s,o,t,n)}var ud=Rn.prototype.constructor;function hd(){return new ud(this._groups,this._parents)}function fd(e,t){var n,r,i;return function(){var s=Ye(this,e),o=(this.style.removeProperty(e),Ye(this,e));return s===o?null:s===n&&o===r?i:i=t(n=s,r=o)}}function zl(e){return function(){this.style.removeProperty(e)}}function dd(e,t,n){var r,i=n+"",s;return function(){var o=Ye(this,e);return o===i?null:o===r?s:s=t(r=o,n)}}function pd(e,t,n){var r,i,s;return function(){var o=Ye(this,e),a=n(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(e),Ye(this,e))),o===l?null:o===r&&l===i?s:(i=l,s=t(r=o,a))}}function gd(e,t){var n,r,i,s="style."+t,o="end."+s,a;return function(){var l=Wt(this,e),u=l.on,h=l.value[s]==null?a||(a=zl(t)):void 0;(u!==n||i!==h)&&(r=(n=u).copy()).on(o,i=h),l.on=r}}function md(e,t,n){var r=(e+="")=="transform"?m0:Bl;return t==null?this.styleTween(e,fd(e,r)).on("end.style."+e,zl(e)):typeof t=="function"?this.styleTween(e,pd(e,r,Gs(this,"style."+e,t))).each(gd(this._id,e)):this.styleTween(e,dd(e,r,t),n).on("end.style."+e,null)}function yd(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function _d(e,t,n){var r,i;function s(){var o=t.apply(this,arguments);return o!==i&&(r=(i=o)&&yd(e,o,n)),r}return s._value=t,s}function wd(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,_d(e,t,n??""))}function vd(e){return function(){this.textContent=e}}function xd(e){return function(){var t=e(this);this.textContent=t??""}}function bd(e){return this.tween("text",typeof e=="function"?xd(Gs(this,"text",e)):vd(e==null?"":e+""))}function Sd(e){return function(t){this.textContent=e.call(this,t)}}function Ed(e){var t,n;function r(){var i=e.apply(this,arguments);return i!==n&&(t=(n=i)&&Sd(i)),t}return r._value=e,r}function Md(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Ed(e))}function $d(){for(var e=this._name,t=this._id,n=Fl(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],a=o.length,l,u=0;u<a;++u)if(l=o[u]){var h=Bt(l,t);si(l,e,n,u,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new re(r,this._parents,e,n)}function Ad(){var e,t,n=this,r=n._id,i=n.size();return new Promise(function(s,o){var a={value:o},l={value:function(){--i===0&&s()}};n.each(function(){var u=Wt(this,r),h=u.on;h!==e&&(t=(e=h).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),u.on=t}),i===0&&s()})}var Id=0;function re(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function Fl(){return++Id}var Qt=Rn.prototype;re.prototype={constructor:re,select:ld,selectAll:cd,selectChild:Qt.selectChild,selectChildren:Qt.selectChildren,filter:ed,merge:nd,selection:hd,transition:$d,call:Qt.call,nodes:Qt.nodes,node:Qt.node,size:Qt.size,empty:Qt.empty,each:Qt.each,on:sd,attr:B0,attrTween:G0,style:md,styleTween:wd,text:bd,textTween:Md,remove:ad,tween:C0,delay:Y0,duration:X0,ease:Q0,easeVarying:td,end:Ad,[Symbol.iterator]:Qt[Symbol.iterator]};function Td(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Pd={time:null,delay:0,duration:250,ease:Td};function kd(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Cd(e){var t,n;e instanceof re?(t=e._id,e=e._name):(t=Fl(),(n=Pd).time=Hs(),e=e==null?null:e+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],a=o.length,l,u=0;u<a;++u)(l=o[u])&&si(l,e,t,u,o,n||kd(l,t));return new re(r,this._parents,e,t)}Rn.prototype.interrupt=T0;Rn.prototype.transition=Cd;const ee=11102230246251565e-32,pt=134217729,Nd=(3+8*ee)*ee;function bi(e,t,n,r,i){let s,o,a,l,u=t[0],h=r[0],c=0,f=0;h>u==h>-u?(s=u,u=t[++c]):(s=h,h=r[++f]);let d=0;if(c<e&&f<n)for(h>u==h>-u?(o=u+s,a=s-(o-u),u=t[++c]):(o=h+s,a=s-(o-h),h=r[++f]),s=o,a!==0&&(i[d++]=a);c<e&&f<n;)h>u==h>-u?(o=s+u,l=o-s,a=s-(o-l)+(u-l),u=t[++c]):(o=s+h,l=o-s,a=s-(o-l)+(h-l),h=r[++f]),s=o,a!==0&&(i[d++]=a);for(;c<e;)o=s+u,l=o-s,a=s-(o-l)+(u-l),u=t[++c],s=o,a!==0&&(i[d++]=a);for(;f<n;)o=s+h,l=o-s,a=s-(o-l)+(h-l),h=r[++f],s=o,a!==0&&(i[d++]=a);return(s!==0||d===0)&&(i[d++]=s),d}function Dd(e,t){let n=t[0];for(let r=1;r<e;r++)n+=t[r];return n}function Ln(e){return new Float64Array(e)}const Rd=(3+16*ee)*ee,Od=(2+12*ee)*ee,Ld=(9+64*ee)*ee*ee,Ne=Ln(4),Ho=Ln(8),qo=Ln(12),Go=Ln(16),yt=Ln(4);function Ud(e,t,n,r,i,s,o){let a,l,u,h,c,f,d,y,w,M,v,T,A,b,C,R,L,O;const N=e-i,U=n-i,I=t-s,F=r-s;b=N*F,f=pt*N,d=f-(f-N),y=N-d,f=pt*F,w=f-(f-F),M=F-w,C=y*M-(b-d*w-y*w-d*M),R=I*U,f=pt*I,d=f-(f-I),y=I-d,f=pt*U,w=f-(f-U),M=U-w,L=y*M-(R-d*w-y*w-d*M),v=C-L,c=C-v,Ne[0]=C-(v+c)+(c-L),T=b+v,c=T-b,A=b-(T-c)+(v-c),v=A-R,c=A-v,Ne[1]=A-(v+c)+(c-R),O=T+v,c=O-T,Ne[2]=T-(O-c)+(v-c),Ne[3]=O;let _=Dd(4,Ne),p=Od*o;if(_>=p||-_>=p||(c=e-N,a=e-(N+c)+(c-i),c=n-U,u=n-(U+c)+(c-i),c=t-I,l=t-(I+c)+(c-s),c=r-F,h=r-(F+c)+(c-s),a===0&&l===0&&u===0&&h===0)||(p=Ld*o+Nd*Math.abs(_),_+=N*h+F*a-(I*u+U*l),_>=p||-_>=p))return _;b=a*F,f=pt*a,d=f-(f-a),y=a-d,f=pt*F,w=f-(f-F),M=F-w,C=y*M-(b-d*w-y*w-d*M),R=l*U,f=pt*l,d=f-(f-l),y=l-d,f=pt*U,w=f-(f-U),M=U-w,L=y*M-(R-d*w-y*w-d*M),v=C-L,c=C-v,yt[0]=C-(v+c)+(c-L),T=b+v,c=T-b,A=b-(T-c)+(v-c),v=A-R,c=A-v,yt[1]=A-(v+c)+(c-R),O=T+v,c=O-T,yt[2]=T-(O-c)+(v-c),yt[3]=O;const m=bi(4,Ne,4,yt,Ho);b=N*h,f=pt*N,d=f-(f-N),y=N-d,f=pt*h,w=f-(f-h),M=h-w,C=y*M-(b-d*w-y*w-d*M),R=I*u,f=pt*I,d=f-(f-I),y=I-d,f=pt*u,w=f-(f-u),M=u-w,L=y*M-(R-d*w-y*w-d*M),v=C-L,c=C-v,yt[0]=C-(v+c)+(c-L),T=b+v,c=T-b,A=b-(T-c)+(v-c),v=A-R,c=A-v,yt[1]=A-(v+c)+(c-R),O=T+v,c=O-T,yt[2]=T-(O-c)+(v-c),yt[3]=O;const g=bi(m,Ho,4,yt,qo);b=a*h,f=pt*a,d=f-(f-a),y=a-d,f=pt*h,w=f-(f-h),M=h-w,C=y*M-(b-d*w-y*w-d*M),R=l*u,f=pt*l,d=f-(f-l),y=l-d,f=pt*u,w=f-(f-u),M=u-w,L=y*M-(R-d*w-y*w-d*M),v=C-L,c=C-v,yt[0]=C-(v+c)+(c-L),T=b+v,c=T-b,A=b-(T-c)+(v-c),v=A-R,c=A-v,yt[1]=A-(v+c)+(c-R),O=T+v,c=O-T,yt[2]=T-(O-c)+(v-c),yt[3]=O;const x=bi(g,qo,4,yt,Go);return Go[x-1]}function Gn(e,t,n,r,i,s){const o=(t-s)*(n-i),a=(e-i)*(r-s),l=o-a,u=Math.abs(o+a);return Math.abs(l)>=Rd*u?l:-Ud(e,t,n,r,i,s,u)}const Vo=Math.pow(2,-52),Vn=new Uint32Array(512);class Ir{static from(t,n=qd,r=Gd){const i=t.length,s=new Float64Array(i*2);for(let o=0;o<i;o++){const a=t[o];s[2*o]=n(a),s[2*o+1]=r(a)}return new Ir(s)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const r=Math.max(2*n-5,0);this._triangles=new Uint32Array(r*3),this._halfedges=new Int32Array(r*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:r,_hullTri:i,_hullHash:s}=this,o=t.length>>1;let a=1/0,l=1/0,u=-1/0,h=-1/0;for(let N=0;N<o;N++){const U=t[2*N],I=t[2*N+1];U<a&&(a=U),I<l&&(l=I),U>u&&(u=U),I>h&&(h=I),this._ids[N]=N}const c=(a+u)/2,f=(l+h)/2;let d,y,w;for(let N=0,U=1/0;N<o;N++){const I=Si(c,f,t[2*N],t[2*N+1]);I<U&&(d=N,U=I)}const M=t[2*d],v=t[2*d+1];for(let N=0,U=1/0;N<o;N++){if(N===d)continue;const I=Si(M,v,t[2*N],t[2*N+1]);I<U&&I>0&&(y=N,U=I)}let T=t[2*y],A=t[2*y+1],b=1/0;for(let N=0;N<o;N++){if(N===d||N===y)continue;const U=Fd(M,v,T,A,t[2*N],t[2*N+1]);U<b&&(w=N,b=U)}let C=t[2*w],R=t[2*w+1];if(b===1/0){for(let I=0;I<o;I++)this._dists[I]=t[2*I]-t[0]||t[2*I+1]-t[1];Fe(this._ids,this._dists,0,o-1);const N=new Uint32Array(o);let U=0;for(let I=0,F=-1/0;I<o;I++){const _=this._ids[I],p=this._dists[_];p>F&&(N[U++]=_,F=p)}this.hull=N.subarray(0,U),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(Gn(M,v,T,A,C,R)<0){const N=y,U=T,I=A;y=w,T=C,A=R,w=N,C=U,R=I}const L=Hd(M,v,T,A,C,R);this._cx=L.x,this._cy=L.y;for(let N=0;N<o;N++)this._dists[N]=Si(t[2*N],t[2*N+1],L.x,L.y);Fe(this._ids,this._dists,0,o-1),this._hullStart=d;let O=3;r[d]=n[w]=y,r[y]=n[d]=w,r[w]=n[y]=d,i[d]=0,i[y]=1,i[w]=2,s.fill(-1),s[this._hashKey(M,v)]=d,s[this._hashKey(T,A)]=y,s[this._hashKey(C,R)]=w,this.trianglesLen=0,this._addTriangle(d,y,w,-1,-1,-1);for(let N=0,U,I;N<this._ids.length;N++){const F=this._ids[N],_=t[2*F],p=t[2*F+1];if(N>0&&Math.abs(_-U)<=Vo&&Math.abs(p-I)<=Vo||(U=_,I=p,F===d||F===y||F===w))continue;let m=0;for(let D=0,z=this._hashKey(_,p);D<this._hashSize&&(m=s[(z+D)%this._hashSize],!(m!==-1&&m!==r[m]));D++);m=n[m];let g=m,x;for(;x=r[g],Gn(_,p,t[2*g],t[2*g+1],t[2*x],t[2*x+1])>=0;)if(g=x,g===m){g=-1;break}if(g===-1)continue;let k=this._addTriangle(g,F,r[g],-1,-1,i[g]);i[F]=this._legalize(k+2),i[g]=k,O++;let P=r[g];for(;x=r[P],Gn(_,p,t[2*P],t[2*P+1],t[2*x],t[2*x+1])<0;)k=this._addTriangle(P,F,x,i[F],-1,i[P]),i[F]=this._legalize(k+2),r[P]=P,O--,P=x;if(g===m)for(;x=n[g],Gn(_,p,t[2*x],t[2*x+1],t[2*g],t[2*g+1])<0;)k=this._addTriangle(x,F,g,-1,i[g],i[x]),this._legalize(k+2),i[x]=k,r[g]=g,O--,g=x;this._hullStart=n[F]=g,r[g]=n[P]=F,r[F]=P,s[this._hashKey(_,p)]=F,s[this._hashKey(t[2*g],t[2*g+1])]=g}this.hull=new Uint32Array(O);for(let N=0,U=this._hullStart;N<O;N++)this.hull[N]=U,U=r[U];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(Bd(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:r,coords:i}=this;let s=0,o=0;for(;;){const a=r[t],l=t-t%3;if(o=l+(t+2)%3,a===-1){if(s===0)break;t=Vn[--s];continue}const u=a-a%3,h=l+(t+1)%3,c=u+(a+2)%3,f=n[o],d=n[t],y=n[h],w=n[c];if(zd(i[2*f],i[2*f+1],i[2*d],i[2*d+1],i[2*y],i[2*y+1],i[2*w],i[2*w+1])){n[t]=w,n[a]=f;const v=r[c];if(v===-1){let A=this._hullStart;do{if(this._hullTri[A]===c){this._hullTri[A]=t;break}A=this._hullPrev[A]}while(A!==this._hullStart)}this._link(t,v),this._link(a,r[o]),this._link(o,c);const T=u+(a+1)%3;s<Vn.length&&(Vn[s++]=T)}else{if(s===0)break;t=Vn[--s]}}return o}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,r,i,s,o){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=n,this._triangles[a+2]=r,this._link(a,i),this._link(a+1,s),this._link(a+2,o),this.trianglesLen+=3,a}}function Bd(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function Si(e,t,n,r){const i=e-n,s=t-r;return i*i+s*s}function zd(e,t,n,r,i,s,o,a){const l=e-o,u=t-a,h=n-o,c=r-a,f=i-o,d=s-a,y=l*l+u*u,w=h*h+c*c,M=f*f+d*d;return l*(c*M-w*d)-u*(h*M-w*f)+y*(h*d-c*f)<0}function Fd(e,t,n,r,i,s){const o=n-e,a=r-t,l=i-e,u=s-t,h=o*o+a*a,c=l*l+u*u,f=.5/(o*u-a*l),d=(u*h-a*c)*f,y=(o*c-l*h)*f;return d*d+y*y}function Hd(e,t,n,r,i,s){const o=n-e,a=r-t,l=i-e,u=s-t,h=o*o+a*a,c=l*l+u*u,f=.5/(o*u-a*l),d=e+(u*h-a*c)*f,y=t+(o*c-l*h)*f;return{x:d,y}}function Fe(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const s=e[i],o=t[s];let a=i-1;for(;a>=n&&t[e[a]]>o;)e[a+1]=e[a--];e[a+1]=s}else{const i=n+r>>1;let s=n+1,o=r;sn(e,i,s),t[e[n]]>t[e[r]]&&sn(e,n,r),t[e[s]]>t[e[r]]&&sn(e,s,r),t[e[n]]>t[e[s]]&&sn(e,n,s);const a=e[s],l=t[a];for(;;){do s++;while(t[e[s]]<l);do o--;while(t[e[o]]>l);if(o<s)break;sn(e,s,o)}e[n+1]=e[o],e[o]=a,r-s+1>=o-n?(Fe(e,t,s,r),Fe(e,t,n,o-1)):(Fe(e,t,n,o-1),Fe(e,t,s,r))}}function sn(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function qd(e){return e[0]}function Gd(e){return e[1]}const jo=1e-6;class Se{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,r){t=+t,n=+n,r=+r;const i=t+r,s=n;if(r<0)throw new Error("negative radius");this._x1===null?this._+=`M${i},${s}`:(Math.abs(this._x1-i)>jo||Math.abs(this._y1-s)>jo)&&(this._+="L"+i+","+s),r&&(this._+=`A${r},${r},0,1,1,${t-r},${n}A${r},${r},0,1,1,${this._x1=i},${this._y1=s}`)}rect(t,n,r,i){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+r}v${+i}h${-r}Z`}value(){return this._||null}}class Vi{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}class Vd{constructor(t,[n,r,i,s]=[0,0,960,500]){if(!((i=+i)>=(n=+n))||!((s=+s)>=(r=+r)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=i,this.xmin=n,this.ymax=s,this.ymin=r,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:r},vectors:i}=this;let s,o;const a=this.circumcenters=this._circumcenters.subarray(0,r.length/3*2);for(let w=0,M=0,v=r.length,T,A;w<v;w+=3,M+=2){const b=r[w]*2,C=r[w+1]*2,R=r[w+2]*2,L=t[b],O=t[b+1],N=t[C],U=t[C+1],I=t[R],F=t[R+1],_=N-L,p=U-O,m=I-L,g=F-O,x=(_*g-p*m)*2;if(Math.abs(x)<1e-9){if(s===void 0){s=o=0;for(const P of n)s+=t[P*2],o+=t[P*2+1];s/=n.length,o/=n.length}const k=1e9*Math.sign((s-L)*g-(o-O)*m);T=(L+I)/2-k*g,A=(O+F)/2+k*m}else{const k=1/x,P=_*_+p*p,D=m*m+g*g;T=L+(g*P-p*D)*k,A=O+(_*D-m*P)*k}a[M]=T,a[M+1]=A}let l=n[n.length-1],u,h=l*4,c,f=t[2*l],d,y=t[2*l+1];i.fill(0);for(let w=0;w<n.length;++w)l=n[w],u=h,c=f,d=y,h=l*4,f=t[2*l],y=t[2*l+1],i[u+2]=i[h]=d-y,i[u+3]=i[h+1]=f-c}render(t){const n=t==null?t=new Se:void 0,{delaunay:{halfedges:r,inedges:i,hull:s},circumcenters:o,vectors:a}=this;if(s.length<=1)return null;for(let h=0,c=r.length;h<c;++h){const f=r[h];if(f<h)continue;const d=Math.floor(h/3)*2,y=Math.floor(f/3)*2,w=o[d],M=o[d+1],v=o[y],T=o[y+1];this._renderSegment(w,M,v,T,t)}let l,u=s[s.length-1];for(let h=0;h<s.length;++h){l=u,u=s[h];const c=Math.floor(i[u]/3)*2,f=o[c],d=o[c+1],y=l*4,w=this._project(f,d,a[y+2],a[y+3]);w&&this._renderSegment(f,d,w[0],w[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new Se:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const r=n==null?n=new Se:void 0,i=this._clip(t);if(i===null||!i.length)return;n.moveTo(i[0],i[1]);let s=i.length;for(;i[0]===i[s-2]&&i[1]===i[s-1]&&s>1;)s-=2;for(let o=2;o<s;o+=2)(i[o]!==i[o-2]||i[o+1]!==i[o-1])&&n.lineTo(i[o],i[o+1]);return n.closePath(),r&&r.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,r=t.length/2;n<r;++n){const i=this.cellPolygon(n);i&&(i.index=n,yield i)}}cellPolygon(t){const n=new Vi;return this.renderCell(t,n),n.value()}_renderSegment(t,n,r,i,s){let o;const a=this._regioncode(t,n),l=this._regioncode(r,i);a===0&&l===0?(s.moveTo(t,n),s.lineTo(r,i)):(o=this._clipSegment(t,n,r,i,a,l))&&(s.moveTo(o[0],o[1]),s.lineTo(o[2],o[3]))}contains(t,n,r){return n=+n,n!==n||(r=+r,r!==r)?!1:this.delaunay._step(t,n,r)===t}*neighbors(t){const n=this._clip(t);if(n)for(const r of this.delaunay.neighbors(t)){const i=this._clip(r);if(i){t:for(let s=0,o=n.length;s<o;s+=2)for(let a=0,l=i.length;a<l;a+=2)if(n[s]===i[a]&&n[s+1]===i[a+1]&&n[(s+2)%o]===i[(a+l-2)%l]&&n[(s+3)%o]===i[(a+l-1)%l]){yield r;break t}}}}_cell(t){const{circumcenters:n,delaunay:{inedges:r,halfedges:i,triangles:s}}=this,o=r[t];if(o===-1)return null;const a=[];let l=o;do{const u=Math.floor(l/3);if(a.push(n[u*2],n[u*2+1]),l=l%3===2?l-2:l+1,s[l]!==t)break;l=i[l]}while(l!==o&&l!==-1);return a}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:r}=this,i=t*4;return this._simplify(r[i]||r[i+1]?this._clipInfinite(t,n,r[i],r[i+1],r[i+2],r[i+3]):this._clipFinite(t,n))}_clipFinite(t,n){const r=n.length;let i=null,s,o,a=n[r-2],l=n[r-1],u,h=this._regioncode(a,l),c,f=0;for(let d=0;d<r;d+=2)if(s=a,o=l,a=n[d],l=n[d+1],u=h,h=this._regioncode(a,l),u===0&&h===0)c=f,f=0,i?i.push(a,l):i=[a,l];else{let y,w,M,v,T;if(u===0){if((y=this._clipSegment(s,o,a,l,u,h))===null)continue;[w,M,v,T]=y}else{if((y=this._clipSegment(a,l,s,o,h,u))===null)continue;[v,T,w,M]=y,c=f,f=this._edgecode(w,M),c&&f&&this._edge(t,c,f,i,i.length),i?i.push(w,M):i=[w,M]}c=f,f=this._edgecode(v,T),c&&f&&this._edge(t,c,f,i,i.length),i?i.push(v,T):i=[v,T]}if(i)c=f,f=this._edgecode(i[0],i[1]),c&&f&&this._edge(t,c,f,i,i.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return i}_clipSegment(t,n,r,i,s,o){const a=s<o;for(a&&([t,n,r,i,s,o]=[r,i,t,n,o,s]);;){if(s===0&&o===0)return a?[r,i,t,n]:[t,n,r,i];if(s&o)return null;let l,u,h=s||o;h&8?(l=t+(r-t)*(this.ymax-n)/(i-n),u=this.ymax):h&4?(l=t+(r-t)*(this.ymin-n)/(i-n),u=this.ymin):h&2?(u=n+(i-n)*(this.xmax-t)/(r-t),l=this.xmax):(u=n+(i-n)*(this.xmin-t)/(r-t),l=this.xmin),s?(t=l,n=u,s=this._regioncode(t,n)):(r=l,i=u,o=this._regioncode(r,i))}}_clipInfinite(t,n,r,i,s,o){let a=Array.from(n),l;if((l=this._project(a[0],a[1],r,i))&&a.unshift(l[0],l[1]),(l=this._project(a[a.length-2],a[a.length-1],s,o))&&a.push(l[0],l[1]),a=this._clipFinite(t,a))for(let u=0,h=a.length,c,f=this._edgecode(a[h-2],a[h-1]);u<h;u+=2)c=f,f=this._edgecode(a[u],a[u+1]),c&&f&&(u=this._edge(t,c,f,a,u),h=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,n,r,i,s){for(;n!==r;){let o,a;switch(n){case 5:n=4;continue;case 4:n=6,o=this.xmax,a=this.ymin;break;case 6:n=2;continue;case 2:n=10,o=this.xmax,a=this.ymax;break;case 10:n=8;continue;case 8:n=9,o=this.xmin,a=this.ymax;break;case 9:n=1;continue;case 1:n=5,o=this.xmin,a=this.ymin;break}(i[s]!==o||i[s+1]!==a)&&this.contains(t,o,a)&&(i.splice(s,0,o,a),s+=2)}return s}_project(t,n,r,i){let s=1/0,o,a,l;if(i<0){if(n<=this.ymin)return null;(o=(this.ymin-n)/i)<s&&(l=this.ymin,a=t+(s=o)*r)}else if(i>0){if(n>=this.ymax)return null;(o=(this.ymax-n)/i)<s&&(l=this.ymax,a=t+(s=o)*r)}if(r>0){if(t>=this.xmax)return null;(o=(this.xmax-t)/r)<s&&(a=this.xmax,l=n+(s=o)*i)}else if(r<0){if(t<=this.xmin)return null;(o=(this.xmin-t)/r)<s&&(a=this.xmin,l=n+(s=o)*i)}return[a,l]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}_simplify(t){if(t&&t.length>4){for(let n=0;n<t.length;n+=2){const r=(n+2)%t.length,i=(n+4)%t.length;(t[n]===t[r]&&t[r]===t[i]||t[n+1]===t[r+1]&&t[r+1]===t[i+1])&&(t.splice(r,2),n-=2)}t.length||(t=null)}return t}}const jd=2*Math.PI,De=Math.pow;function Yd(e){return e[0]}function Wd(e){return e[1]}function Kd(e){const{triangles:t,coords:n}=e;for(let r=0;r<t.length;r+=3){const i=2*t[r],s=2*t[r+1],o=2*t[r+2];if((n[o]-n[i])*(n[s+1]-n[i+1])-(n[s]-n[i])*(n[o+1]-n[i+1])>1e-10)return!1}return!0}function Xd(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class Vs{static from(t,n=Yd,r=Wd,i){return new Vs("length"in t?Jd(t,n,r,i):Float64Array.from(Qd(t,n,r,i)))}constructor(t){this._delaunator=new Ir(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&Kd(t)){this.collinear=Int32Array.from({length:n.length/2},(f,d)=>d).sort((f,d)=>n[2*f]-n[2*d]||n[2*f+1]-n[2*d+1]);const l=this.collinear[0],u=this.collinear[this.collinear.length-1],h=[n[2*l],n[2*l+1],n[2*u],n[2*u+1]],c=1e-8*Math.hypot(h[3]-h[1],h[2]-h[0]);for(let f=0,d=n.length/2;f<d;++f){const y=Xd(n[2*f],n[2*f+1],c);n[2*f]=y[0],n[2*f+1]=y[1]}this._delaunator=new Ir(n)}else delete this.collinear;const r=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let l=0,u=r.length;l<u;++l){const h=s[l%3===2?l-2:l+1];(r[l]===-1||o[h]===-1)&&(o[h]=l)}for(let l=0,u=i.length;l<u;++l)a[i[l]]=l;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],o[i[0]]=1,i.length===2&&(o[i[1]]=0,this.triangles[1]=i[1],this.triangles[2]=i[1]))}voronoi(t){return new Vd(this,t)}*neighbors(t){const{inedges:n,hull:r,_hullIndex:i,halfedges:s,triangles:o,collinear:a}=this;if(a){const c=a.indexOf(t);c>0&&(yield a[c-1]),c<a.length-1&&(yield a[c+1]);return}const l=n[t];if(l===-1)return;let u=l,h=-1;do{if(yield h=o[u],u=u%3===2?u-2:u+1,o[u]!==t)return;if(u=s[u],u===-1){const c=r[(i[t]+1)%r.length];c!==h&&(yield c);return}}while(u!==l)}find(t,n,r=0){if(t=+t,t!==t||(n=+n,n!==n))return-1;const i=r;let s;for(;(s=this._step(r,t,n))>=0&&s!==r&&s!==i;)r=s;return s}_step(t,n,r){const{inedges:i,hull:s,_hullIndex:o,halfedges:a,triangles:l,points:u}=this;if(i[t]===-1||!u.length)return(t+1)%(u.length>>1);let h=t,c=De(n-u[t*2],2)+De(r-u[t*2+1],2);const f=i[t];let d=f;do{let y=l[d];const w=De(n-u[y*2],2)+De(r-u[y*2+1],2);if(w<c&&(c=w,h=y),d=d%3===2?d-2:d+1,l[d]!==t)break;if(d=a[d],d===-1){if(d=s[(o[t]+1)%s.length],d!==y&&De(n-u[d*2],2)+De(r-u[d*2+1],2)<c)return d;break}}while(d!==f);return h}render(t){const n=t==null?t=new Se:void 0,{points:r,halfedges:i,triangles:s}=this;for(let o=0,a=i.length;o<a;++o){const l=i[o];if(l<o)continue;const u=s[o]*2,h=s[l]*2;t.moveTo(r[u],r[u+1]),t.lineTo(r[h],r[h+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n){n===void 0&&(!t||typeof t.moveTo!="function")&&(n=t,t=null),n=n==null?2:+n;const r=t==null?t=new Se:void 0,{points:i}=this;for(let s=0,o=i.length;s<o;s+=2){const a=i[s],l=i[s+1];t.moveTo(a+n,l),t.arc(a,l,n,0,jd)}return r&&r.value()}renderHull(t){const n=t==null?t=new Se:void 0,{hull:r,points:i}=this,s=r[0]*2,o=r.length;t.moveTo(i[s],i[s+1]);for(let a=1;a<o;++a){const l=2*r[a];t.lineTo(i[l],i[l+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new Vi;return this.renderHull(t),t.value()}renderTriangle(t,n){const r=n==null?n=new Se:void 0,{points:i,triangles:s}=this,o=s[t*=3]*2,a=s[t+1]*2,l=s[t+2]*2;return n.moveTo(i[o],i[o+1]),n.lineTo(i[a],i[a+1]),n.lineTo(i[l],i[l+1]),n.closePath(),r&&r.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,r=t.length/3;n<r;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new Vi;return this.renderTriangle(t,n),n.value()}}function Jd(e,t,n,r){const i=e.length,s=new Float64Array(i*2);for(let o=0;o<i;++o){const a=e[o];s[o*2]=t.call(r,a,o,e),s[o*2+1]=n.call(r,a,o,e)}return s}function*Qd(e,t,n,r){let i=0;for(const s of e)yield t.call(r,s,i,e),yield n.call(r,s,i,e),++i}function Zd(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Tr(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function tp(e){return e=Tr(Math.abs(e)),e?e[1]:NaN}function ep(e,t){return function(n,r){for(var i=n.length,s=[],o=0,a=e[0],l=0;i>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),s.push(n.substring(i-=a,i+a)),!((l+=a+1)>r));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function np(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var rp=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ji(e){if(!(t=rp.exec(e)))throw new Error("invalid format: "+e);var t;return new js({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}ji.prototype=js.prototype;function js(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}js.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function ip(e){t:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+e[n])break t;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(i+1):e}var Hl;function sp(e,t){var n=Tr(e,t);if(!n)return e+"";var r=n[0],i=n[1],s=i-(Hl=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+Tr(e,Math.max(0,t+s-1))[0]}function Yo(e,t){var n=Tr(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const Wo={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:Zd,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Yo(e*100,t),r:Yo,s:sp,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Ko(e){return e}var Xo=Array.prototype.map,Jo=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function op(e){var t=e.grouping===void 0||e.thousands===void 0?Ko:ep(Xo.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",r=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?Ko:np(Xo.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function u(c){c=ji(c);var f=c.fill,d=c.align,y=c.sign,w=c.symbol,M=c.zero,v=c.width,T=c.comma,A=c.precision,b=c.trim,C=c.type;C==="n"?(T=!0,C="g"):Wo[C]||(A===void 0&&(A=12),b=!0,C="g"),(M||f==="0"&&d==="=")&&(M=!0,f="0",d="=");var R=w==="$"?n:w==="#"&&/[boxX]/.test(C)?"0"+C.toLowerCase():"",L=w==="$"?r:/[%p]/.test(C)?o:"",O=Wo[C],N=/[defgprs%]/.test(C);A=A===void 0?6:/[gprs]/.test(C)?Math.max(1,Math.min(21,A)):Math.max(0,Math.min(20,A));function U(I){var F=R,_=L,p,m,g;if(C==="c")_=O(I)+_,I="";else{I=+I;var x=I<0||1/I<0;if(I=isNaN(I)?l:O(Math.abs(I),A),b&&(I=ip(I)),x&&+I==0&&y!=="+"&&(x=!1),F=(x?y==="("?y:a:y==="-"||y==="("?"":y)+F,_=(C==="s"?Jo[8+Hl/3]:"")+_+(x&&y==="("?")":""),N){for(p=-1,m=I.length;++p<m;)if(g=I.charCodeAt(p),48>g||g>57){_=(g===46?i+I.slice(p+1):I.slice(p))+_,I=I.slice(0,p);break}}}T&&!M&&(I=t(I,1/0));var k=F.length+I.length+_.length,P=k<v?new Array(v-k+1).join(f):"";switch(T&&M&&(I=t(P+I,P.length?v-_.length:1/0),P=""),d){case"<":I=F+I+_+P;break;case"=":I=F+P+I+_;break;case"^":I=P.slice(0,k=P.length>>1)+F+I+_+P.slice(k);break;default:I=P+F+I+_;break}return s(I)}return U.toString=function(){return c+""},U}function h(c,f){var d=u((c=ji(c),c.type="f",c)),y=Math.max(-8,Math.min(8,Math.floor(tp(f)/3)))*3,w=Math.pow(10,-y),M=Jo[8+y/3];return function(v){return d(w*v)+M}}return{format:u,formatPrefix:h}}var jn,oi;ap({thousands:",",grouping:[3],currency:["$",""]});function ap(e){return jn=op(e),oi=jn.format,jn.formatPrefix,jn}var j=1e-6,Yi=1e-12,W=Math.PI,mt=W/2,Qo=W/4,At=W*2,_t=180/W,K=W/180,nt=Math.abs,ai=Math.atan,ie=Math.atan2,G=Math.cos,Yn=Math.ceil,ql=Math.exp,Wi=Math.hypot,Gl=Math.log,q=Math.sin,lp=Math.sign||function(e){return e>0?1:e<0?-1:0},Kt=Math.sqrt,Vl=Math.tan;function cp(e){return e>1?0:e<-1?W:Math.acos(e)}function se(e){return e>1?mt:e<-1?-mt:Math.asin(e)}function ct(){}function Pr(e,t){e&&ta.hasOwnProperty(e.type)&&ta[e.type](e,t)}var Zo={Feature:function(e,t){Pr(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)Pr(n[r].geometry,t)}},ta={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){Ki(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)Ki(n[r],t,0)},Polygon:function(e,t){ea(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)ea(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)Pr(n[r],t)}};function Ki(e,t,n){var r=-1,i=e.length-n,s;for(t.lineStart();++r<i;)s=e[r],t.point(s[0],s[1],s[2]);t.lineEnd()}function ea(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)Ki(e[n],t,1);t.polygonEnd()}function fe(e,t){e&&Zo.hasOwnProperty(e.type)?Zo[e.type](e,t):Pr(e,t)}function Xi(e){return[ie(e[1],e[0]),se(e[2])]}function Ke(e){var t=e[0],n=e[1],r=G(n);return[r*G(t),r*q(t),q(n)]}function Wn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function kr(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Ei(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Kn(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Ji(e){var t=Kt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var un,Cr,Nr,Dr,Rr,Or,Lr,Ur,Qi,Zi,ts,jl,Yl,wt,vt,xt,Ot={sphere:ct,point:Ys,lineStart:na,lineEnd:ra,polygonStart:function(){Ot.lineStart=fp,Ot.lineEnd=dp},polygonEnd:function(){Ot.lineStart=na,Ot.lineEnd=ra}};function Ys(e,t){e*=K,t*=K;var n=G(t);Un(n*G(e),n*q(e),q(t))}function Un(e,t,n){++un,Nr+=(e-Nr)/un,Dr+=(t-Dr)/un,Rr+=(n-Rr)/un}function na(){Ot.point=up}function up(e,t){e*=K,t*=K;var n=G(t);wt=n*G(e),vt=n*q(e),xt=q(t),Ot.point=hp,Un(wt,vt,xt)}function hp(e,t){e*=K,t*=K;var n=G(t),r=n*G(e),i=n*q(e),s=q(t),o=ie(Kt((o=vt*s-xt*i)*o+(o=xt*r-wt*s)*o+(o=wt*i-vt*r)*o),wt*r+vt*i+xt*s);Cr+=o,Or+=o*(wt+(wt=r)),Lr+=o*(vt+(vt=i)),Ur+=o*(xt+(xt=s)),Un(wt,vt,xt)}function ra(){Ot.point=Ys}function fp(){Ot.point=pp}function dp(){Wl(jl,Yl),Ot.point=Ys}function pp(e,t){jl=e,Yl=t,e*=K,t*=K,Ot.point=Wl;var n=G(t);wt=n*G(e),vt=n*q(e),xt=q(t),Un(wt,vt,xt)}function Wl(e,t){e*=K,t*=K;var n=G(t),r=n*G(e),i=n*q(e),s=q(t),o=vt*s-xt*i,a=xt*r-wt*s,l=wt*i-vt*r,u=Wi(o,a,l),h=se(u),c=u&&-h/u;Qi.add(c*o),Zi.add(c*a),ts.add(c*l),Cr+=h,Or+=h*(wt+(wt=r)),Lr+=h*(vt+(vt=i)),Ur+=h*(xt+(xt=s)),Un(wt,vt,xt)}function ia(e){un=Cr=Nr=Dr=Rr=Or=Lr=Ur=0,Qi=new Ut,Zi=new Ut,ts=new Ut,fe(e,Ot);var t=+Qi,n=+Zi,r=+ts,i=Wi(t,n,r);return i<Yi&&(t=Or,n=Lr,r=Ur,Cr<j&&(t=Nr,n=Dr,r=Rr),i=Wi(t,n,r),i<Yi)?[NaN,NaN]:[ie(n,t)*_t,se(r/i)*_t]}function es(e,t){function n(r,i){return r=e(r,i),t(r[0],r[1])}return e.invert&&t.invert&&(n.invert=function(r,i){return r=t.invert(r,i),r&&e.invert(r[0],r[1])}),n}function ns(e,t){return nt(e)>W&&(e-=Math.round(e/At)*At),[e,t]}ns.invert=ns;function Kl(e,t,n){return(e%=At)?t||n?es(oa(e),aa(t,n)):oa(e):t||n?aa(t,n):ns}function sa(e){return function(t,n){return t+=e,nt(t)>W&&(t-=Math.round(t/At)*At),[t,n]}}function oa(e){var t=sa(e);return t.invert=sa(-e),t}function aa(e,t){var n=G(e),r=q(e),i=G(t),s=q(t);function o(a,l){var u=G(l),h=G(a)*u,c=q(a)*u,f=q(l),d=f*n+h*r;return[ie(c*i-d*s,h*n-f*r),se(d*i+c*s)]}return o.invert=function(a,l){var u=G(l),h=G(a)*u,c=q(a)*u,f=q(l),d=f*i-c*s;return[ie(c*i+f*s,h*n+d*r),se(d*n-h*r)]},o}function Br(e){e=Kl(e[0]*K,e[1]*K,e.length>2?e[2]*K:0);function t(n){return n=e(n[0]*K,n[1]*K),n[0]*=_t,n[1]*=_t,n}return t.invert=function(n){return n=e.invert(n[0]*K,n[1]*K),n[0]*=_t,n[1]*=_t,n},t}function gp(e,t,n,r,i,s){if(n){var o=G(t),a=q(t),l=r*n;i==null?(i=t+r*At,s=t-l/2):(i=la(o,i),s=la(o,s),(r>0?i<s:i>s)&&(i+=r*At));for(var u,h=i;r>0?h>s:h<s;h-=l)u=Xi([o,-a*G(h),-a*q(h)]),e.point(u[0],u[1])}}function la(e,t){t=Ke(t),t[0]-=e,Ji(t);var n=cp(-t[1]);return((-t[2]<0?-n:n)+At-j)%At}function Xl(){var e=[],t;return{point:function(n,r,i){t.push([n,r,i])},lineStart:function(){e.push(t=[])},lineEnd:ct,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function hr(e,t){return nt(e[0]-t[0])<j&&nt(e[1]-t[1])<j}function Xn(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function Jl(e,t,n,r,i){var s=[],o=[],a,l;if(e.forEach(function(y){if(!((w=y.length-1)<=0)){var w,M=y[0],v=y[w],T;if(hr(M,v)){if(!M[2]&&!v[2]){for(i.lineStart(),a=0;a<w;++a)i.point((M=y[a])[0],M[1]);i.lineEnd();return}v[0]+=2*j}s.push(T=new Xn(M,y,null,!0)),o.push(T.o=new Xn(M,null,T,!1)),s.push(T=new Xn(v,y,null,!1)),o.push(T.o=new Xn(v,null,T,!0))}}),!!s.length){for(o.sort(t),ca(s),ca(o),a=0,l=o.length;a<l;++a)o[a].e=n=!n;for(var u=s[0],h,c;;){for(var f=u,d=!0;f.v;)if((f=f.n)===u)return;h=f.z,i.lineStart();do{if(f.v=f.o.v=!0,f.e){if(d)for(a=0,l=h.length;a<l;++a)i.point((c=h[a])[0],c[1]);else r(f.x,f.n.x,1,i);f=f.n}else{if(d)for(h=f.p.z,a=h.length-1;a>=0;--a)i.point((c=h[a])[0],c[1]);else r(f.x,f.p.x,-1,i);f=f.p}f=f.o,h=f.z,d=!d}while(!f.v);i.lineEnd()}}}function ca(e){if(t=e.length){for(var t,n=0,r=e[0],i;++n<t;)r.n=i=e[n],i.p=r,r=i;r.n=i=e[0],i.p=r}}function Mi(e){return nt(e[0])<=W?e[0]:lp(e[0])*((nt(e[0])+W)%At-W)}function mp(e,t){var n=Mi(t),r=t[1],i=q(r),s=[q(n),-G(n),0],o=0,a=0,l=new Ut;i===1?r=mt+j:i===-1&&(r=-mt-j);for(var u=0,h=e.length;u<h;++u)if(f=(c=e[u]).length)for(var c,f,d=c[f-1],y=Mi(d),w=d[1]/2+Qo,M=q(w),v=G(w),T=0;T<f;++T,y=b,M=R,v=L,d=A){var A=c[T],b=Mi(A),C=A[1]/2+Qo,R=q(C),L=G(C),O=b-y,N=O>=0?1:-1,U=N*O,I=U>W,F=M*R;if(l.add(ie(F*N*q(U),v*L+F*G(U))),o+=I?O+N*At:O,I^y>=n^b>=n){var _=kr(Ke(d),Ke(A));Ji(_);var p=kr(s,_);Ji(p);var m=(I^O>=0?-1:1)*se(p[2]);(r>m||r===m&&(_[0]||_[1]))&&(a+=I^O>=0?1:-1)}}return(o<-j||o<j&&l<-Yi)^a&1}function Ql(e,t,n,r){return function(i){var s=t(i),o=Xl(),a=t(o),l=!1,u,h,c,f={point:d,lineStart:w,lineEnd:M,polygonStart:function(){f.point=v,f.lineStart=T,f.lineEnd=A,h=[],u=[]},polygonEnd:function(){f.point=d,f.lineStart=w,f.lineEnd=M,h=dl(h);var b=mp(u,r);h.length?(l||(i.polygonStart(),l=!0),Jl(h,_p,b,n,i)):b&&(l||(i.polygonStart(),l=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),l&&(i.polygonEnd(),l=!1),h=u=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function d(b,C){e(b,C)&&i.point(b,C)}function y(b,C){s.point(b,C)}function w(){f.point=y,s.lineStart()}function M(){f.point=d,s.lineEnd()}function v(b,C){c.push([b,C]),a.point(b,C)}function T(){a.lineStart(),c=[]}function A(){v(c[0][0],c[0][1]),a.lineEnd();var b=a.clean(),C=o.result(),R,L=C.length,O,N,U;if(c.pop(),u.push(c),c=null,!!L){if(b&1){if(N=C[0],(O=N.length-1)>0){for(l||(i.polygonStart(),l=!0),i.lineStart(),R=0;R<O;++R)i.point((U=N[R])[0],U[1]);i.lineEnd()}return}L>1&&b&2&&C.push(C.pop().concat(C.shift())),h.push(C.filter(yp))}}return f}}function yp(e){return e.length>1}function _p(e,t){return((e=e.x)[0]<0?e[1]-mt-j:mt-e[1])-((t=t.x)[0]<0?t[1]-mt-j:mt-t[1])}const ua=Ql(function(){return!0},wp,xp,[-W,-mt]);function wp(e){var t=NaN,n=NaN,r=NaN,i;return{lineStart:function(){e.lineStart(),i=1},point:function(s,o){var a=s>0?W:-W,l=nt(s-t);nt(l-W)<j?(e.point(t,n=(n+o)/2>0?mt:-mt),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(a,n),e.point(s,n),i=0):r!==a&&l>=W&&(nt(t-r)<j&&(t-=r*j),nt(s-a)<j&&(s-=a*j),n=vp(t,n,s,o),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(a,n),i=0),e.point(t=s,n=o),r=a},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-i}}}function vp(e,t,n,r){var i,s,o=q(e-n);return nt(o)>j?ai((q(t)*(s=G(r))*q(n)-q(r)*(i=G(t))*q(e))/(i*s*o)):(t+r)/2}function xp(e,t,n,r){var i;if(e==null)i=n*mt,r.point(-W,i),r.point(0,i),r.point(W,i),r.point(W,0),r.point(W,-i),r.point(0,-i),r.point(-W,-i),r.point(-W,0),r.point(-W,i);else if(nt(e[0]-t[0])>j){var s=e[0]<t[0]?W:-W;i=n*s/2,r.point(-s,i),r.point(0,i),r.point(s,i)}else r.point(t[0],t[1])}function bp(e){var t=G(e),n=2*K,r=t>0,i=nt(t)>j;function s(h,c,f,d){gp(d,e,n,f,h,c)}function o(h,c){return G(h)*G(c)>t}function a(h){var c,f,d,y,w;return{lineStart:function(){y=d=!1,w=1},point:function(M,v){var T=[M,v],A,b=o(M,v),C=r?b?0:u(M,v):b?u(M+(M<0?W:-W),v):0;if(!c&&(y=d=b)&&h.lineStart(),b!==d&&(A=l(c,T),(!A||hr(c,A)||hr(T,A))&&(T[2]=1)),b!==d)w=0,b?(h.lineStart(),A=l(T,c),h.point(A[0],A[1])):(A=l(c,T),h.point(A[0],A[1],2),h.lineEnd()),c=A;else if(i&&c&&r^b){var R;!(C&f)&&(R=l(T,c,!0))&&(w=0,r?(h.lineStart(),h.point(R[0][0],R[0][1]),h.point(R[1][0],R[1][1]),h.lineEnd()):(h.point(R[1][0],R[1][1]),h.lineEnd(),h.lineStart(),h.point(R[0][0],R[0][1],3)))}b&&(!c||!hr(c,T))&&h.point(T[0],T[1]),c=T,d=b,f=C},lineEnd:function(){d&&h.lineEnd(),c=null},clean:function(){return w|(y&&d)<<1}}}function l(h,c,f){var d=Ke(h),y=Ke(c),w=[1,0,0],M=kr(d,y),v=Wn(M,M),T=M[0],A=v-T*T;if(!A)return!f&&h;var b=t*v/A,C=-t*T/A,R=kr(w,M),L=Kn(w,b),O=Kn(M,C);Ei(L,O);var N=R,U=Wn(L,N),I=Wn(N,N),F=U*U-I*(Wn(L,L)-1);if(!(F<0)){var _=Kt(F),p=Kn(N,(-U-_)/I);if(Ei(p,L),p=Xi(p),!f)return p;var m=h[0],g=c[0],x=h[1],k=c[1],P;g<m&&(P=m,m=g,g=P);var D=g-m,z=nt(D-W)<j,H=z||D<j;if(!z&&k<x&&(P=x,x=k,k=P),H?z?x+k>0^p[1]<(nt(p[0]-m)<j?x:k):x<=p[1]&&p[1]<=k:D>W^(m<=p[0]&&p[0]<=g)){var X=Kn(N,(-U+_)/I);return Ei(X,L),[p,Xi(X)]}}}function u(h,c){var f=r?e:W-e,d=0;return h<-f?d|=1:h>f&&(d|=2),c<-f?d|=4:c>f&&(d|=8),d}return Ql(o,a,s,r?[0,-e]:[-W,e-W])}function Sp(e,t,n,r,i,s){var o=e[0],a=e[1],l=t[0],u=t[1],h=0,c=1,f=l-o,d=u-a,y;if(y=n-o,!(!f&&y>0)){if(y/=f,f<0){if(y<h)return;y<c&&(c=y)}else if(f>0){if(y>c)return;y>h&&(h=y)}if(y=i-o,!(!f&&y<0)){if(y/=f,f<0){if(y>c)return;y>h&&(h=y)}else if(f>0){if(y<h)return;y<c&&(c=y)}if(y=r-a,!(!d&&y>0)){if(y/=d,d<0){if(y<h)return;y<c&&(c=y)}else if(d>0){if(y>c)return;y>h&&(h=y)}if(y=s-a,!(!d&&y<0)){if(y/=d,d<0){if(y>c)return;y>h&&(h=y)}else if(d>0){if(y<h)return;y<c&&(c=y)}return h>0&&(e[0]=o+h*f,e[1]=a+h*d),c<1&&(t[0]=o+c*f,t[1]=a+c*d),!0}}}}}var hn=1e9,Jn=-hn;function Ep(e,t,n,r){function i(u,h){return e<=u&&u<=n&&t<=h&&h<=r}function s(u,h,c,f){var d=0,y=0;if(u==null||(d=o(u,c))!==(y=o(h,c))||l(u,h)<0^c>0)do f.point(d===0||d===3?e:n,d>1?r:t);while((d=(d+c+4)%4)!==y);else f.point(h[0],h[1])}function o(u,h){return nt(u[0]-e)<j?h>0?0:3:nt(u[0]-n)<j?h>0?2:1:nt(u[1]-t)<j?h>0?1:0:h>0?3:2}function a(u,h){return l(u.x,h.x)}function l(u,h){var c=o(u,1),f=o(h,1);return c!==f?c-f:c===0?h[1]-u[1]:c===1?u[0]-h[0]:c===2?u[1]-h[1]:h[0]-u[0]}return function(u){var h=u,c=Xl(),f,d,y,w,M,v,T,A,b,C,R,L={point:O,lineStart:F,lineEnd:_,polygonStart:U,polygonEnd:I};function O(m,g){i(m,g)&&h.point(m,g)}function N(){for(var m=0,g=0,x=d.length;g<x;++g)for(var k=d[g],P=1,D=k.length,z=k[0],H,X,J=z[0],rt=z[1];P<D;++P)H=J,X=rt,z=k[P],J=z[0],rt=z[1],X<=r?rt>r&&(J-H)*(r-X)>(rt-X)*(e-H)&&++m:rt<=r&&(J-H)*(r-X)<(rt-X)*(e-H)&&--m;return m}function U(){h=c,f=[],d=[],R=!0}function I(){var m=N(),g=R&&m,x=(f=dl(f)).length;(g||x)&&(u.polygonStart(),g&&(u.lineStart(),s(null,null,1,u),u.lineEnd()),x&&Jl(f,a,m,s,u),u.polygonEnd()),h=u,f=d=y=null}function F(){L.point=p,d&&d.push(y=[]),C=!0,b=!1,T=A=NaN}function _(){f&&(p(w,M),v&&b&&c.rejoin(),f.push(c.result())),L.point=O,b&&h.lineEnd()}function p(m,g){var x=i(m,g);if(d&&y.push([m,g]),C)w=m,M=g,v=x,C=!1,x&&(h.lineStart(),h.point(m,g));else if(x&&b)h.point(m,g);else{var k=[T=Math.max(Jn,Math.min(hn,T)),A=Math.max(Jn,Math.min(hn,A))],P=[m=Math.max(Jn,Math.min(hn,m)),g=Math.max(Jn,Math.min(hn,g))];Sp(k,P,e,t,n,r)?(b||(h.lineStart(),h.point(k[0],k[1])),h.point(P[0],P[1]),x||h.lineEnd(),R=!1):x&&(h.lineStart(),h.point(m,g),R=!1)}T=m,A=g,b=x}return L}}var rs,is,fr,dr,Xe={sphere:ct,point:ct,lineStart:Mp,lineEnd:ct,polygonStart:ct,polygonEnd:ct};function Mp(){Xe.point=Ap,Xe.lineEnd=$p}function $p(){Xe.point=Xe.lineEnd=ct}function Ap(e,t){e*=K,t*=K,is=e,fr=q(t),dr=G(t),Xe.point=Ip}function Ip(e,t){e*=K,t*=K;var n=q(t),r=G(t),i=nt(e-is),s=G(i),o=q(i),a=r*o,l=dr*n-fr*r*s,u=fr*n+dr*r*s;rs.add(ie(Kt(a*a+l*l),u)),is=e,fr=n,dr=r}function Tp(e){return rs=new Ut,fe(e,Xe),+rs}var ss=[null,null],Pp={type:"LineString",coordinates:ss};function zr(e,t){return ss[0]=e,ss[1]=t,Tp(Pp)}function ha(e,t,n){var r=ze(e,t-j,n).concat(t);return function(i){return r.map(function(s){return[i,s]})}}function fa(e,t,n){var r=ze(e,t-j,n).concat(t);return function(i){return r.map(function(s){return[s,i]})}}function kp(){var e,t,n,r,i,s,o,a,l=10,u=l,h=90,c=360,f,d,y,w,M=2.5;function v(){return{type:"MultiLineString",coordinates:T()}}function T(){return ze(Yn(r/h)*h,n,h).map(y).concat(ze(Yn(a/c)*c,o,c).map(w)).concat(ze(Yn(t/l)*l,e,l).filter(function(A){return nt(A%h)>j}).map(f)).concat(ze(Yn(s/u)*u,i,u).filter(function(A){return nt(A%c)>j}).map(d))}return v.lines=function(){return T().map(function(A){return{type:"LineString",coordinates:A}})},v.outline=function(){return{type:"Polygon",coordinates:[y(r).concat(w(o).slice(1),y(n).reverse().slice(1),w(a).reverse().slice(1))]}},v.extent=function(A){return arguments.length?v.extentMajor(A).extentMinor(A):v.extentMinor()},v.extentMajor=function(A){return arguments.length?(r=+A[0][0],n=+A[1][0],a=+A[0][1],o=+A[1][1],r>n&&(A=r,r=n,n=A),a>o&&(A=a,a=o,o=A),v.precision(M)):[[r,a],[n,o]]},v.extentMinor=function(A){return arguments.length?(t=+A[0][0],e=+A[1][0],s=+A[0][1],i=+A[1][1],t>e&&(A=t,t=e,e=A),s>i&&(A=s,s=i,i=A),v.precision(M)):[[t,s],[e,i]]},v.step=function(A){return arguments.length?v.stepMajor(A).stepMinor(A):v.stepMinor()},v.stepMajor=function(A){return arguments.length?(h=+A[0],c=+A[1],v):[h,c]},v.stepMinor=function(A){return arguments.length?(l=+A[0],u=+A[1],v):[l,u]},v.precision=function(A){return arguments.length?(M=+A,f=ha(s,i,90),d=fa(t,e,M),y=ha(a,o,90),w=fa(r,n,M),v):M},v.extentMajor([[-180,-90+j],[180,90-j]]).extentMinor([[-180,-80-j],[180,80+j]])}const os=e=>e;var $i=new Ut,as=new Ut,Zl,tc,ls,cs,Zt={point:ct,lineStart:ct,lineEnd:ct,polygonStart:function(){Zt.lineStart=Cp,Zt.lineEnd=Dp},polygonEnd:function(){Zt.lineStart=Zt.lineEnd=Zt.point=ct,$i.add(nt(as)),as=new Ut},result:function(){var e=$i/2;return $i=new Ut,e}};function Cp(){Zt.point=Np}function Np(e,t){Zt.point=ec,Zl=ls=e,tc=cs=t}function ec(e,t){as.add(cs*e-ls*t),ls=e,cs=t}function Dp(){ec(Zl,tc)}var Je=1/0,Fr=Je,An=-Je,Hr=An,qr={point:Rp,lineStart:ct,lineEnd:ct,polygonStart:ct,polygonEnd:ct,result:function(){var e=[[Je,Fr],[An,Hr]];return An=Hr=-(Fr=Je=1/0),e}};function Rp(e,t){e<Je&&(Je=e),e>An&&(An=e),t<Fr&&(Fr=t),t>Hr&&(Hr=t)}var us=0,hs=0,fn=0,Gr=0,Vr=0,He=0,fs=0,ds=0,dn=0,nc,rc,Ft,Ht,Pt={point:ke,lineStart:da,lineEnd:pa,polygonStart:function(){Pt.lineStart=Up,Pt.lineEnd=Bp},polygonEnd:function(){Pt.point=ke,Pt.lineStart=da,Pt.lineEnd=pa},result:function(){var e=dn?[fs/dn,ds/dn]:He?[Gr/He,Vr/He]:fn?[us/fn,hs/fn]:[NaN,NaN];return us=hs=fn=Gr=Vr=He=fs=ds=dn=0,e}};function ke(e,t){us+=e,hs+=t,++fn}function da(){Pt.point=Op}function Op(e,t){Pt.point=Lp,ke(Ft=e,Ht=t)}function Lp(e,t){var n=e-Ft,r=t-Ht,i=Kt(n*n+r*r);Gr+=i*(Ft+e)/2,Vr+=i*(Ht+t)/2,He+=i,ke(Ft=e,Ht=t)}function pa(){Pt.point=ke}function Up(){Pt.point=zp}function Bp(){ic(nc,rc)}function zp(e,t){Pt.point=ic,ke(nc=Ft=e,rc=Ht=t)}function ic(e,t){var n=e-Ft,r=t-Ht,i=Kt(n*n+r*r);Gr+=i*(Ft+e)/2,Vr+=i*(Ht+t)/2,He+=i,i=Ht*e-Ft*t,fs+=i*(Ft+e),ds+=i*(Ht+t),dn+=i*3,ke(Ft=e,Ht=t)}function sc(e){this._context=e}sc.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,At);break}}},result:ct};var ps=new Ut,Ai,oc,ac,pn,gn,In={point:ct,lineStart:function(){In.point=Fp},lineEnd:function(){Ai&&lc(oc,ac),In.point=ct},polygonStart:function(){Ai=!0},polygonEnd:function(){Ai=null},result:function(){var e=+ps;return ps=new Ut,e}};function Fp(e,t){In.point=lc,oc=pn=e,ac=gn=t}function lc(e,t){pn-=e,gn-=t,ps.add(Kt(pn*pn+gn*gn)),pn=e,gn=t}let ga,jr,ma,ya;class _a{constructor(t){this._append=t==null?cc:Hp(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,n){switch(this._point){case 0:{this._append`M${t},${n}`,this._point=1;break}case 1:{this._append`L${t},${n}`;break}default:{if(this._append`M${t},${n}`,this._radius!==ma||this._append!==jr){const r=this._radius,i=this._;this._="",this._append`m0,${r}a${r},${r} 0 1,1 0,${-2*r}a${r},${r} 0 1,1 0,${2*r}z`,ma=r,jr=this._append,ya=this._,this._=i}this._+=ya;break}}}result(){const t=this._;return this._="",t.length?t:null}}function cc(e){let t=1;this._+=e[0];for(const n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function Hp(e){const t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return cc;if(t!==ga){const n=10**t;ga=t,jr=function(i){let s=1;this._+=i[0];for(const o=i.length;s<o;++s)this._+=Math.round(arguments[s]*n)/n+i[s]}}return jr}function Ws(e,t){let n=3,r=4.5,i,s;function o(a){return a&&(typeof r=="function"&&s.pointRadius(+r.apply(this,arguments)),fe(a,i(s))),s.result()}return o.area=function(a){return fe(a,i(Zt)),Zt.result()},o.measure=function(a){return fe(a,i(In)),In.result()},o.bounds=function(a){return fe(a,i(qr)),qr.result()},o.centroid=function(a){return fe(a,i(Pt)),Pt.result()},o.projection=function(a){return arguments.length?(i=a==null?(e=null,os):(e=a).stream,o):e},o.context=function(a){return arguments.length?(s=a==null?(t=null,new _a(n)):new sc(t=a),typeof r!="function"&&s.pointRadius(r),o):t},o.pointRadius=function(a){return arguments.length?(r=typeof a=="function"?a:(s.pointRadius(+a),+a),o):r},o.digits=function(a){if(!arguments.length)return n;if(a==null)n=null;else{const l=Math.floor(a);if(!(l>=0))throw new RangeError(`invalid digits: ${a}`);n=l}return t===null&&(s=new _a(n)),o},o.projection(e).digits(n).context(t)}function Ks(e){return function(t){var n=new gs;for(var r in e)n[r]=e[r];return n.stream=t,n}}function gs(){}gs.prototype={constructor:gs,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Xs(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),r!=null&&e.clipExtent(null),fe(n,e.stream(qr)),t(qr.result()),r!=null&&e.clipExtent(r),e}function uc(e,t,n){return Xs(e,function(r){var i=t[1][0]-t[0][0],s=t[1][1]-t[0][1],o=Math.min(i/(r[1][0]-r[0][0]),s/(r[1][1]-r[0][1])),a=+t[0][0]+(i-o*(r[1][0]+r[0][0]))/2,l=+t[0][1]+(s-o*(r[1][1]+r[0][1]))/2;e.scale(150*o).translate([a,l])},n)}function qp(e,t,n){return uc(e,[[0,0],t],n)}function Gp(e,t,n){return Xs(e,function(r){var i=+t,s=i/(r[1][0]-r[0][0]),o=(i-s*(r[1][0]+r[0][0]))/2,a=-s*r[0][1];e.scale(150*s).translate([o,a])},n)}function Vp(e,t,n){return Xs(e,function(r){var i=+t,s=i/(r[1][1]-r[0][1]),o=-s*r[0][0],a=(i-s*(r[1][1]+r[0][1]))/2;e.scale(150*s).translate([o,a])},n)}var wa=16,jp=G(30*K);function va(e,t){return+t?Wp(e,t):Yp(e)}function Yp(e){return Ks({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function Wp(e,t){function n(r,i,s,o,a,l,u,h,c,f,d,y,w,M){var v=u-r,T=h-i,A=v*v+T*T;if(A>4*t&&w--){var b=o+f,C=a+d,R=l+y,L=Kt(b*b+C*C+R*R),O=se(R/=L),N=nt(nt(R)-1)<j||nt(s-c)<j?(s+c)/2:ie(C,b),U=e(N,O),I=U[0],F=U[1],_=I-r,p=F-i,m=T*_-v*p;(m*m/A>t||nt((v*_+T*p)/A-.5)>.3||o*f+a*d+l*y<jp)&&(n(r,i,s,o,a,l,I,F,N,b/=L,C/=L,R,w,M),M.point(I,F),n(I,F,N,b,C,R,u,h,c,f,d,y,w,M))}}return function(r){var i,s,o,a,l,u,h,c,f,d,y,w,M={point:v,lineStart:T,lineEnd:b,polygonStart:function(){r.polygonStart(),M.lineStart=C},polygonEnd:function(){r.polygonEnd(),M.lineStart=T}};function v(O,N){O=e(O,N),r.point(O[0],O[1])}function T(){c=NaN,M.point=A,r.lineStart()}function A(O,N){var U=Ke([O,N]),I=e(O,N);n(c,f,h,d,y,w,c=I[0],f=I[1],h=O,d=U[0],y=U[1],w=U[2],wa,r),r.point(c,f)}function b(){M.point=v,r.lineEnd()}function C(){T(),M.point=R,M.lineEnd=L}function R(O,N){A(i=O,N),s=c,o=f,a=d,l=y,u=w,M.point=A}function L(){n(c,f,h,d,y,w,s,o,i,a,l,u,wa,r),M.lineEnd=b,b()}return M}}var Kp=Ks({point:function(e,t){this.stream.point(e*K,t*K)}});function Xp(e){return Ks({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}function Jp(e,t,n,r,i){function s(o,a){return o*=r,a*=i,[t+e*o,n-e*a]}return s.invert=function(o,a){return[(o-t)/e*r,(n-a)/e*i]},s}function xa(e,t,n,r,i,s){if(!s)return Jp(e,t,n,r,i);var o=G(s),a=q(s),l=o*e,u=a*e,h=o/e,c=a/e,f=(a*n-o*t)/e,d=(a*t+o*n)/e;function y(w,M){return w*=r,M*=i,[l*w-u*M+t,n-u*w-l*M]}return y.invert=function(w,M){return[r*(h*w-c*M+f),i*(d-c*w-h*M)]},y}function Js(e){return Qp(function(){return e})()}function Qp(e){var t,n=150,r=480,i=250,s=0,o=0,a=0,l=0,u=0,h,c=0,f=1,d=1,y=null,w=ua,M=null,v,T,A,b=os,C=.5,R,L,O,N,U;function I(m){return O(m[0]*K,m[1]*K)}function F(m){return m=O.invert(m[0],m[1]),m&&[m[0]*_t,m[1]*_t]}I.stream=function(m){return N&&U===m?N:N=Kp(Xp(h)(w(R(b(U=m)))))},I.preclip=function(m){return arguments.length?(w=m,y=void 0,p()):w},I.postclip=function(m){return arguments.length?(b=m,M=v=T=A=null,p()):b},I.clipAngle=function(m){return arguments.length?(w=+m?bp(y=m*K):(y=null,ua),p()):y*_t},I.clipExtent=function(m){return arguments.length?(b=m==null?(M=v=T=A=null,os):Ep(M=+m[0][0],v=+m[0][1],T=+m[1][0],A=+m[1][1]),p()):M==null?null:[[M,v],[T,A]]},I.scale=function(m){return arguments.length?(n=+m,_()):n},I.translate=function(m){return arguments.length?(r=+m[0],i=+m[1],_()):[r,i]},I.center=function(m){return arguments.length?(s=m[0]%360*K,o=m[1]%360*K,_()):[s*_t,o*_t]},I.rotate=function(m){return arguments.length?(a=m[0]%360*K,l=m[1]%360*K,u=m.length>2?m[2]%360*K:0,_()):[a*_t,l*_t,u*_t]},I.angle=function(m){return arguments.length?(c=m%360*K,_()):c*_t},I.reflectX=function(m){return arguments.length?(f=m?-1:1,_()):f<0},I.reflectY=function(m){return arguments.length?(d=m?-1:1,_()):d<0},I.precision=function(m){return arguments.length?(R=va(L,C=m*m),p()):Kt(C)},I.fitExtent=function(m,g){return uc(I,m,g)},I.fitSize=function(m,g){return qp(I,m,g)},I.fitWidth=function(m,g){return Gp(I,m,g)},I.fitHeight=function(m,g){return Vp(I,m,g)};function _(){var m=xa(n,0,0,f,d,c).apply(null,t(s,o)),g=xa(n,r-m[0],i-m[1],f,d,c);return h=Kl(a,l,u),L=es(t,g),O=es(h,L),R=va(L,C),p()}function p(){return N=U=null,I}return function(){return t=e.apply(this,arguments),I.invert=t.invert&&F,_()}}function hc(e){return function(t,n){var r=Kt(t*t+n*n),i=e(r),s=q(i),o=G(i);return[ie(t*s,r*o),se(r&&n*s/r)]}}function Qs(e,t){return[e,Gl(Vl((mt+t)/2))]}Qs.invert=function(e,t){return[e,2*ai(ql(t))-mt]};function Zp(){return fc(Qs).scale(961/At)}function fc(e){var t=Js(e),n=t.center,r=t.scale,i=t.translate,s=t.clipExtent,o=null,a,l,u;t.scale=function(c){return arguments.length?(r(c),h()):r()},t.translate=function(c){return arguments.length?(i(c),h()):i()},t.center=function(c){return arguments.length?(n(c),h()):n()},t.clipExtent=function(c){return arguments.length?(c==null?o=a=l=u=null:(o=+c[0][0],a=+c[0][1],l=+c[1][0],u=+c[1][1]),h()):o==null?null:[[o,a],[l,u]]};function h(){var c=W*r(),f=t(Br(t.rotate()).invert([0,0]));return s(o==null?[[f[0]-c,f[1]-c],[f[0]+c,f[1]+c]]:e===Qs?[[Math.max(f[0]-c,o),a],[Math.min(f[0]+c,l),u]]:[[o,Math.max(f[1]-c,a)],[l,Math.min(f[1]+c,u)]])}return h()}function dc(e,t){return[G(t)*q(e),q(t)]}dc.invert=hc(se);function tg(){return Js(dc).scale(249.5).clipAngle(90+j)}function pc(e,t){var n=G(t),r=1+G(e)*n;return[n*q(e)/r,q(t)/r]}pc.invert=hc(function(e){return 2*ai(e)});function gc(){return Js(pc).scale(250).clipAngle(142)}function mc(e,t){return[Gl(Vl((mt+t)/2)),-e]}mc.invert=function(e,t){return[-t,2*ai(ql(e))-mt]};function eg(){var e=fc(mc),t=e.center,n=e.rotate;return e.center=function(r){return arguments.length?t([-r[1],r[0]]):(r=t(),[r[1],-r[0]])},e.rotate=function(r){return arguments.length?n([r[0],r[1],r.length>2?r[2]+90:90]):(r=n(),[r[0],r[1],r[2]-90])},n([0,0,90]).scale(159.155)}const Qn=e=>()=>e;function ng(e,{sourceEvent:t,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function te(e,t,n){this.k=e,this.x=t,this.y=n}te.prototype={constructor:te,scale:function(e){return e===1?this:new te(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new te(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var yc=new te(1,0,0);te.prototype;function Ii(e){e.stopImmediatePropagation()}function on(e){e.preventDefault(),e.stopImmediatePropagation()}function rg(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function ig(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function ba(){return this.__zoom||yc}function sg(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function og(){return navigator.maxTouchPoints||"ontouchstart"in this}function ag(e,t,n){var r=e.invertX(t[0][0])-n[0][0],i=e.invertX(t[1][0])-n[1][0],s=e.invertY(t[0][1])-n[0][1],o=e.invertY(t[1][1])-n[1][1];return e.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function lg(){var e=rg,t=ig,n=ag,r=sg,i=og,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,l=x0,u=ni("start","zoom","end"),h,c,f,d=500,y=150,w=0,M=10;function v(p){p.property("__zoom",ba).on("wheel.zoom",O,{passive:!1}).on("mousedown.zoom",N).on("dblclick.zoom",U).filter(i).on("touchstart.zoom",I).on("touchmove.zoom",F).on("touchend.zoom touchcancel.zoom",_).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}v.transform=function(p,m,g,x){var k=p.selection?p.selection():p;k.property("__zoom",ba),p!==k?C(p,m,g,x):k.interrupt().each(function(){R(this,arguments).event(x).start().zoom(null,typeof m=="function"?m.apply(this,arguments):m).end()})},v.scaleBy=function(p,m,g,x){v.scaleTo(p,function(){var k=this.__zoom.k,P=typeof m=="function"?m.apply(this,arguments):m;return k*P},g,x)},v.scaleTo=function(p,m,g,x){v.transform(p,function(){var k=t.apply(this,arguments),P=this.__zoom,D=g==null?b(k):typeof g=="function"?g.apply(this,arguments):g,z=P.invert(D),H=typeof m=="function"?m.apply(this,arguments):m;return n(A(T(P,H),D,z),k,o)},g,x)},v.translateBy=function(p,m,g,x){v.transform(p,function(){return n(this.__zoom.translate(typeof m=="function"?m.apply(this,arguments):m,typeof g=="function"?g.apply(this,arguments):g),t.apply(this,arguments),o)},null,x)},v.translateTo=function(p,m,g,x,k){v.transform(p,function(){var P=t.apply(this,arguments),D=this.__zoom,z=x==null?b(P):typeof x=="function"?x.apply(this,arguments):x;return n(yc.translate(z[0],z[1]).scale(D.k).translate(typeof m=="function"?-m.apply(this,arguments):-m,typeof g=="function"?-g.apply(this,arguments):-g),P,o)},x,k)};function T(p,m){return m=Math.max(s[0],Math.min(s[1],m)),m===p.k?p:new te(m,p.x,p.y)}function A(p,m,g){var x=m[0]-g[0]*p.k,k=m[1]-g[1]*p.k;return x===p.x&&k===p.y?p:new te(p.k,x,k)}function b(p){return[(+p[0][0]+ +p[1][0])/2,(+p[0][1]+ +p[1][1])/2]}function C(p,m,g,x){p.on("start.zoom",function(){R(this,arguments).event(x).start()}).on("interrupt.zoom end.zoom",function(){R(this,arguments).event(x).end()}).tween("zoom",function(){var k=this,P=arguments,D=R(k,P).event(x),z=t.apply(k,P),H=g==null?b(z):typeof g=="function"?g.apply(k,P):g,X=Math.max(z[1][0]-z[0][0],z[1][1]-z[0][1]),J=k.__zoom,rt=typeof m=="function"?m.apply(k,P):m,Xt=l(J.invert(H).concat(X/J.k),rt.invert(H).concat(X/rt.k));return function(kt){if(kt===1)kt=rt;else{var Jt=Xt(kt),mi=X/Jt[2];kt=new te(mi,H[0]-Jt[0]*mi,H[1]-Jt[1]*mi)}D.zoom(null,kt)}})}function R(p,m,g){return!g&&p.__zooming||new L(p,m)}function L(p,m){this.that=p,this.args=m,this.active=0,this.sourceEvent=null,this.extent=t.apply(p,m),this.taps=0}L.prototype={event:function(p){return p&&(this.sourceEvent=p),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(p,m){return this.mouse&&p!=="mouse"&&(this.mouse[1]=m.invert(this.mouse[0])),this.touch0&&p!=="touch"&&(this.touch0[1]=m.invert(this.touch0[0])),this.touch1&&p!=="touch"&&(this.touch1[1]=m.invert(this.touch1[0])),this.that.__zoom=m,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(p){var m=Dt(this.that).datum();u.call(p,this.that,new ng(p,{sourceEvent:this.sourceEvent,target:v,transform:this.that.__zoom,dispatch:u}),m)}};function O(p,...m){if(!e.apply(this,arguments))return;var g=R(this,m).event(p),x=this.__zoom,k=Math.max(s[0],Math.min(s[1],x.k*Math.pow(2,r.apply(this,arguments)))),P=zt(p);if(g.wheel)(g.mouse[0][0]!==P[0]||g.mouse[0][1]!==P[1])&&(g.mouse[1]=x.invert(g.mouse[0]=P)),clearTimeout(g.wheel);else{if(x.k===k)return;g.mouse=[P,x.invert(P)],ur(this),g.start()}on(p),g.wheel=setTimeout(D,y),g.zoom("mouse",n(A(T(x,k),g.mouse[0],g.mouse[1]),g.extent,o));function D(){g.wheel=null,g.end()}}function N(p,...m){if(f||!e.apply(this,arguments))return;var g=p.currentTarget,x=R(this,m,!0).event(p),k=Dt(p.view).on("mousemove.zoom",H,!0).on("mouseup.zoom",X,!0),P=zt(p,g),D=p.clientX,z=p.clientY;Al(p.view),Ii(p),x.mouse=[P,this.__zoom.invert(P)],ur(this),x.start();function H(J){if(on(J),!x.moved){var rt=J.clientX-D,Xt=J.clientY-z;x.moved=rt*rt+Xt*Xt>w}x.event(J).zoom("mouse",n(A(x.that.__zoom,x.mouse[0]=zt(J,g),x.mouse[1]),x.extent,o))}function X(J){k.on("mousemove.zoom mouseup.zoom",null),Il(J.view,x.moved),on(J),x.event(J).end()}}function U(p,...m){if(e.apply(this,arguments)){var g=this.__zoom,x=zt(p.changedTouches?p.changedTouches[0]:p,this),k=g.invert(x),P=g.k*(p.shiftKey?.5:2),D=n(A(T(g,P),x,k),t.apply(this,m),o);on(p),a>0?Dt(this).transition().duration(a).call(C,D,x,p):Dt(this).call(v.transform,D,x,p)}}function I(p,...m){if(e.apply(this,arguments)){var g=p.touches,x=g.length,k=R(this,m,p.changedTouches.length===x).event(p),P,D,z,H;for(Ii(p),D=0;D<x;++D)z=g[D],H=zt(z,this),H=[H,this.__zoom.invert(H),z.identifier],k.touch0?!k.touch1&&k.touch0[2]!==H[2]&&(k.touch1=H,k.taps=0):(k.touch0=H,P=!0,k.taps=1+!!h);h&&(h=clearTimeout(h)),P&&(k.taps<2&&(c=H[0],h=setTimeout(function(){h=null},d)),ur(this),k.start())}}function F(p,...m){if(this.__zooming){var g=R(this,m).event(p),x=p.changedTouches,k=x.length,P,D,z,H;for(on(p),P=0;P<k;++P)D=x[P],z=zt(D,this),g.touch0&&g.touch0[2]===D.identifier?g.touch0[0]=z:g.touch1&&g.touch1[2]===D.identifier&&(g.touch1[0]=z);if(D=g.that.__zoom,g.touch1){var X=g.touch0[0],J=g.touch0[1],rt=g.touch1[0],Xt=g.touch1[1],kt=(kt=rt[0]-X[0])*kt+(kt=rt[1]-X[1])*kt,Jt=(Jt=Xt[0]-J[0])*Jt+(Jt=Xt[1]-J[1])*Jt;D=T(D,Math.sqrt(kt/Jt)),z=[(X[0]+rt[0])/2,(X[1]+rt[1])/2],H=[(J[0]+Xt[0])/2,(J[1]+Xt[1])/2]}else if(g.touch0)z=g.touch0[0],H=g.touch0[1];else return;g.zoom("touch",n(A(D,z,H),g.extent,o))}}function _(p,...m){if(this.__zooming){var g=R(this,m).event(p),x=p.changedTouches,k=x.length,P,D;for(Ii(p),f&&clearTimeout(f),f=setTimeout(function(){f=null},d),P=0;P<k;++P)D=x[P],g.touch0&&g.touch0[2]===D.identifier?delete g.touch0:g.touch1&&g.touch1[2]===D.identifier&&delete g.touch1;if(g.touch1&&!g.touch0&&(g.touch0=g.touch1,delete g.touch1),g.touch0)g.touch0[1]=this.__zoom.invert(g.touch0[0]);else if(g.end(),g.taps===2&&(D=zt(D,this),Math.hypot(c[0]-D[0],c[1]-D[1])<M)){var z=Dt(this).on("dblclick.zoom");z&&z.apply(this,arguments)}}}return v.wheelDelta=function(p){return arguments.length?(r=typeof p=="function"?p:Qn(+p),v):r},v.filter=function(p){return arguments.length?(e=typeof p=="function"?p:Qn(!!p),v):e},v.touchable=function(p){return arguments.length?(i=typeof p=="function"?p:Qn(!!p),v):i},v.extent=function(p){return arguments.length?(t=typeof p=="function"?p:Qn([[+p[0][0],+p[0][1]],[+p[1][0],+p[1][1]]]),v):t},v.scaleExtent=function(p){return arguments.length?(s[0]=+p[0],s[1]=+p[1],v):[s[0],s[1]]},v.translateExtent=function(p){return arguments.length?(o[0][0]=+p[0][0],o[1][0]=+p[1][0],o[0][1]=+p[0][1],o[1][1]=+p[1][1],v):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},v.constrain=function(p){return arguments.length?(n=p,v):n},v.duration=function(p){return arguments.length?(a=+p,v):a},v.interpolate=function(p){return arguments.length?(l=p,v):l},v.on=function(){var p=u.on.apply(u,arguments);return p===u?v:p},v.clickDistance=function(p){return arguments.length?(w=(p=+p)*p,v):Math.sqrt(w)},v.tapDistance=function(p){return arguments.length?(M=+p,v):M},v}function li(){return{systemMap:new Map,laneMap:new Map,neighborMap:new Map}}function _c(e,t){e.systemMap.set(t.id,t)}function ms(e,t,n){const r=[t.id,n.id].sort((s,o)=>s.localeCompare(o)).join("-");if(e.laneMap.has(r))return;const i={id:r,fromId:t.id,toId:n.id,movement:[0,0]};e.laneMap.set(r,i)}function ci(e){const t=new Map;for(const n of e.laneMap.values())t.has(n.fromId)||t.set(n.fromId,[]),t.get(n.fromId)?.push(n.toId),t.has(n.toId)||t.set(n.toId,[]),t.get(n.toId)?.push(n.fromId);e.neighborMap=t}function Et(e,t){const n=e.systemMap.get(t);if(!n)return[];(!e.neighborMap||e.neighborMap.size===0)&&ci(e);const r=e.neighborMap.get(n.id);return r?r.map(i=>e.systemMap.get(i)).filter(i=>!!i):[]}function ui(e,t,n){return e.neighborMap.get(t)?.includes(n)||!1}function wc(e,t){return Zs(t,Array.from(e.systemMap.values()))}function Zs(e,t){if(t.length===0)return null;let n=null,r=1/0;return t.forEach(i=>{if(i.location[0]===e[0]&&i.location[1]===e[1])return;const s=zr(e,i.location);s<r&&(r=s,n=i)}),n}function cg(e){console.log("Loading world from JSON...",e);const t=li();return t.systemMap=new Map(e.systems),t.laneMap=new Map(e.lanes),ci(t),t}function ug(e){return{systems:Array.from(e.systemMap.entries()),lanes:Array.from(e.laneMap.entries())}}const Sa=["Commander","Admiral","Marshal","Commodore","General","Colonel","Warden","Sentinel","Vanguard","Overseer","Legate","Centurion","Praetor","Brigadier","Ambassador","Director","Chancellor","Prefect"],Ea=["Raxis","Vex","Thane","Zephyr","Korr","Lyra","Dax","Kael","Nova","Orion","Astra","Cade","Ryker","Vega","Nyx","Crusher","Wheaton","Szilard","Coloma"];function ys(){const e=Sa[Math.floor(Math.random()*Sa.length)],t=Ea[Math.floor(Math.random()*Ea.length)];return`${e}-${t}`}function vc(){return{playerName:ys(),numBots:0,fow:Qu,numSystems:Zu,timeScale:1}}function to(){return{world:li(),playerMap:new Map}}function xc(e,t){e.playerMap.set(t.id,t)}function eo(e){const{C:t}=globalThis.gameManager.getFnContext();if(!t.playerId)return null;for(const n of e.world.systemMap.values())if(n.homeworld===t.playerId)return n;return null}function hi(e,t){const{P:n}=globalThis.gameManager.getFnContext();if(!n)return;n.revealedSystems.add(t.id),n.visitedSystems.add(t.id);const r=Et(e.world,t.id);if(r)return r.forEach(i=>n.revealedSystems.add(i.id)),e}function bc(e){const{P:t}=globalThis.gameManager.getFnContext();if(t)for(const n of e.world.systemMap.values())t.revealedSystems.add(n.id)}function Sc(e,t,n,r,i){e.moveQueue.push({ships:n,toId:t.id,fromId:e.id,playerId:r,message:i})}function Ec(e,t,n,r){if(r!==0){if(r<0){if(t.ownerId!==n.ownerId)return;const i=t;t=n,n=i,r=-r}t.ships<r||(n.ownerId===t.ownerId?dg(e,t,n,r):hg(e,t,n,r))}}function hg(e,t,n,r){const i=t.ownerId,s=n.ships??0;if($c(e.S.world,t,n,r),r>s){const o=r-s;t.ships=t.ships-r,n.ships=o,fg(e,i,n)}else t.ships=t.ships-r,n.ships=s-r}function fg(e,t,n){n.ownerId=t,n.moveQueue=[],t===e.C.playerId&&hi(e.S,n),n.homeworld&&n.homeworld!==t&&Mc(e,n.homeworld,t)}function Mc({S:e,E:t,C:n},r,i=null){for(const o of e.world.systemMap.values())o.ownerId===r&&(o.ownerId=i,o.ships=Math.max(Math.floor((o.ships??0)/2),1),o.homeworld=null,o.moveQueue=[],i===n.playerId&&hi(e,o)),o.homeworld===r&&(o.homeworld=null);const s=e.playerMap.get(r);s.isAlive=!1,t.emit("PLAYER_ELIMINATED",{loserId:r,winnerId:i})}function $c(e,t,n,r){t.movement=[t.movement[0],t.movement[1]+r],n.movement=[n.movement[0]+r,n.movement[1]];for(const i of e.laneMap.values())i.fromId===t.id&&i.toId===n.id?i.movement=[i.movement[0]+r,i.movement[1]]:i.fromId===n.id&&i.toId===t.id&&(i.movement=[i.movement[0],i.movement[1]+r])}function dg({S:e,C:t},n,r,i){n.ships<i||(n.ships-=i,r.ships+=i,$c(e.world,n,r,i),r.ownerId===t.playerId&&hi(e,r))}function Ac(e){for(const t of e.S.world.systemMap.values())for(t.lastMove=null;t.moveQueue.length>0;){const n=t.moveQueue.shift();n&&Ic(e,n)}}function Ic(e,t){t.playerId===e.C.playerId&&je(`player move: ${JSON.stringify(t)}`);const n=e.S.world.systemMap.get(t.fromId),r=e.S.world.systemMap.get(t.toId);Ec(e,n,r,t.ships),n.lastMove=t,e.E.emit("MAKE_MOVE",t)}function pg(e,t){const n=Tc(e.S,t);n&&Ic(e,n)}function gg(e,t){const n=e.world.systemMap.get(t.fromId);return!(n.ownerId!==t.playerId||!ui(e.world,t.fromId,t.toId)||n.ships<=1)}function Tc(e,t){if(!gg(e,t))return null;switch(t.type){case"MASS_MOVE":return n(t.fromId,t.toId);case"BALANCED_MOVE":return r(t.fromId,t.toId)}return null;function n(i,s){const{C:o}=globalThis.gameManager.getFnContext(),l=e.world.systemMap.get(i).ships-1;return l<=0?null:{message:`Move ${l} ships from ${i} to ${s}`,ships:l,toId:s,fromId:i,playerId:o.playerId}}function r(i,s){const{C:o}=globalThis.gameManager.getFnContext(),a=e.world.systemMap.get(i),l=e.world.systemMap.get(s),u=l.ownerId===a.ownerId?Math.floor((a.ships-l.ships)/2):Math.floor(a.ships/2);return u<=0?null:{message:`Move ${u} ships from ${a.id} to ${l.id}`,ships:u,toId:l.id,fromId:a.id,playerId:o.playerId}}}const Zn=100,Ti={territory:{aggression:.3,expansion:1,defensiveness:.5,riskTolerance:.4,speed:Zn},rusher:{aggression:1,expansion:.4,defensiveness:.1,riskTolerance:.7,speed:Zn},turtle:{aggression:.1,expansion:.3,defensiveness:.95,riskTolerance:.2,speed:Zn},balanced:{aggression:.5,expansion:.5,defensiveness:.5,riskTolerance:.5,speed:Zn}};function mg({S:e}){for(const t of e.playerMap.values())t.bot?.makeMoves()}let yg=0;class _g{constructor(t={}){this.queuedMoves=0,this.threatLevels=new Map,this.frontline=new Set,this.backline=new Set;const n=t.playerIndex??yg++;this.id=t.id??`${n}`;let r=t.personality;if(!r){const i=Object.keys(Ti);r=i[n%i.length]}this.name=t.name??r,this.personality=r==="idle"?Ti.balanced:Ti[r]}makeMoves(){if(this.name==="idle")return;const n=gameManager.getState().world.systemMap.values();if(this.botSystems=Array.from(n).filter(l=>l.ownerId===this.id),this.botSystems.length===0)return;for(const l of this.botSystems)l.moveQueue=[];this.queuedMoves=0,this.analyzeMap();const r=this.getDefensiveMoves();if(this.chooseMoves(r,1-this.personality.defensiveness),this.queuedMoves>=this.personality.speed)return;const i=this.getCoordinatedAttackMoves();if(this.chooseMoves(i,this.personality.aggression),this.queuedMoves>=this.personality.speed)return;const s=this.getExterminateMoves();if(this.chooseMoves(s,this.personality.defensiveness),this.queuedMoves>=this.personality.speed)return;const o=this.getExploreMoves();if(this.chooseMoves(o,this.personality.expansion),this.queuedMoves>=this.personality.speed)return;const a=this.getLogisticsMoves();this.chooseMoves(a,1),this.queuedMoves>=this.personality.speed}analyzeMap(){this.threatLevels.clear(),this.frontline.clear(),this.backline.clear();const t=gameManager.getState();this.botSystems.forEach(n=>{const r=Et(t.world,n.id),i=r.filter(a=>a.ownerId&&a.ownerId!==this.id),s=r.filter(a=>!a.ownerId),o=i.reduce((a,l)=>a+l.ships,0);this.threatLevels.set(n.id,o),i.length>0||s.length>0?this.frontline.add(n.id):this.backline.add(n.id)})}getDefensiveMoves(){const t=gameManager.getState();return this.botSystems.map(n=>{if(n.moveQueue.length>0)return[];const r=[],i=this.threatLevels.get(n.id)??0;if(i>0){const s=i*1.1;if(n.ships<s)if(n.ships<i*.5){const o=Et(t.world,n.id).filter(a=>a.ownerId===this.id).sort((a,l)=>(this.threatLevels.get(a.id)||0)-(this.threatLevels.get(l.id)||0))[0];o&&r.push({message:`Retreating from ${n.id}`,from:n,to:o,units:n.ships-1,score:1e3})}else r.push({message:`Holding ${n.id}`,from:n,to:n,units:0,score:i});else n.ships<s*1.5&&r.push({message:`Defending ${n.id} from threat level ${i}`,from:n,to:n,units:0,score:i})}return r})}getCoordinatedAttackMoves(){const t=gameManager.getState(),n=new Map;this.botSystems.forEach(i=>{if(i.moveQueue.length>0||i.ships<5)return;const s=Et(t.world,i.id);s&&s.forEach(o=>{if(o.ownerId!==null&&o.ownerId!==this.id){if(Et(t.world,i.id).filter(l=>l.ownerId&&l.ownerId!==this.id&&l.id!==o.id).length>0)return;n.has(o.id)||n.set(o.id,{target:o,attackers:[]}),n.get(o.id).attackers.push(i)}})});const r=[];return n.forEach(({target:i,attackers:s})=>{const a=Et(t.world,i.id).filter(c=>c.ownerId===i.ownerId).length===0?1.5:1,l=s.reduce((c,f)=>{const d=this.threatLevels.get(f.id)||0,y=Math.max(0,f.ships-d*1.1);return c+Math.floor(y*(1-this.personality.defensiveness))},0),h=(i.ships+(i.homeworld?10:0))*(1.3-this.personality.riskTolerance);l>h&&s.forEach(c=>{if(c.moveQueue.length>0)return;const f=this.threatLevels.get(c.id)||0,d=Math.max(0,c.ships-f*1.1),y=Math.floor(d*(1-this.personality.defensiveness)),w=this.getBestMoveAmount(c,i,y);w>0&&r.push([{message:`Coordinated attack on ${i.id}`,from:c,to:i,units:w,score:(100+(i.homeworld?50:0))*a}])})}),r}getExterminateMoves(){const t=gameManager.getState();return this.botSystems.map(n=>n.moveQueue.length>0?[]:n.ships<3?[]:Et(t.world,n.id).flatMap(i=>{if(i.ownerId===this.id)return[];if(i.ownerId===null&&i.type==="UNINHABITED")return[];if(n.ships>i.ships*1.5+5){const s=n.ships-2;return[{message:`Crushing weak neighbor ${i.id}`,from:n,to:i,units:s,score:40}]}return[]}))}getExploreMoves(){const t=gameManager.getState();return this.botSystems.map(n=>n.moveQueue.length>0?[]:n.ships<2?[]:Et(t.world,n.id).flatMap(i=>{if(i.ownerId!==null)return[];if(i.type==="INHABITED")return[];const s=Math.max(1,Math.floor(n.ships*.3));return[{message:`Exploring ${i.id}`,from:n,to:i,units:s,score:30}]}))}getLogisticsMoves(){const t=gameManager.getState();return this.botSystems.map(n=>{if(n.moveQueue.length>0)return[];if(n.ships<2)return[];if(this.backline.has(n.id)){const r=Et(t.world,n.id).filter(o=>this.frontline.has(o.id)&&o.ownerId===this.id);if(r.length>0){const o=r.sort((a,l)=>a.ships-l.ships)[0];return[{message:"Logistics: Frontline Support",from:n,to:o,units:n.ships-1,score:10}]}const s=Et(t.world,n.id).filter(o=>o.ownerId===this.id).sort((o,a)=>o.ships-a.ships)[0];if(s&&s.ships<n.ships-2)return[{message:"Logistics: Balancing",from:n,to:s,units:Math.floor((n.ships-s.ships)/2),score:5}]}if(this.frontline.has(n.id)){const r=Et(t.world,n.id).filter(i=>i.ownerId===this.id&&(this.threatLevels.get(i.id)||0)>i.ships);if(r.length>0&&(this.threatLevels.get(n.id)||0)<n.ships){const i=r[0];return[{message:"Logistics: Emergency Reinforce",from:n,to:i,units:Math.floor(n.ships/2),score:50}]}}return[]})}getBestMoveAmount(t,n,r){const i=Math.max(0,t.ships-1);let s=0;return n.ownerId===t.ownerId?s=Math.floor((t.ships-n.ships)/2):s=Math.floor(t.ships/2),s=Math.max(0,s),Math.abs(i-r)<Math.abs(s-r)?i:s}chooseMoves(t,n=1){if(t.length===0)return;const r=t.flat().sort(wg);for(const i of r){if(this.queuedMoves>=this.personality.speed)return;if(Math.random()<n){if(i.from.moveQueue.length>0)continue;Sc(i.from,i.to,i.units,this.id,i.message),i.units>0&&this.queuedMoves++}}}}function wg(e,t){return e.score!==t.score?t.score-e.score:Math.random()-.5}const Q={GAME_INIT:"GAME_INIT",GAME_START:"GAME_START",GAME_TICK:"GAME_TICK",GAME_STOP:"GAME_STOP",STATE_UPDATED:"STATE_UPDATED",CONFIG_UPDATED:"CONFIG_UPDATED",MESSAGES_UPDATED:"MESSAGES_UPDATED",PLAYER_JOINED:"PLAYER_JOINED",PLAYER_REMOVED:"PLAYER_REMOVED",PLAYER_UPDATED:"PLAYER_UPDATED",PLAYER_ELIMINATED:"PLAYER_ELIMINATED",PLAYER_WIN:"PLAYER_WIN",PLAYER_AUTH_UPDATED:"PLAYER_AUTH_UPDATED",LEADERBOARD_UPDATED:"LEADERBOARD_UPDATED",TAKE_ORDER:"TAKE_ORDER"};function Pc(e){for(const t of e.playerMap.values()){const n={playerId:t.id,systems:0,ships:0,homeworld:0};for(const r of e.world.systemMap.values())r.ownerId===t.id&&(n.systems+=1,n.ships+=r.ships??0,r.homeworld===t.id&&(n.homeworld=r.ships??0));t.stats=n}}function kc(e){for(const t of e.world.systemMap.values())t.type==="INHABITED"&&(t.ownerId||t.ships<ll)&&(t.ships=(t.ships??0)+Xu)}function Cc(e){for(const t of e.world.systemMap.values())t.ownerId!=null&&(t.ships=(t.ships??0)+Ju)}function vg({S:e,C:t,E:n,P:r}){if(t.status==="PLAYING"&&r)if(e.playerMap.size>1){const i=Array.from(e.playerMap.values());if(i.reduce((o,a)=>(o+=a.stats.homeworld>0?1:0,o),0)===1){const o=i.find(l=>l.stats.homeworld>0).id,a=e.playerMap.get(o);n.emit(Q.PLAYER_WIN,{playerId:o,message:`${a.name} has conquered The Bubble!`}),n.emit(Q.GAME_STOP,void 0)}}else Array.from(e.world.systemMap.values()).filter(s=>s.ownerId!==t.playerId).length===0&&(n.emit(Q.PLAYER_WIN,{playerId:t.playerId,message:`${r.name} has conquered The Bubble!`}),n.emit(Q.GAME_STOP,void 0))}function xg(e,t=!1){const{S:n,C:r}=e;r.tick%Wu===0&&kc(n),r.tick%Ku===0&&Cc(n);for(const i of n.world.systemMap.values())i.movement=[0,0];for(const i of n.world.laneMap.values())i.movement=[0,0];t||(mg(e),Ac(e)),Pc(n)}const bg="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Sg=e=>crypto.getRandomValues(new Uint8Array(e)),Eg=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),l=i|0;for(;l--;)if(o+=e[a[l]&r]||"",o.length>=s)return o}}},Nc=(e,t=21)=>Eg(e,t|0,Sg),Dc=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=bg[n[e]&63];return t};const Mg=()=>Dc(5);function Rc({S:e,C:t}){e.world=li();const n=de/(t.config.numSystems-1),r=-de/2,i=de/2;je("Generating map...");const s=Math.min(.08,Math.sqrt(Math.PI/t.config.numSystems));for(let h=r;h<i;h+=n){const c=Math.asin(h/(de/2))*(180/Math.PI),d=[Math.random()*360-180,c],y=Ag(d),w=wc(e.world,y.location);if(w){if(zr(d,w.location)<s){h-=n;continue}ms(e.world,y,w)}_c(e.world,y)}const o=Array.from(e.world.systemMap.values()),a=[o[o.length-1]];for(let h=o.length-2;h>=0;h--){const c=o[h],f=Zs(c.location,a);f&&ms(e.world,c,f),a.push(c)}ci(e.world),je(`Generated ${e.world.systemMap.size} systems and ${e.world.laneMap.size} lanes.`);const l=[...o],u=Math.max(eh*t.config.numSystems,cl+Us);for(let h=0;h<u&&l.length!==0;h++){const c=Math.floor(Math.random()*l.length);if(c===0){h--;continue}const f=l[c];f.ownerId=null,f.type="INHABITED",f.ships=ll+Math.floor(Math.random()*10),f.homeworld=null,l.splice(c,1)}}function $g(e,t){const n=Array.from(e.world.systemMap.values()).filter(s=>!s.ownerId&&s.type==="INHABITED");if(n.length===0)throw"No available homeworlds to join.";const r=Math.floor(Math.random()*n.length),i=n[r];return i.ships=1,i.ownerId=i.homeworld=t,i.type="INHABITED",i}function Ag(e){return{id:"s"+Mg(),type:"UNINHABITED",location:e,ownerId:null,ships:0,homeworld:null,moveQueue:[],lastMove:null,movement:[0,0]}}function Ig(e){const t=to();return Rc({...e,S:t}),t}const Tg=Object.freeze(Object.defineProperty({__proto__:null,addLane:ms,addPlayer:xc,addSystem:_c,assignSystem:$g,buildNeighborMap:ci,checkVictory:vg,createWorld:li,defaultConfig:vc,doQueuedMoves:Ac,eliminatePlayer:Mc,findClosestSystem:wc,findClosestSystemInList:Zs,gameTick:xg,generateMap:Rc,getAdjacentSystems:Et,getPlayersHomeworld:eo,hasLane:ui,initalState:to,moveShips:Ec,orderToMove:Tc,queueMove:Sc,revealAllSystems:bc,roundUpdate:Cc,setup:Ig,takeOrder:pg,turnUpdate:kc,updateStats:Pc,visitSystem:hi,worldFromJson:cg,worldToJson:ug},Symbol.toStringTag,{value:"Module"})),ut={all:new Set,last:null};function Ee(){ut.all.clear(),ut.last=null}function Tn(e){ut.all.add(e),ut.last=e}function Pg(e){ut.all.clear(),ut.all.add(e),ut.last=e}function kg(e){ut.all.delete(e),ut.last===e&&(ut.last=null)}function Oc(e){return ut.all.has(e)}function Cg(e){Oc(e)?kg(e):Tn(e)}function Ng({S:e,C:t},n){if(ut.last==null)return;const r=[[ut.last]],i=new Set;for(i.add(ut.last);r.length>0;){const s=r.shift(),o=s[s.length-1];if(o===n){s.forEach(a=>ut.all.add(a)),ut.last=n;return}for(const a of Et(e.world,o))!i.has(a.id)&&a.ownerId===t.playerId&&(i.add(a.id),r.push([...s,a.id]))}}function Ma(e,t){const{S:n,C:r}=globalThis.gameManager.getFnContext();if(r.status==="PLAYING")switch(e.button){case 0:break;case 2:{let i=n.world.systemMap.get(t.fromId),s=n.world.systemMap.get(t.toId);if(i.ownerId!==r.playerId&&s.ownerId!==r.playerId)return;if(i.ownerId!==r.playerId){const o=i;i=s,s=o}else if(i.ownerId===i.ownerId&&s.ships>i.ships){const o=i;i=s,s=o}if(Dg(i.id,s.id),s.ownerId!==r.playerId)return;e.altKey||(!e.ctrlKey&&!e.shiftKey&&Ee(),Tn(i.id),s.ownerId===r.playerId&&Tn(s.id));break}}}function Yr(e,t){const n=globalThis.gameManager.getFnContext();if(n.C.status==="PLAYING")switch(hl&&e.altKey&&(je(""+t.id,t.lastMove?.message??"none",t.lastMove?.ships??0),console.log(t)),e.button){case 0:if(t.ownerId!==n.C.playerId)return;e.ctrlKey||e.metaKey?Cg(t.id):e.shiftKey?Ng(n,t.id):Pg(t.id);break;case-1:case 2:{const r=Array.from(ut.all);if(r.length===0)return;r.forEach(i=>{Rg(i,t.id),t.ownerId===n.C.playerId&&(e.altKey||(!e.ctrlKey&&!e.shiftKey&&Ee(),Tn(t.id)))});break}}}function Dg(e,t){const{S:n,E:r,C:i}=globalThis.gameManager.getFnContext();if(!ui(n.world,e,t))return;const s={type:"BALANCED_MOVE",message:`Balanced move from ${e} to ${t}`,toId:t,fromId:e,playerId:i.playerId};r.emit("TAKE_ORDER",s)}function Rg(e,t){const{S:n,E:r,C:i}=globalThis.gameManager.getFnContext();if(!ui(n.world,e,t))return;const s={type:"MASS_MOVE",toId:t,fromId:e,playerId:i.playerId,message:`Mass move from ${e} to ${t}`};r.emit("TAKE_ORDER",s)}let Lc=0;const Wr=[];function Og(){Lc=0,Wr.length=0;const{E:e}=globalThis.gameManager.getFnContext();e.emit("MESSAGES_UPDATED",{messages:Wr})}function tr(e){const{C:t,E:n}=globalThis.gameManager.getFnContext();Wr.push({id:Lc++,message:e,tick:t.tick}),n.emit("MESSAGES_UPDATED",{messages:Wr})}const no=Math.PI,$a=no/2,Aa=180/no,Ia=no/180,Lg=Math.atan2,Ta=Math.cos,Ug=Math.max,Bg=Math.min,Pa=Math.sin,zg=Math.sign||function(e){return e>0?1:e<0?-1:0},Uc=Math.sqrt;function Fg(e){return e>1?$a:e<-1?-$a:Math.asin(e)}function Bc(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Mt(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Kr(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]}function Xr(e){var t=Uc(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]}function ro(e){return[Lg(e[1],e[0])*Aa,Fg(Ug(-1,Bg(1,e[2])))*Aa]}function Vt(e){const t=e[0]*Ia,n=e[1]*Ia,r=Ta(n);return[r*Ta(t),r*Pa(t),Pa(n)]}function io(e){return e=e.map(t=>Vt(t)),Bc(e[0],Mt(e[2],e[1]))}function Hg(e){const t=Gg(e),n=jg(t),r=Vg(n,e),i=Wg(n,e.length),s=qg(i,e),o=Yg(n,e),{polygons:a,centers:l}=Kg(o,n,e),u=Xg(a),h=Qg(n,e),c=Jg(r,n);return{delaunay:t,edges:r,triangles:n,centers:l,neighbors:i,polygons:a,mesh:u,hull:h,urquhart:c,find:s}}function qg(e,t){function n(r,i){let s=r[0]-i[0],o=r[1]-i[1],a=r[2]-i[2];return s*s+o*o+a*a}return function(i,s,o){o===void 0&&(o=0);let a,l,u=o;const h=Vt([i,s]);do a=o,o=null,l=n(h,Vt(t[a])),e[a].forEach(c=>{let f=n(h,Vt(t[c]));if(f<l){l=f,o=c,u=c;return}});while(o!==null);return u}}function Gg(e){if(e.length<2)return{};let t=0;for(;isNaN(e[t][0]+e[t][1])&&t++<e.length;);const n=Br(e[t]),r=gc().translate([0,0]).scale(1).rotate(n.invert([180,0]));e=e.map(r);const i=[];let s=1;for(let c=0,f=e.length;c<f;c++){let d=e[c][0]**2+e[c][1]**2;!isFinite(d)||d>1e32?i.push(c):d>s&&(s=d)}const o=1e6*Uc(s);i.forEach(c=>e[c]=[o,0]),e.push([0,o]),e.push([-o,0]),e.push([0,-o]);const a=Vs.from(e);a.projection=r;const{triangles:l,halfedges:u,inedges:h}=a;for(let c=0,f=u.length;c<f;c++)if(u[c]<0){const d=c%3==2?c-2:c+1,y=c%3==0?c+2:c-1,w=u[d],M=u[y];u[w]=M,u[M]=w,u[d]=u[y]=-1,l[c]=l[d]=l[y]=t,h[l[w]]=w%3==0?w+2:w-1,h[l[M]]=M%3==0?M+2:M-1,c+=2-c%3}else l[c]>e.length-3-1&&(l[c]=t);return a}function Vg(e,t){const n=new Set;return t.length===2?[[0,1]]:(e.forEach(r=>{if(r[0]!==r[1]&&!(io(r.map(i=>t[i]))<0))for(let i=0,s;i<3;i++)s=(i+1)%3,n.add(fl([r[i],r[s]]).join("-"))}),Array.from(n,r=>r.split("-").map(Number)))}function jg(e){const{triangles:t}=e;if(!t)return[];const n=[];for(let r=0,i=t.length/3;r<i;r++){const s=t[3*r],o=t[3*r+1],a=t[3*r+2];s!==o&&o!==a&&n.push([s,a,o])}return n}function Yg(e,t){return e.map(n=>{const r=n.map(s=>t[s]).map(Vt),i=Kr(Kr(Mt(r[1],r[0]),Mt(r[2],r[1])),Mt(r[0],r[2]));return ro(Xr(i))})}function Wg(e,t){const n=[];return e.forEach(r=>{for(let i=0;i<3;i++){const s=r[i],o=r[(i+1)%3];n[s]=n[s]||[],n[s].push(o)}}),e.length===0&&(t===2?(n[0]=[1],n[1]=[0]):t===1&&(n[0]=[])),n}function Kg(e,t,n){const r=[],i=e.slice();if(t.length===0){if(n.length<2)return{polygons:r,centers:i};if(n.length===2){const a=Vt(n[0]),l=Vt(n[1]),u=Xr(Kr(a,l)),h=Xr(Mt(a,l)),c=Mt(u,h),f=[u,Mt(u,c),Mt(Mt(u,c),c),Mt(Mt(Mt(u,c),c),c)].map(ro).map(o);return r.push(f),r.push(f.slice().reverse()),{polygons:r,centers:i}}}t.forEach((a,l)=>{for(let u=0;u<3;u++){const h=a[u],c=a[(u+1)%3],f=a[(u+2)%3];r[h]=r[h]||[],r[h].push([c,f,l,[h,c,f]])}});const s=r.map(a=>{const l=[a[0][2]];let u=a[0][1];for(let h=1;h<a.length;h++)for(let c=0;c<a.length;c++)if(a[c][0]==u){u=a[c][1],l.push(a[c][2]);break}if(l.length>2)return l;if(l.length==2){const h=ka(n[a[0][3][0]],n[a[0][3][1]],i[l[0]]),c=ka(n[a[0][3][2]],n[a[0][3][0]],i[l[0]]),f=o(h),d=o(c);return[l[0],d,l[1],f]}});function o(a){let l=-1;return i.slice(t.length,1/0).forEach((u,h)=>{u[0]===a[0]&&u[1]===a[1]&&(l=h+t.length)}),l<0&&(l=i.length,i.push(a)),l}return{polygons:s,centers:i}}function ka(e,t,n){e=Vt(e),t=Vt(t),n=Vt(n);const r=zg(Bc(Mt(t,e),n));return ro(Xr(Kr(e,t)).map(i=>r*i))}function Xg(e){const t=[];return e.forEach(n=>{if(!n)return;let r=n[n.length-1];for(let i of n)i>r&&t.push([r,i]),r=i}),t}function Jg(e,t){return function(n){const r=new Map,i=new Map;return e.forEach((s,o)=>{const a=s.join("-");r.set(a,n[o]),i.set(a,!0)}),t.forEach(s=>{let o=0,a=-1;for(let l=0;l<3;l++){let u=fl([s[l],s[(l+1)%3]]).join("-");r.get(u)>o&&(o=r.get(u),a=u)}i.set(a,!1)}),e.map(s=>i.get(s.join("-")))}}function Qg(e,t){const n=new Set,r=[];e.map(a=>{if(!(io(a.map(l=>t[l>t.length?0:l]))>1e-12))for(let l=0;l<3;l++){let u=[a[l],a[(l+1)%3]],h=`${u[0]}-${u[1]}`;n.has(h)?n.delete(h):n.add(`${u[1]}-${u[0]}`)}});const i=new Map;let s;if(n.forEach(a=>{a=a.split("-").map(Number),i.set(a[0],a[1]),s=a[0]}),s===void 0)return r;let o=s;do{r.push(o);let a=i.get(o);i.set(o,-1),o=a}while(o>-1&&o!==s);return r}function Zg(e){const t=function(n){if(t.delaunay=null,t._data=n,typeof t._data=="object"&&t._data.type==="FeatureCollection"&&(t._data=t._data.features),typeof t._data=="object"){const r=t._data.map(i=>[t._vx(i),t._vy(i),i]).filter(i=>isFinite(i[0]+i[1]));t.points=r.map(i=>[i[0],i[1]]),t.valid=r.map(i=>i[2]),t.delaunay=Hg(t.points)}return t};return t._vx=function(n){if(typeof n=="object"&&"type"in n)return ia(n)[0];if(0 in n)return n[0]},t._vy=function(n){if(typeof n=="object"&&"type"in n)return ia(n)[1];if(1 in n)return n[1]},t.x=function(n){return n?(t._vx=n,t):t._vx},t.y=function(n){return n?(t._vy=n,t):t._vy},t.polygons=function(n){if(n!==void 0&&t(n),!t.delaunay)return!1;const r={type:"FeatureCollection",features:[]};return t.valid.length===0||(t.delaunay.polygons.forEach((i,s)=>r.features.push({type:"Feature",geometry:i?{type:"Polygon",coordinates:[[...i,i[0]].map(o=>t.delaunay.centers[o])]}:null,properties:{site:t.valid[s],sitecoordinates:t.points[s],neighbours:t.delaunay.neighbors[s]}})),t.valid.length===1&&r.features.push({type:"Feature",geometry:{type:"Sphere"},properties:{site:t.valid[0],sitecoordinates:t.points[0],neighbours:[]}})),r},t.triangles=function(n){return n!==void 0&&t(n),t.delaunay?{type:"FeatureCollection",features:t.delaunay.triangles.map((r,i)=>(r=r.map(s=>t.points[s]),r.center=t.delaunay.centers[i],r)).filter(r=>io(r)>0).map(r=>({type:"Feature",properties:{circumcenter:r.center},geometry:{type:"Polygon",coordinates:[[...r,r[0]]]}}))}:!1},t.links=function(n){if(n!==void 0&&t(n),!t.delaunay)return!1;const r=t.delaunay.edges.map(s=>zr(t.points[s[0]],t.points[s[1]])),i=t.delaunay.urquhart(r);return{type:"FeatureCollection",features:t.delaunay.edges.map((s,o)=>({type:"Feature",properties:{source:t.valid[s[0]],target:t.valid[s[1]],length:r[o],urquhart:!!i[o]},geometry:{type:"LineString",coordinates:[t.points[s[0]],t.points[s[1]]]}}))}},t.mesh=function(n){return n!==void 0&&t(n),t.delaunay?{type:"MultiLineString",coordinates:t.delaunay.edges.map(r=>[t.points[r[0]],t.points[r[1]]])}:!1},t.cellMesh=function(n){if(n!==void 0&&t(n),!t.delaunay)return!1;const{centers:r,polygons:i}=t.delaunay,s=[];for(const o of i)if(o)for(let a=o.length,l=o[a-1],u=o[0],h=0;h<a;l=u,u=o[++h])u>l&&s.push([r[l],r[u]]);return{type:"MultiLineString",coordinates:s}},t._found=void 0,t.find=function(n,r,i){if(t._found=t.delaunay.find(n,r,t._found),!i||zr([n,r],t.points[t._found])<i)return t._found},t.hull=function(n){n!==void 0&&t(n);const r=t.delaunay.hull,i=t.points;return r.length===0?null:{type:"Polygon",coordinates:[[...r.map(s=>i[s]),i[r[0]]]]}},e?t(e):t}const zc=Math.acos,tm=Math.asin,Ca=Math.atan2,Me=Math.cos,Na=Math.hypot,_s=Math.max,ws=Math.min,Fc=Math.PI,$e=Math.sin,yn=Fc/180,Pi=180/Fc;class Ct{static fromCartesian([t,n,r]){return[0,r,-n,t]}static fromAngles([t,n,r]){t*=yn/2,n*=yn/2,r=(r||0)*yn/2;const i=$e(t),s=Me(t),o=$e(n),a=Me(n),l=$e(r),u=Me(r);return[s*a*u+i*o*l,i*a*u-s*o*l,s*o*u+i*a*l,s*a*l-i*o*u]}static toAngles([t,n,r,i]){return[Ca(2*(t*n+r*i),1-2*(n*n+r*r))*Pi,tm(_s(-1,ws(1,2*(t*r-i*n))))*Pi,Ca(2*(t*i+n*r),1-2*(r*r+i*i))*Pi]}static interpolateAngles(t,n){const r=Ct.interpolate(Ct.fromAngles(t),Ct.fromAngles(n));return i=>Ct.toAngles(r(i))}static interpolateLinear([t,n,r,i],[s,o,a,l]){s-=t,o-=n,a-=r,l-=i;const u=new Array(4);return h=>{const c=Na(u[0]=t+s*h,u[1]=n+o*h,u[2]=r+a*h,u[3]=i+l*h);return u[0]/=c,u[1]/=c,u[2]/=c,u[3]/=c,u}}static interpolate([t,n,r,i],[s,o,a,l]){let u=Ct.dot([t,n,r,i],[s,o,a,l]);if(u<0&&(s=-s,o=-o,a=-a,l=-l,u=-u),u>.9995)return Ct.interpolateLinear([t,n,r,i],[s,o,a,l]);const h=zc(_s(-1,ws(1,u))),c=new Array(4),f=Na(s-=t*u,o-=n*u,a-=r*u,l-=i*u);return s/=f,o/=f,a/=f,l/=f,d=>{const y=h*d,w=$e(y),M=Me(y);return c[0]=t*M+s*w,c[1]=n*M+o*w,c[2]=r*M+a*w,c[3]=i*M+l*w,c}}static dot([t,n,r,i],[s,o,a,l]){return t*s+n*o+r*a+i*l}static multiply([t,n,r,i],[s,o,a,l]){return[t*s-n*o-r*a-i*l,t*o+n*s+r*l-i*a,t*a-n*l+r*s+i*o,t*l+n*a-r*o+i*s]}}const Tt=Ct.fromAngles;Tt.multiply=Ct.multiply;Tt.rotation=Ct.toAngles;Tt.interpolate=Ct.interpolateAngles;Tt.cartesian=function(e){const t=e[0]*yn,n=e[1]*yn,r=Me(n);return[r*Me(t),r*$e(t),$e(n)]};Tt.delta=function(e,t,n){arguments.length==2&&(n=1);const r=Math.sqrt;function i(h,c){return[h[1]*c[2]-h[2]*c[1],h[2]*c[0]-h[0]*c[2],h[0]*c[1]-h[1]*c[0]]}function s(h,c){return h[0]*c[0]+h[1]*c[1]+h[2]*c[2]}const o=i(e,t),a=r(s(o,o));if(!a)return[1,0,0,0];const l=n*zc(_s(-1,ws(1,s(e,t))))/2,u=$e(l);return[Me(l),o[2]/a*u,-o[1]/a*u,o[0]/a*u]};const Da=.5,em=.25,nm=100,rm=20,im=oi(".3~s"),Qe={Orthographic:tg,Stereographic:gc,Mercator:Zp,TransverseMercator:eg};let vs,Nt,Ze=Qe[ju],st=Ze().translate([0,0]),oe=st.scale(),fi=Ws().projection(st),pr;const sm=Zg().x(e=>e.location[0]).y(e=>e.location[1]);function om(){const e=Object.keys(Qe),n=(e.findIndex(r=>Qe[r]===Ze)+1)%e.length;am(e[n])}function am(e){Ze=Qe[e],st=Ze(),st.translate([0,0]).rotate([0,0,0]).scale(oe),oe=st.scale(),fi=Ws().projection(st)}function Re(e){const t=st.rotate();t[0]+=e[0],t[1]+=e[1],e.length===3&&(t[2]+=e[2]),st.rotate(t)}function lm(e,t){vs=Dt(e),Nt=vs.select("svg"),Nt.attr("width","100vw").attr("height","100vh").attr("viewBox",`-${vr/2} -${de/2} ${vr} ${de}`).on("contextmenu",o=>o.preventDefault()),xs(t.S),qc(t),Gc(t),Hc(t),Nt.call(n()),Nt.call(r()),window.addEventListener("resize",s);function n(){return i().on("drag.render",()=>Z()).on("end.render",()=>Z())}function r(){return lg().filter(o=>o.type==="wheel").on("zoom",o=>{if(o.transform.k>Da){const a=oe*o.transform.k;st.scale(a),Z()}else o.transform.k=Da})}function i(){let o,a,l,u,h;function c(w,M){const v=qf(w,M);if(v.length!==h&&(h=v.length,h>1&&(u=Math.atan2(v[1][1]-v[0][1],v[1][0]-v[0][0])),f.apply(M,[w,M])),h>1){const T=Eo(v,C=>C[0]),A=Eo(v,C=>C[1]),b=Math.atan2(v[1][1]-v[0][1],v[1][0]-v[0][0]);return[T,A,b]}return v[0]}function f({x:w,y:M}){const v=y([w,M]);o=Tt.cartesian(st.invert(v)),l=st.rotate(),a=Tt(l)}function d(w){const M=y([w.x,w.y]),v=Tt.cartesian(st.rotate(l).invert(M)),T=Tt.delta(o,v);let A=Tt.multiply(a,T);const b=c(w,this);if(b[2]){const C=(b[2]-u)/2,R=-Math.sin(C),L=Math.sign(Math.cos(C));A=Tt.multiply([Math.sqrt(1-R*R),0,0,L*R],A)}st.rotate(Tt.rotation(A)),T[0]<.7&&f.apply(this,[w,this])}function y(w){const M=parseInt(Nt.style("width")),v=parseInt(Nt.style("height"));return[w[0]-M/2,w[1]-v/2]}return Kf().filter(w=>w.button===1||w.touches).on("start",f).on("drag",d)}function s(){xs(globalThis.gameManager.getState())}}function xs(e){const t=Nt.node()?.getBoundingClientRect(),n=window.devicePixelRatio||1,r=t?.height||de,i=t?.width||vr,a=vs.selectAll("canvas").data([null]).join(h=>h.append("canvas").style("position","absolute").style("top",0).style("left",0).style("z-index",-1).style("pointer-events","none")).attr("width",i*n).attr("height",r*n).style("width",`${i}px`).style("height",`${r}px`).node().getContext("2d");a.setTransform(1,0,0,1,0,0),a.scale(n,n),a.translate(i/2,r/2);const l=Math.min(i/vr,r/de);a.scale(l,l);const u="#FFFFFF48";if(Ze===Qe.Orthographic){const h=st.scale();a.strokeStyle=u,a.lineWidth=1,a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=10,a.shadowColor=u,a.beginPath(),a.arc(0,0,h,0,Math.PI*2),a.stroke(),a.fill()}{a.shadowBlur=0,a.strokeStyle="rgba(51, 51, 51, 0.5)";const h=cm(e),c=Ws().projection(st).context(a);a.beginPath(),c(h),a.stroke()}}function cm(e){const t=kp(),n=eo(e);if(n){if(!pr){const r=Br([0,90+n.location[1],0]),i=Br([n.location[0],0,0]);pr={type:"FeatureCollection",features:t.lines().map(s=>({type:"Feature",geometry:{type:"LineString",coordinates:s.coordinates.map(o=>i(r(o)))}}))}}return pr}return t()}function Ra(e){const t=st.scale()*e;t<oe*em||t>oe*nm||(st.scale(t),Z())}function bs(){const e=globalThis.gameManager.getState(),t=eo(e);if(!t)return;pr=null;const n=t.location;Ze===Qe.Orthographic?Ss([n[0],n[1]-45]):Ss(n),st.scale(oe)}function um(e){const n=globalThis.gameManager.getState().world.systemMap.get(e);n&&(Ss(n.location),st.scale(oe))}function Ss(e){st.rotate([-e[0],-e[1],0]),Z()}let Oa=null;function Z(){return cancelAnimationFrame(Oa),Oa=requestAnimationFrame(()=>e());function e(t){Nt&&(t??=globalThis.gameManager.getFnContext(),qc(t),xs(t.S),Hc(t),Gc(t))}}function Hc({S:e,C:t,P:n}){const i=st.scale()/oe<1;let s=e.world.systemMap.values();n&&t.config.fow&&(s=n.revealedSystems.values().map(l=>e.world.systemMap.get(l))),s=s.filter(l=>!!fi({type:"Point",coordinates:l.location}));const a=Nt.selectAll("g#systems").data([null]).join(l=>l.append("g").attr("id","systems")).classed("reduced-size",i).classed("hidden",!1).selectAll(".system").data(s,l=>l.id).join(l=>{const u=l.append("g").attr("class","system").attr("id",h=>h.id).on("click",(h,c)=>{Yr(h,c),Z()}).on("contextmenu",(h,c)=>{h.preventDefault(),Yr(h,c),Z()});return u.append("circle").attr("class","system-outline").attr("cx",0).attr("cy",0).attr("r",rm/2),u.append("text").attr("class","ship-count").attr("y",-10).attr("x",0).attr("text-anchor","start"),u.append("text").attr("class","system-icon").attr("y",0).attr("x",0).attr("text-anchor","end"),u});a.style("--owner-color",l=>e.playerMap.get(l.ownerId)?.color??null).classed("own",l=>l.ownerId===t.playerId).classed("selected",l=>Oc(l.id)).classed("moved",l=>l.movement[0]>0||l.movement[1]>0).classed("inhabited",l=>l.type==="INHABITED").classed("homeworld",l=>!!l.homeworld&&l.ownerId===l.homeworld).classed("visited",l=>n?n.visitedSystems.has(l.id):!0).attr("transform",l=>`translate(${st(l.location)})`),a.select(".system-icon").text(l=>l.homeworld&&l.ownerId===l.homeworld?"":l.type==="INHABITED"?"":""),a.select(".ship-count").text(l=>i?"":(l.type==="INHABITED"?"":"")+(l.ships?im(l.ships):""))}const hm=(()=>{let e=[],t;return n=>{if(!e||t!==n.world.systemMap){t=n.world.systemMap;const r=Array.from(t.values());e=sm.polygons(r).features}return e}})();function qc({S:e,C:t,P:n}){const i=st.scale()/oe<1;let s=hm(e);n&&t.config.fow&&(s=s.filter(l=>{const u=l.properties?.site;return n.revealedSystems.has(u.id)})),Nt.selectAll("g#mesh").data([null]).join(l=>l.append("g").attr("id","mesh")).classed("reduced-size",i).classed("hidden",!1).selectAll("path").data(s).join(l=>l.append("path").classed("region",!0).on("click",(u,h)=>{Yr(u,h),Z()}).on("contextmenu",(u,h)=>{u.preventDefault(),Yr(u,h),Z()})).attr("d",l=>fi(l)).datum(l=>l.properties.site).classed("visited",l=>n?n.visitedSystems.has(l.id):!0).style("--owner-color",l=>e.playerMap.get(l.ownerId)?.color??null)}function Gc({S:e,C:t,P:n}){let r=e.world.laneMap.values();n&&t.config.fow&&(r=r.filter(o=>n.revealedSystems.has(o.fromId)&&n.revealedSystems.has(o.toId)));const s=Nt.selectAll("g#lanes").data([null]).join(o=>o.append("g").attr("id","lanes")).selectAll("g.lane-group").data(r,o=>o.id).join(o=>{const a=o.append("g").attr("class","lane-group").attr("id",l=>l.id).on("click",(l,u)=>{Ma(l,u),Z()}).on("contextmenu",(l,u)=>{l.preventDefault(),Ma(l,u),Z()});return a.append("path").attr("class","lane"),a.append("path").attr("class","pulse"),a}).datum(o=>{const a=e.world.systemMap.get(o.toId),l=e.world.systemMap.get(o.fromId),u=fi({type:"LineString",coordinates:[l.location,a.location]});return{...o,from:e.world.systemMap.get(o.fromId),to:e.world.systemMap.get(o.toId),path:u}});s.style("--owner-color",o=>{const a=o.from;if(!a.ownerId)return null;const l=o.to;return!l.ownerId||a.ownerId!==l.ownerId?null:e.playerMap.get(a.ownerId)?.color??null}),s.select("path.lane").attr("d",o=>o.path).classed("own",o=>{const a=o.from,l=o.to;return a.ownerId===t.playerId||l.ownerId===t.playerId}).style("--path-length",o=>{const a=Dt(`#${o.id} .lane`).node();return a?a.getTotalLength():200}),s.select("path.pulse").attr("d",o=>o.path).classed("moved",o=>o.movement[0]>0||o.movement[1]>0).style("stroke-width",o=>{if(o.movement[0]===0&&o.movement[1]===0)return null;const a=2,l=Math.floor(Math.log2(Math.max(o.movement[0],o.movement[1])));return`${(a+l)*2}px`}).classed("moved--fwd",o=>o.movement[0]>o.movement[1]).classed("moved--bak",o=>o.movement[1]>o.movement[0])}class fm{constructor(){this.listeners={}}on(t,n){return this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(n),()=>{this.listeners[t]=this.listeners[t].filter(r=>r!==n)}}emit(t,n){const r=this.listeners[t];if(r)for(const i of r)try{i(n)}catch(s){console.error(`Error in listener for event ${String(t)}:`,s)}}clear(){this.listeners={}}}class Vc{constructor(){this.events=new fm,this.game=Tg,this.state=to(),this.config=vc(),this.tick=0,this.status="WAITING",this.runningInterval=null,this.#e()}getState(){return xr?Object.freeze({...this.state}):this.state}getConfig(){return xr?Object.freeze({...this.config}):this.config}async setConfig(t){this.config={...this.config,...t},this.events.emit("CONFIG_UPDATED",{config:this.config})}getPlayer(){return this.state.playerMap.get(this.playerId)??null}getContext(){return{tick:this.tick,status:this.status,playerId:this.playerId,config:this.getConfig()}}getFnContext(){return{S:this.state,E:this.events,P:this.state.playerMap.get(this.playerId),C:this.getContext()}}addPlayer(t){if(this.state.playerMap.has(t.id))return this.state.playerMap.get(t.id);const n=t.score??{userId:t.id,playerName:t.name??`Player ${this.state.playerMap.size+1}`,score:0,tick:0,timestamp:Date.now()},r={name:t.name??`Player ${this.state.playerMap.size+1}`,score:n,color:"#000000",...t,stats:{playerId:t.id,systems:0,ships:0,homeworld:0},isAlive:!0,visitedSystems:new Set,revealedSystems:new Set};return xc(this.state,r),r}gameStart(){this.status="PLAYING",this.tick=0,this.events.emit(Q.GAME_START,void 0),this.#t()}gameStop(){this.status="FINISHED",this.stopGameLoop()}gameTick(){this.tick++,this.game.gameTick(this.getFnContext()),this.game.checkVictory(this.getFnContext()),this.events.emit("STATE_UPDATED",{state:this.state,status:this.status})}#t(){if(this.status!=="PLAYING"){this.gameStop();return}this.stopGameLoop(),this.gameTick(),this.events.emit(Q.GAME_TICK,{tick:this.tick}),this.runningInterval=setTimeout(()=>this.#t(),Yu/this.config.timeScale)}startGameLoop(){this.#t()}stopGameLoop(){this.runningInterval&&(clearTimeout(this.runningInterval),this.runningInterval=null)}#e(){this.events.on(Q.GAME_STOP,()=>{this.gameStop()}),this.events.on(Q.TAKE_ORDER,t=>{this.game.takeOrder(this.getFnContext(),t),this.events.emit("STATE_UPDATED",{state:this.state,status:this.status})})}}const en=Vc,dm=Symbol("config"),pm=Symbol("state"),gm=Symbol("player"),mm=Symbol("context"),ym=`<dialog id="optionsDialog">
  <form id="optionsForm" method="dialog">
    <!-- label for="numBotsInput">
      Number of Bots

      <div class="btn-group" data-toggle="buttons" role="group">
        <label role="button" class="btn btn-primary">
          <input type="radio" name="numBots" id="option1" value="0">
          None
        </label>
        <label role="button" class="btn btn-primary">
          <input type="radio" name="numBots" id="option2" value="1">
          1
        </label>
        <label role="button" class="btn btn-primary">
          <input type="radio" name="numBots" id="option2" value="1">
          2
        </label>
        <label role="button" class="btn btn-primary">
          <input type="radio" name="numBots" id="option3" value="4" checked>
          4
        </label>
        <label role="button" class="btn btn-primary">
          <input type="radio" name="numBots" id="option3" value="8">
          8
        </label>
      </div>
    </label -->

    <label for="fowInput">
      Fog of War
      <input name="fow" type="checkbox" role="switch" checked />
    </label>

    <label for="numSystemsInput">
      Bubble Size
      <input name="numSystems" min="0" max="4" step="1" type="range" list="steplist">
      <datalist id="steplist">
        <option value="48">Tiny</option>
        <option value="96"></option>
        <option value="192">Med</option>
        <option value="384"></option>
        <option value="768">Large</option>
      </datalist>
    </label>

    <p />&nbsp;
    <p />
    <button id="optionsOkButton">OK</button>
    <button id="optionsCancelButton" type="reset">Reset</button>
  </form>
</dialog>`,_m=`<!-- @license lucide-static v0.562.0 - ISC -->
<svg
  class="lucide lucide-play"
  xmlns="http://www.w3.org/2000/svg"
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
>
  <path d="M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z" />
</svg>
`,wm=`<!-- @license lucide-static v0.562.0 - ISC -->
<svg
  class="lucide lucide-cog"
  xmlns="http://www.w3.org/2000/svg"
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
>
  <path d="M11 10.27 7 3.34" />
  <path d="m11 13.73-4 6.93" />
  <path d="M12 22v-2" />
  <path d="M12 2v2" />
  <path d="M14 12h8" />
  <path d="m17 20.66-1-1.73" />
  <path d="m17 3.34-1 1.73" />
  <path d="M2 12h2" />
  <path d="m20.66 17-1.73-1" />
  <path d="m20.66 7-1.73 1" />
  <path d="m3.34 17 1.73-1" />
  <path d="m3.34 7 1.73 1" />
  <circle cx="12" cy="12" r="2" />
  <circle cx="12" cy="12" r="8" />
</svg>
`,vm=`<!-- @license lucide-static v0.562.0 - ISC -->
<svg
  class="lucide lucide-plus"
  xmlns="http://www.w3.org/2000/svg"
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
>
  <path d="M5 12h14" />
  <path d="M12 5v14" />
</svg>
`,xm=`<!-- @license lucide-static v0.562.0 - ISC -->
<svg
  class="lucide lucide-github"
  xmlns="http://www.w3.org/2000/svg"
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
>
  <path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4" />
  <path d="M9 18c-4.51 2-5-2-7-2" />
</svg>
`,bm=`<!-- @license lucide-static v0.562.0 - ISC -->
<svg
  class="lucide lucide-bot"
  xmlns="http://www.w3.org/2000/svg"
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
>
  <path d="M12 8V4H8" />
  <rect width="16" height="12" x="4" y="8" rx="2" />
  <path d="M2 14h2" />
  <path d="M20 14h2" />
  <path d="M15 13v2" />
  <path d="M9 13v2" />
</svg>
`;var Sm=Object.defineProperty,Em=Object.getOwnPropertyDescriptor,jc=e=>{throw TypeError(e)},le=(e,t,n,r)=>{for(var i=r>1?void 0:r?Em(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&Sm(t,n,i),i},Mm=(e,t,n)=>t.has(e)||jc("Cannot "+n),$m=(e,t,n)=>t.has(e)?jc("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),La=(e,t,n)=>(Mm(e,t,"access private method"),n),gr,Yc,Wc;const Oe=5;let Yt=class extends Lt{constructor(){super(...arguments),$m(this,gr)}async connectedCallback(){super.connectedCallback(),La(this,gr,Yc).call(this),La(this,gr,Wc).call(this)}createRenderRoot(){return this}render(){return ot`
      <dialog id="startDialog" closedby="none">
        <start-dialog-content
          @startClicked=${this.onStart}
        ></start-dialog-content>
      </dialog>
      <dialog id="endDialog">
        <p id="endMessage"></p>
        <form method="dialog">
          <button id="restartButton">Yes</button>
        </form>
      </dialog>
      <dialog id="helpDialog">${this.renderHelp()}</dialog>
      ${he(ym)}
      <game-canvas id="app"></game-canvas>
      <tick-box tick="${this.context?.tick}"></tick-box>
      <leaderboard-element></leaderboard-element>
      <message-box></message-box>
      <button id="helpButton" @click=${this.showHelp}>?</button>
    `}renderHelp(){return ot`<article>
      <h2>Introduction</h2>

      <p>
        This is a simple strategy game where you control a number of star
        systems and try to conquer the the Bubble. The Bubble is a cluster of
        star systems connected by hyperspace lanes. You start with one system
        and must expand your control by sending ships to capture other systems.
      </p>

      <h3>Gameplay</h3>
      <ul>
        <li>
          The game is played in real-time, with each turn lasting 1 second.
        </li>
        <li>You begin the game controlling one system, your homeworld.</li>
        <li>
          Each turn, your homeworld and any other inhabited systems you control,
          will produce an additional ship.
        </li>
        <li>You can send these ships to other systems to capture them.</li>
        <li>
          Each controlled system receives an additional ship each 25 turns.
        </li>
        <li>
          To transfer ships, left click on a system you control and then right
          click on a target system.
        </li>
        <li>
          This will send all available ships, less one, from the source system
          to the target system.
        </li>
        <li>
          Right click on the hyperspace lane between the systems to send half of
          the available ships.
        </li>
        <li>
          If the target system is uninhabited, you will capture it
          automatically.
        </li>
        <li>
          If the target system is controlled by another player, a battle will
          ensue.
        </li>
        <li>
          The player with the most ships on the target system after all ships
          have arrived will take control of the system.
        </li>
      </ul>
      <h3>Objective</h3>
      <p>
        The goal is to eliminate all other player's homeworlds and control the
        entire Bubble.
      </p>

      <p>
        <a href="https://github.com/Hypercubed/starz">
          ${he(xm)}
        </a>
      </p>

      <form method="dialog">
        <button>Exit</button>
      </form>
    </article>`}showStartDialog(){this.startDialog?.showModal()}onStart(){this.startDialog.close(),this.gameManager.start()}async onKeyup(e){const t=e.target?.tagName;if(!(t==="INPUT"||t==="TEXTAREA")){switch(e.key){case"?":this.showHelp();return;case"Escape":Ee(),Z();return;case"x":{if(!e.ctrlKey)return;this.gameManager.quit();return}}if(hl&&e.altKey){e.preventDefault();const{S:n,C:r}=globalThis.gameManager.getFnContext();switch(e.code){case"KeyC":for(const i of n.world.systemMap.values())i.ownerId===r.playerId&&(i.ships*=2);Z();return;case"KeyR":bc(n),Z();return;case"NumpadAdd":case"Equal":{const i=Math.min(16,r.config.timeScale*2);globalThis.gameManager.setConfig({timeScale:i}),je(`Time scale increased to ${r.config.timeScale}x`);return}case"NumpadSubtract":case"Minus":{const i=Math.max(.25,r.config.timeScale/2);globalThis.gameManager.setConfig({timeScale:i}),je(`Time scale decreased to ${r.config.timeScale}x`);return}}}}}async onKeypress(e){const t=e.target?.tagName;if(!(t==="INPUT"||t==="TEXTAREA"))switch(e.code){case"Space":"pauseToggle"in globalThis.gameManager&&globalThis.gameManager.pauseToggle();return;case"Equal":case"NumpadAdd":Ra(1.2),Z();return;case"Minus":case"NumpadSubtract":Ra(.8),Z();return;case"KeyW":Re([0,Oe]),Z();return;case"KeyA":Re([-Oe,0]),Z();return;case"KeyS":Re([0,-Oe]),Z();return;case"KeyD":Re([Oe,0]),Z();return;case"KeyQ":Re([0,0,Oe]),Z();break;case"KeyE":Re([0,0,-Oe]),Z();break;case"KeyH":bs(),Z();return;case"KeyC":ut.last&&(um(ut.last),Z());return;case"KeyP":om(),bs(),Z();return}}showHelp(){this.helpDialog.showModal()}async showEndGame(e){return this.endDialog.showModal(),this.endDialog.querySelector("p#endMessage").textContent=e,new Promise(t=>{this.endDialog.addEventListener("close",()=>t(!0)),this.endDialog.addEventListener("cancel",()=>t(!1))})}};gr=new WeakSet;Yc=function(){window.document.addEventListener("keyup",e=>this.onKeyup(e)),window.document.addEventListener("keypress",e=>this.onKeypress(e))};Wc=function(){this.config=this.gameManager.getConfig(),this.state=this.gameManager.getState(),this.player=this.gameManager.getPlayer(),this.context=this.gameManager.getContext(),this.gameManager.events.on(Q.GAME_INIT,()=>{this.config=this.gameManager.getConfig(),this.state=this.gameManager.getState(),this.player=this.gameManager.getPlayer(),this.context=this.gameManager.getContext()}),this.gameManager.events.on(Q.CONFIG_UPDATED,({config:e})=>{this.config=e,this.player=this.gameManager.getPlayer(),this.context=this.gameManager.getContext()}),this.gameManager.events.on("STATE_UPDATED",({state:e})=>this.state=e),this.gameManager.events.on(Q.GAME_TICK,()=>{this.context=this.gameManager.getContext()})};le([Cn({context:en}),Ls({attribute:!1})],Yt.prototype,"gameManager",2);le([Cn({context:dm}),dt()],Yt.prototype,"config",2);le([Cn({context:pm}),dt()],Yt.prototype,"state",2);le([Cn({context:gm}),dt()],Yt.prototype,"player",2);le([Cn({context:mm}),dt()],Yt.prototype,"context",2);le([ei("#helpDialog")],Yt.prototype,"helpDialog",2);le([ei("#startDialog")],Yt.prototype,"startDialog",2);le([ei("#endDialog")],Yt.prototype,"endDialog",2);Yt=le([Ce("app-root")],Yt);var Am=Object.defineProperty,Im=Object.getOwnPropertyDescriptor,so=(e,t,n,r)=>{for(var i=r>1?void 0:r?Im(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&Am(t,n,i),i};const Tm=oi(".3~s");let Jr=class extends Lt{createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this.gameManager.events.on(Q.GAME_TICK,()=>this.updateStats()),this.gameManager.events.on(Q.STATE_UPDATED,()=>this.updateStats())}updateStats(){const e=this.gameManager.getState()?.playerMap;e&&(this.stats=Array.from(e.values()).sort((t,n)=>n.stats.systems-t.stats.systems||n.stats.ships-t.stats.ships))}render(){return ot`
      <table id="leaderbox">
        ${this.renderHeader()} ${this.renderBody()}
      </table>
    `}renderBody(){return ot`<tbody>
      ${this.stats?.map(t=>ot`<tr
            style="--owner-color: ${t.color||null}"
            title="${t.bot?t.bot.name:"Human"}"
            class="${t.isAlive?"":"eliminated"}"
          >
            <td>${""}${t.name}${""}</td>
            <td>${""}${t.stats.systems}${""}</td>
            <td>${""}${Tm(t.stats.ships)}${""}</td>
          </tr>`)}
    </tbody>`}renderHeader(){return ot`<thead>
        <tr>
          <th>Player</th>
          <th>Systems</th>
          <th>Ships</th>
        </tr>
      </thead>
      <tbody></tbody>`}};so([Nn({context:en}),dt()],Jr.prototype,"gameManager",2);so([dt()],Jr.prototype,"stats",2);Jr=so([Ce("leaderboard-element")],Jr);var Es;try{Es=new TextDecoder}catch{}var B,jt,S=0,et={},Y,pe,It=0,qt=0,ft,ne,St=[],V,Ua={useRecords:!1,mapsAsObjects:!0};class Kc{}const Xc=new Kc;Xc.name="MessagePack 0xC1";var ge=!1,Jc=2,Pm;try{new Function("")}catch{Jc=1/0}class Pn{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(B)return ru(()=>($s(),this?this.unpack(t,n):Pn.prototype.unpack.call(Ua,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof Buffer<"u"?Buffer.from(t):new Uint8Array(t)),typeof n=="object"?(jt=n.end||t.length,S=n.start||0):(S=0,jt=n>-1?n:t.length),qt=0,pe=null,ft=null,B=t;try{V=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw B=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof Pn){if(et=this,this.structures)return Y=this.structures,er(n);(!Y||Y.length>0)&&(Y=[])}else et=Ua,(!Y||Y.length>0)&&(Y=[]);return er(n)}unpackMultiple(t,n){let r,i=0;try{ge=!0;let s=t.length,o=this?this.unpack(t,s):di.unpack(t,s);if(n){if(n(o,i,S)===!1)return;for(;S<s;)if(i=S,n(er(),i,S)===!1)return}else{for(r=[o];S<s;)i=S,r.push(er());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{ge=!1,$s()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function er(e){try{if(!et.trusted&&!ge){let n=Y.sharedLength||0;n<Y.length&&(Y.length=n)}let t;if(et.randomAccessStructure&&B[S]<64&&B[S]>=32&&Pm||(t=at()),ft&&(S=ft.postBundlePosition,ft=null),ge&&(Y.restoreStructures=null),S==jt)Y&&Y.restoreStructures&&Ba(),Y=null,B=null,ne&&(ne=null);else{if(S>jt)throw new Error("Unexpected end of MessagePack data");if(!ge){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw Y&&Y.restoreStructures&&Ba(),$s(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||S>jt)&&(t.incomplete=!0),t}}function Ba(){for(let e in Y.restoreStructures)Y[e]=Y.restoreStructures[e];Y.restoreStructures=null}function at(){let e=B[S++];if(e<160)if(e<128){if(e<64)return e;{let t=Y[e&63]||et.getStructures&&Qc()[e&63];return t?(t.read||(t.read=oo(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,et.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=tu();r==="__proto__"&&(r="__proto_"),t[r]=at()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(at(),at());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=at();return et.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(qt>=S)return pe.slice(S-It,(S+=t)-It);if(qt==0&&jt<140){let n=t<16?ao(t):Zc(t);if(n!=null)return n}return Ms(t)}else{let t;switch(e){case 192:return null;case 193:return ft?(t=at(),t>0?ft[1].slice(ft.position1,ft.position1+=t):ft[0].slice(ft.position0,ft.position0-=t)):Xc;case 194:return!1;case 195:return!0;case 196:if(t=B[S++],t===void 0)throw new Error("Unexpected end of buffer");return ki(t);case 197:return t=V.getUint16(S),S+=2,ki(t);case 198:return t=V.getUint32(S),S+=4,ki(t);case 199:return _e(B[S++]);case 200:return t=V.getUint16(S),S+=2,_e(t);case 201:return t=V.getUint32(S),S+=4,_e(t);case 202:if(t=V.getFloat32(S),et.useFloat32>2){let n=lo[(B[S]&127)<<1|B[S+1]>>7];return S+=4,(n*t+(t>0?.5:-.5)>>0)/n}return S+=4,t;case 203:return t=V.getFloat64(S),S+=8,t;case 204:return B[S++];case 205:return t=V.getUint16(S),S+=2,t;case 206:return t=V.getUint32(S),S+=4,t;case 207:return et.int64AsType==="number"?(t=V.getUint32(S)*4294967296,t+=V.getUint32(S+4)):et.int64AsType==="string"?t=V.getBigUint64(S).toString():et.int64AsType==="auto"?(t=V.getBigUint64(S),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=V.getBigUint64(S),S+=8,t;case 208:return V.getInt8(S++);case 209:return t=V.getInt16(S),S+=2,t;case 210:return t=V.getInt32(S),S+=4,t;case 211:return et.int64AsType==="number"?(t=V.getInt32(S)*4294967296,t+=V.getUint32(S+4)):et.int64AsType==="string"?t=V.getBigInt64(S).toString():et.int64AsType==="auto"?(t=V.getBigInt64(S),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=V.getBigInt64(S),S+=8,t;case 212:if(t=B[S++],t==114)return Va(B[S++]&63);{let n=St[t];if(n)return n.read?(S++,n.read(at())):n.noBuffer?(S++,n()):n(B.subarray(S,++S));throw new Error("Unknown extension "+t)}case 213:return t=B[S],t==114?(S++,Va(B[S++]&63,B[S++])):_e(2);case 214:return _e(4);case 215:return _e(8);case 216:return _e(16);case 217:return t=B[S++],qt>=S?pe.slice(S-It,(S+=t)-It):Cm(t);case 218:return t=V.getUint16(S),S+=2,qt>=S?pe.slice(S-It,(S+=t)-It):Nm(t);case 219:return t=V.getUint32(S),S+=4,qt>=S?pe.slice(S-It,(S+=t)-It):Dm(t);case 220:return t=V.getUint16(S),S+=2,Fa(t);case 221:return t=V.getUint32(S),S+=4,Fa(t);case 222:return t=V.getUint16(S),S+=2,Ha(t);case 223:return t=V.getUint32(S),S+=4,Ha(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const km=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function oo(e,t){function n(){if(n.count++>Jc){let i=e.read=new Function("r","return function(){return "+(et.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":km.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(at);return e.highByte===0&&(e.read=za(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=at()}return et.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?za(t,n):n}const za=(e,t)=>function(){let n=B[S++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=Y[r]||Qc()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=oo(i,e)),i.read()};function Qc(){let e=ru(()=>(B=null,et.getStructures()));return Y=et._mergeStructures(e,Y)}var Ms=Bn,Cm=Bn,Nm=Bn,Dm=Bn;function Bn(e){let t;if(e<16&&(t=ao(e)))return t;if(e>64&&Es)return Es.decode(B.subarray(S,S+=e));const n=S+e,r=[];for(t="";S<n;){const i=B[S++];if((i&128)===0)r.push(i);else if((i&224)===192){const s=B[S++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=B[S++]&63,o=B[S++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=B[S++]&63,o=B[S++]&63,a=B[S++]&63;let l=(i&7)<<18|s<<12|o<<6|a;l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|l&1023),r.push(l)}else r.push(i);r.length>=4096&&(t+=ht.apply(String,r),r.length=0)}return r.length>0&&(t+=ht.apply(String,r)),t}function Fa(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=at();return et.freezeData?Object.freeze(t):t}function Ha(e){if(et.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=tu();r==="__proto__"&&(r="__proto_"),t[r]=at()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(at(),at());return t}}var ht=String.fromCharCode;function Zc(e){let t=S,n=new Array(e);for(let r=0;r<e;r++){const i=B[S++];if((i&128)>0){S=t;return}n[r]=i}return ht.apply(String,n)}function ao(e){if(e<4)if(e<2){if(e===0)return"";{let t=B[S++];if((t&128)>1){S-=1;return}return ht(t)}}else{let t=B[S++],n=B[S++];if((t&128)>0||(n&128)>0){S-=2;return}if(e<3)return ht(t,n);let r=B[S++];if((r&128)>0){S-=3;return}return ht(t,n,r)}else{let t=B[S++],n=B[S++],r=B[S++],i=B[S++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){S-=4;return}if(e<6){if(e===4)return ht(t,n,r,i);{let s=B[S++];if((s&128)>0){S-=5;return}return ht(t,n,r,i,s)}}else if(e<8){let s=B[S++],o=B[S++];if((s&128)>0||(o&128)>0){S-=6;return}if(e<7)return ht(t,n,r,i,s,o);let a=B[S++];if((a&128)>0){S-=7;return}return ht(t,n,r,i,s,o,a)}else{let s=B[S++],o=B[S++],a=B[S++],l=B[S++];if((s&128)>0||(o&128)>0||(a&128)>0||(l&128)>0){S-=8;return}if(e<10){if(e===8)return ht(t,n,r,i,s,o,a,l);{let u=B[S++];if((u&128)>0){S-=9;return}return ht(t,n,r,i,s,o,a,l,u)}}else if(e<12){let u=B[S++],h=B[S++];if((u&128)>0||(h&128)>0){S-=10;return}if(e<11)return ht(t,n,r,i,s,o,a,l,u,h);let c=B[S++];if((c&128)>0){S-=11;return}return ht(t,n,r,i,s,o,a,l,u,h,c)}else{let u=B[S++],h=B[S++],c=B[S++],f=B[S++];if((u&128)>0||(h&128)>0||(c&128)>0||(f&128)>0){S-=12;return}if(e<14){if(e===12)return ht(t,n,r,i,s,o,a,l,u,h,c,f);{let d=B[S++];if((d&128)>0){S-=13;return}return ht(t,n,r,i,s,o,a,l,u,h,c,f,d)}}else{let d=B[S++],y=B[S++];if((d&128)>0||(y&128)>0){S-=14;return}if(e<15)return ht(t,n,r,i,s,o,a,l,u,h,c,f,d,y);let w=B[S++];if((w&128)>0){S-=15;return}return ht(t,n,r,i,s,o,a,l,u,h,c,f,d,y,w)}}}}}function qa(){let e=B[S++],t;if(e<192)t=e-160;else switch(e){case 217:t=B[S++];break;case 218:t=V.getUint16(S),S+=2;break;case 219:t=V.getUint32(S),S+=4;break;default:throw new Error("Expected string")}return Bn(t)}function ki(e){return et.copyBuffers?Uint8Array.prototype.slice.call(B,S,S+=e):B.subarray(S,S+=e)}function _e(e){let t=B[S++];if(St[t]){let n;return St[t](B.subarray(S,n=S+=e),r=>{S=r;try{return at()}finally{S=n}})}else throw new Error("Unknown extension type "+t)}var Ga=new Array(4096);function tu(){let e=B[S++];if(e>=160&&e<192){if(e=e-160,qt>=S)return pe.slice(S-It,(S+=e)-It);if(!(qt==0&&jt<180))return Ms(e)}else return S--,eu(at());let t=(e<<5^(e>1?V.getUint16(S):e>0?B[S]:0))&4095,n=Ga[t],r=S,i=S+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=V.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=B[r++],s!=n[o++]){r=1879048192;break}if(r===i)return S=r,n.string;i-=3,r=S}for(n=[],Ga[t]=n,n.bytes=e;r<i;)s=V.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=B[r++],n.push(s);let a=e<16?ao(e):Zc(e);return a!=null?n.string=a:n.string=Ms(e)}function eu(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";if(et.allowArraysInMapKeys&&Array.isArray(e)&&e.flat().every(t=>["string","number","boolean","bigint"].includes(typeof t)))return e.flat().toString();throw new Error(`Invalid property type for record: ${typeof e}`)}const Va=(e,t)=>{let n=at().map(eu),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=Y[e];return i&&(i.isShared||ge)&&((Y.restoreStructures||(Y.restoreStructures=[]))[e]=i),Y[e]=n,n.read=oo(n,r),n.read()};St[0]=()=>{};St[0].noBuffer=!0;St[66]=e=>{let t=e.byteLength%8||8,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);if(e.byteLength!==t){let r=new DataView(e.buffer,e.byteOffset,e.byteLength),i=(s,o)=>{let a=o-s;if(a<=40){let c=r.getBigUint64(s);for(let f=s+8;f<o;f+=8)c<<=64n,c|=r.getBigUint64(f);return c}let l=s+(a>>4<<3),u=i(s,l),h=i(l,o);return u<<BigInt((o-l)*8)|h};n=n<<BigInt((r.byteLength-t)*8)|i(t,r.byteLength)}return n};let ja={Error,EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,AggregateError:typeof AggregateError=="function"?AggregateError:null};St[101]=()=>{let e=at();if(!ja[e[0]]){let t=Error(e[1],{cause:e[2]});return t.name=e[0],t}return ja[e[0]](e[1],{cause:e[2]})};St[105]=e=>{if(et.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=V.getUint32(S-4);ne||(ne=new Map);let n=B[S],r;n>=144&&n<160||n==220||n==221?r=[]:n>=128&&n<144||n==222||n==223?r=new Map:(n>=199&&n<=201||n>=212&&n<=216)&&B[S+1]===115?r=new Set:r={};let i={target:r};ne.set(t,i);let s=at();if(i.used)Object.assign(r,s);else return i.target=s;if(r instanceof Map)for(let[o,a]of s.entries())r.set(o,a);if(r instanceof Set)for(let o of Array.from(s))r.add(o);return r};St[112]=e=>{if(et.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=V.getUint32(S-4),n=ne.get(t);return n.used=!0,n.target};St[115]=()=>new Set(at());const nu=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let Rm=typeof globalThis=="object"?globalThis:window;St[116]=e=>{let t=e[0],n=Uint8Array.prototype.slice.call(e,1).buffer,r=nu[t];if(!r){if(t===16)return n;if(t===17)return new DataView(n);throw new Error("Could not find typed array for code "+t)}return new Rm[r](n)};St[120]=()=>{let e=at();return new RegExp(e[0],e[1])};const Om=[];St[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=S;return S+=t-e.length,ft=Om,ft=[qa(),qa()],ft.position0=0,ft.position1=0,ft.postBundlePosition=S,S=n,at()};St[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function ru(e){let t=jt,n=S,r=It,i=qt,s=pe,o=ne,a=ft,l=new Uint8Array(B.slice(0,jt)),u=Y,h=Y.slice(0,Y.length),c=et,f=ge,d=e();return jt=t,S=n,It=r,qt=i,pe=s,ne=o,ft=a,B=l,ge=f,Y=u,Y.splice(0,Y.length,...h),et=c,V=new DataView(B.buffer,B.byteOffset,B.byteLength),d}function $s(){B=null,ne=null,Y=null}const lo=new Array(147);for(let e=0;e<256;e++)lo[e]=+("1e"+Math.floor(45.15-e*.30103));var di=new Pn({useRecords:!1});const Lm=di.unpack;di.unpackMultiple;di.unpack;let Um=new Float32Array(1);new Uint8Array(Um.buffer,0,4);let mr;try{mr=new TextEncoder}catch{}let As,Is;const tn=typeof Buffer<"u",nr=tn?function(e){return Buffer.allocUnsafeSlow(e)}:Uint8Array,iu=tn?Buffer:Uint8Array,Ya=tn?4294967296:2144337920;let $,an,tt,E=0,gt,it=null,Bm;const zm=21760,Fm=/[\u0080-\uFFFF]/,Le=Symbol("record-id");class Hm extends Pn{constructor(t){super(t),this.offset=0;let n,r,i,s,o=iu.prototype.utf8Write?function(_,p){return $.utf8Write(_,p,$.byteLength-p)}:mr&&mr.encodeInto?function(_,p){return mr.encodeInto(_,$.subarray(p)).written}:!1,a=this;t||(t={});let l=t&&t.sequential,u=t.structures||t.saveStructures,h=t.maxSharedStructures;if(h==null&&(h=u?32:0),h>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let c=t.maxOwnStructures;c==null&&(c=u?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let f=h>32||c+h>64,d=h+64,y=h+c+64;if(y>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let w=[],M=0,v=0;this.pack=this.encode=function(_,p){if($||($=new nr(8192),tt=$.dataView||($.dataView=new DataView($.buffer,0,8192)),E=0),gt=$.length-10,gt-E<2048?($=new nr($.length),tt=$.dataView||($.dataView=new DataView($.buffer,0,$.length)),gt=$.length-10,E=0):E=E+7&2147483640,n=E,p&Ym&&(E+=p&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof _!="string"?(it=[],it.size=1/0):it=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let g=i.sharedLength||0;if(g>h)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let x=0;x<g;x++){let k=i[x];if(!k)continue;let P,D=i.transitions;for(let z=0,H=k.length;z<H;z++){let X=k[z];P=D[X],P||(P=D[X]=Object.create(null)),D=P}D[Le]=x+64}this.lastNamedStructuresLength=g}l||(i.nextId=g+64)}r&&(r=!1);let m;try{a.randomAccessStructure&&_&&typeof _=="object"?_.constructor===Object?F(_):_.constructor!==Map&&!Array.isArray(_)&&!Is.some(x=>_ instanceof x)?F(_.toJSON?_.toJSON():_):b(_):b(_);let g=it;if(it&&Ka(n,b,0),s&&s.idsToInsert){let x=s.idsToInsert.sort((z,H)=>z.offset>H.offset?1:-1),k=x.length,P=-1;for(;g&&k>0;){let z=x[--k].offset+n;z<g.stringsPosition+n&&P===-1&&(P=0),z>g.position+n?P>=0&&(P+=6):(P>=0&&(tt.setUint32(g.position+n,tt.getUint32(g.position+n)+P),P=-1),g=g.previous,k++)}P>=0&&g&&tt.setUint32(g.position+n,tt.getUint32(g.position+n)+P),E+=x.length*6,E>gt&&N(E),a.offset=E;let D=qm($.subarray(n,E),x);return s=null,D}return a.offset=E,p&Vm?($.start=n,$.end=E,$):$.subarray(n,E)}catch(g){throw m=g,g}finally{if(i&&(T(),r&&a.saveStructures)){let g=i.sharedLength||0,x=$.subarray(n,E),k=Gm(i,a);if(!m)return a.saveStructures(k,k.isCompatible)===!1?a.pack(_,p):(a.lastNamedStructuresLength=g,$.length>1073741824&&($=null),x)}$.length>1073741824&&($=null),p&jm&&(E=n)}};const T=()=>{v<10&&v++;let _=i.sharedLength||0;if(i.length>_&&!l&&(i.length=_),M>1e4)i.transitions=null,v=0,M=0,w.length>0&&(w=[]);else if(w.length>0&&!l){for(let p=0,m=w.length;p<m;p++)w[p][Le]=0;w=[]}},A=_=>{var p=_.length;p<16?$[E++]=144|p:p<65536?($[E++]=220,$[E++]=p>>8,$[E++]=p&255):($[E++]=221,tt.setUint32(E,p),E+=4);for(let m=0;m<p;m++)b(_[m])},b=_=>{E>gt&&($=N(E));var p=typeof _,m;if(p==="string"){let g=_.length;if(it&&g>=4&&g<4096){if((it.size+=g)>zm){let D,z=(it[0]?it[0].length*3+it[1].length:0)+10;E+z>gt&&($=N(E+z));let H;it.position?(H=it,$[E]=200,E+=3,$[E++]=98,D=E-n,E+=4,Ka(n,b,0),tt.setUint16(D+n-3,E-n-D)):($[E++]=214,$[E++]=98,D=E-n,E+=4),it=["",""],it.previous=H,it.size=0,it.position=D}let P=Fm.test(_);it[P?0:1]+=_,$[E++]=193,b(P?-g:g);return}let x;g<32?x=1:g<256?x=2:g<65536?x=3:x=5;let k=g*3;if(E+k>gt&&($=N(E+k)),g<64||!o){let P,D,z,H=E+x;for(P=0;P<g;P++)D=_.charCodeAt(P),D<128?$[H++]=D:D<2048?($[H++]=D>>6|192,$[H++]=D&63|128):(D&64512)===55296&&((z=_.charCodeAt(P+1))&64512)===56320?(D=65536+((D&1023)<<10)+(z&1023),P++,$[H++]=D>>18|240,$[H++]=D>>12&63|128,$[H++]=D>>6&63|128,$[H++]=D&63|128):($[H++]=D>>12|224,$[H++]=D>>6&63|128,$[H++]=D&63|128);m=H-E-x}else m=o(_,E+x);m<32?$[E++]=160|m:m<256?(x<2&&$.copyWithin(E+2,E+1,E+1+m),$[E++]=217,$[E++]=m):m<65536?(x<3&&$.copyWithin(E+3,E+2,E+2+m),$[E++]=218,$[E++]=m>>8,$[E++]=m&255):(x<5&&$.copyWithin(E+5,E+3,E+3+m),$[E++]=219,tt.setUint32(E,m),E+=4),E+=m}else if(p==="number")if(_>>>0===_)_<32||_<128&&this.useRecords===!1||_<64&&!this.randomAccessStructure?$[E++]=_:_<256?($[E++]=204,$[E++]=_):_<65536?($[E++]=205,$[E++]=_>>8,$[E++]=_&255):($[E++]=206,tt.setUint32(E,_),E+=4);else if(_>>0===_)_>=-32?$[E++]=256+_:_>=-128?($[E++]=208,$[E++]=_+256):_>=-32768?($[E++]=209,tt.setInt16(E,_),E+=2):($[E++]=210,tt.setInt32(E,_),E+=4);else{let g;if((g=this.useFloat32)>0&&_<4294967296&&_>=-2147483648){$[E++]=202,tt.setFloat32(E,_);let x;if(g<4||(x=_*lo[($[E]&127)<<1|$[E+1]>>7])>>0===x){E+=4;return}else E--}$[E++]=203,tt.setFloat64(E,_),E+=8}else if(p==="object"||p==="function")if(!_)$[E++]=192;else{if(s){let x=s.get(_);if(x){if(!x.id){let k=s.idsToInsert||(s.idsToInsert=[]);x.id=k.push(x)}$[E++]=214,$[E++]=112,tt.setUint32(E,x.id),E+=4;return}else s.set(_,{offset:E-n})}let g=_.constructor;if(g===Object)O(_);else if(g===Array)A(_);else if(g===Map)if(this.mapAsEmptyObject)$[E++]=128;else{m=_.size,m<16?$[E++]=128|m:m<65536?($[E++]=222,$[E++]=m>>8,$[E++]=m&255):($[E++]=223,tt.setUint32(E,m),E+=4);for(let[x,k]of _)b(x),b(k)}else{for(let x=0,k=As.length;x<k;x++){let P=Is[x];if(_ instanceof P){let D=As[x];if(D.write){D.type&&($[E++]=212,$[E++]=D.type,$[E++]=0);let rt=D.write.call(this,_);rt===_?Array.isArray(_)?A(_):O(_):b(rt);return}let z=$,H=tt,X=E;$=null;let J;try{J=D.pack.call(this,_,rt=>($=z,z=null,E+=rt,E>gt&&N(E),{target:$,targetView:tt,position:E-rt}),b)}finally{z&&($=z,tt=H,E=X,gt=$.length-10)}J&&(J.length+E>gt&&N(J.length+E),E=Wa(J,$,E,D.type));return}}if(Array.isArray(_))A(_);else{if(_.toJSON){const x=_.toJSON();if(x!==_)return b(x)}if(p==="function")return b(this.writeFunction&&this.writeFunction(_));O(_)}}}else if(p==="boolean")$[E++]=_?195:194;else if(p==="bigint"){if(_<9223372036854776e3&&_>=-9223372036854776e3)$[E++]=211,tt.setBigInt64(E,_);else if(_<18446744073709552e3&&_>0)$[E++]=207,tt.setBigUint64(E,_);else if(this.largeBigIntToFloat)$[E++]=203,tt.setFloat64(E,Number(_));else{if(this.largeBigIntToString)return b(_.toString());if(this.useBigIntExtension||this.moreTypes){let g=_<0?BigInt(-1):BigInt(0),x;if(_>>BigInt(65536)===g){let k=BigInt(18446744073709552e3)-BigInt(1),P=[];for(;P.push(_&k),_>>BigInt(63)!==g;)_>>=BigInt(64);x=new Uint8Array(new BigUint64Array(P).buffer),x.reverse()}else{let k=_<0,P=(k?~_:_).toString(16);if(P.length%2?P="0"+P:parseInt(P.charAt(0),16)>=8&&(P="00"+P),tn)x=Buffer.from(P,"hex");else{x=new Uint8Array(P.length/2);for(let D=0;D<x.length;D++)x[D]=parseInt(P.slice(D*2,D*2+2),16)}if(k)for(let D=0;D<x.length;D++)x[D]=~x[D]}x.length+E>gt&&N(x.length+E),E=Wa(x,$,E,66);return}else throw new RangeError(_+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}E+=8}else if(p==="undefined")this.encodeUndefinedAsNil?$[E++]=192:($[E++]=212,$[E++]=0,$[E++]=0);else throw new Error("Unknown type: "+p)},C=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?_=>{let p;if(this.skipValues){p=[];for(let x in _)(typeof _.hasOwnProperty!="function"||_.hasOwnProperty(x))&&!this.skipValues.includes(_[x])&&p.push(x)}else p=Object.keys(_);let m=p.length;m<16?$[E++]=128|m:m<65536?($[E++]=222,$[E++]=m>>8,$[E++]=m&255):($[E++]=223,tt.setUint32(E,m),E+=4);let g;if(this.coercibleKeyAsNumber)for(let x=0;x<m;x++){g=p[x];let k=Number(g);b(isNaN(k)?g:k),b(_[g])}else for(let x=0;x<m;x++)b(g=p[x]),b(_[g])}:_=>{$[E++]=222;let p=E-n;E+=2;let m=0;for(let g in _)(typeof _.hasOwnProperty!="function"||_.hasOwnProperty(g))&&(b(g),b(_[g]),m++);if(m>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');$[p+++n]=m>>8,$[p+n]=m&255},R=this.useRecords===!1?C:t.progressiveRecords&&!f?_=>{let p,m=i.transitions||(i.transitions=Object.create(null)),g=E++-n,x;for(let k in _)if(typeof _.hasOwnProperty!="function"||_.hasOwnProperty(k)){if(p=m[k],p)m=p;else{let P=Object.keys(_),D=m;m=i.transitions;let z=0;for(let H=0,X=P.length;H<X;H++){let J=P[H];p=m[J],p||(p=m[J]=Object.create(null),z++),m=p}g+n+1==E?(E--,U(m,P,z)):I(m,P,g,z),x=!0,m=D[k]}b(_[k])}if(!x){let k=m[Le];k?$[g+n]=k:I(m,Object.keys(_),g,0)}}:_=>{let p,m=i.transitions||(i.transitions=Object.create(null)),g=0;for(let k in _)(typeof _.hasOwnProperty!="function"||_.hasOwnProperty(k))&&(p=m[k],p||(p=m[k]=Object.create(null),g++),m=p);let x=m[Le];x?x>=96&&f?($[E++]=((x-=96)&31)+96,$[E++]=x>>5):$[E++]=x:U(m,m.__keys__||Object.keys(_),g);for(let k in _)(typeof _.hasOwnProperty!="function"||_.hasOwnProperty(k))&&b(_[k])},L=typeof this.useRecords=="function"&&this.useRecords,O=L?_=>{L(_)?R(_):C(_)}:R,N=_=>{let p;if(_>16777216){if(_-n>Ya)throw new Error("Packed buffer would be larger than maximum buffer size");p=Math.min(Ya,Math.round(Math.max((_-n)*(_>67108864?1.25:2),4194304)/4096)*4096)}else p=(Math.max(_-n<<2,$.length-1)>>12)+1<<12;let m=new nr(p);return tt=m.dataView||(m.dataView=new DataView(m.buffer,0,p)),_=Math.min(_,$.length),$.copy?$.copy(m,0,n,_):m.set($.slice(n,_)),E-=n,n=0,gt=m.length-10,$=m},U=(_,p,m)=>{let g=i.nextId;g||(g=64),g<d&&this.shouldShareStructure&&!this.shouldShareStructure(p)?(g=i.nextOwnId,g<y||(g=d),i.nextOwnId=g+1):(g>=y&&(g=d),i.nextId=g+1);let x=p.highByte=g>=96&&f?g-96>>5:-1;_[Le]=g,_.__keys__=p,i[g-64]=p,g<d?(p.isShared=!0,i.sharedLength=g-63,r=!0,x>=0?($[E++]=(g&31)+96,$[E++]=x):$[E++]=g):(x>=0?($[E++]=213,$[E++]=114,$[E++]=(g&31)+96,$[E++]=x):($[E++]=212,$[E++]=114,$[E++]=g),m&&(M+=v*m),w.length>=c&&(w.shift()[Le]=0),w.push(_),b(p))},I=(_,p,m,g)=>{let x=$,k=E,P=gt,D=n;$=an,E=0,n=0,$||(an=$=new nr(8192)),gt=$.length-10,U(_,p,g),an=$;let z=E;if($=x,E=k,gt=P,n=D,z>1){let H=E+z-1;H>gt&&N(H);let X=m+n;$.copyWithin(X+z,X+1,E),$.set(an.slice(0,z),X),E=H}else $[m+n]=an[0]},F=_=>{let p=Bm(_,$,n,E,i,N,(m,g,x)=>{if(x)return r=!0;E=g;let k=$;return b(m),T(),k!==$?{position:E,targetView:tt,target:$}:E},this);if(p===0)return O(_);E=p}}useBuffer(t){$=t,$.dataView||($.dataView=new DataView($.buffer,$.byteOffset,$.byteLength)),tt=$.dataView,E=0}set position(t){E=t}get position(){return E}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}Is=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,DataView,Kc];As=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?Ci(e,16,t):Ni(tn?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==iu&&this.moreTypes?Ci(e,nu.indexOf(n.name),t):Ni(e,t)}},{pack(e,t){this.moreTypes?Ci(e,17,t):Ni(tn?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function Ci(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function Ni(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function Wa(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function qm(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function Ka(e,t,n){if(it.length>0){tt.setUint32(it.position+e,E+n-it.position-e),it.stringsPosition=E-e;let r=it;it=null,t(r[0]),t(r[1])}}function Gm(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let su=new Hm({useRecords:!1});su.pack;su.pack;const Vm=512,jm=1024,Ym=2048;(!globalThis.EventTarget||!globalThis.Event)&&console.error(`
  PartySocket requires a global 'EventTarget' class to be available!
  You can polyfill this global by adding this to your code before any partysocket imports: 
  
  \`\`\`
  import 'partysocket/event-target-polyfill';
  \`\`\`
  Please file an issue at https://github.com/partykit/partykit if you're still having trouble.
`);var ou=class extends Event{message;error;constructor(e,t){super("error",t),this.message=e.message,this.error=e}},au=class extends Event{code;reason;wasClean=!0;constructor(e=1e3,t="",n){super("close",n),this.code=e,this.reason=t}};const Di={Event,ErrorEvent:ou,CloseEvent:au};function Wm(e,t){if(!e)throw new Error(t)}function Km(e){return new e.constructor(e.type,e)}function Xm(e){return"data"in e?new MessageEvent(e.type,e):"code"in e||"reason"in e?new au(e.code||1999,e.reason||"unknown reason",e):"error"in e?new ou(e.error,e):new Event(e.type,e)}const rr=typeof process<"u"&&typeof process.versions?.node<"u"&&typeof document>"u"?Xm:Km,we={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:Number.POSITIVE_INFINITY,maxEnqueuedMessages:Number.POSITIVE_INFINITY};let Xa=!1;var Jm=class ve extends EventTarget{_ws;_retryCount=-1;_uptimeTimeout;_connectTimeout;_shouldReconnect=!0;_connectLock=!1;_binaryType="blob";_closeCalled=!1;_messageQueue=[];_debugLogger=console.log.bind(console);_url;_protocols;_options;constructor(t,n,r={}){super(),this._url=t,this._protocols=n,this._options=r,this._options.startClosed&&(this._shouldReconnect=!1),this._options.debugLogger&&(this._debugLogger=this._options.debugLogger),this._connect()}static get CONNECTING(){return 0}static get OPEN(){return 1}static get CLOSING(){return 2}static get CLOSED(){return 3}get CONNECTING(){return ve.CONNECTING}get OPEN(){return ve.OPEN}get CLOSING(){return ve.CLOSING}get CLOSED(){return ve.CLOSED}get binaryType(){return this._ws?this._ws.binaryType:this._binaryType}set binaryType(t){this._binaryType=t,this._ws&&(this._ws.binaryType=t)}get retryCount(){return Math.max(this._retryCount,0)}get bufferedAmount(){return this._messageQueue.reduce((t,n)=>(typeof n=="string"?t+=n.length:n instanceof Blob?t+=n.size:t+=n.byteLength,t),0)+(this._ws?this._ws.bufferedAmount:0)}get extensions(){return this._ws?this._ws.extensions:""}get protocol(){return this._ws?this._ws.protocol:""}get readyState(){return this._ws?this._ws.readyState:this._options.startClosed?ve.CLOSED:ve.CONNECTING}get url(){return this._ws?this._ws.url:""}get shouldReconnect(){return this._shouldReconnect}onclose=null;onerror=null;onmessage=null;onopen=null;close(t=1e3,n){if(this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(t,n)}reconnect(t,n){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(t,n),this._connect())}send(t){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",t),this._ws.send(t);else{const{maxEnqueuedMessages:n=we.maxEnqueuedMessages}=this._options;this._messageQueue.length<n&&(this._debug("enqueue",t),this._messageQueue.push(t))}}_debug(...t){this._options.debug&&this._debugLogger("RWS>",...t)}_getNextDelay(){const{reconnectionDelayGrowFactor:t=we.reconnectionDelayGrowFactor,minReconnectionDelay:n=we.minReconnectionDelay,maxReconnectionDelay:r=we.maxReconnectionDelay}=this._options;let i=0;return this._retryCount>0&&(i=n*t**(this._retryCount-1),i>r&&(i=r)),this._debug("next delay",i),i}_wait(){return new Promise(t=>{setTimeout(t,this._getNextDelay())})}_getNextProtocols(t){if(!t)return Promise.resolve(null);if(typeof t=="string"||Array.isArray(t))return Promise.resolve(t);if(typeof t=="function"){const n=t();if(!n)return Promise.resolve(null);if(typeof n=="string"||Array.isArray(n))return Promise.resolve(n);if(n.then)return n}throw Error("Invalid protocols")}_getNextUrl(t){if(typeof t=="string")return Promise.resolve(t);if(typeof t=="function"){const n=t();if(typeof n=="string")return Promise.resolve(n);if(n.then)return n}throw Error("Invalid URL")}_connect(){if(this._connectLock||!this._shouldReconnect)return;this._connectLock=!0;const{maxRetries:t=we.maxRetries,connectionTimeout:n=we.connectionTimeout}=this._options;if(this._retryCount>=t){this._debug("max retries reached",this._retryCount,">=",t);return}this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),this._wait().then(()=>Promise.all([this._getNextUrl(this._url),this._getNextProtocols(this._protocols||null)])).then(([r,i])=>{if(this._closeCalled){this._connectLock=!1;return}!this._options.WebSocket&&typeof WebSocket>"u"&&!Xa&&(console.error(` No WebSocket implementation available. You should define options.WebSocket. 

For example, if you're using node.js, run \`npm install ws\`, and then in your code:

import PartySocket from 'partysocket';
import WS from 'ws';

const partysocket = new PartySocket({
  host: "127.0.0.1:1999",
  room: "test-room",
  WebSocket: WS
});

`),Xa=!0);const s=this._options.WebSocket||WebSocket;this._debug("connect",{url:r,protocols:i}),this._ws=i?new s(r,i):new s(r),this._ws.binaryType=this._binaryType,this._connectLock=!1,this._addListeners(),this._connectTimeout=setTimeout(()=>this._handleTimeout(),n)}).catch(r=>{this._connectLock=!1,this._handleError(new Di.ErrorEvent(Error(r.message),this))})}_handleTimeout(){this._debug("timeout event"),this._handleError(new Di.ErrorEvent(Error("TIMEOUT"),this))}_disconnect(t=1e3,n){if(this._clearTimeouts(),!!this._ws){this._removeListeners();try{(this._ws.readyState===this.OPEN||this._ws.readyState===this.CONNECTING)&&this._ws.close(t,n),this._handleClose(new Di.CloseEvent(t,n,this))}catch{}}}_acceptOpen(){this._debug("accept open"),this._retryCount=0}_handleOpen=t=>{this._debug("open event");const{minUptime:n=we.minUptime}=this._options;clearTimeout(this._connectTimeout),this._uptimeTimeout=setTimeout(()=>this._acceptOpen(),n),Wm(this._ws,"WebSocket is not defined"),this._ws.binaryType=this._binaryType,this._messageQueue.forEach(r=>{this._ws?.send(r)}),this._messageQueue=[],this.onopen&&this.onopen(t),this.dispatchEvent(rr(t))};_handleMessage=t=>{this._debug("message event"),this.onmessage&&this.onmessage(t),this.dispatchEvent(rr(t))};_handleError=t=>{this._debug("error event",t.message),this._disconnect(void 0,t.message==="TIMEOUT"?"timeout":void 0),this.onerror&&this.onerror(t),this._debug("exec error listeners"),this.dispatchEvent(rr(t)),this._connect()};_handleClose=t=>{this._debug("close event"),this._clearTimeouts(),this._shouldReconnect&&this._connect(),this.onclose&&this.onclose(t),this.dispatchEvent(rr(t))};_removeListeners(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))}_addListeners(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))}_clearTimeouts(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)}};const Qm=e=>e[1]!==null&&e[1]!==void 0;function Zm(){if(crypto?.randomUUID)return crypto.randomUUID();let e=Date.now(),t=performance?.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){let r=Math.random()*16;return e>0?(r=(e+r)%16|0,e=Math.floor(e/16)):(r=(t+r)%16|0,t=Math.floor(t/16)),(n==="x"?r:r&3|8).toString(16)})}function lu(e,t,n={}){const{host:r,path:i,protocol:s,room:o,party:a,basePath:l,prefix:u,query:h}=e;let c=r.replace(/^(http|https|ws|wss):\/\//,"");if(c.endsWith("/")&&(c=c.slice(0,-1)),i?.startsWith("/"))throw new Error("path must not start with a slash");const f=a??"main",d=i?`/${i}`:"",y=s||(c.startsWith("localhost:")||c.startsWith("127.0.0.1:")||c.startsWith("192.168.")||c.startsWith("10.")||c.startsWith("172.")&&c.split(".")[1]>="16"&&c.split(".")[1]<="31"||c.startsWith("[::ffff:7f00:1]:")?t:`${t}s`),w=`${y}://${c}/${l||`${u||"parties"}/${f}/${o}`}${d}`,M=(T={})=>`${w}?${new URLSearchParams([...Object.entries(n),...Object.entries(T).filter(Qm)])}`,v=typeof h=="function"?async()=>M(await h()):M(h);return{host:c,path:d,room:o,name:f,protocol:y,partyUrl:w,urlProvider:v}}var ir=class extends Jm{_pk;_pkurl;name;room;host;path;constructor(e){const t=Ja(e);super(t.urlProvider,t.protocols,t.socketOptions),this.partySocketOptions=e,this.setWSProperties(t),e.disableNameValidation||(e.party?.includes("/")&&console.warn(`PartySocket: party name "${e.party}" contains forward slash which may cause routing issues. Consider using a name without forward slashes or set disableNameValidation: true to bypass this warning.`),e.room?.includes("/")&&console.warn(`PartySocket: room name "${e.room}" contains forward slash which may cause routing issues. Consider using a name without forward slashes or set disableNameValidation: true to bypass this warning.`))}updateProperties(e){const t=Ja({...this.partySocketOptions,...e,host:e.host??this.host,room:e.room??this.room,path:e.path??this.path});this._url=t.urlProvider,this._protocols=t.protocols,this._options=t.socketOptions,this.setWSProperties(t)}setWSProperties(e){const{_pk:t,_pkurl:n,name:r,room:i,host:s,path:o}=e;this._pk=t,this._pkurl=n,this.name=r,this.room=i,this.host=s,this.path=o}reconnect(e,t){if(!this.room||!this.host)throw new Error("The room and host must be set before connecting, use `updateProperties` method to set them or pass them to the constructor.");super.reconnect(e,t)}get id(){return this._pk}get roomUrl(){return this._pkurl}static async fetch(e,t){const n=lu(e,"http"),r=typeof n.urlProvider=="string"?n.urlProvider:await n.urlProvider();return(e.fetch??fetch)(r,t)}};function Ja(e){const{id:t,host:n,path:r,party:i,room:s,protocol:o,query:a,protocols:l,...u}=e,h=t||Zm(),c=lu(e,"ws",{_pk:h});return{_pk:h,_pkurl:c.partyUrl,name:c.name,room:c.room,host:c.host,path:c.path,protocols:l,socketOptions:u,urlProvider:c.urlProvider}}const Ri=()=>Dc(5);class yr extends Vc{getPlayer(){return this.thisPlayer}mount(t){this.appRoot=t,this.appRoot.gameManager=this,this.#t()}async connect(){this.gameStop(),this.status="WAITING";const t=await this.initializePlayer();this.thisPlayer=this.onPlayerJoin(t),this.playerId=this.thisPlayer.id,this.events.emit(Q.GAME_INIT,void 0),this.appRoot.showStartDialog()}async start(){this.savePlayerData(),this.gameSetup(),this.gameStart(),Z()}savePlayerData(){const t=this.state.playerMap.get(this.playerId);t&&(localStorage.setItem("starz_playerId",t.id),localStorage.setItem("starz_playerName",t.name),localStorage.setItem("starz_score",t.score?.score?.toString()??"0"))}gameSetup(){const t=this.getFnContext(),n=Array.from(t.S.playerMap.values());this.state=this.game.setup(t),Og(),this.state.playerMap.clear();for(let r=0;r<n.length;r++){const i=n[r];this.onPlayerJoin(i),this.game.assignSystem(this.state,i.id)}this.thisPlayer=this.state.playerMap.get(this.playerId),this.setupThisPlayer(this.playerId)}async initializePlayer(){const t=this.playerId=localStorage.getItem("starz_playerId")??Ri(),n=localStorage.getItem("starz_playerName")??this.config.playerName,r=+(localStorage.getItem("starz_score")??0);return{id:t,name:n,score:{score:r}}}gameStart(){_i("starz_gamesStarted"),super.gameStart(),tr("Game started.");const t=this.state.playerMap.get(this.playerId);t&&tr(`You are ${t.name}.`)}gameStop(){super.gameStop(),Ee(),Z()}pauseToggle(){this.status==="PAUSED"?(this.status="PLAYING",super.startGameLoop()):this.status==="PLAYING"&&(this.status="PAUSED",super.stopGameLoop())}showEndGame(t){return this.appRoot.showEndGame(t)}async quit(){await this.showEndGame("Are you sure you want to quit?")&&this.game.eliminatePlayer(this.getFnContext(),this.playerId)}async onPlayerWin(t,n){n&&tr(n),this.game.revealAllSystems(this.state),Ee();let r=!1;t===this.playerId?(_i("starz_gamesWon"),r=await this.showEndGame("You have conquered The Bubble!")):(_i("starz_gamesLost",{winnerId:t}),r=await this.showEndGame("You have lost your homeworld! Click to return to lobby.  ESC to spectate.")),r&&this.restart()}restart(){this.stopGameLoop(),Ee(),this.tick=0,this.state=this.game.initalState(),this.connect()}onEliminatePlayer(t,n){const r=this.state.playerMap.get(t),i=this.state.playerMap.get(n),s=n===null?`${r.name} has been eliminated!`:`${i.name} has eliminated ${r.name}!`;tr(s),t===this.playerId?(this.submitWinLoss(-1),this.onPlayerWin(n)):n===this.playerId&&this.submitWinLoss(1)}async submitWinLoss(t){const n=+(localStorage.getItem("starz_score")??0)+t;localStorage.setItem("starz_score",n.toString())}addBot(){if(this.state.playerMap.size>=th)return;const t=Array.from(this.state.playerMap.values());if(t.filter(o=>o.bot).length>=Us)return;const r=Ri(),i=Qa(t.map(o=>o.name)),s=new _g({id:r,name:i});return this.onPlayerJoin({id:r,name:i,bot:s})}removeBot(t){this.state.playerMap.get(t)?.bot&&this.onPlayerLeave(t)}onPlayerJoin(t={}){const n=Array.from(this.state.playerMap.values()),r=t.id??Ri(),i=t.name??Qa(n.map(a=>a.name)),s=t.color??ty(n.map(a=>a.color)),o=super.addPlayer({id:r,name:i,color:s,...t});return document.documentElement.style.setProperty(`--player-${o.id}`,o.color),this.events.emit(Q.PLAYER_JOINED,{player:o}),o}onPlayerLeave(t){this.state.playerMap.delete(t),this.events.emit(Q.PLAYER_REMOVED,{playerId:t})}setupThisPlayer(t){this.playerId=t;const n=this.state.playerMap.get(t),r=this.game.getPlayersHomeworld(this.state);this.game.visitSystem(this.state,r),bs(),n.bot||(Ee(),Tn(r.id)),this.savePlayerData()}updatePlayerName(t){const n=this.state.playerMap.get(this.playerId);n&&(n.name=t,this.events.emit(Q.PLAYER_UPDATED,{player:n}),localStorage.setItem("starz_playerName",n.name))}#t(){this.events.on(Q.PLAYER_WIN,({playerId:t,message:n})=>{this.onPlayerWin(t,n)}),this.events.on(Q.PLAYER_ELIMINATED,({loserId:t,winnerId:n})=>{this.onEliminatePlayer(t,n)})}}function ty(e){const t=[...sh].filter(n=>!e.includes(n));return t.length===0?ey():t[Math.floor(Math.random()*t.length)]}function Qa(e){let t=ys();for(;e.includes(t);)t=ys();return t}function ey(){const e="0123456789ABCDEF";let t="#";for(let n=0;n<6;n++)t+=e[Math.floor(Math.random()*16)];return t}const ny={LEADERBOARD_UPDATED:"LEADERBOARD_UPDATED"},cu="ABCDEFGHJKLMNPQRSTUVWXYZ234567",ry=Nc(cu,15),iy=Nc(cu,15),sr={host:"https://starz.hypercubed.dev/",party:"lobby-server",room:"leaderboard"};class _n extends yr{playkitConnect(){this.lobbySocket=new ir(sr),this.#t()}async start(){localStorage.setItem("starz_playerToken",this.playerToken),super.start()}getHeaders(){return{"Content-Type":"application/json",Authorization:`Bearer ${this.playerToken}`}}async loadPlayerFromPlaykit(t){const n=await this.getScore(t);return n?{id:t,name:n.name,score:{score:n.score,rank:n.rank}}:null}async initializePlayer(){console.log("Initializing player..."),this.playkitConnect();const t=await super.initializePlayer();if(this.playerId??=ry(),t.id=this.playerId,this.playerToken=localStorage.getItem("starz_playerToken"),this.playerToken&&t.id){const n=await this.loadPlayerFromPlaykit(t.id);t.id=n?.id??t.id,t.name=n?.name??t.name,t.score=n?.score??t.score}return t}async getScore(t){return this.lobbySocket?await(await ir.fetch({...sr,path:"score",query:{playerId:t}},{method:"GET",headers:this.getHeaders()})).json():void 0}async submitWinLoss(t){if(super.submitWinLoss(t),!this.lobbySocket||t===0)return;console.assert(t===1||t===-1,"deltaScore must be 1 or -1");const n=this.state.playerMap.get(this.playerId);if(!n)return;const r={type:t>0?"increment":"decrement",uid:this.playerId,name:n.name};this.playerToken||(this.playerToken=iy()),ir.fetch({...sr,path:"score"},{method:"POST",body:JSON.stringify(r),headers:this.getHeaders()})}async setPlayerAuth(t,n){if(n&&t){this.playerId=t,this.playerToken=n;const r=await this.loadPlayerFromPlaykit(t);this.thisPlayer.id=r?.id??this.thisPlayer.id,this.thisPlayer.name=r?.name??this.thisPlayer.name,this.thisPlayer.score=r?.score??this.thisPlayer.score,this.updatePlayerName(this.thisPlayer.name)}localStorage.setItem("starz_playerToken",this.playerToken),localStorage.setItem("starz_playerId",this.playerId),localStorage.setItem("starz_playerName",this.thisPlayer.name)}async loadLeaderboard(){return this.lobbySocket?await(await ir.fetch({...sr},{method:"GET",headers:{"Content-Type":"application/json"}})).json():[]}#t(){if(!this.lobbySocket)return null;this.lobbySocket.addEventListener("message",async t=>{const n=t.data instanceof Blob?Lm(await t.data.arrayBuffer()):JSON.parse(t.data);n.type===ny.LEADERBOARD_UPDATED?this.events.emit("LEADERBOARD_UPDATED",{leaderboard:n.data}):"message"in n?console.log(n.message):"error"in n&&console.error("PartyKit error:",n.error)})}}var sy=Object.defineProperty,oy=Object.getOwnPropertyDescriptor,pi=(e,t,n,r)=>{for(var i=r>1?void 0:r?oy(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&sy(t,n,i),i};const ay=oi(".3~s"),Ue="";let kn=class extends Lt{constructor(){super(...arguments),this.leaderboard=[],this.showMore=!1}createRenderRoot(){return this}async connectedCallback(){super.connectedCallback(),this.gameManager instanceof _n&&(this.leaderboard=await this.gameManager.loadLeaderboard(),this.gameManager.events.on(Q.LEADERBOARD_UPDATED,async({leaderboard:e})=>{this.leaderboard=e}))}render(){return!this.leaderboard||this.leaderboard.length===0?ot``:ot`
      <table id="leaderbox">
        ${this.renderHeader()} ${this.renderBody()}
      </table>
      ${this.leaderboard.length>5?ot`
      <details @toggle="${this.onOpenMore}">
        <summary>Show More</summary>
      </details>`:""}
    `}renderBody(){return ot`<tbody>
      ${this.leaderboard.slice(0,5).map(Za)}
      ${this.showMore?this.leaderboard.slice(5,21).map(Za):""}
    </tbody>`}renderHeader(){return ot`<thead>
      <tr>
        <th>#</th>
        <th>Name</th>
        <th></th>
      </tr>
    </thead>`}onOpenMore(){this.showMore=!this.showMore}};pi([Nn({context:en}),dt()],kn.prototype,"gameManager",2);pi([dt()],kn.prototype,"leaderboard",2);pi([dt()],kn.prototype,"showMore",2);kn=pi([Ce("lobby-leaderboard-element")],kn);function Za(e){const t=e.uid?.slice(0,4)??"";return ot`<tr>
    <td>${Ue}${e.rank}${Ue}</td>
    <td>${Ue}${e.name}<span class="short-id">#${t}</span>${Ue}</td>
    <td>${Ue}${ay(e.score)}${Ue}</td>
  </tr>`}var ly=Object.defineProperty,cy=Object.getOwnPropertyDescriptor,uu=(e,t,n,r)=>{for(var i=r>1?void 0:r?cy(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&ly(t,n,i),i};let Ts=class extends Lt{constructor(){super(...arguments),this.tick=0}createRenderRoot(){return this}render(){const e=~~(this.tick/2),t=this.tick%2===1?".":"";return ot`${e}${t}`}};uu([Ls({type:Number})],Ts.prototype,"tick",2);Ts=uu([Ce("tick-box")],Ts);const uy=`<div class="lore">
  <p>
    Nobody knows why <i>The Bubble</i> exists, or who built the lattice
    of hyperspace lanes threading its hundreds of star systems together
    like a cosmic web. Its discovery was accidental - a distortion
    ripple detected on the edge of settled space, leading explorers to
    the shimmering boundary of a region where physics seemed... wrong.
  </p>
  <p>
    What <i>is</i> known is this: control of <i>The Bubble</i> means
    control of immense resources and power. Rival factions flood its
    systems, each desperate to carve out their claim before somebody
    else does.
  </p>
  <p>
    As a commander, you are the spearhead of your faction's ambitions:
    tasked with expanding your influence, capturing systems, and
    ultimately dominating <i>The Bubble</i>.
  </p>
</div>

<h3>
  Capture the enemy systems.
  <br />Protect our homeworld.
</h3>`;var hy=Object.defineProperty,fy=Object.getOwnPropertyDescriptor,hu=e=>{throw TypeError(e)},me=(e,t,n,r)=>{for(var i=r>1?void 0:r?fy(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&hy(t,n,i),i},dy=(e,t,n)=>t.has(e)||hu("Cannot "+n),py=(e,t,n)=>t.has(e)?hu("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),gy=(e,t,n)=>(dy(e,t,"access private method"),n),Ps,fu;let ae=class extends Lt{constructor(){super(...arguments),py(this,Ps),this.players=[],this.version=el,this.playerToken="",this.page="start",this.keyText="Click to copy your save key. Use this key to restore your player data later."}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),gy(this,Ps,fu).call(this)}startPage(){const e=tl(this.player,this.playerToken),t=my(this.player?.id,this.playerToken);return ot` <h1>STARZ!</h1>
      <small class="version">v${this.version}</small>

      ${he(uy)}

      <form method="dialog">
        <div class="grid">
          <div>
            <input
              name="playerName"
              id="playerNameInput"
              type="text"
              .value=${this.player?.name??""}
              @input="${this.onChange}"
              @keydown="${this.onKeydown}"
              placeholder="Name or Save Key"
              minlength="1"
              maxlength="32"
              required
            />
            <small>(Name will be used in leaderboard)</small>
          </div>
          <div>
            <span>${this.player?.name??""}</span
            ><span
              class="short-id"
              data-tooltip="${this.keyText}"
              @click="${()=>this.copyText(t)}"
              >${e}</span
            >
            ${this.player?.score?ot`<span> ${this.player.score.score}</span>`:""}
            <br /><small
              >${this.player?.score?.rank?`Rank: ${this.player.score.rank}`:""}</small
            >
          </div>
        </div>

        <button type="button" @click="${this.onTest}">Name Game</button>
      </form>`}roomPage(){return ot` <h4>Welcome, ${this.player?.name??""}</h4>
      <p>Players ${this.players.length}</p>
      <ul class="player-list">
        ${this.players.map(e=>ot`<li
              style="--owner-color: ${e.color||null}"
              class="${e.bot?"bot":"human"}"
              @click="${()=>{this.removeBot(e.id)}}"
            >
              ${e.bot?he(bm):""} ${e.name}<span
                class="short-id"
                >${tl(e,this.playerToken)}</span
              >
            </li>`)}
      </ul>
      <button type="button" @click="${this.onAddBot}">
        ${he(vm)} Add Bot
      </button>
      <button type="button" @click="${this.onPlay}">
        ${he(_m)}
      </button>
      <button type="button" @click="${this.onOptions}">
        ${he(wm)}
      </button>`}renderInner(){switch(this.page){case"start":return this.startPage();case"room":return this.roomPage()}}render(){return ot`
      <lobby-leaderboard-element></lobby-leaderboard-element>
      <article>${this.renderInner()}</article>
    `}onTest(){this.page="room"}removeBot(e){console.log("Removing bot",e),(this.gameManager instanceof yr||this.gameManager instanceof _n)&&this.gameManager.removeBot(e)}async onAddBot(){(this.gameManager instanceof yr||this.gameManager instanceof _n)&&this.gameManager.addBot()}async onPlay(){await this.gameManager.setConfig({playerName:this.player?.name??""}),this.dispatchEvent(new Event("startClicked")),this.page="start"}async onOptions(){if(await this.showOptions()){const t=document.getElementById("optionsForm"),n=new FormData(t),r=globalThis.gameManager,i=+n.get("numBots"),s=n.get("playerName"),o=n.get("fow")==="on",a=+n.get("numSystems");r.setConfig({numBots:i,playerName:s,fow:o,numSystems:48*2**a})}}showOptions(){const e=document.getElementById("optionsDialog");return e.showModal(),new Promise(t=>{e.addEventListener("close",()=>t(!0)),e.addEventListener("cancel",()=>t(!1))})}onKeydown(e){e.key==="Enter"&&(e.preventDefault(),this.setName(e.target.value))}onChange(e){e.stopPropagation(),e.stopImmediatePropagation(),this.setName(e.target.value)}async setName(e){if(e=e.trim(),this.gameManager instanceof _n&&e.includes("::")){const[t,n]=e.split("::");await this.gameManager.setPlayerAuth(t,n),this.playerToken=n,this.playerNameInput.value=this.gameManager.getPlayer()?.name??""}else this.gameManager instanceof yr&&(this.gameManager.updatePlayerName(e),this.playerNameInput.value=this.gameManager.getPlayer()?.name??"")}async copyText(e){try{await navigator.clipboard.writeText(e),this.keyText="Copied to clipboard!",this.requestUpdate(),setTimeout(()=>{this.keyText="Use this key to restore your player data later.  Click to copy.",this.requestUpdate()},2e3)}catch{}}};Ps=new WeakSet;fu=function(){const e=()=>{this.players=Array.from(this.gameManager.getState().playerMap.values()),this.player=this.gameManager.getPlayer(),this.playerToken=this.gameManager.playerToken??""};e(),this.gameManager.events.on(Q.PLAYER_AUTH_UPDATED,e),this.gameManager.events.on(Q.PLAYER_JOINED,e),this.gameManager.events.on(Q.PLAYER_REMOVED,e),this.gameManager.events.on(Q.PLAYER_UPDATED,e),this.gameManager.events.on(Q.CONFIG_UPDATED,e),this.gameManager.events.on(Q.GAME_INIT,e)};me([Nn({context:en}),dt()],ae.prototype,"gameManager",2);me([dt()],ae.prototype,"player",2);me([dt()],ae.prototype,"players",2);me([dt()],ae.prototype,"version",2);me([dt()],ae.prototype,"playerToken",2);me([dt()],ae.prototype,"page",2);me([ei("#playerNameInput")],ae.prototype,"playerNameInput",2);ae=me([Ce("start-dialog-content")],ae);function tl(e,t){return!e||e.bot||!t?"":e.id?"#"+e.id.slice(0,4):""}function my(e,t){return!e||!t?"":`${e}::${t}`}var yy=Object.defineProperty,_y=Object.getOwnPropertyDescriptor,co=(e,t,n,r)=>{for(var i=r>1?void 0:r?_y(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&yy(t,n,i),i};let Qr=class extends Lt{constructor(){super(...arguments),this.messages=[]}connectedCallback(){super.connectedCallback(),this.gameManager.events.on(Q.MESSAGES_UPDATED,({messages:e})=>{this.messages=(e??[]).slice(-5)})}createRenderRoot(){return this}render(){return this.messages.length>0?ot`${this.messages.map(e=>{const t=~~(e.tick/2),n=e.tick%2===1?".":"";return ot`<div>
          ${he(e.message)} <small>${t}${n}</small>
        </div>`})}`:ot``}};co([Nn({context:en}),dt()],Qr.prototype,"gameManager",2);co([dt()],Qr.prototype,"messages",2);Qr=co([Ce("message-box")],Qr);var wy=Object.defineProperty,vy=Object.getOwnPropertyDescriptor,du=(e,t,n,r)=>{for(var i=r>1?void 0:r?vy(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&wy(t,n,i),i};let ks=class extends Lt{connectedCallback(){super.connectedCallback(),this.gameManager.events.on(Q.GAME_START,()=>{lm(document.getElementById("app"),this.gameManager.getFnContext())}),this.gameManager.events.on(Q.STATE_UPDATED,()=>{Z()}),this.gameManager.events.on(Q.GAME_TICK,()=>{Z()})}createRenderRoot(){return this}render(){return ot`
      <canvas></canvas>
      <svg></svg>
    `}};du([Nn({context:en}),dt()],ks.prototype,"gameManager",2);ks=du([Ce("game-canvas")],ks);const uo=document.createElement("app-root"),gi=new _n;globalThis.gameManager=gi;uo.gameManager=gi;document.body.appendChild(uo);gi.mount(uo);console.log(`starz.io version ${el}`);gi.connect();

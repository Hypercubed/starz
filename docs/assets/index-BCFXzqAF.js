(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const Il="0.0.7";let Tl=class extends Event{constructor(t,n,r,i){super("context-request",{bubbles:!0,composed:!0}),this.context=t,this.contextTarget=n,this.callback=r,this.subscribe=i??!1}};let Lo=class{constructor(t,n,r,i){if(this.subscribe=!1,this.provided=!1,this.value=void 0,this.t=(s,o)=>{this.unsubscribe&&(this.unsubscribe!==o&&(this.provided=!1,this.unsubscribe()),this.subscribe||this.unsubscribe()),this.value=s,this.host.requestUpdate(),this.provided&&!this.subscribe||(this.provided=!0,this.callback&&this.callback(s,o)),this.unsubscribe=o},this.host=t,n.context!==void 0){const s=n;this.context=s.context,this.callback=s.callback,this.subscribe=s.subscribe??!1}else this.context=n,this.callback=r,this.subscribe=i??!1;this.host.addController(this)}hostConnected(){this.dispatchRequest()}hostDisconnected(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=void 0)}dispatchRequest(){this.host.dispatchEvent(new Tl(this.context,this.host,this.t,this.subscribe))}};let Yu=class{get value(){return this.o}set value(t){this.setValue(t)}setValue(t,n=!1){const r=n||!Object.is(t,this.o);this.o=t,r&&this.updateObservers()}constructor(t){this.subscriptions=new Map,this.updateObservers=()=>{for(const[n,{disposer:r}]of this.subscriptions)n(this.o,r)},t!==void 0&&(this.value=t)}addCallback(t,n,r){if(!r)return void t(this.value);this.subscriptions.has(t)||this.subscriptions.set(t,{disposer:()=>{this.subscriptions.delete(t)},consumerHost:n});const{disposer:i}=this.subscriptions.get(t);t(this.value,i)}clearCallbacks(){this.subscriptions.clear()}};let Ku=class extends Event{constructor(t,n){super("context-provider",{bubbles:!0,composed:!0}),this.context=t,this.contextTarget=n}},Ro=class extends Yu{constructor(t,n,r){super(n.context!==void 0?n.initialValue:r),this.onContextRequest=i=>{if(i.context!==this.context)return;const s=i.contextTarget??i.composedPath()[0];s!==this.host&&(i.stopPropagation(),this.addCallback(i.callback,s,i.subscribe))},this.onProviderRequest=i=>{if(i.context!==this.context||(i.contextTarget??i.composedPath()[0])===this.host)return;const s=new Set;for(const[o,{consumerHost:a}]of this.subscriptions)s.has(o)||(s.add(o),a.dispatchEvent(new Tl(this.context,a,o,!0)));i.stopPropagation()},this.host=t,n.context!==void 0?this.context=n.context:this.context=n,this.attachListeners(),this.host.addController?.(this)}attachListeners(){this.host.addEventListener("context-request",this.onContextRequest),this.host.addEventListener("context-provider",this.onProviderRequest)}hostConnected(){this.host.dispatchEvent(new Ku(this.context,this.host))}};function Gn({context:e}){return(t,n)=>{const r=new WeakMap;if(typeof n=="object")return{get(){return t.get.call(this)},set(i){return r.get(this).setValue(i),t.set.call(this,i)},init(i){return r.set(this,new Ro(this,{context:e,initialValue:i})),i}};{t.constructor.addInitializer((o=>{r.set(o,new Ro(o,{context:e}))}));const i=Object.getOwnPropertyDescriptor(t,n);let s;if(i===void 0){const o=new WeakMap;s={get(){return o.get(this)},set(a){r.get(this).setValue(a),o.set(this,a)},configurable:!0,enumerable:!0}}else{const o=i.set;s={...i,set(a){r.get(this).setValue(a),o?.call(this,a)}}}return void Object.defineProperty(t,n,s)}}}function Vn({context:e,subscribe:t}){return(n,r)=>{typeof r=="object"?r.addInitializer((function(){new Lo(this,{context:e,callback:i=>{n.set.call(this,i)},subscribe:t})})):n.constructor.addInitializer((i=>{new Lo(i,{context:e,callback:s=>{i[r]=s},subscribe:t})}))}}const Sr=globalThis,Zs=Sr.ShadowRoot&&(Sr.ShadyCSS===void 0||Sr.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,kl=Symbol(),Do=new WeakMap;let Qu=class{constructor(t,n,r){if(this._$cssResult$=!0,r!==kl)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=n}get styleSheet(){let t=this.o;const n=this.t;if(Zs&&t===void 0){const r=n!==void 0&&n.length===1;r&&(t=Do.get(n)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),r&&Do.set(n,t))}return t}toString(){return this.cssText}};const Zu=e=>new Qu(typeof e=="string"?e:e+"",void 0,kl),Ju=(e,t)=>{if(Zs)e.adoptedStyleSheets=t.map((n=>n instanceof CSSStyleSheet?n:n.styleSheet));else for(const n of t){const r=document.createElement("style"),i=Sr.litNonce;i!==void 0&&r.setAttribute("nonce",i),r.textContent=n.cssText,e.appendChild(r)}},Uo=Zs?e=>e:e=>e instanceof CSSStyleSheet?(t=>{let n="";for(const r of t.cssRules)n+=r.cssText;return Zu(n)})(e):e;const{is:th,defineProperty:eh,getOwnPropertyDescriptor:nh,getOwnPropertyNames:rh,getOwnPropertySymbols:ih,getPrototypeOf:sh}=Object,mi=globalThis,Bo=mi.trustedTypes,oh=Bo?Bo.emptyScript:"",ah=mi.reactiveElementPolyfillSupport,Tn=(e,t)=>e,Lr={toAttribute(e,t){switch(t){case Boolean:e=e?oh:null;break;case Object:case Array:e=e==null?e:JSON.stringify(e)}return e},fromAttribute(e,t){let n=e;switch(t){case Boolean:n=e!==null;break;case Number:n=e===null?null:Number(e);break;case Object:case Array:try{n=JSON.parse(e)}catch{n=null}}return n}},Js=(e,t)=>!th(e,t),zo={attribute:!0,type:String,converter:Lr,reflect:!1,useDefault:!1,hasChanged:Js};Symbol.metadata??=Symbol("metadata"),mi.litPropertyMetadata??=new WeakMap;let Ke=class extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,n=zo){if(n.state&&(n.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((n=Object.create(n)).wrapped=!0),this.elementProperties.set(t,n),!n.noAccessor){const r=Symbol(),i=this.getPropertyDescriptor(t,r,n);i!==void 0&&eh(this.prototype,t,i)}}static getPropertyDescriptor(t,n,r){const{get:i,set:s}=nh(this.prototype,t)??{get(){return this[n]},set(o){this[n]=o}};return{get:i,set(o){const a=i?.call(this);s?.call(this,o),this.requestUpdate(t,a,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??zo}static _$Ei(){if(this.hasOwnProperty(Tn("elementProperties")))return;const t=sh(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(Tn("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Tn("properties"))){const n=this.properties,r=[...rh(n),...ih(n)];for(const i of r)this.createProperty(i,n[i])}const t=this[Symbol.metadata];if(t!==null){const n=litPropertyMetadata.get(t);if(n!==void 0)for(const[r,i]of n)this.elementProperties.set(r,i)}this._$Eh=new Map;for(const[n,r]of this.elementProperties){const i=this._$Eu(n,r);i!==void 0&&this._$Eh.set(i,n)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const n=[];if(Array.isArray(t)){const r=new Set(t.flat(1/0).reverse());for(const i of r)n.unshift(Uo(i))}else t!==void 0&&n.push(Uo(t));return n}static _$Eu(t,n){const r=n.attribute;return r===!1?void 0:typeof r=="string"?r:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((t=>t(this)))}addController(t){(this._$EO??=new Set).add(t),this.renderRoot!==void 0&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,n=this.constructor.elementProperties;for(const r of n.keys())this.hasOwnProperty(r)&&(t.set(r,this[r]),delete this[r]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return Ju(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((t=>t.hostConnected?.()))}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach((t=>t.hostDisconnected?.()))}attributeChangedCallback(t,n,r){this._$AK(t,r)}_$ET(t,n){const r=this.constructor.elementProperties.get(t),i=this.constructor._$Eu(t,r);if(i!==void 0&&r.reflect===!0){const s=(r.converter?.toAttribute!==void 0?r.converter:Lr).toAttribute(n,r.type);this._$Em=t,s==null?this.removeAttribute(i):this.setAttribute(i,s),this._$Em=null}}_$AK(t,n){const r=this.constructor,i=r._$Eh.get(t);if(i!==void 0&&this._$Em!==i){const s=r.getPropertyOptions(i),o=typeof s.converter=="function"?{fromAttribute:s.converter}:s.converter?.fromAttribute!==void 0?s.converter:Lr;this._$Em=i;const a=o.fromAttribute(n,s.type);this[i]=a??this._$Ej?.get(i)??a,this._$Em=null}}requestUpdate(t,n,r){if(t!==void 0){const i=this.constructor,s=this[t];if(r??=i.getPropertyOptions(t),!((r.hasChanged??Js)(s,n)||r.useDefault&&r.reflect&&s===this._$Ej?.get(t)&&!this.hasAttribute(i._$Eu(t,r))))return;this.C(t,n,r)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(t,n,{useDefault:r,reflect:i,wrapped:s},o){r&&!(this._$Ej??=new Map).has(t)&&(this._$Ej.set(t,o??n??this[t]),s!==!0||o!==void 0)||(this._$AL.has(t)||(this.hasUpdated||r||(n=void 0),this._$AL.set(t,n)),i===!0&&this._$Em!==t&&(this._$Eq??=new Set).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(n){Promise.reject(n)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[i,s]of this._$Ep)this[i]=s;this._$Ep=void 0}const r=this.constructor.elementProperties;if(r.size>0)for(const[i,s]of r){const{wrapped:o}=s,a=this[i];o!==!0||this._$AL.has(i)||a===void 0||this.C(i,void 0,s,a)}}let t=!1;const n=this._$AL;try{t=this.shouldUpdate(n),t?(this.willUpdate(n),this._$EO?.forEach((r=>r.hostUpdate?.())),this.update(n)):this._$EM()}catch(r){throw t=!1,this._$EM(),r}t&&this._$AE(n)}willUpdate(t){}_$AE(t){this._$EO?.forEach((n=>n.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&=this._$Eq.forEach((n=>this._$ET(n,this[n]))),this._$EM()}updated(t){}firstUpdated(t){}};Ke.elementStyles=[],Ke.shadowRootOptions={mode:"open"},Ke[Tn("elementProperties")]=new Map,Ke[Tn("finalized")]=new Map,ah?.({ReactiveElement:Ke}),(mi.reactiveElementVersions??=[]).push("2.1.1");const to=globalThis,Rr=to.trustedTypes,Fo=Rr?Rr.createPolicy("lit-html",{createHTML:e=>e}):void 0,Pl="$lit$",be=`lit$${Math.random().toFixed(9).slice(2)}$`,Nl="?"+be,lh=`<${Nl}>`,ze=document,Nn=()=>ze.createComment(""),Cn=e=>e===null||typeof e!="object"&&typeof e!="function",eo=Array.isArray,ch=e=>eo(e)||typeof e?.[Symbol.iterator]=="function",Ci=`[ 	
\f\r]`,gn=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Ho=/-->/g,qo=/>/g,Ie=RegExp(`>|${Ci}(?:([^\\s"'>=/]+)(${Ci}*=${Ci}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Go=/'/g,Vo=/"/g,Cl=/^(?:script|style|textarea|title)$/i,uh=e=>(t,...n)=>({_$litType$:e,strings:t,values:n}),_t=uh(1),Fe=Symbol.for("lit-noChange"),ht=Symbol.for("lit-nothing"),jo=new WeakMap,Ce=ze.createTreeWalker(ze,129);function Ol(e,t){if(!eo(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return Fo!==void 0?Fo.createHTML(t):t}const hh=(e,t)=>{const n=e.length-1,r=[];let i,s=t===2?"<svg>":t===3?"<math>":"",o=gn;for(let a=0;a<n;a++){const l=e[a];let u,h,c=-1,g=0;for(;g<l.length&&(o.lastIndex=g,h=o.exec(l),h!==null);)g=o.lastIndex,o===gn?h[1]==="!--"?o=Ho:h[1]!==void 0?o=qo:h[2]!==void 0?(Cl.test(h[2])&&(i=RegExp("</"+h[2],"g")),o=Ie):h[3]!==void 0&&(o=Ie):o===Ie?h[0]===">"?(o=i??gn,c=-1):h[1]===void 0?c=-2:(c=o.lastIndex-h[2].length,u=h[1],o=h[3]===void 0?Ie:h[3]==='"'?Vo:Go):o===Vo||o===Go?o=Ie:o===Ho||o===qo?o=gn:(o=Ie,i=void 0);const x=o===Ie&&e[a+1].startsWith("/>")?" ":"";s+=o===gn?l+lh:c>=0?(r.push(u),l.slice(0,c)+Pl+l.slice(c)+be+x):l+be+(c===-2?a:x)}return[Ol(e,s+(e[n]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),r]};class On{constructor({strings:t,_$litType$:n},r){let i;this.parts=[];let s=0,o=0;const a=t.length-1,l=this.parts,[u,h]=hh(t,n);if(this.el=On.createElement(u,r),Ce.currentNode=this.el.content,n===2||n===3){const c=this.el.content.firstChild;c.replaceWith(...c.childNodes)}for(;(i=Ce.nextNode())!==null&&l.length<a;){if(i.nodeType===1){if(i.hasAttributes())for(const c of i.getAttributeNames())if(c.endsWith(Pl)){const g=h[o++],x=i.getAttribute(c).split(be),E=/([.?@])?(.*)/.exec(g);l.push({type:1,index:s,name:E[2],strings:x,ctor:E[1]==="."?dh:E[1]==="?"?ph:E[1]==="@"?gh:yi}),i.removeAttribute(c)}else c.startsWith(be)&&(l.push({type:6,index:s}),i.removeAttribute(c));if(Cl.test(i.tagName)){const c=i.textContent.split(be),g=c.length-1;if(g>0){i.textContent=Rr?Rr.emptyScript:"";for(let x=0;x<g;x++)i.append(c[x],Nn()),Ce.nextNode(),l.push({type:2,index:++s});i.append(c[g],Nn())}}}else if(i.nodeType===8)if(i.data===Nl)l.push({type:2,index:s});else{let c=-1;for(;(c=i.data.indexOf(be,c+1))!==-1;)l.push({type:7,index:s}),c+=be.length-1}s++}}static createElement(t,n){const r=ze.createElement("template");return r.innerHTML=t,r}}function nn(e,t,n=e,r){if(t===Fe)return t;let i=r!==void 0?n._$Co?.[r]:n._$Cl;const s=Cn(t)?void 0:t._$litDirective$;return i?.constructor!==s&&(i?._$AO?.(!1),s===void 0?i=void 0:(i=new s(e),i._$AT(e,n,r)),r!==void 0?(n._$Co??=[])[r]=i:n._$Cl=i),i!==void 0&&(t=nn(e,i._$AS(e,t.values),i,r)),t}class fh{constructor(t,n){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:n},parts:r}=this._$AD,i=(t?.creationScope??ze).importNode(n,!0);Ce.currentNode=i;let s=Ce.nextNode(),o=0,a=0,l=r[0];for(;l!==void 0;){if(o===l.index){let u;l.type===2?u=new jn(s,s.nextSibling,this,t):l.type===1?u=new l.ctor(s,l.name,l.strings,this,t):l.type===6&&(u=new mh(s,this,t)),this._$AV.push(u),l=r[++a]}o!==l?.index&&(s=Ce.nextNode(),o++)}return Ce.currentNode=ze,i}p(t){let n=0;for(const r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(t,r,n),n+=r.strings.length-2):r._$AI(t[n])),n++}}class jn{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,n,r,i){this.type=2,this._$AH=ht,this._$AN=void 0,this._$AA=t,this._$AB=n,this._$AM=r,this.options=i,this._$Cv=i?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const n=this._$AM;return n!==void 0&&t?.nodeType===11&&(t=n.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,n=this){t=nn(this,t,n),Cn(t)?t===ht||t==null||t===""?(this._$AH!==ht&&this._$AR(),this._$AH=ht):t!==this._$AH&&t!==Fe&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):ch(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==ht&&Cn(this._$AH)?this._$AA.nextSibling.data=t:this.T(ze.createTextNode(t)),this._$AH=t}$(t){const{values:n,_$litType$:r}=t,i=typeof r=="number"?this._$AC(t):(r.el===void 0&&(r.el=On.createElement(Ol(r.h,r.h[0]),this.options)),r);if(this._$AH?._$AD===i)this._$AH.p(n);else{const s=new fh(i,this),o=s.u(this.options);s.p(n),this.T(o),this._$AH=s}}_$AC(t){let n=jo.get(t.strings);return n===void 0&&jo.set(t.strings,n=new On(t)),n}k(t){eo(this._$AH)||(this._$AH=[],this._$AR());const n=this._$AH;let r,i=0;for(const s of t)i===n.length?n.push(r=new jn(this.O(Nn()),this.O(Nn()),this,this.options)):r=n[i],r._$AI(s),i++;i<n.length&&(this._$AR(r&&r._$AB.nextSibling,i),n.length=i)}_$AR(t=this._$AA.nextSibling,n){for(this._$AP?.(!1,!0,n);t!==this._$AB;){const r=t.nextSibling;t.remove(),t=r}}setConnected(t){this._$AM===void 0&&(this._$Cv=t,this._$AP?.(t))}}class yi{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,n,r,i,s){this.type=1,this._$AH=ht,this._$AN=void 0,this.element=t,this.name=n,this._$AM=i,this.options=s,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=ht}_$AI(t,n=this,r,i){const s=this.strings;let o=!1;if(s===void 0)t=nn(this,t,n,0),o=!Cn(t)||t!==this._$AH&&t!==Fe,o&&(this._$AH=t);else{const a=t;let l,u;for(t=s[0],l=0;l<s.length-1;l++)u=nn(this,a[r+l],n,l),u===Fe&&(u=this._$AH[l]),o||=!Cn(u)||u!==this._$AH[l],u===ht?t=ht:t!==ht&&(t+=(u??"")+s[l+1]),this._$AH[l]=u}o&&!i&&this.j(t)}j(t){t===ht?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class dh extends yi{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===ht?void 0:t}}class ph extends yi{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==ht)}}class gh extends yi{constructor(t,n,r,i,s){super(t,n,r,i,s),this.type=5}_$AI(t,n=this){if((t=nn(this,t,n,0)??ht)===Fe)return;const r=this._$AH,i=t===ht&&r!==ht||t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive,s=t!==ht&&(r===ht||i);i&&this.element.removeEventListener(this.name,this,r),s&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class mh{constructor(t,n,r){this.element=t,this.type=6,this._$AN=void 0,this._$AM=n,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(t){nn(this,t)}}const yh=to.litHtmlPolyfillSupport;yh?.(On,jn),(to.litHtmlVersions??=[]).push("3.3.1");const wh=(e,t,n)=>{const r=n?.renderBefore??t;let i=r._$litPart$;if(i===void 0){const s=n?.renderBefore??null;r._$litPart$=i=new jn(t.insertBefore(Nn(),s),s,void 0,n??{})}return i._$AI(e),i};const no=globalThis;let Yt=class extends Ke{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const n=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=wh(n,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return Fe}};Yt._$litElement$=!0,Yt.finalized=!0,no.litElementHydrateSupport?.({LitElement:Yt});const _h=no.litElementPolyfillSupport;_h?.({LitElement:Yt});(no.litElementVersions??=[]).push("4.2.1");const Ge=e=>(t,n)=>{n!==void 0?n.addInitializer((()=>{customElements.define(e,t)})):customElements.define(e,t)};const xh={attribute:!0,type:String,converter:Lr,reflect:!1,hasChanged:Js},vh=(e=xh,t,n)=>{const{kind:r,metadata:i}=n;let s=globalThis.litPropertyMetadata.get(i);if(s===void 0&&globalThis.litPropertyMetadata.set(i,s=new Map),r==="setter"&&((e=Object.create(e)).wrapped=!0),s.set(n.name,e),r==="accessor"){const{name:o}=n;return{set(a){const l=t.get.call(this);t.set.call(this,a),this.requestUpdate(o,l,e)},init(a){return a!==void 0&&this.C(o,void 0,e,a),a}}}if(r==="setter"){const{name:o}=n;return function(a){const l=this[o];t.call(this,a),this.requestUpdate(o,l,e)}}throw Error("Unsupported decorator location: "+r)};function ro(e){return(t,n)=>typeof n=="object"?vh(e,t,n):((r,i,s)=>{const o=i.hasOwnProperty(s);return i.constructor.createProperty(s,r),o?Object.getOwnPropertyDescriptor(i,s):void 0})(e,t,n)}function Lt(e){return ro({...e,state:!0,attribute:!1})}const bh=(e,t,n)=>(n.configurable=!0,n.enumerable=!0,Reflect.decorate&&typeof t!="object"&&Object.defineProperty(e,t,n),n);function wi(e,t){return(n,r,i)=>{const s=o=>o.renderRoot?.querySelector(e)??null;return bh(n,r,{get(){return s(this)}})}}const Sh={CHILD:2},Eh=e=>(...t)=>({_$litDirective$:e,values:t});class Mh{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,n,r){this._$Ct=t,this._$AM=n,this._$Ci=r}_$AS(t,n){return this.update(t,n)}update(t,n){return this.render(...n)}}class ts extends Mh{constructor(t){if(super(t),this.it=ht,t.type!==Sh.CHILD)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(t){if(t===ht||t==null)return this._t=void 0,this.it=t;if(t===Fe)return t;if(typeof t!="string")throw Error(this.constructor.directiveName+"() called with a non-string value");if(t===this.it)return this._t;this.it=t;const n=[t];return n.raw=n,this._t={_$litType$:this.constructor.resultType,strings:n,values:[]}}}ts.directiveName="unsafeHTML",ts.resultType=1;const io=Eh(ts),$h={DEV:!1,PROD:!0},Dr=750,Ee=750,Ah="Orthographic",Ih=500,Th=2,kh=25,Ph=1,Nh=1,Ll=40,Ch=!0,Oh=384,Er=1,Lh=4,Rh=.1,Rl=$h||{},Ur=Rl.DEV??!0,Dh=Rl.PROD??!1,Uh=Dh,Bh=Ur,Dl=Ur,zh=["#c0392b","#f1c40f","#9b59b6","#00b386","#cc6600","#0a4c8c"];function rn(e,...t){const n=globalThis.gameManager?.getContext()?.tick??null;Bh&&console.log(`[DEBUG][Tick ${n}] ${e}`,...t)}function Oi(e,t={}){if(!Uh)return;const n=globalThis.gameManager?.getContext()?.tick??null;let r=1;try{r=parseInt(localStorage.getItem(e)??"0",10)+1}catch(i){console.error("Error reading event count from localStorage:",i)}if(localStorage.setItem(e,r+""),window&&window.sa_event)try{window.sa_event(e,{[e]:r,tick:n,...t})}catch(i){console.error("Error tracking event:",i)}}function Ul(e,t){let n,r;for(const i of e)i!=null&&(n===void 0?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)));return[n,r]}class Kt{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let r=0;for(let i=0;i<this._n&&i<32;i++){const s=n[i],o=t+s,a=Math.abs(t)<Math.abs(s)?t-(o-s):s-(o-t);a&&(n[r++]=a),t=o}return n[r]=t,this._n=r+1,this}valueOf(){const t=this._partials;let n=this._n,r,i,s,o=0;if(n>0){for(o=t[--n];n>0&&(r=o,i=t[--n],o=r+i,s=i-(o-r),!s););n>0&&(s<0&&t[n-1]<0||s>0&&t[n-1]>0)&&(i=s*2,r=o+i,i==r-o&&(o=r))}return o}}function Wo(e,t){let n=0,r=0;if(t===void 0)for(let i of e)i!=null&&(i=+i)>=i&&(++n,r+=i);else{let i=-1;for(let s of e)(s=t(s,++i,e))!=null&&(s=+s)>=s&&(++n,r+=s)}if(n)return r/n}function*Fh(e){for(const t of e)yield*t}function Bl(e){return Array.from(Fh(e))}function Qe(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,s=new Array(i);++r<i;)s[r]=e+r*n;return s}var Hh={value:()=>{}};function _i(){for(var e=0,t=arguments.length,n={},r;e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Mr(n)}function Mr(e){this._=e}function qh(e,t){return e.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Mr.prototype=_i.prototype={constructor:Mr,on:function(e,t){var n=this._,r=qh(e+"",n),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(e=r[s]).type)&&(i=Gh(n[i],e.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<o;)if(i=(e=r[s]).type)n[i]=Xo(n[i],e.name,t);else if(t==null)for(i in n)n[i]=Xo(n[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Mr(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,s;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],r=0,i=s.length;r<i;++r)s[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,s=r.length;i<s;++i)r[i].value.apply(t,n)}};function Gh(e,t){for(var n=0,r=e.length,i;n<r;++n)if((i=e[n]).name===t)return i.value}function Xo(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=Hh,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}var es="http://www.w3.org/1999/xhtml";const Yo={svg:"http://www.w3.org/2000/svg",xhtml:es,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function xi(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),Yo.hasOwnProperty(t)?{space:Yo[t],local:e}:e}function Vh(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===es&&t.documentElement.namespaceURI===es?t.createElement(e):t.createElementNS(n,e)}}function jh(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function zl(e){var t=xi(e);return(t.local?jh:Vh)(t)}function Wh(){}function so(e){return e==null?Wh:function(){return this.querySelector(e)}}function Xh(e){typeof e!="function"&&(e=so(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,a=r[i]=new Array(o),l,u,h=0;h<o;++h)(l=s[h])&&(u=e.call(l,l.__data__,h,s))&&("__data__"in l&&(u.__data__=l.__data__),a[h]=u);return new Ct(r,this._parents)}function Yh(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function Kh(){return[]}function Fl(e){return e==null?Kh:function(){return this.querySelectorAll(e)}}function Qh(e){return function(){return Yh(e.apply(this,arguments))}}function Zh(e){typeof e=="function"?e=Qh(e):e=Fl(e);for(var t=this._groups,n=t.length,r=[],i=[],s=0;s<n;++s)for(var o=t[s],a=o.length,l,u=0;u<a;++u)(l=o[u])&&(r.push(e.call(l,l.__data__,u,o)),i.push(l));return new Ct(r,i)}function Hl(e){return function(){return this.matches(e)}}function ql(e){return function(t){return t.matches(e)}}var Jh=Array.prototype.find;function tf(e){return function(){return Jh.call(this.children,e)}}function ef(){return this.firstElementChild}function nf(e){return this.select(e==null?ef:tf(typeof e=="function"?e:ql(e)))}var rf=Array.prototype.filter;function sf(){return Array.from(this.children)}function of(e){return function(){return rf.call(this.children,e)}}function af(e){return this.selectAll(e==null?sf:of(typeof e=="function"?e:ql(e)))}function lf(e){typeof e!="function"&&(e=Hl(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,a=r[i]=[],l,u=0;u<o;++u)(l=s[u])&&e.call(l,l.__data__,u,s)&&a.push(l);return new Ct(r,this._parents)}function Gl(e){return new Array(e.length)}function cf(){return new Ct(this._enter||this._groups.map(Gl),this._parents)}function Br(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Br.prototype={constructor:Br,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function uf(e){return function(){return e}}function hf(e,t,n,r,i,s){for(var o=0,a,l=t.length,u=s.length;o<u;++o)(a=t[o])?(a.__data__=s[o],r[o]=a):n[o]=new Br(e,s[o]);for(;o<l;++o)(a=t[o])&&(i[o]=a)}function ff(e,t,n,r,i,s,o){var a,l,u=new Map,h=t.length,c=s.length,g=new Array(h),x;for(a=0;a<h;++a)(l=t[a])&&(g[a]=x=o.call(l,l.__data__,a,t)+"",u.has(x)?i[a]=l:u.set(x,l));for(a=0;a<c;++a)x=o.call(e,s[a],a,s)+"",(l=u.get(x))?(r[a]=l,l.__data__=s[a],u.delete(x)):n[a]=new Br(e,s[a]);for(a=0;a<h;++a)(l=t[a])&&u.get(g[a])===l&&(i[a]=l)}function df(e){return e.__data__}function pf(e,t){if(!arguments.length)return Array.from(this,df);var n=t?ff:hf,r=this._parents,i=this._groups;typeof e!="function"&&(e=uf(e));for(var s=i.length,o=new Array(s),a=new Array(s),l=new Array(s),u=0;u<s;++u){var h=r[u],c=i[u],g=c.length,x=gf(e.call(h,h&&h.__data__,u,r)),E=x.length,A=a[u]=new Array(E),C=o[u]=new Array(E),T=l[u]=new Array(g);n(h,c,A,C,T,x,t);for(var I=0,L=0,k,D;I<E;++I)if(k=A[I]){for(I>=L&&(L=I+1);!(D=C[L])&&++L<E;);k._next=D||null}}return o=new Ct(o,r),o._enter=a,o._exit=l,o}function gf(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function mf(){return new Ct(this._exit||this._groups.map(Gl),this._parents)}function yf(e,t,n){var r=this.enter(),i=this,s=this.exit();return typeof e=="function"?(r=e(r),r&&(r=r.selection())):r=r.append(e+""),t!=null&&(i=t(i),i&&(i=i.selection())),n==null?s.remove():n(s),r&&i?r.merge(i).order():i}function wf(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,i=n.length,s=r.length,o=Math.min(i,s),a=new Array(i),l=0;l<o;++l)for(var u=n[l],h=r[l],c=u.length,g=a[l]=new Array(c),x,E=0;E<c;++E)(x=u[E]||h[E])&&(g[E]=x);for(;l<i;++l)a[l]=n[l];return new Ct(a,this._parents)}function _f(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r=e[t],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function xf(e){e||(e=vf);function t(c,g){return c&&g?e(c.__data__,g.__data__):!c-!g}for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o=n[s],a=o.length,l=i[s]=new Array(a),u,h=0;h<a;++h)(u=o[h])&&(l[h]=u);l.sort(t)}return new Ct(i,this._parents).order()}function vf(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function bf(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Sf(){return Array.from(this)}function Ef(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function Mf(){let e=0;for(const t of this)++e;return e}function $f(){return!this.node()}function Af(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i=t[n],s=0,o=i.length,a;s<o;++s)(a=i[s])&&e.call(a,a.__data__,s,i);return this}function If(e){return function(){this.removeAttribute(e)}}function Tf(e){return function(){this.removeAttributeNS(e.space,e.local)}}function kf(e,t){return function(){this.setAttribute(e,t)}}function Pf(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Nf(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function Cf(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Of(e,t){var n=xi(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((t==null?n.local?Tf:If:typeof t=="function"?n.local?Cf:Nf:n.local?Pf:kf)(n,t))}function Vl(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Lf(e){return function(){this.style.removeProperty(e)}}function Rf(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Df(e,t,n){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function Uf(e,t,n){return arguments.length>1?this.each((t==null?Lf:typeof t=="function"?Df:Rf)(e,t,n??"")):sn(this.node(),e)}function sn(e,t){return e.style.getPropertyValue(t)||Vl(e).getComputedStyle(e,null).getPropertyValue(t)}function Bf(e){return function(){delete this[e]}}function zf(e,t){return function(){this[e]=t}}function Ff(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function Hf(e,t){return arguments.length>1?this.each((t==null?Bf:typeof t=="function"?Ff:zf)(e,t)):this.node()[e]}function jl(e){return e.trim().split(/^|\s+/)}function oo(e){return e.classList||new Wl(e)}function Wl(e){this._node=e,this._names=jl(e.getAttribute("class")||"")}Wl.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Xl(e,t){for(var n=oo(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function Yl(e,t){for(var n=oo(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function qf(e){return function(){Xl(this,e)}}function Gf(e){return function(){Yl(this,e)}}function Vf(e,t){return function(){(t.apply(this,arguments)?Xl:Yl)(this,e)}}function jf(e,t){var n=jl(e+"");if(arguments.length<2){for(var r=oo(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof t=="function"?Vf:t?qf:Gf)(n,t))}function Wf(){this.textContent=""}function Xf(e){return function(){this.textContent=e}}function Yf(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Kf(e){return arguments.length?this.each(e==null?Wf:(typeof e=="function"?Yf:Xf)(e)):this.node().textContent}function Qf(){this.innerHTML=""}function Zf(e){return function(){this.innerHTML=e}}function Jf(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function t0(e){return arguments.length?this.each(e==null?Qf:(typeof e=="function"?Jf:Zf)(e)):this.node().innerHTML}function e0(){this.nextSibling&&this.parentNode.appendChild(this)}function n0(){return this.each(e0)}function r0(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function i0(){return this.each(r0)}function s0(e){var t=typeof e=="function"?e:zl(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function o0(){return null}function a0(e,t){var n=typeof e=="function"?e:zl(e),r=t==null?o0:typeof t=="function"?t:so(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function l0(){var e=this.parentNode;e&&e.removeChild(this)}function c0(){return this.each(l0)}function u0(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function h0(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function f0(e){return this.select(e?h0:u0)}function d0(e){return arguments.length?this.property("__data__",e):this.node().__data__}function p0(e){return function(t){e.call(this,t,this.__data__)}}function g0(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}function m0(e){return function(){var t=this.__on;if(t){for(var n=0,r=-1,i=t.length,s;n<i;++n)s=t[n],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.options):t[++r]=s;++r?t.length=r:delete this.__on}}}function y0(e,t,n){return function(){var r=this.__on,i,s=p0(t);if(r){for(var o=0,a=r.length;o<a;++o)if((i=r[o]).type===e.type&&i.name===e.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=n),i.value=t;return}}this.addEventListener(e.type,s,n),i={type:e.type,name:e.name,value:t,listener:s,options:n},r?r.push(i):this.__on=[i]}}function w0(e,t,n){var r=g0(e+""),i,s=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,u=a.length,h;l<u;++l)for(i=0,h=a[l];i<s;++i)if((o=r[i]).type===h.type&&o.name===h.name)return h.value}return}for(a=t?y0:m0,i=0;i<s;++i)this.each(a(r[i],t,n));return this}function Kl(e,t,n){var r=Vl(e),i=r.CustomEvent;typeof i=="function"?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function _0(e,t){return function(){return Kl(this,e,t)}}function x0(e,t){return function(){return Kl(this,e,t.apply(this,arguments))}}function v0(e,t){return this.each((typeof t=="function"?x0:_0)(e,t))}function*b0(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var Ql=[null];function Ct(e,t){this._groups=e,this._parents=t}function Wn(){return new Ct([[document.documentElement]],Ql)}function S0(){return this}Ct.prototype=Wn.prototype={constructor:Ct,select:Xh,selectAll:Zh,selectChild:nf,selectChildren:af,filter:lf,data:pf,enter:cf,exit:mf,join:yf,merge:wf,selection:S0,order:_f,sort:xf,call:bf,nodes:Sf,node:Ef,size:Mf,empty:$f,each:Af,attr:Of,style:Uf,property:Hf,classed:jf,text:Kf,html:t0,raise:n0,lower:i0,append:s0,insert:a0,remove:c0,clone:f0,datum:d0,on:w0,dispatch:v0,[Symbol.iterator]:b0};function jt(e){return typeof e=="string"?new Ct([[document.querySelector(e)]],[document.documentElement]):new Ct([[e]],Ql)}function Zl(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Jt(e,t){if(e=Zl(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}function E0(e,t){return e.target&&(e=Zl(e),t===void 0&&(t=e.currentTarget),e=e.touches||[e]),Array.from(e,n=>Jt(n,t))}const M0={passive:!1},Ln={capture:!0,passive:!1};function Li(e){e.stopImmediatePropagation()}function tn(e){e.preventDefault(),e.stopImmediatePropagation()}function Jl(e){var t=e.document.documentElement,n=jt(e).on("dragstart.drag",tn,Ln);"onselectstart"in t?n.on("selectstart.drag",tn,Ln):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function tc(e,t){var n=e.document.documentElement,r=jt(e).on("dragstart.drag",null);t&&(r.on("click.drag",tn,Ln),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const tr=e=>()=>e;function ns(e,{sourceEvent:t,subject:n,target:r,identifier:i,active:s,x:o,y:a,dx:l,dy:u,dispatch:h}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:h}})}ns.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function $0(e){return!e.ctrlKey&&!e.button}function A0(){return this.parentNode}function I0(e,t){return t??{x:e.x,y:e.y}}function T0(){return navigator.maxTouchPoints||"ontouchstart"in this}function k0(){var e=$0,t=A0,n=I0,r=T0,i={},s=_i("start","drag","end"),o=0,a,l,u,h,c=0;function g(k){k.on("mousedown.drag",x).filter(r).on("touchstart.drag",C).on("touchmove.drag",T,M0).on("touchend.drag touchcancel.drag",I).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function x(k,D){if(!(h||!e.call(this,k,D))){var B=L(this,t.call(this,k,D),k,D,"mouse");B&&(jt(k.view).on("mousemove.drag",E,Ln).on("mouseup.drag",A,Ln),Jl(k.view),Li(k),u=!1,a=k.clientX,l=k.clientY,B("start",k))}}function E(k){if(tn(k),!u){var D=k.clientX-a,B=k.clientY-l;u=D*D+B*B>c}i.mouse("drag",k)}function A(k){jt(k.view).on("mousemove.drag mouseup.drag",null),tc(k.view,u),tn(k),i.mouse("end",k)}function C(k,D){if(e.call(this,k,D)){var B=k.changedTouches,z=t.call(this,k,D),y=B.length,w,v;for(w=0;w<y;++w)(v=L(this,z,k,D,B[w].identifier,B[w]))&&(Li(k),v("start",k,B[w]))}}function T(k){var D=k.changedTouches,B=D.length,z,y;for(z=0;z<B;++z)(y=i[D[z].identifier])&&(tn(k),y("drag",k,D[z]))}function I(k){var D=k.changedTouches,B=D.length,z,y;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),z=0;z<B;++z)(y=i[D[z].identifier])&&(Li(k),y("end",k,D[z]))}function L(k,D,B,z,y,w){var v=s.copy(),b=Jt(w||B,D),M,m,p;if((p=n.call(k,new ns("beforestart",{sourceEvent:B,target:g,identifier:y,active:o,x:b[0],y:b[1],dx:0,dy:0,dispatch:v}),z))!=null)return M=p.x-b[0]||0,m=p.y-b[1]||0,function f(d,_,S){var $=b,O;switch(d){case"start":i[y]=f,O=o++;break;case"end":delete i[y],--o;case"drag":b=Jt(S||_,D),O=o;break}v.call(d,k,new ns(d,{sourceEvent:_,subject:p,target:g,identifier:y,active:O,x:b[0]+M,y:b[1]+m,dx:b[0]-$[0],dy:b[1]-$[1],dispatch:v}),z)}}return g.filter=function(k){return arguments.length?(e=typeof k=="function"?k:tr(!!k),g):e},g.container=function(k){return arguments.length?(t=typeof k=="function"?k:tr(k),g):t},g.subject=function(k){return arguments.length?(n=typeof k=="function"?k:tr(k),g):n},g.touchable=function(k){return arguments.length?(r=typeof k=="function"?k:tr(!!k),g):r},g.on=function(){var k=s.on.apply(s,arguments);return k===s?g:k},g.clickDistance=function(k){return arguments.length?(c=(k=+k)*k,g):Math.sqrt(c)},g}function ao(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function ec(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Xn(){}var Rn=.7,zr=1/Rn,en="\\s*([+-]?\\d+)\\s*",Dn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",re="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",P0=/^#([0-9a-f]{3,8})$/,N0=new RegExp(`^rgb\\(${en},${en},${en}\\)$`),C0=new RegExp(`^rgb\\(${re},${re},${re}\\)$`),O0=new RegExp(`^rgba\\(${en},${en},${en},${Dn}\\)$`),L0=new RegExp(`^rgba\\(${re},${re},${re},${Dn}\\)$`),R0=new RegExp(`^hsl\\(${Dn},${re},${re}\\)$`),D0=new RegExp(`^hsla\\(${Dn},${re},${re},${Dn}\\)$`),Ko={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ao(Xn,Un,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Qo,formatHex:Qo,formatHex8:U0,formatHsl:B0,formatRgb:Zo,toString:Zo});function Qo(){return this.rgb().formatHex()}function U0(){return this.rgb().formatHex8()}function B0(){return nc(this).formatHsl()}function Zo(){return this.rgb().formatRgb()}function Un(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=P0.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Jo(t):n===3?new Tt(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?er(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?er(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=N0.exec(e))?new Tt(t[1],t[2],t[3],1):(t=C0.exec(e))?new Tt(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=O0.exec(e))?er(t[1],t[2],t[3],t[4]):(t=L0.exec(e))?er(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=R0.exec(e))?na(t[1],t[2]/100,t[3]/100,1):(t=D0.exec(e))?na(t[1],t[2]/100,t[3]/100,t[4]):Ko.hasOwnProperty(e)?Jo(Ko[e]):e==="transparent"?new Tt(NaN,NaN,NaN,0):null}function Jo(e){return new Tt(e>>16&255,e>>8&255,e&255,1)}function er(e,t,n,r){return r<=0&&(e=t=n=NaN),new Tt(e,t,n,r)}function z0(e){return e instanceof Xn||(e=Un(e)),e?(e=e.rgb(),new Tt(e.r,e.g,e.b,e.opacity)):new Tt}function rs(e,t,n,r){return arguments.length===1?z0(e):new Tt(e,t,n,r??1)}function Tt(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}ao(Tt,rs,ec(Xn,{brighter(e){return e=e==null?zr:Math.pow(zr,e),new Tt(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Rn:Math.pow(Rn,e),new Tt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Tt(Be(this.r),Be(this.g),Be(this.b),Fr(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ta,formatHex:ta,formatHex8:F0,formatRgb:ea,toString:ea}));function ta(){return`#${Oe(this.r)}${Oe(this.g)}${Oe(this.b)}`}function F0(){return`#${Oe(this.r)}${Oe(this.g)}${Oe(this.b)}${Oe((isNaN(this.opacity)?1:this.opacity)*255)}`}function ea(){const e=Fr(this.opacity);return`${e===1?"rgb(":"rgba("}${Be(this.r)}, ${Be(this.g)}, ${Be(this.b)}${e===1?")":`, ${e})`}`}function Fr(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Be(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Oe(e){return e=Be(e),(e<16?"0":"")+e.toString(16)}function na(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Wt(e,t,n,r)}function nc(e){if(e instanceof Wt)return new Wt(e.h,e.s,e.l,e.opacity);if(e instanceof Xn||(e=Un(e)),!e)return new Wt;if(e instanceof Wt)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),s=Math.max(t,n,r),o=NaN,a=s-i,l=(s+i)/2;return a?(t===s?o=(n-r)/a+(n<r)*6:n===s?o=(r-t)/a+2:o=(t-n)/a+4,a/=l<.5?s+i:2-s-i,o*=60):a=l>0&&l<1?0:o,new Wt(o,a,l,e.opacity)}function H0(e,t,n,r){return arguments.length===1?nc(e):new Wt(e,t,n,r??1)}function Wt(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}ao(Wt,H0,ec(Xn,{brighter(e){return e=e==null?zr:Math.pow(zr,e),new Wt(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Rn:Math.pow(Rn,e),new Wt(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Tt(Ri(e>=240?e-240:e+120,i,r),Ri(e,i,r),Ri(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new Wt(ra(this.h),nr(this.s),nr(this.l),Fr(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Fr(this.opacity);return`${e===1?"hsl(":"hsla("}${ra(this.h)}, ${nr(this.s)*100}%, ${nr(this.l)*100}%${e===1?")":`, ${e})`}`}}));function ra(e){return e=(e||0)%360,e<0?e+360:e}function nr(e){return Math.max(0,Math.min(1,e||0))}function Ri(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const rc=e=>()=>e;function q0(e,t){return function(n){return e+n*t}}function G0(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function V0(e){return(e=+e)==1?ic:function(t,n){return n-t?G0(t,n,e):rc(isNaN(t)?n:t)}}function ic(e,t){var n=t-e;return n?q0(e,n):rc(isNaN(e)?t:e)}const ia=(function e(t){var n=V0(t);function r(i,s){var o=n((i=rs(i)).r,(s=rs(s)).r),a=n(i.g,s.g),l=n(i.b,s.b),u=ic(i.opacity,s.opacity);return function(h){return i.r=o(h),i.g=a(h),i.b=l(h),i.opacity=u(h),i+""}}return r.gamma=e,r})(1);function ve(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var is=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Di=new RegExp(is.source,"g");function j0(e){return function(){return e}}function W0(e){return function(t){return e(t)+""}}function X0(e,t){var n=is.lastIndex=Di.lastIndex=0,r,i,s,o=-1,a=[],l=[];for(e=e+"",t=t+"";(r=is.exec(e))&&(i=Di.exec(t));)(s=i.index)>n&&(s=t.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,l.push({i:o,x:ve(r,i)})),n=Di.lastIndex;return n<t.length&&(s=t.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?W0(l[0].x):j0(t):(t=l.length,function(u){for(var h=0,c;h<t;++h)a[(c=l[h]).i]=c.x(u);return a.join("")})}var sa=180/Math.PI,ss={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function sc(e,t,n,r,i,s){var o,a,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,l/=a),e*r<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*sa,skewX:Math.atan(l)*sa,scaleX:o,scaleY:a}}var rr;function Y0(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?ss:sc(t.a,t.b,t.c,t.d,t.e,t.f)}function K0(e){return e==null||(rr||(rr=document.createElementNS("http://www.w3.org/2000/svg","g")),rr.setAttribute("transform",e),!(e=rr.transform.baseVal.consolidate()))?ss:(e=e.matrix,sc(e.a,e.b,e.c,e.d,e.e,e.f))}function oc(e,t,n,r){function i(u){return u.length?u.pop()+" ":""}function s(u,h,c,g,x,E){if(u!==c||h!==g){var A=x.push("translate(",null,t,null,n);E.push({i:A-4,x:ve(u,c)},{i:A-2,x:ve(h,g)})}else(c||g)&&x.push("translate("+c+t+g+n)}function o(u,h,c,g){u!==h?(u-h>180?h+=360:h-u>180&&(u+=360),g.push({i:c.push(i(c)+"rotate(",null,r)-2,x:ve(u,h)})):h&&c.push(i(c)+"rotate("+h+r)}function a(u,h,c,g){u!==h?g.push({i:c.push(i(c)+"skewX(",null,r)-2,x:ve(u,h)}):h&&c.push(i(c)+"skewX("+h+r)}function l(u,h,c,g,x,E){if(u!==c||h!==g){var A=x.push(i(x)+"scale(",null,",",null,")");E.push({i:A-4,x:ve(u,c)},{i:A-2,x:ve(h,g)})}else(c!==1||g!==1)&&x.push(i(x)+"scale("+c+","+g+")")}return function(u,h){var c=[],g=[];return u=e(u),h=e(h),s(u.translateX,u.translateY,h.translateX,h.translateY,c,g),o(u.rotate,h.rotate,c,g),a(u.skewX,h.skewX,c,g),l(u.scaleX,u.scaleY,h.scaleX,h.scaleY,c,g),u=h=null,function(x){for(var E=-1,A=g.length,C;++E<A;)c[(C=g[E]).i]=C.x(x);return c.join("")}}}var Q0=oc(Y0,"px, ","px)","deg)"),Z0=oc(K0,", ",")",")"),J0=1e-12;function oa(e){return((e=Math.exp(e))+1/e)/2}function td(e){return((e=Math.exp(e))-1/e)/2}function ed(e){return((e=Math.exp(2*e))-1)/(e+1)}const nd=(function e(t,n,r){function i(s,o){var a=s[0],l=s[1],u=s[2],h=o[0],c=o[1],g=o[2],x=h-a,E=c-l,A=x*x+E*E,C,T;if(A<J0)T=Math.log(g/u)/t,C=function(z){return[a+z*x,l+z*E,u*Math.exp(t*z*T)]};else{var I=Math.sqrt(A),L=(g*g-u*u+r*A)/(2*u*n*I),k=(g*g-u*u-r*A)/(2*g*n*I),D=Math.log(Math.sqrt(L*L+1)-L),B=Math.log(Math.sqrt(k*k+1)-k);T=(B-D)/t,C=function(z){var y=z*T,w=oa(D),v=u/(n*I)*(w*ed(t*y+D)-td(D));return[a+v*x,l+v*E,u*w/oa(t*y+D)]}}return C.duration=T*1e3*t/Math.SQRT2,C}return i.rho=function(s){var o=Math.max(.001,+s),a=o*o,l=a*a;return e(o,a,l)},i})(Math.SQRT2,2,4);var on=0,vn=0,mn=0,ac=1e3,Hr,bn,qr=0,He=0,vi=0,Bn=typeof performance=="object"&&performance.now?performance:Date,lc=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function lo(){return He||(lc(rd),He=Bn.now()+vi)}function rd(){He=0}function Gr(){this._call=this._time=this._next=null}Gr.prototype=cc.prototype={constructor:Gr,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?lo():+n)+(t==null?0:+t),!this._next&&bn!==this&&(bn?bn._next=this:Hr=this,bn=this),this._call=e,this._time=n,os()},stop:function(){this._call&&(this._call=null,this._time=1/0,os())}};function cc(e,t,n){var r=new Gr;return r.restart(e,t,n),r}function id(){lo(),++on;for(var e=Hr,t;e;)(t=He-e._time)>=0&&e._call.call(void 0,t),e=e._next;--on}function aa(){He=(qr=Bn.now())+vi,on=vn=0;try{id()}finally{on=0,od(),He=0}}function sd(){var e=Bn.now(),t=e-qr;t>ac&&(vi-=t,qr=e)}function od(){for(var e,t=Hr,n,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Hr=n);bn=e,os(r)}function os(e){if(!on){vn&&(vn=clearTimeout(vn));var t=e-He;t>24?(e<1/0&&(vn=setTimeout(aa,e-Bn.now()-vi)),mn&&(mn=clearInterval(mn))):(mn||(qr=Bn.now(),mn=setInterval(sd,ac)),on=1,lc(aa))}}function la(e,t,n){var r=new Gr;return t=t==null?0:+t,r.restart(i=>{r.stop(),e(i+t)},t,n),r}var ad=_i("start","end","cancel","interrupt"),ld=[],uc=0,ca=1,as=2,$r=3,ua=4,ls=5,Ar=6;function bi(e,t,n,r,i,s){var o=e.__transition;if(!o)e.__transition={};else if(n in o)return;cd(e,n,{name:t,index:r,group:i,on:ad,tween:ld,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:uc})}function co(e,t){var n=Qt(e,t);if(n.state>uc)throw new Error("too late; already scheduled");return n}function ae(e,t){var n=Qt(e,t);if(n.state>$r)throw new Error("too late; already running");return n}function Qt(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function cd(e,t,n){var r=e.__transition,i;r[t]=n,n.timer=cc(s,0,n.time);function s(u){n.state=ca,n.timer.restart(o,n.delay,n.time),n.delay<=u&&o(u-n.delay)}function o(u){var h,c,g,x;if(n.state!==ca)return l();for(h in r)if(x=r[h],x.name===n.name){if(x.state===$r)return la(o);x.state===ua?(x.state=Ar,x.timer.stop(),x.on.call("interrupt",e,e.__data__,x.index,x.group),delete r[h]):+h<t&&(x.state=Ar,x.timer.stop(),x.on.call("cancel",e,e.__data__,x.index,x.group),delete r[h])}if(la(function(){n.state===$r&&(n.state=ua,n.timer.restart(a,n.delay,n.time),a(u))}),n.state=as,n.on.call("start",e,e.__data__,n.index,n.group),n.state===as){for(n.state=$r,i=new Array(g=n.tween.length),h=0,c=-1;h<g;++h)(x=n.tween[h].value.call(e,e.__data__,n.index,n.group))&&(i[++c]=x);i.length=c+1}}function a(u){for(var h=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(l),n.state=ls,1),c=-1,g=i.length;++c<g;)i[c].call(e,h);n.state===ls&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){n.state=Ar,n.timer.stop(),delete r[t];for(var u in r)return;delete e.__transition}}function Ir(e,t){var n=e.__transition,r,i,s=!0,o;if(n){t=t==null?null:t+"";for(o in n){if((r=n[o]).name!==t){s=!1;continue}i=r.state>as&&r.state<ls,r.state=Ar,r.timer.stop(),r.on.call(i?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete n[o]}s&&delete e.__transition}}function ud(e){return this.each(function(){Ir(this,e)})}function hd(e,t){var n,r;return function(){var i=ae(this,e),s=i.tween;if(s!==n){r=n=s;for(var o=0,a=r.length;o<a;++o)if(r[o].name===t){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function fd(e,t,n){var r,i;if(typeof n!="function")throw new Error;return function(){var s=ae(this,e),o=s.tween;if(o!==r){i=(r=o).slice();for(var a={name:t,value:n},l=0,u=i.length;l<u;++l)if(i[l].name===t){i[l]=a;break}l===u&&i.push(a)}s.tween=i}}function dd(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r=Qt(this.node(),n).tween,i=0,s=r.length,o;i<s;++i)if((o=r[i]).name===e)return o.value;return null}return this.each((t==null?hd:fd)(n,e,t))}function uo(e,t,n){var r=e._id;return e.each(function(){var i=ae(this,r);(i.value||(i.value={}))[t]=n.apply(this,arguments)}),function(i){return Qt(i,r).value[t]}}function hc(e,t){var n;return(typeof t=="number"?ve:t instanceof Un?ia:(n=Un(t))?(t=n,ia):X0)(e,t)}function pd(e){return function(){this.removeAttribute(e)}}function gd(e){return function(){this.removeAttributeNS(e.space,e.local)}}function md(e,t,n){var r,i=n+"",s;return function(){var o=this.getAttribute(e);return o===i?null:o===r?s:s=t(r=o,n)}}function yd(e,t,n){var r,i=n+"",s;return function(){var o=this.getAttributeNS(e.space,e.local);return o===i?null:o===r?s:s=t(r=o,n)}}function wd(e,t,n){var r,i,s;return function(){var o,a=n(this),l;return a==null?void this.removeAttribute(e):(o=this.getAttribute(e),l=a+"",o===l?null:o===r&&l===i?s:(i=l,s=t(r=o,a)))}}function _d(e,t,n){var r,i,s;return function(){var o,a=n(this),l;return a==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),l=a+"",o===l?null:o===r&&l===i?s:(i=l,s=t(r=o,a)))}}function xd(e,t){var n=xi(e),r=n==="transform"?Z0:hc;return this.attrTween(e,typeof t=="function"?(n.local?_d:wd)(n,r,uo(this,"attr."+e,t)):t==null?(n.local?gd:pd)(n):(n.local?yd:md)(n,r,t))}function vd(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function bd(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function Sd(e,t){var n,r;function i(){var s=t.apply(this,arguments);return s!==r&&(n=(r=s)&&bd(e,s)),n}return i._value=t,i}function Ed(e,t){var n,r;function i(){var s=t.apply(this,arguments);return s!==r&&(n=(r=s)&&vd(e,s)),n}return i._value=t,i}function Md(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var r=xi(e);return this.tween(n,(r.local?Sd:Ed)(r,t))}function $d(e,t){return function(){co(this,e).delay=+t.apply(this,arguments)}}function Ad(e,t){return t=+t,function(){co(this,e).delay=t}}function Id(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?$d:Ad)(t,e)):Qt(this.node(),t).delay}function Td(e,t){return function(){ae(this,e).duration=+t.apply(this,arguments)}}function kd(e,t){return t=+t,function(){ae(this,e).duration=t}}function Pd(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Td:kd)(t,e)):Qt(this.node(),t).duration}function Nd(e,t){if(typeof t!="function")throw new Error;return function(){ae(this,e).ease=t}}function Cd(e){var t=this._id;return arguments.length?this.each(Nd(t,e)):Qt(this.node(),t).ease}function Od(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;ae(this,e).ease=n}}function Ld(e){if(typeof e!="function")throw new Error;return this.each(Od(this._id,e))}function Rd(e){typeof e!="function"&&(e=Hl(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,a=r[i]=[],l,u=0;u<o;++u)(l=s[u])&&e.call(l,l.__data__,u,s)&&a.push(l);return new ge(r,this._parents,this._name,this._id)}function Dd(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,i=n.length,s=Math.min(r,i),o=new Array(r),a=0;a<s;++a)for(var l=t[a],u=n[a],h=l.length,c=o[a]=new Array(h),g,x=0;x<h;++x)(g=l[x]||u[x])&&(c[x]=g);for(;a<r;++a)o[a]=t[a];return new ge(o,this._parents,this._name,this._id)}function Ud(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function Bd(e,t,n){var r,i,s=Ud(t)?co:ae;return function(){var o=s(this,e),a=o.on;a!==r&&(i=(r=a).copy()).on(t,n),o.on=i}}function zd(e,t){var n=this._id;return arguments.length<2?Qt(this.node(),n).on.on(e):this.each(Bd(n,e,t))}function Fd(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Hd(){return this.on("end.remove",Fd(this._id))}function qd(e){var t=this._name,n=this._id;typeof e!="function"&&(e=so(e));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var a=r[o],l=a.length,u=s[o]=new Array(l),h,c,g=0;g<l;++g)(h=a[g])&&(c=e.call(h,h.__data__,g,a))&&("__data__"in h&&(c.__data__=h.__data__),u[g]=c,bi(u[g],t,n,g,u,Qt(h,n)));return new ge(s,this._parents,t,n)}function Gd(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Fl(e));for(var r=this._groups,i=r.length,s=[],o=[],a=0;a<i;++a)for(var l=r[a],u=l.length,h,c=0;c<u;++c)if(h=l[c]){for(var g=e.call(h,h.__data__,c,l),x,E=Qt(h,n),A=0,C=g.length;A<C;++A)(x=g[A])&&bi(x,t,n,A,g,E);s.push(g),o.push(h)}return new ge(s,o,t,n)}var Vd=Wn.prototype.constructor;function jd(){return new Vd(this._groups,this._parents)}function Wd(e,t){var n,r,i;return function(){var s=sn(this,e),o=(this.style.removeProperty(e),sn(this,e));return s===o?null:s===n&&o===r?i:i=t(n=s,r=o)}}function fc(e){return function(){this.style.removeProperty(e)}}function Xd(e,t,n){var r,i=n+"",s;return function(){var o=sn(this,e);return o===i?null:o===r?s:s=t(r=o,n)}}function Yd(e,t,n){var r,i,s;return function(){var o=sn(this,e),a=n(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(e),sn(this,e))),o===l?null:o===r&&l===i?s:(i=l,s=t(r=o,a))}}function Kd(e,t){var n,r,i,s="style."+t,o="end."+s,a;return function(){var l=ae(this,e),u=l.on,h=l.value[s]==null?a||(a=fc(t)):void 0;(u!==n||i!==h)&&(r=(n=u).copy()).on(o,i=h),l.on=r}}function Qd(e,t,n){var r=(e+="")=="transform"?Q0:hc;return t==null?this.styleTween(e,Wd(e,r)).on("end.style."+e,fc(e)):typeof t=="function"?this.styleTween(e,Yd(e,r,uo(this,"style."+e,t))).each(Kd(this._id,e)):this.styleTween(e,Xd(e,r,t),n).on("end.style."+e,null)}function Zd(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function Jd(e,t,n){var r,i;function s(){var o=t.apply(this,arguments);return o!==i&&(r=(i=o)&&Zd(e,o,n)),r}return s._value=t,s}function tp(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,Jd(e,t,n??""))}function ep(e){return function(){this.textContent=e}}function np(e){return function(){var t=e(this);this.textContent=t??""}}function rp(e){return this.tween("text",typeof e=="function"?np(uo(this,"text",e)):ep(e==null?"":e+""))}function ip(e){return function(t){this.textContent=e.call(this,t)}}function sp(e){var t,n;function r(){var i=e.apply(this,arguments);return i!==n&&(t=(n=i)&&ip(i)),t}return r._value=e,r}function op(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,sp(e))}function ap(){for(var e=this._name,t=this._id,n=dc(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],a=o.length,l,u=0;u<a;++u)if(l=o[u]){var h=Qt(l,t);bi(l,e,n,u,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new ge(r,this._parents,e,n)}function lp(){var e,t,n=this,r=n._id,i=n.size();return new Promise(function(s,o){var a={value:o},l={value:function(){--i===0&&s()}};n.each(function(){var u=ae(this,r),h=u.on;h!==e&&(t=(e=h).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),u.on=t}),i===0&&s()})}var cp=0;function ge(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function dc(){return++cp}var ce=Wn.prototype;ge.prototype={constructor:ge,select:qd,selectAll:Gd,selectChild:ce.selectChild,selectChildren:ce.selectChildren,filter:Rd,merge:Dd,selection:jd,transition:ap,call:ce.call,nodes:ce.nodes,node:ce.node,size:ce.size,empty:ce.empty,each:ce.each,on:zd,attr:xd,attrTween:Md,style:Qd,styleTween:tp,text:rp,textTween:op,remove:Hd,tween:dd,delay:Id,duration:Pd,ease:Cd,easeVarying:Ld,end:lp,[Symbol.iterator]:ce[Symbol.iterator]};function up(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var hp={time:null,delay:0,duration:250,ease:up};function fp(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function dp(e){var t,n;e instanceof ge?(t=e._id,e=e._name):(t=dc(),(n=hp).time=lo(),e=e==null?null:e+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],a=o.length,l,u=0;u<a;++u)(l=o[u])&&bi(l,e,t,u,o,n||fp(l,t));return new ge(r,this._parents,e,t)}Wn.prototype.interrupt=ud;Wn.prototype.transition=dp;const de=11102230246251565e-32,yt=134217729,pp=(3+8*de)*de;function Ui(e,t,n,r,i){let s,o,a,l,u=t[0],h=r[0],c=0,g=0;h>u==h>-u?(s=u,u=t[++c]):(s=h,h=r[++g]);let x=0;if(c<e&&g<n)for(h>u==h>-u?(o=u+s,a=s-(o-u),u=t[++c]):(o=h+s,a=s-(o-h),h=r[++g]),s=o,a!==0&&(i[x++]=a);c<e&&g<n;)h>u==h>-u?(o=s+u,l=o-s,a=s-(o-l)+(u-l),u=t[++c]):(o=s+h,l=o-s,a=s-(o-l)+(h-l),h=r[++g]),s=o,a!==0&&(i[x++]=a);for(;c<e;)o=s+u,l=o-s,a=s-(o-l)+(u-l),u=t[++c],s=o,a!==0&&(i[x++]=a);for(;g<n;)o=s+h,l=o-s,a=s-(o-l)+(h-l),h=r[++g],s=o,a!==0&&(i[x++]=a);return(s!==0||x===0)&&(i[x++]=s),x}function gp(e,t){let n=t[0];for(let r=1;r<e;r++)n+=t[r];return n}function Yn(e){return new Float64Array(e)}const mp=(3+16*de)*de,yp=(2+12*de)*de,wp=(9+64*de)*de*de,Ve=Yn(4),ha=Yn(8),fa=Yn(12),da=Yn(16),bt=Yn(4);function _p(e,t,n,r,i,s,o){let a,l,u,h,c,g,x,E,A,C,T,I,L,k,D,B,z,y;const w=e-i,v=n-i,b=t-s,M=r-s;k=w*M,g=yt*w,x=g-(g-w),E=w-x,g=yt*M,A=g-(g-M),C=M-A,D=E*C-(k-x*A-E*A-x*C),B=b*v,g=yt*b,x=g-(g-b),E=b-x,g=yt*v,A=g-(g-v),C=v-A,z=E*C-(B-x*A-E*A-x*C),T=D-z,c=D-T,Ve[0]=D-(T+c)+(c-z),I=k+T,c=I-k,L=k-(I-c)+(T-c),T=L-B,c=L-T,Ve[1]=L-(T+c)+(c-B),y=I+T,c=y-I,Ve[2]=I-(y-c)+(T-c),Ve[3]=y;let m=gp(4,Ve),p=yp*o;if(m>=p||-m>=p||(c=e-w,a=e-(w+c)+(c-i),c=n-v,u=n-(v+c)+(c-i),c=t-b,l=t-(b+c)+(c-s),c=r-M,h=r-(M+c)+(c-s),a===0&&l===0&&u===0&&h===0)||(p=wp*o+pp*Math.abs(m),m+=w*h+M*a-(b*u+v*l),m>=p||-m>=p))return m;k=a*M,g=yt*a,x=g-(g-a),E=a-x,g=yt*M,A=g-(g-M),C=M-A,D=E*C-(k-x*A-E*A-x*C),B=l*v,g=yt*l,x=g-(g-l),E=l-x,g=yt*v,A=g-(g-v),C=v-A,z=E*C-(B-x*A-E*A-x*C),T=D-z,c=D-T,bt[0]=D-(T+c)+(c-z),I=k+T,c=I-k,L=k-(I-c)+(T-c),T=L-B,c=L-T,bt[1]=L-(T+c)+(c-B),y=I+T,c=y-I,bt[2]=I-(y-c)+(T-c),bt[3]=y;const f=Ui(4,Ve,4,bt,ha);k=w*h,g=yt*w,x=g-(g-w),E=w-x,g=yt*h,A=g-(g-h),C=h-A,D=E*C-(k-x*A-E*A-x*C),B=b*u,g=yt*b,x=g-(g-b),E=b-x,g=yt*u,A=g-(g-u),C=u-A,z=E*C-(B-x*A-E*A-x*C),T=D-z,c=D-T,bt[0]=D-(T+c)+(c-z),I=k+T,c=I-k,L=k-(I-c)+(T-c),T=L-B,c=L-T,bt[1]=L-(T+c)+(c-B),y=I+T,c=y-I,bt[2]=I-(y-c)+(T-c),bt[3]=y;const d=Ui(f,ha,4,bt,fa);k=a*h,g=yt*a,x=g-(g-a),E=a-x,g=yt*h,A=g-(g-h),C=h-A,D=E*C-(k-x*A-E*A-x*C),B=l*u,g=yt*l,x=g-(g-l),E=l-x,g=yt*u,A=g-(g-u),C=u-A,z=E*C-(B-x*A-E*A-x*C),T=D-z,c=D-T,bt[0]=D-(T+c)+(c-z),I=k+T,c=I-k,L=k-(I-c)+(T-c),T=L-B,c=L-T,bt[1]=L-(T+c)+(c-B),y=I+T,c=y-I,bt[2]=I-(y-c)+(T-c),bt[3]=y;const _=Ui(d,fa,4,bt,da);return da[_-1]}function ir(e,t,n,r,i,s){const o=(t-s)*(n-i),a=(e-i)*(r-s),l=o-a,u=Math.abs(o+a);return Math.abs(l)>=mp*u?l:-_p(e,t,n,r,i,s,u)}const pa=Math.pow(2,-52),sr=new Uint32Array(512);class Vr{static from(t,n=Ep,r=Mp){const i=t.length,s=new Float64Array(i*2);for(let o=0;o<i;o++){const a=t[o];s[2*o]=n(a),s[2*o+1]=r(a)}return new Vr(s)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const r=Math.max(2*n-5,0);this._triangles=new Uint32Array(r*3),this._halfedges=new Int32Array(r*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:r,_hullTri:i,_hullHash:s}=this,o=t.length>>1;let a=1/0,l=1/0,u=-1/0,h=-1/0;for(let w=0;w<o;w++){const v=t[2*w],b=t[2*w+1];v<a&&(a=v),b<l&&(l=b),v>u&&(u=v),b>h&&(h=b),this._ids[w]=w}const c=(a+u)/2,g=(l+h)/2;let x,E,A;for(let w=0,v=1/0;w<o;w++){const b=Bi(c,g,t[2*w],t[2*w+1]);b<v&&(x=w,v=b)}const C=t[2*x],T=t[2*x+1];for(let w=0,v=1/0;w<o;w++){if(w===x)continue;const b=Bi(C,T,t[2*w],t[2*w+1]);b<v&&b>0&&(E=w,v=b)}let I=t[2*E],L=t[2*E+1],k=1/0;for(let w=0;w<o;w++){if(w===x||w===E)continue;const v=bp(C,T,I,L,t[2*w],t[2*w+1]);v<k&&(A=w,k=v)}let D=t[2*A],B=t[2*A+1];if(k===1/0){for(let b=0;b<o;b++)this._dists[b]=t[2*b]-t[0]||t[2*b+1]-t[1];Ze(this._ids,this._dists,0,o-1);const w=new Uint32Array(o);let v=0;for(let b=0,M=-1/0;b<o;b++){const m=this._ids[b],p=this._dists[m];p>M&&(w[v++]=m,M=p)}this.hull=w.subarray(0,v),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(ir(C,T,I,L,D,B)<0){const w=E,v=I,b=L;E=A,I=D,L=B,A=w,D=v,B=b}const z=Sp(C,T,I,L,D,B);this._cx=z.x,this._cy=z.y;for(let w=0;w<o;w++)this._dists[w]=Bi(t[2*w],t[2*w+1],z.x,z.y);Ze(this._ids,this._dists,0,o-1),this._hullStart=x;let y=3;r[x]=n[A]=E,r[E]=n[x]=A,r[A]=n[E]=x,i[x]=0,i[E]=1,i[A]=2,s.fill(-1),s[this._hashKey(C,T)]=x,s[this._hashKey(I,L)]=E,s[this._hashKey(D,B)]=A,this.trianglesLen=0,this._addTriangle(x,E,A,-1,-1,-1);for(let w=0,v,b;w<this._ids.length;w++){const M=this._ids[w],m=t[2*M],p=t[2*M+1];if(w>0&&Math.abs(m-v)<=pa&&Math.abs(p-b)<=pa||(v=m,b=p,M===x||M===E||M===A))continue;let f=0;for(let O=0,U=this._hashKey(m,p);O<this._hashSize&&(f=s[(U+O)%this._hashSize],!(f!==-1&&f!==r[f]));O++);f=n[f];let d=f,_;for(;_=r[d],ir(m,p,t[2*d],t[2*d+1],t[2*_],t[2*_+1])>=0;)if(d=_,d===f){d=-1;break}if(d===-1)continue;let S=this._addTriangle(d,M,r[d],-1,-1,i[d]);i[M]=this._legalize(S+2),i[d]=S,y++;let $=r[d];for(;_=r[$],ir(m,p,t[2*$],t[2*$+1],t[2*_],t[2*_+1])<0;)S=this._addTriangle($,M,_,i[M],-1,i[$]),i[M]=this._legalize(S+2),r[$]=$,y--,$=_;if(d===f)for(;_=n[d],ir(m,p,t[2*_],t[2*_+1],t[2*d],t[2*d+1])<0;)S=this._addTriangle(_,M,d,-1,i[d],i[_]),this._legalize(S+2),i[_]=S,r[d]=d,y--,d=_;this._hullStart=n[M]=d,r[d]=n[$]=M,r[M]=$,s[this._hashKey(m,p)]=M,s[this._hashKey(t[2*d],t[2*d+1])]=d}this.hull=new Uint32Array(y);for(let w=0,v=this._hullStart;w<y;w++)this.hull[w]=v,v=r[v];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(xp(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:r,coords:i}=this;let s=0,o=0;for(;;){const a=r[t],l=t-t%3;if(o=l+(t+2)%3,a===-1){if(s===0)break;t=sr[--s];continue}const u=a-a%3,h=l+(t+1)%3,c=u+(a+2)%3,g=n[o],x=n[t],E=n[h],A=n[c];if(vp(i[2*g],i[2*g+1],i[2*x],i[2*x+1],i[2*E],i[2*E+1],i[2*A],i[2*A+1])){n[t]=A,n[a]=g;const T=r[c];if(T===-1){let L=this._hullStart;do{if(this._hullTri[L]===c){this._hullTri[L]=t;break}L=this._hullPrev[L]}while(L!==this._hullStart)}this._link(t,T),this._link(a,r[o]),this._link(o,c);const I=u+(a+1)%3;s<sr.length&&(sr[s++]=I)}else{if(s===0)break;t=sr[--s]}}return o}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,r,i,s,o){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=n,this._triangles[a+2]=r,this._link(a,i),this._link(a+1,s),this._link(a+2,o),this.trianglesLen+=3,a}}function xp(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function Bi(e,t,n,r){const i=e-n,s=t-r;return i*i+s*s}function vp(e,t,n,r,i,s,o,a){const l=e-o,u=t-a,h=n-o,c=r-a,g=i-o,x=s-a,E=l*l+u*u,A=h*h+c*c,C=g*g+x*x;return l*(c*C-A*x)-u*(h*C-A*g)+E*(h*x-c*g)<0}function bp(e,t,n,r,i,s){const o=n-e,a=r-t,l=i-e,u=s-t,h=o*o+a*a,c=l*l+u*u,g=.5/(o*u-a*l),x=(u*h-a*c)*g,E=(o*c-l*h)*g;return x*x+E*E}function Sp(e,t,n,r,i,s){const o=n-e,a=r-t,l=i-e,u=s-t,h=o*o+a*a,c=l*l+u*u,g=.5/(o*u-a*l),x=e+(u*h-a*c)*g,E=t+(o*c-l*h)*g;return{x,y:E}}function Ze(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const s=e[i],o=t[s];let a=i-1;for(;a>=n&&t[e[a]]>o;)e[a+1]=e[a--];e[a+1]=s}else{const i=n+r>>1;let s=n+1,o=r;yn(e,i,s),t[e[n]]>t[e[r]]&&yn(e,n,r),t[e[s]]>t[e[r]]&&yn(e,s,r),t[e[n]]>t[e[s]]&&yn(e,n,s);const a=e[s],l=t[a];for(;;){do s++;while(t[e[s]]<l);do o--;while(t[e[o]]>l);if(o<s)break;yn(e,s,o)}e[n+1]=e[o],e[o]=a,r-s+1>=o-n?(Ze(e,t,s,r),Ze(e,t,n,o-1)):(Ze(e,t,n,o-1),Ze(e,t,s,r))}}function yn(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function Ep(e){return e[0]}function Mp(e){return e[1]}const ga=1e-6;class Le{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,r){t=+t,n=+n,r=+r;const i=t+r,s=n;if(r<0)throw new Error("negative radius");this._x1===null?this._+=`M${i},${s}`:(Math.abs(this._x1-i)>ga||Math.abs(this._y1-s)>ga)&&(this._+="L"+i+","+s),r&&(this._+=`A${r},${r},0,1,1,${t-r},${n}A${r},${r},0,1,1,${this._x1=i},${this._y1=s}`)}rect(t,n,r,i){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+r}v${+i}h${-r}Z`}value(){return this._||null}}class cs{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}class $p{constructor(t,[n,r,i,s]=[0,0,960,500]){if(!((i=+i)>=(n=+n))||!((s=+s)>=(r=+r)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=i,this.xmin=n,this.ymax=s,this.ymin=r,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:r},vectors:i}=this;let s,o;const a=this.circumcenters=this._circumcenters.subarray(0,r.length/3*2);for(let A=0,C=0,T=r.length,I,L;A<T;A+=3,C+=2){const k=r[A]*2,D=r[A+1]*2,B=r[A+2]*2,z=t[k],y=t[k+1],w=t[D],v=t[D+1],b=t[B],M=t[B+1],m=w-z,p=v-y,f=b-z,d=M-y,_=(m*d-p*f)*2;if(Math.abs(_)<1e-9){if(s===void 0){s=o=0;for(const $ of n)s+=t[$*2],o+=t[$*2+1];s/=n.length,o/=n.length}const S=1e9*Math.sign((s-z)*d-(o-y)*f);I=(z+b)/2-S*d,L=(y+M)/2+S*f}else{const S=1/_,$=m*m+p*p,O=f*f+d*d;I=z+(d*$-p*O)*S,L=y+(m*O-f*$)*S}a[C]=I,a[C+1]=L}let l=n[n.length-1],u,h=l*4,c,g=t[2*l],x,E=t[2*l+1];i.fill(0);for(let A=0;A<n.length;++A)l=n[A],u=h,c=g,x=E,h=l*4,g=t[2*l],E=t[2*l+1],i[u+2]=i[h]=x-E,i[u+3]=i[h+1]=g-c}render(t){const n=t==null?t=new Le:void 0,{delaunay:{halfedges:r,inedges:i,hull:s},circumcenters:o,vectors:a}=this;if(s.length<=1)return null;for(let h=0,c=r.length;h<c;++h){const g=r[h];if(g<h)continue;const x=Math.floor(h/3)*2,E=Math.floor(g/3)*2,A=o[x],C=o[x+1],T=o[E],I=o[E+1];this._renderSegment(A,C,T,I,t)}let l,u=s[s.length-1];for(let h=0;h<s.length;++h){l=u,u=s[h];const c=Math.floor(i[u]/3)*2,g=o[c],x=o[c+1],E=l*4,A=this._project(g,x,a[E+2],a[E+3]);A&&this._renderSegment(g,x,A[0],A[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new Le:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const r=n==null?n=new Le:void 0,i=this._clip(t);if(i===null||!i.length)return;n.moveTo(i[0],i[1]);let s=i.length;for(;i[0]===i[s-2]&&i[1]===i[s-1]&&s>1;)s-=2;for(let o=2;o<s;o+=2)(i[o]!==i[o-2]||i[o+1]!==i[o-1])&&n.lineTo(i[o],i[o+1]);return n.closePath(),r&&r.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,r=t.length/2;n<r;++n){const i=this.cellPolygon(n);i&&(i.index=n,yield i)}}cellPolygon(t){const n=new cs;return this.renderCell(t,n),n.value()}_renderSegment(t,n,r,i,s){let o;const a=this._regioncode(t,n),l=this._regioncode(r,i);a===0&&l===0?(s.moveTo(t,n),s.lineTo(r,i)):(o=this._clipSegment(t,n,r,i,a,l))&&(s.moveTo(o[0],o[1]),s.lineTo(o[2],o[3]))}contains(t,n,r){return n=+n,n!==n||(r=+r,r!==r)?!1:this.delaunay._step(t,n,r)===t}*neighbors(t){const n=this._clip(t);if(n)for(const r of this.delaunay.neighbors(t)){const i=this._clip(r);if(i){t:for(let s=0,o=n.length;s<o;s+=2)for(let a=0,l=i.length;a<l;a+=2)if(n[s]===i[a]&&n[s+1]===i[a+1]&&n[(s+2)%o]===i[(a+l-2)%l]&&n[(s+3)%o]===i[(a+l-1)%l]){yield r;break t}}}}_cell(t){const{circumcenters:n,delaunay:{inedges:r,halfedges:i,triangles:s}}=this,o=r[t];if(o===-1)return null;const a=[];let l=o;do{const u=Math.floor(l/3);if(a.push(n[u*2],n[u*2+1]),l=l%3===2?l-2:l+1,s[l]!==t)break;l=i[l]}while(l!==o&&l!==-1);return a}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:r}=this,i=t*4;return this._simplify(r[i]||r[i+1]?this._clipInfinite(t,n,r[i],r[i+1],r[i+2],r[i+3]):this._clipFinite(t,n))}_clipFinite(t,n){const r=n.length;let i=null,s,o,a=n[r-2],l=n[r-1],u,h=this._regioncode(a,l),c,g=0;for(let x=0;x<r;x+=2)if(s=a,o=l,a=n[x],l=n[x+1],u=h,h=this._regioncode(a,l),u===0&&h===0)c=g,g=0,i?i.push(a,l):i=[a,l];else{let E,A,C,T,I;if(u===0){if((E=this._clipSegment(s,o,a,l,u,h))===null)continue;[A,C,T,I]=E}else{if((E=this._clipSegment(a,l,s,o,h,u))===null)continue;[T,I,A,C]=E,c=g,g=this._edgecode(A,C),c&&g&&this._edge(t,c,g,i,i.length),i?i.push(A,C):i=[A,C]}c=g,g=this._edgecode(T,I),c&&g&&this._edge(t,c,g,i,i.length),i?i.push(T,I):i=[T,I]}if(i)c=g,g=this._edgecode(i[0],i[1]),c&&g&&this._edge(t,c,g,i,i.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return i}_clipSegment(t,n,r,i,s,o){const a=s<o;for(a&&([t,n,r,i,s,o]=[r,i,t,n,o,s]);;){if(s===0&&o===0)return a?[r,i,t,n]:[t,n,r,i];if(s&o)return null;let l,u,h=s||o;h&8?(l=t+(r-t)*(this.ymax-n)/(i-n),u=this.ymax):h&4?(l=t+(r-t)*(this.ymin-n)/(i-n),u=this.ymin):h&2?(u=n+(i-n)*(this.xmax-t)/(r-t),l=this.xmax):(u=n+(i-n)*(this.xmin-t)/(r-t),l=this.xmin),s?(t=l,n=u,s=this._regioncode(t,n)):(r=l,i=u,o=this._regioncode(r,i))}}_clipInfinite(t,n,r,i,s,o){let a=Array.from(n),l;if((l=this._project(a[0],a[1],r,i))&&a.unshift(l[0],l[1]),(l=this._project(a[a.length-2],a[a.length-1],s,o))&&a.push(l[0],l[1]),a=this._clipFinite(t,a))for(let u=0,h=a.length,c,g=this._edgecode(a[h-2],a[h-1]);u<h;u+=2)c=g,g=this._edgecode(a[u],a[u+1]),c&&g&&(u=this._edge(t,c,g,a,u),h=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,n,r,i,s){for(;n!==r;){let o,a;switch(n){case 5:n=4;continue;case 4:n=6,o=this.xmax,a=this.ymin;break;case 6:n=2;continue;case 2:n=10,o=this.xmax,a=this.ymax;break;case 10:n=8;continue;case 8:n=9,o=this.xmin,a=this.ymax;break;case 9:n=1;continue;case 1:n=5,o=this.xmin,a=this.ymin;break}(i[s]!==o||i[s+1]!==a)&&this.contains(t,o,a)&&(i.splice(s,0,o,a),s+=2)}return s}_project(t,n,r,i){let s=1/0,o,a,l;if(i<0){if(n<=this.ymin)return null;(o=(this.ymin-n)/i)<s&&(l=this.ymin,a=t+(s=o)*r)}else if(i>0){if(n>=this.ymax)return null;(o=(this.ymax-n)/i)<s&&(l=this.ymax,a=t+(s=o)*r)}if(r>0){if(t>=this.xmax)return null;(o=(this.xmax-t)/r)<s&&(a=this.xmax,l=n+(s=o)*i)}else if(r<0){if(t<=this.xmin)return null;(o=(this.xmin-t)/r)<s&&(a=this.xmin,l=n+(s=o)*i)}return[a,l]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}_simplify(t){if(t&&t.length>4){for(let n=0;n<t.length;n+=2){const r=(n+2)%t.length,i=(n+4)%t.length;(t[n]===t[r]&&t[r]===t[i]||t[n+1]===t[r+1]&&t[r+1]===t[i+1])&&(t.splice(r,2),n-=2)}t.length||(t=null)}return t}}const Ap=2*Math.PI,je=Math.pow;function Ip(e){return e[0]}function Tp(e){return e[1]}function kp(e){const{triangles:t,coords:n}=e;for(let r=0;r<t.length;r+=3){const i=2*t[r],s=2*t[r+1],o=2*t[r+2];if((n[o]-n[i])*(n[s+1]-n[i+1])-(n[s]-n[i])*(n[o+1]-n[i+1])>1e-10)return!1}return!0}function Pp(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class ho{static from(t,n=Ip,r=Tp,i){return new ho("length"in t?Np(t,n,r,i):Float64Array.from(Cp(t,n,r,i)))}constructor(t){this._delaunator=new Vr(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&kp(t)){this.collinear=Int32Array.from({length:n.length/2},(g,x)=>x).sort((g,x)=>n[2*g]-n[2*x]||n[2*g+1]-n[2*x+1]);const l=this.collinear[0],u=this.collinear[this.collinear.length-1],h=[n[2*l],n[2*l+1],n[2*u],n[2*u+1]],c=1e-8*Math.hypot(h[3]-h[1],h[2]-h[0]);for(let g=0,x=n.length/2;g<x;++g){const E=Pp(n[2*g],n[2*g+1],c);n[2*g]=E[0],n[2*g+1]=E[1]}this._delaunator=new Vr(n)}else delete this.collinear;const r=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let l=0,u=r.length;l<u;++l){const h=s[l%3===2?l-2:l+1];(r[l]===-1||o[h]===-1)&&(o[h]=l)}for(let l=0,u=i.length;l<u;++l)a[i[l]]=l;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],o[i[0]]=1,i.length===2&&(o[i[1]]=0,this.triangles[1]=i[1],this.triangles[2]=i[1]))}voronoi(t){return new $p(this,t)}*neighbors(t){const{inedges:n,hull:r,_hullIndex:i,halfedges:s,triangles:o,collinear:a}=this;if(a){const c=a.indexOf(t);c>0&&(yield a[c-1]),c<a.length-1&&(yield a[c+1]);return}const l=n[t];if(l===-1)return;let u=l,h=-1;do{if(yield h=o[u],u=u%3===2?u-2:u+1,o[u]!==t)return;if(u=s[u],u===-1){const c=r[(i[t]+1)%r.length];c!==h&&(yield c);return}}while(u!==l)}find(t,n,r=0){if(t=+t,t!==t||(n=+n,n!==n))return-1;const i=r;let s;for(;(s=this._step(r,t,n))>=0&&s!==r&&s!==i;)r=s;return s}_step(t,n,r){const{inedges:i,hull:s,_hullIndex:o,halfedges:a,triangles:l,points:u}=this;if(i[t]===-1||!u.length)return(t+1)%(u.length>>1);let h=t,c=je(n-u[t*2],2)+je(r-u[t*2+1],2);const g=i[t];let x=g;do{let E=l[x];const A=je(n-u[E*2],2)+je(r-u[E*2+1],2);if(A<c&&(c=A,h=E),x=x%3===2?x-2:x+1,l[x]!==t)break;if(x=a[x],x===-1){if(x=s[(o[t]+1)%s.length],x!==E&&je(n-u[x*2],2)+je(r-u[x*2+1],2)<c)return x;break}}while(x!==g);return h}render(t){const n=t==null?t=new Le:void 0,{points:r,halfedges:i,triangles:s}=this;for(let o=0,a=i.length;o<a;++o){const l=i[o];if(l<o)continue;const u=s[o]*2,h=s[l]*2;t.moveTo(r[u],r[u+1]),t.lineTo(r[h],r[h+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n){n===void 0&&(!t||typeof t.moveTo!="function")&&(n=t,t=null),n=n==null?2:+n;const r=t==null?t=new Le:void 0,{points:i}=this;for(let s=0,o=i.length;s<o;s+=2){const a=i[s],l=i[s+1];t.moveTo(a+n,l),t.arc(a,l,n,0,Ap)}return r&&r.value()}renderHull(t){const n=t==null?t=new Le:void 0,{hull:r,points:i}=this,s=r[0]*2,o=r.length;t.moveTo(i[s],i[s+1]);for(let a=1;a<o;++a){const l=2*r[a];t.lineTo(i[l],i[l+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new cs;return this.renderHull(t),t.value()}renderTriangle(t,n){const r=n==null?n=new Le:void 0,{points:i,triangles:s}=this,o=s[t*=3]*2,a=s[t+1]*2,l=s[t+2]*2;return n.moveTo(i[o],i[o+1]),n.lineTo(i[a],i[a+1]),n.lineTo(i[l],i[l+1]),n.closePath(),r&&r.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,r=t.length/3;n<r;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new cs;return this.renderTriangle(t,n),n.value()}}function Np(e,t,n,r){const i=e.length,s=new Float64Array(i*2);for(let o=0;o<i;++o){const a=e[o];s[o*2]=t.call(r,a,o,e),s[o*2+1]=n.call(r,a,o,e)}return s}function*Cp(e,t,n,r){let i=0;for(const s of e)yield t.call(r,s,i,e),yield n.call(r,s,i,e),++i}function Op(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function jr(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function Lp(e){return e=jr(Math.abs(e)),e?e[1]:NaN}function Rp(e,t){return function(n,r){for(var i=n.length,s=[],o=0,a=e[0],l=0;i>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),s.push(n.substring(i-=a,i+a)),!((l+=a+1)>r));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function Dp(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var Up=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function us(e){if(!(t=Up.exec(e)))throw new Error("invalid format: "+e);var t;return new fo({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}us.prototype=fo.prototype;function fo(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}fo.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Bp(e){t:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+e[n])break t;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(i+1):e}var pc;function zp(e,t){var n=jr(e,t);if(!n)return e+"";var r=n[0],i=n[1],s=i-(pc=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+jr(e,Math.max(0,t+s-1))[0]}function ma(e,t){var n=jr(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const ya={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:Op,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>ma(e*100,t),r:ma,s:zp,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function wa(e){return e}var _a=Array.prototype.map,xa=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Fp(e){var t=e.grouping===void 0||e.thousands===void 0?wa:Rp(_a.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",r=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?wa:Dp(_a.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function u(c){c=us(c);var g=c.fill,x=c.align,E=c.sign,A=c.symbol,C=c.zero,T=c.width,I=c.comma,L=c.precision,k=c.trim,D=c.type;D==="n"?(I=!0,D="g"):ya[D]||(L===void 0&&(L=12),k=!0,D="g"),(C||g==="0"&&x==="=")&&(C=!0,g="0",x="=");var B=A==="$"?n:A==="#"&&/[boxX]/.test(D)?"0"+D.toLowerCase():"",z=A==="$"?r:/[%p]/.test(D)?o:"",y=ya[D],w=/[defgprs%]/.test(D);L=L===void 0?6:/[gprs]/.test(D)?Math.max(1,Math.min(21,L)):Math.max(0,Math.min(20,L));function v(b){var M=B,m=z,p,f,d;if(D==="c")m=y(b)+m,b="";else{b=+b;var _=b<0||1/b<0;if(b=isNaN(b)?l:y(Math.abs(b),L),k&&(b=Bp(b)),_&&+b==0&&E!=="+"&&(_=!1),M=(_?E==="("?E:a:E==="-"||E==="("?"":E)+M,m=(D==="s"?xa[8+pc/3]:"")+m+(_&&E==="("?")":""),w){for(p=-1,f=b.length;++p<f;)if(d=b.charCodeAt(p),48>d||d>57){m=(d===46?i+b.slice(p+1):b.slice(p))+m,b=b.slice(0,p);break}}}I&&!C&&(b=t(b,1/0));var S=M.length+b.length+m.length,$=S<T?new Array(T-S+1).join(g):"";switch(I&&C&&(b=t($+b,$.length?T-m.length:1/0),$=""),x){case"<":b=M+b+m+$;break;case"=":b=M+$+b+m;break;case"^":b=$.slice(0,S=$.length>>1)+M+b+m+$.slice(S);break;default:b=$+M+b+m;break}return s(b)}return v.toString=function(){return c+""},v}function h(c,g){var x=u((c=us(c),c.type="f",c)),E=Math.max(-8,Math.min(8,Math.floor(Lp(g)/3)))*3,A=Math.pow(10,-E),C=xa[8+E/3];return function(T){return x(A*T)+C}}return{format:u,formatPrefix:h}}var or,Si;Hp({thousands:",",grouping:[3],currency:["$",""]});function Hp(e){return or=Fp(e),Si=or.format,or.formatPrefix,or}var Q=1e-6,hs=1e-12,J=Math.PI,xt=J/2,va=J/4,Ot=J*2,St=180/J,tt=J/180,st=Math.abs,Ei=Math.atan,me=Math.atan2,Y=Math.cos,ar=Math.ceil,gc=Math.exp,fs=Math.hypot,mc=Math.log,W=Math.sin,qp=Math.sign||function(e){return e>0?1:e<0?-1:0},le=Math.sqrt,yc=Math.tan;function Gp(e){return e>1?0:e<-1?J:Math.acos(e)}function ye(e){return e>1?xt:e<-1?-xt:Math.asin(e)}function ft(){}function Wr(e,t){e&&Sa.hasOwnProperty(e.type)&&Sa[e.type](e,t)}var ba={Feature:function(e,t){Wr(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)Wr(n[r].geometry,t)}},Sa={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){ds(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)ds(n[r],t,0)},Polygon:function(e,t){Ea(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)Ea(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)Wr(n[r],t)}};function ds(e,t,n){var r=-1,i=e.length-n,s;for(t.lineStart();++r<i;)s=e[r],t.point(s[0],s[1],s[2]);t.lineEnd()}function Ea(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)ds(e[n],t,1);t.polygonEnd()}function Se(e,t){e&&ba.hasOwnProperty(e.type)?ba[e.type](e,t):Wr(e,t)}function ps(e){return[me(e[1],e[0]),ye(e[2])]}function an(e){var t=e[0],n=e[1],r=Y(n);return[r*Y(t),r*W(t),W(n)]}function lr(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Xr(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function zi(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function cr(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function gs(e){var t=le(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var Sn,Yr,Kr,Qr,Zr,Jr,ti,ei,ms,ys,ws,wc,_c,Et,Mt,$t,Xt={sphere:ft,point:po,lineStart:Ma,lineEnd:$a,polygonStart:function(){Xt.lineStart=Wp,Xt.lineEnd=Xp},polygonEnd:function(){Xt.lineStart=Ma,Xt.lineEnd=$a}};function po(e,t){e*=tt,t*=tt;var n=Y(t);Kn(n*Y(e),n*W(e),W(t))}function Kn(e,t,n){++Sn,Kr+=(e-Kr)/Sn,Qr+=(t-Qr)/Sn,Zr+=(n-Zr)/Sn}function Ma(){Xt.point=Vp}function Vp(e,t){e*=tt,t*=tt;var n=Y(t);Et=n*Y(e),Mt=n*W(e),$t=W(t),Xt.point=jp,Kn(Et,Mt,$t)}function jp(e,t){e*=tt,t*=tt;var n=Y(t),r=n*Y(e),i=n*W(e),s=W(t),o=me(le((o=Mt*s-$t*i)*o+(o=$t*r-Et*s)*o+(o=Et*i-Mt*r)*o),Et*r+Mt*i+$t*s);Yr+=o,Jr+=o*(Et+(Et=r)),ti+=o*(Mt+(Mt=i)),ei+=o*($t+($t=s)),Kn(Et,Mt,$t)}function $a(){Xt.point=po}function Wp(){Xt.point=Yp}function Xp(){xc(wc,_c),Xt.point=po}function Yp(e,t){wc=e,_c=t,e*=tt,t*=tt,Xt.point=xc;var n=Y(t);Et=n*Y(e),Mt=n*W(e),$t=W(t),Kn(Et,Mt,$t)}function xc(e,t){e*=tt,t*=tt;var n=Y(t),r=n*Y(e),i=n*W(e),s=W(t),o=Mt*s-$t*i,a=$t*r-Et*s,l=Et*i-Mt*r,u=fs(o,a,l),h=ye(u),c=u&&-h/u;ms.add(c*o),ys.add(c*a),ws.add(c*l),Yr+=h,Jr+=h*(Et+(Et=r)),ti+=h*(Mt+(Mt=i)),ei+=h*($t+($t=s)),Kn(Et,Mt,$t)}function Aa(e){Sn=Yr=Kr=Qr=Zr=Jr=ti=ei=0,ms=new Kt,ys=new Kt,ws=new Kt,Se(e,Xt);var t=+ms,n=+ys,r=+ws,i=fs(t,n,r);return i<hs&&(t=Jr,n=ti,r=ei,Yr<Q&&(t=Kr,n=Qr,r=Zr),i=fs(t,n,r),i<hs)?[NaN,NaN]:[me(n,t)*St,ye(r/i)*St]}function _s(e,t){function n(r,i){return r=e(r,i),t(r[0],r[1])}return e.invert&&t.invert&&(n.invert=function(r,i){return r=t.invert(r,i),r&&e.invert(r[0],r[1])}),n}function xs(e,t){return st(e)>J&&(e-=Math.round(e/Ot)*Ot),[e,t]}xs.invert=xs;function vc(e,t,n){return(e%=Ot)?t||n?_s(Ta(e),ka(t,n)):Ta(e):t||n?ka(t,n):xs}function Ia(e){return function(t,n){return t+=e,st(t)>J&&(t-=Math.round(t/Ot)*Ot),[t,n]}}function Ta(e){var t=Ia(e);return t.invert=Ia(-e),t}function ka(e,t){var n=Y(e),r=W(e),i=Y(t),s=W(t);function o(a,l){var u=Y(l),h=Y(a)*u,c=W(a)*u,g=W(l),x=g*n+h*r;return[me(c*i-x*s,h*n-g*r),ye(x*i+c*s)]}return o.invert=function(a,l){var u=Y(l),h=Y(a)*u,c=W(a)*u,g=W(l),x=g*i-c*s;return[me(c*i+g*s,h*n+x*r),ye(x*n-h*r)]},o}function ni(e){e=vc(e[0]*tt,e[1]*tt,e.length>2?e[2]*tt:0);function t(n){return n=e(n[0]*tt,n[1]*tt),n[0]*=St,n[1]*=St,n}return t.invert=function(n){return n=e.invert(n[0]*tt,n[1]*tt),n[0]*=St,n[1]*=St,n},t}function Kp(e,t,n,r,i,s){if(n){var o=Y(t),a=W(t),l=r*n;i==null?(i=t+r*Ot,s=t-l/2):(i=Pa(o,i),s=Pa(o,s),(r>0?i<s:i>s)&&(i+=r*Ot));for(var u,h=i;r>0?h>s:h<s;h-=l)u=ps([o,-a*Y(h),-a*W(h)]),e.point(u[0],u[1])}}function Pa(e,t){t=an(t),t[0]-=e,gs(t);var n=Gp(-t[1]);return((-t[2]<0?-n:n)+Ot-Q)%Ot}function bc(){var e=[],t;return{point:function(n,r,i){t.push([n,r,i])},lineStart:function(){e.push(t=[])},lineEnd:ft,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function Tr(e,t){return st(e[0]-t[0])<Q&&st(e[1]-t[1])<Q}function ur(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function Sc(e,t,n,r,i){var s=[],o=[],a,l;if(e.forEach(function(E){if(!((A=E.length-1)<=0)){var A,C=E[0],T=E[A],I;if(Tr(C,T)){if(!C[2]&&!T[2]){for(i.lineStart(),a=0;a<A;++a)i.point((C=E[a])[0],C[1]);i.lineEnd();return}T[0]+=2*Q}s.push(I=new ur(C,E,null,!0)),o.push(I.o=new ur(C,null,I,!1)),s.push(I=new ur(T,E,null,!1)),o.push(I.o=new ur(T,null,I,!0))}}),!!s.length){for(o.sort(t),Na(s),Na(o),a=0,l=o.length;a<l;++a)o[a].e=n=!n;for(var u=s[0],h,c;;){for(var g=u,x=!0;g.v;)if((g=g.n)===u)return;h=g.z,i.lineStart();do{if(g.v=g.o.v=!0,g.e){if(x)for(a=0,l=h.length;a<l;++a)i.point((c=h[a])[0],c[1]);else r(g.x,g.n.x,1,i);g=g.n}else{if(x)for(h=g.p.z,a=h.length-1;a>=0;--a)i.point((c=h[a])[0],c[1]);else r(g.x,g.p.x,-1,i);g=g.p}g=g.o,h=g.z,x=!x}while(!g.v);i.lineEnd()}}}function Na(e){if(t=e.length){for(var t,n=0,r=e[0],i;++n<t;)r.n=i=e[n],i.p=r,r=i;r.n=i=e[0],i.p=r}}function Fi(e){return st(e[0])<=J?e[0]:qp(e[0])*((st(e[0])+J)%Ot-J)}function Qp(e,t){var n=Fi(t),r=t[1],i=W(r),s=[W(n),-Y(n),0],o=0,a=0,l=new Kt;i===1?r=xt+Q:i===-1&&(r=-xt-Q);for(var u=0,h=e.length;u<h;++u)if(g=(c=e[u]).length)for(var c,g,x=c[g-1],E=Fi(x),A=x[1]/2+va,C=W(A),T=Y(A),I=0;I<g;++I,E=k,C=B,T=z,x=L){var L=c[I],k=Fi(L),D=L[1]/2+va,B=W(D),z=Y(D),y=k-E,w=y>=0?1:-1,v=w*y,b=v>J,M=C*B;if(l.add(me(M*w*W(v),T*z+M*Y(v))),o+=b?y+w*Ot:y,b^E>=n^k>=n){var m=Xr(an(x),an(L));gs(m);var p=Xr(s,m);gs(p);var f=(b^y>=0?-1:1)*ye(p[2]);(r>f||r===f&&(m[0]||m[1]))&&(a+=b^y>=0?1:-1)}}return(o<-Q||o<Q&&l<-hs)^a&1}function Ec(e,t,n,r){return function(i){var s=t(i),o=bc(),a=t(o),l=!1,u,h,c,g={point:x,lineStart:A,lineEnd:C,polygonStart:function(){g.point=T,g.lineStart=I,g.lineEnd=L,h=[],u=[]},polygonEnd:function(){g.point=x,g.lineStart=A,g.lineEnd=C,h=Bl(h);var k=Qp(u,r);h.length?(l||(i.polygonStart(),l=!0),Sc(h,Jp,k,n,i)):k&&(l||(i.polygonStart(),l=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),l&&(i.polygonEnd(),l=!1),h=u=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function x(k,D){e(k,D)&&i.point(k,D)}function E(k,D){s.point(k,D)}function A(){g.point=E,s.lineStart()}function C(){g.point=x,s.lineEnd()}function T(k,D){c.push([k,D]),a.point(k,D)}function I(){a.lineStart(),c=[]}function L(){T(c[0][0],c[0][1]),a.lineEnd();var k=a.clean(),D=o.result(),B,z=D.length,y,w,v;if(c.pop(),u.push(c),c=null,!!z){if(k&1){if(w=D[0],(y=w.length-1)>0){for(l||(i.polygonStart(),l=!0),i.lineStart(),B=0;B<y;++B)i.point((v=w[B])[0],v[1]);i.lineEnd()}return}z>1&&k&2&&D.push(D.pop().concat(D.shift())),h.push(D.filter(Zp))}}return g}}function Zp(e){return e.length>1}function Jp(e,t){return((e=e.x)[0]<0?e[1]-xt-Q:xt-e[1])-((t=t.x)[0]<0?t[1]-xt-Q:xt-t[1])}const Ca=Ec(function(){return!0},tg,ng,[-J,-xt]);function tg(e){var t=NaN,n=NaN,r=NaN,i;return{lineStart:function(){e.lineStart(),i=1},point:function(s,o){var a=s>0?J:-J,l=st(s-t);st(l-J)<Q?(e.point(t,n=(n+o)/2>0?xt:-xt),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(a,n),e.point(s,n),i=0):r!==a&&l>=J&&(st(t-r)<Q&&(t-=r*Q),st(s-a)<Q&&(s-=a*Q),n=eg(t,n,s,o),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(a,n),i=0),e.point(t=s,n=o),r=a},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-i}}}function eg(e,t,n,r){var i,s,o=W(e-n);return st(o)>Q?Ei((W(t)*(s=Y(r))*W(n)-W(r)*(i=Y(t))*W(e))/(i*s*o)):(t+r)/2}function ng(e,t,n,r){var i;if(e==null)i=n*xt,r.point(-J,i),r.point(0,i),r.point(J,i),r.point(J,0),r.point(J,-i),r.point(0,-i),r.point(-J,-i),r.point(-J,0),r.point(-J,i);else if(st(e[0]-t[0])>Q){var s=e[0]<t[0]?J:-J;i=n*s/2,r.point(-s,i),r.point(0,i),r.point(s,i)}else r.point(t[0],t[1])}function rg(e){var t=Y(e),n=2*tt,r=t>0,i=st(t)>Q;function s(h,c,g,x){Kp(x,e,n,g,h,c)}function o(h,c){return Y(h)*Y(c)>t}function a(h){var c,g,x,E,A;return{lineStart:function(){E=x=!1,A=1},point:function(C,T){var I=[C,T],L,k=o(C,T),D=r?k?0:u(C,T):k?u(C+(C<0?J:-J),T):0;if(!c&&(E=x=k)&&h.lineStart(),k!==x&&(L=l(c,I),(!L||Tr(c,L)||Tr(I,L))&&(I[2]=1)),k!==x)A=0,k?(h.lineStart(),L=l(I,c),h.point(L[0],L[1])):(L=l(c,I),h.point(L[0],L[1],2),h.lineEnd()),c=L;else if(i&&c&&r^k){var B;!(D&g)&&(B=l(I,c,!0))&&(A=0,r?(h.lineStart(),h.point(B[0][0],B[0][1]),h.point(B[1][0],B[1][1]),h.lineEnd()):(h.point(B[1][0],B[1][1]),h.lineEnd(),h.lineStart(),h.point(B[0][0],B[0][1],3)))}k&&(!c||!Tr(c,I))&&h.point(I[0],I[1]),c=I,x=k,g=D},lineEnd:function(){x&&h.lineEnd(),c=null},clean:function(){return A|(E&&x)<<1}}}function l(h,c,g){var x=an(h),E=an(c),A=[1,0,0],C=Xr(x,E),T=lr(C,C),I=C[0],L=T-I*I;if(!L)return!g&&h;var k=t*T/L,D=-t*I/L,B=Xr(A,C),z=cr(A,k),y=cr(C,D);zi(z,y);var w=B,v=lr(z,w),b=lr(w,w),M=v*v-b*(lr(z,z)-1);if(!(M<0)){var m=le(M),p=cr(w,(-v-m)/b);if(zi(p,z),p=ps(p),!g)return p;var f=h[0],d=c[0],_=h[1],S=c[1],$;d<f&&($=f,f=d,d=$);var O=d-f,U=st(O-J)<Q,F=U||O<Q;if(!U&&S<_&&($=_,_=S,S=$),F?U?_+S>0^p[1]<(st(p[0]-f)<Q?_:S):_<=p[1]&&p[1]<=S:O>J^(f<=p[0]&&p[0]<=d)){var G=cr(w,(-v+m)/b);return zi(G,z),[p,ps(G)]}}}function u(h,c){var g=r?e:J-e,x=0;return h<-g?x|=1:h>g&&(x|=2),c<-g?x|=4:c>g&&(x|=8),x}return Ec(o,a,s,r?[0,-e]:[-J,e-J])}function ig(e,t,n,r,i,s){var o=e[0],a=e[1],l=t[0],u=t[1],h=0,c=1,g=l-o,x=u-a,E;if(E=n-o,!(!g&&E>0)){if(E/=g,g<0){if(E<h)return;E<c&&(c=E)}else if(g>0){if(E>c)return;E>h&&(h=E)}if(E=i-o,!(!g&&E<0)){if(E/=g,g<0){if(E>c)return;E>h&&(h=E)}else if(g>0){if(E<h)return;E<c&&(c=E)}if(E=r-a,!(!x&&E>0)){if(E/=x,x<0){if(E<h)return;E<c&&(c=E)}else if(x>0){if(E>c)return;E>h&&(h=E)}if(E=s-a,!(!x&&E<0)){if(E/=x,x<0){if(E>c)return;E>h&&(h=E)}else if(x>0){if(E<h)return;E<c&&(c=E)}return h>0&&(e[0]=o+h*g,e[1]=a+h*x),c<1&&(t[0]=o+c*g,t[1]=a+c*x),!0}}}}}var En=1e9,hr=-En;function sg(e,t,n,r){function i(u,h){return e<=u&&u<=n&&t<=h&&h<=r}function s(u,h,c,g){var x=0,E=0;if(u==null||(x=o(u,c))!==(E=o(h,c))||l(u,h)<0^c>0)do g.point(x===0||x===3?e:n,x>1?r:t);while((x=(x+c+4)%4)!==E);else g.point(h[0],h[1])}function o(u,h){return st(u[0]-e)<Q?h>0?0:3:st(u[0]-n)<Q?h>0?2:1:st(u[1]-t)<Q?h>0?1:0:h>0?3:2}function a(u,h){return l(u.x,h.x)}function l(u,h){var c=o(u,1),g=o(h,1);return c!==g?c-g:c===0?h[1]-u[1]:c===1?u[0]-h[0]:c===2?u[1]-h[1]:h[0]-u[0]}return function(u){var h=u,c=bc(),g,x,E,A,C,T,I,L,k,D,B,z={point:y,lineStart:M,lineEnd:m,polygonStart:v,polygonEnd:b};function y(f,d){i(f,d)&&h.point(f,d)}function w(){for(var f=0,d=0,_=x.length;d<_;++d)for(var S=x[d],$=1,O=S.length,U=S[0],F,G,V=U[0],q=U[1];$<O;++$)F=V,G=q,U=S[$],V=U[0],q=U[1],G<=r?q>r&&(V-F)*(r-G)>(q-G)*(e-F)&&++f:q<=r&&(V-F)*(r-G)<(q-G)*(e-F)&&--f;return f}function v(){h=c,g=[],x=[],B=!0}function b(){var f=w(),d=B&&f,_=(g=Bl(g)).length;(d||_)&&(u.polygonStart(),d&&(u.lineStart(),s(null,null,1,u),u.lineEnd()),_&&Sc(g,a,f,s,u),u.polygonEnd()),h=u,g=x=E=null}function M(){z.point=p,x&&x.push(E=[]),D=!0,k=!1,I=L=NaN}function m(){g&&(p(A,C),T&&k&&c.rejoin(),g.push(c.result())),z.point=y,k&&h.lineEnd()}function p(f,d){var _=i(f,d);if(x&&E.push([f,d]),D)A=f,C=d,T=_,D=!1,_&&(h.lineStart(),h.point(f,d));else if(_&&k)h.point(f,d);else{var S=[I=Math.max(hr,Math.min(En,I)),L=Math.max(hr,Math.min(En,L))],$=[f=Math.max(hr,Math.min(En,f)),d=Math.max(hr,Math.min(En,d))];ig(S,$,e,t,n,r)?(k||(h.lineStart(),h.point(S[0],S[1])),h.point($[0],$[1]),_||h.lineEnd(),B=!1):_&&(h.lineStart(),h.point(f,d),B=!1)}I=f,L=d,k=_}return z}}var vs,bs,kr,Pr,ln={sphere:ft,point:ft,lineStart:og,lineEnd:ft,polygonStart:ft,polygonEnd:ft};function og(){ln.point=lg,ln.lineEnd=ag}function ag(){ln.point=ln.lineEnd=ft}function lg(e,t){e*=tt,t*=tt,bs=e,kr=W(t),Pr=Y(t),ln.point=cg}function cg(e,t){e*=tt,t*=tt;var n=W(t),r=Y(t),i=st(e-bs),s=Y(i),o=W(i),a=r*o,l=Pr*n-kr*r*s,u=kr*n+Pr*r*s;vs.add(me(le(a*a+l*l),u)),bs=e,kr=n,Pr=r}function ug(e){return vs=new Kt,Se(e,ln),+vs}var Ss=[null,null],hg={type:"LineString",coordinates:Ss};function ri(e,t){return Ss[0]=e,Ss[1]=t,ug(hg)}function Oa(e,t,n){var r=Qe(e,t-Q,n).concat(t);return function(i){return r.map(function(s){return[i,s]})}}function La(e,t,n){var r=Qe(e,t-Q,n).concat(t);return function(i){return r.map(function(s){return[s,i]})}}function fg(){var e,t,n,r,i,s,o,a,l=10,u=l,h=90,c=360,g,x,E,A,C=2.5;function T(){return{type:"MultiLineString",coordinates:I()}}function I(){return Qe(ar(r/h)*h,n,h).map(E).concat(Qe(ar(a/c)*c,o,c).map(A)).concat(Qe(ar(t/l)*l,e,l).filter(function(L){return st(L%h)>Q}).map(g)).concat(Qe(ar(s/u)*u,i,u).filter(function(L){return st(L%c)>Q}).map(x))}return T.lines=function(){return I().map(function(L){return{type:"LineString",coordinates:L}})},T.outline=function(){return{type:"Polygon",coordinates:[E(r).concat(A(o).slice(1),E(n).reverse().slice(1),A(a).reverse().slice(1))]}},T.extent=function(L){return arguments.length?T.extentMajor(L).extentMinor(L):T.extentMinor()},T.extentMajor=function(L){return arguments.length?(r=+L[0][0],n=+L[1][0],a=+L[0][1],o=+L[1][1],r>n&&(L=r,r=n,n=L),a>o&&(L=a,a=o,o=L),T.precision(C)):[[r,a],[n,o]]},T.extentMinor=function(L){return arguments.length?(t=+L[0][0],e=+L[1][0],s=+L[0][1],i=+L[1][1],t>e&&(L=t,t=e,e=L),s>i&&(L=s,s=i,i=L),T.precision(C)):[[t,s],[e,i]]},T.step=function(L){return arguments.length?T.stepMajor(L).stepMinor(L):T.stepMinor()},T.stepMajor=function(L){return arguments.length?(h=+L[0],c=+L[1],T):[h,c]},T.stepMinor=function(L){return arguments.length?(l=+L[0],u=+L[1],T):[l,u]},T.precision=function(L){return arguments.length?(C=+L,g=Oa(s,i,90),x=La(t,e,C),E=Oa(a,o,90),A=La(r,n,C),T):C},T.extentMajor([[-180,-90+Q],[180,90-Q]]).extentMinor([[-180,-80-Q],[180,80+Q]])}const Es=e=>e;var Hi=new Kt,Ms=new Kt,Mc,$c,$s,As,he={point:ft,lineStart:ft,lineEnd:ft,polygonStart:function(){he.lineStart=dg,he.lineEnd=gg},polygonEnd:function(){he.lineStart=he.lineEnd=he.point=ft,Hi.add(st(Ms)),Ms=new Kt},result:function(){var e=Hi/2;return Hi=new Kt,e}};function dg(){he.point=pg}function pg(e,t){he.point=Ac,Mc=$s=e,$c=As=t}function Ac(e,t){Ms.add(As*e-$s*t),$s=e,As=t}function gg(){Ac(Mc,$c)}var cn=1/0,ii=cn,zn=-cn,si=zn,oi={point:mg,lineStart:ft,lineEnd:ft,polygonStart:ft,polygonEnd:ft,result:function(){var e=[[cn,ii],[zn,si]];return zn=si=-(ii=cn=1/0),e}};function mg(e,t){e<cn&&(cn=e),e>zn&&(zn=e),t<ii&&(ii=t),t>si&&(si=t)}var Is=0,Ts=0,Mn=0,ai=0,li=0,Je=0,ks=0,Ps=0,$n=0,Ic,Tc,te,ee,Ht={point:qe,lineStart:Ra,lineEnd:Da,polygonStart:function(){Ht.lineStart=_g,Ht.lineEnd=xg},polygonEnd:function(){Ht.point=qe,Ht.lineStart=Ra,Ht.lineEnd=Da},result:function(){var e=$n?[ks/$n,Ps/$n]:Je?[ai/Je,li/Je]:Mn?[Is/Mn,Ts/Mn]:[NaN,NaN];return Is=Ts=Mn=ai=li=Je=ks=Ps=$n=0,e}};function qe(e,t){Is+=e,Ts+=t,++Mn}function Ra(){Ht.point=yg}function yg(e,t){Ht.point=wg,qe(te=e,ee=t)}function wg(e,t){var n=e-te,r=t-ee,i=le(n*n+r*r);ai+=i*(te+e)/2,li+=i*(ee+t)/2,Je+=i,qe(te=e,ee=t)}function Da(){Ht.point=qe}function _g(){Ht.point=vg}function xg(){kc(Ic,Tc)}function vg(e,t){Ht.point=kc,qe(Ic=te=e,Tc=ee=t)}function kc(e,t){var n=e-te,r=t-ee,i=le(n*n+r*r);ai+=i*(te+e)/2,li+=i*(ee+t)/2,Je+=i,i=ee*e-te*t,ks+=i*(te+e),Ps+=i*(ee+t),$n+=i*3,qe(te=e,ee=t)}function Pc(e){this._context=e}Pc.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Ot);break}}},result:ft};var Ns=new Kt,qi,Nc,Cc,An,In,Fn={point:ft,lineStart:function(){Fn.point=bg},lineEnd:function(){qi&&Oc(Nc,Cc),Fn.point=ft},polygonStart:function(){qi=!0},polygonEnd:function(){qi=null},result:function(){var e=+Ns;return Ns=new Kt,e}};function bg(e,t){Fn.point=Oc,Nc=An=e,Cc=In=t}function Oc(e,t){An-=e,In-=t,Ns.add(le(An*An+In*In)),An=e,In=t}let Ua,ci,Ba,za;class Fa{constructor(t){this._append=t==null?Lc:Sg(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,n){switch(this._point){case 0:{this._append`M${t},${n}`,this._point=1;break}case 1:{this._append`L${t},${n}`;break}default:{if(this._append`M${t},${n}`,this._radius!==Ba||this._append!==ci){const r=this._radius,i=this._;this._="",this._append`m0,${r}a${r},${r} 0 1,1 0,${-2*r}a${r},${r} 0 1,1 0,${2*r}z`,Ba=r,ci=this._append,za=this._,this._=i}this._+=za;break}}}result(){const t=this._;return this._="",t.length?t:null}}function Lc(e){let t=1;this._+=e[0];for(const n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function Sg(e){const t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return Lc;if(t!==Ua){const n=10**t;Ua=t,ci=function(i){let s=1;this._+=i[0];for(const o=i.length;s<o;++s)this._+=Math.round(arguments[s]*n)/n+i[s]}}return ci}function go(e,t){let n=3,r=4.5,i,s;function o(a){return a&&(typeof r=="function"&&s.pointRadius(+r.apply(this,arguments)),Se(a,i(s))),s.result()}return o.area=function(a){return Se(a,i(he)),he.result()},o.measure=function(a){return Se(a,i(Fn)),Fn.result()},o.bounds=function(a){return Se(a,i(oi)),oi.result()},o.centroid=function(a){return Se(a,i(Ht)),Ht.result()},o.projection=function(a){return arguments.length?(i=a==null?(e=null,Es):(e=a).stream,o):e},o.context=function(a){return arguments.length?(s=a==null?(t=null,new Fa(n)):new Pc(t=a),typeof r!="function"&&s.pointRadius(r),o):t},o.pointRadius=function(a){return arguments.length?(r=typeof a=="function"?a:(s.pointRadius(+a),+a),o):r},o.digits=function(a){if(!arguments.length)return n;if(a==null)n=null;else{const l=Math.floor(a);if(!(l>=0))throw new RangeError(`invalid digits: ${a}`);n=l}return t===null&&(s=new Fa(n)),o},o.projection(e).digits(n).context(t)}function mo(e){return function(t){var n=new Cs;for(var r in e)n[r]=e[r];return n.stream=t,n}}function Cs(){}Cs.prototype={constructor:Cs,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function yo(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),r!=null&&e.clipExtent(null),Se(n,e.stream(oi)),t(oi.result()),r!=null&&e.clipExtent(r),e}function Rc(e,t,n){return yo(e,function(r){var i=t[1][0]-t[0][0],s=t[1][1]-t[0][1],o=Math.min(i/(r[1][0]-r[0][0]),s/(r[1][1]-r[0][1])),a=+t[0][0]+(i-o*(r[1][0]+r[0][0]))/2,l=+t[0][1]+(s-o*(r[1][1]+r[0][1]))/2;e.scale(150*o).translate([a,l])},n)}function Eg(e,t,n){return Rc(e,[[0,0],t],n)}function Mg(e,t,n){return yo(e,function(r){var i=+t,s=i/(r[1][0]-r[0][0]),o=(i-s*(r[1][0]+r[0][0]))/2,a=-s*r[0][1];e.scale(150*s).translate([o,a])},n)}function $g(e,t,n){return yo(e,function(r){var i=+t,s=i/(r[1][1]-r[0][1]),o=-s*r[0][0],a=(i-s*(r[1][1]+r[0][1]))/2;e.scale(150*s).translate([o,a])},n)}var Ha=16,Ag=Y(30*tt);function qa(e,t){return+t?Tg(e,t):Ig(e)}function Ig(e){return mo({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function Tg(e,t){function n(r,i,s,o,a,l,u,h,c,g,x,E,A,C){var T=u-r,I=h-i,L=T*T+I*I;if(L>4*t&&A--){var k=o+g,D=a+x,B=l+E,z=le(k*k+D*D+B*B),y=ye(B/=z),w=st(st(B)-1)<Q||st(s-c)<Q?(s+c)/2:me(D,k),v=e(w,y),b=v[0],M=v[1],m=b-r,p=M-i,f=I*m-T*p;(f*f/L>t||st((T*m+I*p)/L-.5)>.3||o*g+a*x+l*E<Ag)&&(n(r,i,s,o,a,l,b,M,w,k/=z,D/=z,B,A,C),C.point(b,M),n(b,M,w,k,D,B,u,h,c,g,x,E,A,C))}}return function(r){var i,s,o,a,l,u,h,c,g,x,E,A,C={point:T,lineStart:I,lineEnd:k,polygonStart:function(){r.polygonStart(),C.lineStart=D},polygonEnd:function(){r.polygonEnd(),C.lineStart=I}};function T(y,w){y=e(y,w),r.point(y[0],y[1])}function I(){c=NaN,C.point=L,r.lineStart()}function L(y,w){var v=an([y,w]),b=e(y,w);n(c,g,h,x,E,A,c=b[0],g=b[1],h=y,x=v[0],E=v[1],A=v[2],Ha,r),r.point(c,g)}function k(){C.point=T,r.lineEnd()}function D(){I(),C.point=B,C.lineEnd=z}function B(y,w){L(i=y,w),s=c,o=g,a=x,l=E,u=A,C.point=L}function z(){n(c,g,h,x,E,A,s,o,i,a,l,u,Ha,r),C.lineEnd=k,k()}return C}}var kg=mo({point:function(e,t){this.stream.point(e*tt,t*tt)}});function Pg(e){return mo({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}function Ng(e,t,n,r,i){function s(o,a){return o*=r,a*=i,[t+e*o,n-e*a]}return s.invert=function(o,a){return[(o-t)/e*r,(n-a)/e*i]},s}function Ga(e,t,n,r,i,s){if(!s)return Ng(e,t,n,r,i);var o=Y(s),a=W(s),l=o*e,u=a*e,h=o/e,c=a/e,g=(a*n-o*t)/e,x=(a*t+o*n)/e;function E(A,C){return A*=r,C*=i,[l*A-u*C+t,n-u*A-l*C]}return E.invert=function(A,C){return[r*(h*A-c*C+g),i*(x-c*A-h*C)]},E}function wo(e){return Cg(function(){return e})()}function Cg(e){var t,n=150,r=480,i=250,s=0,o=0,a=0,l=0,u=0,h,c=0,g=1,x=1,E=null,A=Ca,C=null,T,I,L,k=Es,D=.5,B,z,y,w,v;function b(f){return y(f[0]*tt,f[1]*tt)}function M(f){return f=y.invert(f[0],f[1]),f&&[f[0]*St,f[1]*St]}b.stream=function(f){return w&&v===f?w:w=kg(Pg(h)(A(B(k(v=f)))))},b.preclip=function(f){return arguments.length?(A=f,E=void 0,p()):A},b.postclip=function(f){return arguments.length?(k=f,C=T=I=L=null,p()):k},b.clipAngle=function(f){return arguments.length?(A=+f?rg(E=f*tt):(E=null,Ca),p()):E*St},b.clipExtent=function(f){return arguments.length?(k=f==null?(C=T=I=L=null,Es):sg(C=+f[0][0],T=+f[0][1],I=+f[1][0],L=+f[1][1]),p()):C==null?null:[[C,T],[I,L]]},b.scale=function(f){return arguments.length?(n=+f,m()):n},b.translate=function(f){return arguments.length?(r=+f[0],i=+f[1],m()):[r,i]},b.center=function(f){return arguments.length?(s=f[0]%360*tt,o=f[1]%360*tt,m()):[s*St,o*St]},b.rotate=function(f){return arguments.length?(a=f[0]%360*tt,l=f[1]%360*tt,u=f.length>2?f[2]%360*tt:0,m()):[a*St,l*St,u*St]},b.angle=function(f){return arguments.length?(c=f%360*tt,m()):c*St},b.reflectX=function(f){return arguments.length?(g=f?-1:1,m()):g<0},b.reflectY=function(f){return arguments.length?(x=f?-1:1,m()):x<0},b.precision=function(f){return arguments.length?(B=qa(z,D=f*f),p()):le(D)},b.fitExtent=function(f,d){return Rc(b,f,d)},b.fitSize=function(f,d){return Eg(b,f,d)},b.fitWidth=function(f,d){return Mg(b,f,d)},b.fitHeight=function(f,d){return $g(b,f,d)};function m(){var f=Ga(n,0,0,g,x,c).apply(null,t(s,o)),d=Ga(n,r-f[0],i-f[1],g,x,c);return h=vc(a,l,u),z=_s(t,d),y=_s(h,z),B=qa(z,D),p()}function p(){return w=v=null,b}return function(){return t=e.apply(this,arguments),b.invert=t.invert&&M,m()}}function Dc(e){return function(t,n){var r=le(t*t+n*n),i=e(r),s=W(i),o=Y(i);return[me(t*s,r*o),ye(r&&n*s/r)]}}function _o(e,t){return[e,mc(yc((xt+t)/2))]}_o.invert=function(e,t){return[e,2*Ei(gc(t))-xt]};function Og(){return Uc(_o).scale(961/Ot)}function Uc(e){var t=wo(e),n=t.center,r=t.scale,i=t.translate,s=t.clipExtent,o=null,a,l,u;t.scale=function(c){return arguments.length?(r(c),h()):r()},t.translate=function(c){return arguments.length?(i(c),h()):i()},t.center=function(c){return arguments.length?(n(c),h()):n()},t.clipExtent=function(c){return arguments.length?(c==null?o=a=l=u=null:(o=+c[0][0],a=+c[0][1],l=+c[1][0],u=+c[1][1]),h()):o==null?null:[[o,a],[l,u]]};function h(){var c=J*r(),g=t(ni(t.rotate()).invert([0,0]));return s(o==null?[[g[0]-c,g[1]-c],[g[0]+c,g[1]+c]]:e===_o?[[Math.max(g[0]-c,o),a],[Math.min(g[0]+c,l),u]]:[[o,Math.max(g[1]-c,a)],[l,Math.min(g[1]+c,u)]])}return h()}function Bc(e,t){return[Y(t)*W(e),W(t)]}Bc.invert=Dc(ye);function Lg(){return wo(Bc).scale(249.5).clipAngle(90+Q)}function zc(e,t){var n=Y(t),r=1+Y(e)*n;return[n*W(e)/r,W(t)/r]}zc.invert=Dc(function(e){return 2*Ei(e)});function Fc(){return wo(zc).scale(250).clipAngle(142)}function Hc(e,t){return[mc(yc((xt+t)/2)),-e]}Hc.invert=function(e,t){return[-t,2*Ei(gc(e))-xt]};function Rg(){var e=Uc(Hc),t=e.center,n=e.rotate;return e.center=function(r){return arguments.length?t([-r[1],r[0]]):(r=t(),[r[1],-r[0]])},e.rotate=function(r){return arguments.length?n([r[0],r[1],r.length>2?r[2]+90:90]):(r=n(),[r[0],r[1],r[2]-90])},n([0,0,90]).scale(159.155)}const fr=e=>()=>e;function Dg(e,{sourceEvent:t,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function fe(e,t,n){this.k=e,this.x=t,this.y=n}fe.prototype={constructor:fe,scale:function(e){return e===1?this:new fe(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new fe(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var qc=new fe(1,0,0);fe.prototype;function Gi(e){e.stopImmediatePropagation()}function wn(e){e.preventDefault(),e.stopImmediatePropagation()}function Ug(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function Bg(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function Va(){return this.__zoom||qc}function zg(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function Fg(){return navigator.maxTouchPoints||"ontouchstart"in this}function Hg(e,t,n){var r=e.invertX(t[0][0])-n[0][0],i=e.invertX(t[1][0])-n[1][0],s=e.invertY(t[0][1])-n[0][1],o=e.invertY(t[1][1])-n[1][1];return e.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function qg(){var e=Ug,t=Bg,n=Hg,r=zg,i=Fg,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,l=nd,u=_i("start","zoom","end"),h,c,g,x=500,E=150,A=0,C=10;function T(p){p.property("__zoom",Va).on("wheel.zoom",y,{passive:!1}).on("mousedown.zoom",w).on("dblclick.zoom",v).filter(i).on("touchstart.zoom",b).on("touchmove.zoom",M).on("touchend.zoom touchcancel.zoom",m).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}T.transform=function(p,f,d,_){var S=p.selection?p.selection():p;S.property("__zoom",Va),p!==S?D(p,f,d,_):S.interrupt().each(function(){B(this,arguments).event(_).start().zoom(null,typeof f=="function"?f.apply(this,arguments):f).end()})},T.scaleBy=function(p,f,d,_){T.scaleTo(p,function(){var S=this.__zoom.k,$=typeof f=="function"?f.apply(this,arguments):f;return S*$},d,_)},T.scaleTo=function(p,f,d,_){T.transform(p,function(){var S=t.apply(this,arguments),$=this.__zoom,O=d==null?k(S):typeof d=="function"?d.apply(this,arguments):d,U=$.invert(O),F=typeof f=="function"?f.apply(this,arguments):f;return n(L(I($,F),O,U),S,o)},d,_)},T.translateBy=function(p,f,d,_){T.transform(p,function(){return n(this.__zoom.translate(typeof f=="function"?f.apply(this,arguments):f,typeof d=="function"?d.apply(this,arguments):d),t.apply(this,arguments),o)},null,_)},T.translateTo=function(p,f,d,_,S){T.transform(p,function(){var $=t.apply(this,arguments),O=this.__zoom,U=_==null?k($):typeof _=="function"?_.apply(this,arguments):_;return n(qc.translate(U[0],U[1]).scale(O.k).translate(typeof f=="function"?-f.apply(this,arguments):-f,typeof d=="function"?-d.apply(this,arguments):-d),$,o)},_,S)};function I(p,f){return f=Math.max(s[0],Math.min(s[1],f)),f===p.k?p:new fe(f,p.x,p.y)}function L(p,f,d){var _=f[0]-d[0]*p.k,S=f[1]-d[1]*p.k;return _===p.x&&S===p.y?p:new fe(p.k,_,S)}function k(p){return[(+p[0][0]+ +p[1][0])/2,(+p[0][1]+ +p[1][1])/2]}function D(p,f,d,_){p.on("start.zoom",function(){B(this,arguments).event(_).start()}).on("interrupt.zoom end.zoom",function(){B(this,arguments).event(_).end()}).tween("zoom",function(){var S=this,$=arguments,O=B(S,$).event(_),U=t.apply(S,$),F=d==null?k(U):typeof d=="function"?d.apply(S,$):d,G=Math.max(U[1][0]-U[0][0],U[1][1]-U[0][1]),V=S.__zoom,q=typeof f=="function"?f.apply(S,$):f,X=l(V.invert(F).concat(G/V.k),q.invert(F).concat(G/q.k));return function(nt){if(nt===1)nt=q;else{var At=X(nt),Ae=G/At[2];nt=new fe(Ae,F[0]-At[0]*Ae,F[1]-At[1]*Ae)}O.zoom(null,nt)}})}function B(p,f,d){return!d&&p.__zooming||new z(p,f)}function z(p,f){this.that=p,this.args=f,this.active=0,this.sourceEvent=null,this.extent=t.apply(p,f),this.taps=0}z.prototype={event:function(p){return p&&(this.sourceEvent=p),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(p,f){return this.mouse&&p!=="mouse"&&(this.mouse[1]=f.invert(this.mouse[0])),this.touch0&&p!=="touch"&&(this.touch0[1]=f.invert(this.touch0[0])),this.touch1&&p!=="touch"&&(this.touch1[1]=f.invert(this.touch1[0])),this.that.__zoom=f,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(p){var f=jt(this.that).datum();u.call(p,this.that,new Dg(p,{sourceEvent:this.sourceEvent,target:T,transform:this.that.__zoom,dispatch:u}),f)}};function y(p,...f){if(!e.apply(this,arguments))return;var d=B(this,f).event(p),_=this.__zoom,S=Math.max(s[0],Math.min(s[1],_.k*Math.pow(2,r.apply(this,arguments)))),$=Jt(p);if(d.wheel)(d.mouse[0][0]!==$[0]||d.mouse[0][1]!==$[1])&&(d.mouse[1]=_.invert(d.mouse[0]=$)),clearTimeout(d.wheel);else{if(_.k===S)return;d.mouse=[$,_.invert($)],Ir(this),d.start()}wn(p),d.wheel=setTimeout(O,E),d.zoom("mouse",n(L(I(_,S),d.mouse[0],d.mouse[1]),d.extent,o));function O(){d.wheel=null,d.end()}}function w(p,...f){if(g||!e.apply(this,arguments))return;var d=p.currentTarget,_=B(this,f,!0).event(p),S=jt(p.view).on("mousemove.zoom",F,!0).on("mouseup.zoom",G,!0),$=Jt(p,d),O=p.clientX,U=p.clientY;Jl(p.view),Gi(p),_.mouse=[$,this.__zoom.invert($)],Ir(this),_.start();function F(V){if(wn(V),!_.moved){var q=V.clientX-O,X=V.clientY-U;_.moved=q*q+X*X>A}_.event(V).zoom("mouse",n(L(_.that.__zoom,_.mouse[0]=Jt(V,d),_.mouse[1]),_.extent,o))}function G(V){S.on("mousemove.zoom mouseup.zoom",null),tc(V.view,_.moved),wn(V),_.event(V).end()}}function v(p,...f){if(e.apply(this,arguments)){var d=this.__zoom,_=Jt(p.changedTouches?p.changedTouches[0]:p,this),S=d.invert(_),$=d.k*(p.shiftKey?.5:2),O=n(L(I(d,$),_,S),t.apply(this,f),o);wn(p),a>0?jt(this).transition().duration(a).call(D,O,_,p):jt(this).call(T.transform,O,_,p)}}function b(p,...f){if(e.apply(this,arguments)){var d=p.touches,_=d.length,S=B(this,f,p.changedTouches.length===_).event(p),$,O,U,F;for(Gi(p),O=0;O<_;++O)U=d[O],F=Jt(U,this),F=[F,this.__zoom.invert(F),U.identifier],S.touch0?!S.touch1&&S.touch0[2]!==F[2]&&(S.touch1=F,S.taps=0):(S.touch0=F,$=!0,S.taps=1+!!h);h&&(h=clearTimeout(h)),$&&(S.taps<2&&(c=F[0],h=setTimeout(function(){h=null},x)),Ir(this),S.start())}}function M(p,...f){if(this.__zooming){var d=B(this,f).event(p),_=p.changedTouches,S=_.length,$,O,U,F;for(wn(p),$=0;$<S;++$)O=_[$],U=Jt(O,this),d.touch0&&d.touch0[2]===O.identifier?d.touch0[0]=U:d.touch1&&d.touch1[2]===O.identifier&&(d.touch1[0]=U);if(O=d.that.__zoom,d.touch1){var G=d.touch0[0],V=d.touch0[1],q=d.touch1[0],X=d.touch1[1],nt=(nt=q[0]-G[0])*nt+(nt=q[1]-G[1])*nt,At=(At=X[0]-V[0])*At+(At=X[1]-V[1])*At;O=I(O,Math.sqrt(nt/At)),U=[(G[0]+q[0])/2,(G[1]+q[1])/2],F=[(V[0]+X[0])/2,(V[1]+X[1])/2]}else if(d.touch0)U=d.touch0[0],F=d.touch0[1];else return;d.zoom("touch",n(L(O,U,F),d.extent,o))}}function m(p,...f){if(this.__zooming){var d=B(this,f).event(p),_=p.changedTouches,S=_.length,$,O;for(Gi(p),g&&clearTimeout(g),g=setTimeout(function(){g=null},x),$=0;$<S;++$)O=_[$],d.touch0&&d.touch0[2]===O.identifier?delete d.touch0:d.touch1&&d.touch1[2]===O.identifier&&delete d.touch1;if(d.touch1&&!d.touch0&&(d.touch0=d.touch1,delete d.touch1),d.touch0)d.touch0[1]=this.__zoom.invert(d.touch0[0]);else if(d.end(),d.taps===2&&(O=Jt(O,this),Math.hypot(c[0]-O[0],c[1]-O[1])<C)){var U=jt(this).on("dblclick.zoom");U&&U.apply(this,arguments)}}}return T.wheelDelta=function(p){return arguments.length?(r=typeof p=="function"?p:fr(+p),T):r},T.filter=function(p){return arguments.length?(e=typeof p=="function"?p:fr(!!p),T):e},T.touchable=function(p){return arguments.length?(i=typeof p=="function"?p:fr(!!p),T):i},T.extent=function(p){return arguments.length?(t=typeof p=="function"?p:fr([[+p[0][0],+p[0][1]],[+p[1][0],+p[1][1]]]),T):t},T.scaleExtent=function(p){return arguments.length?(s[0]=+p[0],s[1]=+p[1],T):[s[0],s[1]]},T.translateExtent=function(p){return arguments.length?(o[0][0]=+p[0][0],o[1][0]=+p[1][0],o[0][1]=+p[0][1],o[1][1]=+p[1][1],T):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},T.constrain=function(p){return arguments.length?(n=p,T):n},T.duration=function(p){return arguments.length?(a=+p,T):a},T.interpolate=function(p){return arguments.length?(l=p,T):l},T.on=function(){var p=u.on.apply(u,arguments);return p===u?T:p},T.clickDistance=function(p){return arguments.length?(A=(p=+p)*p,T):Math.sqrt(A)},T.tapDistance=function(p){return arguments.length?(C=+p,T):C},T}function Mi(){return{systemMap:new Map,laneMap:new Map,neighborMap:new Map}}function Gc(e,t){e.systemMap.set(t.id,t)}function Os(e,t,n){const r=[t.id,n.id].sort((s,o)=>s.localeCompare(o)).join("-");if(e.laneMap.has(r))return;const i={id:r,fromId:t.id,toId:n.id,movement:[0,0]};e.laneMap.set(r,i)}function $i(e){const t=new Map;for(const n of e.laneMap.values())t.has(n.fromId)||t.set(n.fromId,[]),t.get(n.fromId)?.push(n.toId),t.has(n.toId)||t.set(n.toId,[]),t.get(n.toId)?.push(n.fromId);e.neighborMap=t}function Pt(e,t){const n=e.systemMap.get(t);if(!n)return[];(!e.neighborMap||e.neighborMap.size===0)&&$i(e);const r=e.neighborMap.get(n.id);return r?r.map(i=>e.systemMap.get(i)).filter(i=>!!i):[]}function Ai(e,t,n){return e.neighborMap.get(t)?.includes(n)||!1}function Vc(e,t){return xo(t,Array.from(e.systemMap.values()))}function xo(e,t){if(t.length===0)return null;let n=null,r=1/0;return t.forEach(i=>{if(i.location[0]===e[0]&&i.location[1]===e[1])return;const s=ri(e,i.location);s<r&&(r=s,n=i)}),n}function Gg(e){console.log("Loading world from JSON...",e);const t=Mi();return t.systemMap=new Map(e.systems),t.laneMap=new Map(e.lanes),$i(t),t}function Vg(e){return{systems:Array.from(e.systemMap.entries()),lanes:Array.from(e.laneMap.entries())}}function jc(){return{playerName:"",numBots:Lh,fow:Ch,numSystems:Oh,timeScale:1}}function vo(){return{world:Mi(),playerMap:new Map}}function Wc(e,t){e.playerMap.set(t.id,t)}function bo(e){const{C:t}=globalThis.gameManager.getFnContext();if(!t.playerId)return null;for(const n of e.world.systemMap.values())if(n.homeworld===t.playerId)return n;return null}function Ii(e,t){const{P:n}=globalThis.gameManager.getFnContext();if(!n)return;n.revealedSystems.add(t.id),n.visitedSystems.add(t.id);const r=Pt(e.world,t.id);if(r)return r.forEach(i=>n.revealedSystems.add(i.id)),e}function Xc(e){const{P:t}=globalThis.gameManager.getFnContext();if(t)for(const n of e.world.systemMap.values())t.revealedSystems.add(n.id)}function Yc(e,t,n,r,i){e.moveQueue.push({ships:n,toId:t.id,fromId:e.id,playerId:r,message:i})}function Kc(e,t,n,r){if(r!==0){if(r<0){if(t.ownerId!==n.ownerId)return;const i=t;t=n,n=i,r=-r}t.ships<r||(n.ownerId===t.ownerId?Xg(e,t,n,r):jg(e,t,n,r))}}function jg(e,t,n,r){const i=t.ownerId,s=n.ships??0;if(Zc(e.S.world,t,n,r),r>s){const o=r-s;t.ships=t.ships-r,n.ships=o,Wg(e,i,n)}else t.ships=t.ships-r,n.ships=s-r}function Wg(e,t,n){n.ownerId=t,n.moveQueue=[],t===e.C.playerId&&Ii(e.S,n),n.homeworld&&n.homeworld!==t&&Qc(e,n.homeworld,t)}function Qc({S:e,E:t,C:n},r,i=null){for(const o of e.world.systemMap.values())o.ownerId===r&&(o.ownerId=i,o.ships=Math.max(Math.floor((o.ships??0)/2),1),o.homeworld=null,o.moveQueue=[],i===n.playerId&&Ii(e,o)),o.homeworld===r&&(o.homeworld=null);const s=e.playerMap.get(r);s.isAlive=!1,t.emit("PLAYER_ELIMINATED",{loserId:r,winnerId:i})}function Zc(e,t,n,r){t.movement=[t.movement[0],t.movement[1]+r],n.movement=[n.movement[0]+r,n.movement[1]];for(const i of e.laneMap.values())i.fromId===t.id&&i.toId===n.id?i.movement=[i.movement[0]+r,i.movement[1]]:i.fromId===n.id&&i.toId===t.id&&(i.movement=[i.movement[0],i.movement[1]+r])}function Xg({S:e,C:t},n,r,i){n.ships<i||(n.ships-=i,r.ships+=i,Zc(e.world,n,r,i),r.ownerId===t.playerId&&Ii(e,r))}function Jc(e){for(const t of e.S.world.systemMap.values())for(t.lastMove=null;t.moveQueue.length>0;){const n=t.moveQueue.shift();n&&tu(e,n)}}function tu(e,t){t.playerId===e.C.playerId&&rn(`player move: ${JSON.stringify(t)}`);const n=e.S.world.systemMap.get(t.fromId),r=e.S.world.systemMap.get(t.toId);Kc(e,n,r,t.ships),n.lastMove=t,e.E.emit("MAKE_MOVE",t)}function Yg(e,t){const n=eu(e.S,t);n&&tu(e,n)}function Kg(e,t){const n=e.world.systemMap.get(t.fromId);return!(n.ownerId!==t.playerId||!Ai(e.world,t.fromId,t.toId)||n.ships<=1)}function eu(e,t){if(!Kg(e,t))return null;switch(t.type){case"MASS_MOVE":return n(t.fromId,t.toId);case"BALANCED_MOVE":return r(t.fromId,t.toId)}return null;function n(i,s){const{C:o}=globalThis.gameManager.getFnContext(),l=e.world.systemMap.get(i).ships-1;return l<=0?null:{message:`Move ${l} ships from ${i} to ${s}`,ships:l,toId:s,fromId:i,playerId:o.playerId}}function r(i,s){const{C:o}=globalThis.gameManager.getFnContext(),a=e.world.systemMap.get(i),l=e.world.systemMap.get(s),u=l.ownerId===a.ownerId?Math.floor((a.ships-l.ships)/2):Math.floor(a.ships/2);return u<=0?null:{message:`Move ${u} ships from ${a.id} to ${l.id}`,ships:u,toId:l.id,fromId:a.id,playerId:o.playerId}}}const dr=100,Vi={territory:{aggression:.3,expansion:1,defensiveness:.5,riskTolerance:.4,speed:dr},rusher:{aggression:1,expansion:.4,defensiveness:.1,riskTolerance:.7,speed:dr},turtle:{aggression:.1,expansion:.3,defensiveness:.95,riskTolerance:.2,speed:dr},balanced:{aggression:.5,expansion:.5,defensiveness:.5,riskTolerance:.5,speed:dr}};function Qg({S:e}){for(const t of e.playerMap.values())t.bot?.makeMoves()}let Zg=0;class Jg{constructor(t={}){this.queuedMoves=0,this.threatLevels=new Map,this.frontline=new Set,this.backline=new Set;const n=t.playerIndex??Zg++;this.id=t.id??`${n}`;let r=t.personality;if(!r){const i=Object.keys(Vi);r=i[n%i.length]}this.name=t.name??r,this.personality=r==="idle"?Vi.balanced:Vi[r]}makeMoves(){if(this.name==="idle")return;const n=gameManager.getState().world.systemMap.values();if(this.botSystems=Array.from(n).filter(l=>l.ownerId===this.id),this.botSystems.length===0)return;for(const l of this.botSystems)l.moveQueue=[];this.queuedMoves=0,this.analyzeMap();const r=this.getDefensiveMoves();if(this.chooseMoves(r,1-this.personality.defensiveness),this.queuedMoves>=this.personality.speed)return;const i=this.getCoordinatedAttackMoves();if(this.chooseMoves(i,this.personality.aggression),this.queuedMoves>=this.personality.speed)return;const s=this.getExterminateMoves();if(this.chooseMoves(s,this.personality.defensiveness),this.queuedMoves>=this.personality.speed)return;const o=this.getExploreMoves();if(this.chooseMoves(o,this.personality.expansion),this.queuedMoves>=this.personality.speed)return;const a=this.getLogisticsMoves();this.chooseMoves(a,1),this.queuedMoves>=this.personality.speed}analyzeMap(){this.threatLevels.clear(),this.frontline.clear(),this.backline.clear();const t=gameManager.getState();this.botSystems.forEach(n=>{const r=Pt(t.world,n.id),i=r.filter(a=>a.ownerId&&a.ownerId!==this.id),s=r.filter(a=>!a.ownerId),o=i.reduce((a,l)=>a+l.ships,0);this.threatLevels.set(n.id,o),i.length>0||s.length>0?this.frontline.add(n.id):this.backline.add(n.id)})}getDefensiveMoves(){const t=gameManager.getState();return this.botSystems.map(n=>{if(n.moveQueue.length>0)return[];const r=[],i=this.threatLevels.get(n.id)??0;if(i>0){const s=i*1.1;if(n.ships<s)if(n.ships<i*.5){const o=Pt(t.world,n.id).filter(a=>a.ownerId===this.id).sort((a,l)=>(this.threatLevels.get(a.id)||0)-(this.threatLevels.get(l.id)||0))[0];o&&r.push({message:`Retreating from ${n.id}`,from:n,to:o,units:n.ships-1,score:1e3})}else r.push({message:`Holding ${n.id}`,from:n,to:n,units:0,score:i});else n.ships<s*1.5&&r.push({message:`Defending ${n.id} from threat level ${i}`,from:n,to:n,units:0,score:i})}return r})}getCoordinatedAttackMoves(){const t=gameManager.getState(),n=new Map;this.botSystems.forEach(i=>{if(i.moveQueue.length>0||i.ships<5)return;const s=Pt(t.world,i.id);s&&s.forEach(o=>{if(o.ownerId!==null&&o.ownerId!==this.id){if(Pt(t.world,i.id).filter(l=>l.ownerId&&l.ownerId!==this.id&&l.id!==o.id).length>0)return;n.has(o.id)||n.set(o.id,{target:o,attackers:[]}),n.get(o.id).attackers.push(i)}})});const r=[];return n.forEach(({target:i,attackers:s})=>{const a=Pt(t.world,i.id).filter(c=>c.ownerId===i.ownerId).length===0?1.5:1,l=s.reduce((c,g)=>{const x=this.threatLevels.get(g.id)||0,E=Math.max(0,g.ships-x*1.1);return c+Math.floor(E*(1-this.personality.defensiveness))},0),h=(i.ships+(i.homeworld?10:0))*(1.3-this.personality.riskTolerance);l>h&&s.forEach(c=>{if(c.moveQueue.length>0)return;const g=this.threatLevels.get(c.id)||0,x=Math.max(0,c.ships-g*1.1),E=Math.floor(x*(1-this.personality.defensiveness)),A=this.getBestMoveAmount(c,i,E);A>0&&r.push([{message:`Coordinated attack on ${i.id}`,from:c,to:i,units:A,score:(100+(i.homeworld?50:0))*a}])})}),r}getExterminateMoves(){const t=gameManager.getState();return this.botSystems.map(n=>n.moveQueue.length>0?[]:n.ships<3?[]:Pt(t.world,n.id).flatMap(i=>{if(i.ownerId===this.id)return[];if(i.ownerId===null&&i.type==="UNINHABITED")return[];if(n.ships>i.ships*1.5+5){const s=n.ships-2;return[{message:`Crushing weak neighbor ${i.id}`,from:n,to:i,units:s,score:40}]}return[]}))}getExploreMoves(){const t=gameManager.getState();return this.botSystems.map(n=>n.moveQueue.length>0?[]:n.ships<2?[]:Pt(t.world,n.id).flatMap(i=>{if(i.ownerId!==null)return[];if(i.type==="INHABITED")return[];const s=Math.max(1,Math.floor(n.ships*.3));return[{message:`Exploring ${i.id}`,from:n,to:i,units:s,score:30}]}))}getLogisticsMoves(){const t=gameManager.getState();return this.botSystems.map(n=>{if(n.moveQueue.length>0)return[];if(n.ships<2)return[];if(this.backline.has(n.id)){const r=Pt(t.world,n.id).filter(o=>this.frontline.has(o.id)&&o.ownerId===this.id);if(r.length>0){const o=r.sort((a,l)=>a.ships-l.ships)[0];return[{message:"Logistics: Frontline Support",from:n,to:o,units:n.ships-1,score:10}]}const s=Pt(t.world,n.id).filter(o=>o.ownerId===this.id).sort((o,a)=>o.ships-a.ships)[0];if(s&&s.ships<n.ships-2)return[{message:"Logistics: Balancing",from:n,to:s,units:Math.floor((n.ships-s.ships)/2),score:5}]}if(this.frontline.has(n.id)){const r=Pt(t.world,n.id).filter(i=>i.ownerId===this.id&&(this.threatLevels.get(i.id)||0)>i.ships);if(r.length>0&&(this.threatLevels.get(n.id)||0)<n.ships){const i=r[0];return[{message:"Logistics: Emergency Reinforce",from:n,to:i,units:Math.floor(n.ships/2),score:50}]}}return[]})}getBestMoveAmount(t,n,r){const i=Math.max(0,t.ships-1);let s=0;return n.ownerId===t.ownerId?s=Math.floor((t.ships-n.ships)/2):s=Math.floor(t.ships/2),s=Math.max(0,s),Math.abs(i-r)<Math.abs(s-r)?i:s}chooseMoves(t,n=1){if(t.length===0)return;const r=t.flat().sort(tm);for(const i of r){if(this.queuedMoves>=this.personality.speed)return;if(Math.random()<n){if(i.from.moveQueue.length>0)continue;Yc(i.from,i.to,i.units,this.id,i.message),i.units>0&&this.queuedMoves++}}}}function tm(e,t){return e.score!==t.score?t.score-e.score:Math.random()-.5}function nu(e){for(const t of e.playerMap.values()){const n={playerId:t.id,systems:0,ships:0,homeworld:0};for(const r of e.world.systemMap.values())r.ownerId===t.id&&(n.systems+=1,n.ships+=r.ships??0,r.homeworld===t.id&&(n.homeworld=r.ships??0));t.stats=n}}function ru(e){for(const t of e.world.systemMap.values())t.type==="INHABITED"&&(t.ownerId||t.ships<Ll)&&(t.ships=(t.ships??0)+Ph)}function iu(e){for(const t of e.world.systemMap.values())t.ownerId!=null&&(t.ships=(t.ships??0)+Nh)}function em({S:e,C:t,E:n,P:r}){if(t.status==="PLAYING"&&r)if(e.playerMap.size>1){const i=Array.from(e.playerMap.values());if(i.reduce((o,a)=>(o+=a.stats.homeworld>0?1:0,o),0)===1){const o=i.find(l=>l.stats.homeworld>0).id,a=e.playerMap.get(o);n.emit("PLAYER_WIN",{playerId:o,message:`${a.name} has conquered The Bubble!`}),n.emit("GAME_STOP",void 0)}}else Array.from(e.world.systemMap.values()).filter(s=>s.ownerId!==t.playerId).length===0&&(n.emit("PLAYER_WIN",{playerId:t.playerId,message:`${r.name} has conquered The Bubble!`}),n.emit("GAME_STOP",void 0))}function nm(e,t=!1){const{S:n,C:r}=e;r.tick%Th===0&&ru(n),r.tick%kh===0&&iu(n);for(const i of n.world.systemMap.values())i.movement=[0,0];for(const i of n.world.laneMap.values())i.movement=[0,0];t||(Qg(e),Jc(e)),nu(n)}const pr=BigInt(2**32-1),ja=BigInt(32);function rm(e,t=!1){return t?{h:Number(e&pr),l:Number(e>>ja&pr)}:{h:Number(e>>ja&pr)|0,l:Number(e&pr)|0}}function im(e,t=!1){const n=e.length;let r=new Uint32Array(n),i=new Uint32Array(n);for(let s=0;s<n;s++){const{h:o,l:a}=rm(e[s],t);[r[s],i[s]]=[o,a]}return[r,i]}const sm=(e,t,n)=>e<<n|t>>>32-n,om=(e,t,n)=>t<<n|e>>>32-n,am=(e,t,n)=>t<<n-32|e>>>64-n,lm=(e,t,n)=>e<<n-32|t>>>64-n;function cm(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Wa(e,t=""){if(!Number.isSafeInteger(e)||e<0){const n=t&&`"${t}" `;throw new Error(`${n}expected integer >= 0, got ${e}`)}}function Ls(e,t,n=""){const r=cm(e),i=e?.length;if(!r||t!==void 0){const o=n&&`"${n}" `,a="",l=r?`length=${i}`:`type=${typeof e}`;throw new Error(o+"expected Uint8Array"+a+", got "+l)}return e}function Xa(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function um(e,t){Ls(e,void 0,"digestInto() output");const n=t.outputLen;if(e.length<n)throw new Error('"digestInto() output" expected to be of length >='+n)}function hm(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function su(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}const fm=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function dm(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function pm(e){for(let t=0;t<e.length;t++)e[t]=dm(e[t]);return e}const Ya=fm?e=>e:pm;function gm(e,t={}){const n=(i,s)=>e(s).update(i).digest(),r=e(void 0);return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=i=>e(i),Object.assign(n,t),Object.freeze(n)}const mm=e=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,e])}),ym=BigInt(0),_n=BigInt(1),wm=BigInt(2),_m=BigInt(7),xm=BigInt(256),vm=BigInt(113),ou=[],au=[],lu=[];for(let e=0,t=_n,n=1,r=0;e<24;e++){[n,r]=[r,(2*n+3*r)%5],ou.push(2*(5*r+n)),au.push((e+1)*(e+2)/2%64);let i=ym;for(let s=0;s<7;s++)t=(t<<_n^(t>>_m)*vm)%xm,t&wm&&(i^=_n<<(_n<<BigInt(s))-_n);lu.push(i)}const cu=im(lu,!0),bm=cu[0],Sm=cu[1],Ka=(e,t,n)=>n>32?am(e,t,n):sm(e,t,n),Qa=(e,t,n)=>n>32?lm(e,t,n):om(e,t,n);function Em(e,t=24){const n=new Uint32Array(10);for(let r=24-t;r<24;r++){for(let o=0;o<10;o++)n[o]=e[o]^e[o+10]^e[o+20]^e[o+30]^e[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,l=(o+2)%10,u=n[l],h=n[l+1],c=Ka(u,h,1)^n[a],g=Qa(u,h,1)^n[a+1];for(let x=0;x<50;x+=10)e[o+x]^=c,e[o+x+1]^=g}let i=e[2],s=e[3];for(let o=0;o<24;o++){const a=au[o],l=Ka(i,s,a),u=Qa(i,s,a),h=ou[o];i=e[h],s=e[h+1],e[h]=l,e[h+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=e[o+a];for(let a=0;a<10;a++)e[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}e[0]^=bm[r],e[1]^=Sm[r]}su(n)}class So{state;pos=0;posOut=0;finished=!1;state32;destroyed=!1;blockLen;suffix;outputLen;enableXOF=!1;rounds;constructor(t,n,r,i=!1,s=24){if(this.blockLen=t,this.suffix=n,this.outputLen=r,this.enableXOF=i,this.rounds=s,Wa(r,"outputLen"),!(0<t&&t<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=hm(this.state)}clone(){return this._cloneInto()}keccak(){Ya(this.state32),Em(this.state32,this.rounds),Ya(this.state32),this.posOut=0,this.pos=0}update(t){Xa(this),Ls(t);const{blockLen:n,state:r}=this,i=t.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);for(let a=0;a<o;a++)r[this.pos++]^=t[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:n,pos:r,blockLen:i}=this;t[r]^=n,(n&128)!==0&&r===i-1&&this.keccak(),t[i-1]^=128,this.keccak()}writeInto(t){Xa(this,!1),Ls(t),this.finish();const n=this.state,{blockLen:r}=this;for(let i=0,s=t.length;i<s;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,s-i);t.set(n.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return Wa(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(um(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,su(this.state)}_cloneInto(t){const{blockLen:n,suffix:r,outputLen:i,rounds:s,enableXOF:o}=this;return t||=new So(n,r,i,o,s),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=s,t.suffix=r,t.outputLen=i,t.enableXOF=o,t.destroyed=this.destroyed,t}}const Mm=(e,t,n,r={})=>gm(()=>new So(t,e,n),r),$m=Mm(6,72,64,mm(10));var Am=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,ji=Math.ceil,Ut=Math.floor,It="[BigNumber Error] ",Za=It+"Number primitive has more than 15 significant digits: ",qt=1e14,j=14,Wi=9007199254740991,Xi=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],xe=1e7,pt=1e9;function uu(e){var t,n,r,i=I.prototype={constructor:I,toString:null,valueOf:null},s=new I(1),o=20,a=4,l=-7,u=21,h=-1e7,c=1e7,g=!1,x=1,E=0,A={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},C="0123456789abcdefghijklmnopqrstuvwxyz",T=!0;function I(y,w){var v,b,M,m,p,f,d,_,S=this;if(!(S instanceof I))return new I(y,w);if(w==null){if(y&&y._isBigNumber===!0){S.s=y.s,!y.c||y.e>c?S.c=S.e=null:y.e<h?S.c=[S.e=0]:(S.e=y.e,S.c=y.c.slice());return}if((f=typeof y=="number")&&y*0==0){if(S.s=1/y<0?(y=-y,-1):1,y===~~y){for(m=0,p=y;p>=10;p/=10,m++);m>c?S.c=S.e=null:(S.e=m,S.c=[y]);return}_=String(y)}else{if(!Am.test(_=String(y)))return r(S,_,f);S.s=_.charCodeAt(0)==45?(_=_.slice(1),-1):1}(m=_.indexOf("."))>-1&&(_=_.replace(".","")),(p=_.search(/e/i))>0?(m<0&&(m=p),m+=+_.slice(p+1),_=_.substring(0,p)):m<0&&(m=_.length)}else{if(ot(w,2,C.length,"Base"),w==10&&T)return S=new I(y),B(S,o+S.e+1,a);if(_=String(y),f=typeof y=="number"){if(y*0!=0)return r(S,_,f,w);if(S.s=1/y<0?(_=_.slice(1),-1):1,I.DEBUG&&_.replace(/^0\.0*|\./,"").length>15)throw Error(Za+y)}else S.s=_.charCodeAt(0)===45?(_=_.slice(1),-1):1;for(v=C.slice(0,w),m=p=0,d=_.length;p<d;p++)if(v.indexOf(b=_.charAt(p))<0){if(b=="."){if(p>m){m=d;continue}}else if(!M&&(_==_.toUpperCase()&&(_=_.toLowerCase())||_==_.toLowerCase()&&(_=_.toUpperCase()))){M=!0,p=-1,m=0;continue}return r(S,String(y),f,w)}f=!1,_=n(_,w,10,S.s),(m=_.indexOf("."))>-1?_=_.replace(".",""):m=_.length}for(p=0;_.charCodeAt(p)===48;p++);for(d=_.length;_.charCodeAt(--d)===48;);if(_=_.slice(p,++d)){if(d-=p,f&&I.DEBUG&&d>15&&(y>Wi||y!==Ut(y)))throw Error(Za+S.s*y);if((m=m-p-1)>c)S.c=S.e=null;else if(m<h)S.c=[S.e=0];else{if(S.e=m,S.c=[],p=(m+1)%j,m<0&&(p+=j),p<d){for(p&&S.c.push(+_.slice(0,p)),d-=j;p<d;)S.c.push(+_.slice(p,p+=j));p=j-(_=_.slice(p)).length}else p-=d;for(;p--;_+="0");S.c.push(+_)}}else S.c=[S.e=0]}I.clone=uu,I.ROUND_UP=0,I.ROUND_DOWN=1,I.ROUND_CEIL=2,I.ROUND_FLOOR=3,I.ROUND_HALF_UP=4,I.ROUND_HALF_DOWN=5,I.ROUND_HALF_EVEN=6,I.ROUND_HALF_CEIL=7,I.ROUND_HALF_FLOOR=8,I.EUCLID=9,I.config=I.set=function(y){var w,v;if(y!=null)if(typeof y=="object"){if(y.hasOwnProperty(w="DECIMAL_PLACES")&&(v=y[w],ot(v,0,pt,w),o=v),y.hasOwnProperty(w="ROUNDING_MODE")&&(v=y[w],ot(v,0,8,w),a=v),y.hasOwnProperty(w="EXPONENTIAL_AT")&&(v=y[w],v&&v.pop?(ot(v[0],-pt,0,w),ot(v[1],0,pt,w),l=v[0],u=v[1]):(ot(v,-pt,pt,w),l=-(u=v<0?-v:v))),y.hasOwnProperty(w="RANGE"))if(v=y[w],v&&v.pop)ot(v[0],-pt,-1,w),ot(v[1],1,pt,w),h=v[0],c=v[1];else if(ot(v,-pt,pt,w),v)h=-(c=v<0?-v:v);else throw Error(It+w+" cannot be zero: "+v);if(y.hasOwnProperty(w="CRYPTO"))if(v=y[w],v===!!v)if(v)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))g=v;else throw g=!v,Error(It+"crypto unavailable");else g=v;else throw Error(It+w+" not true or false: "+v);if(y.hasOwnProperty(w="MODULO_MODE")&&(v=y[w],ot(v,0,9,w),x=v),y.hasOwnProperty(w="POW_PRECISION")&&(v=y[w],ot(v,0,pt,w),E=v),y.hasOwnProperty(w="FORMAT"))if(v=y[w],typeof v=="object")A=v;else throw Error(It+w+" not an object: "+v);if(y.hasOwnProperty(w="ALPHABET"))if(v=y[w],typeof v=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(v))T=v.slice(0,10)=="0123456789",C=v;else throw Error(It+w+" invalid: "+v)}else throw Error(It+"Object expected: "+y);return{DECIMAL_PLACES:o,ROUNDING_MODE:a,EXPONENTIAL_AT:[l,u],RANGE:[h,c],CRYPTO:g,MODULO_MODE:x,POW_PRECISION:E,FORMAT:A,ALPHABET:C}},I.isBigNumber=function(y){if(!y||y._isBigNumber!==!0)return!1;if(!I.DEBUG)return!0;var w,v,b=y.c,M=y.e,m=y.s;t:if({}.toString.call(b)=="[object Array]"){if((m===1||m===-1)&&M>=-pt&&M<=pt&&M===Ut(M)){if(b[0]===0){if(M===0&&b.length===1)return!0;break t}if(w=(M+1)%j,w<1&&(w+=j),String(b[0]).length==w){for(w=0;w<b.length;w++)if(v=b[w],v<0||v>=qt||v!==Ut(v))break t;if(v!==0)return!0}}}else if(b===null&&M===null&&(m===null||m===1||m===-1))return!0;throw Error(It+"Invalid BigNumber: "+y)},I.maximum=I.max=function(){return k(arguments,-1)},I.minimum=I.min=function(){return k(arguments,1)},I.random=(function(){var y=9007199254740992,w=Math.random()*y&2097151?function(){return Ut(Math.random()*y)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(v){var b,M,m,p,f,d=0,_=[],S=new I(s);if(v==null?v=o:ot(v,0,pt),p=ji(v/j),g)if(crypto.getRandomValues){for(b=crypto.getRandomValues(new Uint32Array(p*=2));d<p;)f=b[d]*131072+(b[d+1]>>>11),f>=9e15?(M=crypto.getRandomValues(new Uint32Array(2)),b[d]=M[0],b[d+1]=M[1]):(_.push(f%1e14),d+=2);d=p/2}else if(crypto.randomBytes){for(b=crypto.randomBytes(p*=7);d<p;)f=(b[d]&31)*281474976710656+b[d+1]*1099511627776+b[d+2]*4294967296+b[d+3]*16777216+(b[d+4]<<16)+(b[d+5]<<8)+b[d+6],f>=9e15?crypto.randomBytes(7).copy(b,d):(_.push(f%1e14),d+=7);d=p/7}else throw g=!1,Error(It+"crypto unavailable");if(!g)for(;d<p;)f=w(),f<9e15&&(_[d++]=f%1e14);for(p=_[--d],v%=j,p&&v&&(f=Xi[j-v],_[d]=Ut(p/f)*f);_[d]===0;_.pop(),d--);if(d<0)_=[m=0];else{for(m=-1;_[0]===0;_.splice(0,1),m-=j);for(d=1,f=_[0];f>=10;f/=10,d++);d<j&&(m-=j-d)}return S.e=m,S.c=_,S}})(),I.sum=function(){for(var y=1,w=arguments,v=new I(w[0]);y<w.length;)v=v.plus(w[y++]);return v},n=(function(){var y="0123456789";function w(v,b,M,m){for(var p,f=[0],d,_=0,S=v.length;_<S;){for(d=f.length;d--;f[d]*=b);for(f[0]+=m.indexOf(v.charAt(_++)),p=0;p<f.length;p++)f[p]>M-1&&(f[p+1]==null&&(f[p+1]=0),f[p+1]+=f[p]/M|0,f[p]%=M)}return f.reverse()}return function(v,b,M,m,p){var f,d,_,S,$,O,U,F,G=v.indexOf("."),V=o,q=a;for(G>=0&&(S=E,E=0,v=v.replace(".",""),F=new I(b),O=F.pow(v.length-G),E=S,F.c=w(ue(Dt(O.c),O.e,"0"),10,M,y),F.e=F.c.length),U=w(v,b,M,p?(f=C,y):(f=y,C)),_=S=U.length;U[--S]==0;U.pop());if(!U[0])return f.charAt(0);if(G<0?--_:(O.c=U,O.e=_,O.s=m,O=t(O,F,V,q,M),U=O.c,$=O.r,_=O.e),d=_+V+1,G=U[d],S=M/2,$=$||d<0||U[d+1]!=null,$=q<4?(G!=null||$)&&(q==0||q==(O.s<0?3:2)):G>S||G==S&&(q==4||$||q==6&&U[d-1]&1||q==(O.s<0?8:7)),d<1||!U[0])v=$?ue(f.charAt(1),-V,f.charAt(0)):f.charAt(0);else{if(U.length=d,$)for(--M;++U[--d]>M;)U[d]=0,d||(++_,U=[1].concat(U));for(S=U.length;!U[--S];);for(G=0,v="";G<=S;v+=f.charAt(U[G++]));v=ue(v,_,f.charAt(0))}return v}})(),t=(function(){function y(b,M,m){var p,f,d,_,S=0,$=b.length,O=M%xe,U=M/xe|0;for(b=b.slice();$--;)d=b[$]%xe,_=b[$]/xe|0,p=U*d+_*O,f=O*d+p%xe*xe+S,S=(f/m|0)+(p/xe|0)+U*_,b[$]=f%m;return S&&(b=[S].concat(b)),b}function w(b,M,m,p){var f,d;if(m!=p)d=m>p?1:-1;else for(f=d=0;f<m;f++)if(b[f]!=M[f]){d=b[f]>M[f]?1:-1;break}return d}function v(b,M,m,p){for(var f=0;m--;)b[m]-=f,f=b[m]<M[m]?1:0,b[m]=f*p+b[m]-M[m];for(;!b[0]&&b.length>1;b.splice(0,1));}return function(b,M,m,p,f){var d,_,S,$,O,U,F,G,V,q,X,nt,At,Ae,Ni,Zt,pn,Rt=b.s==M.s?1:-1,vt=b.c,ct=M.c;if(!vt||!vt[0]||!ct||!ct[0])return new I(!b.s||!M.s||(vt?ct&&vt[0]==ct[0]:!ct)?NaN:vt&&vt[0]==0||!ct?Rt*0:Rt/0);for(G=new I(Rt),V=G.c=[],_=b.e-M.e,Rt=m+_+1,f||(f=qt,_=Bt(b.e/j)-Bt(M.e/j),Rt=Rt/j|0),S=0;ct[S]==(vt[S]||0);S++);if(ct[S]>(vt[S]||0)&&_--,Rt<0)V.push(1),$=!0;else{for(Ae=vt.length,Zt=ct.length,S=0,Rt+=2,O=Ut(f/(ct[0]+1)),O>1&&(ct=y(ct,O,f),vt=y(vt,O,f),Zt=ct.length,Ae=vt.length),At=Zt,q=vt.slice(0,Zt),X=q.length;X<Zt;q[X++]=0);pn=ct.slice(),pn=[0].concat(pn),Ni=ct[0],ct[1]>=f/2&&Ni++;do{if(O=0,d=w(ct,q,Zt,X),d<0){if(nt=q[0],Zt!=X&&(nt=nt*f+(q[1]||0)),O=Ut(nt/Ni),O>1)for(O>=f&&(O=f-1),U=y(ct,O,f),F=U.length,X=q.length;w(U,q,F,X)==1;)O--,v(U,Zt<F?pn:ct,F,f),F=U.length,d=1;else O==0&&(d=O=1),U=ct.slice(),F=U.length;if(F<X&&(U=[0].concat(U)),v(q,U,X,f),X=q.length,d==-1)for(;w(ct,q,Zt,X)<1;)O++,v(q,Zt<X?pn:ct,X,f),X=q.length}else d===0&&(O++,q=[0]);V[S++]=O,q[0]?q[X++]=vt[At]||0:(q=[vt[At]],X=1)}while((At++<Ae||q[0]!=null)&&Rt--);$=q[0]!=null,V[0]||V.splice(0,1)}if(f==qt){for(S=1,Rt=V[0];Rt>=10;Rt/=10,S++);B(G,m+(G.e=S+_*j-1)+1,p,$)}else G.e=_,G.r=+$;return G}})();function L(y,w,v,b){var M,m,p,f,d;if(v==null?v=a:ot(v,0,8),!y.c)return y.toString();if(M=y.c[0],p=y.e,w==null)d=Dt(y.c),d=b==1||b==2&&(p<=l||p>=u)?mr(d,p):ue(d,p,"0");else if(y=B(new I(y),w,v),m=y.e,d=Dt(y.c),f=d.length,b==1||b==2&&(w<=m||m<=l)){for(;f<w;d+="0",f++);d=mr(d,m)}else if(w-=p+(b===2&&m>p),d=ue(d,m,"0"),m+1>f){if(--w>0)for(d+=".";w--;d+="0");}else if(w+=m-f,w>0)for(m+1==f&&(d+=".");w--;d+="0");return y.s<0&&M?"-"+d:d}function k(y,w){for(var v,b,M=1,m=new I(y[0]);M<y.length;M++)b=new I(y[M]),(!b.s||(v=Te(m,b))===w||v===0&&m.s===w)&&(m=b);return m}function D(y,w,v){for(var b=1,M=w.length;!w[--M];w.pop());for(M=w[0];M>=10;M/=10,b++);return(v=b+v*j-1)>c?y.c=y.e=null:v<h?y.c=[y.e=0]:(y.e=v,y.c=w),y}r=(function(){var y=/^(-?)0([xbo])(?=\w[\w.]*$)/i,w=/^([^.]+)\.$/,v=/^\.([^.]+)$/,b=/^-?(Infinity|NaN)$/,M=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(m,p,f,d){var _,S=f?p:p.replace(M,"");if(b.test(S))m.s=isNaN(S)?null:S<0?-1:1;else{if(!f&&(S=S.replace(y,function($,O,U){return _=(U=U.toLowerCase())=="x"?16:U=="b"?2:8,!d||d==_?O:$}),d&&(_=d,S=S.replace(w,"$1").replace(v,"0.$1")),p!=S))return new I(S,_);if(I.DEBUG)throw Error(It+"Not a"+(d?" base "+d:"")+" number: "+p);m.s=null}m.c=m.e=null}})();function B(y,w,v,b){var M,m,p,f,d,_,S,$=y.c,O=Xi;if($){t:{for(M=1,f=$[0];f>=10;f/=10,M++);if(m=w-M,m<0)m+=j,p=w,d=$[_=0],S=Ut(d/O[M-p-1]%10);else if(_=ji((m+1)/j),_>=$.length)if(b){for(;$.length<=_;$.push(0));d=S=0,M=1,m%=j,p=m-j+1}else break t;else{for(d=f=$[_],M=1;f>=10;f/=10,M++);m%=j,p=m-j+M,S=p<0?0:Ut(d/O[M-p-1]%10)}if(b=b||w<0||$[_+1]!=null||(p<0?d:d%O[M-p-1]),b=v<4?(S||b)&&(v==0||v==(y.s<0?3:2)):S>5||S==5&&(v==4||b||v==6&&(m>0?p>0?d/O[M-p]:0:$[_-1])%10&1||v==(y.s<0?8:7)),w<1||!$[0])return $.length=0,b?(w-=y.e+1,$[0]=O[(j-w%j)%j],y.e=-w||0):$[0]=y.e=0,y;if(m==0?($.length=_,f=1,_--):($.length=_+1,f=O[j-m],$[_]=p>0?Ut(d/O[M-p]%O[p])*f:0),b)for(;;)if(_==0){for(m=1,p=$[0];p>=10;p/=10,m++);for(p=$[0]+=f,f=1;p>=10;p/=10,f++);m!=f&&(y.e++,$[0]==qt&&($[0]=1));break}else{if($[_]+=f,$[_]!=qt)break;$[_--]=0,f=1}for(m=$.length;$[--m]===0;$.pop());}y.e>c?y.c=y.e=null:y.e<h&&(y.c=[y.e=0])}return y}function z(y){var w,v=y.e;return v===null?y.toString():(w=Dt(y.c),w=v<=l||v>=u?mr(w,v):ue(w,v,"0"),y.s<0?"-"+w:w)}return i.absoluteValue=i.abs=function(){var y=new I(this);return y.s<0&&(y.s=1),y},i.comparedTo=function(y,w){return Te(this,new I(y,w))},i.decimalPlaces=i.dp=function(y,w){var v,b,M,m=this;if(y!=null)return ot(y,0,pt),w==null?w=a:ot(w,0,8),B(new I(m),y+m.e+1,w);if(!(v=m.c))return null;if(b=((M=v.length-1)-Bt(this.e/j))*j,M=v[M])for(;M%10==0;M/=10,b--);return b<0&&(b=0),b},i.dividedBy=i.div=function(y,w){return t(this,new I(y,w),o,a)},i.dividedToIntegerBy=i.idiv=function(y,w){return t(this,new I(y,w),0,1)},i.exponentiatedBy=i.pow=function(y,w){var v,b,M,m,p,f,d,_,S,$=this;if(y=new I(y),y.c&&!y.isInteger())throw Error(It+"Exponent not an integer: "+z(y));if(w!=null&&(w=new I(w)),f=y.e>14,!$.c||!$.c[0]||$.c[0]==1&&!$.e&&$.c.length==1||!y.c||!y.c[0])return S=new I(Math.pow(+z($),f?y.s*(2-gr(y)):+z(y))),w?S.mod(w):S;if(d=y.s<0,w){if(w.c?!w.c[0]:!w.s)return new I(NaN);b=!d&&$.isInteger()&&w.isInteger(),b&&($=$.mod(w))}else{if(y.e>9&&($.e>0||$.e<-1||($.e==0?$.c[0]>1||f&&$.c[1]>=24e7:$.c[0]<8e13||f&&$.c[0]<=9999975e7)))return m=$.s<0&&gr(y)?-0:0,$.e>-1&&(m=1/m),new I(d?1/m:m);E&&(m=ji(E/j+2))}for(f?(v=new I(.5),d&&(y.s=1),_=gr(y)):(M=Math.abs(+z(y)),_=M%2),S=new I(s);;){if(_){if(S=S.times($),!S.c)break;m?S.c.length>m&&(S.c.length=m):b&&(S=S.mod(w))}if(M){if(M=Ut(M/2),M===0)break;_=M%2}else if(y=y.times(v),B(y,y.e+1,1),y.e>14)_=gr(y);else{if(M=+z(y),M===0)break;_=M%2}$=$.times($),m?$.c&&$.c.length>m&&($.c.length=m):b&&($=$.mod(w))}return b?S:(d&&(S=s.div(S)),w?S.mod(w):m?B(S,E,a,p):S)},i.integerValue=function(y){var w=new I(this);return y==null?y=a:ot(y,0,8),B(w,w.e+1,y)},i.isEqualTo=i.eq=function(y,w){return Te(this,new I(y,w))===0},i.isFinite=function(){return!!this.c},i.isGreaterThan=i.gt=function(y,w){return Te(this,new I(y,w))>0},i.isGreaterThanOrEqualTo=i.gte=function(y,w){return(w=Te(this,new I(y,w)))===1||w===0},i.isInteger=function(){return!!this.c&&Bt(this.e/j)>this.c.length-2},i.isLessThan=i.lt=function(y,w){return Te(this,new I(y,w))<0},i.isLessThanOrEqualTo=i.lte=function(y,w){return(w=Te(this,new I(y,w)))===-1||w===0},i.isNaN=function(){return!this.s},i.isNegative=function(){return this.s<0},i.isPositive=function(){return this.s>0},i.isZero=function(){return!!this.c&&this.c[0]==0},i.minus=function(y,w){var v,b,M,m,p=this,f=p.s;if(y=new I(y,w),w=y.s,!f||!w)return new I(NaN);if(f!=w)return y.s=-w,p.plus(y);var d=p.e/j,_=y.e/j,S=p.c,$=y.c;if(!d||!_){if(!S||!$)return S?(y.s=-w,y):new I($?p:NaN);if(!S[0]||!$[0])return $[0]?(y.s=-w,y):new I(S[0]?p:a==3?-0:0)}if(d=Bt(d),_=Bt(_),S=S.slice(),f=d-_){for((m=f<0)?(f=-f,M=S):(_=d,M=$),M.reverse(),w=f;w--;M.push(0));M.reverse()}else for(b=(m=(f=S.length)<(w=$.length))?f:w,f=w=0;w<b;w++)if(S[w]!=$[w]){m=S[w]<$[w];break}if(m&&(M=S,S=$,$=M,y.s=-y.s),w=(b=$.length)-(v=S.length),w>0)for(;w--;S[v++]=0);for(w=qt-1;b>f;){if(S[--b]<$[b]){for(v=b;v&&!S[--v];S[v]=w);--S[v],S[b]+=qt}S[b]-=$[b]}for(;S[0]==0;S.splice(0,1),--_);return S[0]?D(y,S,_):(y.s=a==3?-1:1,y.c=[y.e=0],y)},i.modulo=i.mod=function(y,w){var v,b,M=this;return y=new I(y,w),!M.c||!y.s||y.c&&!y.c[0]?new I(NaN):!y.c||M.c&&!M.c[0]?new I(M):(x==9?(b=y.s,y.s=1,v=t(M,y,0,3),y.s=b,v.s*=b):v=t(M,y,0,x),y=M.minus(v.times(y)),!y.c[0]&&x==1&&(y.s=M.s),y)},i.multipliedBy=i.times=function(y,w){var v,b,M,m,p,f,d,_,S,$,O,U,F,G,V,q=this,X=q.c,nt=(y=new I(y,w)).c;if(!X||!nt||!X[0]||!nt[0])return!q.s||!y.s||X&&!X[0]&&!nt||nt&&!nt[0]&&!X?y.c=y.e=y.s=null:(y.s*=q.s,!X||!nt?y.c=y.e=null:(y.c=[0],y.e=0)),y;for(b=Bt(q.e/j)+Bt(y.e/j),y.s*=q.s,d=X.length,$=nt.length,d<$&&(F=X,X=nt,nt=F,M=d,d=$,$=M),M=d+$,F=[];M--;F.push(0));for(G=qt,V=xe,M=$;--M>=0;){for(v=0,O=nt[M]%V,U=nt[M]/V|0,p=d,m=M+p;m>M;)_=X[--p]%V,S=X[p]/V|0,f=U*_+S*O,_=O*_+f%V*V+F[m]+v,v=(_/G|0)+(f/V|0)+U*S,F[m--]=_%G;F[m]=v}return v?++b:F.splice(0,1),D(y,F,b)},i.negated=function(){var y=new I(this);return y.s=-y.s||null,y},i.plus=function(y,w){var v,b=this,M=b.s;if(y=new I(y,w),w=y.s,!M||!w)return new I(NaN);if(M!=w)return y.s=-w,b.minus(y);var m=b.e/j,p=y.e/j,f=b.c,d=y.c;if(!m||!p){if(!f||!d)return new I(M/0);if(!f[0]||!d[0])return d[0]?y:new I(f[0]?b:M*0)}if(m=Bt(m),p=Bt(p),f=f.slice(),M=m-p){for(M>0?(p=m,v=d):(M=-M,v=f),v.reverse();M--;v.push(0));v.reverse()}for(M=f.length,w=d.length,M-w<0&&(v=d,d=f,f=v,w=M),M=0;w;)M=(f[--w]=f[w]+d[w]+M)/qt|0,f[w]=qt===f[w]?0:f[w]%qt;return M&&(f=[M].concat(f),++p),D(y,f,p)},i.precision=i.sd=function(y,w){var v,b,M,m=this;if(y!=null&&y!==!!y)return ot(y,1,pt),w==null?w=a:ot(w,0,8),B(new I(m),y,w);if(!(v=m.c))return null;if(M=v.length-1,b=M*j+1,M=v[M]){for(;M%10==0;M/=10,b--);for(M=v[0];M>=10;M/=10,b++);}return y&&m.e+1>b&&(b=m.e+1),b},i.shiftedBy=function(y){return ot(y,-Wi,Wi),this.times("1e"+y)},i.squareRoot=i.sqrt=function(){var y,w,v,b,M,m=this,p=m.c,f=m.s,d=m.e,_=o+4,S=new I("0.5");if(f!==1||!p||!p[0])return new I(!f||f<0&&(!p||p[0])?NaN:p?m:1/0);if(f=Math.sqrt(+z(m)),f==0||f==1/0?(w=Dt(p),(w.length+d)%2==0&&(w+="0"),f=Math.sqrt(+w),d=Bt((d+1)/2)-(d<0||d%2),f==1/0?w="5e"+d:(w=f.toExponential(),w=w.slice(0,w.indexOf("e")+1)+d),v=new I(w)):v=new I(f+""),v.c[0]){for(d=v.e,f=d+_,f<3&&(f=0);;)if(M=v,v=S.times(M.plus(t(m,M,_,1))),Dt(M.c).slice(0,f)===(w=Dt(v.c)).slice(0,f))if(v.e<d&&--f,w=w.slice(f-3,f+1),w=="9999"||!b&&w=="4999"){if(!b&&(B(M,M.e+o+2,0),M.times(M).eq(m))){v=M;break}_+=4,f+=4,b=1}else{(!+w||!+w.slice(1)&&w.charAt(0)=="5")&&(B(v,v.e+o+2,1),y=!v.times(v).eq(m));break}}return B(v,v.e+o+1,a,y)},i.toExponential=function(y,w){return y!=null&&(ot(y,0,pt),y++),L(this,y,w,1)},i.toFixed=function(y,w){return y!=null&&(ot(y,0,pt),y=y+this.e+1),L(this,y,w)},i.toFormat=function(y,w,v){var b,M=this;if(v==null)y!=null&&w&&typeof w=="object"?(v=w,w=null):y&&typeof y=="object"?(v=y,y=w=null):v=A;else if(typeof v!="object")throw Error(It+"Argument not an object: "+v);if(b=M.toFixed(y,w),M.c){var m,p=b.split("."),f=+v.groupSize,d=+v.secondaryGroupSize,_=v.groupSeparator||"",S=p[0],$=p[1],O=M.s<0,U=O?S.slice(1):S,F=U.length;if(d&&(m=f,f=d,d=m,F-=m),f>0&&F>0){for(m=F%f||f,S=U.substr(0,m);m<F;m+=f)S+=_+U.substr(m,f);d>0&&(S+=_+U.slice(m)),O&&(S="-"+S)}b=$?S+(v.decimalSeparator||"")+((d=+v.fractionGroupSize)?$.replace(new RegExp("\\d{"+d+"}\\B","g"),"$&"+(v.fractionGroupSeparator||"")):$):S}return(v.prefix||"")+b+(v.suffix||"")},i.toFraction=function(y){var w,v,b,M,m,p,f,d,_,S,$,O,U=this,F=U.c;if(y!=null&&(f=new I(y),!f.isInteger()&&(f.c||f.s!==1)||f.lt(s)))throw Error(It+"Argument "+(f.isInteger()?"out of range: ":"not an integer: ")+z(f));if(!F)return new I(U);for(w=new I(s),_=v=new I(s),b=d=new I(s),O=Dt(F),m=w.e=O.length-U.e-1,w.c[0]=Xi[(p=m%j)<0?j+p:p],y=!y||f.comparedTo(w)>0?m>0?w:_:f,p=c,c=1/0,f=new I(O),d.c[0]=0;S=t(f,w,0,1),M=v.plus(S.times(b)),M.comparedTo(y)!=1;)v=b,b=M,_=d.plus(S.times(M=_)),d=M,w=f.minus(S.times(M=w)),f=M;return M=t(y.minus(v),b,0,1),d=d.plus(M.times(_)),v=v.plus(M.times(b)),d.s=_.s=U.s,m=m*2,$=t(_,b,m,a).minus(U).abs().comparedTo(t(d,v,m,a).minus(U).abs())<1?[_,b]:[d,v],c=p,$},i.toNumber=function(){return+z(this)},i.toPrecision=function(y,w){return y!=null&&ot(y,1,pt),L(this,y,w,2)},i.toString=function(y){var w,v=this,b=v.s,M=v.e;return M===null?b?(w="Infinity",b<0&&(w="-"+w)):w="NaN":(y==null?w=M<=l||M>=u?mr(Dt(v.c),M):ue(Dt(v.c),M,"0"):y===10&&T?(v=B(new I(v),o+M+1,a),w=ue(Dt(v.c),v.e,"0")):(ot(y,2,C.length,"Base"),w=n(ue(Dt(v.c),M,"0"),10,y,b,!0)),b<0&&v.c[0]&&(w="-"+w)),w},i.valueOf=i.toJSON=function(){return z(this)},i._isBigNumber=!0,i[Symbol.toStringTag]="BigNumber",i[Symbol.for("nodejs.util.inspect.custom")]=i.valueOf,e!=null&&I.set(e),I}function Bt(e){var t=e|0;return e>0||e===t?t:t-1}function Dt(e){for(var t,n,r=1,i=e.length,s=e[0]+"";r<i;){for(t=e[r++]+"",n=j-t.length;n--;t="0"+t);s+=t}for(i=s.length;s.charCodeAt(--i)===48;);return s.slice(0,i+1||1)}function Te(e,t){var n,r,i=e.c,s=t.c,o=e.s,a=t.s,l=e.e,u=t.e;if(!o||!a)return null;if(n=i&&!i[0],r=s&&!s[0],n||r)return n?r?0:-a:o;if(o!=a)return o;if(n=o<0,r=l==u,!i||!s)return r?0:!i^n?1:-1;if(!r)return l>u^n?1:-1;for(a=(l=i.length)<(u=s.length)?l:u,o=0;o<a;o++)if(i[o]!=s[o])return i[o]>s[o]^n?1:-1;return l==u?0:l>u^n?1:-1}function ot(e,t,n,r){if(e<t||e>n||e!==Ut(e))throw Error(It+(r||"Argument")+(typeof e=="number"?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function gr(e){var t=e.c.length-1;return Bt(e.e/j)==t&&e.c[t]%2!=0}function mr(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function ue(e,t,n){var r,i;if(t<0){for(i=n+".";++t;i+=n);e=i+e}else if(r=e.length,++t>r){for(i=n,t-=r;--t;i+=n);e+=i}else t<r&&(e=e.slice(0,t)+"."+e.slice(t));return e}var Im=uu();const Tm=24,kn=32,km=()=>typeof globalThis<"u"&&globalThis.crypto&&typeof globalThis.crypto.getRandomValues=="function"?()=>{const e=new Uint32Array(1);return globalThis.crypto.getRandomValues(e),e[0]/4294967296}:Math.random,Eo=km(),Rs=(e=4,t=Eo)=>{let n="";for(;n.length<e;)n=n+Math.floor(t()*36).toString(36);return n};function Pm(e){let t=new Im(0);for(const n of e.values())t=t.multipliedBy(256).plus(n);return t}const hu=(e="")=>{const t=new TextEncoder;return Pm($m(t.encode(e))).toString(36).slice(1)},Ja=Array.from({length:26},(e,t)=>String.fromCharCode(t+97)),Nm=e=>Ja[Math.floor(e()*Ja.length)],Cm=({globalObj:e=typeof global<"u"?global:typeof window<"u"?window:{},random:t=Eo}={})=>{const n=Object.keys(e).toString(),r=n.length?n+Rs(kn,t):Rs(kn,t);return hu(r).substring(0,kn)},Om=e=>()=>e++,Lm=476782367,Mo=({random:e=Eo,counter:t=Om(Math.floor(e()*Lm)),length:n=Tm,fingerprint:r=Cm({random:e})}={})=>{if(n>kn)throw new Error(`Length must be between 2 and ${kn}. Received: ${n}`);return function(){const s=Nm(e),o=Date.now().toString(36),a=t().toString(36),l=Rs(n,e),u=`${o+l+a+r}`;return`${s+hu(u).substring(1,n)}`}};Mo();const Rm=Mo({length:5});function fu({S:e,C:t}){e.world=Mi();const n=Ee/(t.config.numSystems-1),r=-Ee/2,i=Ee/2;rn("Generating map...");const s=Math.min(.08,Math.sqrt(Math.PI/t.config.numSystems));for(let h=r;h<i;h+=n){const c=Math.asin(h/(Ee/2))*(180/Math.PI),x=[Math.random()*360-180,c],E=Um(x),A=Vc(e.world,E.location);if(A){if(ri(x,A.location)<s){h-=n;continue}Os(e.world,E,A)}Gc(e.world,E)}const o=Array.from(e.world.systemMap.values()),a=[o[o.length-1]];for(let h=o.length-2;h>=0;h--){const c=o[h],g=xo(c.location,a);g&&Os(e.world,c,g),a.push(c)}$i(e.world),rn(`Generated ${e.world.systemMap.size} systems and ${e.world.laneMap.size} lanes.`);const l=[...o],u=Math.max(Rh*t.config.numSystems,Er+t.config.numBots);for(let h=0;h<u&&l.length!==0;h++){const c=Math.floor(Math.random()*l.length);if(c===0){h--;continue}const g=l[c];g.ownerId=null,g.type="INHABITED",g.ships=Ll+Math.floor(Math.random()*10),g.homeworld=null,l.splice(c,1)}}function Dm(e,t){const n=Array.from(e.world.systemMap.values()).filter(s=>!s.ownerId&&s.type==="INHABITED");if(n.length===0)throw"No available homeworlds to join.";const r=Math.floor(Math.random()*n.length),i=n[r];return i.ships=1,i.ownerId=i.homeworld=t,i.type="INHABITED",i}function Um(e){return{id:"s"+Rm(),type:"UNINHABITED",location:e,ownerId:null,ships:0,homeworld:null,moveQueue:[],lastMove:null,movement:[0,0]}}function Bm(e){const t=vo();return fu({...e,S:t}),t}const zm=Object.freeze(Object.defineProperty({__proto__:null,addLane:Os,addPlayer:Wc,addSystem:Gc,assignSystem:Dm,buildNeighborMap:$i,checkVictory:em,createWorld:Mi,defaultConfig:jc,doQueuedMoves:Jc,eliminatePlayer:Qc,findClosestSystem:Vc,findClosestSystemInList:xo,gameTick:nm,generateMap:fu,getAdjacentSystems:Pt,getPlayersHomeworld:bo,hasLane:Ai,initalState:vo,moveShips:Kc,orderToMove:eu,queueMove:Yc,revealAllSystems:Xc,roundUpdate:iu,setup:Bm,takeOrder:Yg,turnUpdate:ru,updateStats:nu,visitSystem:Ii,worldFromJson:Gg,worldToJson:Vg},Symbol.toStringTag,{value:"Module"})),dt={all:new Set,last:null};function Re(){dt.all.clear(),dt.last=null}function Hn(e){dt.all.add(e),dt.last=e}function Fm(e){dt.all.clear(),dt.all.add(e),dt.last=e}function Hm(e){dt.all.delete(e),dt.last===e&&(dt.last=null)}function du(e){return dt.all.has(e)}function qm(e){du(e)?Hm(e):Hn(e)}function Gm({S:e,C:t},n){if(dt.last==null)return;const r=[[dt.last]],i=new Set;for(i.add(dt.last);r.length>0;){const s=r.shift(),o=s[s.length-1];if(o===n){s.forEach(a=>dt.all.add(a)),dt.last=n;return}for(const a of Pt(e.world,o))!i.has(a.id)&&a.ownerId===t.playerId&&(i.add(a.id),r.push([...s,a.id]))}}function tl(e,t){const{S:n,C:r}=globalThis.gameManager.getFnContext();if(r.status==="PLAYING")switch(e.button){case 0:break;case 2:{let i=n.world.systemMap.get(t.fromId),s=n.world.systemMap.get(t.toId);if(i.ownerId!==r.playerId&&s.ownerId!==r.playerId)return;if(i.ownerId!==r.playerId){const o=i;i=s,s=o}else if(i.ownerId===i.ownerId&&s.ships>i.ships){const o=i;i=s,s=o}if(Vm(i.id,s.id),s.ownerId!==r.playerId)return;e.altKey||(!e.ctrlKey&&!e.shiftKey&&Re(),Hn(i.id),s.ownerId===r.playerId&&Hn(s.id));break}}}function ui(e,t){const n=globalThis.gameManager.getFnContext();if(n.C.status==="PLAYING")switch(Dl&&e.altKey&&(rn(""+t.id,t.lastMove?.message??"none",t.lastMove?.ships??0),console.log(t)),e.button){case 0:if(t.ownerId!==n.C.playerId)return;e.ctrlKey||e.metaKey?qm(t.id):e.shiftKey?Gm(n,t.id):Fm(t.id);break;case-1:case 2:{const r=Array.from(dt.all);if(r.length===0)return;r.forEach(i=>{jm(i,t.id),t.ownerId===n.C.playerId&&(e.altKey||(!e.ctrlKey&&!e.shiftKey&&Re(),Hn(t.id)))});break}}}function Vm(e,t){const{S:n,E:r,C:i}=globalThis.gameManager.getFnContext();if(!Ai(n.world,e,t))return;const s={type:"BALANCED_MOVE",message:`Balanced move from ${e} to ${t}`,toId:t,fromId:e,playerId:i.playerId};r.emit("TAKE_ORDER",s)}function jm(e,t){const{S:n,E:r,C:i}=globalThis.gameManager.getFnContext();if(!Ai(n.world,e,t))return;const s={type:"MASS_MOVE",toId:t,fromId:e,playerId:i.playerId,message:`Mass move from ${e} to ${t}`};r.emit("TAKE_ORDER",s)}let pu=0;const hi=[];function Wm(){pu=0,hi.length=0;const{E:e}=globalThis.gameManager.getFnContext();e.emit("MESSAGES_UPDATED",{messages:hi})}function yr(e){const{C:t,E:n}=globalThis.gameManager.getFnContext();hi.push({id:pu++,message:e,tick:t.tick}),n.emit("MESSAGES_UPDATED",{messages:hi})}const $o=Math.PI,el=$o/2,nl=180/$o,rl=$o/180,Xm=Math.atan2,il=Math.cos,Ym=Math.max,Km=Math.min,sl=Math.sin,Qm=Math.sign||function(e){return e>0?1:e<0?-1:0},gu=Math.sqrt;function Zm(e){return e>1?el:e<-1?-el:Math.asin(e)}function mu(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Nt(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function fi(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]}function di(e){var t=gu(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]}function Ao(e){return[Xm(e[1],e[0])*nl,Zm(Ym(-1,Km(1,e[2])))*nl]}function ie(e){const t=e[0]*rl,n=e[1]*rl,r=il(n);return[r*il(t),r*sl(t),sl(n)]}function Io(e){return e=e.map(t=>ie(t)),mu(e[0],Nt(e[2],e[1]))}function Jm(e){const t=ey(e),n=ry(t),r=ny(n,e),i=sy(n,e.length),s=ty(i,e),o=iy(n,e),{polygons:a,centers:l}=oy(o,n,e),u=ay(a),h=cy(n,e),c=ly(r,n);return{delaunay:t,edges:r,triangles:n,centers:l,neighbors:i,polygons:a,mesh:u,hull:h,urquhart:c,find:s}}function ty(e,t){function n(r,i){let s=r[0]-i[0],o=r[1]-i[1],a=r[2]-i[2];return s*s+o*o+a*a}return function(i,s,o){o===void 0&&(o=0);let a,l,u=o;const h=ie([i,s]);do a=o,o=null,l=n(h,ie(t[a])),e[a].forEach(c=>{let g=n(h,ie(t[c]));if(g<l){l=g,o=c,u=c;return}});while(o!==null);return u}}function ey(e){if(e.length<2)return{};let t=0;for(;isNaN(e[t][0]+e[t][1])&&t++<e.length;);const n=ni(e[t]),r=Fc().translate([0,0]).scale(1).rotate(n.invert([180,0]));e=e.map(r);const i=[];let s=1;for(let c=0,g=e.length;c<g;c++){let x=e[c][0]**2+e[c][1]**2;!isFinite(x)||x>1e32?i.push(c):x>s&&(s=x)}const o=1e6*gu(s);i.forEach(c=>e[c]=[o,0]),e.push([0,o]),e.push([-o,0]),e.push([0,-o]);const a=ho.from(e);a.projection=r;const{triangles:l,halfedges:u,inedges:h}=a;for(let c=0,g=u.length;c<g;c++)if(u[c]<0){const x=c%3==2?c-2:c+1,E=c%3==0?c+2:c-1,A=u[x],C=u[E];u[A]=C,u[C]=A,u[x]=u[E]=-1,l[c]=l[x]=l[E]=t,h[l[A]]=A%3==0?A+2:A-1,h[l[C]]=C%3==0?C+2:C-1,c+=2-c%3}else l[c]>e.length-3-1&&(l[c]=t);return a}function ny(e,t){const n=new Set;return t.length===2?[[0,1]]:(e.forEach(r=>{if(r[0]!==r[1]&&!(Io(r.map(i=>t[i]))<0))for(let i=0,s;i<3;i++)s=(i+1)%3,n.add(Ul([r[i],r[s]]).join("-"))}),Array.from(n,r=>r.split("-").map(Number)))}function ry(e){const{triangles:t}=e;if(!t)return[];const n=[];for(let r=0,i=t.length/3;r<i;r++){const s=t[3*r],o=t[3*r+1],a=t[3*r+2];s!==o&&o!==a&&n.push([s,a,o])}return n}function iy(e,t){return e.map(n=>{const r=n.map(s=>t[s]).map(ie),i=fi(fi(Nt(r[1],r[0]),Nt(r[2],r[1])),Nt(r[0],r[2]));return Ao(di(i))})}function sy(e,t){const n=[];return e.forEach(r=>{for(let i=0;i<3;i++){const s=r[i],o=r[(i+1)%3];n[s]=n[s]||[],n[s].push(o)}}),e.length===0&&(t===2?(n[0]=[1],n[1]=[0]):t===1&&(n[0]=[])),n}function oy(e,t,n){const r=[],i=e.slice();if(t.length===0){if(n.length<2)return{polygons:r,centers:i};if(n.length===2){const a=ie(n[0]),l=ie(n[1]),u=di(fi(a,l)),h=di(Nt(a,l)),c=Nt(u,h),g=[u,Nt(u,c),Nt(Nt(u,c),c),Nt(Nt(Nt(u,c),c),c)].map(Ao).map(o);return r.push(g),r.push(g.slice().reverse()),{polygons:r,centers:i}}}t.forEach((a,l)=>{for(let u=0;u<3;u++){const h=a[u],c=a[(u+1)%3],g=a[(u+2)%3];r[h]=r[h]||[],r[h].push([c,g,l,[h,c,g]])}});const s=r.map(a=>{const l=[a[0][2]];let u=a[0][1];for(let h=1;h<a.length;h++)for(let c=0;c<a.length;c++)if(a[c][0]==u){u=a[c][1],l.push(a[c][2]);break}if(l.length>2)return l;if(l.length==2){const h=ol(n[a[0][3][0]],n[a[0][3][1]],i[l[0]]),c=ol(n[a[0][3][2]],n[a[0][3][0]],i[l[0]]),g=o(h),x=o(c);return[l[0],x,l[1],g]}});function o(a){let l=-1;return i.slice(t.length,1/0).forEach((u,h)=>{u[0]===a[0]&&u[1]===a[1]&&(l=h+t.length)}),l<0&&(l=i.length,i.push(a)),l}return{polygons:s,centers:i}}function ol(e,t,n){e=ie(e),t=ie(t),n=ie(n);const r=Qm(mu(Nt(t,e),n));return Ao(di(fi(e,t)).map(i=>r*i))}function ay(e){const t=[];return e.forEach(n=>{if(!n)return;let r=n[n.length-1];for(let i of n)i>r&&t.push([r,i]),r=i}),t}function ly(e,t){return function(n){const r=new Map,i=new Map;return e.forEach((s,o)=>{const a=s.join("-");r.set(a,n[o]),i.set(a,!0)}),t.forEach(s=>{let o=0,a=-1;for(let l=0;l<3;l++){let u=Ul([s[l],s[(l+1)%3]]).join("-");r.get(u)>o&&(o=r.get(u),a=u)}i.set(a,!1)}),e.map(s=>i.get(s.join("-")))}}function cy(e,t){const n=new Set,r=[];e.map(a=>{if(!(Io(a.map(l=>t[l>t.length?0:l]))>1e-12))for(let l=0;l<3;l++){let u=[a[l],a[(l+1)%3]],h=`${u[0]}-${u[1]}`;n.has(h)?n.delete(h):n.add(`${u[1]}-${u[0]}`)}});const i=new Map;let s;if(n.forEach(a=>{a=a.split("-").map(Number),i.set(a[0],a[1]),s=a[0]}),s===void 0)return r;let o=s;do{r.push(o);let a=i.get(o);i.set(o,-1),o=a}while(o>-1&&o!==s);return r}function uy(e){const t=function(n){if(t.delaunay=null,t._data=n,typeof t._data=="object"&&t._data.type==="FeatureCollection"&&(t._data=t._data.features),typeof t._data=="object"){const r=t._data.map(i=>[t._vx(i),t._vy(i),i]).filter(i=>isFinite(i[0]+i[1]));t.points=r.map(i=>[i[0],i[1]]),t.valid=r.map(i=>i[2]),t.delaunay=Jm(t.points)}return t};return t._vx=function(n){if(typeof n=="object"&&"type"in n)return Aa(n)[0];if(0 in n)return n[0]},t._vy=function(n){if(typeof n=="object"&&"type"in n)return Aa(n)[1];if(1 in n)return n[1]},t.x=function(n){return n?(t._vx=n,t):t._vx},t.y=function(n){return n?(t._vy=n,t):t._vy},t.polygons=function(n){if(n!==void 0&&t(n),!t.delaunay)return!1;const r={type:"FeatureCollection",features:[]};return t.valid.length===0||(t.delaunay.polygons.forEach((i,s)=>r.features.push({type:"Feature",geometry:i?{type:"Polygon",coordinates:[[...i,i[0]].map(o=>t.delaunay.centers[o])]}:null,properties:{site:t.valid[s],sitecoordinates:t.points[s],neighbours:t.delaunay.neighbors[s]}})),t.valid.length===1&&r.features.push({type:"Feature",geometry:{type:"Sphere"},properties:{site:t.valid[0],sitecoordinates:t.points[0],neighbours:[]}})),r},t.triangles=function(n){return n!==void 0&&t(n),t.delaunay?{type:"FeatureCollection",features:t.delaunay.triangles.map((r,i)=>(r=r.map(s=>t.points[s]),r.center=t.delaunay.centers[i],r)).filter(r=>Io(r)>0).map(r=>({type:"Feature",properties:{circumcenter:r.center},geometry:{type:"Polygon",coordinates:[[...r,r[0]]]}}))}:!1},t.links=function(n){if(n!==void 0&&t(n),!t.delaunay)return!1;const r=t.delaunay.edges.map(s=>ri(t.points[s[0]],t.points[s[1]])),i=t.delaunay.urquhart(r);return{type:"FeatureCollection",features:t.delaunay.edges.map((s,o)=>({type:"Feature",properties:{source:t.valid[s[0]],target:t.valid[s[1]],length:r[o],urquhart:!!i[o]},geometry:{type:"LineString",coordinates:[t.points[s[0]],t.points[s[1]]]}}))}},t.mesh=function(n){return n!==void 0&&t(n),t.delaunay?{type:"MultiLineString",coordinates:t.delaunay.edges.map(r=>[t.points[r[0]],t.points[r[1]]])}:!1},t.cellMesh=function(n){if(n!==void 0&&t(n),!t.delaunay)return!1;const{centers:r,polygons:i}=t.delaunay,s=[];for(const o of i)if(o)for(let a=o.length,l=o[a-1],u=o[0],h=0;h<a;l=u,u=o[++h])u>l&&s.push([r[l],r[u]]);return{type:"MultiLineString",coordinates:s}},t._found=void 0,t.find=function(n,r,i){if(t._found=t.delaunay.find(n,r,t._found),!i||ri([n,r],t.points[t._found])<i)return t._found},t.hull=function(n){n!==void 0&&t(n);const r=t.delaunay.hull,i=t.points;return r.length===0?null:{type:"Polygon",coordinates:[[...r.map(s=>i[s]),i[r[0]]]]}},e?t(e):t}const yu=Math.acos,hy=Math.asin,al=Math.atan2,De=Math.cos,ll=Math.hypot,Ds=Math.max,Us=Math.min,wu=Math.PI,Ue=Math.sin,Pn=wu/180,Yi=180/wu;class Gt{static fromCartesian([t,n,r]){return[0,r,-n,t]}static fromAngles([t,n,r]){t*=Pn/2,n*=Pn/2,r=(r||0)*Pn/2;const i=Ue(t),s=De(t),o=Ue(n),a=De(n),l=Ue(r),u=De(r);return[s*a*u+i*o*l,i*a*u-s*o*l,s*o*u+i*a*l,s*a*l-i*o*u]}static toAngles([t,n,r,i]){return[al(2*(t*n+r*i),1-2*(n*n+r*r))*Yi,hy(Ds(-1,Us(1,2*(t*r-i*n))))*Yi,al(2*(t*i+n*r),1-2*(r*r+i*i))*Yi]}static interpolateAngles(t,n){const r=Gt.interpolate(Gt.fromAngles(t),Gt.fromAngles(n));return i=>Gt.toAngles(r(i))}static interpolateLinear([t,n,r,i],[s,o,a,l]){s-=t,o-=n,a-=r,l-=i;const u=new Array(4);return h=>{const c=ll(u[0]=t+s*h,u[1]=n+o*h,u[2]=r+a*h,u[3]=i+l*h);return u[0]/=c,u[1]/=c,u[2]/=c,u[3]/=c,u}}static interpolate([t,n,r,i],[s,o,a,l]){let u=Gt.dot([t,n,r,i],[s,o,a,l]);if(u<0&&(s=-s,o=-o,a=-a,l=-l,u=-u),u>.9995)return Gt.interpolateLinear([t,n,r,i],[s,o,a,l]);const h=yu(Ds(-1,Us(1,u))),c=new Array(4),g=ll(s-=t*u,o-=n*u,a-=r*u,l-=i*u);return s/=g,o/=g,a/=g,l/=g,x=>{const E=h*x,A=Ue(E),C=De(E);return c[0]=t*C+s*A,c[1]=n*C+o*A,c[2]=r*C+a*A,c[3]=i*C+l*A,c}}static dot([t,n,r,i],[s,o,a,l]){return t*s+n*o+r*a+i*l}static multiply([t,n,r,i],[s,o,a,l]){return[t*s-n*o-r*a-i*l,t*o+n*s+r*l-i*a,t*a-n*l+r*s+i*o,t*l+n*a-r*o+i*s]}}const Ft=Gt.fromAngles;Ft.multiply=Gt.multiply;Ft.rotation=Gt.toAngles;Ft.interpolate=Gt.interpolateAngles;Ft.cartesian=function(e){const t=e[0]*Pn,n=e[1]*Pn,r=De(n);return[r*De(t),r*Ue(t),Ue(n)]};Ft.delta=function(e,t,n){arguments.length==2&&(n=1);const r=Math.sqrt;function i(h,c){return[h[1]*c[2]-h[2]*c[1],h[2]*c[0]-h[0]*c[2],h[0]*c[1]-h[1]*c[0]]}function s(h,c){return h[0]*c[0]+h[1]*c[1]+h[2]*c[2]}const o=i(e,t),a=r(s(o,o));if(!a)return[1,0,0,0];const l=n*yu(Ds(-1,Us(1,s(e,t))))/2,u=Ue(l);return[De(l),o[2]/a*u,-o[1]/a*u,o[0]/a*u]};const cl=.5,fy=.25,dy=100,py=20,gy=Si(".3~s"),un={Orthographic:Lg,Stereographic:Fc,Mercator:Og,TransverseMercator:Rg};let Bs,Vt,hn=un[Ah],lt=hn().translate([0,0]),we=lt.scale(),Ti=go().projection(lt),Nr;const my=uy().x(e=>e.location[0]).y(e=>e.location[1]);function yy(){const e=Object.keys(un),n=(e.findIndex(r=>un[r]===hn)+1)%e.length;wy(e[n])}function wy(e){hn=un[e],lt=hn(),lt.translate([0,0]).rotate([0,0,0]).scale(we),we=lt.scale(),Ti=go().projection(lt)}function We(e){const t=lt.rotate();t[0]+=e[0],t[1]+=e[1],e.length===3&&(t[2]+=e[2]),lt.rotate(t)}function _y(e,t){Bs=jt(e),Vt=Bs.select("svg"),Vt.attr("width","100vw").attr("height","100vh").attr("viewBox",`-${Dr/2} -${Ee/2} ${Dr} ${Ee}`).on("contextmenu",o=>o.preventDefault()),zs(t.S),xu(t),vu(t),_u(t),Vt.call(n()),Vt.call(r()),window.addEventListener("resize",s);function n(){return i().on("drag.render",()=>et()).on("end.render",()=>et())}function r(){return qg().filter(o=>o.type==="wheel").on("zoom",o=>{if(o.transform.k>cl){const a=we*o.transform.k;lt.scale(a),et()}else o.transform.k=cl})}function i(){let o,a,l,u,h;function c(A,C){const T=E0(A,C);if(T.length!==h&&(h=T.length,h>1&&(u=Math.atan2(T[1][1]-T[0][1],T[1][0]-T[0][0])),g.apply(C,[A,C])),h>1){const I=Wo(T,D=>D[0]),L=Wo(T,D=>D[1]),k=Math.atan2(T[1][1]-T[0][1],T[1][0]-T[0][0]);return[I,L,k]}return T[0]}function g({x:A,y:C}){const T=E([A,C]);o=Ft.cartesian(lt.invert(T)),l=lt.rotate(),a=Ft(l)}function x(A){const C=E([A.x,A.y]),T=Ft.cartesian(lt.rotate(l).invert(C)),I=Ft.delta(o,T);let L=Ft.multiply(a,I);const k=c(A,this);if(k[2]){const D=(k[2]-u)/2,B=-Math.sin(D),z=Math.sign(Math.cos(D));L=Ft.multiply([Math.sqrt(1-B*B),0,0,z*B],L)}lt.rotate(Ft.rotation(L)),I[0]<.7&&g.apply(this,[A,this])}function E(A){const C=parseInt(Vt.style("width")),T=parseInt(Vt.style("height"));return[A[0]-C/2,A[1]-T/2]}return k0().filter(A=>A.button===1||A.touches).on("start",g).on("drag",x)}function s(){zs(globalThis.gameManager.getState())}}function zs(e){const t=Vt.node()?.getBoundingClientRect(),n=window.devicePixelRatio||1,r=t?.height||Ee,i=t?.width||Dr,a=Bs.selectAll("canvas").data([null]).join(h=>h.append("canvas").style("position","absolute").style("top",0).style("left",0).style("z-index",-1).style("pointer-events","none")).attr("width",i*n).attr("height",r*n).style("width",`${i}px`).style("height",`${r}px`).node().getContext("2d");a.setTransform(1,0,0,1,0,0),a.scale(n,n),a.translate(i/2,r/2);const l=Math.min(i/Dr,r/Ee);a.scale(l,l);const u="#FFFFFF48";if(hn===un.Orthographic){const h=lt.scale();a.strokeStyle=u,a.lineWidth=1,a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=10,a.shadowColor=u,a.beginPath(),a.arc(0,0,h,0,Math.PI*2),a.stroke(),a.fill()}{a.shadowBlur=0,a.strokeStyle="rgba(51, 51, 51, 0.5)";const h=xy(e),c=go().projection(lt).context(a);a.beginPath(),c(h),a.stroke()}}function xy(e){const t=fg(),n=bo(e);if(n){if(!Nr){const r=ni([0,90+n.location[1],0]),i=ni([n.location[0],0,0]);Nr={type:"FeatureCollection",features:t.lines().map(s=>({type:"Feature",geometry:{type:"LineString",coordinates:s.coordinates.map(o=>i(r(o)))}}))}}return Nr}return t()}function ul(e){const t=lt.scale()*e;t<we*fy||t>we*dy||(lt.scale(t),et())}function Fs(){const e=globalThis.gameManager.getState(),t=bo(e);if(!t)return;Nr=null;const n=t.location;hn===un.Orthographic?Hs([n[0],n[1]-45]):Hs(n),lt.scale(we)}function vy(e){const n=globalThis.gameManager.getState().world.systemMap.get(e);n&&(Hs(n.location),lt.scale(we))}function Hs(e){lt.rotate([-e[0],-e[1],0]),et()}let hl=null;function et(){return cancelAnimationFrame(hl),hl=requestAnimationFrame(()=>e());function e(t){Vt&&(t??=globalThis.gameManager.getFnContext(),xu(t),zs(t.S),_u(t),vu(t))}}function _u({S:e,C:t,P:n}){const i=lt.scale()/we<1;let s=e.world.systemMap.values();n&&t.config.fow&&(s=n.revealedSystems.values().map(l=>e.world.systemMap.get(l))),s=s.filter(l=>!!Ti({type:"Point",coordinates:l.location}));const a=Vt.selectAll("g#systems").data([null]).join(l=>l.append("g").attr("id","systems")).classed("reduced-size",i).classed("hidden",!1).selectAll(".system").data(s,l=>l.id).join(l=>{const u=l.append("g").attr("class","system").attr("id",h=>h.id).on("click",(h,c)=>{ui(h,c),et()}).on("contextmenu",(h,c)=>{h.preventDefault(),ui(h,c),et()});return u.append("circle").attr("class","system-outline").attr("cx",0).attr("cy",0).attr("r",py/2),u.append("text").attr("class","ship-count").attr("y",-10).attr("x",0).attr("text-anchor","start"),u.append("text").attr("class","system-icon").attr("y",0).attr("x",0).attr("text-anchor","end"),u});a.style("--owner-color",l=>e.playerMap.get(l.ownerId)?.color??null).classed("own",l=>l.ownerId===t.playerId).classed("selected",l=>du(l.id)).classed("moved",l=>l.movement[0]>0||l.movement[1]>0).classed("inhabited",l=>l.type==="INHABITED").classed("homeworld",l=>!!l.homeworld&&l.ownerId===l.homeworld).classed("visited",l=>n?n.visitedSystems.has(l.id):!0).attr("transform",l=>`translate(${lt(l.location)})`),a.select(".system-icon").text(l=>l.homeworld&&l.ownerId===l.homeworld?"":l.type==="INHABITED"?"":""),a.select(".ship-count").text(l=>i?"":(l.type==="INHABITED"?"":"")+(l.ships?gy(l.ships):""))}const by=(()=>{let e=[],t;return n=>{if(!e||t!==n.world.systemMap){t=n.world.systemMap;const r=Array.from(t.values());e=my.polygons(r).features}return e}})();function xu({S:e,C:t,P:n}){const i=lt.scale()/we<1;let s=by(e);n&&t.config.fow&&(s=s.filter(l=>{const u=l.properties?.site;return n.revealedSystems.has(u.id)})),Vt.selectAll("g#mesh").data([null]).join(l=>l.append("g").attr("id","mesh")).classed("reduced-size",i).classed("hidden",!1).selectAll("path").data(s).join(l=>l.append("path").classed("region",!0).on("click",(u,h)=>{ui(u,h),et()}).on("contextmenu",(u,h)=>{u.preventDefault(),ui(u,h),et()})).attr("d",l=>Ti(l)).datum(l=>l.properties.site).classed("visited",l=>n?n.visitedSystems.has(l.id):!0).style("--owner-color",l=>e.playerMap.get(l.ownerId)?.color??null)}function vu({S:e,C:t,P:n}){let r=e.world.laneMap.values();n&&t.config.fow&&(r=r.filter(o=>n.revealedSystems.has(o.fromId)&&n.revealedSystems.has(o.toId)));const s=Vt.selectAll("g#lanes").data([null]).join(o=>o.append("g").attr("id","lanes")).selectAll("g.lane-group").data(r,o=>o.id).join(o=>{const a=o.append("g").attr("class","lane-group").attr("id",l=>l.id).on("click",(l,u)=>{tl(l,u),et()}).on("contextmenu",(l,u)=>{l.preventDefault(),tl(l,u),et()});return a.append("path").attr("class","lane"),a.append("path").attr("class","pulse"),a}).datum(o=>{const a=e.world.systemMap.get(o.toId),l=e.world.systemMap.get(o.fromId),u=Ti({type:"LineString",coordinates:[l.location,a.location]});return{...o,from:e.world.systemMap.get(o.fromId),to:e.world.systemMap.get(o.toId),path:u}});s.style("--owner-color",o=>{const a=o.from;if(!a.ownerId)return null;const l=o.to;return!l.ownerId||a.ownerId!==l.ownerId?null:e.playerMap.get(a.ownerId)?.color??null}),s.select("path.lane").attr("d",o=>o.path).classed("own",o=>{const a=o.from,l=o.to;return a.ownerId===t.playerId||l.ownerId===t.playerId}).style("--path-length",o=>{const a=jt(`#${o.id} .lane`).node();return a?a.getTotalLength():200}),s.select("path.pulse").attr("d",o=>o.path).classed("moved",o=>o.movement[0]>0||o.movement[1]>0).style("stroke-width",o=>{if(o.movement[0]===0&&o.movement[1]===0)return null;const a=2,l=Math.floor(Math.log2(Math.max(o.movement[0],o.movement[1])));return`${(a+l)*2}px`}).classed("moved--fwd",o=>o.movement[0]>o.movement[1]).classed("moved--bak",o=>o.movement[1]>o.movement[0])}class Sy{constructor(){this.listeners={}}on(t,n){return this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(n),()=>{this.listeners[t]=this.listeners[t].filter(r=>r!==n)}}emit(t,n){const r=this.listeners[t];if(r)for(const i of r)try{i(n)}catch(s){console.error(`Error in listener for event ${String(t)}:`,s)}}clear(){this.listeners={}}}class bu{constructor(){this.events=new Sy,this.game=zm,this.state=vo(),this.config=jc(),this.tick=0,this.status="WAITING",this.runningInterval=null,this.#e()}getState(){return Ur?Object.freeze({...this.state}):this.state}getConfig(){return Ur?Object.freeze({...this.config}):this.config}async setConfig(t){this.config={...this.config,...t},this.events.emit("CONFIG_UPDATED",{config:this.config})}getPlayer(){return this.state.playerMap.get(this.playerId)??null}getContext(){return{tick:this.tick,status:this.status,playerId:this.playerId,config:this.getConfig()}}getFnContext(){return{S:this.state,E:this.events,P:this.state.playerMap.get(this.playerId),C:this.getContext()}}addPlayer(t){if(this.state.playerMap.has(t.id))return this.state.playerMap.get(t.id);const n=t.score??{userId:t.id,playerName:t.name??`Player ${this.state.playerMap.size+1}`,score:0,tick:0,timestamp:Date.now()},r={name:t.name??`Player ${this.state.playerMap.size+1}`,score:n,color:"#000000",...t,stats:{playerId:t.id,systems:0,ships:0,homeworld:0},isAlive:!0,visitedSystems:new Set,revealedSystems:new Set};return Wc(this.state,r),r}gameStart(){this.status="PLAYING",this.tick=0,this.events.emit("GAME_START",void 0),this.#t()}gameStop(){this.status="FINISHED",this.stopGameLoop()}gameTick(){this.tick++,this.game.gameTick(this.getFnContext()),this.game.checkVictory(this.getFnContext()),this.events.emit("STATE_UPDATED",{state:this.state,status:this.status})}#t(){if(this.status!=="PLAYING"){this.gameStop();return}this.stopGameLoop(),this.gameTick(),this.events.emit("GAME_TICK",{tick:this.tick}),this.runningInterval=setTimeout(()=>this.#t(),Ih/this.config.timeScale)}startGameLoop(){this.#t()}stopGameLoop(){this.runningInterval&&(clearTimeout(this.runningInterval),this.runningInterval=null)}#e(){this.events.on("GAME_STOP",()=>{this.gameStop()}),this.events.on("TAKE_ORDER",t=>{this.game.takeOrder(this.getFnContext(),t),this.events.emit("STATE_UPDATED",{state:this.state,status:this.status})})}}const Qn=bu,Ey=Symbol("config"),Su=Symbol("state"),My=Symbol("player"),$y=Symbol("context"),Ay=`
<dialog id="helpDialog">
  <article>
    <h2>Introduction</h2>

    <p>
      This is a simple strategy game where you control a number of star
      systems and try to conquer the the Bubble. The Bubble is a cluster of
      star systems connected by hyperspace lanes. You start with one system
      and must expand your control by sending ships to capture other systems.
    </p>

    <h3>Gameplay</h3>
    <ul>
      <li>The game is played in real-time, with each turn lasting 1 second.</li>
      <li>You begin the game controlling one system, your homeworld.</li>
      <li>Each turn, your homeworld and any other inhabited systems you control, will produce an additional ship.
      </li>
      <li>You can send these ships to other systems to capture them.</li>
      <li>Each controlled system receives an additional ship each 25 turns.</li>
      <li>To transfer ships, left click on a system you control and then right click on a target system.</li>
      <li>This will send all available ships, less one, from the source system to the target system.</li>
      <li>Right click on the hyperspace lane between the systems to send half of the available ships.</li>
      <li>If the target system is uninhabited, you will capture it automatically.</li>
      <li>If the target system is controlled by another player, a battle will ensue.</li>
      <li>The player with the most ships on the target system after all ships have arrived will take control of the
        system.</li>
    </ul>
    <h3>Objective</h3>
    <p>
      The goal is to eliminate all other player's homeworlds and control the
      entire Bubble.
    </p>

    <p>
      <a href="https://github.com/Hypercubed/starz">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" stroke="currentColor"
          fill="currentColor" width="24" height="24" viewBox="0 0 24 24">
          <path
            d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z">
          </path>
        </svg>
      </a>
    </p>

    <form method="dialog">
      <button>Exit</button>
    </form>
  </article>
</dialog>
<dialog id="optionsDialog">
  <form id="optionsForm" method="dialog">
    <label for="numBotsInput">
      Number of Bots

      <div class="btn-group" data-toggle="buttons" role="group">
        <label role="button" class="btn btn-primary">
          <input type="radio" name="numBots" id="option1" value="0">
          None
        </label>
        <label role="button" class="btn btn-primary">
          <input type="radio" name="numBots" id="option2" value="1">
          1
        </label>
        <label role="button" class="btn btn-primary">
          <input type="radio" name="numBots" id="option2" value="1">
          2
        </label>
        <label role="button" class="btn btn-primary">
          <input type="radio" name="numBots" id="option3" value="4" checked>
          4
        </label>
        <label role="button" class="btn btn-primary">
          <input type="radio" name="numBots" id="option3" value="8">
          8
        </label>
      </div>

    </label>

    <label for="fowInput">
      Fog of War
      <input name="fow" type="checkbox" role="switch" checked />
    </label>

    <label for="numSystemsInput">
      Bubble Size
      <input name="numSystems" min="0" max="4" step="1" type="range" list="steplist">
      <datalist id="steplist">
        <option value="48">Tiny</option>
        <option value="96"></option>
        <option value="192">Med</option>
        <option value="384"></option>
        <option value="768">Large</option>
      </datalist>
    </label>

    <p />&nbsp;
    <p />
    <button id="optionsOkButton">OK</button>
    <button id="optionsCancelButton" type="reset">Reset</button>
  </form>
</dialog>`;var Iy=Object.defineProperty,Ty=Object.getOwnPropertyDescriptor,Eu=e=>{throw TypeError(e)},_e=(e,t,n,r)=>{for(var i=r>1?void 0:r?Ty(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&Iy(t,n,i),i},ky=(e,t,n)=>t.has(e)||Eu("Cannot "+n),Py=(e,t,n)=>t.has(e)?Eu("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),fl=(e,t,n)=>(ky(e,t,"access private method"),n),Cr,Mu,$u;const Xe=5;let oe=class extends Yt{constructor(){super(...arguments),Py(this,Cr)}async connectedCallback(){super.connectedCallback(),fl(this,Cr,Mu).call(this),fl(this,Cr,$u).call(this)}createRenderRoot(){return this}render(){return _t`
      <dialog id="startDialog" closedby="none">
        <start-dialog-content
          @startClicked=${this.onStart}
        ></start-dialog-content>
      </dialog>
      <dialog id="endDialog">
        <p id="endMessage"></p>
        <form method="dialog">
          <button id="restartButton">Yes</button>
        </form>
      </dialog>
      ${io(Ay)}
      <game-canvas id="app"></game-canvas>
      <tick-box tick="${this.context?.tick}"></tick-box>
      <leaderboard-element></leaderboard-element>
      <message-box></message-box>
      <button id="helpButton" @click=${this.showHelp}>?</button>
    `}showStartDialog(){this.startDialog?.showModal()}onStart(){this.startDialog.close(),this.gameManager.start()}async onKeyup(e){const t=e.target?.tagName;if(!(t==="INPUT"||t==="TEXTAREA")){switch(e.key){case"?":this.showHelp();return;case"Escape":Re(),et();return;case"x":{if(!e.ctrlKey)return;this.gameManager.quit();return}}if(Dl&&e.altKey){e.preventDefault();const{S:n,C:r}=globalThis.gameManager.getFnContext();switch(e.code){case"KeyC":for(const i of n.world.systemMap.values())i.ownerId===r.playerId&&(i.ships*=2);et();return;case"KeyR":Xc(n),et();return;case"NumpadAdd":case"Equal":{const i=Math.min(16,r.config.timeScale*2);globalThis.gameManager.setConfig({timeScale:i}),rn(`Time scale increased to ${r.config.timeScale}x`);return}case"NumpadSubtract":case"Minus":{const i=Math.max(.25,r.config.timeScale/2);globalThis.gameManager.setConfig({timeScale:i}),rn(`Time scale decreased to ${r.config.timeScale}x`);return}}}}}async onKeypress(e){const t=e.target?.tagName;if(!(t==="INPUT"||t==="TEXTAREA"))switch(e.code){case"Space":"pauseToggle"in globalThis.gameManager&&globalThis.gameManager.pauseToggle();return;case"Equal":case"NumpadAdd":ul(1.2),et();return;case"Minus":case"NumpadSubtract":ul(.8),et();return;case"KeyW":We([0,Xe]),et();return;case"KeyA":We([-Xe,0]),et();return;case"KeyS":We([0,-Xe]),et();return;case"KeyD":We([Xe,0]),et();return;case"KeyQ":We([0,0,Xe]),et();break;case"KeyE":We([0,0,-Xe]),et();break;case"KeyH":Fs(),et();return;case"KeyC":dt.last&&(vy(dt.last),et());return;case"KeyP":yy(),Fs(),et();return}}showHelp(){this.helpDialog.showModal()}async showEndGame(e){return this.endDialog.showModal(),this.endDialog.querySelector("p#endMessage").textContent=e,new Promise(t=>{this.endDialog.addEventListener("close",()=>t(!0)),this.endDialog.addEventListener("cancel",()=>t(!1))})}};Cr=new WeakSet;Mu=function(){window.document.addEventListener("keyup",e=>this.onKeyup(e)),window.document.addEventListener("keypress",e=>this.onKeypress(e))};$u=function(){this.config=this.gameManager.getConfig(),this.state=this.gameManager.getState(),this.player=this.gameManager.getPlayer(),this.context=this.gameManager.getContext(),this.gameManager.events.on("GAME_INIT",()=>{this.config=this.gameManager.getConfig(),this.state=this.gameManager.getState(),this.player=this.gameManager.getPlayer(),this.context=this.gameManager.getContext()}),this.gameManager.events.on("CONFIG_UPDATED",({config:e})=>{this.config=e,this.player=this.gameManager.getPlayer(),this.context=this.gameManager.getContext()}),this.gameManager.events.on("STATE_UPDATED",({state:e})=>this.state=e),this.gameManager.events.on("GAME_TICK",()=>{this.context=this.gameManager.getContext()})};_e([Gn({context:Qn}),ro({attribute:!1})],oe.prototype,"gameManager",2);_e([Gn({context:Ey}),Lt()],oe.prototype,"config",2);_e([Gn({context:Su}),Lt()],oe.prototype,"state",2);_e([Gn({context:My}),Lt()],oe.prototype,"player",2);_e([Gn({context:$y}),Lt()],oe.prototype,"context",2);_e([wi("#helpDialog")],oe.prototype,"helpDialog",2);_e([wi("#startDialog")],oe.prototype,"startDialog",2);_e([wi("#endDialog")],oe.prototype,"endDialog",2);oe=_e([Ge("app-root")],oe);var Ny=Object.defineProperty,Cy=Object.getOwnPropertyDescriptor,Au=(e,t,n,r)=>{for(var i=r>1?void 0:r?Cy(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&Ny(t,n,i),i};const Oy=Si(".3~s");let qs=class extends Yt{createRenderRoot(){return this}render(){return _t`
      <table id="leaderbox">
        ${this.renderHeader()} ${this.renderBody()}
      </table>
    `}renderBody(){const e=Array.from(this.state.playerMap.values()).sort((n,r)=>r.stats.systems-n.stats.systems||r.stats.ships-n.stats.ships),t="";return _t`<tbody>
      ${e.map(n=>_t`<tr
            style="--owner-color: ${n.color||null}"
            title="${n.bot?n.bot.name:"Human"}"
            class="${n.isAlive?"":"eliminated"}"
          >
            <td>${t}${n.name}${t}</td>
            <td>${t}${n.stats.systems}${t}</td>
            <td>${t}${Oy(n.stats.ships)}${t}</td>
          </tr>`)}
    </tbody>`}renderHeader(){return _t`<thead>
        <tr>
          <th>Player</th>
          <th>Systems</th>
          <th>Ships</th>
        </tr>
      </thead>
      <tbody></tbody>`}};Au([Vn({context:Su,subscribe:!0}),Lt()],qs.prototype,"state",2);qs=Au([Ge("leaderboard-element")],qs);var Gs;try{Gs=new TextDecoder}catch{}var H,se,P=0,it={},Z,Me,zt=0,ne=0,mt,pe,kt=[],K,dl={useRecords:!1,mapsAsObjects:!0};class Iu{}const Tu=new Iu;Tu.name="MessagePack 0xC1";var $e=!1,ku=2,Ly;try{new Function("")}catch{ku=1/0}class qn{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(H)return Ru(()=>(js(),this?this.unpack(t,n):qn.prototype.unpack.call(dl,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof Buffer<"u"?Buffer.from(t):new Uint8Array(t)),typeof n=="object"?(se=n.end||t.length,P=n.start||0):(P=0,se=n>-1?n:t.length),ne=0,Me=null,mt=null,H=t;try{K=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw H=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof qn){if(it=this,this.structures)return Z=this.structures,wr(n);(!Z||Z.length>0)&&(Z=[])}else it=dl,(!Z||Z.length>0)&&(Z=[]);return wr(n)}unpackMultiple(t,n){let r,i=0;try{$e=!0;let s=t.length,o=this?this.unpack(t,s):ki.unpack(t,s);if(n){if(n(o,i,P)===!1)return;for(;P<s;)if(i=P,n(wr(),i,P)===!1)return}else{for(r=[o];P<s;)i=P,r.push(wr());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{$e=!1,js()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function wr(e){try{if(!it.trusted&&!$e){let n=Z.sharedLength||0;n<Z.length&&(Z.length=n)}let t;if(it.randomAccessStructure&&H[P]<64&&H[P]>=32&&Ly||(t=ut()),mt&&(P=mt.postBundlePosition,mt=null),$e&&(Z.restoreStructures=null),P==se)Z&&Z.restoreStructures&&pl(),Z=null,H=null,pe&&(pe=null);else{if(P>se)throw new Error("Unexpected end of MessagePack data");if(!$e){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw Z&&Z.restoreStructures&&pl(),js(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||P>se)&&(t.incomplete=!0),t}}function pl(){for(let e in Z.restoreStructures)Z[e]=Z.restoreStructures[e];Z.restoreStructures=null}function ut(){let e=H[P++];if(e<160)if(e<128){if(e<64)return e;{let t=Z[e&63]||it.getStructures&&Pu()[e&63];return t?(t.read||(t.read=To(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,it.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Cu();r==="__proto__"&&(r="__proto_"),t[r]=ut()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(ut(),ut());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=ut();return it.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(ne>=P)return Me.slice(P-zt,(P+=t)-zt);if(ne==0&&se<140){let n=t<16?ko(t):Nu(t);if(n!=null)return n}return Vs(t)}else{let t;switch(e){case 192:return null;case 193:return mt?(t=ut(),t>0?mt[1].slice(mt.position1,mt.position1+=t):mt[0].slice(mt.position0,mt.position0-=t)):Tu;case 194:return!1;case 195:return!0;case 196:if(t=H[P++],t===void 0)throw new Error("Unexpected end of buffer");return Ki(t);case 197:return t=K.getUint16(P),P+=2,Ki(t);case 198:return t=K.getUint32(P),P+=4,Ki(t);case 199:return ke(H[P++]);case 200:return t=K.getUint16(P),P+=2,ke(t);case 201:return t=K.getUint32(P),P+=4,ke(t);case 202:if(t=K.getFloat32(P),it.useFloat32>2){let n=Po[(H[P]&127)<<1|H[P+1]>>7];return P+=4,(n*t+(t>0?.5:-.5)>>0)/n}return P+=4,t;case 203:return t=K.getFloat64(P),P+=8,t;case 204:return H[P++];case 205:return t=K.getUint16(P),P+=2,t;case 206:return t=K.getUint32(P),P+=4,t;case 207:return it.int64AsType==="number"?(t=K.getUint32(P)*4294967296,t+=K.getUint32(P+4)):it.int64AsType==="string"?t=K.getBigUint64(P).toString():it.int64AsType==="auto"?(t=K.getBigUint64(P),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=K.getBigUint64(P),P+=8,t;case 208:return K.getInt8(P++);case 209:return t=K.getInt16(P),P+=2,t;case 210:return t=K.getInt32(P),P+=4,t;case 211:return it.int64AsType==="number"?(t=K.getInt32(P)*4294967296,t+=K.getUint32(P+4)):it.int64AsType==="string"?t=K.getBigInt64(P).toString():it.int64AsType==="auto"?(t=K.getBigInt64(P),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=K.getBigInt64(P),P+=8,t;case 212:if(t=H[P++],t==114)return xl(H[P++]&63);{let n=kt[t];if(n)return n.read?(P++,n.read(ut())):n.noBuffer?(P++,n()):n(H.subarray(P,++P));throw new Error("Unknown extension "+t)}case 213:return t=H[P],t==114?(P++,xl(H[P++]&63,H[P++])):ke(2);case 214:return ke(4);case 215:return ke(8);case 216:return ke(16);case 217:return t=H[P++],ne>=P?Me.slice(P-zt,(P+=t)-zt):Dy(t);case 218:return t=K.getUint16(P),P+=2,ne>=P?Me.slice(P-zt,(P+=t)-zt):Uy(t);case 219:return t=K.getUint32(P),P+=4,ne>=P?Me.slice(P-zt,(P+=t)-zt):By(t);case 220:return t=K.getUint16(P),P+=2,ml(t);case 221:return t=K.getUint32(P),P+=4,ml(t);case 222:return t=K.getUint16(P),P+=2,yl(t);case 223:return t=K.getUint32(P),P+=4,yl(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const Ry=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function To(e,t){function n(){if(n.count++>ku){let i=e.read=new Function("r","return function(){return "+(it.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":Ry.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(ut);return e.highByte===0&&(e.read=gl(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=ut()}return it.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?gl(t,n):n}const gl=(e,t)=>function(){let n=H[P++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=Z[r]||Pu()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=To(i,e)),i.read()};function Pu(){let e=Ru(()=>(H=null,it.getStructures()));return Z=it._mergeStructures(e,Z)}var Vs=Zn,Dy=Zn,Uy=Zn,By=Zn;function Zn(e){let t;if(e<16&&(t=ko(e)))return t;if(e>64&&Gs)return Gs.decode(H.subarray(P,P+=e));const n=P+e,r=[];for(t="";P<n;){const i=H[P++];if((i&128)===0)r.push(i);else if((i&224)===192){const s=H[P++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=H[P++]&63,o=H[P++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=H[P++]&63,o=H[P++]&63,a=H[P++]&63;let l=(i&7)<<18|s<<12|o<<6|a;l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|l&1023),r.push(l)}else r.push(i);r.length>=4096&&(t+=gt.apply(String,r),r.length=0)}return r.length>0&&(t+=gt.apply(String,r)),t}function ml(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=ut();return it.freezeData?Object.freeze(t):t}function yl(e){if(it.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Cu();r==="__proto__"&&(r="__proto_"),t[r]=ut()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(ut(),ut());return t}}var gt=String.fromCharCode;function Nu(e){let t=P,n=new Array(e);for(let r=0;r<e;r++){const i=H[P++];if((i&128)>0){P=t;return}n[r]=i}return gt.apply(String,n)}function ko(e){if(e<4)if(e<2){if(e===0)return"";{let t=H[P++];if((t&128)>1){P-=1;return}return gt(t)}}else{let t=H[P++],n=H[P++];if((t&128)>0||(n&128)>0){P-=2;return}if(e<3)return gt(t,n);let r=H[P++];if((r&128)>0){P-=3;return}return gt(t,n,r)}else{let t=H[P++],n=H[P++],r=H[P++],i=H[P++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){P-=4;return}if(e<6){if(e===4)return gt(t,n,r,i);{let s=H[P++];if((s&128)>0){P-=5;return}return gt(t,n,r,i,s)}}else if(e<8){let s=H[P++],o=H[P++];if((s&128)>0||(o&128)>0){P-=6;return}if(e<7)return gt(t,n,r,i,s,o);let a=H[P++];if((a&128)>0){P-=7;return}return gt(t,n,r,i,s,o,a)}else{let s=H[P++],o=H[P++],a=H[P++],l=H[P++];if((s&128)>0||(o&128)>0||(a&128)>0||(l&128)>0){P-=8;return}if(e<10){if(e===8)return gt(t,n,r,i,s,o,a,l);{let u=H[P++];if((u&128)>0){P-=9;return}return gt(t,n,r,i,s,o,a,l,u)}}else if(e<12){let u=H[P++],h=H[P++];if((u&128)>0||(h&128)>0){P-=10;return}if(e<11)return gt(t,n,r,i,s,o,a,l,u,h);let c=H[P++];if((c&128)>0){P-=11;return}return gt(t,n,r,i,s,o,a,l,u,h,c)}else{let u=H[P++],h=H[P++],c=H[P++],g=H[P++];if((u&128)>0||(h&128)>0||(c&128)>0||(g&128)>0){P-=12;return}if(e<14){if(e===12)return gt(t,n,r,i,s,o,a,l,u,h,c,g);{let x=H[P++];if((x&128)>0){P-=13;return}return gt(t,n,r,i,s,o,a,l,u,h,c,g,x)}}else{let x=H[P++],E=H[P++];if((x&128)>0||(E&128)>0){P-=14;return}if(e<15)return gt(t,n,r,i,s,o,a,l,u,h,c,g,x,E);let A=H[P++];if((A&128)>0){P-=15;return}return gt(t,n,r,i,s,o,a,l,u,h,c,g,x,E,A)}}}}}function wl(){let e=H[P++],t;if(e<192)t=e-160;else switch(e){case 217:t=H[P++];break;case 218:t=K.getUint16(P),P+=2;break;case 219:t=K.getUint32(P),P+=4;break;default:throw new Error("Expected string")}return Zn(t)}function Ki(e){return it.copyBuffers?Uint8Array.prototype.slice.call(H,P,P+=e):H.subarray(P,P+=e)}function ke(e){let t=H[P++];if(kt[t]){let n;return kt[t](H.subarray(P,n=P+=e),r=>{P=r;try{return ut()}finally{P=n}})}else throw new Error("Unknown extension type "+t)}var _l=new Array(4096);function Cu(){let e=H[P++];if(e>=160&&e<192){if(e=e-160,ne>=P)return Me.slice(P-zt,(P+=e)-zt);if(!(ne==0&&se<180))return Vs(e)}else return P--,Ou(ut());let t=(e<<5^(e>1?K.getUint16(P):e>0?H[P]:0))&4095,n=_l[t],r=P,i=P+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=K.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=H[r++],s!=n[o++]){r=1879048192;break}if(r===i)return P=r,n.string;i-=3,r=P}for(n=[],_l[t]=n,n.bytes=e;r<i;)s=K.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=H[r++],n.push(s);let a=e<16?ko(e):Nu(e);return a!=null?n.string=a:n.string=Vs(e)}function Ou(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";if(it.allowArraysInMapKeys&&Array.isArray(e)&&e.flat().every(t=>["string","number","boolean","bigint"].includes(typeof t)))return e.flat().toString();throw new Error(`Invalid property type for record: ${typeof e}`)}const xl=(e,t)=>{let n=ut().map(Ou),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=Z[e];return i&&(i.isShared||$e)&&((Z.restoreStructures||(Z.restoreStructures=[]))[e]=i),Z[e]=n,n.read=To(n,r),n.read()};kt[0]=()=>{};kt[0].noBuffer=!0;kt[66]=e=>{let t=e.byteLength%8||8,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);if(e.byteLength!==t){let r=new DataView(e.buffer,e.byteOffset,e.byteLength),i=(s,o)=>{let a=o-s;if(a<=40){let c=r.getBigUint64(s);for(let g=s+8;g<o;g+=8)c<<=64n,c|=r.getBigUint64(g);return c}let l=s+(a>>4<<3),u=i(s,l),h=i(l,o);return u<<BigInt((o-l)*8)|h};n=n<<BigInt((r.byteLength-t)*8)|i(t,r.byteLength)}return n};let vl={Error,EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,AggregateError:typeof AggregateError=="function"?AggregateError:null};kt[101]=()=>{let e=ut();if(!vl[e[0]]){let t=Error(e[1],{cause:e[2]});return t.name=e[0],t}return vl[e[0]](e[1],{cause:e[2]})};kt[105]=e=>{if(it.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=K.getUint32(P-4);pe||(pe=new Map);let n=H[P],r;n>=144&&n<160||n==220||n==221?r=[]:n>=128&&n<144||n==222||n==223?r=new Map:(n>=199&&n<=201||n>=212&&n<=216)&&H[P+1]===115?r=new Set:r={};let i={target:r};pe.set(t,i);let s=ut();if(i.used)Object.assign(r,s);else return i.target=s;if(r instanceof Map)for(let[o,a]of s.entries())r.set(o,a);if(r instanceof Set)for(let o of Array.from(s))r.add(o);return r};kt[112]=e=>{if(it.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=K.getUint32(P-4),n=pe.get(t);return n.used=!0,n.target};kt[115]=()=>new Set(ut());const Lu=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let zy=typeof globalThis=="object"?globalThis:window;kt[116]=e=>{let t=e[0],n=Uint8Array.prototype.slice.call(e,1).buffer,r=Lu[t];if(!r){if(t===16)return n;if(t===17)return new DataView(n);throw new Error("Could not find typed array for code "+t)}return new zy[r](n)};kt[120]=()=>{let e=ut();return new RegExp(e[0],e[1])};const Fy=[];kt[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=P;return P+=t-e.length,mt=Fy,mt=[wl(),wl()],mt.position0=0,mt.position1=0,mt.postBundlePosition=P,P=n,ut()};kt[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function Ru(e){let t=se,n=P,r=zt,i=ne,s=Me,o=pe,a=mt,l=new Uint8Array(H.slice(0,se)),u=Z,h=Z.slice(0,Z.length),c=it,g=$e,x=e();return se=t,P=n,zt=r,ne=i,Me=s,pe=o,mt=a,H=l,$e=g,Z=u,Z.splice(0,Z.length,...h),it=c,K=new DataView(H.buffer,H.byteOffset,H.byteLength),x}function js(){H=null,pe=null,Z=null}const Po=new Array(147);for(let e=0;e<256;e++)Po[e]=+("1e"+Math.floor(45.15-e*.30103));var ki=new qn({useRecords:!1});const Hy=ki.unpack;ki.unpackMultiple;ki.unpack;let qy=new Float32Array(1);new Uint8Array(qy.buffer,0,4);let Or;try{Or=new TextEncoder}catch{}let Ws,Xs;const fn=typeof Buffer<"u",_r=fn?function(e){return Buffer.allocUnsafeSlow(e)}:Uint8Array,Du=fn?Buffer:Uint8Array,bl=fn?4294967296:2144337920;let R,xn,rt,N=0,wt,at=null,Gy;const Vy=21760,jy=/[\u0080-\uFFFF]/,Ye=Symbol("record-id");class Wy extends qn{constructor(t){super(t),this.offset=0;let n,r,i,s,o=Du.prototype.utf8Write?function(m,p){return R.utf8Write(m,p,R.byteLength-p)}:Or&&Or.encodeInto?function(m,p){return Or.encodeInto(m,R.subarray(p)).written}:!1,a=this;t||(t={});let l=t&&t.sequential,u=t.structures||t.saveStructures,h=t.maxSharedStructures;if(h==null&&(h=u?32:0),h>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let c=t.maxOwnStructures;c==null&&(c=u?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let g=h>32||c+h>64,x=h+64,E=h+c+64;if(E>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let A=[],C=0,T=0;this.pack=this.encode=function(m,p){if(R||(R=new _r(8192),rt=R.dataView||(R.dataView=new DataView(R.buffer,0,8192)),N=0),wt=R.length-10,wt-N<2048?(R=new _r(R.length),rt=R.dataView||(R.dataView=new DataView(R.buffer,0,R.length)),wt=R.length-10,N=0):N=N+7&2147483640,n=N,p&Zy&&(N+=p&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof m!="string"?(at=[],at.size=1/0):at=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let d=i.sharedLength||0;if(d>h)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let _=0;_<d;_++){let S=i[_];if(!S)continue;let $,O=i.transitions;for(let U=0,F=S.length;U<F;U++){let G=S[U];$=O[G],$||($=O[G]=Object.create(null)),O=$}O[Ye]=_+64}this.lastNamedStructuresLength=d}l||(i.nextId=d+64)}r&&(r=!1);let f;try{a.randomAccessStructure&&m&&typeof m=="object"?m.constructor===Object?M(m):m.constructor!==Map&&!Array.isArray(m)&&!Xs.some(_=>m instanceof _)?M(m.toJSON?m.toJSON():m):k(m):k(m);let d=at;if(at&&El(n,k,0),s&&s.idsToInsert){let _=s.idsToInsert.sort((U,F)=>U.offset>F.offset?1:-1),S=_.length,$=-1;for(;d&&S>0;){let U=_[--S].offset+n;U<d.stringsPosition+n&&$===-1&&($=0),U>d.position+n?$>=0&&($+=6):($>=0&&(rt.setUint32(d.position+n,rt.getUint32(d.position+n)+$),$=-1),d=d.previous,S++)}$>=0&&d&&rt.setUint32(d.position+n,rt.getUint32(d.position+n)+$),N+=_.length*6,N>wt&&w(N),a.offset=N;let O=Xy(R.subarray(n,N),_);return s=null,O}return a.offset=N,p&Ky?(R.start=n,R.end=N,R):R.subarray(n,N)}catch(d){throw f=d,d}finally{if(i&&(I(),r&&a.saveStructures)){let d=i.sharedLength||0,_=R.subarray(n,N),S=Yy(i,a);if(!f)return a.saveStructures(S,S.isCompatible)===!1?a.pack(m,p):(a.lastNamedStructuresLength=d,R.length>1073741824&&(R=null),_)}R.length>1073741824&&(R=null),p&Qy&&(N=n)}};const I=()=>{T<10&&T++;let m=i.sharedLength||0;if(i.length>m&&!l&&(i.length=m),C>1e4)i.transitions=null,T=0,C=0,A.length>0&&(A=[]);else if(A.length>0&&!l){for(let p=0,f=A.length;p<f;p++)A[p][Ye]=0;A=[]}},L=m=>{var p=m.length;p<16?R[N++]=144|p:p<65536?(R[N++]=220,R[N++]=p>>8,R[N++]=p&255):(R[N++]=221,rt.setUint32(N,p),N+=4);for(let f=0;f<p;f++)k(m[f])},k=m=>{N>wt&&(R=w(N));var p=typeof m,f;if(p==="string"){let d=m.length;if(at&&d>=4&&d<4096){if((at.size+=d)>Vy){let O,U=(at[0]?at[0].length*3+at[1].length:0)+10;N+U>wt&&(R=w(N+U));let F;at.position?(F=at,R[N]=200,N+=3,R[N++]=98,O=N-n,N+=4,El(n,k,0),rt.setUint16(O+n-3,N-n-O)):(R[N++]=214,R[N++]=98,O=N-n,N+=4),at=["",""],at.previous=F,at.size=0,at.position=O}let $=jy.test(m);at[$?0:1]+=m,R[N++]=193,k($?-d:d);return}let _;d<32?_=1:d<256?_=2:d<65536?_=3:_=5;let S=d*3;if(N+S>wt&&(R=w(N+S)),d<64||!o){let $,O,U,F=N+_;for($=0;$<d;$++)O=m.charCodeAt($),O<128?R[F++]=O:O<2048?(R[F++]=O>>6|192,R[F++]=O&63|128):(O&64512)===55296&&((U=m.charCodeAt($+1))&64512)===56320?(O=65536+((O&1023)<<10)+(U&1023),$++,R[F++]=O>>18|240,R[F++]=O>>12&63|128,R[F++]=O>>6&63|128,R[F++]=O&63|128):(R[F++]=O>>12|224,R[F++]=O>>6&63|128,R[F++]=O&63|128);f=F-N-_}else f=o(m,N+_);f<32?R[N++]=160|f:f<256?(_<2&&R.copyWithin(N+2,N+1,N+1+f),R[N++]=217,R[N++]=f):f<65536?(_<3&&R.copyWithin(N+3,N+2,N+2+f),R[N++]=218,R[N++]=f>>8,R[N++]=f&255):(_<5&&R.copyWithin(N+5,N+3,N+3+f),R[N++]=219,rt.setUint32(N,f),N+=4),N+=f}else if(p==="number")if(m>>>0===m)m<32||m<128&&this.useRecords===!1||m<64&&!this.randomAccessStructure?R[N++]=m:m<256?(R[N++]=204,R[N++]=m):m<65536?(R[N++]=205,R[N++]=m>>8,R[N++]=m&255):(R[N++]=206,rt.setUint32(N,m),N+=4);else if(m>>0===m)m>=-32?R[N++]=256+m:m>=-128?(R[N++]=208,R[N++]=m+256):m>=-32768?(R[N++]=209,rt.setInt16(N,m),N+=2):(R[N++]=210,rt.setInt32(N,m),N+=4);else{let d;if((d=this.useFloat32)>0&&m<4294967296&&m>=-2147483648){R[N++]=202,rt.setFloat32(N,m);let _;if(d<4||(_=m*Po[(R[N]&127)<<1|R[N+1]>>7])>>0===_){N+=4;return}else N--}R[N++]=203,rt.setFloat64(N,m),N+=8}else if(p==="object"||p==="function")if(!m)R[N++]=192;else{if(s){let _=s.get(m);if(_){if(!_.id){let S=s.idsToInsert||(s.idsToInsert=[]);_.id=S.push(_)}R[N++]=214,R[N++]=112,rt.setUint32(N,_.id),N+=4;return}else s.set(m,{offset:N-n})}let d=m.constructor;if(d===Object)y(m);else if(d===Array)L(m);else if(d===Map)if(this.mapAsEmptyObject)R[N++]=128;else{f=m.size,f<16?R[N++]=128|f:f<65536?(R[N++]=222,R[N++]=f>>8,R[N++]=f&255):(R[N++]=223,rt.setUint32(N,f),N+=4);for(let[_,S]of m)k(_),k(S)}else{for(let _=0,S=Ws.length;_<S;_++){let $=Xs[_];if(m instanceof $){let O=Ws[_];if(O.write){O.type&&(R[N++]=212,R[N++]=O.type,R[N++]=0);let q=O.write.call(this,m);q===m?Array.isArray(m)?L(m):y(m):k(q);return}let U=R,F=rt,G=N;R=null;let V;try{V=O.pack.call(this,m,q=>(R=U,U=null,N+=q,N>wt&&w(N),{target:R,targetView:rt,position:N-q}),k)}finally{U&&(R=U,rt=F,N=G,wt=R.length-10)}V&&(V.length+N>wt&&w(V.length+N),N=Sl(V,R,N,O.type));return}}if(Array.isArray(m))L(m);else{if(m.toJSON){const _=m.toJSON();if(_!==m)return k(_)}if(p==="function")return k(this.writeFunction&&this.writeFunction(m));y(m)}}}else if(p==="boolean")R[N++]=m?195:194;else if(p==="bigint"){if(m<9223372036854776e3&&m>=-9223372036854776e3)R[N++]=211,rt.setBigInt64(N,m);else if(m<18446744073709552e3&&m>0)R[N++]=207,rt.setBigUint64(N,m);else if(this.largeBigIntToFloat)R[N++]=203,rt.setFloat64(N,Number(m));else{if(this.largeBigIntToString)return k(m.toString());if(this.useBigIntExtension||this.moreTypes){let d=m<0?BigInt(-1):BigInt(0),_;if(m>>BigInt(65536)===d){let S=BigInt(18446744073709552e3)-BigInt(1),$=[];for(;$.push(m&S),m>>BigInt(63)!==d;)m>>=BigInt(64);_=new Uint8Array(new BigUint64Array($).buffer),_.reverse()}else{let S=m<0,$=(S?~m:m).toString(16);if($.length%2?$="0"+$:parseInt($.charAt(0),16)>=8&&($="00"+$),fn)_=Buffer.from($,"hex");else{_=new Uint8Array($.length/2);for(let O=0;O<_.length;O++)_[O]=parseInt($.slice(O*2,O*2+2),16)}if(S)for(let O=0;O<_.length;O++)_[O]=~_[O]}_.length+N>wt&&w(_.length+N),N=Sl(_,R,N,66);return}else throw new RangeError(m+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}N+=8}else if(p==="undefined")this.encodeUndefinedAsNil?R[N++]=192:(R[N++]=212,R[N++]=0,R[N++]=0);else throw new Error("Unknown type: "+p)},D=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?m=>{let p;if(this.skipValues){p=[];for(let _ in m)(typeof m.hasOwnProperty!="function"||m.hasOwnProperty(_))&&!this.skipValues.includes(m[_])&&p.push(_)}else p=Object.keys(m);let f=p.length;f<16?R[N++]=128|f:f<65536?(R[N++]=222,R[N++]=f>>8,R[N++]=f&255):(R[N++]=223,rt.setUint32(N,f),N+=4);let d;if(this.coercibleKeyAsNumber)for(let _=0;_<f;_++){d=p[_];let S=Number(d);k(isNaN(S)?d:S),k(m[d])}else for(let _=0;_<f;_++)k(d=p[_]),k(m[d])}:m=>{R[N++]=222;let p=N-n;N+=2;let f=0;for(let d in m)(typeof m.hasOwnProperty!="function"||m.hasOwnProperty(d))&&(k(d),k(m[d]),f++);if(f>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');R[p+++n]=f>>8,R[p+n]=f&255},B=this.useRecords===!1?D:t.progressiveRecords&&!g?m=>{let p,f=i.transitions||(i.transitions=Object.create(null)),d=N++-n,_;for(let S in m)if(typeof m.hasOwnProperty!="function"||m.hasOwnProperty(S)){if(p=f[S],p)f=p;else{let $=Object.keys(m),O=f;f=i.transitions;let U=0;for(let F=0,G=$.length;F<G;F++){let V=$[F];p=f[V],p||(p=f[V]=Object.create(null),U++),f=p}d+n+1==N?(N--,v(f,$,U)):b(f,$,d,U),_=!0,f=O[S]}k(m[S])}if(!_){let S=f[Ye];S?R[d+n]=S:b(f,Object.keys(m),d,0)}}:m=>{let p,f=i.transitions||(i.transitions=Object.create(null)),d=0;for(let S in m)(typeof m.hasOwnProperty!="function"||m.hasOwnProperty(S))&&(p=f[S],p||(p=f[S]=Object.create(null),d++),f=p);let _=f[Ye];_?_>=96&&g?(R[N++]=((_-=96)&31)+96,R[N++]=_>>5):R[N++]=_:v(f,f.__keys__||Object.keys(m),d);for(let S in m)(typeof m.hasOwnProperty!="function"||m.hasOwnProperty(S))&&k(m[S])},z=typeof this.useRecords=="function"&&this.useRecords,y=z?m=>{z(m)?B(m):D(m)}:B,w=m=>{let p;if(m>16777216){if(m-n>bl)throw new Error("Packed buffer would be larger than maximum buffer size");p=Math.min(bl,Math.round(Math.max((m-n)*(m>67108864?1.25:2),4194304)/4096)*4096)}else p=(Math.max(m-n<<2,R.length-1)>>12)+1<<12;let f=new _r(p);return rt=f.dataView||(f.dataView=new DataView(f.buffer,0,p)),m=Math.min(m,R.length),R.copy?R.copy(f,0,n,m):f.set(R.slice(n,m)),N-=n,n=0,wt=f.length-10,R=f},v=(m,p,f)=>{let d=i.nextId;d||(d=64),d<x&&this.shouldShareStructure&&!this.shouldShareStructure(p)?(d=i.nextOwnId,d<E||(d=x),i.nextOwnId=d+1):(d>=E&&(d=x),i.nextId=d+1);let _=p.highByte=d>=96&&g?d-96>>5:-1;m[Ye]=d,m.__keys__=p,i[d-64]=p,d<x?(p.isShared=!0,i.sharedLength=d-63,r=!0,_>=0?(R[N++]=(d&31)+96,R[N++]=_):R[N++]=d):(_>=0?(R[N++]=213,R[N++]=114,R[N++]=(d&31)+96,R[N++]=_):(R[N++]=212,R[N++]=114,R[N++]=d),f&&(C+=T*f),A.length>=c&&(A.shift()[Ye]=0),A.push(m),k(p))},b=(m,p,f,d)=>{let _=R,S=N,$=wt,O=n;R=xn,N=0,n=0,R||(xn=R=new _r(8192)),wt=R.length-10,v(m,p,d),xn=R;let U=N;if(R=_,N=S,wt=$,n=O,U>1){let F=N+U-1;F>wt&&w(F);let G=f+n;R.copyWithin(G+U,G+1,N),R.set(xn.slice(0,U),G),N=F}else R[f+n]=xn[0]},M=m=>{let p=Gy(m,R,n,N,i,w,(f,d,_)=>{if(_)return r=!0;N=d;let S=R;return k(f),I(),S!==R?{position:N,targetView:rt,target:R}:N},this);if(p===0)return y(m);N=p}}useBuffer(t){R=t,R.dataView||(R.dataView=new DataView(R.buffer,R.byteOffset,R.byteLength)),rt=R.dataView,N=0}set position(t){N=t}get position(){return N}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}Xs=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,DataView,Iu];Ws=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?Qi(e,16,t):Zi(fn?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==Du&&this.moreTypes?Qi(e,Lu.indexOf(n.name),t):Zi(e,t)}},{pack(e,t){this.moreTypes?Qi(e,17,t):Zi(fn?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function Qi(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function Zi(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function Sl(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function Xy(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function El(e,t,n){if(at.length>0){rt.setUint32(at.position+e,N+n-at.position-e),at.stringsPosition=N-e;let r=at;at=null,t(r[0]),t(r[1])}}function Yy(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let Uu=new Wy({useRecords:!1});Uu.pack;Uu.pack;const Ky=512,Qy=1024,Zy=2048;(!globalThis.EventTarget||!globalThis.Event)&&console.error(`
  PartySocket requires a global 'EventTarget' class to be available!
  You can polyfill this global by adding this to your code before any partysocket imports: 
  
  \`\`\`
  import 'partysocket/event-target-polyfill';
  \`\`\`
  Please file an issue at https://github.com/partykit/partykit if you're still having trouble.
`);var Bu=class extends Event{message;error;constructor(e,t){super("error",t),this.message=e.message,this.error=e}},zu=class extends Event{code;reason;wasClean=!0;constructor(e=1e3,t="",n){super("close",n),this.code=e,this.reason=t}};const Ji={Event,ErrorEvent:Bu,CloseEvent:zu};function Jy(e,t){if(!e)throw new Error(t)}function t1(e){return new e.constructor(e.type,e)}function e1(e){return"data"in e?new MessageEvent(e.type,e):"code"in e||"reason"in e?new zu(e.code||1999,e.reason||"unknown reason",e):"error"in e?new Bu(e.error,e):new Event(e.type,e)}const xr=typeof process<"u"&&typeof process.versions?.node<"u"&&typeof document>"u"?e1:t1,Pe={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:Number.POSITIVE_INFINITY,maxEnqueuedMessages:Number.POSITIVE_INFINITY};let Ml=!1;var n1=class Ne extends EventTarget{_ws;_retryCount=-1;_uptimeTimeout;_connectTimeout;_shouldReconnect=!0;_connectLock=!1;_binaryType="blob";_closeCalled=!1;_messageQueue=[];_debugLogger=console.log.bind(console);_url;_protocols;_options;constructor(t,n,r={}){super(),this._url=t,this._protocols=n,this._options=r,this._options.startClosed&&(this._shouldReconnect=!1),this._options.debugLogger&&(this._debugLogger=this._options.debugLogger),this._connect()}static get CONNECTING(){return 0}static get OPEN(){return 1}static get CLOSING(){return 2}static get CLOSED(){return 3}get CONNECTING(){return Ne.CONNECTING}get OPEN(){return Ne.OPEN}get CLOSING(){return Ne.CLOSING}get CLOSED(){return Ne.CLOSED}get binaryType(){return this._ws?this._ws.binaryType:this._binaryType}set binaryType(t){this._binaryType=t,this._ws&&(this._ws.binaryType=t)}get retryCount(){return Math.max(this._retryCount,0)}get bufferedAmount(){return this._messageQueue.reduce((t,n)=>(typeof n=="string"?t+=n.length:n instanceof Blob?t+=n.size:t+=n.byteLength,t),0)+(this._ws?this._ws.bufferedAmount:0)}get extensions(){return this._ws?this._ws.extensions:""}get protocol(){return this._ws?this._ws.protocol:""}get readyState(){return this._ws?this._ws.readyState:this._options.startClosed?Ne.CLOSED:Ne.CONNECTING}get url(){return this._ws?this._ws.url:""}get shouldReconnect(){return this._shouldReconnect}onclose=null;onerror=null;onmessage=null;onopen=null;close(t=1e3,n){if(this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(t,n)}reconnect(t,n){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(t,n),this._connect())}send(t){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",t),this._ws.send(t);else{const{maxEnqueuedMessages:n=Pe.maxEnqueuedMessages}=this._options;this._messageQueue.length<n&&(this._debug("enqueue",t),this._messageQueue.push(t))}}_debug(...t){this._options.debug&&this._debugLogger("RWS>",...t)}_getNextDelay(){const{reconnectionDelayGrowFactor:t=Pe.reconnectionDelayGrowFactor,minReconnectionDelay:n=Pe.minReconnectionDelay,maxReconnectionDelay:r=Pe.maxReconnectionDelay}=this._options;let i=0;return this._retryCount>0&&(i=n*t**(this._retryCount-1),i>r&&(i=r)),this._debug("next delay",i),i}_wait(){return new Promise(t=>{setTimeout(t,this._getNextDelay())})}_getNextProtocols(t){if(!t)return Promise.resolve(null);if(typeof t=="string"||Array.isArray(t))return Promise.resolve(t);if(typeof t=="function"){const n=t();if(!n)return Promise.resolve(null);if(typeof n=="string"||Array.isArray(n))return Promise.resolve(n);if(n.then)return n}throw Error("Invalid protocols")}_getNextUrl(t){if(typeof t=="string")return Promise.resolve(t);if(typeof t=="function"){const n=t();if(typeof n=="string")return Promise.resolve(n);if(n.then)return n}throw Error("Invalid URL")}_connect(){if(this._connectLock||!this._shouldReconnect)return;this._connectLock=!0;const{maxRetries:t=Pe.maxRetries,connectionTimeout:n=Pe.connectionTimeout}=this._options;if(this._retryCount>=t){this._debug("max retries reached",this._retryCount,">=",t);return}this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),this._wait().then(()=>Promise.all([this._getNextUrl(this._url),this._getNextProtocols(this._protocols||null)])).then(([r,i])=>{if(this._closeCalled){this._connectLock=!1;return}!this._options.WebSocket&&typeof WebSocket>"u"&&!Ml&&(console.error(` No WebSocket implementation available. You should define options.WebSocket. 

For example, if you're using node.js, run \`npm install ws\`, and then in your code:

import PartySocket from 'partysocket';
import WS from 'ws';

const partysocket = new PartySocket({
  host: "127.0.0.1:1999",
  room: "test-room",
  WebSocket: WS
});

`),Ml=!0);const s=this._options.WebSocket||WebSocket;this._debug("connect",{url:r,protocols:i}),this._ws=i?new s(r,i):new s(r),this._ws.binaryType=this._binaryType,this._connectLock=!1,this._addListeners(),this._connectTimeout=setTimeout(()=>this._handleTimeout(),n)}).catch(r=>{this._connectLock=!1,this._handleError(new Ji.ErrorEvent(Error(r.message),this))})}_handleTimeout(){this._debug("timeout event"),this._handleError(new Ji.ErrorEvent(Error("TIMEOUT"),this))}_disconnect(t=1e3,n){if(this._clearTimeouts(),!!this._ws){this._removeListeners();try{(this._ws.readyState===this.OPEN||this._ws.readyState===this.CONNECTING)&&this._ws.close(t,n),this._handleClose(new Ji.CloseEvent(t,n,this))}catch{}}}_acceptOpen(){this._debug("accept open"),this._retryCount=0}_handleOpen=t=>{this._debug("open event");const{minUptime:n=Pe.minUptime}=this._options;clearTimeout(this._connectTimeout),this._uptimeTimeout=setTimeout(()=>this._acceptOpen(),n),Jy(this._ws,"WebSocket is not defined"),this._ws.binaryType=this._binaryType,this._messageQueue.forEach(r=>{this._ws?.send(r)}),this._messageQueue=[],this.onopen&&this.onopen(t),this.dispatchEvent(xr(t))};_handleMessage=t=>{this._debug("message event"),this.onmessage&&this.onmessage(t),this.dispatchEvent(xr(t))};_handleError=t=>{this._debug("error event",t.message),this._disconnect(void 0,t.message==="TIMEOUT"?"timeout":void 0),this.onerror&&this.onerror(t),this._debug("exec error listeners"),this.dispatchEvent(xr(t)),this._connect()};_handleClose=t=>{this._debug("close event"),this._clearTimeouts(),this._shouldReconnect&&this._connect(),this.onclose&&this.onclose(t),this.dispatchEvent(xr(t))};_removeListeners(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))}_addListeners(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))}_clearTimeouts(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)}};const r1=e=>e[1]!==null&&e[1]!==void 0;function i1(){if(crypto?.randomUUID)return crypto.randomUUID();let e=Date.now(),t=performance?.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){let r=Math.random()*16;return e>0?(r=(e+r)%16|0,e=Math.floor(e/16)):(r=(t+r)%16|0,t=Math.floor(t/16)),(n==="x"?r:r&3|8).toString(16)})}function Fu(e,t,n={}){const{host:r,path:i,protocol:s,room:o,party:a,basePath:l,prefix:u,query:h}=e;let c=r.replace(/^(http|https|ws|wss):\/\//,"");if(c.endsWith("/")&&(c=c.slice(0,-1)),i?.startsWith("/"))throw new Error("path must not start with a slash");const g=a??"main",x=i?`/${i}`:"",E=s||(c.startsWith("localhost:")||c.startsWith("127.0.0.1:")||c.startsWith("192.168.")||c.startsWith("10.")||c.startsWith("172.")&&c.split(".")[1]>="16"&&c.split(".")[1]<="31"||c.startsWith("[::ffff:7f00:1]:")?t:`${t}s`),A=`${E}://${c}/${l||`${u||"parties"}/${g}/${o}`}${x}`,C=(I={})=>`${A}?${new URLSearchParams([...Object.entries(n),...Object.entries(I).filter(r1)])}`,T=typeof h=="function"?async()=>C(await h()):C(h);return{host:c,path:x,room:o,name:g,protocol:E,partyUrl:A,urlProvider:T}}var vr=class extends n1{_pk;_pkurl;name;room;host;path;constructor(e){const t=$l(e);super(t.urlProvider,t.protocols,t.socketOptions),this.partySocketOptions=e,this.setWSProperties(t),e.disableNameValidation||(e.party?.includes("/")&&console.warn(`PartySocket: party name "${e.party}" contains forward slash which may cause routing issues. Consider using a name without forward slashes or set disableNameValidation: true to bypass this warning.`),e.room?.includes("/")&&console.warn(`PartySocket: room name "${e.room}" contains forward slash which may cause routing issues. Consider using a name without forward slashes or set disableNameValidation: true to bypass this warning.`))}updateProperties(e){const t=$l({...this.partySocketOptions,...e,host:e.host??this.host,room:e.room??this.room,path:e.path??this.path});this._url=t.urlProvider,this._protocols=t.protocols,this._options=t.socketOptions,this.setWSProperties(t)}setWSProperties(e){const{_pk:t,_pkurl:n,name:r,room:i,host:s,path:o}=e;this._pk=t,this._pkurl=n,this.name=r,this.room=i,this.host=s,this.path=o}reconnect(e,t){if(!this.room||!this.host)throw new Error("The room and host must be set before connecting, use `updateProperties` method to set them or pass them to the constructor.");super.reconnect(e,t)}get id(){return this._pk}get roomUrl(){return this._pkurl}static async fetch(e,t){const n=Fu(e,"http"),r=typeof n.urlProvider=="string"?n.urlProvider:await n.urlProvider();return(e.fetch??fetch)(r,t)}};function $l(e){const{id:t,host:n,path:r,party:i,room:s,protocol:o,query:a,protocols:l,...u}=e,h=t||i1(),c=Fu(e,"ws",{_pk:h});return{_pk:h,_pkurl:c.partyUrl,name:c.name,room:c.room,host:c.host,path:c.path,protocols:l,socketOptions:u,urlProvider:c.urlProvider}}let s1=e=>crypto.getRandomValues(new Uint8Array(e)),o1=(e,t,n)=>{let r=(2<<Math.log(e.length-1)/Math.LN2)-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),l=i|0;for(;l--;)if(o+=e[a[l]&r]||"",o.length===s)return o}}},Hu=(e,t=21)=>o1(e,t,s1);const Al=Mo({length:5});class a1 extends bu{mount(t){this.appRoot=t,this.appRoot.gameManager=this,this.#t()}async connect(){this.gameStop(),this.status="WAITING";const t=await this.initializePlayer();this.thisPlayer=this.addPlayer(t),this.playerId=this.thisPlayer.id,this.events.emit("GAME_INIT",void 0),this.appRoot.showStartDialog()}async start(){localStorage.setItem("starz_playerId",this.playerId),localStorage.setItem("starz_playerName",this.thisPlayer.name),localStorage.setItem("starz_score",this.thisPlayer.score?.toString()??"0"),this.gameSetup(this.thisPlayer),this.gameStart(),et()}gameSetup(t){const n=this.getFnContext();this.state=this.game.setup(n),Wm(),t.name=this.config.playerName;const r=this.onPlayerJoin(1,t);this.game.assignSystem(this.state,t.id);const i=Er+ +this.config.numBots;for(let s=2;s<=i;s++){const o=this.onPlayerJoin(s);this.game.assignSystem(this.state,o.id)}this.setupThisPlayer(r.id),localStorage.setItem("starz_playerId",r.id),localStorage.setItem("starz_playerName",r.name),localStorage.setItem("starz_score",r.score.score.toString())}async initializePlayer(){const t=this.playerId=localStorage.getItem("starz_playerId")??Al(),n=localStorage.getItem("starz_playerName")??this.config.playerName,r=+(localStorage.getItem("starz_score")??0);return localStorage.setItem("starz_playerId",t),localStorage.setItem("starz_playerName",n),localStorage.setItem("starz_score",r.toString()),{id:t,name:n,score:{score:r}}}gameStart(){Oi("starz_gamesStarted"),super.gameStart(),yr("Game started.");const t=this.state.playerMap.get(this.playerId);t&&yr(`You are ${t.name}.`)}gameStop(){super.gameStop(),Re(),et()}onPlayerJoin(t,n={}){const r=zh[t],i=t-Er,s=n.name??`Bot ${i}`,o=Al(),a=t>Er?new Jg({playerIndex:i,id:o,name:s}):void 0;return this.addPlayer({id:o,name:s,bot:a,color:r,...n})}pauseToggle(){this.status==="PAUSED"?(this.status="PLAYING",super.startGameLoop()):this.status==="PLAYING"&&(this.status="PAUSED",super.stopGameLoop())}showEndGame(t){return this.appRoot.showEndGame(t)}async quit(){await this.showEndGame("Are you sure you want to quit?")&&this.game.eliminatePlayer(this.getFnContext(),this.playerId)}async onPlayerWin(t,n){n&&yr(n),this.game.revealAllSystems(this.state),Re();let r=!1;t===this.playerId?(Oi("starz_gamesWon"),r=await this.showEndGame("You have conquered The Bubble!")):(Oi("starz_gamesLost",{winnerId:t}),r=await this.showEndGame("You have lost your homeworld! Click to return to lobby.  ESC to spectate.")),r&&this.restart()}restart(){this.stopGameLoop(),Re(),this.tick=0,this.state=this.game.initalState(),this.connect()}onEliminatePlayer(t,n){const r=this.state.playerMap.get(t),i=this.state.playerMap.get(n),s=n===null?`${r.name} has been eliminated!`:`${i.name} has eliminated ${r.name}!`;yr(s),t===this.playerId?(this.submitWinLoss(-1),this.onPlayerWin(n)):n===this.playerId&&this.submitWinLoss(1)}async submitWinLoss(t){const n=+(localStorage.getItem("starz_score")??0)+t;localStorage.setItem("starz_score",n.toString())}addPlayer(t){const n=super.addPlayer({color:t.color??l1(),...t});return document.documentElement.style.setProperty(`--player-${n.id}`,n.color),n}setupThisPlayer(t){this.playerId=t;const n=this.state.playerMap.get(t),r=this.game.getPlayersHomeworld(this.state);this.game.visitSystem(this.state,r),Fs(),n.bot||(Re(),Hn(r.id))}#t(){this.events.on("PLAYER_WIN",({playerId:t,message:n})=>{this.onPlayerWin(t,n)}),this.events.on("PLAYER_ELIMINATED",({loserId:t,winnerId:n})=>{this.onEliminatePlayer(t,n)})}}function l1(){const e="0123456789ABCDEF";let t="#";for(let n=0;n<6;n++)t+=e[Math.floor(Math.random()*16)];return t}const qu="ABCDEFGHJKLMNPQRSTUVWXYZ234567",c1=Hu(qu,15),u1=Hu(qu,15),br={host:"https://starz.hypercubed.dev/",party:"lobby-server",room:"starz-game-room-leaderboard-prod"};class Gu extends a1{constructor(){super(...arguments),this.user=null}playkitConnect(){this.lobbySocket=new vr(br),this.#t()}async start(){const t=this.state.playerMap.get(this.playerId);t.name=this.user?.name??t.name,t.score={score:this.user?.score??0,rank:this.user?.rank??void 0},t.id=this.user?.uid??t.id,localStorage.setItem("starz_playerToken",this.playerToken),localStorage.setItem("starz_rank",this.user?.rank?.toString()??""),this.state.playerMap.clear(),this.addPlayer(t),super.start()}async setConfig(t){const n=t.playerName;if(n)if(n.includes("::")){const[r,i]=n.split("::");await this.loadPlayer(i,r),delete t.playerName,t.playerName=this.user?.name??this.config.playerName}else this.user??={},this.user.name=n,this.thisPlayer.name=n,localStorage.setItem("starz_playerName",n);await super.setConfig(t)}getHeaders(){return{"Content-Type":"application/json",Authorization:`Bearer ${this.playerToken}`}}async loadPlayer(t,n){this.playerToken=t,this.user??={uid:n},this.user.score??=0;const r=await this.getScore(n);r&&(this.user.uid=n,this.user.score=r.score,this.user.rank=r.rank,this.user.name=r.name,localStorage.setItem("starz_playerToken",this.playerToken),localStorage.setItem("starz_playerId",n),localStorage.setItem("starz_playerName",this.user.name??this.config.playerName),localStorage.setItem("starz_score",this.user.score?.toString()??"0"),localStorage.setItem("starz_rank",this.user.rank?.toString()??""));const i=this.state.playerMap.get(this.playerId);i&&(i.id=n,i.name=this.user.name??i.name,i.score={score:this.user.score??0,rank:this.user.rank??void 0},this.state.playerMap.delete(this.playerId),this.state.playerMap.set(n,i)),this.playerId=n}async initializePlayer(){console.log("Initializing player..."),this.playkitConnect(),this.playerToken=localStorage.getItem("starz_playerToken"),this.playerId=localStorage.getItem("starz_playerId");let t=localStorage.getItem("starz_playerName")??this.config.playerName,n=+(localStorage.getItem("starz_score")??"0"),r=localStorage.getItem("starz_rank")?+localStorage.getItem("starz_rank"):void 0;return this.playerToken&&this.playerId&&(await this.loadPlayer(this.playerToken,this.playerId),this.playerId=this.user?.uid??this.playerId,t=this.user?.name??t,n=this.user?.score??n,r=this.user?.rank??r),this.playerToken??=u1(),this.playerId??=c1(),localStorage.setItem("starz_playerToken",this.playerToken),localStorage.setItem("starz_playerId",this.playerId),localStorage.setItem("starz_playerName",t),localStorage.setItem("starz_score",n.toString()),localStorage.setItem("starz_rank",r?.toString()??""),{id:this.playerId,name:t,score:{score:n,rank:r}}}async getScore(t){return this.lobbySocket?await(await vr.fetch({...br,path:"score",query:{playerId:t}},{method:"GET",headers:this.getHeaders()})).json():void 0}async submitWinLoss(t){if(super.submitWinLoss(t),!this.lobbySocket||t===0)return;console.assert(t===1||t===-1,"deltaScore must be 1 or -1");const n=this.state.playerMap.get(this.playerId);if(!n)return;const r={type:t>0?"increment":"decrement",uid:this.playerId,name:n.name};vr.fetch({...br,path:"score"},{method:"POST",body:JSON.stringify(r),headers:this.getHeaders()})}async loadLeaderboard(){return this.lobbySocket?await(await vr.fetch({...br},{method:"GET",headers:{"Content-Type":"application/json"}})).json():[]}#t(){if(!this.lobbySocket)return null;this.lobbySocket.addEventListener("message",async t=>{const n=t.data instanceof Blob?Hy(await t.data.arrayBuffer()):JSON.parse(t.data);switch(n.type){default:"message"in n?console.log(n.message):"error"in n&&console.error("PartyKit error:",n.error);break}})}}var h1=Object.defineProperty,f1=Object.getOwnPropertyDescriptor,No=(e,t,n,r)=>{for(var i=r>1?void 0:r?f1(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&h1(t,n,i),i};const d1=Si(".3~s");let pi=class extends Yt{constructor(){super(...arguments),this.leaderboard=[]}createRenderRoot(){return this}async connectedCallback(){super.connectedCallback(),this.gameManager instanceof Gu&&(this.leaderboard=await this.gameManager.loadLeaderboard(),this.gameManager.events.on("GAME_INIT",async()=>{this.leaderboard=await this.gameManager.loadLeaderboard(),this.requestUpdate()}))}render(){return _t`
      <table id="leaderbox">
        ${this.renderHeader()} ${this.renderBody()}
      </table>
    `}renderBody(){return _t`<tbody>
      ${this.leaderboard.map(t=>{const n=t.uid?.slice(0,4)??"";return _t`<tr>
            <td>${""}${t.rank}${""}</td>
            <td>${""}${t.name}<span class="short-id">#${n}</span>${""}</td>
            <td>${""}${d1(t.score)}${""}</td>
          </tr>`})}
    </tbody>`}renderHeader(){return _t`<thead>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th></th>
        </tr>
      </thead>
      <tbody></tbody>`}};No([Vn({context:Qn}),Lt()],pi.prototype,"gameManager",2);No([Lt()],pi.prototype,"leaderboard",2);pi=No([Ge("lobby-leaderboard-element")],pi);var p1=Object.defineProperty,g1=Object.getOwnPropertyDescriptor,Vu=(e,t,n,r)=>{for(var i=r>1?void 0:r?g1(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&p1(t,n,i),i};let Ys=class extends Yt{constructor(){super(...arguments),this.tick=0}createRenderRoot(){return this}render(){const e=~~(this.tick/2),t=this.tick%2===1?".":"";return _t`${e}${t}`}};Vu([ro({type:Number})],Ys.prototype,"tick",2);Ys=Vu([Ge("tick-box")],Ys);const m1=`<div class="lore">
  <p>
    Nobody knows why <i>The Bubble</i> exists, or who built the lattice
    of hyperspace lanes threading its hundreds of star systems together
    like a cosmic web. Its discovery was accidental - a distortion
    ripple detected on the edge of settled space, leading explorers to
    the shimmering boundary of a region where physics seemed... wrong.
  </p>
  <p>
    What <i>is</i> known is this: control of <i>The Bubble</i> means
    control of immense resources and power. Rival factions flood its
    systems, each desperate to carve out their claim before somebody
    else does.
  </p>
  <p>
    As a commander, you are the spearhead of your faction's ambitions:
    tasked with expanding your influence, capturing systems, and
    ultimately dominating <i>The Bubble</i>.
  </p>
</div>

<h3>Protect our homeworld. Capture the enemy systems.</h3>`;var y1=Object.defineProperty,w1=Object.getOwnPropertyDescriptor,ju=e=>{throw TypeError(e)},Jn=(e,t,n,r)=>{for(var i=r>1?void 0:r?w1(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&y1(t,n,i),i},_1=(e,t,n)=>t.has(e)||ju("Cannot "+n),x1=(e,t,n)=>t.has(e)?ju("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),v1=(e,t,n)=>(_1(e,t,"access private method"),n),Ks,Wu;let dn=class extends Yt{constructor(){super(...arguments),x1(this,Ks),this.version=Il,this.keyText="Use this key to restore your player data later.  Click to copy."}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),v1(this,Ks,Wu).call(this)}render(){const e=b1(this.player?.id),t=S1(this.player?.id,this.gameManager.playerToken);return _t`
      <lobby-leaderboard-element></lobby-leaderboard-element>
      <article>
        <h1>STARZ!</h1>
        <small class="version">v${this.version}</small>

        ${io(m1)}

        <form method="dialog">
          <div class="grid">
            <div>
              <input
                name="playerName"
                id="playerNameInput"
                type="text"
                .value=${this.player?.name??""}
                @input="${this.onChange}"
                placeholder="Name or Save Key"
                minlength="1"
                maxlength="3000"
                required
              />
              <small>(Name will be used in leaderboard)</small>
            </div>
            <div>
              <span>${this.player?.name??""}</span><span class="short-id">#${e}</span>
              ${this.player?.score?_t`<span> ${this.player.score.score}</span>`:""}
              <br /><small
                >${this.player?.score?.rank?`Rank: ${this.player.score.rank}`:""}</small
              >
              <small
                data-tooltip="${this.keyText}"
                @click="${()=>this.copyText(t)}"
                style="cursor: copy;"
              >
                ${t?"Token":""}</small
              >
            </div>
          </div>

          <br /><button type="button" @click="${this.onPlay}">
            Start Game
          </button>
          <br /><button type="button" @click="${this.onOptions}">
            Options
          </button>
        </form>
      </article>
    `}async onPlay(){let e=this.playerNameInput.value.trim()||"Anonymous";e=e.substring(0,30),await this.gameManager.setConfig({playerName:e}),this.dispatchEvent(new Event("startClicked"))}async onOptions(){if(await this.showOptions()){const t=document.getElementById("optionsForm"),n=new FormData(t),r=globalThis.gameManager,i=+n.get("numBots"),s=n.get("playerName"),o=n.get("fow")==="on",a=+n.get("numSystems");r.setConfig({numBots:i,playerName:s,fow:o,numSystems:48*2**a})}}showOptions(){const e=document.getElementById("optionsDialog");return e.showModal(),new Promise(t=>{e.addEventListener("close",()=>t(!0)),e.addEventListener("cancel",()=>t(!1))})}onChange(e){e.stopPropagation(),e.stopImmediatePropagation(),this.setName(e.target.value)}async setName(e){e=e.trim(),await this.gameManager.setConfig({playerName:e}),this.requestUpdate()}async copyText(e){try{await navigator.clipboard.writeText(e),this.keyText="Copied to clipboard!",this.requestUpdate(),setTimeout(()=>{this.keyText="Use this key to restore your player data later.  Click to copy.",this.requestUpdate()},2e3)}catch{}}};Ks=new WeakSet;Wu=function(){this.player=this.gameManager.getPlayer(),this.gameManager.events.on("CONFIG_UPDATED",()=>{this.player=this.gameManager.getPlayer()}),this.gameManager.events.on("GAME_INIT",()=>{this.player=this.gameManager.getPlayer()})};Jn([Vn({context:Qn}),Lt()],dn.prototype,"gameManager",2);Jn([Lt()],dn.prototype,"player",2);Jn([Lt()],dn.prototype,"version",2);Jn([wi("#playerNameInput")],dn.prototype,"playerNameInput",2);dn=Jn([Ge("start-dialog-content")],dn);function b1(e){return e?.slice(0,4)??""}function S1(e,t){return!e||!t?"":`${e}::${t}`}var E1=Object.defineProperty,M1=Object.getOwnPropertyDescriptor,Co=(e,t,n,r)=>{for(var i=r>1?void 0:r?M1(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&E1(t,n,i),i};let gi=class extends Yt{constructor(){super(...arguments),this.messages=[]}connectedCallback(){super.connectedCallback(),this.gameManager.events.on("MESSAGES_UPDATED",({messages:e})=>{this.messages=(e??[]).slice(-5)})}createRenderRoot(){return this}render(){return this.messages.length>0?_t`${this.messages.map(e=>{const t=~~(e.tick/2),n=e.tick%2===1?".":"";return _t`<div>
          ${io(e.message)} <small>${t}${n}</small>
        </div>`})}`:_t``}};Co([Vn({context:Qn}),Lt()],gi.prototype,"gameManager",2);Co([Lt()],gi.prototype,"messages",2);gi=Co([Ge("message-box")],gi);var $1=Object.defineProperty,A1=Object.getOwnPropertyDescriptor,Xu=(e,t,n,r)=>{for(var i=r>1?void 0:r?A1(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&$1(t,n,i),i};let Qs=class extends Yt{connectedCallback(){super.connectedCallback(),this.gameManager.events.on("GAME_START",()=>{_y(document.getElementById("app"),this.gameManager.getFnContext())}),this.gameManager.events.on("STATE_UPDATED",()=>{et()}),this.gameManager.events.on("GAME_TICK",()=>{et()})}createRenderRoot(){return this}render(){return _t`
      <canvas></canvas>
      <svg></svg>
    `}};Xu([Vn({context:Qn}),Lt()],Qs.prototype,"gameManager",2);Qs=Xu([Ge("game-canvas")],Qs);const Oo=document.createElement("app-root"),Pi=new Gu;globalThis.gameManager=Pi;Oo.gameManager=Pi;document.body.appendChild(Oo);Pi.mount(Oo);console.log(`starz.io version ${Il}`);Pi.connect();

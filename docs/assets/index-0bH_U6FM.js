(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const nl="0.0.6";let rl=class extends Event{constructor(t,n,r,i){super("context-request",{bubbles:!0,composed:!0}),this.context=t,this.contextTarget=n,this.callback=r,this.subscribe=i??!1}};let ho=class{constructor(t,n,r,i){if(this.subscribe=!1,this.provided=!1,this.value=void 0,this.t=(s,o)=>{this.unsubscribe&&(this.unsubscribe!==o&&(this.provided=!1,this.unsubscribe()),this.subscribe||this.unsubscribe()),this.value=s,this.host.requestUpdate(),this.provided&&!this.subscribe||(this.provided=!0,this.callback&&this.callback(s,o)),this.unsubscribe=o},this.host=t,n.context!==void 0){const s=n;this.context=s.context,this.callback=s.callback,this.subscribe=s.subscribe??!1}else this.context=n,this.callback=r,this.subscribe=i??!1;this.host.addController(this)}hostConnected(){this.dispatchRequest()}hostDisconnected(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=void 0)}dispatchRequest(){this.host.dispatchEvent(new rl(this.context,this.host,this.t,this.subscribe))}};let hc=class{get value(){return this.o}set value(t){this.setValue(t)}setValue(t,n=!1){const r=n||!Object.is(t,this.o);this.o=t,r&&this.updateObservers()}constructor(t){this.subscriptions=new Map,this.updateObservers=()=>{for(const[n,{disposer:r}]of this.subscriptions)n(this.o,r)},t!==void 0&&(this.value=t)}addCallback(t,n,r){if(!r)return void t(this.value);this.subscriptions.has(t)||this.subscriptions.set(t,{disposer:()=>{this.subscriptions.delete(t)},consumerHost:n});const{disposer:i}=this.subscriptions.get(t);t(this.value,i)}clearCallbacks(){this.subscriptions.clear()}};let fc=class extends Event{constructor(t,n){super("context-provider",{bubbles:!0,composed:!0}),this.context=t,this.contextTarget=n}},fo=class extends hc{constructor(t,n,r){super(n.context!==void 0?n.initialValue:r),this.onContextRequest=i=>{if(i.context!==this.context)return;const s=i.contextTarget??i.composedPath()[0];s!==this.host&&(i.stopPropagation(),this.addCallback(i.callback,s,i.subscribe))},this.onProviderRequest=i=>{if(i.context!==this.context||(i.contextTarget??i.composedPath()[0])===this.host)return;const s=new Set;for(const[o,{consumerHost:a}]of this.subscriptions)s.has(o)||(s.add(o),a.dispatchEvent(new rl(this.context,a,o,!0)));i.stopPropagation()},this.host=t,n.context!==void 0?this.context=n.context:this.context=n,this.attachListeners(),this.host.addController?.(this)}attachListeners(){this.host.addEventListener("context-request",this.onContextRequest),this.host.addEventListener("context-provider",this.onProviderRequest)}hostConnected(){this.host.dispatchEvent(new fc(this.context,this.host))}};function dc({context:e}){return(t,n)=>{const r=new WeakMap;if(typeof n=="object")return{get(){return t.get.call(this)},set(i){return r.get(this).setValue(i),t.set.call(this,i)},init(i){return r.set(this,new fo(this,{context:e,initialValue:i})),i}};{t.constructor.addInitializer((o=>{r.set(o,new fo(o,{context:e}))}));const i=Object.getOwnPropertyDescriptor(t,n);let s;if(i===void 0){const o=new WeakMap;s={get(){return o.get(this)},set(a){r.get(this).setValue(a),o.set(this,a)},configurable:!0,enumerable:!0}}else{const o=i.set;s={...i,set(a){r.get(this).setValue(a),o?.call(this,a)}}}return void Object.defineProperty(t,n,s)}}}function Ln({context:e,subscribe:t}){return(n,r)=>{typeof r=="object"?r.addInitializer((function(){new ho(this,{context:e,callback:i=>{n.set.call(this,i)},subscribe:t})})):n.constructor.addInitializer((i=>{new ho(i,{context:e,callback:s=>{i[r]=s},subscribe:t})}))}}const ur=globalThis,ks=ur.ShadowRoot&&(ur.ShadyCSS===void 0||ur.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,il=Symbol(),po=new WeakMap;let pc=class{constructor(t,n,r){if(this._$cssResult$=!0,r!==il)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=n}get styleSheet(){let t=this.o;const n=this.t;if(ks&&t===void 0){const r=n!==void 0&&n.length===1;r&&(t=po.get(n)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),r&&po.set(n,t))}return t}toString(){return this.cssText}};const gc=e=>new pc(typeof e=="string"?e:e+"",void 0,il),mc=(e,t)=>{if(ks)e.adoptedStyleSheets=t.map((n=>n instanceof CSSStyleSheet?n:n.styleSheet));else for(const n of t){const r=document.createElement("style"),i=ur.litNonce;i!==void 0&&r.setAttribute("nonce",i),r.textContent=n.cssText,e.appendChild(r)}},go=ks?e=>e:e=>e instanceof CSSStyleSheet?(t=>{let n="";for(const r of t.cssRules)n+=r.cssText;return gc(n)})(e):e;const{is:yc,defineProperty:_c,getOwnPropertyDescriptor:wc,getOwnPropertyNames:vc,getOwnPropertySymbols:xc,getPrototypeOf:bc}=Object,ei=globalThis,mo=ei.trustedTypes,Sc=mo?mo.emptyScript:"",Ec=ei.reactiveElementPolyfillSupport,xn=(e,t)=>e,_r={toAttribute(e,t){switch(t){case Boolean:e=e?Sc:null;break;case Object:case Array:e=e==null?e:JSON.stringify(e)}return e},fromAttribute(e,t){let n=e;switch(t){case Boolean:n=e!==null;break;case Number:n=e===null?null:Number(e);break;case Object:case Array:try{n=JSON.parse(e)}catch{n=null}}return n}},Cs=(e,t)=>!yc(e,t),yo={attribute:!0,type:String,converter:_r,reflect:!1,useDefault:!1,hasChanged:Cs};Symbol.metadata??=Symbol("metadata"),ei.litPropertyMetadata??=new WeakMap;let qe=class extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,n=yo){if(n.state&&(n.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((n=Object.create(n)).wrapped=!0),this.elementProperties.set(t,n),!n.noAccessor){const r=Symbol(),i=this.getPropertyDescriptor(t,r,n);i!==void 0&&_c(this.prototype,t,i)}}static getPropertyDescriptor(t,n,r){const{get:i,set:s}=wc(this.prototype,t)??{get(){return this[n]},set(o){this[n]=o}};return{get:i,set(o){const a=i?.call(this);s?.call(this,o),this.requestUpdate(t,a,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??yo}static _$Ei(){if(this.hasOwnProperty(xn("elementProperties")))return;const t=bc(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(xn("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(xn("properties"))){const n=this.properties,r=[...vc(n),...xc(n)];for(const i of r)this.createProperty(i,n[i])}const t=this[Symbol.metadata];if(t!==null){const n=litPropertyMetadata.get(t);if(n!==void 0)for(const[r,i]of n)this.elementProperties.set(r,i)}this._$Eh=new Map;for(const[n,r]of this.elementProperties){const i=this._$Eu(n,r);i!==void 0&&this._$Eh.set(i,n)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const n=[];if(Array.isArray(t)){const r=new Set(t.flat(1/0).reverse());for(const i of r)n.unshift(go(i))}else t!==void 0&&n.push(go(t));return n}static _$Eu(t,n){const r=n.attribute;return r===!1?void 0:typeof r=="string"?r:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((t=>t(this)))}addController(t){(this._$EO??=new Set).add(t),this.renderRoot!==void 0&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,n=this.constructor.elementProperties;for(const r of n.keys())this.hasOwnProperty(r)&&(t.set(r,this[r]),delete this[r]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return mc(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((t=>t.hostConnected?.()))}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach((t=>t.hostDisconnected?.()))}attributeChangedCallback(t,n,r){this._$AK(t,r)}_$ET(t,n){const r=this.constructor.elementProperties.get(t),i=this.constructor._$Eu(t,r);if(i!==void 0&&r.reflect===!0){const s=(r.converter?.toAttribute!==void 0?r.converter:_r).toAttribute(n,r.type);this._$Em=t,s==null?this.removeAttribute(i):this.setAttribute(i,s),this._$Em=null}}_$AK(t,n){const r=this.constructor,i=r._$Eh.get(t);if(i!==void 0&&this._$Em!==i){const s=r.getPropertyOptions(i),o=typeof s.converter=="function"?{fromAttribute:s.converter}:s.converter?.fromAttribute!==void 0?s.converter:_r;this._$Em=i;const a=o.fromAttribute(n,s.type);this[i]=a??this._$Ej?.get(i)??a,this._$Em=null}}requestUpdate(t,n,r){if(t!==void 0){const i=this.constructor,s=this[t];if(r??=i.getPropertyOptions(t),!((r.hasChanged??Cs)(s,n)||r.useDefault&&r.reflect&&s===this._$Ej?.get(t)&&!this.hasAttribute(i._$Eu(t,r))))return;this.C(t,n,r)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(t,n,{useDefault:r,reflect:i,wrapped:s},o){r&&!(this._$Ej??=new Map).has(t)&&(this._$Ej.set(t,o??n??this[t]),s!==!0||o!==void 0)||(this._$AL.has(t)||(this.hasUpdated||r||(n=void 0),this._$AL.set(t,n)),i===!0&&this._$Em!==t&&(this._$Eq??=new Set).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(n){Promise.reject(n)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[i,s]of this._$Ep)this[i]=s;this._$Ep=void 0}const r=this.constructor.elementProperties;if(r.size>0)for(const[i,s]of r){const{wrapped:o}=s,a=this[i];o!==!0||this._$AL.has(i)||a===void 0||this.C(i,void 0,s,a)}}let t=!1;const n=this._$AL;try{t=this.shouldUpdate(n),t?(this.willUpdate(n),this._$EO?.forEach((r=>r.hostUpdate?.())),this.update(n)):this._$EM()}catch(r){throw t=!1,this._$EM(),r}t&&this._$AE(n)}willUpdate(t){}_$AE(t){this._$EO?.forEach((n=>n.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&=this._$Eq.forEach((n=>this._$ET(n,this[n]))),this._$EM()}updated(t){}firstUpdated(t){}};qe.elementStyles=[],qe.shadowRootOptions={mode:"open"},qe[xn("elementProperties")]=new Map,qe[xn("finalized")]=new Map,Ec?.({ReactiveElement:qe}),(ei.reactiveElementVersions??=[]).push("2.1.1");const Os=globalThis,wr=Os.trustedTypes,_o=wr?wr.createPolicy("lit-html",{createHTML:e=>e}):void 0,sl="$lit$",ge=`lit$${Math.random().toFixed(9).slice(2)}$`,ol="?"+ge,Mc=`<${ol}>`,Oe=document,En=()=>Oe.createComment(""),Mn=e=>e===null||typeof e!="object"&&typeof e!="function",Ls=Array.isArray,$c=e=>Ls(e)||typeof e?.[Symbol.iterator]=="function",gi=`[ 	
\f\r]`,ln=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,wo=/-->/g,vo=/>/g,be=RegExp(`>|${gi}(?:([^\\s"'>=/]+)(${gi}*=${gi}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),xo=/'/g,bo=/"/g,al=/^(?:script|style|textarea|title)$/i,Ac=e=>(t,...n)=>({_$litType$:e,strings:t,values:n}),Kt=Ac(1),Le=Symbol.for("lit-noChange"),at=Symbol.for("lit-nothing"),So=new WeakMap,Ae=Oe.createTreeWalker(Oe,129);function ll(e,t){if(!Ls(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return _o!==void 0?_o.createHTML(t):t}const Ic=(e,t)=>{const n=e.length-1,r=[];let i,s=t===2?"<svg>":t===3?"<math>":"",o=ln;for(let a=0;a<n;a++){const l=e[a];let c,h,u=-1,f=0;for(;f<l.length&&(o.lastIndex=f,h=o.exec(l),h!==null);)f=o.lastIndex,o===ln?h[1]==="!--"?o=wo:h[1]!==void 0?o=vo:h[2]!==void 0?(al.test(h[2])&&(i=RegExp("</"+h[2],"g")),o=be):h[3]!==void 0&&(o=be):o===be?h[0]===">"?(o=i??ln,u=-1):h[1]===void 0?u=-2:(u=o.lastIndex-h[2].length,c=h[1],o=h[3]===void 0?be:h[3]==='"'?bo:xo):o===bo||o===xo?o=be:o===wo||o===vo?o=ln:(o=be,i=void 0);const _=o===be&&e[a+1].startsWith("/>")?" ":"";s+=o===ln?l+Mc:u>=0?(r.push(c),l.slice(0,u)+sl+l.slice(u)+ge+_):l+ge+(u===-2?a:_)}return[ll(e,s+(e[n]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),r]};class $n{constructor({strings:t,_$litType$:n},r){let i;this.parts=[];let s=0,o=0;const a=t.length-1,l=this.parts,[c,h]=Ic(t,n);if(this.el=$n.createElement(c,r),Ae.currentNode=this.el.content,n===2||n===3){const u=this.el.content.firstChild;u.replaceWith(...u.childNodes)}for(;(i=Ae.nextNode())!==null&&l.length<a;){if(i.nodeType===1){if(i.hasAttributes())for(const u of i.getAttributeNames())if(u.endsWith(sl)){const f=h[o++],_=i.getAttribute(u).split(ge),b=/([.?@])?(.*)/.exec(f);l.push({type:1,index:s,name:b[2],strings:_,ctor:b[1]==="."?Pc:b[1]==="?"?Nc:b[1]==="@"?kc:ni}),i.removeAttribute(u)}else u.startsWith(ge)&&(l.push({type:6,index:s}),i.removeAttribute(u));if(al.test(i.tagName)){const u=i.textContent.split(ge),f=u.length-1;if(f>0){i.textContent=wr?wr.emptyScript:"";for(let _=0;_<f;_++)i.append(u[_],En()),Ae.nextNode(),l.push({type:2,index:++s});i.append(u[f],En())}}}else if(i.nodeType===8)if(i.data===ol)l.push({type:2,index:s});else{let u=-1;for(;(u=i.data.indexOf(ge,u+1))!==-1;)l.push({type:7,index:s}),u+=ge.length-1}s++}}static createElement(t,n){const r=Oe.createElement("template");return r.innerHTML=t,r}}function Xe(e,t,n=e,r){if(t===Le)return t;let i=r!==void 0?n._$Co?.[r]:n._$Cl;const s=Mn(t)?void 0:t._$litDirective$;return i?.constructor!==s&&(i?._$AO?.(!1),s===void 0?i=void 0:(i=new s(e),i._$AT(e,n,r)),r!==void 0?(n._$Co??=[])[r]=i:n._$Cl=i),i!==void 0&&(t=Xe(e,i._$AS(e,t.values),i,r)),t}class Tc{constructor(t,n){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:n},parts:r}=this._$AD,i=(t?.creationScope??Oe).importNode(n,!0);Ae.currentNode=i;let s=Ae.nextNode(),o=0,a=0,l=r[0];for(;l!==void 0;){if(o===l.index){let c;l.type===2?c=new Rn(s,s.nextSibling,this,t):l.type===1?c=new l.ctor(s,l.name,l.strings,this,t):l.type===6&&(c=new Cc(s,this,t)),this._$AV.push(c),l=r[++a]}o!==l?.index&&(s=Ae.nextNode(),o++)}return Ae.currentNode=Oe,i}p(t){let n=0;for(const r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(t,r,n),n+=r.strings.length-2):r._$AI(t[n])),n++}}class Rn{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,n,r,i){this.type=2,this._$AH=at,this._$AN=void 0,this._$AA=t,this._$AB=n,this._$AM=r,this.options=i,this._$Cv=i?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const n=this._$AM;return n!==void 0&&t?.nodeType===11&&(t=n.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,n=this){t=Xe(this,t,n),Mn(t)?t===at||t==null||t===""?(this._$AH!==at&&this._$AR(),this._$AH=at):t!==this._$AH&&t!==Le&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):$c(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==at&&Mn(this._$AH)?this._$AA.nextSibling.data=t:this.T(Oe.createTextNode(t)),this._$AH=t}$(t){const{values:n,_$litType$:r}=t,i=typeof r=="number"?this._$AC(t):(r.el===void 0&&(r.el=$n.createElement(ll(r.h,r.h[0]),this.options)),r);if(this._$AH?._$AD===i)this._$AH.p(n);else{const s=new Tc(i,this),o=s.u(this.options);s.p(n),this.T(o),this._$AH=s}}_$AC(t){let n=So.get(t.strings);return n===void 0&&So.set(t.strings,n=new $n(t)),n}k(t){Ls(this._$AH)||(this._$AH=[],this._$AR());const n=this._$AH;let r,i=0;for(const s of t)i===n.length?n.push(r=new Rn(this.O(En()),this.O(En()),this,this.options)):r=n[i],r._$AI(s),i++;i<n.length&&(this._$AR(r&&r._$AB.nextSibling,i),n.length=i)}_$AR(t=this._$AA.nextSibling,n){for(this._$AP?.(!1,!0,n);t!==this._$AB;){const r=t.nextSibling;t.remove(),t=r}}setConnected(t){this._$AM===void 0&&(this._$Cv=t,this._$AP?.(t))}}class ni{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,n,r,i,s){this.type=1,this._$AH=at,this._$AN=void 0,this.element=t,this.name=n,this._$AM=i,this.options=s,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=at}_$AI(t,n=this,r,i){const s=this.strings;let o=!1;if(s===void 0)t=Xe(this,t,n,0),o=!Mn(t)||t!==this._$AH&&t!==Le,o&&(this._$AH=t);else{const a=t;let l,c;for(t=s[0],l=0;l<s.length-1;l++)c=Xe(this,a[r+l],n,l),c===Le&&(c=this._$AH[l]),o||=!Mn(c)||c!==this._$AH[l],c===at?t=at:t!==at&&(t+=(c??"")+s[l+1]),this._$AH[l]=c}o&&!i&&this.j(t)}j(t){t===at?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class Pc extends ni{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===at?void 0:t}}class Nc extends ni{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==at)}}class kc extends ni{constructor(t,n,r,i,s){super(t,n,r,i,s),this.type=5}_$AI(t,n=this){if((t=Xe(this,t,n,0)??at)===Le)return;const r=this._$AH,i=t===at&&r!==at||t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive,s=t!==at&&(r===at||i);i&&this.element.removeEventListener(this.name,this,r),s&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class Cc{constructor(t,n,r){this.element=t,this.type=6,this._$AN=void 0,this._$AM=n,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(t){Xe(this,t)}}const Oc=Os.litHtmlPolyfillSupport;Oc?.($n,Rn),(Os.litHtmlVersions??=[]).push("3.3.1");const Lc=(e,t,n)=>{const r=n?.renderBefore??t;let i=r._$litPart$;if(i===void 0){const s=n?.renderBefore??null;r._$litPart$=i=new Rn(t.insertBefore(En(),s),s,void 0,n??{})}return i._$AI(e),i};const Rs=globalThis;let Qt=class extends qe{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const n=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=Lc(n,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return Le}};Qt._$litElement$=!0,Qt.finalized=!0,Rs.litElementHydrateSupport?.({LitElement:Qt});const Rc=Rs.litElementPolyfillSupport;Rc?.({LitElement:Qt});(Rs.litElementVersions??=[]).push("4.2.1");const sn=e=>(t,n)=>{n!==void 0?n.addInitializer((()=>{customElements.define(e,t)})):customElements.define(e,t)};const Dc={attribute:!0,type:String,converter:_r,reflect:!1,hasChanged:Cs},zc=(e=Dc,t,n)=>{const{kind:r,metadata:i}=n;let s=globalThis.litPropertyMetadata.get(i);if(s===void 0&&globalThis.litPropertyMetadata.set(i,s=new Map),r==="setter"&&((e=Object.create(e)).wrapped=!0),s.set(n.name,e),r==="accessor"){const{name:o}=n;return{set(a){const l=t.get.call(this);t.set.call(this,a),this.requestUpdate(o,l,e)},init(a){return a!==void 0&&this.C(o,void 0,e,a),a}}}if(r==="setter"){const{name:o}=n;return function(a){const l=this[o];t.call(this,a),this.requestUpdate(o,l,e)}}throw Error("Unsupported decorator location: "+r)};function $t(e){return(t,n)=>typeof n=="object"?zc(e,t,n):((r,i,s)=>{const o=i.hasOwnProperty(s);return i.constructor.createProperty(s,r),o?Object.getOwnPropertyDescriptor(i,s):void 0})(e,t,n)}function Uc(e){return $t({...e,state:!0,attribute:!1})}const qn=BigInt(2**32-1),Eo=BigInt(32);function Bc(e,t=!1){return t?{h:Number(e&qn),l:Number(e>>Eo&qn)}:{h:Number(e>>Eo&qn)|0,l:Number(e&qn)|0}}function Fc(e,t=!1){const n=e.length;let r=new Uint32Array(n),i=new Uint32Array(n);for(let s=0;s<n;s++){const{h:o,l:a}=Bc(e[s],t);[r[s],i[s]]=[o,a]}return[r,i]}const Hc=(e,t,n)=>e<<n|t>>>32-n,qc=(e,t,n)=>t<<n|e>>>32-n,Gc=(e,t,n)=>t<<n-32|e>>>64-n,jc=(e,t,n)=>e<<n-32|t>>>64-n;function Wc(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Mo(e,t=""){if(!Number.isSafeInteger(e)||e<0){const n=t&&`"${t}" `;throw new Error(`${n}expected integer >= 0, got ${e}`)}}function Ri(e,t,n=""){const r=Wc(e),i=e?.length;if(!r||t!==void 0){const o=n&&`"${n}" `,a="",l=r?`length=${i}`:`type=${typeof e}`;throw new Error(o+"expected Uint8Array"+a+", got "+l)}return e}function $o(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Yc(e,t){Ri(e,void 0,"digestInto() output");const n=t.outputLen;if(e.length<n)throw new Error('"digestInto() output" expected to be of length >='+n)}function Vc(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function ul(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}const Xc=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Kc(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function Qc(e){for(let t=0;t<e.length;t++)e[t]=Kc(e[t]);return e}const Ao=Xc?e=>e:Qc;function Zc(e,t={}){const n=(i,s)=>e(s).update(i).digest(),r=e(void 0);return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=i=>e(i),Object.assign(n,t),Object.freeze(n)}const Jc=e=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,e])}),th=BigInt(0),un=BigInt(1),eh=BigInt(2),nh=BigInt(7),rh=BigInt(256),ih=BigInt(113),cl=[],hl=[],fl=[];for(let e=0,t=un,n=1,r=0;e<24;e++){[n,r]=[r,(2*n+3*r)%5],cl.push(2*(5*r+n)),hl.push((e+1)*(e+2)/2%64);let i=th;for(let s=0;s<7;s++)t=(t<<un^(t>>nh)*ih)%rh,t&eh&&(i^=un<<(un<<BigInt(s))-un);fl.push(i)}const dl=Fc(fl,!0),sh=dl[0],oh=dl[1],Io=(e,t,n)=>n>32?Gc(e,t,n):Hc(e,t,n),To=(e,t,n)=>n>32?jc(e,t,n):qc(e,t,n);function ah(e,t=24){const n=new Uint32Array(10);for(let r=24-t;r<24;r++){for(let o=0;o<10;o++)n[o]=e[o]^e[o+10]^e[o+20]^e[o+30]^e[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,l=(o+2)%10,c=n[l],h=n[l+1],u=Io(c,h,1)^n[a],f=To(c,h,1)^n[a+1];for(let _=0;_<50;_+=10)e[o+_]^=u,e[o+_+1]^=f}let i=e[2],s=e[3];for(let o=0;o<24;o++){const a=hl[o],l=Io(i,s,a),c=To(i,s,a),h=cl[o];i=e[h],s=e[h+1],e[h]=l,e[h+1]=c}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=e[o+a];for(let a=0;a<10;a++)e[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}e[0]^=sh[r],e[1]^=oh[r]}ul(n)}class Ds{state;pos=0;posOut=0;finished=!1;state32;destroyed=!1;blockLen;suffix;outputLen;enableXOF=!1;rounds;constructor(t,n,r,i=!1,s=24){if(this.blockLen=t,this.suffix=n,this.outputLen=r,this.enableXOF=i,this.rounds=s,Mo(r,"outputLen"),!(0<t&&t<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Vc(this.state)}clone(){return this._cloneInto()}keccak(){Ao(this.state32),ah(this.state32,this.rounds),Ao(this.state32),this.posOut=0,this.pos=0}update(t){$o(this),Ri(t);const{blockLen:n,state:r}=this,i=t.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);for(let a=0;a<o;a++)r[this.pos++]^=t[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:n,pos:r,blockLen:i}=this;t[r]^=n,(n&128)!==0&&r===i-1&&this.keccak(),t[i-1]^=128,this.keccak()}writeInto(t){$o(this,!1),Ri(t),this.finish();const n=this.state,{blockLen:r}=this;for(let i=0,s=t.length;i<s;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,s-i);t.set(n.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return Mo(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(Yc(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,ul(this.state)}_cloneInto(t){const{blockLen:n,suffix:r,outputLen:i,rounds:s,enableXOF:o}=this;return t||=new Ds(n,r,i,o,s),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=s,t.suffix=r,t.outputLen=i,t.enableXOF=o,t.destroyed=this.destroyed,t}}const lh=(e,t,n,r={})=>Zc(()=>new Ds(t,e,n),r),uh=lh(6,72,64,Jc(10));var ch=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,mi=Math.ceil,Ct=Math.floor,St="[BigNumber Error] ",Po=St+"Number primitive has more than 15 significant digits: ",zt=1e14,q=14,yi=9007199254740991,_i=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],de=1e7,ct=1e9;function pl(e){var t,n,r,i=$.prototype={constructor:$,toString:null,valueOf:null},s=new $(1),o=20,a=4,l=-7,c=21,h=-1e7,u=1e7,f=!1,_=1,b=0,A={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},N="0123456789abcdefghijklmnopqrstuvwxyz",I=!0;function $(d,g){var w,v,S,M,y,p,m,x,E=this;if(!(E instanceof $))return new $(d,g);if(g==null){if(d&&d._isBigNumber===!0){E.s=d.s,!d.c||d.e>u?E.c=E.e=null:d.e<h?E.c=[E.e=0]:(E.e=d.e,E.c=d.c.slice());return}if((p=typeof d=="number")&&d*0==0){if(E.s=1/d<0?(d=-d,-1):1,d===~~d){for(M=0,y=d;y>=10;y/=10,M++);M>u?E.c=E.e=null:(E.e=M,E.c=[d]);return}x=String(d)}else{if(!ch.test(x=String(d)))return r(E,x,p);E.s=x.charCodeAt(0)==45?(x=x.slice(1),-1):1}(M=x.indexOf("."))>-1&&(x=x.replace(".","")),(y=x.search(/e/i))>0?(M<0&&(M=y),M+=+x.slice(y+1),x=x.substring(0,y)):M<0&&(M=x.length)}else{if(rt(g,2,N.length,"Base"),g==10&&I)return E=new $(d),L(E,o+E.e+1,a);if(x=String(d),p=typeof d=="number"){if(d*0!=0)return r(E,x,p,g);if(E.s=1/d<0?(x=x.slice(1),-1):1,$.DEBUG&&x.replace(/^0\.0*|\./,"").length>15)throw Error(Po+d)}else E.s=x.charCodeAt(0)===45?(x=x.slice(1),-1):1;for(w=N.slice(0,g),M=y=0,m=x.length;y<m;y++)if(w.indexOf(v=x.charAt(y))<0){if(v=="."){if(y>M){M=m;continue}}else if(!S&&(x==x.toUpperCase()&&(x=x.toLowerCase())||x==x.toLowerCase()&&(x=x.toUpperCase()))){S=!0,y=-1,M=0;continue}return r(E,String(d),p,g)}p=!1,x=n(x,g,10,E.s),(M=x.indexOf("."))>-1?x=x.replace(".",""):M=x.length}for(y=0;x.charCodeAt(y)===48;y++);for(m=x.length;x.charCodeAt(--m)===48;);if(x=x.slice(y,++m)){if(m-=y,p&&$.DEBUG&&m>15&&(d>yi||d!==Ct(d)))throw Error(Po+E.s*d);if((M=M-y-1)>u)E.c=E.e=null;else if(M<h)E.c=[E.e=0];else{if(E.e=M,E.c=[],y=(M+1)%q,M<0&&(y+=q),y<m){for(y&&E.c.push(+x.slice(0,y)),m-=q;y<m;)E.c.push(+x.slice(y,y+=q));y=q-(x=x.slice(y)).length}else y-=m;for(;y--;x+="0");E.c.push(+x)}}else E.c=[E.e=0]}$.clone=pl,$.ROUND_UP=0,$.ROUND_DOWN=1,$.ROUND_CEIL=2,$.ROUND_FLOOR=3,$.ROUND_HALF_UP=4,$.ROUND_HALF_DOWN=5,$.ROUND_HALF_EVEN=6,$.ROUND_HALF_CEIL=7,$.ROUND_HALF_FLOOR=8,$.EUCLID=9,$.config=$.set=function(d){var g,w;if(d!=null)if(typeof d=="object"){if(d.hasOwnProperty(g="DECIMAL_PLACES")&&(w=d[g],rt(w,0,ct,g),o=w),d.hasOwnProperty(g="ROUNDING_MODE")&&(w=d[g],rt(w,0,8,g),a=w),d.hasOwnProperty(g="EXPONENTIAL_AT")&&(w=d[g],w&&w.pop?(rt(w[0],-ct,0,g),rt(w[1],0,ct,g),l=w[0],c=w[1]):(rt(w,-ct,ct,g),l=-(c=w<0?-w:w))),d.hasOwnProperty(g="RANGE"))if(w=d[g],w&&w.pop)rt(w[0],-ct,-1,g),rt(w[1],1,ct,g),h=w[0],u=w[1];else if(rt(w,-ct,ct,g),w)h=-(u=w<0?-w:w);else throw Error(St+g+" cannot be zero: "+w);if(d.hasOwnProperty(g="CRYPTO"))if(w=d[g],w===!!w)if(w)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))f=w;else throw f=!w,Error(St+"crypto unavailable");else f=w;else throw Error(St+g+" not true or false: "+w);if(d.hasOwnProperty(g="MODULO_MODE")&&(w=d[g],rt(w,0,9,g),_=w),d.hasOwnProperty(g="POW_PRECISION")&&(w=d[g],rt(w,0,ct,g),b=w),d.hasOwnProperty(g="FORMAT"))if(w=d[g],typeof w=="object")A=w;else throw Error(St+g+" not an object: "+w);if(d.hasOwnProperty(g="ALPHABET"))if(w=d[g],typeof w=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(w))I=w.slice(0,10)=="0123456789",N=w;else throw Error(St+g+" invalid: "+w)}else throw Error(St+"Object expected: "+d);return{DECIMAL_PLACES:o,ROUNDING_MODE:a,EXPONENTIAL_AT:[l,c],RANGE:[h,u],CRYPTO:f,MODULO_MODE:_,POW_PRECISION:b,FORMAT:A,ALPHABET:N}},$.isBigNumber=function(d){if(!d||d._isBigNumber!==!0)return!1;if(!$.DEBUG)return!0;var g,w,v=d.c,S=d.e,M=d.s;t:if({}.toString.call(v)=="[object Array]"){if((M===1||M===-1)&&S>=-ct&&S<=ct&&S===Ct(S)){if(v[0]===0){if(S===0&&v.length===1)return!0;break t}if(g=(S+1)%q,g<1&&(g+=q),String(v[0]).length==g){for(g=0;g<v.length;g++)if(w=v[g],w<0||w>=zt||w!==Ct(w))break t;if(w!==0)return!0}}}else if(v===null&&S===null&&(M===null||M===1||M===-1))return!0;throw Error(St+"Invalid BigNumber: "+d)},$.maximum=$.max=function(){return k(arguments,-1)},$.minimum=$.min=function(){return k(arguments,1)},$.random=(function(){var d=9007199254740992,g=Math.random()*d&2097151?function(){return Ct(Math.random()*d)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(w){var v,S,M,y,p,m=0,x=[],E=new $(s);if(w==null?w=o:rt(w,0,ct),y=mi(w/q),f)if(crypto.getRandomValues){for(v=crypto.getRandomValues(new Uint32Array(y*=2));m<y;)p=v[m]*131072+(v[m+1]>>>11),p>=9e15?(S=crypto.getRandomValues(new Uint32Array(2)),v[m]=S[0],v[m+1]=S[1]):(x.push(p%1e14),m+=2);m=y/2}else if(crypto.randomBytes){for(v=crypto.randomBytes(y*=7);m<y;)p=(v[m]&31)*281474976710656+v[m+1]*1099511627776+v[m+2]*4294967296+v[m+3]*16777216+(v[m+4]<<16)+(v[m+5]<<8)+v[m+6],p>=9e15?crypto.randomBytes(7).copy(v,m):(x.push(p%1e14),m+=7);m=y/7}else throw f=!1,Error(St+"crypto unavailable");if(!f)for(;m<y;)p=g(),p<9e15&&(x[m++]=p%1e14);for(y=x[--m],w%=q,y&&w&&(p=_i[q-w],x[m]=Ct(y/p)*p);x[m]===0;x.pop(),m--);if(m<0)x=[M=0];else{for(M=-1;x[0]===0;x.splice(0,1),M-=q);for(m=1,p=x[0];p>=10;p/=10,m++);m<q&&(M-=q-m)}return E.e=M,E.c=x,E}})(),$.sum=function(){for(var d=1,g=arguments,w=new $(g[0]);d<g.length;)w=w.plus(g[d++]);return w},n=(function(){var d="0123456789";function g(w,v,S,M){for(var y,p=[0],m,x=0,E=w.length;x<E;){for(m=p.length;m--;p[m]*=v);for(p[0]+=M.indexOf(w.charAt(x++)),y=0;y<p.length;y++)p[y]>S-1&&(p[y+1]==null&&(p[y+1]=0),p[y+1]+=p[y]/S|0,p[y]%=S)}return p.reverse()}return function(w,v,S,M,y){var p,m,x,E,T,R,D,B,H=w.indexOf("."),G=o,F=a;for(H>=0&&(E=b,b=0,w=w.replace(".",""),B=new $(v),R=B.pow(w.length-H),b=E,B.c=g(re(kt(R.c),R.e,"0"),10,S,d),B.e=B.c.length),D=g(w,v,S,y?(p=N,d):(p=d,N)),x=E=D.length;D[--E]==0;D.pop());if(!D[0])return p.charAt(0);if(H<0?--x:(R.c=D,R.e=x,R.s=M,R=t(R,B,G,F,S),D=R.c,T=R.r,x=R.e),m=x+G+1,H=D[m],E=S/2,T=T||m<0||D[m+1]!=null,T=F<4?(H!=null||T)&&(F==0||F==(R.s<0?3:2)):H>E||H==E&&(F==4||T||F==6&&D[m-1]&1||F==(R.s<0?8:7)),m<1||!D[0])w=T?re(p.charAt(1),-G,p.charAt(0)):p.charAt(0);else{if(D.length=m,T)for(--S;++D[--m]>S;)D[m]=0,m||(++x,D=[1].concat(D));for(E=D.length;!D[--E];);for(H=0,w="";H<=E;w+=p.charAt(D[H++]));w=re(w,x,p.charAt(0))}return w}})(),t=(function(){function d(v,S,M){var y,p,m,x,E=0,T=v.length,R=S%de,D=S/de|0;for(v=v.slice();T--;)m=v[T]%de,x=v[T]/de|0,y=D*m+x*R,p=R*m+y%de*de+E,E=(p/M|0)+(y/de|0)+D*x,v[T]=p%M;return E&&(v=[E].concat(v)),v}function g(v,S,M,y){var p,m;if(M!=y)m=M>y?1:-1;else for(p=m=0;p<M;p++)if(v[p]!=S[p]){m=v[p]>S[p]?1:-1;break}return m}function w(v,S,M,y){for(var p=0;M--;)v[M]-=p,p=v[M]<S[M]?1:0,v[M]=p*y+v[M]-S[M];for(;!v[0]&&v.length>1;v.splice(0,1));}return function(v,S,M,y,p){var m,x,E,T,R,D,B,H,G,F,W,J,bt,xe,pi,jt,an,Nt=v.s==S.s?1:-1,mt=v.c,st=S.c;if(!mt||!mt[0]||!st||!st[0])return new $(!v.s||!S.s||(mt?st&&mt[0]==st[0]:!st)?NaN:mt&&mt[0]==0||!st?Nt*0:Nt/0);for(H=new $(Nt),G=H.c=[],x=v.e-S.e,Nt=M+x+1,p||(p=zt,x=Ot(v.e/q)-Ot(S.e/q),Nt=Nt/q|0),E=0;st[E]==(mt[E]||0);E++);if(st[E]>(mt[E]||0)&&x--,Nt<0)G.push(1),T=!0;else{for(xe=mt.length,jt=st.length,E=0,Nt+=2,R=Ct(p/(st[0]+1)),R>1&&(st=d(st,R,p),mt=d(mt,R,p),jt=st.length,xe=mt.length),bt=jt,F=mt.slice(0,jt),W=F.length;W<jt;F[W++]=0);an=st.slice(),an=[0].concat(an),pi=st[0],st[1]>=p/2&&pi++;do{if(R=0,m=g(st,F,jt,W),m<0){if(J=F[0],jt!=W&&(J=J*p+(F[1]||0)),R=Ct(J/pi),R>1)for(R>=p&&(R=p-1),D=d(st,R,p),B=D.length,W=F.length;g(D,F,B,W)==1;)R--,w(D,jt<B?an:st,B,p),B=D.length,m=1;else R==0&&(m=R=1),D=st.slice(),B=D.length;if(B<W&&(D=[0].concat(D)),w(F,D,W,p),W=F.length,m==-1)for(;g(st,F,jt,W)<1;)R++,w(F,jt<W?an:st,W,p),W=F.length}else m===0&&(R++,F=[0]);G[E++]=R,F[0]?F[W++]=mt[bt]||0:(F=[mt[bt]],W=1)}while((bt++<xe||F[0]!=null)&&Nt--);T=F[0]!=null,G[0]||G.splice(0,1)}if(p==zt){for(E=1,Nt=G[0];Nt>=10;Nt/=10,E++);L(H,M+(H.e=E+x*q-1)+1,y,T)}else H.e=x,H.r=+T;return H}})();function C(d,g,w,v){var S,M,y,p,m;if(w==null?w=a:rt(w,0,8),!d.c)return d.toString();if(S=d.c[0],y=d.e,g==null)m=kt(d.c),m=v==1||v==2&&(y<=l||y>=c)?jn(m,y):re(m,y,"0");else if(d=L(new $(d),g,w),M=d.e,m=kt(d.c),p=m.length,v==1||v==2&&(g<=M||M<=l)){for(;p<g;m+="0",p++);m=jn(m,M)}else if(g-=y+(v===2&&M>y),m=re(m,M,"0"),M+1>p){if(--g>0)for(m+=".";g--;m+="0");}else if(g+=M-p,g>0)for(M+1==p&&(m+=".");g--;m+="0");return d.s<0&&S?"-"+m:m}function k(d,g){for(var w,v,S=1,M=new $(d[0]);S<d.length;S++)v=new $(d[S]),(!v.s||(w=Se(M,v))===g||w===0&&M.s===g)&&(M=v);return M}function O(d,g,w){for(var v=1,S=g.length;!g[--S];g.pop());for(S=g[0];S>=10;S/=10,v++);return(w=v+w*q-1)>u?d.c=d.e=null:w<h?d.c=[d.e=0]:(d.e=w,d.c=g),d}r=(function(){var d=/^(-?)0([xbo])(?=\w[\w.]*$)/i,g=/^([^.]+)\.$/,w=/^\.([^.]+)$/,v=/^-?(Infinity|NaN)$/,S=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(M,y,p,m){var x,E=p?y:y.replace(S,"");if(v.test(E))M.s=isNaN(E)?null:E<0?-1:1;else{if(!p&&(E=E.replace(d,function(T,R,D){return x=(D=D.toLowerCase())=="x"?16:D=="b"?2:8,!m||m==x?R:T}),m&&(x=m,E=E.replace(g,"$1").replace(w,"0.$1")),y!=E))return new $(E,x);if($.DEBUG)throw Error(St+"Not a"+(m?" base "+m:"")+" number: "+y);M.s=null}M.c=M.e=null}})();function L(d,g,w,v){var S,M,y,p,m,x,E,T=d.c,R=_i;if(T){t:{for(S=1,p=T[0];p>=10;p/=10,S++);if(M=g-S,M<0)M+=q,y=g,m=T[x=0],E=Ct(m/R[S-y-1]%10);else if(x=mi((M+1)/q),x>=T.length)if(v){for(;T.length<=x;T.push(0));m=E=0,S=1,M%=q,y=M-q+1}else break t;else{for(m=p=T[x],S=1;p>=10;p/=10,S++);M%=q,y=M-q+S,E=y<0?0:Ct(m/R[S-y-1]%10)}if(v=v||g<0||T[x+1]!=null||(y<0?m:m%R[S-y-1]),v=w<4?(E||v)&&(w==0||w==(d.s<0?3:2)):E>5||E==5&&(w==4||v||w==6&&(M>0?y>0?m/R[S-y]:0:T[x-1])%10&1||w==(d.s<0?8:7)),g<1||!T[0])return T.length=0,v?(g-=d.e+1,T[0]=R[(q-g%q)%q],d.e=-g||0):T[0]=d.e=0,d;if(M==0?(T.length=x,p=1,x--):(T.length=x+1,p=R[q-M],T[x]=y>0?Ct(m/R[S-y]%R[y])*p:0),v)for(;;)if(x==0){for(M=1,y=T[0];y>=10;y/=10,M++);for(y=T[0]+=p,p=1;y>=10;y/=10,p++);M!=p&&(d.e++,T[0]==zt&&(T[0]=1));break}else{if(T[x]+=p,T[x]!=zt)break;T[x--]=0,p=1}for(M=T.length;T[--M]===0;T.pop());}d.e>u?d.c=d.e=null:d.e<h&&(d.c=[d.e=0])}return d}function z(d){var g,w=d.e;return w===null?d.toString():(g=kt(d.c),g=w<=l||w>=c?jn(g,w):re(g,w,"0"),d.s<0?"-"+g:g)}return i.absoluteValue=i.abs=function(){var d=new $(this);return d.s<0&&(d.s=1),d},i.comparedTo=function(d,g){return Se(this,new $(d,g))},i.decimalPlaces=i.dp=function(d,g){var w,v,S,M=this;if(d!=null)return rt(d,0,ct),g==null?g=a:rt(g,0,8),L(new $(M),d+M.e+1,g);if(!(w=M.c))return null;if(v=((S=w.length-1)-Ot(this.e/q))*q,S=w[S])for(;S%10==0;S/=10,v--);return v<0&&(v=0),v},i.dividedBy=i.div=function(d,g){return t(this,new $(d,g),o,a)},i.dividedToIntegerBy=i.idiv=function(d,g){return t(this,new $(d,g),0,1)},i.exponentiatedBy=i.pow=function(d,g){var w,v,S,M,y,p,m,x,E,T=this;if(d=new $(d),d.c&&!d.isInteger())throw Error(St+"Exponent not an integer: "+z(d));if(g!=null&&(g=new $(g)),p=d.e>14,!T.c||!T.c[0]||T.c[0]==1&&!T.e&&T.c.length==1||!d.c||!d.c[0])return E=new $(Math.pow(+z(T),p?d.s*(2-Gn(d)):+z(d))),g?E.mod(g):E;if(m=d.s<0,g){if(g.c?!g.c[0]:!g.s)return new $(NaN);v=!m&&T.isInteger()&&g.isInteger(),v&&(T=T.mod(g))}else{if(d.e>9&&(T.e>0||T.e<-1||(T.e==0?T.c[0]>1||p&&T.c[1]>=24e7:T.c[0]<8e13||p&&T.c[0]<=9999975e7)))return M=T.s<0&&Gn(d)?-0:0,T.e>-1&&(M=1/M),new $(m?1/M:M);b&&(M=mi(b/q+2))}for(p?(w=new $(.5),m&&(d.s=1),x=Gn(d)):(S=Math.abs(+z(d)),x=S%2),E=new $(s);;){if(x){if(E=E.times(T),!E.c)break;M?E.c.length>M&&(E.c.length=M):v&&(E=E.mod(g))}if(S){if(S=Ct(S/2),S===0)break;x=S%2}else if(d=d.times(w),L(d,d.e+1,1),d.e>14)x=Gn(d);else{if(S=+z(d),S===0)break;x=S%2}T=T.times(T),M?T.c&&T.c.length>M&&(T.c.length=M):v&&(T=T.mod(g))}return v?E:(m&&(E=s.div(E)),g?E.mod(g):M?L(E,b,a,y):E)},i.integerValue=function(d){var g=new $(this);return d==null?d=a:rt(d,0,8),L(g,g.e+1,d)},i.isEqualTo=i.eq=function(d,g){return Se(this,new $(d,g))===0},i.isFinite=function(){return!!this.c},i.isGreaterThan=i.gt=function(d,g){return Se(this,new $(d,g))>0},i.isGreaterThanOrEqualTo=i.gte=function(d,g){return(g=Se(this,new $(d,g)))===1||g===0},i.isInteger=function(){return!!this.c&&Ot(this.e/q)>this.c.length-2},i.isLessThan=i.lt=function(d,g){return Se(this,new $(d,g))<0},i.isLessThanOrEqualTo=i.lte=function(d,g){return(g=Se(this,new $(d,g)))===-1||g===0},i.isNaN=function(){return!this.s},i.isNegative=function(){return this.s<0},i.isPositive=function(){return this.s>0},i.isZero=function(){return!!this.c&&this.c[0]==0},i.minus=function(d,g){var w,v,S,M,y=this,p=y.s;if(d=new $(d,g),g=d.s,!p||!g)return new $(NaN);if(p!=g)return d.s=-g,y.plus(d);var m=y.e/q,x=d.e/q,E=y.c,T=d.c;if(!m||!x){if(!E||!T)return E?(d.s=-g,d):new $(T?y:NaN);if(!E[0]||!T[0])return T[0]?(d.s=-g,d):new $(E[0]?y:a==3?-0:0)}if(m=Ot(m),x=Ot(x),E=E.slice(),p=m-x){for((M=p<0)?(p=-p,S=E):(x=m,S=T),S.reverse(),g=p;g--;S.push(0));S.reverse()}else for(v=(M=(p=E.length)<(g=T.length))?p:g,p=g=0;g<v;g++)if(E[g]!=T[g]){M=E[g]<T[g];break}if(M&&(S=E,E=T,T=S,d.s=-d.s),g=(v=T.length)-(w=E.length),g>0)for(;g--;E[w++]=0);for(g=zt-1;v>p;){if(E[--v]<T[v]){for(w=v;w&&!E[--w];E[w]=g);--E[w],E[v]+=zt}E[v]-=T[v]}for(;E[0]==0;E.splice(0,1),--x);return E[0]?O(d,E,x):(d.s=a==3?-1:1,d.c=[d.e=0],d)},i.modulo=i.mod=function(d,g){var w,v,S=this;return d=new $(d,g),!S.c||!d.s||d.c&&!d.c[0]?new $(NaN):!d.c||S.c&&!S.c[0]?new $(S):(_==9?(v=d.s,d.s=1,w=t(S,d,0,3),d.s=v,w.s*=v):w=t(S,d,0,_),d=S.minus(w.times(d)),!d.c[0]&&_==1&&(d.s=S.s),d)},i.multipliedBy=i.times=function(d,g){var w,v,S,M,y,p,m,x,E,T,R,D,B,H,G,F=this,W=F.c,J=(d=new $(d,g)).c;if(!W||!J||!W[0]||!J[0])return!F.s||!d.s||W&&!W[0]&&!J||J&&!J[0]&&!W?d.c=d.e=d.s=null:(d.s*=F.s,!W||!J?d.c=d.e=null:(d.c=[0],d.e=0)),d;for(v=Ot(F.e/q)+Ot(d.e/q),d.s*=F.s,m=W.length,T=J.length,m<T&&(B=W,W=J,J=B,S=m,m=T,T=S),S=m+T,B=[];S--;B.push(0));for(H=zt,G=de,S=T;--S>=0;){for(w=0,R=J[S]%G,D=J[S]/G|0,y=m,M=S+y;M>S;)x=W[--y]%G,E=W[y]/G|0,p=D*x+E*R,x=R*x+p%G*G+B[M]+w,w=(x/H|0)+(p/G|0)+D*E,B[M--]=x%H;B[M]=w}return w?++v:B.splice(0,1),O(d,B,v)},i.negated=function(){var d=new $(this);return d.s=-d.s||null,d},i.plus=function(d,g){var w,v=this,S=v.s;if(d=new $(d,g),g=d.s,!S||!g)return new $(NaN);if(S!=g)return d.s=-g,v.minus(d);var M=v.e/q,y=d.e/q,p=v.c,m=d.c;if(!M||!y){if(!p||!m)return new $(S/0);if(!p[0]||!m[0])return m[0]?d:new $(p[0]?v:S*0)}if(M=Ot(M),y=Ot(y),p=p.slice(),S=M-y){for(S>0?(y=M,w=m):(S=-S,w=p),w.reverse();S--;w.push(0));w.reverse()}for(S=p.length,g=m.length,S-g<0&&(w=m,m=p,p=w,g=S),S=0;g;)S=(p[--g]=p[g]+m[g]+S)/zt|0,p[g]=zt===p[g]?0:p[g]%zt;return S&&(p=[S].concat(p),++y),O(d,p,y)},i.precision=i.sd=function(d,g){var w,v,S,M=this;if(d!=null&&d!==!!d)return rt(d,1,ct),g==null?g=a:rt(g,0,8),L(new $(M),d,g);if(!(w=M.c))return null;if(S=w.length-1,v=S*q+1,S=w[S]){for(;S%10==0;S/=10,v--);for(S=w[0];S>=10;S/=10,v++);}return d&&M.e+1>v&&(v=M.e+1),v},i.shiftedBy=function(d){return rt(d,-yi,yi),this.times("1e"+d)},i.squareRoot=i.sqrt=function(){var d,g,w,v,S,M=this,y=M.c,p=M.s,m=M.e,x=o+4,E=new $("0.5");if(p!==1||!y||!y[0])return new $(!p||p<0&&(!y||y[0])?NaN:y?M:1/0);if(p=Math.sqrt(+z(M)),p==0||p==1/0?(g=kt(y),(g.length+m)%2==0&&(g+="0"),p=Math.sqrt(+g),m=Ot((m+1)/2)-(m<0||m%2),p==1/0?g="5e"+m:(g=p.toExponential(),g=g.slice(0,g.indexOf("e")+1)+m),w=new $(g)):w=new $(p+""),w.c[0]){for(m=w.e,p=m+x,p<3&&(p=0);;)if(S=w,w=E.times(S.plus(t(M,S,x,1))),kt(S.c).slice(0,p)===(g=kt(w.c)).slice(0,p))if(w.e<m&&--p,g=g.slice(p-3,p+1),g=="9999"||!v&&g=="4999"){if(!v&&(L(S,S.e+o+2,0),S.times(S).eq(M))){w=S;break}x+=4,p+=4,v=1}else{(!+g||!+g.slice(1)&&g.charAt(0)=="5")&&(L(w,w.e+o+2,1),d=!w.times(w).eq(M));break}}return L(w,w.e+o+1,a,d)},i.toExponential=function(d,g){return d!=null&&(rt(d,0,ct),d++),C(this,d,g,1)},i.toFixed=function(d,g){return d!=null&&(rt(d,0,ct),d=d+this.e+1),C(this,d,g)},i.toFormat=function(d,g,w){var v,S=this;if(w==null)d!=null&&g&&typeof g=="object"?(w=g,g=null):d&&typeof d=="object"?(w=d,d=g=null):w=A;else if(typeof w!="object")throw Error(St+"Argument not an object: "+w);if(v=S.toFixed(d,g),S.c){var M,y=v.split("."),p=+w.groupSize,m=+w.secondaryGroupSize,x=w.groupSeparator||"",E=y[0],T=y[1],R=S.s<0,D=R?E.slice(1):E,B=D.length;if(m&&(M=p,p=m,m=M,B-=M),p>0&&B>0){for(M=B%p||p,E=D.substr(0,M);M<B;M+=p)E+=x+D.substr(M,p);m>0&&(E+=x+D.slice(M)),R&&(E="-"+E)}v=T?E+(w.decimalSeparator||"")+((m=+w.fractionGroupSize)?T.replace(new RegExp("\\d{"+m+"}\\B","g"),"$&"+(w.fractionGroupSeparator||"")):T):E}return(w.prefix||"")+v+(w.suffix||"")},i.toFraction=function(d){var g,w,v,S,M,y,p,m,x,E,T,R,D=this,B=D.c;if(d!=null&&(p=new $(d),!p.isInteger()&&(p.c||p.s!==1)||p.lt(s)))throw Error(St+"Argument "+(p.isInteger()?"out of range: ":"not an integer: ")+z(p));if(!B)return new $(D);for(g=new $(s),x=w=new $(s),v=m=new $(s),R=kt(B),M=g.e=R.length-D.e-1,g.c[0]=_i[(y=M%q)<0?q+y:y],d=!d||p.comparedTo(g)>0?M>0?g:x:p,y=u,u=1/0,p=new $(R),m.c[0]=0;E=t(p,g,0,1),S=w.plus(E.times(v)),S.comparedTo(d)!=1;)w=v,v=S,x=m.plus(E.times(S=x)),m=S,g=p.minus(E.times(S=g)),p=S;return S=t(d.minus(w),v,0,1),m=m.plus(S.times(x)),w=w.plus(S.times(v)),m.s=x.s=D.s,M=M*2,T=t(x,v,M,a).minus(D).abs().comparedTo(t(m,w,M,a).minus(D).abs())<1?[x,v]:[m,w],u=y,T},i.toNumber=function(){return+z(this)},i.toPrecision=function(d,g){return d!=null&&rt(d,1,ct),C(this,d,g,2)},i.toString=function(d){var g,w=this,v=w.s,S=w.e;return S===null?v?(g="Infinity",v<0&&(g="-"+g)):g="NaN":(d==null?g=S<=l||S>=c?jn(kt(w.c),S):re(kt(w.c),S,"0"):d===10&&I?(w=L(new $(w),o+S+1,a),g=re(kt(w.c),w.e,"0")):(rt(d,2,N.length,"Base"),g=n(re(kt(w.c),S,"0"),10,d,v,!0)),v<0&&w.c[0]&&(g="-"+g)),g},i.valueOf=i.toJSON=function(){return z(this)},i._isBigNumber=!0,i[Symbol.toStringTag]="BigNumber",i[Symbol.for("nodejs.util.inspect.custom")]=i.valueOf,e!=null&&$.set(e),$}function Ot(e){var t=e|0;return e>0||e===t?t:t-1}function kt(e){for(var t,n,r=1,i=e.length,s=e[0]+"";r<i;){for(t=e[r++]+"",n=q-t.length;n--;t="0"+t);s+=t}for(i=s.length;s.charCodeAt(--i)===48;);return s.slice(0,i+1||1)}function Se(e,t){var n,r,i=e.c,s=t.c,o=e.s,a=t.s,l=e.e,c=t.e;if(!o||!a)return null;if(n=i&&!i[0],r=s&&!s[0],n||r)return n?r?0:-a:o;if(o!=a)return o;if(n=o<0,r=l==c,!i||!s)return r?0:!i^n?1:-1;if(!r)return l>c^n?1:-1;for(a=(l=i.length)<(c=s.length)?l:c,o=0;o<a;o++)if(i[o]!=s[o])return i[o]>s[o]^n?1:-1;return l==c?0:l>c^n?1:-1}function rt(e,t,n,r){if(e<t||e>n||e!==Ct(e))throw Error(St+(r||"Argument")+(typeof e=="number"?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function Gn(e){var t=e.c.length-1;return Ot(e.e/q)==t&&e.c[t]%2!=0}function jn(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function re(e,t,n){var r,i;if(t<0){for(i=n+".";++t;i+=n);e=i+e}else if(r=e.length,++t>r){for(i=n,t-=r;--t;i+=n);e+=i}else t<r&&(e=e.slice(0,t)+"."+e.slice(t));return e}var hh=pl();const fh=24,bn=32,dh=()=>typeof globalThis<"u"&&globalThis.crypto&&typeof globalThis.crypto.getRandomValues=="function"?()=>{const e=new Uint32Array(1);return globalThis.crypto.getRandomValues(e),e[0]/4294967296}:Math.random,zs=dh(),Di=(e=4,t=zs)=>{let n="";for(;n.length<e;)n=n+Math.floor(t()*36).toString(36);return n};function ph(e){let t=new hh(0);for(const n of e.values())t=t.multipliedBy(256).plus(n);return t}const gl=(e="")=>{const t=new TextEncoder;return ph(uh(t.encode(e))).toString(36).slice(1)},No=Array.from({length:26},(e,t)=>String.fromCharCode(t+97)),gh=e=>No[Math.floor(e()*No.length)],mh=({globalObj:e=typeof global<"u"?global:typeof window<"u"?window:{},random:t=zs}={})=>{const n=Object.keys(e).toString(),r=n.length?n+Di(bn,t):Di(bn,t);return gl(r).substring(0,bn)},yh=e=>()=>e++,_h=476782367,Dn=({random:e=zs,counter:t=yh(Math.floor(e()*_h)),length:n=fh,fingerprint:r=mh({random:e})}={})=>{if(n>bn)throw new Error(`Length must be between 2 and ${bn}. Received: ${n}`);return function(){const s=gh(e),o=Date.now().toString(36),a=t().toString(36),l=Di(n,e),c=`${o+l+a+r}`;return`${s+gl(c).substring(1,n)}`}};Dn();(!globalThis.EventTarget||!globalThis.Event)&&console.error(`
  PartySocket requires a global 'EventTarget' class to be available!
  You can polyfill this global by adding this to your code before any partysocket imports: 
  
  \`\`\`
  import 'partysocket/event-target-polyfill';
  \`\`\`
  Please file an issue at https://github.com/partykit/partykit if you're still having trouble.
`);var ml=class extends Event{message;error;constructor(e,t){super("error",t),this.message=e.message,this.error=e}},yl=class extends Event{code;reason;wasClean=!0;constructor(e=1e3,t="",n){super("close",n),this.code=e,this.reason=t}};const wi={Event,ErrorEvent:ml,CloseEvent:yl};function wh(e,t){if(!e)throw new Error(t)}function vh(e){return new e.constructor(e.type,e)}function xh(e){return"data"in e?new MessageEvent(e.type,e):"code"in e||"reason"in e?new yl(e.code||1999,e.reason||"unknown reason",e):"error"in e?new ml(e.error,e):new Event(e.type,e)}const Wn=typeof process<"u"&&typeof process.versions?.node<"u"&&typeof document>"u"?xh:vh,Ee={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:Number.POSITIVE_INFINITY,maxEnqueuedMessages:Number.POSITIVE_INFINITY};let ko=!1;var bh=class $e extends EventTarget{_ws;_retryCount=-1;_uptimeTimeout;_connectTimeout;_shouldReconnect=!0;_connectLock=!1;_binaryType="blob";_closeCalled=!1;_messageQueue=[];_debugLogger=console.log.bind(console);_url;_protocols;_options;constructor(t,n,r={}){super(),this._url=t,this._protocols=n,this._options=r,this._options.startClosed&&(this._shouldReconnect=!1),this._options.debugLogger&&(this._debugLogger=this._options.debugLogger),this._connect()}static get CONNECTING(){return 0}static get OPEN(){return 1}static get CLOSING(){return 2}static get CLOSED(){return 3}get CONNECTING(){return $e.CONNECTING}get OPEN(){return $e.OPEN}get CLOSING(){return $e.CLOSING}get CLOSED(){return $e.CLOSED}get binaryType(){return this._ws?this._ws.binaryType:this._binaryType}set binaryType(t){this._binaryType=t,this._ws&&(this._ws.binaryType=t)}get retryCount(){return Math.max(this._retryCount,0)}get bufferedAmount(){return this._messageQueue.reduce((t,n)=>(typeof n=="string"?t+=n.length:n instanceof Blob?t+=n.size:t+=n.byteLength,t),0)+(this._ws?this._ws.bufferedAmount:0)}get extensions(){return this._ws?this._ws.extensions:""}get protocol(){return this._ws?this._ws.protocol:""}get readyState(){return this._ws?this._ws.readyState:this._options.startClosed?$e.CLOSED:$e.CONNECTING}get url(){return this._ws?this._ws.url:""}get shouldReconnect(){return this._shouldReconnect}onclose=null;onerror=null;onmessage=null;onopen=null;close(t=1e3,n){if(this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(t,n)}reconnect(t,n){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(t,n),this._connect())}send(t){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",t),this._ws.send(t);else{const{maxEnqueuedMessages:n=Ee.maxEnqueuedMessages}=this._options;this._messageQueue.length<n&&(this._debug("enqueue",t),this._messageQueue.push(t))}}_debug(...t){this._options.debug&&this._debugLogger("RWS>",...t)}_getNextDelay(){const{reconnectionDelayGrowFactor:t=Ee.reconnectionDelayGrowFactor,minReconnectionDelay:n=Ee.minReconnectionDelay,maxReconnectionDelay:r=Ee.maxReconnectionDelay}=this._options;let i=0;return this._retryCount>0&&(i=n*t**(this._retryCount-1),i>r&&(i=r)),this._debug("next delay",i),i}_wait(){return new Promise(t=>{setTimeout(t,this._getNextDelay())})}_getNextProtocols(t){if(!t)return Promise.resolve(null);if(typeof t=="string"||Array.isArray(t))return Promise.resolve(t);if(typeof t=="function"){const n=t();if(!n)return Promise.resolve(null);if(typeof n=="string"||Array.isArray(n))return Promise.resolve(n);if(n.then)return n}throw Error("Invalid protocols")}_getNextUrl(t){if(typeof t=="string")return Promise.resolve(t);if(typeof t=="function"){const n=t();if(typeof n=="string")return Promise.resolve(n);if(n.then)return n}throw Error("Invalid URL")}_connect(){if(this._connectLock||!this._shouldReconnect)return;this._connectLock=!0;const{maxRetries:t=Ee.maxRetries,connectionTimeout:n=Ee.connectionTimeout}=this._options;if(this._retryCount>=t){this._debug("max retries reached",this._retryCount,">=",t);return}this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),this._wait().then(()=>Promise.all([this._getNextUrl(this._url),this._getNextProtocols(this._protocols||null)])).then(([r,i])=>{if(this._closeCalled){this._connectLock=!1;return}!this._options.WebSocket&&typeof WebSocket>"u"&&!ko&&(console.error(`‼️ No WebSocket implementation available. You should define options.WebSocket. 

For example, if you're using node.js, run \`npm install ws\`, and then in your code:

import PartySocket from 'partysocket';
import WS from 'ws';

const partysocket = new PartySocket({
  host: "127.0.0.1:1999",
  room: "test-room",
  WebSocket: WS
});

`),ko=!0);const s=this._options.WebSocket||WebSocket;this._debug("connect",{url:r,protocols:i}),this._ws=i?new s(r,i):new s(r),this._ws.binaryType=this._binaryType,this._connectLock=!1,this._addListeners(),this._connectTimeout=setTimeout(()=>this._handleTimeout(),n)}).catch(r=>{this._connectLock=!1,this._handleError(new wi.ErrorEvent(Error(r.message),this))})}_handleTimeout(){this._debug("timeout event"),this._handleError(new wi.ErrorEvent(Error("TIMEOUT"),this))}_disconnect(t=1e3,n){if(this._clearTimeouts(),!!this._ws){this._removeListeners();try{(this._ws.readyState===this.OPEN||this._ws.readyState===this.CONNECTING)&&this._ws.close(t,n),this._handleClose(new wi.CloseEvent(t,n,this))}catch{}}}_acceptOpen(){this._debug("accept open"),this._retryCount=0}_handleOpen=t=>{this._debug("open event");const{minUptime:n=Ee.minUptime}=this._options;clearTimeout(this._connectTimeout),this._uptimeTimeout=setTimeout(()=>this._acceptOpen(),n),wh(this._ws,"WebSocket is not defined"),this._ws.binaryType=this._binaryType,this._messageQueue.forEach(r=>{this._ws?.send(r)}),this._messageQueue=[],this.onopen&&this.onopen(t),this.dispatchEvent(Wn(t))};_handleMessage=t=>{this._debug("message event"),this.onmessage&&this.onmessage(t),this.dispatchEvent(Wn(t))};_handleError=t=>{this._debug("error event",t.message),this._disconnect(void 0,t.message==="TIMEOUT"?"timeout":void 0),this.onerror&&this.onerror(t),this._debug("exec error listeners"),this.dispatchEvent(Wn(t)),this._connect()};_handleClose=t=>{this._debug("close event"),this._clearTimeouts(),this._shouldReconnect&&this._connect(),this.onclose&&this.onclose(t),this.dispatchEvent(Wn(t))};_removeListeners(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))}_addListeners(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))}_clearTimeouts(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)}};const Sh=e=>e[1]!==null&&e[1]!==void 0;function Eh(){if(crypto?.randomUUID)return crypto.randomUUID();let e=Date.now(),t=performance?.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){let r=Math.random()*16;return e>0?(r=(e+r)%16|0,e=Math.floor(e/16)):(r=(t+r)%16|0,t=Math.floor(t/16)),(n==="x"?r:r&3|8).toString(16)})}function _l(e,t,n={}){const{host:r,path:i,protocol:s,room:o,party:a,basePath:l,prefix:c,query:h}=e;let u=r.replace(/^(http|https|ws|wss):\/\//,"");if(u.endsWith("/")&&(u=u.slice(0,-1)),i?.startsWith("/"))throw new Error("path must not start with a slash");const f=a??"main",_=i?`/${i}`:"",b=s||(u.startsWith("localhost:")||u.startsWith("127.0.0.1:")||u.startsWith("192.168.")||u.startsWith("10.")||u.startsWith("172.")&&u.split(".")[1]>="16"&&u.split(".")[1]<="31"||u.startsWith("[::ffff:7f00:1]:")?t:`${t}s`),A=`${b}://${u}/${l||`${c||"parties"}/${f}/${o}`}${_}`,N=($={})=>`${A}?${new URLSearchParams([...Object.entries(n),...Object.entries($).filter(Sh)])}`,I=typeof h=="function"?async()=>N(await h()):N(h);return{host:u,path:_,room:o,name:f,protocol:b,partyUrl:A,urlProvider:I}}var vi=class extends bh{_pk;_pkurl;name;room;host;path;constructor(e){const t=Co(e);super(t.urlProvider,t.protocols,t.socketOptions),this.partySocketOptions=e,this.setWSProperties(t),e.disableNameValidation||(e.party?.includes("/")&&console.warn(`PartySocket: party name "${e.party}" contains forward slash which may cause routing issues. Consider using a name without forward slashes or set disableNameValidation: true to bypass this warning.`),e.room?.includes("/")&&console.warn(`PartySocket: room name "${e.room}" contains forward slash which may cause routing issues. Consider using a name without forward slashes or set disableNameValidation: true to bypass this warning.`))}updateProperties(e){const t=Co({...this.partySocketOptions,...e,host:e.host??this.host,room:e.room??this.room,path:e.path??this.path});this._url=t.urlProvider,this._protocols=t.protocols,this._options=t.socketOptions,this.setWSProperties(t)}setWSProperties(e){const{_pk:t,_pkurl:n,name:r,room:i,host:s,path:o}=e;this._pk=t,this._pkurl=n,this.name=r,this.room=i,this.host=s,this.path=o}reconnect(e,t){if(!this.room||!this.host)throw new Error("The room and host must be set before connecting, use `updateProperties` method to set them or pass them to the constructor.");super.reconnect(e,t)}get id(){return this._pk}get roomUrl(){return this._pkurl}static async fetch(e,t){const n=_l(e,"http"),r=typeof n.urlProvider=="string"?n.urlProvider:await n.urlProvider();return(e.fetch??fetch)(r,t)}};function Co(e){const{id:t,host:n,path:r,party:i,room:s,protocol:o,query:a,protocols:l,...c}=e,h=t||Eh(),u=_l(e,"ws",{_pk:h});return{_pk:h,_pkurl:u.partyUrl,name:u.name,room:u.room,host:u.host,path:u.path,protocols:l,socketOptions:c,urlProvider:u.urlProvider}}const Mh={DEV:!1,PROD:!0},vr=750,ye=750,$h="Orthographic",Ah=500,Ih=2,Th=25,Ph=1,Nh=1,wl=40,kh=!0,Ch=384,zi=1,Oh=4,Lh=.1,vl=Mh||{},xr=vl.DEV??!0,Rh=vl.PROD??!1,Dh=Rh,zh=xr,xl=xr,Uh=["#c0392b","#f1c40f","#9b59b6","#00b386","#cc6600","#0a4c8c"];function bl(e,t){let n,r;for(const i of e)i!=null&&(n===void 0?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)));return[n,r]}class qt{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let r=0;for(let i=0;i<this._n&&i<32;i++){const s=n[i],o=t+s,a=Math.abs(t)<Math.abs(s)?t-(o-s):s-(o-t);a&&(n[r++]=a),t=o}return n[r]=t,this._n=r+1,this}valueOf(){const t=this._partials;let n=this._n,r,i,s,o=0;if(n>0){for(o=t[--n];n>0&&(r=o,i=t[--n],o=r+i,s=i-(o-r),!s););n>0&&(s<0&&t[n-1]<0||s>0&&t[n-1]>0)&&(i=s*2,r=o+i,i==r-o&&(o=r))}return o}}function Oo(e,t){let n=0,r=0;if(t===void 0)for(let i of e)i!=null&&(i=+i)>=i&&(++n,r+=i);else{let i=-1;for(let s of e)(s=t(s,++i,e))!=null&&(s=+s)>=s&&(++n,r+=s)}if(n)return r/n}function*Bh(e){for(const t of e)yield*t}function Sl(e){return Array.from(Bh(e))}function Ge(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,s=new Array(i);++r<i;)s[r]=e+r*n;return s}var Fh={value:()=>{}};function ri(){for(var e=0,t=arguments.length,n={},r;e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new cr(n)}function cr(e){this._=e}function Hh(e,t){return e.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}cr.prototype=ri.prototype={constructor:cr,on:function(e,t){var n=this._,r=Hh(e+"",n),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(e=r[s]).type)&&(i=qh(n[i],e.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<o;)if(i=(e=r[s]).type)n[i]=Lo(n[i],e.name,t);else if(t==null)for(i in n)n[i]=Lo(n[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new cr(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,s;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],r=0,i=s.length;r<i;++r)s[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,s=r.length;i<s;++i)r[i].value.apply(t,n)}};function qh(e,t){for(var n=0,r=e.length,i;n<r;++n)if((i=e[n]).name===t)return i.value}function Lo(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=Fh,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}var Ui="http://www.w3.org/1999/xhtml";const Ro={svg:"http://www.w3.org/2000/svg",xhtml:Ui,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ii(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),Ro.hasOwnProperty(t)?{space:Ro[t],local:e}:e}function Gh(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Ui&&t.documentElement.namespaceURI===Ui?t.createElement(e):t.createElementNS(n,e)}}function jh(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function El(e){var t=ii(e);return(t.local?jh:Gh)(t)}function Wh(){}function Us(e){return e==null?Wh:function(){return this.querySelector(e)}}function Yh(e){typeof e!="function"&&(e=Us(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,a=r[i]=new Array(o),l,c,h=0;h<o;++h)(l=s[h])&&(c=e.call(l,l.__data__,h,s))&&("__data__"in l&&(c.__data__=l.__data__),a[h]=c);return new Tt(r,this._parents)}function Vh(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function Xh(){return[]}function Ml(e){return e==null?Xh:function(){return this.querySelectorAll(e)}}function Kh(e){return function(){return Vh(e.apply(this,arguments))}}function Qh(e){typeof e=="function"?e=Kh(e):e=Ml(e);for(var t=this._groups,n=t.length,r=[],i=[],s=0;s<n;++s)for(var o=t[s],a=o.length,l,c=0;c<a;++c)(l=o[c])&&(r.push(e.call(l,l.__data__,c,o)),i.push(l));return new Tt(r,i)}function $l(e){return function(){return this.matches(e)}}function Al(e){return function(t){return t.matches(e)}}var Zh=Array.prototype.find;function Jh(e){return function(){return Zh.call(this.children,e)}}function tf(){return this.firstElementChild}function ef(e){return this.select(e==null?tf:Jh(typeof e=="function"?e:Al(e)))}var nf=Array.prototype.filter;function rf(){return Array.from(this.children)}function sf(e){return function(){return nf.call(this.children,e)}}function of(e){return this.selectAll(e==null?rf:sf(typeof e=="function"?e:Al(e)))}function af(e){typeof e!="function"&&(e=$l(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,a=r[i]=[],l,c=0;c<o;++c)(l=s[c])&&e.call(l,l.__data__,c,s)&&a.push(l);return new Tt(r,this._parents)}function Il(e){return new Array(e.length)}function lf(){return new Tt(this._enter||this._groups.map(Il),this._parents)}function br(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}br.prototype={constructor:br,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function uf(e){return function(){return e}}function cf(e,t,n,r,i,s){for(var o=0,a,l=t.length,c=s.length;o<c;++o)(a=t[o])?(a.__data__=s[o],r[o]=a):n[o]=new br(e,s[o]);for(;o<l;++o)(a=t[o])&&(i[o]=a)}function hf(e,t,n,r,i,s,o){var a,l,c=new Map,h=t.length,u=s.length,f=new Array(h),_;for(a=0;a<h;++a)(l=t[a])&&(f[a]=_=o.call(l,l.__data__,a,t)+"",c.has(_)?i[a]=l:c.set(_,l));for(a=0;a<u;++a)_=o.call(e,s[a],a,s)+"",(l=c.get(_))?(r[a]=l,l.__data__=s[a],c.delete(_)):n[a]=new br(e,s[a]);for(a=0;a<h;++a)(l=t[a])&&c.get(f[a])===l&&(i[a]=l)}function ff(e){return e.__data__}function df(e,t){if(!arguments.length)return Array.from(this,ff);var n=t?hf:cf,r=this._parents,i=this._groups;typeof e!="function"&&(e=uf(e));for(var s=i.length,o=new Array(s),a=new Array(s),l=new Array(s),c=0;c<s;++c){var h=r[c],u=i[c],f=u.length,_=pf(e.call(h,h&&h.__data__,c,r)),b=_.length,A=a[c]=new Array(b),N=o[c]=new Array(b),I=l[c]=new Array(f);n(h,u,A,N,I,_,t);for(var $=0,C=0,k,O;$<b;++$)if(k=A[$]){for($>=C&&(C=$+1);!(O=N[C])&&++C<b;);k._next=O||null}}return o=new Tt(o,r),o._enter=a,o._exit=l,o}function pf(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function gf(){return new Tt(this._exit||this._groups.map(Il),this._parents)}function mf(e,t,n){var r=this.enter(),i=this,s=this.exit();return typeof e=="function"?(r=e(r),r&&(r=r.selection())):r=r.append(e+""),t!=null&&(i=t(i),i&&(i=i.selection())),n==null?s.remove():n(s),r&&i?r.merge(i).order():i}function yf(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,i=n.length,s=r.length,o=Math.min(i,s),a=new Array(i),l=0;l<o;++l)for(var c=n[l],h=r[l],u=c.length,f=a[l]=new Array(u),_,b=0;b<u;++b)(_=c[b]||h[b])&&(f[b]=_);for(;l<i;++l)a[l]=n[l];return new Tt(a,this._parents)}function _f(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r=e[t],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function wf(e){e||(e=vf);function t(u,f){return u&&f?e(u.__data__,f.__data__):!u-!f}for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o=n[s],a=o.length,l=i[s]=new Array(a),c,h=0;h<a;++h)(c=o[h])&&(l[h]=c);l.sort(t)}return new Tt(i,this._parents).order()}function vf(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function xf(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function bf(){return Array.from(this)}function Sf(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function Ef(){let e=0;for(const t of this)++e;return e}function Mf(){return!this.node()}function $f(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i=t[n],s=0,o=i.length,a;s<o;++s)(a=i[s])&&e.call(a,a.__data__,s,i);return this}function Af(e){return function(){this.removeAttribute(e)}}function If(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Tf(e,t){return function(){this.setAttribute(e,t)}}function Pf(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Nf(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function kf(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Cf(e,t){var n=ii(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((t==null?n.local?If:Af:typeof t=="function"?n.local?kf:Nf:n.local?Pf:Tf)(n,t))}function Tl(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Of(e){return function(){this.style.removeProperty(e)}}function Lf(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Rf(e,t,n){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function Df(e,t,n){return arguments.length>1?this.each((t==null?Of:typeof t=="function"?Rf:Lf)(e,t,n??"")):Ke(this.node(),e)}function Ke(e,t){return e.style.getPropertyValue(t)||Tl(e).getComputedStyle(e,null).getPropertyValue(t)}function zf(e){return function(){delete this[e]}}function Uf(e,t){return function(){this[e]=t}}function Bf(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function Ff(e,t){return arguments.length>1?this.each((t==null?zf:typeof t=="function"?Bf:Uf)(e,t)):this.node()[e]}function Pl(e){return e.trim().split(/^|\s+/)}function Bs(e){return e.classList||new Nl(e)}function Nl(e){this._node=e,this._names=Pl(e.getAttribute("class")||"")}Nl.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function kl(e,t){for(var n=Bs(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function Cl(e,t){for(var n=Bs(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function Hf(e){return function(){kl(this,e)}}function qf(e){return function(){Cl(this,e)}}function Gf(e,t){return function(){(t.apply(this,arguments)?kl:Cl)(this,e)}}function jf(e,t){var n=Pl(e+"");if(arguments.length<2){for(var r=Bs(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof t=="function"?Gf:t?Hf:qf)(n,t))}function Wf(){this.textContent=""}function Yf(e){return function(){this.textContent=e}}function Vf(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Xf(e){return arguments.length?this.each(e==null?Wf:(typeof e=="function"?Vf:Yf)(e)):this.node().textContent}function Kf(){this.innerHTML=""}function Qf(e){return function(){this.innerHTML=e}}function Zf(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Jf(e){return arguments.length?this.each(e==null?Kf:(typeof e=="function"?Zf:Qf)(e)):this.node().innerHTML}function t0(){this.nextSibling&&this.parentNode.appendChild(this)}function e0(){return this.each(t0)}function n0(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function r0(){return this.each(n0)}function i0(e){var t=typeof e=="function"?e:El(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function s0(){return null}function o0(e,t){var n=typeof e=="function"?e:El(e),r=t==null?s0:typeof t=="function"?t:Us(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function a0(){var e=this.parentNode;e&&e.removeChild(this)}function l0(){return this.each(a0)}function u0(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function c0(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function h0(e){return this.select(e?c0:u0)}function f0(e){return arguments.length?this.property("__data__",e):this.node().__data__}function d0(e){return function(t){e.call(this,t,this.__data__)}}function p0(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}function g0(e){return function(){var t=this.__on;if(t){for(var n=0,r=-1,i=t.length,s;n<i;++n)s=t[n],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.options):t[++r]=s;++r?t.length=r:delete this.__on}}}function m0(e,t,n){return function(){var r=this.__on,i,s=d0(t);if(r){for(var o=0,a=r.length;o<a;++o)if((i=r[o]).type===e.type&&i.name===e.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=n),i.value=t;return}}this.addEventListener(e.type,s,n),i={type:e.type,name:e.name,value:t,listener:s,options:n},r?r.push(i):this.__on=[i]}}function y0(e,t,n){var r=p0(e+""),i,s=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,h;l<c;++l)for(i=0,h=a[l];i<s;++i)if((o=r[i]).type===h.type&&o.name===h.name)return h.value}return}for(a=t?m0:g0,i=0;i<s;++i)this.each(a(r[i],t,n));return this}function Ol(e,t,n){var r=Tl(e),i=r.CustomEvent;typeof i=="function"?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function _0(e,t){return function(){return Ol(this,e,t)}}function w0(e,t){return function(){return Ol(this,e,t.apply(this,arguments))}}function v0(e,t){return this.each((typeof t=="function"?w0:_0)(e,t))}function*x0(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var Ll=[null];function Tt(e,t){this._groups=e,this._parents=t}function zn(){return new Tt([[document.documentElement]],Ll)}function b0(){return this}Tt.prototype=zn.prototype={constructor:Tt,select:Yh,selectAll:Qh,selectChild:ef,selectChildren:of,filter:af,data:df,enter:lf,exit:gf,join:mf,merge:yf,selection:b0,order:_f,sort:wf,call:xf,nodes:bf,node:Sf,size:Ef,empty:Mf,each:$f,attr:Cf,style:Df,property:Ff,classed:jf,text:Xf,html:Jf,raise:e0,lower:r0,append:i0,insert:o0,remove:l0,clone:h0,datum:f0,on:y0,dispatch:v0,[Symbol.iterator]:x0};function dt(e){return typeof e=="string"?new Tt([[document.querySelector(e)]],[document.documentElement]):new Tt([[e]],Ll)}function Rl(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Wt(e,t){if(e=Rl(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}function S0(e,t){return e.target&&(e=Rl(e),t===void 0&&(t=e.currentTarget),e=e.touches||[e]),Array.from(e,n=>Wt(n,t))}const E0={passive:!1},An={capture:!0,passive:!1};function xi(e){e.stopImmediatePropagation()}function Ye(e){e.preventDefault(),e.stopImmediatePropagation()}function Dl(e){var t=e.document.documentElement,n=dt(e).on("dragstart.drag",Ye,An);"onselectstart"in t?n.on("selectstart.drag",Ye,An):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function zl(e,t){var n=e.document.documentElement,r=dt(e).on("dragstart.drag",null);t&&(r.on("click.drag",Ye,An),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Yn=e=>()=>e;function Bi(e,{sourceEvent:t,subject:n,target:r,identifier:i,active:s,x:o,y:a,dx:l,dy:c,dispatch:h}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:h}})}Bi.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function M0(e){return!e.ctrlKey&&!e.button}function $0(){return this.parentNode}function A0(e,t){return t??{x:e.x,y:e.y}}function I0(){return navigator.maxTouchPoints||"ontouchstart"in this}function T0(){var e=M0,t=$0,n=A0,r=I0,i={},s=ri("start","drag","end"),o=0,a,l,c,h,u=0;function f(k){k.on("mousedown.drag",_).filter(r).on("touchstart.drag",N).on("touchmove.drag",I,E0).on("touchend.drag touchcancel.drag",$).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function _(k,O){if(!(h||!e.call(this,k,O))){var L=C(this,t.call(this,k,O),k,O,"mouse");L&&(dt(k.view).on("mousemove.drag",b,An).on("mouseup.drag",A,An),Dl(k.view),xi(k),c=!1,a=k.clientX,l=k.clientY,L("start",k))}}function b(k){if(Ye(k),!c){var O=k.clientX-a,L=k.clientY-l;c=O*O+L*L>u}i.mouse("drag",k)}function A(k){dt(k.view).on("mousemove.drag mouseup.drag",null),zl(k.view,c),Ye(k),i.mouse("end",k)}function N(k,O){if(e.call(this,k,O)){var L=k.changedTouches,z=t.call(this,k,O),d=L.length,g,w;for(g=0;g<d;++g)(w=C(this,z,k,O,L[g].identifier,L[g]))&&(xi(k),w("start",k,L[g]))}}function I(k){var O=k.changedTouches,L=O.length,z,d;for(z=0;z<L;++z)(d=i[O[z].identifier])&&(Ye(k),d("drag",k,O[z]))}function $(k){var O=k.changedTouches,L=O.length,z,d;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),z=0;z<L;++z)(d=i[O[z].identifier])&&(xi(k),d("end",k,O[z]))}function C(k,O,L,z,d,g){var w=s.copy(),v=Wt(g||L,O),S,M,y;if((y=n.call(k,new Bi("beforestart",{sourceEvent:L,target:f,identifier:d,active:o,x:v[0],y:v[1],dx:0,dy:0,dispatch:w}),z))!=null)return S=y.x-v[0]||0,M=y.y-v[1]||0,function p(m,x,E){var T=v,R;switch(m){case"start":i[d]=p,R=o++;break;case"end":delete i[d],--o;case"drag":v=Wt(E||x,O),R=o;break}w.call(m,k,new Bi(m,{sourceEvent:x,subject:y,target:f,identifier:d,active:R,x:v[0]+S,y:v[1]+M,dx:v[0]-T[0],dy:v[1]-T[1],dispatch:w}),z)}}return f.filter=function(k){return arguments.length?(e=typeof k=="function"?k:Yn(!!k),f):e},f.container=function(k){return arguments.length?(t=typeof k=="function"?k:Yn(k),f):t},f.subject=function(k){return arguments.length?(n=typeof k=="function"?k:Yn(k),f):n},f.touchable=function(k){return arguments.length?(r=typeof k=="function"?k:Yn(!!k),f):r},f.on=function(){var k=s.on.apply(s,arguments);return k===s?f:k},f.clickDistance=function(k){return arguments.length?(u=(k=+k)*k,f):Math.sqrt(u)},f}function Fs(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Ul(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Un(){}var In=.7,Sr=1/In,Ve="\\s*([+-]?\\d+)\\s*",Tn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Zt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",P0=/^#([0-9a-f]{3,8})$/,N0=new RegExp(`^rgb\\(${Ve},${Ve},${Ve}\\)$`),k0=new RegExp(`^rgb\\(${Zt},${Zt},${Zt}\\)$`),C0=new RegExp(`^rgba\\(${Ve},${Ve},${Ve},${Tn}\\)$`),O0=new RegExp(`^rgba\\(${Zt},${Zt},${Zt},${Tn}\\)$`),L0=new RegExp(`^hsl\\(${Tn},${Zt},${Zt}\\)$`),R0=new RegExp(`^hsla\\(${Tn},${Zt},${Zt},${Tn}\\)$`),Do={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Fs(Un,Pn,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:zo,formatHex:zo,formatHex8:D0,formatHsl:z0,formatRgb:Uo,toString:Uo});function zo(){return this.rgb().formatHex()}function D0(){return this.rgb().formatHex8()}function z0(){return Bl(this).formatHsl()}function Uo(){return this.rgb().formatRgb()}function Pn(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=P0.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Bo(t):n===3?new Et(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?Vn(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?Vn(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=N0.exec(e))?new Et(t[1],t[2],t[3],1):(t=k0.exec(e))?new Et(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=C0.exec(e))?Vn(t[1],t[2],t[3],t[4]):(t=O0.exec(e))?Vn(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=L0.exec(e))?qo(t[1],t[2]/100,t[3]/100,1):(t=R0.exec(e))?qo(t[1],t[2]/100,t[3]/100,t[4]):Do.hasOwnProperty(e)?Bo(Do[e]):e==="transparent"?new Et(NaN,NaN,NaN,0):null}function Bo(e){return new Et(e>>16&255,e>>8&255,e&255,1)}function Vn(e,t,n,r){return r<=0&&(e=t=n=NaN),new Et(e,t,n,r)}function U0(e){return e instanceof Un||(e=Pn(e)),e?(e=e.rgb(),new Et(e.r,e.g,e.b,e.opacity)):new Et}function Fi(e,t,n,r){return arguments.length===1?U0(e):new Et(e,t,n,r??1)}function Et(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}Fs(Et,Fi,Ul(Un,{brighter(e){return e=e==null?Sr:Math.pow(Sr,e),new Et(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?In:Math.pow(In,e),new Et(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Et(Ce(this.r),Ce(this.g),Ce(this.b),Er(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Fo,formatHex:Fo,formatHex8:B0,formatRgb:Ho,toString:Ho}));function Fo(){return`#${Ie(this.r)}${Ie(this.g)}${Ie(this.b)}`}function B0(){return`#${Ie(this.r)}${Ie(this.g)}${Ie(this.b)}${Ie((isNaN(this.opacity)?1:this.opacity)*255)}`}function Ho(){const e=Er(this.opacity);return`${e===1?"rgb(":"rgba("}${Ce(this.r)}, ${Ce(this.g)}, ${Ce(this.b)}${e===1?")":`, ${e})`}`}function Er(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Ce(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Ie(e){return e=Ce(e),(e<16?"0":"")+e.toString(16)}function qo(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Ft(e,t,n,r)}function Bl(e){if(e instanceof Ft)return new Ft(e.h,e.s,e.l,e.opacity);if(e instanceof Un||(e=Pn(e)),!e)return new Ft;if(e instanceof Ft)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),s=Math.max(t,n,r),o=NaN,a=s-i,l=(s+i)/2;return a?(t===s?o=(n-r)/a+(n<r)*6:n===s?o=(r-t)/a+2:o=(t-n)/a+4,a/=l<.5?s+i:2-s-i,o*=60):a=l>0&&l<1?0:o,new Ft(o,a,l,e.opacity)}function F0(e,t,n,r){return arguments.length===1?Bl(e):new Ft(e,t,n,r??1)}function Ft(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}Fs(Ft,F0,Ul(Un,{brighter(e){return e=e==null?Sr:Math.pow(Sr,e),new Ft(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?In:Math.pow(In,e),new Ft(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Et(bi(e>=240?e-240:e+120,i,r),bi(e,i,r),bi(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new Ft(Go(this.h),Xn(this.s),Xn(this.l),Er(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Er(this.opacity);return`${e===1?"hsl(":"hsla("}${Go(this.h)}, ${Xn(this.s)*100}%, ${Xn(this.l)*100}%${e===1?")":`, ${e})`}`}}));function Go(e){return e=(e||0)%360,e<0?e+360:e}function Xn(e){return Math.max(0,Math.min(1,e||0))}function bi(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Fl=e=>()=>e;function H0(e,t){return function(n){return e+n*t}}function q0(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function G0(e){return(e=+e)==1?Hl:function(t,n){return n-t?q0(t,n,e):Fl(isNaN(t)?n:t)}}function Hl(e,t){var n=t-e;return n?H0(e,n):Fl(isNaN(e)?t:e)}const jo=(function e(t){var n=G0(t);function r(i,s){var o=n((i=Fi(i)).r,(s=Fi(s)).r),a=n(i.g,s.g),l=n(i.b,s.b),c=Hl(i.opacity,s.opacity);return function(h){return i.r=o(h),i.g=a(h),i.b=l(h),i.opacity=c(h),i+""}}return r.gamma=e,r})(1);function pe(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var Hi=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Si=new RegExp(Hi.source,"g");function j0(e){return function(){return e}}function W0(e){return function(t){return e(t)+""}}function Y0(e,t){var n=Hi.lastIndex=Si.lastIndex=0,r,i,s,o=-1,a=[],l=[];for(e=e+"",t=t+"";(r=Hi.exec(e))&&(i=Si.exec(t));)(s=i.index)>n&&(s=t.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,l.push({i:o,x:pe(r,i)})),n=Si.lastIndex;return n<t.length&&(s=t.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?W0(l[0].x):j0(t):(t=l.length,function(c){for(var h=0,u;h<t;++h)a[(u=l[h]).i]=u.x(c);return a.join("")})}var Wo=180/Math.PI,qi={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ql(e,t,n,r,i,s){var o,a,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,l/=a),e*r<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*Wo,skewX:Math.atan(l)*Wo,scaleX:o,scaleY:a}}var Kn;function V0(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?qi:ql(t.a,t.b,t.c,t.d,t.e,t.f)}function X0(e){return e==null||(Kn||(Kn=document.createElementNS("http://www.w3.org/2000/svg","g")),Kn.setAttribute("transform",e),!(e=Kn.transform.baseVal.consolidate()))?qi:(e=e.matrix,ql(e.a,e.b,e.c,e.d,e.e,e.f))}function Gl(e,t,n,r){function i(c){return c.length?c.pop()+" ":""}function s(c,h,u,f,_,b){if(c!==u||h!==f){var A=_.push("translate(",null,t,null,n);b.push({i:A-4,x:pe(c,u)},{i:A-2,x:pe(h,f)})}else(u||f)&&_.push("translate("+u+t+f+n)}function o(c,h,u,f){c!==h?(c-h>180?h+=360:h-c>180&&(c+=360),f.push({i:u.push(i(u)+"rotate(",null,r)-2,x:pe(c,h)})):h&&u.push(i(u)+"rotate("+h+r)}function a(c,h,u,f){c!==h?f.push({i:u.push(i(u)+"skewX(",null,r)-2,x:pe(c,h)}):h&&u.push(i(u)+"skewX("+h+r)}function l(c,h,u,f,_,b){if(c!==u||h!==f){var A=_.push(i(_)+"scale(",null,",",null,")");b.push({i:A-4,x:pe(c,u)},{i:A-2,x:pe(h,f)})}else(u!==1||f!==1)&&_.push(i(_)+"scale("+u+","+f+")")}return function(c,h){var u=[],f=[];return c=e(c),h=e(h),s(c.translateX,c.translateY,h.translateX,h.translateY,u,f),o(c.rotate,h.rotate,u,f),a(c.skewX,h.skewX,u,f),l(c.scaleX,c.scaleY,h.scaleX,h.scaleY,u,f),c=h=null,function(_){for(var b=-1,A=f.length,N;++b<A;)u[(N=f[b]).i]=N.x(_);return u.join("")}}}var K0=Gl(V0,"px, ","px)","deg)"),Q0=Gl(X0,", ",")",")"),Z0=1e-12;function Yo(e){return((e=Math.exp(e))+1/e)/2}function J0(e){return((e=Math.exp(e))-1/e)/2}function td(e){return((e=Math.exp(2*e))-1)/(e+1)}const ed=(function e(t,n,r){function i(s,o){var a=s[0],l=s[1],c=s[2],h=o[0],u=o[1],f=o[2],_=h-a,b=u-l,A=_*_+b*b,N,I;if(A<Z0)I=Math.log(f/c)/t,N=function(z){return[a+z*_,l+z*b,c*Math.exp(t*z*I)]};else{var $=Math.sqrt(A),C=(f*f-c*c+r*A)/(2*c*n*$),k=(f*f-c*c-r*A)/(2*f*n*$),O=Math.log(Math.sqrt(C*C+1)-C),L=Math.log(Math.sqrt(k*k+1)-k);I=(L-O)/t,N=function(z){var d=z*I,g=Yo(O),w=c/(n*$)*(g*td(t*d+O)-J0(O));return[a+w*_,l+w*b,c*g/Yo(t*d+O)]}}return N.duration=I*1e3*t/Math.SQRT2,N}return i.rho=function(s){var o=Math.max(.001,+s),a=o*o,l=a*a;return e(o,a,l)},i})(Math.SQRT2,2,4);var Qe=0,dn=0,cn=0,jl=1e3,Mr,pn,$r=0,Re=0,si=0,Nn=typeof performance=="object"&&performance.now?performance:Date,Wl=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Hs(){return Re||(Wl(nd),Re=Nn.now()+si)}function nd(){Re=0}function Ar(){this._call=this._time=this._next=null}Ar.prototype=Yl.prototype={constructor:Ar,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Hs():+n)+(t==null?0:+t),!this._next&&pn!==this&&(pn?pn._next=this:Mr=this,pn=this),this._call=e,this._time=n,Gi()},stop:function(){this._call&&(this._call=null,this._time=1/0,Gi())}};function Yl(e,t,n){var r=new Ar;return r.restart(e,t,n),r}function rd(){Hs(),++Qe;for(var e=Mr,t;e;)(t=Re-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Qe}function Vo(){Re=($r=Nn.now())+si,Qe=dn=0;try{rd()}finally{Qe=0,sd(),Re=0}}function id(){var e=Nn.now(),t=e-$r;t>jl&&(si-=t,$r=e)}function sd(){for(var e,t=Mr,n,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Mr=n);pn=e,Gi(r)}function Gi(e){if(!Qe){dn&&(dn=clearTimeout(dn));var t=e-Re;t>24?(e<1/0&&(dn=setTimeout(Vo,e-Nn.now()-si)),cn&&(cn=clearInterval(cn))):(cn||($r=Nn.now(),cn=setInterval(id,jl)),Qe=1,Wl(Vo))}}function Xo(e,t,n){var r=new Ar;return t=t==null?0:+t,r.restart(i=>{r.stop(),e(i+t)},t,n),r}var od=ri("start","end","cancel","interrupt"),ad=[],Vl=0,Ko=1,ji=2,hr=3,Qo=4,Wi=5,fr=6;function oi(e,t,n,r,i,s){var o=e.__transition;if(!o)e.__transition={};else if(n in o)return;ld(e,n,{name:t,index:r,group:i,on:od,tween:ad,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:Vl})}function qs(e,t){var n=Gt(e,t);if(n.state>Vl)throw new Error("too late; already scheduled");return n}function ee(e,t){var n=Gt(e,t);if(n.state>hr)throw new Error("too late; already running");return n}function Gt(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function ld(e,t,n){var r=e.__transition,i;r[t]=n,n.timer=Yl(s,0,n.time);function s(c){n.state=Ko,n.timer.restart(o,n.delay,n.time),n.delay<=c&&o(c-n.delay)}function o(c){var h,u,f,_;if(n.state!==Ko)return l();for(h in r)if(_=r[h],_.name===n.name){if(_.state===hr)return Xo(o);_.state===Qo?(_.state=fr,_.timer.stop(),_.on.call("interrupt",e,e.__data__,_.index,_.group),delete r[h]):+h<t&&(_.state=fr,_.timer.stop(),_.on.call("cancel",e,e.__data__,_.index,_.group),delete r[h])}if(Xo(function(){n.state===hr&&(n.state=Qo,n.timer.restart(a,n.delay,n.time),a(c))}),n.state=ji,n.on.call("start",e,e.__data__,n.index,n.group),n.state===ji){for(n.state=hr,i=new Array(f=n.tween.length),h=0,u=-1;h<f;++h)(_=n.tween[h].value.call(e,e.__data__,n.index,n.group))&&(i[++u]=_);i.length=u+1}}function a(c){for(var h=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(l),n.state=Wi,1),u=-1,f=i.length;++u<f;)i[u].call(e,h);n.state===Wi&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){n.state=fr,n.timer.stop(),delete r[t];for(var c in r)return;delete e.__transition}}function dr(e,t){var n=e.__transition,r,i,s=!0,o;if(n){t=t==null?null:t+"";for(o in n){if((r=n[o]).name!==t){s=!1;continue}i=r.state>ji&&r.state<Wi,r.state=fr,r.timer.stop(),r.on.call(i?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete n[o]}s&&delete e.__transition}}function ud(e){return this.each(function(){dr(this,e)})}function cd(e,t){var n,r;return function(){var i=ee(this,e),s=i.tween;if(s!==n){r=n=s;for(var o=0,a=r.length;o<a;++o)if(r[o].name===t){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function hd(e,t,n){var r,i;if(typeof n!="function")throw new Error;return function(){var s=ee(this,e),o=s.tween;if(o!==r){i=(r=o).slice();for(var a={name:t,value:n},l=0,c=i.length;l<c;++l)if(i[l].name===t){i[l]=a;break}l===c&&i.push(a)}s.tween=i}}function fd(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r=Gt(this.node(),n).tween,i=0,s=r.length,o;i<s;++i)if((o=r[i]).name===e)return o.value;return null}return this.each((t==null?cd:hd)(n,e,t))}function Gs(e,t,n){var r=e._id;return e.each(function(){var i=ee(this,r);(i.value||(i.value={}))[t]=n.apply(this,arguments)}),function(i){return Gt(i,r).value[t]}}function Xl(e,t){var n;return(typeof t=="number"?pe:t instanceof Pn?jo:(n=Pn(t))?(t=n,jo):Y0)(e,t)}function dd(e){return function(){this.removeAttribute(e)}}function pd(e){return function(){this.removeAttributeNS(e.space,e.local)}}function gd(e,t,n){var r,i=n+"",s;return function(){var o=this.getAttribute(e);return o===i?null:o===r?s:s=t(r=o,n)}}function md(e,t,n){var r,i=n+"",s;return function(){var o=this.getAttributeNS(e.space,e.local);return o===i?null:o===r?s:s=t(r=o,n)}}function yd(e,t,n){var r,i,s;return function(){var o,a=n(this),l;return a==null?void this.removeAttribute(e):(o=this.getAttribute(e),l=a+"",o===l?null:o===r&&l===i?s:(i=l,s=t(r=o,a)))}}function _d(e,t,n){var r,i,s;return function(){var o,a=n(this),l;return a==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),l=a+"",o===l?null:o===r&&l===i?s:(i=l,s=t(r=o,a)))}}function wd(e,t){var n=ii(e),r=n==="transform"?Q0:Xl;return this.attrTween(e,typeof t=="function"?(n.local?_d:yd)(n,r,Gs(this,"attr."+e,t)):t==null?(n.local?pd:dd)(n):(n.local?md:gd)(n,r,t))}function vd(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function xd(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function bd(e,t){var n,r;function i(){var s=t.apply(this,arguments);return s!==r&&(n=(r=s)&&xd(e,s)),n}return i._value=t,i}function Sd(e,t){var n,r;function i(){var s=t.apply(this,arguments);return s!==r&&(n=(r=s)&&vd(e,s)),n}return i._value=t,i}function Ed(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var r=ii(e);return this.tween(n,(r.local?bd:Sd)(r,t))}function Md(e,t){return function(){qs(this,e).delay=+t.apply(this,arguments)}}function $d(e,t){return t=+t,function(){qs(this,e).delay=t}}function Ad(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Md:$d)(t,e)):Gt(this.node(),t).delay}function Id(e,t){return function(){ee(this,e).duration=+t.apply(this,arguments)}}function Td(e,t){return t=+t,function(){ee(this,e).duration=t}}function Pd(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Id:Td)(t,e)):Gt(this.node(),t).duration}function Nd(e,t){if(typeof t!="function")throw new Error;return function(){ee(this,e).ease=t}}function kd(e){var t=this._id;return arguments.length?this.each(Nd(t,e)):Gt(this.node(),t).ease}function Cd(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;ee(this,e).ease=n}}function Od(e){if(typeof e!="function")throw new Error;return this.each(Cd(this._id,e))}function Ld(e){typeof e!="function"&&(e=$l(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,a=r[i]=[],l,c=0;c<o;++c)(l=s[c])&&e.call(l,l.__data__,c,s)&&a.push(l);return new ue(r,this._parents,this._name,this._id)}function Rd(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,i=n.length,s=Math.min(r,i),o=new Array(r),a=0;a<s;++a)for(var l=t[a],c=n[a],h=l.length,u=o[a]=new Array(h),f,_=0;_<h;++_)(f=l[_]||c[_])&&(u[_]=f);for(;a<r;++a)o[a]=t[a];return new ue(o,this._parents,this._name,this._id)}function Dd(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function zd(e,t,n){var r,i,s=Dd(t)?qs:ee;return function(){var o=s(this,e),a=o.on;a!==r&&(i=(r=a).copy()).on(t,n),o.on=i}}function Ud(e,t){var n=this._id;return arguments.length<2?Gt(this.node(),n).on.on(e):this.each(zd(n,e,t))}function Bd(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Fd(){return this.on("end.remove",Bd(this._id))}function Hd(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Us(e));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var a=r[o],l=a.length,c=s[o]=new Array(l),h,u,f=0;f<l;++f)(h=a[f])&&(u=e.call(h,h.__data__,f,a))&&("__data__"in h&&(u.__data__=h.__data__),c[f]=u,oi(c[f],t,n,f,c,Gt(h,n)));return new ue(s,this._parents,t,n)}function qd(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Ml(e));for(var r=this._groups,i=r.length,s=[],o=[],a=0;a<i;++a)for(var l=r[a],c=l.length,h,u=0;u<c;++u)if(h=l[u]){for(var f=e.call(h,h.__data__,u,l),_,b=Gt(h,n),A=0,N=f.length;A<N;++A)(_=f[A])&&oi(_,t,n,A,f,b);s.push(f),o.push(h)}return new ue(s,o,t,n)}var Gd=zn.prototype.constructor;function jd(){return new Gd(this._groups,this._parents)}function Wd(e,t){var n,r,i;return function(){var s=Ke(this,e),o=(this.style.removeProperty(e),Ke(this,e));return s===o?null:s===n&&o===r?i:i=t(n=s,r=o)}}function Kl(e){return function(){this.style.removeProperty(e)}}function Yd(e,t,n){var r,i=n+"",s;return function(){var o=Ke(this,e);return o===i?null:o===r?s:s=t(r=o,n)}}function Vd(e,t,n){var r,i,s;return function(){var o=Ke(this,e),a=n(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(e),Ke(this,e))),o===l?null:o===r&&l===i?s:(i=l,s=t(r=o,a))}}function Xd(e,t){var n,r,i,s="style."+t,o="end."+s,a;return function(){var l=ee(this,e),c=l.on,h=l.value[s]==null?a||(a=Kl(t)):void 0;(c!==n||i!==h)&&(r=(n=c).copy()).on(o,i=h),l.on=r}}function Kd(e,t,n){var r=(e+="")=="transform"?K0:Xl;return t==null?this.styleTween(e,Wd(e,r)).on("end.style."+e,Kl(e)):typeof t=="function"?this.styleTween(e,Vd(e,r,Gs(this,"style."+e,t))).each(Xd(this._id,e)):this.styleTween(e,Yd(e,r,t),n).on("end.style."+e,null)}function Qd(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function Zd(e,t,n){var r,i;function s(){var o=t.apply(this,arguments);return o!==i&&(r=(i=o)&&Qd(e,o,n)),r}return s._value=t,s}function Jd(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,Zd(e,t,n??""))}function tp(e){return function(){this.textContent=e}}function ep(e){return function(){var t=e(this);this.textContent=t??""}}function np(e){return this.tween("text",typeof e=="function"?ep(Gs(this,"text",e)):tp(e==null?"":e+""))}function rp(e){return function(t){this.textContent=e.call(this,t)}}function ip(e){var t,n;function r(){var i=e.apply(this,arguments);return i!==n&&(t=(n=i)&&rp(i)),t}return r._value=e,r}function sp(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,ip(e))}function op(){for(var e=this._name,t=this._id,n=Ql(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],a=o.length,l,c=0;c<a;++c)if(l=o[c]){var h=Gt(l,t);oi(l,e,n,c,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new ue(r,this._parents,e,n)}function ap(){var e,t,n=this,r=n._id,i=n.size();return new Promise(function(s,o){var a={value:o},l={value:function(){--i===0&&s()}};n.each(function(){var c=ee(this,r),h=c.on;h!==e&&(t=(e=h).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),c.on=t}),i===0&&s()})}var lp=0;function ue(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function Ql(){return++lp}var ie=zn.prototype;ue.prototype={constructor:ue,select:Hd,selectAll:qd,selectChild:ie.selectChild,selectChildren:ie.selectChildren,filter:Ld,merge:Rd,selection:jd,transition:op,call:ie.call,nodes:ie.nodes,node:ie.node,size:ie.size,empty:ie.empty,each:ie.each,on:Ud,attr:wd,attrTween:Ed,style:Kd,styleTween:Jd,text:np,textTween:sp,remove:Fd,tween:fd,delay:Ad,duration:Pd,ease:kd,easeVarying:Od,end:ap,[Symbol.iterator]:ie[Symbol.iterator]};function up(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var cp={time:null,delay:0,duration:250,ease:up};function hp(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function fp(e){var t,n;e instanceof ue?(t=e._id,e=e._name):(t=Ql(),(n=cp).time=Hs(),e=e==null?null:e+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],a=o.length,l,c=0;c<a;++c)(l=o[c])&&oi(l,e,t,c,o,n||hp(l,t));return new ue(r,this._parents,e,t)}zn.prototype.interrupt=ud;zn.prototype.transition=fp;const ae=11102230246251565e-32,pt=134217729,dp=(3+8*ae)*ae;function Ei(e,t,n,r,i){let s,o,a,l,c=t[0],h=r[0],u=0,f=0;h>c==h>-c?(s=c,c=t[++u]):(s=h,h=r[++f]);let _=0;if(u<e&&f<n)for(h>c==h>-c?(o=c+s,a=s-(o-c),c=t[++u]):(o=h+s,a=s-(o-h),h=r[++f]),s=o,a!==0&&(i[_++]=a);u<e&&f<n;)h>c==h>-c?(o=s+c,l=o-s,a=s-(o-l)+(c-l),c=t[++u]):(o=s+h,l=o-s,a=s-(o-l)+(h-l),h=r[++f]),s=o,a!==0&&(i[_++]=a);for(;u<e;)o=s+c,l=o-s,a=s-(o-l)+(c-l),c=t[++u],s=o,a!==0&&(i[_++]=a);for(;f<n;)o=s+h,l=o-s,a=s-(o-l)+(h-l),h=r[++f],s=o,a!==0&&(i[_++]=a);return(s!==0||_===0)&&(i[_++]=s),_}function pp(e,t){let n=t[0];for(let r=1;r<e;r++)n+=t[r];return n}function Bn(e){return new Float64Array(e)}const gp=(3+16*ae)*ae,mp=(2+12*ae)*ae,yp=(9+64*ae)*ae*ae,Ue=Bn(4),Zo=Bn(8),Jo=Bn(12),ta=Bn(16),yt=Bn(4);function _p(e,t,n,r,i,s,o){let a,l,c,h,u,f,_,b,A,N,I,$,C,k,O,L,z,d;const g=e-i,w=n-i,v=t-s,S=r-s;k=g*S,f=pt*g,_=f-(f-g),b=g-_,f=pt*S,A=f-(f-S),N=S-A,O=b*N-(k-_*A-b*A-_*N),L=v*w,f=pt*v,_=f-(f-v),b=v-_,f=pt*w,A=f-(f-w),N=w-A,z=b*N-(L-_*A-b*A-_*N),I=O-z,u=O-I,Ue[0]=O-(I+u)+(u-z),$=k+I,u=$-k,C=k-($-u)+(I-u),I=C-L,u=C-I,Ue[1]=C-(I+u)+(u-L),d=$+I,u=d-$,Ue[2]=$-(d-u)+(I-u),Ue[3]=d;let M=pp(4,Ue),y=mp*o;if(M>=y||-M>=y||(u=e-g,a=e-(g+u)+(u-i),u=n-w,c=n-(w+u)+(u-i),u=t-v,l=t-(v+u)+(u-s),u=r-S,h=r-(S+u)+(u-s),a===0&&l===0&&c===0&&h===0)||(y=yp*o+dp*Math.abs(M),M+=g*h+S*a-(v*c+w*l),M>=y||-M>=y))return M;k=a*S,f=pt*a,_=f-(f-a),b=a-_,f=pt*S,A=f-(f-S),N=S-A,O=b*N-(k-_*A-b*A-_*N),L=l*w,f=pt*l,_=f-(f-l),b=l-_,f=pt*w,A=f-(f-w),N=w-A,z=b*N-(L-_*A-b*A-_*N),I=O-z,u=O-I,yt[0]=O-(I+u)+(u-z),$=k+I,u=$-k,C=k-($-u)+(I-u),I=C-L,u=C-I,yt[1]=C-(I+u)+(u-L),d=$+I,u=d-$,yt[2]=$-(d-u)+(I-u),yt[3]=d;const p=Ei(4,Ue,4,yt,Zo);k=g*h,f=pt*g,_=f-(f-g),b=g-_,f=pt*h,A=f-(f-h),N=h-A,O=b*N-(k-_*A-b*A-_*N),L=v*c,f=pt*v,_=f-(f-v),b=v-_,f=pt*c,A=f-(f-c),N=c-A,z=b*N-(L-_*A-b*A-_*N),I=O-z,u=O-I,yt[0]=O-(I+u)+(u-z),$=k+I,u=$-k,C=k-($-u)+(I-u),I=C-L,u=C-I,yt[1]=C-(I+u)+(u-L),d=$+I,u=d-$,yt[2]=$-(d-u)+(I-u),yt[3]=d;const m=Ei(p,Zo,4,yt,Jo);k=a*h,f=pt*a,_=f-(f-a),b=a-_,f=pt*h,A=f-(f-h),N=h-A,O=b*N-(k-_*A-b*A-_*N),L=l*c,f=pt*l,_=f-(f-l),b=l-_,f=pt*c,A=f-(f-c),N=c-A,z=b*N-(L-_*A-b*A-_*N),I=O-z,u=O-I,yt[0]=O-(I+u)+(u-z),$=k+I,u=$-k,C=k-($-u)+(I-u),I=C-L,u=C-I,yt[1]=C-(I+u)+(u-L),d=$+I,u=d-$,yt[2]=$-(d-u)+(I-u),yt[3]=d;const x=Ei(m,Jo,4,yt,ta);return ta[x-1]}function Qn(e,t,n,r,i,s){const o=(t-s)*(n-i),a=(e-i)*(r-s),l=o-a,c=Math.abs(o+a);return Math.abs(l)>=gp*c?l:-_p(e,t,n,r,i,s,c)}const ea=Math.pow(2,-52),Zn=new Uint32Array(512);class Ir{static from(t,n=Sp,r=Ep){const i=t.length,s=new Float64Array(i*2);for(let o=0;o<i;o++){const a=t[o];s[2*o]=n(a),s[2*o+1]=r(a)}return new Ir(s)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const r=Math.max(2*n-5,0);this._triangles=new Uint32Array(r*3),this._halfedges=new Int32Array(r*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:r,_hullTri:i,_hullHash:s}=this,o=t.length>>1;let a=1/0,l=1/0,c=-1/0,h=-1/0;for(let g=0;g<o;g++){const w=t[2*g],v=t[2*g+1];w<a&&(a=w),v<l&&(l=v),w>c&&(c=w),v>h&&(h=v),this._ids[g]=g}const u=(a+c)/2,f=(l+h)/2;let _,b,A;for(let g=0,w=1/0;g<o;g++){const v=Mi(u,f,t[2*g],t[2*g+1]);v<w&&(_=g,w=v)}const N=t[2*_],I=t[2*_+1];for(let g=0,w=1/0;g<o;g++){if(g===_)continue;const v=Mi(N,I,t[2*g],t[2*g+1]);v<w&&v>0&&(b=g,w=v)}let $=t[2*b],C=t[2*b+1],k=1/0;for(let g=0;g<o;g++){if(g===_||g===b)continue;const w=xp(N,I,$,C,t[2*g],t[2*g+1]);w<k&&(A=g,k=w)}let O=t[2*A],L=t[2*A+1];if(k===1/0){for(let v=0;v<o;v++)this._dists[v]=t[2*v]-t[0]||t[2*v+1]-t[1];je(this._ids,this._dists,0,o-1);const g=new Uint32Array(o);let w=0;for(let v=0,S=-1/0;v<o;v++){const M=this._ids[v],y=this._dists[M];y>S&&(g[w++]=M,S=y)}this.hull=g.subarray(0,w),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(Qn(N,I,$,C,O,L)<0){const g=b,w=$,v=C;b=A,$=O,C=L,A=g,O=w,L=v}const z=bp(N,I,$,C,O,L);this._cx=z.x,this._cy=z.y;for(let g=0;g<o;g++)this._dists[g]=Mi(t[2*g],t[2*g+1],z.x,z.y);je(this._ids,this._dists,0,o-1),this._hullStart=_;let d=3;r[_]=n[A]=b,r[b]=n[_]=A,r[A]=n[b]=_,i[_]=0,i[b]=1,i[A]=2,s.fill(-1),s[this._hashKey(N,I)]=_,s[this._hashKey($,C)]=b,s[this._hashKey(O,L)]=A,this.trianglesLen=0,this._addTriangle(_,b,A,-1,-1,-1);for(let g=0,w,v;g<this._ids.length;g++){const S=this._ids[g],M=t[2*S],y=t[2*S+1];if(g>0&&Math.abs(M-w)<=ea&&Math.abs(y-v)<=ea||(w=M,v=y,S===_||S===b||S===A))continue;let p=0;for(let R=0,D=this._hashKey(M,y);R<this._hashSize&&(p=s[(D+R)%this._hashSize],!(p!==-1&&p!==r[p]));R++);p=n[p];let m=p,x;for(;x=r[m],Qn(M,y,t[2*m],t[2*m+1],t[2*x],t[2*x+1])>=0;)if(m=x,m===p){m=-1;break}if(m===-1)continue;let E=this._addTriangle(m,S,r[m],-1,-1,i[m]);i[S]=this._legalize(E+2),i[m]=E,d++;let T=r[m];for(;x=r[T],Qn(M,y,t[2*T],t[2*T+1],t[2*x],t[2*x+1])<0;)E=this._addTriangle(T,S,x,i[S],-1,i[T]),i[S]=this._legalize(E+2),r[T]=T,d--,T=x;if(m===p)for(;x=n[m],Qn(M,y,t[2*x],t[2*x+1],t[2*m],t[2*m+1])<0;)E=this._addTriangle(x,S,m,-1,i[m],i[x]),this._legalize(E+2),i[x]=E,r[m]=m,d--,m=x;this._hullStart=n[S]=m,r[m]=n[T]=S,r[S]=T,s[this._hashKey(M,y)]=S,s[this._hashKey(t[2*m],t[2*m+1])]=m}this.hull=new Uint32Array(d);for(let g=0,w=this._hullStart;g<d;g++)this.hull[g]=w,w=r[w];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(wp(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:r,coords:i}=this;let s=0,o=0;for(;;){const a=r[t],l=t-t%3;if(o=l+(t+2)%3,a===-1){if(s===0)break;t=Zn[--s];continue}const c=a-a%3,h=l+(t+1)%3,u=c+(a+2)%3,f=n[o],_=n[t],b=n[h],A=n[u];if(vp(i[2*f],i[2*f+1],i[2*_],i[2*_+1],i[2*b],i[2*b+1],i[2*A],i[2*A+1])){n[t]=A,n[a]=f;const I=r[u];if(I===-1){let C=this._hullStart;do{if(this._hullTri[C]===u){this._hullTri[C]=t;break}C=this._hullPrev[C]}while(C!==this._hullStart)}this._link(t,I),this._link(a,r[o]),this._link(o,u);const $=c+(a+1)%3;s<Zn.length&&(Zn[s++]=$)}else{if(s===0)break;t=Zn[--s]}}return o}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,r,i,s,o){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=n,this._triangles[a+2]=r,this._link(a,i),this._link(a+1,s),this._link(a+2,o),this.trianglesLen+=3,a}}function wp(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function Mi(e,t,n,r){const i=e-n,s=t-r;return i*i+s*s}function vp(e,t,n,r,i,s,o,a){const l=e-o,c=t-a,h=n-o,u=r-a,f=i-o,_=s-a,b=l*l+c*c,A=h*h+u*u,N=f*f+_*_;return l*(u*N-A*_)-c*(h*N-A*f)+b*(h*_-u*f)<0}function xp(e,t,n,r,i,s){const o=n-e,a=r-t,l=i-e,c=s-t,h=o*o+a*a,u=l*l+c*c,f=.5/(o*c-a*l),_=(c*h-a*u)*f,b=(o*u-l*h)*f;return _*_+b*b}function bp(e,t,n,r,i,s){const o=n-e,a=r-t,l=i-e,c=s-t,h=o*o+a*a,u=l*l+c*c,f=.5/(o*c-a*l),_=e+(c*h-a*u)*f,b=t+(o*u-l*h)*f;return{x:_,y:b}}function je(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const s=e[i],o=t[s];let a=i-1;for(;a>=n&&t[e[a]]>o;)e[a+1]=e[a--];e[a+1]=s}else{const i=n+r>>1;let s=n+1,o=r;hn(e,i,s),t[e[n]]>t[e[r]]&&hn(e,n,r),t[e[s]]>t[e[r]]&&hn(e,s,r),t[e[n]]>t[e[s]]&&hn(e,n,s);const a=e[s],l=t[a];for(;;){do s++;while(t[e[s]]<l);do o--;while(t[e[o]]>l);if(o<s)break;hn(e,s,o)}e[n+1]=e[o],e[o]=a,r-s+1>=o-n?(je(e,t,s,r),je(e,t,n,o-1)):(je(e,t,n,o-1),je(e,t,s,r))}}function hn(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function Sp(e){return e[0]}function Ep(e){return e[1]}const na=1e-6;class Te{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,r){t=+t,n=+n,r=+r;const i=t+r,s=n;if(r<0)throw new Error("negative radius");this._x1===null?this._+=`M${i},${s}`:(Math.abs(this._x1-i)>na||Math.abs(this._y1-s)>na)&&(this._+="L"+i+","+s),r&&(this._+=`A${r},${r},0,1,1,${t-r},${n}A${r},${r},0,1,1,${this._x1=i},${this._y1=s}`)}rect(t,n,r,i){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+r}v${+i}h${-r}Z`}value(){return this._||null}}class Yi{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}class Mp{constructor(t,[n,r,i,s]=[0,0,960,500]){if(!((i=+i)>=(n=+n))||!((s=+s)>=(r=+r)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=i,this.xmin=n,this.ymax=s,this.ymin=r,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:r},vectors:i}=this;let s,o;const a=this.circumcenters=this._circumcenters.subarray(0,r.length/3*2);for(let A=0,N=0,I=r.length,$,C;A<I;A+=3,N+=2){const k=r[A]*2,O=r[A+1]*2,L=r[A+2]*2,z=t[k],d=t[k+1],g=t[O],w=t[O+1],v=t[L],S=t[L+1],M=g-z,y=w-d,p=v-z,m=S-d,x=(M*m-y*p)*2;if(Math.abs(x)<1e-9){if(s===void 0){s=o=0;for(const T of n)s+=t[T*2],o+=t[T*2+1];s/=n.length,o/=n.length}const E=1e9*Math.sign((s-z)*m-(o-d)*p);$=(z+v)/2-E*m,C=(d+S)/2+E*p}else{const E=1/x,T=M*M+y*y,R=p*p+m*m;$=z+(m*T-y*R)*E,C=d+(M*R-p*T)*E}a[N]=$,a[N+1]=C}let l=n[n.length-1],c,h=l*4,u,f=t[2*l],_,b=t[2*l+1];i.fill(0);for(let A=0;A<n.length;++A)l=n[A],c=h,u=f,_=b,h=l*4,f=t[2*l],b=t[2*l+1],i[c+2]=i[h]=_-b,i[c+3]=i[h+1]=f-u}render(t){const n=t==null?t=new Te:void 0,{delaunay:{halfedges:r,inedges:i,hull:s},circumcenters:o,vectors:a}=this;if(s.length<=1)return null;for(let h=0,u=r.length;h<u;++h){const f=r[h];if(f<h)continue;const _=Math.floor(h/3)*2,b=Math.floor(f/3)*2,A=o[_],N=o[_+1],I=o[b],$=o[b+1];this._renderSegment(A,N,I,$,t)}let l,c=s[s.length-1];for(let h=0;h<s.length;++h){l=c,c=s[h];const u=Math.floor(i[c]/3)*2,f=o[u],_=o[u+1],b=l*4,A=this._project(f,_,a[b+2],a[b+3]);A&&this._renderSegment(f,_,A[0],A[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new Te:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const r=n==null?n=new Te:void 0,i=this._clip(t);if(i===null||!i.length)return;n.moveTo(i[0],i[1]);let s=i.length;for(;i[0]===i[s-2]&&i[1]===i[s-1]&&s>1;)s-=2;for(let o=2;o<s;o+=2)(i[o]!==i[o-2]||i[o+1]!==i[o-1])&&n.lineTo(i[o],i[o+1]);return n.closePath(),r&&r.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,r=t.length/2;n<r;++n){const i=this.cellPolygon(n);i&&(i.index=n,yield i)}}cellPolygon(t){const n=new Yi;return this.renderCell(t,n),n.value()}_renderSegment(t,n,r,i,s){let o;const a=this._regioncode(t,n),l=this._regioncode(r,i);a===0&&l===0?(s.moveTo(t,n),s.lineTo(r,i)):(o=this._clipSegment(t,n,r,i,a,l))&&(s.moveTo(o[0],o[1]),s.lineTo(o[2],o[3]))}contains(t,n,r){return n=+n,n!==n||(r=+r,r!==r)?!1:this.delaunay._step(t,n,r)===t}*neighbors(t){const n=this._clip(t);if(n)for(const r of this.delaunay.neighbors(t)){const i=this._clip(r);if(i){t:for(let s=0,o=n.length;s<o;s+=2)for(let a=0,l=i.length;a<l;a+=2)if(n[s]===i[a]&&n[s+1]===i[a+1]&&n[(s+2)%o]===i[(a+l-2)%l]&&n[(s+3)%o]===i[(a+l-1)%l]){yield r;break t}}}}_cell(t){const{circumcenters:n,delaunay:{inedges:r,halfedges:i,triangles:s}}=this,o=r[t];if(o===-1)return null;const a=[];let l=o;do{const c=Math.floor(l/3);if(a.push(n[c*2],n[c*2+1]),l=l%3===2?l-2:l+1,s[l]!==t)break;l=i[l]}while(l!==o&&l!==-1);return a}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:r}=this,i=t*4;return this._simplify(r[i]||r[i+1]?this._clipInfinite(t,n,r[i],r[i+1],r[i+2],r[i+3]):this._clipFinite(t,n))}_clipFinite(t,n){const r=n.length;let i=null,s,o,a=n[r-2],l=n[r-1],c,h=this._regioncode(a,l),u,f=0;for(let _=0;_<r;_+=2)if(s=a,o=l,a=n[_],l=n[_+1],c=h,h=this._regioncode(a,l),c===0&&h===0)u=f,f=0,i?i.push(a,l):i=[a,l];else{let b,A,N,I,$;if(c===0){if((b=this._clipSegment(s,o,a,l,c,h))===null)continue;[A,N,I,$]=b}else{if((b=this._clipSegment(a,l,s,o,h,c))===null)continue;[I,$,A,N]=b,u=f,f=this._edgecode(A,N),u&&f&&this._edge(t,u,f,i,i.length),i?i.push(A,N):i=[A,N]}u=f,f=this._edgecode(I,$),u&&f&&this._edge(t,u,f,i,i.length),i?i.push(I,$):i=[I,$]}if(i)u=f,f=this._edgecode(i[0],i[1]),u&&f&&this._edge(t,u,f,i,i.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return i}_clipSegment(t,n,r,i,s,o){const a=s<o;for(a&&([t,n,r,i,s,o]=[r,i,t,n,o,s]);;){if(s===0&&o===0)return a?[r,i,t,n]:[t,n,r,i];if(s&o)return null;let l,c,h=s||o;h&8?(l=t+(r-t)*(this.ymax-n)/(i-n),c=this.ymax):h&4?(l=t+(r-t)*(this.ymin-n)/(i-n),c=this.ymin):h&2?(c=n+(i-n)*(this.xmax-t)/(r-t),l=this.xmax):(c=n+(i-n)*(this.xmin-t)/(r-t),l=this.xmin),s?(t=l,n=c,s=this._regioncode(t,n)):(r=l,i=c,o=this._regioncode(r,i))}}_clipInfinite(t,n,r,i,s,o){let a=Array.from(n),l;if((l=this._project(a[0],a[1],r,i))&&a.unshift(l[0],l[1]),(l=this._project(a[a.length-2],a[a.length-1],s,o))&&a.push(l[0],l[1]),a=this._clipFinite(t,a))for(let c=0,h=a.length,u,f=this._edgecode(a[h-2],a[h-1]);c<h;c+=2)u=f,f=this._edgecode(a[c],a[c+1]),u&&f&&(c=this._edge(t,u,f,a,c),h=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,n,r,i,s){for(;n!==r;){let o,a;switch(n){case 5:n=4;continue;case 4:n=6,o=this.xmax,a=this.ymin;break;case 6:n=2;continue;case 2:n=10,o=this.xmax,a=this.ymax;break;case 10:n=8;continue;case 8:n=9,o=this.xmin,a=this.ymax;break;case 9:n=1;continue;case 1:n=5,o=this.xmin,a=this.ymin;break}(i[s]!==o||i[s+1]!==a)&&this.contains(t,o,a)&&(i.splice(s,0,o,a),s+=2)}return s}_project(t,n,r,i){let s=1/0,o,a,l;if(i<0){if(n<=this.ymin)return null;(o=(this.ymin-n)/i)<s&&(l=this.ymin,a=t+(s=o)*r)}else if(i>0){if(n>=this.ymax)return null;(o=(this.ymax-n)/i)<s&&(l=this.ymax,a=t+(s=o)*r)}if(r>0){if(t>=this.xmax)return null;(o=(this.xmax-t)/r)<s&&(a=this.xmax,l=n+(s=o)*i)}else if(r<0){if(t<=this.xmin)return null;(o=(this.xmin-t)/r)<s&&(a=this.xmin,l=n+(s=o)*i)}return[a,l]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}_simplify(t){if(t&&t.length>4){for(let n=0;n<t.length;n+=2){const r=(n+2)%t.length,i=(n+4)%t.length;(t[n]===t[r]&&t[r]===t[i]||t[n+1]===t[r+1]&&t[r+1]===t[i+1])&&(t.splice(r,2),n-=2)}t.length||(t=null)}return t}}const $p=2*Math.PI,Be=Math.pow;function Ap(e){return e[0]}function Ip(e){return e[1]}function Tp(e){const{triangles:t,coords:n}=e;for(let r=0;r<t.length;r+=3){const i=2*t[r],s=2*t[r+1],o=2*t[r+2];if((n[o]-n[i])*(n[s+1]-n[i+1])-(n[s]-n[i])*(n[o+1]-n[i+1])>1e-10)return!1}return!0}function Pp(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class js{static from(t,n=Ap,r=Ip,i){return new js("length"in t?Np(t,n,r,i):Float64Array.from(kp(t,n,r,i)))}constructor(t){this._delaunator=new Ir(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&Tp(t)){this.collinear=Int32Array.from({length:n.length/2},(f,_)=>_).sort((f,_)=>n[2*f]-n[2*_]||n[2*f+1]-n[2*_+1]);const l=this.collinear[0],c=this.collinear[this.collinear.length-1],h=[n[2*l],n[2*l+1],n[2*c],n[2*c+1]],u=1e-8*Math.hypot(h[3]-h[1],h[2]-h[0]);for(let f=0,_=n.length/2;f<_;++f){const b=Pp(n[2*f],n[2*f+1],u);n[2*f]=b[0],n[2*f+1]=b[1]}this._delaunator=new Ir(n)}else delete this.collinear;const r=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let l=0,c=r.length;l<c;++l){const h=s[l%3===2?l-2:l+1];(r[l]===-1||o[h]===-1)&&(o[h]=l)}for(let l=0,c=i.length;l<c;++l)a[i[l]]=l;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],o[i[0]]=1,i.length===2&&(o[i[1]]=0,this.triangles[1]=i[1],this.triangles[2]=i[1]))}voronoi(t){return new Mp(this,t)}*neighbors(t){const{inedges:n,hull:r,_hullIndex:i,halfedges:s,triangles:o,collinear:a}=this;if(a){const u=a.indexOf(t);u>0&&(yield a[u-1]),u<a.length-1&&(yield a[u+1]);return}const l=n[t];if(l===-1)return;let c=l,h=-1;do{if(yield h=o[c],c=c%3===2?c-2:c+1,o[c]!==t)return;if(c=s[c],c===-1){const u=r[(i[t]+1)%r.length];u!==h&&(yield u);return}}while(c!==l)}find(t,n,r=0){if(t=+t,t!==t||(n=+n,n!==n))return-1;const i=r;let s;for(;(s=this._step(r,t,n))>=0&&s!==r&&s!==i;)r=s;return s}_step(t,n,r){const{inedges:i,hull:s,_hullIndex:o,halfedges:a,triangles:l,points:c}=this;if(i[t]===-1||!c.length)return(t+1)%(c.length>>1);let h=t,u=Be(n-c[t*2],2)+Be(r-c[t*2+1],2);const f=i[t];let _=f;do{let b=l[_];const A=Be(n-c[b*2],2)+Be(r-c[b*2+1],2);if(A<u&&(u=A,h=b),_=_%3===2?_-2:_+1,l[_]!==t)break;if(_=a[_],_===-1){if(_=s[(o[t]+1)%s.length],_!==b&&Be(n-c[_*2],2)+Be(r-c[_*2+1],2)<u)return _;break}}while(_!==f);return h}render(t){const n=t==null?t=new Te:void 0,{points:r,halfedges:i,triangles:s}=this;for(let o=0,a=i.length;o<a;++o){const l=i[o];if(l<o)continue;const c=s[o]*2,h=s[l]*2;t.moveTo(r[c],r[c+1]),t.lineTo(r[h],r[h+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n){n===void 0&&(!t||typeof t.moveTo!="function")&&(n=t,t=null),n=n==null?2:+n;const r=t==null?t=new Te:void 0,{points:i}=this;for(let s=0,o=i.length;s<o;s+=2){const a=i[s],l=i[s+1];t.moveTo(a+n,l),t.arc(a,l,n,0,$p)}return r&&r.value()}renderHull(t){const n=t==null?t=new Te:void 0,{hull:r,points:i}=this,s=r[0]*2,o=r.length;t.moveTo(i[s],i[s+1]);for(let a=1;a<o;++a){const l=2*r[a];t.lineTo(i[l],i[l+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new Yi;return this.renderHull(t),t.value()}renderTriangle(t,n){const r=n==null?n=new Te:void 0,{points:i,triangles:s}=this,o=s[t*=3]*2,a=s[t+1]*2,l=s[t+2]*2;return n.moveTo(i[o],i[o+1]),n.lineTo(i[a],i[a+1]),n.lineTo(i[l],i[l+1]),n.closePath(),r&&r.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,r=t.length/3;n<r;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new Yi;return this.renderTriangle(t,n),n.value()}}function Np(e,t,n,r){const i=e.length,s=new Float64Array(i*2);for(let o=0;o<i;++o){const a=e[o];s[o*2]=t.call(r,a,o,e),s[o*2+1]=n.call(r,a,o,e)}return s}function*kp(e,t,n,r){let i=0;for(const s of e)yield t.call(r,s,i,e),yield n.call(r,s,i,e),++i}function Cp(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Tr(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function Op(e){return e=Tr(Math.abs(e)),e?e[1]:NaN}function Lp(e,t){return function(n,r){for(var i=n.length,s=[],o=0,a=e[0],l=0;i>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),s.push(n.substring(i-=a,i+a)),!((l+=a+1)>r));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function Rp(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var Dp=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Vi(e){if(!(t=Dp.exec(e)))throw new Error("invalid format: "+e);var t;return new Ws({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Vi.prototype=Ws.prototype;function Ws(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Ws.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function zp(e){t:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+e[n])break t;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(i+1):e}var Zl;function Up(e,t){var n=Tr(e,t);if(!n)return e+"";var r=n[0],i=n[1],s=i-(Zl=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+Tr(e,Math.max(0,t+s-1))[0]}function ra(e,t){var n=Tr(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const ia={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:Cp,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>ra(e*100,t),r:ra,s:Up,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function sa(e){return e}var oa=Array.prototype.map,aa=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Bp(e){var t=e.grouping===void 0||e.thousands===void 0?sa:Lp(oa.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",r=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?sa:Rp(oa.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"−":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function c(u){u=Vi(u);var f=u.fill,_=u.align,b=u.sign,A=u.symbol,N=u.zero,I=u.width,$=u.comma,C=u.precision,k=u.trim,O=u.type;O==="n"?($=!0,O="g"):ia[O]||(C===void 0&&(C=12),k=!0,O="g"),(N||f==="0"&&_==="=")&&(N=!0,f="0",_="=");var L=A==="$"?n:A==="#"&&/[boxX]/.test(O)?"0"+O.toLowerCase():"",z=A==="$"?r:/[%p]/.test(O)?o:"",d=ia[O],g=/[defgprs%]/.test(O);C=C===void 0?6:/[gprs]/.test(O)?Math.max(1,Math.min(21,C)):Math.max(0,Math.min(20,C));function w(v){var S=L,M=z,y,p,m;if(O==="c")M=d(v)+M,v="";else{v=+v;var x=v<0||1/v<0;if(v=isNaN(v)?l:d(Math.abs(v),C),k&&(v=zp(v)),x&&+v==0&&b!=="+"&&(x=!1),S=(x?b==="("?b:a:b==="-"||b==="("?"":b)+S,M=(O==="s"?aa[8+Zl/3]:"")+M+(x&&b==="("?")":""),g){for(y=-1,p=v.length;++y<p;)if(m=v.charCodeAt(y),48>m||m>57){M=(m===46?i+v.slice(y+1):v.slice(y))+M,v=v.slice(0,y);break}}}$&&!N&&(v=t(v,1/0));var E=S.length+v.length+M.length,T=E<I?new Array(I-E+1).join(f):"";switch($&&N&&(v=t(T+v,T.length?I-M.length:1/0),T=""),_){case"<":v=S+v+M+T;break;case"=":v=S+T+v+M;break;case"^":v=T.slice(0,E=T.length>>1)+S+v+M+T.slice(E);break;default:v=T+S+v+M;break}return s(v)}return w.toString=function(){return u+""},w}function h(u,f){var _=c((u=Vi(u),u.type="f",u)),b=Math.max(-8,Math.min(8,Math.floor(Op(f)/3)))*3,A=Math.pow(10,-b),N=aa[8+b/3];return function(I){return _(A*I)+N}}return{format:c,formatPrefix:h}}var Jn,Ys;Fp({thousands:",",grouping:[3],currency:["$",""]});function Fp(e){return Jn=Bp(e),Ys=Jn.format,Jn.formatPrefix,Jn}var X=1e-6,Xi=1e-12,Q=Math.PI,gt=Q/2,la=Q/4,Pt=Q*2,_t=180/Q,Z=Q/180,nt=Math.abs,ai=Math.atan,ce=Math.atan2,Y=Math.cos,tr=Math.ceil,Jl=Math.exp,Ki=Math.hypot,tu=Math.log,j=Math.sin,Hp=Math.sign||function(e){return e>0?1:e<0?-1:0},ne=Math.sqrt,eu=Math.tan;function qp(e){return e>1?0:e<-1?Q:Math.acos(e)}function he(e){return e>1?gt:e<-1?-gt:Math.asin(e)}function lt(){}function Pr(e,t){e&&ca.hasOwnProperty(e.type)&&ca[e.type](e,t)}var ua={Feature:function(e,t){Pr(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)Pr(n[r].geometry,t)}},ca={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){Qi(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)Qi(n[r],t,0)},Polygon:function(e,t){ha(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)ha(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)Pr(n[r],t)}};function Qi(e,t,n){var r=-1,i=e.length-n,s;for(t.lineStart();++r<i;)s=e[r],t.point(s[0],s[1],s[2]);t.lineEnd()}function ha(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)Qi(e[n],t,1);t.polygonEnd()}function me(e,t){e&&ua.hasOwnProperty(e.type)?ua[e.type](e,t):Pr(e,t)}function Zi(e){return[ce(e[1],e[0]),he(e[2])]}function Ze(e){var t=e[0],n=e[1],r=Y(n);return[r*Y(t),r*j(t),j(n)]}function er(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Nr(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function $i(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function nr(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Ji(e){var t=ne(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var gn,kr,Cr,Or,Lr,Rr,Dr,zr,ts,es,ns,nu,ru,wt,vt,xt,Ht={sphere:lt,point:Vs,lineStart:fa,lineEnd:da,polygonStart:function(){Ht.lineStart=Wp,Ht.lineEnd=Yp},polygonEnd:function(){Ht.lineStart=fa,Ht.lineEnd=da}};function Vs(e,t){e*=Z,t*=Z;var n=Y(t);Fn(n*Y(e),n*j(e),j(t))}function Fn(e,t,n){++gn,Cr+=(e-Cr)/gn,Or+=(t-Or)/gn,Lr+=(n-Lr)/gn}function fa(){Ht.point=Gp}function Gp(e,t){e*=Z,t*=Z;var n=Y(t);wt=n*Y(e),vt=n*j(e),xt=j(t),Ht.point=jp,Fn(wt,vt,xt)}function jp(e,t){e*=Z,t*=Z;var n=Y(t),r=n*Y(e),i=n*j(e),s=j(t),o=ce(ne((o=vt*s-xt*i)*o+(o=xt*r-wt*s)*o+(o=wt*i-vt*r)*o),wt*r+vt*i+xt*s);kr+=o,Rr+=o*(wt+(wt=r)),Dr+=o*(vt+(vt=i)),zr+=o*(xt+(xt=s)),Fn(wt,vt,xt)}function da(){Ht.point=Vs}function Wp(){Ht.point=Vp}function Yp(){iu(nu,ru),Ht.point=Vs}function Vp(e,t){nu=e,ru=t,e*=Z,t*=Z,Ht.point=iu;var n=Y(t);wt=n*Y(e),vt=n*j(e),xt=j(t),Fn(wt,vt,xt)}function iu(e,t){e*=Z,t*=Z;var n=Y(t),r=n*Y(e),i=n*j(e),s=j(t),o=vt*s-xt*i,a=xt*r-wt*s,l=wt*i-vt*r,c=Ki(o,a,l),h=he(c),u=c&&-h/c;ts.add(u*o),es.add(u*a),ns.add(u*l),kr+=h,Rr+=h*(wt+(wt=r)),Dr+=h*(vt+(vt=i)),zr+=h*(xt+(xt=s)),Fn(wt,vt,xt)}function pa(e){gn=kr=Cr=Or=Lr=Rr=Dr=zr=0,ts=new qt,es=new qt,ns=new qt,me(e,Ht);var t=+ts,n=+es,r=+ns,i=Ki(t,n,r);return i<Xi&&(t=Rr,n=Dr,r=zr,kr<X&&(t=Cr,n=Or,r=Lr),i=Ki(t,n,r),i<Xi)?[NaN,NaN]:[ce(n,t)*_t,he(r/i)*_t]}function rs(e,t){function n(r,i){return r=e(r,i),t(r[0],r[1])}return e.invert&&t.invert&&(n.invert=function(r,i){return r=t.invert(r,i),r&&e.invert(r[0],r[1])}),n}function is(e,t){return nt(e)>Q&&(e-=Math.round(e/Pt)*Pt),[e,t]}is.invert=is;function su(e,t,n){return(e%=Pt)?t||n?rs(ma(e),ya(t,n)):ma(e):t||n?ya(t,n):is}function ga(e){return function(t,n){return t+=e,nt(t)>Q&&(t-=Math.round(t/Pt)*Pt),[t,n]}}function ma(e){var t=ga(e);return t.invert=ga(-e),t}function ya(e,t){var n=Y(e),r=j(e),i=Y(t),s=j(t);function o(a,l){var c=Y(l),h=Y(a)*c,u=j(a)*c,f=j(l),_=f*n+h*r;return[ce(u*i-_*s,h*n-f*r),he(_*i+u*s)]}return o.invert=function(a,l){var c=Y(l),h=Y(a)*c,u=j(a)*c,f=j(l),_=f*i-u*s;return[ce(u*i+f*s,h*n+_*r),he(_*n-h*r)]},o}function Ur(e){e=su(e[0]*Z,e[1]*Z,e.length>2?e[2]*Z:0);function t(n){return n=e(n[0]*Z,n[1]*Z),n[0]*=_t,n[1]*=_t,n}return t.invert=function(n){return n=e.invert(n[0]*Z,n[1]*Z),n[0]*=_t,n[1]*=_t,n},t}function Xp(e,t,n,r,i,s){if(n){var o=Y(t),a=j(t),l=r*n;i==null?(i=t+r*Pt,s=t-l/2):(i=_a(o,i),s=_a(o,s),(r>0?i<s:i>s)&&(i+=r*Pt));for(var c,h=i;r>0?h>s:h<s;h-=l)c=Zi([o,-a*Y(h),-a*j(h)]),e.point(c[0],c[1])}}function _a(e,t){t=Ze(t),t[0]-=e,Ji(t);var n=qp(-t[1]);return((-t[2]<0?-n:n)+Pt-X)%Pt}function ou(){var e=[],t;return{point:function(n,r,i){t.push([n,r,i])},lineStart:function(){e.push(t=[])},lineEnd:lt,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function pr(e,t){return nt(e[0]-t[0])<X&&nt(e[1]-t[1])<X}function rr(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function au(e,t,n,r,i){var s=[],o=[],a,l;if(e.forEach(function(b){if(!((A=b.length-1)<=0)){var A,N=b[0],I=b[A],$;if(pr(N,I)){if(!N[2]&&!I[2]){for(i.lineStart(),a=0;a<A;++a)i.point((N=b[a])[0],N[1]);i.lineEnd();return}I[0]+=2*X}s.push($=new rr(N,b,null,!0)),o.push($.o=new rr(N,null,$,!1)),s.push($=new rr(I,b,null,!1)),o.push($.o=new rr(I,null,$,!0))}}),!!s.length){for(o.sort(t),wa(s),wa(o),a=0,l=o.length;a<l;++a)o[a].e=n=!n;for(var c=s[0],h,u;;){for(var f=c,_=!0;f.v;)if((f=f.n)===c)return;h=f.z,i.lineStart();do{if(f.v=f.o.v=!0,f.e){if(_)for(a=0,l=h.length;a<l;++a)i.point((u=h[a])[0],u[1]);else r(f.x,f.n.x,1,i);f=f.n}else{if(_)for(h=f.p.z,a=h.length-1;a>=0;--a)i.point((u=h[a])[0],u[1]);else r(f.x,f.p.x,-1,i);f=f.p}f=f.o,h=f.z,_=!_}while(!f.v);i.lineEnd()}}}function wa(e){if(t=e.length){for(var t,n=0,r=e[0],i;++n<t;)r.n=i=e[n],i.p=r,r=i;r.n=i=e[0],i.p=r}}function Ai(e){return nt(e[0])<=Q?e[0]:Hp(e[0])*((nt(e[0])+Q)%Pt-Q)}function Kp(e,t){var n=Ai(t),r=t[1],i=j(r),s=[j(n),-Y(n),0],o=0,a=0,l=new qt;i===1?r=gt+X:i===-1&&(r=-gt-X);for(var c=0,h=e.length;c<h;++c)if(f=(u=e[c]).length)for(var u,f,_=u[f-1],b=Ai(_),A=_[1]/2+la,N=j(A),I=Y(A),$=0;$<f;++$,b=k,N=L,I=z,_=C){var C=u[$],k=Ai(C),O=C[1]/2+la,L=j(O),z=Y(O),d=k-b,g=d>=0?1:-1,w=g*d,v=w>Q,S=N*L;if(l.add(ce(S*g*j(w),I*z+S*Y(w))),o+=v?d+g*Pt:d,v^b>=n^k>=n){var M=Nr(Ze(_),Ze(C));Ji(M);var y=Nr(s,M);Ji(y);var p=(v^d>=0?-1:1)*he(y[2]);(r>p||r===p&&(M[0]||M[1]))&&(a+=v^d>=0?1:-1)}}return(o<-X||o<X&&l<-Xi)^a&1}function lu(e,t,n,r){return function(i){var s=t(i),o=ou(),a=t(o),l=!1,c,h,u,f={point:_,lineStart:A,lineEnd:N,polygonStart:function(){f.point=I,f.lineStart=$,f.lineEnd=C,h=[],c=[]},polygonEnd:function(){f.point=_,f.lineStart=A,f.lineEnd=N,h=Sl(h);var k=Kp(c,r);h.length?(l||(i.polygonStart(),l=!0),au(h,Zp,k,n,i)):k&&(l||(i.polygonStart(),l=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),l&&(i.polygonEnd(),l=!1),h=c=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function _(k,O){e(k,O)&&i.point(k,O)}function b(k,O){s.point(k,O)}function A(){f.point=b,s.lineStart()}function N(){f.point=_,s.lineEnd()}function I(k,O){u.push([k,O]),a.point(k,O)}function $(){a.lineStart(),u=[]}function C(){I(u[0][0],u[0][1]),a.lineEnd();var k=a.clean(),O=o.result(),L,z=O.length,d,g,w;if(u.pop(),c.push(u),u=null,!!z){if(k&1){if(g=O[0],(d=g.length-1)>0){for(l||(i.polygonStart(),l=!0),i.lineStart(),L=0;L<d;++L)i.point((w=g[L])[0],w[1]);i.lineEnd()}return}z>1&&k&2&&O.push(O.pop().concat(O.shift())),h.push(O.filter(Qp))}}return f}}function Qp(e){return e.length>1}function Zp(e,t){return((e=e.x)[0]<0?e[1]-gt-X:gt-e[1])-((t=t.x)[0]<0?t[1]-gt-X:gt-t[1])}const va=lu(function(){return!0},Jp,eg,[-Q,-gt]);function Jp(e){var t=NaN,n=NaN,r=NaN,i;return{lineStart:function(){e.lineStart(),i=1},point:function(s,o){var a=s>0?Q:-Q,l=nt(s-t);nt(l-Q)<X?(e.point(t,n=(n+o)/2>0?gt:-gt),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(a,n),e.point(s,n),i=0):r!==a&&l>=Q&&(nt(t-r)<X&&(t-=r*X),nt(s-a)<X&&(s-=a*X),n=tg(t,n,s,o),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(a,n),i=0),e.point(t=s,n=o),r=a},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-i}}}function tg(e,t,n,r){var i,s,o=j(e-n);return nt(o)>X?ai((j(t)*(s=Y(r))*j(n)-j(r)*(i=Y(t))*j(e))/(i*s*o)):(t+r)/2}function eg(e,t,n,r){var i;if(e==null)i=n*gt,r.point(-Q,i),r.point(0,i),r.point(Q,i),r.point(Q,0),r.point(Q,-i),r.point(0,-i),r.point(-Q,-i),r.point(-Q,0),r.point(-Q,i);else if(nt(e[0]-t[0])>X){var s=e[0]<t[0]?Q:-Q;i=n*s/2,r.point(-s,i),r.point(0,i),r.point(s,i)}else r.point(t[0],t[1])}function ng(e){var t=Y(e),n=2*Z,r=t>0,i=nt(t)>X;function s(h,u,f,_){Xp(_,e,n,f,h,u)}function o(h,u){return Y(h)*Y(u)>t}function a(h){var u,f,_,b,A;return{lineStart:function(){b=_=!1,A=1},point:function(N,I){var $=[N,I],C,k=o(N,I),O=r?k?0:c(N,I):k?c(N+(N<0?Q:-Q),I):0;if(!u&&(b=_=k)&&h.lineStart(),k!==_&&(C=l(u,$),(!C||pr(u,C)||pr($,C))&&($[2]=1)),k!==_)A=0,k?(h.lineStart(),C=l($,u),h.point(C[0],C[1])):(C=l(u,$),h.point(C[0],C[1],2),h.lineEnd()),u=C;else if(i&&u&&r^k){var L;!(O&f)&&(L=l($,u,!0))&&(A=0,r?(h.lineStart(),h.point(L[0][0],L[0][1]),h.point(L[1][0],L[1][1]),h.lineEnd()):(h.point(L[1][0],L[1][1]),h.lineEnd(),h.lineStart(),h.point(L[0][0],L[0][1],3)))}k&&(!u||!pr(u,$))&&h.point($[0],$[1]),u=$,_=k,f=O},lineEnd:function(){_&&h.lineEnd(),u=null},clean:function(){return A|(b&&_)<<1}}}function l(h,u,f){var _=Ze(h),b=Ze(u),A=[1,0,0],N=Nr(_,b),I=er(N,N),$=N[0],C=I-$*$;if(!C)return!f&&h;var k=t*I/C,O=-t*$/C,L=Nr(A,N),z=nr(A,k),d=nr(N,O);$i(z,d);var g=L,w=er(z,g),v=er(g,g),S=w*w-v*(er(z,z)-1);if(!(S<0)){var M=ne(S),y=nr(g,(-w-M)/v);if($i(y,z),y=Zi(y),!f)return y;var p=h[0],m=u[0],x=h[1],E=u[1],T;m<p&&(T=p,p=m,m=T);var R=m-p,D=nt(R-Q)<X,B=D||R<X;if(!D&&E<x&&(T=x,x=E,E=T),B?D?x+E>0^y[1]<(nt(y[0]-p)<X?x:E):x<=y[1]&&y[1]<=E:R>Q^(p<=y[0]&&y[0]<=m)){var H=nr(g,(-w+M)/v);return $i(H,z),[y,Zi(H)]}}}function c(h,u){var f=r?e:Q-e,_=0;return h<-f?_|=1:h>f&&(_|=2),u<-f?_|=4:u>f&&(_|=8),_}return lu(o,a,s,r?[0,-e]:[-Q,e-Q])}function rg(e,t,n,r,i,s){var o=e[0],a=e[1],l=t[0],c=t[1],h=0,u=1,f=l-o,_=c-a,b;if(b=n-o,!(!f&&b>0)){if(b/=f,f<0){if(b<h)return;b<u&&(u=b)}else if(f>0){if(b>u)return;b>h&&(h=b)}if(b=i-o,!(!f&&b<0)){if(b/=f,f<0){if(b>u)return;b>h&&(h=b)}else if(f>0){if(b<h)return;b<u&&(u=b)}if(b=r-a,!(!_&&b>0)){if(b/=_,_<0){if(b<h)return;b<u&&(u=b)}else if(_>0){if(b>u)return;b>h&&(h=b)}if(b=s-a,!(!_&&b<0)){if(b/=_,_<0){if(b>u)return;b>h&&(h=b)}else if(_>0){if(b<h)return;b<u&&(u=b)}return h>0&&(e[0]=o+h*f,e[1]=a+h*_),u<1&&(t[0]=o+u*f,t[1]=a+u*_),!0}}}}}var mn=1e9,ir=-mn;function ig(e,t,n,r){function i(c,h){return e<=c&&c<=n&&t<=h&&h<=r}function s(c,h,u,f){var _=0,b=0;if(c==null||(_=o(c,u))!==(b=o(h,u))||l(c,h)<0^u>0)do f.point(_===0||_===3?e:n,_>1?r:t);while((_=(_+u+4)%4)!==b);else f.point(h[0],h[1])}function o(c,h){return nt(c[0]-e)<X?h>0?0:3:nt(c[0]-n)<X?h>0?2:1:nt(c[1]-t)<X?h>0?1:0:h>0?3:2}function a(c,h){return l(c.x,h.x)}function l(c,h){var u=o(c,1),f=o(h,1);return u!==f?u-f:u===0?h[1]-c[1]:u===1?c[0]-h[0]:u===2?c[1]-h[1]:h[0]-c[0]}return function(c){var h=c,u=ou(),f,_,b,A,N,I,$,C,k,O,L,z={point:d,lineStart:S,lineEnd:M,polygonStart:w,polygonEnd:v};function d(p,m){i(p,m)&&h.point(p,m)}function g(){for(var p=0,m=0,x=_.length;m<x;++m)for(var E=_[m],T=1,R=E.length,D=E[0],B,H,G=D[0],F=D[1];T<R;++T)B=G,H=F,D=E[T],G=D[0],F=D[1],H<=r?F>r&&(G-B)*(r-H)>(F-H)*(e-B)&&++p:F<=r&&(G-B)*(r-H)<(F-H)*(e-B)&&--p;return p}function w(){h=u,f=[],_=[],L=!0}function v(){var p=g(),m=L&&p,x=(f=Sl(f)).length;(m||x)&&(c.polygonStart(),m&&(c.lineStart(),s(null,null,1,c),c.lineEnd()),x&&au(f,a,p,s,c),c.polygonEnd()),h=c,f=_=b=null}function S(){z.point=y,_&&_.push(b=[]),O=!0,k=!1,$=C=NaN}function M(){f&&(y(A,N),I&&k&&u.rejoin(),f.push(u.result())),z.point=d,k&&h.lineEnd()}function y(p,m){var x=i(p,m);if(_&&b.push([p,m]),O)A=p,N=m,I=x,O=!1,x&&(h.lineStart(),h.point(p,m));else if(x&&k)h.point(p,m);else{var E=[$=Math.max(ir,Math.min(mn,$)),C=Math.max(ir,Math.min(mn,C))],T=[p=Math.max(ir,Math.min(mn,p)),m=Math.max(ir,Math.min(mn,m))];rg(E,T,e,t,n,r)?(k||(h.lineStart(),h.point(E[0],E[1])),h.point(T[0],T[1]),x||h.lineEnd(),L=!1):x&&(h.lineStart(),h.point(p,m),L=!1)}$=p,C=m,k=x}return z}}var ss,os,gr,mr,Je={sphere:lt,point:lt,lineStart:sg,lineEnd:lt,polygonStart:lt,polygonEnd:lt};function sg(){Je.point=ag,Je.lineEnd=og}function og(){Je.point=Je.lineEnd=lt}function ag(e,t){e*=Z,t*=Z,os=e,gr=j(t),mr=Y(t),Je.point=lg}function lg(e,t){e*=Z,t*=Z;var n=j(t),r=Y(t),i=nt(e-os),s=Y(i),o=j(i),a=r*o,l=mr*n-gr*r*s,c=gr*n+mr*r*s;ss.add(ce(ne(a*a+l*l),c)),os=e,gr=n,mr=r}function ug(e){return ss=new qt,me(e,Je),+ss}var as=[null,null],cg={type:"LineString",coordinates:as};function Br(e,t){return as[0]=e,as[1]=t,ug(cg)}function xa(e,t,n){var r=Ge(e,t-X,n).concat(t);return function(i){return r.map(function(s){return[i,s]})}}function ba(e,t,n){var r=Ge(e,t-X,n).concat(t);return function(i){return r.map(function(s){return[s,i]})}}function hg(){var e,t,n,r,i,s,o,a,l=10,c=l,h=90,u=360,f,_,b,A,N=2.5;function I(){return{type:"MultiLineString",coordinates:$()}}function $(){return Ge(tr(r/h)*h,n,h).map(b).concat(Ge(tr(a/u)*u,o,u).map(A)).concat(Ge(tr(t/l)*l,e,l).filter(function(C){return nt(C%h)>X}).map(f)).concat(Ge(tr(s/c)*c,i,c).filter(function(C){return nt(C%u)>X}).map(_))}return I.lines=function(){return $().map(function(C){return{type:"LineString",coordinates:C}})},I.outline=function(){return{type:"Polygon",coordinates:[b(r).concat(A(o).slice(1),b(n).reverse().slice(1),A(a).reverse().slice(1))]}},I.extent=function(C){return arguments.length?I.extentMajor(C).extentMinor(C):I.extentMinor()},I.extentMajor=function(C){return arguments.length?(r=+C[0][0],n=+C[1][0],a=+C[0][1],o=+C[1][1],r>n&&(C=r,r=n,n=C),a>o&&(C=a,a=o,o=C),I.precision(N)):[[r,a],[n,o]]},I.extentMinor=function(C){return arguments.length?(t=+C[0][0],e=+C[1][0],s=+C[0][1],i=+C[1][1],t>e&&(C=t,t=e,e=C),s>i&&(C=s,s=i,i=C),I.precision(N)):[[t,s],[e,i]]},I.step=function(C){return arguments.length?I.stepMajor(C).stepMinor(C):I.stepMinor()},I.stepMajor=function(C){return arguments.length?(h=+C[0],u=+C[1],I):[h,u]},I.stepMinor=function(C){return arguments.length?(l=+C[0],c=+C[1],I):[l,c]},I.precision=function(C){return arguments.length?(N=+C,f=xa(s,i,90),_=ba(t,e,N),b=xa(a,o,90),A=ba(r,n,N),I):N},I.extentMajor([[-180,-90+X],[180,90-X]]).extentMinor([[-180,-80-X],[180,80+X]])}const ls=e=>e;var Ii=new qt,us=new qt,uu,cu,cs,hs,se={point:lt,lineStart:lt,lineEnd:lt,polygonStart:function(){se.lineStart=fg,se.lineEnd=pg},polygonEnd:function(){se.lineStart=se.lineEnd=se.point=lt,Ii.add(nt(us)),us=new qt},result:function(){var e=Ii/2;return Ii=new qt,e}};function fg(){se.point=dg}function dg(e,t){se.point=hu,uu=cs=e,cu=hs=t}function hu(e,t){us.add(hs*e-cs*t),cs=e,hs=t}function pg(){hu(uu,cu)}var tn=1/0,Fr=tn,kn=-tn,Hr=kn,qr={point:gg,lineStart:lt,lineEnd:lt,polygonStart:lt,polygonEnd:lt,result:function(){var e=[[tn,Fr],[kn,Hr]];return kn=Hr=-(Fr=tn=1/0),e}};function gg(e,t){e<tn&&(tn=e),e>kn&&(kn=e),t<Fr&&(Fr=t),t>Hr&&(Hr=t)}var fs=0,ds=0,yn=0,Gr=0,jr=0,We=0,ps=0,gs=0,_n=0,fu,du,Yt,Vt,Dt={point:De,lineStart:Sa,lineEnd:Ea,polygonStart:function(){Dt.lineStart=_g,Dt.lineEnd=wg},polygonEnd:function(){Dt.point=De,Dt.lineStart=Sa,Dt.lineEnd=Ea},result:function(){var e=_n?[ps/_n,gs/_n]:We?[Gr/We,jr/We]:yn?[fs/yn,ds/yn]:[NaN,NaN];return fs=ds=yn=Gr=jr=We=ps=gs=_n=0,e}};function De(e,t){fs+=e,ds+=t,++yn}function Sa(){Dt.point=mg}function mg(e,t){Dt.point=yg,De(Yt=e,Vt=t)}function yg(e,t){var n=e-Yt,r=t-Vt,i=ne(n*n+r*r);Gr+=i*(Yt+e)/2,jr+=i*(Vt+t)/2,We+=i,De(Yt=e,Vt=t)}function Ea(){Dt.point=De}function _g(){Dt.point=vg}function wg(){pu(fu,du)}function vg(e,t){Dt.point=pu,De(fu=Yt=e,du=Vt=t)}function pu(e,t){var n=e-Yt,r=t-Vt,i=ne(n*n+r*r);Gr+=i*(Yt+e)/2,jr+=i*(Vt+t)/2,We+=i,i=Vt*e-Yt*t,ps+=i*(Yt+e),gs+=i*(Vt+t),_n+=i*3,De(Yt=e,Vt=t)}function gu(e){this._context=e}gu.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Pt);break}}},result:lt};var ms=new qt,Ti,mu,yu,wn,vn,Cn={point:lt,lineStart:function(){Cn.point=xg},lineEnd:function(){Ti&&_u(mu,yu),Cn.point=lt},polygonStart:function(){Ti=!0},polygonEnd:function(){Ti=null},result:function(){var e=+ms;return ms=new qt,e}};function xg(e,t){Cn.point=_u,mu=wn=e,yu=vn=t}function _u(e,t){wn-=e,vn-=t,ms.add(ne(wn*wn+vn*vn)),wn=e,vn=t}let Ma,Wr,$a,Aa;class Ia{constructor(t){this._append=t==null?wu:bg(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,n){switch(this._point){case 0:{this._append`M${t},${n}`,this._point=1;break}case 1:{this._append`L${t},${n}`;break}default:{if(this._append`M${t},${n}`,this._radius!==$a||this._append!==Wr){const r=this._radius,i=this._;this._="",this._append`m0,${r}a${r},${r} 0 1,1 0,${-2*r}a${r},${r} 0 1,1 0,${2*r}z`,$a=r,Wr=this._append,Aa=this._,this._=i}this._+=Aa;break}}}result(){const t=this._;return this._="",t.length?t:null}}function wu(e){let t=1;this._+=e[0];for(const n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function bg(e){const t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return wu;if(t!==Ma){const n=10**t;Ma=t,Wr=function(i){let s=1;this._+=i[0];for(const o=i.length;s<o;++s)this._+=Math.round(arguments[s]*n)/n+i[s]}}return Wr}function Xs(e,t){let n=3,r=4.5,i,s;function o(a){return a&&(typeof r=="function"&&s.pointRadius(+r.apply(this,arguments)),me(a,i(s))),s.result()}return o.area=function(a){return me(a,i(se)),se.result()},o.measure=function(a){return me(a,i(Cn)),Cn.result()},o.bounds=function(a){return me(a,i(qr)),qr.result()},o.centroid=function(a){return me(a,i(Dt)),Dt.result()},o.projection=function(a){return arguments.length?(i=a==null?(e=null,ls):(e=a).stream,o):e},o.context=function(a){return arguments.length?(s=a==null?(t=null,new Ia(n)):new gu(t=a),typeof r!="function"&&s.pointRadius(r),o):t},o.pointRadius=function(a){return arguments.length?(r=typeof a=="function"?a:(s.pointRadius(+a),+a),o):r},o.digits=function(a){if(!arguments.length)return n;if(a==null)n=null;else{const l=Math.floor(a);if(!(l>=0))throw new RangeError(`invalid digits: ${a}`);n=l}return t===null&&(s=new Ia(n)),o},o.projection(e).digits(n).context(t)}function Ks(e){return function(t){var n=new ys;for(var r in e)n[r]=e[r];return n.stream=t,n}}function ys(){}ys.prototype={constructor:ys,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Qs(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),r!=null&&e.clipExtent(null),me(n,e.stream(qr)),t(qr.result()),r!=null&&e.clipExtent(r),e}function vu(e,t,n){return Qs(e,function(r){var i=t[1][0]-t[0][0],s=t[1][1]-t[0][1],o=Math.min(i/(r[1][0]-r[0][0]),s/(r[1][1]-r[0][1])),a=+t[0][0]+(i-o*(r[1][0]+r[0][0]))/2,l=+t[0][1]+(s-o*(r[1][1]+r[0][1]))/2;e.scale(150*o).translate([a,l])},n)}function Sg(e,t,n){return vu(e,[[0,0],t],n)}function Eg(e,t,n){return Qs(e,function(r){var i=+t,s=i/(r[1][0]-r[0][0]),o=(i-s*(r[1][0]+r[0][0]))/2,a=-s*r[0][1];e.scale(150*s).translate([o,a])},n)}function Mg(e,t,n){return Qs(e,function(r){var i=+t,s=i/(r[1][1]-r[0][1]),o=-s*r[0][0],a=(i-s*(r[1][1]+r[0][1]))/2;e.scale(150*s).translate([o,a])},n)}var Ta=16,$g=Y(30*Z);function Pa(e,t){return+t?Ig(e,t):Ag(e)}function Ag(e){return Ks({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function Ig(e,t){function n(r,i,s,o,a,l,c,h,u,f,_,b,A,N){var I=c-r,$=h-i,C=I*I+$*$;if(C>4*t&&A--){var k=o+f,O=a+_,L=l+b,z=ne(k*k+O*O+L*L),d=he(L/=z),g=nt(nt(L)-1)<X||nt(s-u)<X?(s+u)/2:ce(O,k),w=e(g,d),v=w[0],S=w[1],M=v-r,y=S-i,p=$*M-I*y;(p*p/C>t||nt((I*M+$*y)/C-.5)>.3||o*f+a*_+l*b<$g)&&(n(r,i,s,o,a,l,v,S,g,k/=z,O/=z,L,A,N),N.point(v,S),n(v,S,g,k,O,L,c,h,u,f,_,b,A,N))}}return function(r){var i,s,o,a,l,c,h,u,f,_,b,A,N={point:I,lineStart:$,lineEnd:k,polygonStart:function(){r.polygonStart(),N.lineStart=O},polygonEnd:function(){r.polygonEnd(),N.lineStart=$}};function I(d,g){d=e(d,g),r.point(d[0],d[1])}function $(){u=NaN,N.point=C,r.lineStart()}function C(d,g){var w=Ze([d,g]),v=e(d,g);n(u,f,h,_,b,A,u=v[0],f=v[1],h=d,_=w[0],b=w[1],A=w[2],Ta,r),r.point(u,f)}function k(){N.point=I,r.lineEnd()}function O(){$(),N.point=L,N.lineEnd=z}function L(d,g){C(i=d,g),s=u,o=f,a=_,l=b,c=A,N.point=C}function z(){n(u,f,h,_,b,A,s,o,i,a,l,c,Ta,r),N.lineEnd=k,k()}return N}}var Tg=Ks({point:function(e,t){this.stream.point(e*Z,t*Z)}});function Pg(e){return Ks({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}function Ng(e,t,n,r,i){function s(o,a){return o*=r,a*=i,[t+e*o,n-e*a]}return s.invert=function(o,a){return[(o-t)/e*r,(n-a)/e*i]},s}function Na(e,t,n,r,i,s){if(!s)return Ng(e,t,n,r,i);var o=Y(s),a=j(s),l=o*e,c=a*e,h=o/e,u=a/e,f=(a*n-o*t)/e,_=(a*t+o*n)/e;function b(A,N){return A*=r,N*=i,[l*A-c*N+t,n-c*A-l*N]}return b.invert=function(A,N){return[r*(h*A-u*N+f),i*(_-u*A-h*N)]},b}function Zs(e){return kg(function(){return e})()}function kg(e){var t,n=150,r=480,i=250,s=0,o=0,a=0,l=0,c=0,h,u=0,f=1,_=1,b=null,A=va,N=null,I,$,C,k=ls,O=.5,L,z,d,g,w;function v(p){return d(p[0]*Z,p[1]*Z)}function S(p){return p=d.invert(p[0],p[1]),p&&[p[0]*_t,p[1]*_t]}v.stream=function(p){return g&&w===p?g:g=Tg(Pg(h)(A(L(k(w=p)))))},v.preclip=function(p){return arguments.length?(A=p,b=void 0,y()):A},v.postclip=function(p){return arguments.length?(k=p,N=I=$=C=null,y()):k},v.clipAngle=function(p){return arguments.length?(A=+p?ng(b=p*Z):(b=null,va),y()):b*_t},v.clipExtent=function(p){return arguments.length?(k=p==null?(N=I=$=C=null,ls):ig(N=+p[0][0],I=+p[0][1],$=+p[1][0],C=+p[1][1]),y()):N==null?null:[[N,I],[$,C]]},v.scale=function(p){return arguments.length?(n=+p,M()):n},v.translate=function(p){return arguments.length?(r=+p[0],i=+p[1],M()):[r,i]},v.center=function(p){return arguments.length?(s=p[0]%360*Z,o=p[1]%360*Z,M()):[s*_t,o*_t]},v.rotate=function(p){return arguments.length?(a=p[0]%360*Z,l=p[1]%360*Z,c=p.length>2?p[2]%360*Z:0,M()):[a*_t,l*_t,c*_t]},v.angle=function(p){return arguments.length?(u=p%360*Z,M()):u*_t},v.reflectX=function(p){return arguments.length?(f=p?-1:1,M()):f<0},v.reflectY=function(p){return arguments.length?(_=p?-1:1,M()):_<0},v.precision=function(p){return arguments.length?(L=Pa(z,O=p*p),y()):ne(O)},v.fitExtent=function(p,m){return vu(v,p,m)},v.fitSize=function(p,m){return Sg(v,p,m)},v.fitWidth=function(p,m){return Eg(v,p,m)},v.fitHeight=function(p,m){return Mg(v,p,m)};function M(){var p=Na(n,0,0,f,_,u).apply(null,t(s,o)),m=Na(n,r-p[0],i-p[1],f,_,u);return h=su(a,l,c),z=rs(t,m),d=rs(h,z),L=Pa(z,O),y()}function y(){return g=w=null,v}return function(){return t=e.apply(this,arguments),v.invert=t.invert&&S,M()}}function xu(e){return function(t,n){var r=ne(t*t+n*n),i=e(r),s=j(i),o=Y(i);return[ce(t*s,r*o),he(r&&n*s/r)]}}function Js(e,t){return[e,tu(eu((gt+t)/2))]}Js.invert=function(e,t){return[e,2*ai(Jl(t))-gt]};function Cg(){return bu(Js).scale(961/Pt)}function bu(e){var t=Zs(e),n=t.center,r=t.scale,i=t.translate,s=t.clipExtent,o=null,a,l,c;t.scale=function(u){return arguments.length?(r(u),h()):r()},t.translate=function(u){return arguments.length?(i(u),h()):i()},t.center=function(u){return arguments.length?(n(u),h()):n()},t.clipExtent=function(u){return arguments.length?(u==null?o=a=l=c=null:(o=+u[0][0],a=+u[0][1],l=+u[1][0],c=+u[1][1]),h()):o==null?null:[[o,a],[l,c]]};function h(){var u=Q*r(),f=t(Ur(t.rotate()).invert([0,0]));return s(o==null?[[f[0]-u,f[1]-u],[f[0]+u,f[1]+u]]:e===Js?[[Math.max(f[0]-u,o),a],[Math.min(f[0]+u,l),c]]:[[o,Math.max(f[1]-u,a)],[l,Math.min(f[1]+u,c)]])}return h()}function Su(e,t){return[Y(t)*j(e),j(t)]}Su.invert=xu(he);function Og(){return Zs(Su).scale(249.5).clipAngle(90+X)}function Eu(e,t){var n=Y(t),r=1+Y(e)*n;return[n*j(e)/r,j(t)/r]}Eu.invert=xu(function(e){return 2*ai(e)});function Mu(){return Zs(Eu).scale(250).clipAngle(142)}function $u(e,t){return[tu(eu((gt+t)/2)),-e]}$u.invert=function(e,t){return[-t,2*ai(Jl(e))-gt]};function Lg(){var e=bu($u),t=e.center,n=e.rotate;return e.center=function(r){return arguments.length?t([-r[1],r[0]]):(r=t(),[r[1],-r[0]])},e.rotate=function(r){return arguments.length?n([r[0],r[1],r.length>2?r[2]+90:90]):(r=n(),[r[0],r[1],r[2]-90])},n([0,0,90]).scale(159.155)}const sr=e=>()=>e;function Rg(e,{sourceEvent:t,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function oe(e,t,n){this.k=e,this.x=t,this.y=n}oe.prototype={constructor:oe,scale:function(e){return e===1?this:new oe(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new oe(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Au=new oe(1,0,0);oe.prototype;function Pi(e){e.stopImmediatePropagation()}function fn(e){e.preventDefault(),e.stopImmediatePropagation()}function Dg(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function zg(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function ka(){return this.__zoom||Au}function Ug(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function Bg(){return navigator.maxTouchPoints||"ontouchstart"in this}function Fg(e,t,n){var r=e.invertX(t[0][0])-n[0][0],i=e.invertX(t[1][0])-n[1][0],s=e.invertY(t[0][1])-n[0][1],o=e.invertY(t[1][1])-n[1][1];return e.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function Hg(){var e=Dg,t=zg,n=Fg,r=Ug,i=Bg,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,l=ed,c=ri("start","zoom","end"),h,u,f,_=500,b=150,A=0,N=10;function I(y){y.property("__zoom",ka).on("wheel.zoom",d,{passive:!1}).on("mousedown.zoom",g).on("dblclick.zoom",w).filter(i).on("touchstart.zoom",v).on("touchmove.zoom",S).on("touchend.zoom touchcancel.zoom",M).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}I.transform=function(y,p,m,x){var E=y.selection?y.selection():y;E.property("__zoom",ka),y!==E?O(y,p,m,x):E.interrupt().each(function(){L(this,arguments).event(x).start().zoom(null,typeof p=="function"?p.apply(this,arguments):p).end()})},I.scaleBy=function(y,p,m,x){I.scaleTo(y,function(){var E=this.__zoom.k,T=typeof p=="function"?p.apply(this,arguments):p;return E*T},m,x)},I.scaleTo=function(y,p,m,x){I.transform(y,function(){var E=t.apply(this,arguments),T=this.__zoom,R=m==null?k(E):typeof m=="function"?m.apply(this,arguments):m,D=T.invert(R),B=typeof p=="function"?p.apply(this,arguments):p;return n(C($(T,B),R,D),E,o)},m,x)},I.translateBy=function(y,p,m,x){I.transform(y,function(){return n(this.__zoom.translate(typeof p=="function"?p.apply(this,arguments):p,typeof m=="function"?m.apply(this,arguments):m),t.apply(this,arguments),o)},null,x)},I.translateTo=function(y,p,m,x,E){I.transform(y,function(){var T=t.apply(this,arguments),R=this.__zoom,D=x==null?k(T):typeof x=="function"?x.apply(this,arguments):x;return n(Au.translate(D[0],D[1]).scale(R.k).translate(typeof p=="function"?-p.apply(this,arguments):-p,typeof m=="function"?-m.apply(this,arguments):-m),T,o)},x,E)};function $(y,p){return p=Math.max(s[0],Math.min(s[1],p)),p===y.k?y:new oe(p,y.x,y.y)}function C(y,p,m){var x=p[0]-m[0]*y.k,E=p[1]-m[1]*y.k;return x===y.x&&E===y.y?y:new oe(y.k,x,E)}function k(y){return[(+y[0][0]+ +y[1][0])/2,(+y[0][1]+ +y[1][1])/2]}function O(y,p,m,x){y.on("start.zoom",function(){L(this,arguments).event(x).start()}).on("interrupt.zoom end.zoom",function(){L(this,arguments).event(x).end()}).tween("zoom",function(){var E=this,T=arguments,R=L(E,T).event(x),D=t.apply(E,T),B=m==null?k(D):typeof m=="function"?m.apply(E,T):m,H=Math.max(D[1][0]-D[0][0],D[1][1]-D[0][1]),G=E.__zoom,F=typeof p=="function"?p.apply(E,T):p,W=l(G.invert(B).concat(H/G.k),F.invert(B).concat(H/F.k));return function(J){if(J===1)J=F;else{var bt=W(J),xe=H/bt[2];J=new oe(xe,B[0]-bt[0]*xe,B[1]-bt[1]*xe)}R.zoom(null,J)}})}function L(y,p,m){return!m&&y.__zooming||new z(y,p)}function z(y,p){this.that=y,this.args=p,this.active=0,this.sourceEvent=null,this.extent=t.apply(y,p),this.taps=0}z.prototype={event:function(y){return y&&(this.sourceEvent=y),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(y,p){return this.mouse&&y!=="mouse"&&(this.mouse[1]=p.invert(this.mouse[0])),this.touch0&&y!=="touch"&&(this.touch0[1]=p.invert(this.touch0[0])),this.touch1&&y!=="touch"&&(this.touch1[1]=p.invert(this.touch1[0])),this.that.__zoom=p,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(y){var p=dt(this.that).datum();c.call(y,this.that,new Rg(y,{sourceEvent:this.sourceEvent,target:I,transform:this.that.__zoom,dispatch:c}),p)}};function d(y,...p){if(!e.apply(this,arguments))return;var m=L(this,p).event(y),x=this.__zoom,E=Math.max(s[0],Math.min(s[1],x.k*Math.pow(2,r.apply(this,arguments)))),T=Wt(y);if(m.wheel)(m.mouse[0][0]!==T[0]||m.mouse[0][1]!==T[1])&&(m.mouse[1]=x.invert(m.mouse[0]=T)),clearTimeout(m.wheel);else{if(x.k===E)return;m.mouse=[T,x.invert(T)],dr(this),m.start()}fn(y),m.wheel=setTimeout(R,b),m.zoom("mouse",n(C($(x,E),m.mouse[0],m.mouse[1]),m.extent,o));function R(){m.wheel=null,m.end()}}function g(y,...p){if(f||!e.apply(this,arguments))return;var m=y.currentTarget,x=L(this,p,!0).event(y),E=dt(y.view).on("mousemove.zoom",B,!0).on("mouseup.zoom",H,!0),T=Wt(y,m),R=y.clientX,D=y.clientY;Dl(y.view),Pi(y),x.mouse=[T,this.__zoom.invert(T)],dr(this),x.start();function B(G){if(fn(G),!x.moved){var F=G.clientX-R,W=G.clientY-D;x.moved=F*F+W*W>A}x.event(G).zoom("mouse",n(C(x.that.__zoom,x.mouse[0]=Wt(G,m),x.mouse[1]),x.extent,o))}function H(G){E.on("mousemove.zoom mouseup.zoom",null),zl(G.view,x.moved),fn(G),x.event(G).end()}}function w(y,...p){if(e.apply(this,arguments)){var m=this.__zoom,x=Wt(y.changedTouches?y.changedTouches[0]:y,this),E=m.invert(x),T=m.k*(y.shiftKey?.5:2),R=n(C($(m,T),x,E),t.apply(this,p),o);fn(y),a>0?dt(this).transition().duration(a).call(O,R,x,y):dt(this).call(I.transform,R,x,y)}}function v(y,...p){if(e.apply(this,arguments)){var m=y.touches,x=m.length,E=L(this,p,y.changedTouches.length===x).event(y),T,R,D,B;for(Pi(y),R=0;R<x;++R)D=m[R],B=Wt(D,this),B=[B,this.__zoom.invert(B),D.identifier],E.touch0?!E.touch1&&E.touch0[2]!==B[2]&&(E.touch1=B,E.taps=0):(E.touch0=B,T=!0,E.taps=1+!!h);h&&(h=clearTimeout(h)),T&&(E.taps<2&&(u=B[0],h=setTimeout(function(){h=null},_)),dr(this),E.start())}}function S(y,...p){if(this.__zooming){var m=L(this,p).event(y),x=y.changedTouches,E=x.length,T,R,D,B;for(fn(y),T=0;T<E;++T)R=x[T],D=Wt(R,this),m.touch0&&m.touch0[2]===R.identifier?m.touch0[0]=D:m.touch1&&m.touch1[2]===R.identifier&&(m.touch1[0]=D);if(R=m.that.__zoom,m.touch1){var H=m.touch0[0],G=m.touch0[1],F=m.touch1[0],W=m.touch1[1],J=(J=F[0]-H[0])*J+(J=F[1]-H[1])*J,bt=(bt=W[0]-G[0])*bt+(bt=W[1]-G[1])*bt;R=$(R,Math.sqrt(J/bt)),D=[(H[0]+F[0])/2,(H[1]+F[1])/2],B=[(G[0]+W[0])/2,(G[1]+W[1])/2]}else if(m.touch0)D=m.touch0[0],B=m.touch0[1];else return;m.zoom("touch",n(C(R,D,B),m.extent,o))}}function M(y,...p){if(this.__zooming){var m=L(this,p).event(y),x=y.changedTouches,E=x.length,T,R;for(Pi(y),f&&clearTimeout(f),f=setTimeout(function(){f=null},_),T=0;T<E;++T)R=x[T],m.touch0&&m.touch0[2]===R.identifier?delete m.touch0:m.touch1&&m.touch1[2]===R.identifier&&delete m.touch1;if(m.touch1&&!m.touch0&&(m.touch0=m.touch1,delete m.touch1),m.touch0)m.touch0[1]=this.__zoom.invert(m.touch0[0]);else if(m.end(),m.taps===2&&(R=Wt(R,this),Math.hypot(u[0]-R[0],u[1]-R[1])<N)){var D=dt(this).on("dblclick.zoom");D&&D.apply(this,arguments)}}}return I.wheelDelta=function(y){return arguments.length?(r=typeof y=="function"?y:sr(+y),I):r},I.filter=function(y){return arguments.length?(e=typeof y=="function"?y:sr(!!y),I):e},I.touchable=function(y){return arguments.length?(i=typeof y=="function"?y:sr(!!y),I):i},I.extent=function(y){return arguments.length?(t=typeof y=="function"?y:sr([[+y[0][0],+y[0][1]],[+y[1][0],+y[1][1]]]),I):t},I.scaleExtent=function(y){return arguments.length?(s[0]=+y[0],s[1]=+y[1],I):[s[0],s[1]]},I.translateExtent=function(y){return arguments.length?(o[0][0]=+y[0][0],o[1][0]=+y[1][0],o[0][1]=+y[0][1],o[1][1]=+y[1][1],I):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},I.constrain=function(y){return arguments.length?(n=y,I):n},I.duration=function(y){return arguments.length?(a=+y,I):a},I.interpolate=function(y){return arguments.length?(l=y,I):l},I.on=function(){var y=c.on.apply(c,arguments);return y===c?I:y},I.clickDistance=function(y){return arguments.length?(A=(y=+y)*y,I):Math.sqrt(A)},I.tapDistance=function(y){return arguments.length?(N=+y,I):N},I}function li(){return{systemMap:new Map,laneMap:new Map,neighborMap:new Map}}function Iu(e,t){e.systemMap.set(t.id,t)}function _s(e,t,n){const r=[t.id,n.id].sort((s,o)=>s.localeCompare(o)).join("-");if(e.laneMap.has(r))return;const i={id:r,fromId:t.id,toId:n.id,movement:[0,0]};e.laneMap.set(r,i)}function ui(e){const t=new Map;for(const n of e.laneMap.values())t.has(n.fromId)||t.set(n.fromId,[]),t.get(n.fromId)?.push(n.toId),t.has(n.toId)||t.set(n.toId,[]),t.get(n.toId)?.push(n.fromId);e.neighborMap=t}function At(e,t){const n=e.systemMap.get(t);if(!n)return[];(!e.neighborMap||e.neighborMap.size===0)&&ui(e);const r=e.neighborMap.get(n.id);return r?r.map(i=>e.systemMap.get(i)).filter(i=>!!i):[]}function ci(e,t,n){return e.neighborMap.get(t)?.includes(n)||!1}function Tu(e,t){return to(t,Array.from(e.systemMap.values()))}function to(e,t){if(t.length===0)return null;let n=null,r=1/0;return t.forEach(i=>{if(i.location[0]===e[0]&&i.location[1]===e[1])return;const s=Br(e,i.location);s<r&&(r=s,n=i)}),n}function qg(e){console.log("Loading world from JSON...",e);const t=li();return t.systemMap=new Map(e.systems),t.laneMap=new Map(e.lanes),ui(t),t}function Gg(e){return{systems:Array.from(e.systemMap.entries()),lanes:Array.from(e.laneMap.entries())}}function Pu(){return{playerName:localStorage.getItem("starz_playerName")??"Player",numBots:Oh,fow:kh,numSystems:Ch,timeScale:1}}function eo(){return{world:li(),playerMap:new Map}}function Nu(e,t){e.playerMap.set(t.id,t)}function no(e){const{C:t}=globalThis.gameManager.getContext();if(!t.playerId)return null;for(const n of e.world.systemMap.values())if(n.homeworld===t.playerId)return n;return null}function hi(e,t){const{P:n}=globalThis.gameManager.getContext();if(!n)return;n.revealedSystems.add(t.id),n.visitedSystems.add(t.id);const r=At(e.world,t.id);if(r)return r.forEach(i=>n.revealedSystems.add(i.id)),e}function ku(e){const{P:t}=globalThis.gameManager.getContext();if(t)for(const n of e.world.systemMap.values())t.revealedSystems.add(n.id)}function Cu(e,t,n,r,i){e.moveQueue.push({ships:n,toId:t.id,fromId:e.id,playerId:r,message:i})}const or=100,Ni={territory:{aggression:.3,expansion:1,defensiveness:.5,riskTolerance:.4,speed:or},rusher:{aggression:1,expansion:.4,defensiveness:.1,riskTolerance:.7,speed:or},turtle:{aggression:.1,expansion:.3,defensiveness:.95,riskTolerance:.2,speed:or},balanced:{aggression:.5,expansion:.5,defensiveness:.5,riskTolerance:.5,speed:or}};function jg({S:e}){for(const t of e.playerMap.values())t.bot?.makeMoves()}let Wg=0;class Yg{constructor(t={}){this.queuedMoves=0,this.threatLevels=new Map,this.frontline=new Set,this.backline=new Set;const n=t.playerIndex??Wg++;this.id=t.id??`${n}`;let r=t.personality;if(!r){const i=Object.keys(Ni);r=i[n%i.length]}this.name=t.name??r,this.personality=r==="idle"?Ni.balanced:Ni[r]}makeMoves(){if(this.name==="idle")return;const n=gameManager.getState().world.systemMap.values();if(this.botSystems=Array.from(n).filter(l=>l.ownerId===this.id),this.botSystems.length===0)return;for(const l of this.botSystems)l.moveQueue=[];this.queuedMoves=0,this.analyzeMap();const r=this.getDefensiveMoves();if(this.chooseMoves(r,1-this.personality.defensiveness),this.queuedMoves>=this.personality.speed)return;const i=this.getCoordinatedAttackMoves();if(this.chooseMoves(i,this.personality.aggression),this.queuedMoves>=this.personality.speed)return;const s=this.getExterminateMoves();if(this.chooseMoves(s,this.personality.defensiveness),this.queuedMoves>=this.personality.speed)return;const o=this.getExploreMoves();if(this.chooseMoves(o,this.personality.expansion),this.queuedMoves>=this.personality.speed)return;const a=this.getLogisticsMoves();this.chooseMoves(a,1),this.queuedMoves>=this.personality.speed}analyzeMap(){this.threatLevels.clear(),this.frontline.clear(),this.backline.clear();const t=gameManager.getState();this.botSystems.forEach(n=>{const r=At(t.world,n.id),i=r.filter(a=>a.ownerId&&a.ownerId!==this.id),s=r.filter(a=>!a.ownerId),o=i.reduce((a,l)=>a+l.ships,0);this.threatLevels.set(n.id,o),i.length>0||s.length>0?this.frontline.add(n.id):this.backline.add(n.id)})}getDefensiveMoves(){const t=gameManager.getState();return this.botSystems.map(n=>{if(n.moveQueue.length>0)return[];const r=[],i=this.threatLevels.get(n.id)??0;if(i>0){const s=i*1.1;if(n.ships<s)if(n.ships<i*.5){const o=At(t.world,n.id).filter(a=>a.ownerId===this.id).sort((a,l)=>(this.threatLevels.get(a.id)||0)-(this.threatLevels.get(l.id)||0))[0];o&&r.push({message:`Retreating from ${n.id}`,from:n,to:o,units:n.ships-1,score:1e3})}else r.push({message:`Holding ${n.id}`,from:n,to:n,units:0,score:i});else n.ships<s*1.5&&r.push({message:`Defending ${n.id} from threat level ${i}`,from:n,to:n,units:0,score:i})}return r})}getCoordinatedAttackMoves(){const t=gameManager.getState(),n=new Map;this.botSystems.forEach(i=>{if(i.moveQueue.length>0||i.ships<5)return;const s=At(t.world,i.id);s&&s.forEach(o=>{if(o.ownerId!==null&&o.ownerId!==this.id){if(At(t.world,i.id).filter(l=>l.ownerId&&l.ownerId!==this.id&&l.id!==o.id).length>0)return;n.has(o.id)||n.set(o.id,{target:o,attackers:[]}),n.get(o.id).attackers.push(i)}})});const r=[];return n.forEach(({target:i,attackers:s})=>{const a=At(t.world,i.id).filter(u=>u.ownerId===i.ownerId).length===0?1.5:1,l=s.reduce((u,f)=>{const _=this.threatLevels.get(f.id)||0,b=Math.max(0,f.ships-_*1.1);return u+Math.floor(b*(1-this.personality.defensiveness))},0),h=(i.ships+(i.homeworld?10:0))*(1.3-this.personality.riskTolerance);l>h&&s.forEach(u=>{if(u.moveQueue.length>0)return;const f=this.threatLevels.get(u.id)||0,_=Math.max(0,u.ships-f*1.1),b=Math.floor(_*(1-this.personality.defensiveness)),A=this.getBestMoveAmount(u,i,b);A>0&&r.push([{message:`Coordinated attack on ${i.id}`,from:u,to:i,units:A,score:(100+(i.homeworld?50:0))*a}])})}),r}getExterminateMoves(){const t=gameManager.getState();return this.botSystems.map(n=>n.moveQueue.length>0?[]:n.ships<3?[]:At(t.world,n.id).flatMap(i=>{if(i.ownerId===this.id)return[];if(i.ownerId===null&&i.type==="UNINHABITED")return[];if(n.ships>i.ships*1.5+5){const s=n.ships-2;return[{message:`Crushing weak neighbor ${i.id}`,from:n,to:i,units:s,score:40}]}return[]}))}getExploreMoves(){const t=gameManager.getState();return this.botSystems.map(n=>n.moveQueue.length>0?[]:n.ships<2?[]:At(t.world,n.id).flatMap(i=>{if(i.ownerId!==null)return[];if(i.type==="INHABITED")return[];const s=Math.max(1,Math.floor(n.ships*.3));return[{message:`Exploring ${i.id}`,from:n,to:i,units:s,score:30}]}))}getLogisticsMoves(){const t=gameManager.getState();return this.botSystems.map(n=>{if(n.moveQueue.length>0)return[];if(n.ships<2)return[];if(this.backline.has(n.id)){const r=At(t.world,n.id).filter(o=>this.frontline.has(o.id)&&o.ownerId===this.id);if(r.length>0){const o=r.sort((a,l)=>a.ships-l.ships)[0];return[{message:"Logistics: Frontline Support",from:n,to:o,units:n.ships-1,score:10}]}const s=At(t.world,n.id).filter(o=>o.ownerId===this.id).sort((o,a)=>o.ships-a.ships)[0];if(s&&s.ships<n.ships-2)return[{message:"Logistics: Balancing",from:n,to:s,units:Math.floor((n.ships-s.ships)/2),score:5}]}if(this.frontline.has(n.id)){const r=At(t.world,n.id).filter(i=>i.ownerId===this.id&&(this.threatLevels.get(i.id)||0)>i.ships);if(r.length>0&&(this.threatLevels.get(n.id)||0)<n.ships){const i=r[0];return[{message:"Logistics: Emergency Reinforce",from:n,to:i,units:Math.floor(n.ships/2),score:50}]}}return[]})}getBestMoveAmount(t,n,r){const i=Math.max(0,t.ships-1);let s=0;return n.ownerId===t.ownerId?s=Math.floor((t.ships-n.ships)/2):s=Math.floor(t.ships/2),s=Math.max(0,s),Math.abs(i-r)<Math.abs(s-r)?i:s}chooseMoves(t,n=1){if(t.length===0)return;const r=t.flat().sort(Vg);for(const i of r){if(this.queuedMoves>=this.personality.speed)return;if(Math.random()<n){if(i.from.moveQueue.length>0)continue;Cu(i.from,i.to,i.units,this.id,i.message),i.units>0&&this.queuedMoves++}}}}function Vg(e,t){return e.score!==t.score?t.score-e.score:Math.random()-.5}function en(e,...t){const n=globalThis.gameManager?.getContext?.().C;zh&&console.log(`[DEBUG][Tick ${n?.tick??null}] ${e}`,...t)}function ki(e,t={}){if(!Dh)return;const n=globalThis.gameManager?.getContext?.().C;let r=1;try{r=parseInt(localStorage.getItem(e)??"0",10)+1}catch(i){console.error("Error reading event count from localStorage:",i)}if(localStorage.setItem(e,r+""),window&&window.sa_event)try{window.sa_event(e,{[e]:r,tick:n?.tick??null,...t})}catch(i){console.error("Error tracking event:",i)}}function Ou(e,t,n,r){if(r!==0){if(r<0){if(t.ownerId!==n.ownerId)return;const i=t;t=n,n=i,r=-r}t.ships<r||(n.ownerId===t.ownerId?Qg(e,t,n,r):Xg(e,t,n,r))}}function Xg(e,t,n,r){const i=t.ownerId,s=n.ships??0;if(Ru(e.S.world,t,n,r),r>s){const o=r-s;t.ships=t.ships-r,n.ships=o,Kg(e,i,n)}else t.ships=t.ships-r,n.ships=s-r}function Kg(e,t,n){n.ownerId=t,n.moveQueue=[],t===e.C.playerId&&hi(e.S,n),n.homeworld&&n.homeworld!==t&&Lu(e,n.homeworld,t)}function Lu({S:e,E:t,C:n},r,i=null){for(const o of e.world.systemMap.values())o.ownerId===r&&(o.ownerId=i,o.ships=Math.max(Math.floor((o.ships??0)/2),1),o.homeworld=null,o.moveQueue=[],i===n.playerId&&hi(e,o)),o.homeworld===r&&(o.homeworld=null);const s=e.playerMap.get(r);s.isAlive=!1,t.emit("PLAYER_ELIMINATED",{loserId:r,winnerId:i})}function Ru(e,t,n,r){t.movement=[t.movement[0],t.movement[1]+r],n.movement=[n.movement[0]+r,n.movement[1]];for(const i of e.laneMap.values())i.fromId===t.id&&i.toId===n.id?i.movement=[i.movement[0]+r,i.movement[1]]:i.fromId===n.id&&i.toId===t.id&&(i.movement=[i.movement[0],i.movement[1]+r])}function Qg({S:e,C:t},n,r,i){n.ships<i||(n.ships-=i,r.ships+=i,Ru(e.world,n,r,i),r.ownerId===t.playerId&&hi(e,r))}function Du(e){for(const t of e.S.world.systemMap.values())for(t.lastMove=null;t.moveQueue.length>0;){const n=t.moveQueue.shift();n&&zu(e,n)}}function zu(e,t){t.playerId===e.C.playerId&&en(`player move: ${JSON.stringify(t)}`);const n=e.S.world.systemMap.get(t.fromId),r=e.S.world.systemMap.get(t.toId);Ou(e,n,r,t.ships),n.lastMove=t,e.E.emit("MAKE_MOVE",t)}function Zg(e,t){const n=Uu(e.S,t);n&&zu(e,n)}function Jg(e,t){const n=e.world.systemMap.get(t.fromId);return!(n.ownerId!==t.playerId||!ci(e.world,t.fromId,t.toId)||n.ships<=1)}function Uu(e,t){if(!Jg(e,t))return null;switch(t.type){case"MASS_MOVE":return n(t.fromId,t.toId);case"BALANCED_MOVE":return r(t.fromId,t.toId)}return null;function n(i,s){const{C:o}=globalThis.gameManager.getContext(),l=e.world.systemMap.get(i).ships-1;return l<=0?null:{message:`Move ${l} ships from ${i} to ${s}`,ships:l,toId:s,fromId:i,playerId:o.playerId}}function r(i,s){const{C:o}=globalThis.gameManager.getContext(),a=e.world.systemMap.get(i),l=e.world.systemMap.get(s),c=l.ownerId===a.ownerId?Math.floor((a.ships-l.ships)/2):Math.floor(a.ships/2);return c<=0?null:{message:`Move ${c} ships from ${a.id} to ${l.id}`,ships:c,toId:l.id,fromId:a.id,playerId:o.playerId}}}function Bu(e){for(const t of e.playerMap.values()){const n={playerId:t.id,systems:0,ships:0,homeworld:0};for(const r of e.world.systemMap.values())r.ownerId===t.id&&(n.systems+=1,n.ships+=r.ships??0,r.homeworld===t.id&&(n.homeworld=r.ships??0));t.stats=n}}function Fu(e){for(const t of e.world.systemMap.values())t.type==="INHABITED"&&(t.ownerId||t.ships<wl)&&(t.ships=(t.ships??0)+Ph)}function Hu(e){for(const t of e.world.systemMap.values())t.ownerId!=null&&(t.ships=(t.ships??0)+Nh)}function tm({S:e,C:t,E:n,P:r}){if(t.status==="PLAYING"&&r)if(e.playerMap.size>1){const i=Array.from(e.playerMap.values());if(i.reduce((o,a)=>(o+=a.stats.homeworld>0?1:0,o),0)===1){const o=i.find(l=>l.stats.homeworld>0).id,a=e.playerMap.get(o);n.emit("PLAYER_WIN",{playerId:o,message:`${a.name} has conquered The Bubble!`}),n.emit("GAME_STOP",void 0)}}else Array.from(e.world.systemMap.values()).filter(s=>s.ownerId!==t.playerId).length===0&&(n.emit("PLAYER_WIN",{playerId:t.playerId,message:`${r.name} has conquered The Bubble!`}),n.emit("GAME_STOP",void 0))}function em(e,t=!1){const{S:n,C:r}=e;r.tick%Ih===0&&Fu(n),r.tick%Th===0&&Hu(n);for(const i of n.world.systemMap.values())i.movement=[0,0];for(const i of n.world.laneMap.values())i.movement=[0,0];t||(jg(e),Du(e)),Bu(n)}const nm=Dn({length:5});function qu({S:e,C:t}){e.world=li();const n=ye/(t.config.numSystems-1),r=-ye/2,i=ye/2;en("Generating map...");const s=Math.min(.08,Math.sqrt(Math.PI/t.config.numSystems));for(let h=r;h<i;h+=n){const u=Math.asin(h/(ye/2))*(180/Math.PI),_=[Math.random()*360-180,u],b=im(_),A=Tu(e.world,b.location);if(A){if(Br(_,A.location)<s){h-=n;continue}_s(e.world,b,A)}Iu(e.world,b)}const o=Array.from(e.world.systemMap.values()),a=[o[o.length-1]];for(let h=o.length-2;h>=0;h--){const u=o[h],f=to(u.location,a);f&&_s(e.world,u,f),a.push(u)}ui(e.world),en(`Generated ${e.world.systemMap.size} systems and ${e.world.laneMap.size} lanes.`);const l=[...o],c=Math.max(Lh*t.config.numSystems,zi+t.config.numBots);for(let h=0;h<c&&l.length!==0;h++){const u=Math.floor(Math.random()*l.length);if(u===0){h--;continue}const f=l[u];f.ownerId=null,f.type="INHABITED",f.ships=wl+Math.floor(Math.random()*10),f.homeworld=null,l.splice(u,1)}}function rm(e,t){const n=Array.from(e.world.systemMap.values()).filter(s=>!s.ownerId&&s.type==="INHABITED");if(n.length===0)throw"No available homeworlds to join.";const r=Math.floor(Math.random()*n.length),i=n[r];return i.ships=1,i.ownerId=i.homeworld=t,i.type="INHABITED",i}function im(e){return{id:"s"+nm(),type:"UNINHABITED",location:e,ownerId:null,ships:0,homeworld:null,moveQueue:[],lastMove:null,movement:[0,0]}}function sm(e){const t=eo();return qu({...e,S:t}),t}const om=Object.freeze(Object.defineProperty({__proto__:null,addLane:_s,addPlayer:Nu,addSystem:Iu,assignSystem:rm,buildNeighborMap:ui,checkVictory:tm,createWorld:li,defaultConfig:Pu,doQueuedMoves:Du,eliminatePlayer:Lu,findClosestSystem:Tu,findClosestSystemInList:to,gameTick:em,generateMap:qu,getAdjacentSystems:At,getPlayersHomeworld:no,hasLane:ci,initalState:eo,moveShips:Ou,orderToMove:Uu,queueMove:Cu,revealAllSystems:ku,roundUpdate:Hu,setup:sm,takeOrder:Zg,turnUpdate:Fu,updateStats:Bu,visitSystem:hi,worldFromJson:qg,worldToJson:Gg},Symbol.toStringTag,{value:"Module"})),ro=Math.PI,Ca=ro/2,Oa=180/ro,La=ro/180,am=Math.atan2,Ra=Math.cos,lm=Math.max,um=Math.min,Da=Math.sin,cm=Math.sign||function(e){return e>0?1:e<0?-1:0},Gu=Math.sqrt;function hm(e){return e>1?Ca:e<-1?-Ca:Math.asin(e)}function ju(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function It(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Yr(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]}function Vr(e){var t=Gu(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]}function io(e){return[am(e[1],e[0])*Oa,hm(lm(-1,um(1,e[2])))*Oa]}function Jt(e){const t=e[0]*La,n=e[1]*La,r=Ra(n);return[r*Ra(t),r*Da(t),Da(n)]}function so(e){return e=e.map(t=>Jt(t)),ju(e[0],It(e[2],e[1]))}function fm(e){const t=pm(e),n=mm(t),r=gm(n,e),i=_m(n,e.length),s=dm(i,e),o=ym(n,e),{polygons:a,centers:l}=wm(o,n,e),c=vm(a),h=bm(n,e),u=xm(r,n);return{delaunay:t,edges:r,triangles:n,centers:l,neighbors:i,polygons:a,mesh:c,hull:h,urquhart:u,find:s}}function dm(e,t){function n(r,i){let s=r[0]-i[0],o=r[1]-i[1],a=r[2]-i[2];return s*s+o*o+a*a}return function(i,s,o){o===void 0&&(o=0);let a,l,c=o;const h=Jt([i,s]);do a=o,o=null,l=n(h,Jt(t[a])),e[a].forEach(u=>{let f=n(h,Jt(t[u]));if(f<l){l=f,o=u,c=u;return}});while(o!==null);return c}}function pm(e){if(e.length<2)return{};let t=0;for(;isNaN(e[t][0]+e[t][1])&&t++<e.length;);const n=Ur(e[t]),r=Mu().translate([0,0]).scale(1).rotate(n.invert([180,0]));e=e.map(r);const i=[];let s=1;for(let u=0,f=e.length;u<f;u++){let _=e[u][0]**2+e[u][1]**2;!isFinite(_)||_>1e32?i.push(u):_>s&&(s=_)}const o=1e6*Gu(s);i.forEach(u=>e[u]=[o,0]),e.push([0,o]),e.push([-o,0]),e.push([0,-o]);const a=js.from(e);a.projection=r;const{triangles:l,halfedges:c,inedges:h}=a;for(let u=0,f=c.length;u<f;u++)if(c[u]<0){const _=u%3==2?u-2:u+1,b=u%3==0?u+2:u-1,A=c[_],N=c[b];c[A]=N,c[N]=A,c[_]=c[b]=-1,l[u]=l[_]=l[b]=t,h[l[A]]=A%3==0?A+2:A-1,h[l[N]]=N%3==0?N+2:N-1,u+=2-u%3}else l[u]>e.length-3-1&&(l[u]=t);return a}function gm(e,t){const n=new Set;return t.length===2?[[0,1]]:(e.forEach(r=>{if(r[0]!==r[1]&&!(so(r.map(i=>t[i]))<0))for(let i=0,s;i<3;i++)s=(i+1)%3,n.add(bl([r[i],r[s]]).join("-"))}),Array.from(n,r=>r.split("-").map(Number)))}function mm(e){const{triangles:t}=e;if(!t)return[];const n=[];for(let r=0,i=t.length/3;r<i;r++){const s=t[3*r],o=t[3*r+1],a=t[3*r+2];s!==o&&o!==a&&n.push([s,a,o])}return n}function ym(e,t){return e.map(n=>{const r=n.map(s=>t[s]).map(Jt),i=Yr(Yr(It(r[1],r[0]),It(r[2],r[1])),It(r[0],r[2]));return io(Vr(i))})}function _m(e,t){const n=[];return e.forEach(r=>{for(let i=0;i<3;i++){const s=r[i],o=r[(i+1)%3];n[s]=n[s]||[],n[s].push(o)}}),e.length===0&&(t===2?(n[0]=[1],n[1]=[0]):t===1&&(n[0]=[])),n}function wm(e,t,n){const r=[],i=e.slice();if(t.length===0){if(n.length<2)return{polygons:r,centers:i};if(n.length===2){const a=Jt(n[0]),l=Jt(n[1]),c=Vr(Yr(a,l)),h=Vr(It(a,l)),u=It(c,h),f=[c,It(c,u),It(It(c,u),u),It(It(It(c,u),u),u)].map(io).map(o);return r.push(f),r.push(f.slice().reverse()),{polygons:r,centers:i}}}t.forEach((a,l)=>{for(let c=0;c<3;c++){const h=a[c],u=a[(c+1)%3],f=a[(c+2)%3];r[h]=r[h]||[],r[h].push([u,f,l,[h,u,f]])}});const s=r.map(a=>{const l=[a[0][2]];let c=a[0][1];for(let h=1;h<a.length;h++)for(let u=0;u<a.length;u++)if(a[u][0]==c){c=a[u][1],l.push(a[u][2]);break}if(l.length>2)return l;if(l.length==2){const h=za(n[a[0][3][0]],n[a[0][3][1]],i[l[0]]),u=za(n[a[0][3][2]],n[a[0][3][0]],i[l[0]]),f=o(h),_=o(u);return[l[0],_,l[1],f]}});function o(a){let l=-1;return i.slice(t.length,1/0).forEach((c,h)=>{c[0]===a[0]&&c[1]===a[1]&&(l=h+t.length)}),l<0&&(l=i.length,i.push(a)),l}return{polygons:s,centers:i}}function za(e,t,n){e=Jt(e),t=Jt(t),n=Jt(n);const r=cm(ju(It(t,e),n));return io(Vr(Yr(e,t)).map(i=>r*i))}function vm(e){const t=[];return e.forEach(n=>{if(!n)return;let r=n[n.length-1];for(let i of n)i>r&&t.push([r,i]),r=i}),t}function xm(e,t){return function(n){const r=new Map,i=new Map;return e.forEach((s,o)=>{const a=s.join("-");r.set(a,n[o]),i.set(a,!0)}),t.forEach(s=>{let o=0,a=-1;for(let l=0;l<3;l++){let c=bl([s[l],s[(l+1)%3]]).join("-");r.get(c)>o&&(o=r.get(c),a=c)}i.set(a,!1)}),e.map(s=>i.get(s.join("-")))}}function bm(e,t){const n=new Set,r=[];e.map(a=>{if(!(so(a.map(l=>t[l>t.length?0:l]))>1e-12))for(let l=0;l<3;l++){let c=[a[l],a[(l+1)%3]],h=`${c[0]}-${c[1]}`;n.has(h)?n.delete(h):n.add(`${c[1]}-${c[0]}`)}});const i=new Map;let s;if(n.forEach(a=>{a=a.split("-").map(Number),i.set(a[0],a[1]),s=a[0]}),s===void 0)return r;let o=s;do{r.push(o);let a=i.get(o);i.set(o,-1),o=a}while(o>-1&&o!==s);return r}function Sm(e){const t=function(n){if(t.delaunay=null,t._data=n,typeof t._data=="object"&&t._data.type==="FeatureCollection"&&(t._data=t._data.features),typeof t._data=="object"){const r=t._data.map(i=>[t._vx(i),t._vy(i),i]).filter(i=>isFinite(i[0]+i[1]));t.points=r.map(i=>[i[0],i[1]]),t.valid=r.map(i=>i[2]),t.delaunay=fm(t.points)}return t};return t._vx=function(n){if(typeof n=="object"&&"type"in n)return pa(n)[0];if(0 in n)return n[0]},t._vy=function(n){if(typeof n=="object"&&"type"in n)return pa(n)[1];if(1 in n)return n[1]},t.x=function(n){return n?(t._vx=n,t):t._vx},t.y=function(n){return n?(t._vy=n,t):t._vy},t.polygons=function(n){if(n!==void 0&&t(n),!t.delaunay)return!1;const r={type:"FeatureCollection",features:[]};return t.valid.length===0||(t.delaunay.polygons.forEach((i,s)=>r.features.push({type:"Feature",geometry:i?{type:"Polygon",coordinates:[[...i,i[0]].map(o=>t.delaunay.centers[o])]}:null,properties:{site:t.valid[s],sitecoordinates:t.points[s],neighbours:t.delaunay.neighbors[s]}})),t.valid.length===1&&r.features.push({type:"Feature",geometry:{type:"Sphere"},properties:{site:t.valid[0],sitecoordinates:t.points[0],neighbours:[]}})),r},t.triangles=function(n){return n!==void 0&&t(n),t.delaunay?{type:"FeatureCollection",features:t.delaunay.triangles.map((r,i)=>(r=r.map(s=>t.points[s]),r.center=t.delaunay.centers[i],r)).filter(r=>so(r)>0).map(r=>({type:"Feature",properties:{circumcenter:r.center},geometry:{type:"Polygon",coordinates:[[...r,r[0]]]}}))}:!1},t.links=function(n){if(n!==void 0&&t(n),!t.delaunay)return!1;const r=t.delaunay.edges.map(s=>Br(t.points[s[0]],t.points[s[1]])),i=t.delaunay.urquhart(r);return{type:"FeatureCollection",features:t.delaunay.edges.map((s,o)=>({type:"Feature",properties:{source:t.valid[s[0]],target:t.valid[s[1]],length:r[o],urquhart:!!i[o]},geometry:{type:"LineString",coordinates:[t.points[s[0]],t.points[s[1]]]}}))}},t.mesh=function(n){return n!==void 0&&t(n),t.delaunay?{type:"MultiLineString",coordinates:t.delaunay.edges.map(r=>[t.points[r[0]],t.points[r[1]]])}:!1},t.cellMesh=function(n){if(n!==void 0&&t(n),!t.delaunay)return!1;const{centers:r,polygons:i}=t.delaunay,s=[];for(const o of i)if(o)for(let a=o.length,l=o[a-1],c=o[0],h=0;h<a;l=c,c=o[++h])c>l&&s.push([r[l],r[c]]);return{type:"MultiLineString",coordinates:s}},t._found=void 0,t.find=function(n,r,i){if(t._found=t.delaunay.find(n,r,t._found),!i||Br([n,r],t.points[t._found])<i)return t._found},t.hull=function(n){n!==void 0&&t(n);const r=t.delaunay.hull,i=t.points;return r.length===0?null:{type:"Polygon",coordinates:[[...r.map(s=>i[s]),i[r[0]]]]}},e?t(e):t}const Wu=Math.acos,Em=Math.asin,Ua=Math.atan2,Pe=Math.cos,Ba=Math.hypot,ws=Math.max,vs=Math.min,Yu=Math.PI,Ne=Math.sin,Sn=Yu/180,Ci=180/Yu;class Ut{static fromCartesian([t,n,r]){return[0,r,-n,t]}static fromAngles([t,n,r]){t*=Sn/2,n*=Sn/2,r=(r||0)*Sn/2;const i=Ne(t),s=Pe(t),o=Ne(n),a=Pe(n),l=Ne(r),c=Pe(r);return[s*a*c+i*o*l,i*a*c-s*o*l,s*o*c+i*a*l,s*a*l-i*o*c]}static toAngles([t,n,r,i]){return[Ua(2*(t*n+r*i),1-2*(n*n+r*r))*Ci,Em(ws(-1,vs(1,2*(t*r-i*n))))*Ci,Ua(2*(t*i+n*r),1-2*(r*r+i*i))*Ci]}static interpolateAngles(t,n){const r=Ut.interpolate(Ut.fromAngles(t),Ut.fromAngles(n));return i=>Ut.toAngles(r(i))}static interpolateLinear([t,n,r,i],[s,o,a,l]){s-=t,o-=n,a-=r,l-=i;const c=new Array(4);return h=>{const u=Ba(c[0]=t+s*h,c[1]=n+o*h,c[2]=r+a*h,c[3]=i+l*h);return c[0]/=u,c[1]/=u,c[2]/=u,c[3]/=u,c}}static interpolate([t,n,r,i],[s,o,a,l]){let c=Ut.dot([t,n,r,i],[s,o,a,l]);if(c<0&&(s=-s,o=-o,a=-a,l=-l,c=-c),c>.9995)return Ut.interpolateLinear([t,n,r,i],[s,o,a,l]);const h=Wu(ws(-1,vs(1,c))),u=new Array(4),f=Ba(s-=t*c,o-=n*c,a-=r*c,l-=i*c);return s/=f,o/=f,a/=f,l/=f,_=>{const b=h*_,A=Ne(b),N=Pe(b);return u[0]=t*N+s*A,u[1]=n*N+o*A,u[2]=r*N+a*A,u[3]=i*N+l*A,u}}static dot([t,n,r,i],[s,o,a,l]){return t*s+n*o+r*a+i*l}static multiply([t,n,r,i],[s,o,a,l]){return[t*s-n*o-r*a-i*l,t*o+n*s+r*l-i*a,t*a-n*l+r*s+i*o,t*l+n*a-r*o+i*s]}}const Rt=Ut.fromAngles;Rt.multiply=Ut.multiply;Rt.rotation=Ut.toAngles;Rt.interpolate=Ut.interpolateAngles;Rt.cartesian=function(e){const t=e[0]*Sn,n=e[1]*Sn,r=Pe(n);return[r*Pe(t),r*Ne(t),Ne(n)]};Rt.delta=function(e,t,n){arguments.length==2&&(n=1);const r=Math.sqrt;function i(h,u){return[h[1]*u[2]-h[2]*u[1],h[2]*u[0]-h[0]*u[2],h[0]*u[1]-h[1]*u[0]]}function s(h,u){return h[0]*u[0]+h[1]*u[1]+h[2]*u[2]}const o=i(e,t),a=r(s(o,o));if(!a)return[1,0,0,0];const l=n*Wu(ws(-1,vs(1,s(e,t))))/2,c=Ne(l);return[Pe(l),o[2]/a*c,-o[1]/a*c,o[0]/a*c]};const ut={all:new Set,last:null};function ke(){ut.all.clear(),ut.last=null}function On(e){ut.all.add(e),ut.last=e}function Mm(e){ut.all.clear(),ut.all.add(e),ut.last=e}function $m(e){ut.all.delete(e),ut.last===e&&(ut.last=null)}function Vu(e){return ut.all.has(e)}function Am(e){Vu(e)?$m(e):On(e)}function Im({S:e,C:t},n){if(ut.last==null)return;const r=[[ut.last]],i=new Set;for(i.add(ut.last);r.length>0;){const s=r.shift(),o=s[s.length-1];if(o===n){s.forEach(a=>ut.all.add(a)),ut.last=n;return}for(const a of At(e.world,o))!i.has(a.id)&&a.ownerId===t.playerId&&(i.add(a.id),r.push([...s,a.id]))}}const Fa=.5,Tm=.25,Pm=100,Nm=20,km=Ys(".3~s"),nn={Orthographic:Og,Stereographic:Mu,Mercator:Cg,TransverseMercator:Lg};let xs,Bt,rn=nn[$h],it=rn().translate([0,0]),fe=it.scale(),fi=Xs().projection(it),yr;const Cm=Sm().x(e=>e.location[0]).y(e=>e.location[1]);function Om(){const e=Object.keys(nn),n=(e.findIndex(r=>nn[r]===rn)+1)%e.length;Lm(e[n])}function Lm(e){rn=nn[e],it=rn(),it.translate([0,0]).rotate([0,0,0]).scale(fe),fe=it.scale(),fi=Xs().projection(it)}function Fe(e){const t=it.rotate();t[0]+=e[0],t[1]+=e[1],e.length===3&&(t[2]+=e[2]),it.rotate(t)}function Rm(e,t){xs=dt(e),Bt=xs.select("svg"),Bt.attr("width","100vw").attr("height","100vh").attr("viewBox",`-${vr/2} -${ye/2} ${vr} ${ye}`).on("contextmenu",o=>o.preventDefault()),bs(t.S),Ku(t),Qu(t),Xu(t),Bt.call(n()),Bt.call(r()),window.addEventListener("resize",s);function n(){return i().on("drag.render",()=>tt()).on("end.render",()=>tt())}function r(){return Hg().filter(o=>o.type==="wheel").on("zoom",o=>{if(o.transform.k>Fa){const a=fe*o.transform.k;it.scale(a),tt()}else o.transform.k=Fa})}function i(){let o,a,l,c,h;function u(A,N){const I=S0(A,N);if(I.length!==h&&(h=I.length,h>1&&(c=Math.atan2(I[1][1]-I[0][1],I[1][0]-I[0][0])),f.apply(N,[A,N])),h>1){const $=Oo(I,O=>O[0]),C=Oo(I,O=>O[1]),k=Math.atan2(I[1][1]-I[0][1],I[1][0]-I[0][0]);return[$,C,k]}return I[0]}function f({x:A,y:N}){const I=b([A,N]);o=Rt.cartesian(it.invert(I)),l=it.rotate(),a=Rt(l)}function _(A){const N=b([A.x,A.y]),I=Rt.cartesian(it.rotate(l).invert(N)),$=Rt.delta(o,I);let C=Rt.multiply(a,$);const k=u(A,this);if(k[2]){const O=(k[2]-c)/2,L=-Math.sin(O),z=Math.sign(Math.cos(O));C=Rt.multiply([Math.sqrt(1-L*L),0,0,z*L],C)}it.rotate(Rt.rotation(C)),$[0]<.7&&f.apply(this,[A,this])}function b(A){const N=parseInt(Bt.style("width")),I=parseInt(Bt.style("height"));return[A[0]-N/2,A[1]-I/2]}return T0().filter(A=>A.button===1||A.touches).on("start",f).on("drag",_)}function s(){const{S:o}=globalThis.gameManager.getContext();bs(o)}}function bs(e){const t=Bt.node()?.getBoundingClientRect(),n=window.devicePixelRatio||1,r=t?.height||ye,i=t?.width||vr,a=xs.selectAll("canvas").data([null]).join(h=>h.append("canvas").style("position","absolute").style("top",0).style("left",0).style("z-index",-1).style("pointer-events","none")).attr("width",i*n).attr("height",r*n).style("width",`${i}px`).style("height",`${r}px`).node().getContext("2d");a.setTransform(1,0,0,1,0,0),a.scale(n,n),a.translate(i/2,r/2);const l=Math.min(i/vr,r/ye);a.scale(l,l);const c="#FFFFFF48";if(rn===nn.Orthographic){const h=it.scale();a.strokeStyle=c,a.lineWidth=1,a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=10,a.shadowColor=c,a.beginPath(),a.arc(0,0,h,0,Math.PI*2),a.stroke(),a.fill()}{a.shadowBlur=0,a.strokeStyle="rgba(51, 51, 51, 0.5)";const h=Dm(e),u=Xs().projection(it).context(a);a.beginPath(),u(h),a.stroke()}}function Dm(e){const t=hg(),n=no(e);if(n){if(!yr){const r=Ur([0,90+n.location[1],0]),i=Ur([n.location[0],0,0]);yr={type:"FeatureCollection",features:t.lines().map(s=>({type:"Feature",geometry:{type:"LineString",coordinates:s.coordinates.map(o=>i(r(o)))}}))}}return yr}return t()}function Ha(e){const t=it.scale()*e;t<fe*Tm||t>fe*Pm||(it.scale(t),tt())}function Ss(){const e=globalThis.gameManager.getContext(),t=no(e.S);if(!t)return;yr=null;const n=t.location;rn===nn.Orthographic?Es([n[0],n[1]-45]):Es(n),it.scale(fe)}function zm(e){const n=globalThis.gameManager.getContext().S.world.systemMap.get(e);n&&(Es(n.location),it.scale(fe))}function Es(e){it.rotate([-e[0],-e[1],0]),tt()}let qa=null;function tt(){return cancelAnimationFrame(qa),qa=requestAnimationFrame(()=>e());function e(t){Bt&&(t??=globalThis.gameManager.getContext(),Ku(t),bs(t.S),Xu(t),Qu(t))}}function Xu({S:e,C:t,P:n}){const i=it.scale()/fe<1;let s=e.world.systemMap.values();n&&t.config.fow&&(s=n.revealedSystems.values().map(l=>e.world.systemMap.get(l))),s=s.filter(l=>!!fi({type:"Point",coordinates:l.location}));const a=Bt.selectAll("g#systems").data([null]).join(l=>l.append("g").attr("id","systems")).classed("reduced-size",i).classed("hidden",!1).selectAll(".system").data(s,l=>l.id).join(l=>{const c=l.append("g").attr("class","system").attr("id",h=>h.id).on("click",(h,u)=>{Xr(h,u),tt()}).on("contextmenu",(h,u)=>{h.preventDefault(),Xr(h,u),tt()});return c.append("circle").attr("class","system-outline").attr("cx",0).attr("cy",0).attr("r",Nm/2),c.append("text").attr("class","ship-count").attr("y",-10).attr("x",0).attr("text-anchor","start"),c.append("text").attr("class","system-icon").attr("y",0).attr("x",0).attr("text-anchor","end"),c});a.style("--owner-color",l=>e.playerMap.get(l.ownerId)?.color??null).classed("own",l=>l.ownerId===t.playerId).classed("selected",l=>Vu(l.id)).classed("moved",l=>l.movement[0]>0||l.movement[1]>0).classed("inhabited",l=>l.type==="INHABITED").classed("homeworld",l=>!!l.homeworld&&l.ownerId===l.homeworld).classed("visited",l=>n?n.visitedSystems.has(l.id):!0).attr("transform",l=>`translate(${it(l.location)})`),a.select(".system-icon").text(l=>l.homeworld&&l.ownerId===l.homeworld?"✶":l.type==="INHABITED"?"✦":"●"),a.select(".ship-count").text(l=>i?"":(l.type==="INHABITED"?"▴":"")+(l.ships?km(l.ships):""))}const Um=(()=>{let e=[],t;return n=>{if(!e||t!==n.world.systemMap){t=n.world.systemMap;const r=Array.from(t.values());e=Cm.polygons(r).features}return e}})();function Ku({S:e,C:t,P:n}){const i=it.scale()/fe<1;let s=Um(e);n&&t.config.fow&&(s=s.filter(l=>{const c=l.properties?.site;return n.revealedSystems.has(c.id)})),Bt.selectAll("g#mesh").data([null]).join(l=>l.append("g").attr("id","mesh")).classed("reduced-size",i).classed("hidden",!1).selectAll("path").data(s).join(l=>l.append("path").classed("region",!0).on("click",(c,h)=>{Xr(c,h),tt()}).on("contextmenu",(c,h)=>{c.preventDefault(),Xr(c,h),tt()})).attr("d",l=>fi(l)).datum(l=>l.properties.site).classed("visited",l=>n?n.visitedSystems.has(l.id):!0).style("--owner-color",l=>e.playerMap.get(l.ownerId)?.color??null)}function Qu({S:e,C:t,P:n}){let r=e.world.laneMap.values();n&&t.config.fow&&(r=r.filter(o=>n.revealedSystems.has(o.fromId)&&n.revealedSystems.has(o.toId)));const s=Bt.selectAll("g#lanes").data([null]).join(o=>o.append("g").attr("id","lanes")).selectAll("g.lane-group").data(r,o=>o.id).join(o=>{const a=o.append("g").attr("class","lane-group").attr("id",l=>l.id).on("click",(l,c)=>{Ga(l,c),tt()}).on("contextmenu",(l,c)=>{l.preventDefault(),Ga(l,c),tt()});return a.append("path").attr("class","lane"),a.append("path").attr("class","pulse"),a}).datum(o=>{const a=e.world.systemMap.get(o.toId),l=e.world.systemMap.get(o.fromId),c=fi({type:"LineString",coordinates:[l.location,a.location]});return{...o,from:e.world.systemMap.get(o.fromId),to:e.world.systemMap.get(o.toId),path:c}});s.style("--owner-color",o=>{const a=o.from;if(!a.ownerId)return null;const l=o.to;return!l.ownerId||a.ownerId!==l.ownerId?null:e.playerMap.get(a.ownerId)?.color??null}),s.select("path.lane").attr("d",o=>o.path).classed("own",o=>{const a=o.from,l=o.to;return a.ownerId===t.playerId||l.ownerId===t.playerId}).style("--path-length",o=>{const a=dt(`#${o.id} .lane`).node();return a?a.getTotalLength():200}),s.select("path.pulse").attr("d",o=>o.path).classed("moved",o=>o.movement[0]>0||o.movement[1]>0).style("stroke-width",o=>{if(o.movement[0]===0&&o.movement[1]===0)return null;const a=2,l=Math.floor(Math.log2(Math.max(o.movement[0],o.movement[1])));return`${(a+l)*2}px`}).classed("moved--fwd",o=>o.movement[0]>o.movement[1]).classed("moved--bak",o=>o.movement[1]>o.movement[0])}function Bm(){document.getElementById("optionsButton")?.addEventListener("click",Zu),document.getElementById("helpButton").addEventListener("click",Ju)}async function Zu(){if(await Fm()){const t=document.getElementById("optionsForm"),n=new FormData(t),r=globalThis.gameManager,i=+n.get("numBots"),s=n.get("playerName"),o=n.get("fow")==="on",a=+n.get("numSystems");r.setConfig({numBots:i,playerName:s,fow:o,numSystems:48*2**a})}}function Fm(){const e=document.getElementById("optionsDialog");return e.showModal(),new Promise(t=>{e.addEventListener("close",()=>t(!0)),e.addEventListener("cancel",()=>t(!1))})}function Ju(){document.getElementById("helpDialog").showModal()}function Ms(e){const t=document.getElementById("endDialog");return t.showModal(),t.querySelector("p#endMessage").textContent=e,new Promise(n=>{t.addEventListener("close",()=>n(!0)),t.addEventListener("cancel",()=>n(!1))})}function Hm(){const e=document.getElementById("startDialog");return e.showModal(),new Promise(t=>{e.addEventListener("close",()=>t(!0)),e.addEventListener("cancel",()=>t(!1))})}const He=5;function qm(){dt("body").on("keypress.controls",null),dt("body").on("keyup.controls",null),dt("body").on("keyup.cheats",null),xl&&dt("body").on("keyup.cheats",e=>{if(!e.altKey)return;e.preventDefault();const{S:t,C:n}=globalThis.gameManager.getContext();switch(e.code){case"KeyC":for(const r of t.world.systemMap.values())r.ownerId===n.playerId&&(r.ships*=2);tt();return;case"KeyR":ku(t),tt();return;case"NumpadAdd":case"Equal":{const r=Math.min(16,n.config.timeScale*2);globalThis.gameManager.setConfig({timeScale:r}),en(`Time scale increased to ${n.config.timeScale}x`);return}case"NumpadSubtract":case"Minus":{const r=Math.max(.25,n.config.timeScale/2);globalThis.gameManager.setConfig({timeScale:r}),en(`Time scale decreased to ${n.config.timeScale}x`);return}}}),dt("body").on("keyup.controls",async e=>{switch(e.key){case"Escape":ke(),tt();return;case"?":Ju();return;case"x":{if(!e.ctrlKey)return;if(await Ms("Are you sure you want to quit?")){const{C:n,E:r}=globalThis.gameManager.getContext();r.emit("PLAYER_QUIT",{playerId:n.playerId})}return}}}),dt("body").on("keypress.controls",e=>{switch(e.code){case"Space":"pauseToggle"in globalThis.gameManager&&globalThis.gameManager.pauseToggle();return;case"Equal":case"NumpadAdd":Ha(1.2),tt();return;case"Minus":case"NumpadSubtract":Ha(.8),tt();return;case"KeyW":Fe([0,He]),tt();return;case"KeyA":Fe([-He,0]),tt();return;case"KeyS":Fe([0,-He]),tt();return;case"KeyD":Fe([He,0]),tt();return;case"KeyQ":Fe([0,0,He]),tt();break;case"KeyE":Fe([0,0,-He]),tt();break;case"KeyH":Ss(),tt();return;case"KeyC":ut.last&&(zm(ut.last),tt());return;case"KeyP":Om(),Ss(),tt();return}})}function Ga(e,t){const{S:n,C:r}=globalThis.gameManager.getContext();if(r.status==="PLAYING")switch(e.button){case 0:break;case 2:{let i=n.world.systemMap.get(t.fromId),s=n.world.systemMap.get(t.toId);if(i.ownerId!==r.playerId&&s.ownerId!==r.playerId)return;if(i.ownerId!==r.playerId){const o=i;i=s,s=o}else if(i.ownerId===i.ownerId&&s.ships>i.ships){const o=i;i=s,s=o}if(Gm(i.id,s.id),s.ownerId!==r.playerId)return;e.altKey||(!e.ctrlKey&&!e.shiftKey&&ke(),On(i.id),s.ownerId===r.playerId&&On(s.id));break}}}function Xr(e,t){const n=globalThis.gameManager.getContext();if(n.C.status==="PLAYING")switch(xl&&e.altKey&&(en(""+t.id,t.lastMove?.message??"none",t.lastMove?.ships??0),console.log(t)),e.button){case 0:if(t.ownerId!==n.C.playerId)return;e.ctrlKey||e.metaKey?Am(t.id):e.shiftKey?Im(n,t.id):Mm(t.id);break;case-1:case 2:{const r=Array.from(ut.all);if(r.length===0)return;r.forEach(i=>{jm(i,t.id),t.ownerId===n.C.playerId&&(e.altKey||(!e.ctrlKey&&!e.shiftKey&&ke(),On(t.id)))});break}}}function Gm(e,t){const{S:n,E:r,C:i}=globalThis.gameManager.getContext();if(!ci(n.world,e,t))return;const s={type:"BALANCED_MOVE",message:`Balanced move from ${e} to ${t}`,toId:t,fromId:e,playerId:i.playerId};r.emit("TAKE_ORDER",s)}function jm(e,t){const{S:n,E:r,C:i}=globalThis.gameManager.getContext();if(!ci(n.world,e,t))return;const s={type:"MASS_MOVE",toId:t,fromId:e,playerId:i.playerId,message:`Mass move from ${e} to ${t}`};r.emit("TAKE_ORDER",s)}let tc=0;const Kr=[];function Wm(){tc=0,Kr.length=0;const{E:e}=globalThis.gameManager.getContext();e.emit("MESSAGES_UPDATED",{messages:Kr})}function ar(e){const{C:t,E:n}=globalThis.gameManager.getContext();Kr.push({id:tc++,message:e,tick:t.tick}),n.emit("MESSAGES_UPDATED",{messages:Kr})}class Ym{constructor(){this.listeners={}}on(t,n){return this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(n),()=>{this.listeners[t]=this.listeners[t].filter(r=>r!==n)}}emit(t,n){const r=this.listeners[t];if(r)for(const i of r)try{i(n)}catch(s){console.error(`Error in listener for event ${String(t)}:`,s)}}clear(){this.listeners={}}}class Vm{constructor(){this.events=new Ym,this.game=om,this.state=eo(),this.config=Pu(),this.tick=0,this.status="WAITING",this.runningInterval=null,this.#e()}getState(){return xr?Object.freeze({...this.state}):this.state}getConfig(){return xr?Object.freeze({...this.config}):this.config}setConfig(t){this.config={...this.config,...t}}getContext(){return{S:this.state,E:this.events,P:this.state.playerMap.get(this.playerId),C:{tick:this.tick,status:this.status,playerId:this.playerId,config:this.getConfig()}}}addPlayer(t){if(this.state.playerMap.has(t.id))return this.state.playerMap.get(t.id);const n=t.score??{userId:t.id,playerName:t.name??`Player ${this.state.playerMap.size+1}`,score:0,tick:0,timestamp:Date.now()},r={name:t.name??`Player ${this.state.playerMap.size+1}`,score:n,color:"#000000",...t,stats:{playerId:t.id,systems:0,ships:0,homeworld:0},isAlive:!0,visitedSystems:new Set,revealedSystems:new Set};return Nu(this.state,r),r}gameStart(){this.status="PLAYING",this.tick=0,this.events.emit("GAME_START",void 0),this.#t()}gameStop(){this.status="FINISHED",this.stopGameLoop()}gameTick(){this.tick++,this.game.gameTick(this.getContext()),this.game.checkVictory(this.getContext()),this.events.emit("STATE_UPDATED",{state:this.state,status:this.status})}#t(){if(this.status!=="PLAYING"){this.gameStop();return}this.stopGameLoop(),this.gameTick(),this.events.emit("GAME_TICK",{tick:this.tick}),this.runningInterval=setTimeout(()=>this.#t(),Ah/this.config.timeScale)}startGameLoop(){this.#t()}stopGameLoop(){this.runningInterval&&(clearTimeout(this.runningInterval),this.runningInterval=null)}#e(){this.events.on("GAME_STOP",()=>{this.gameStop()}),this.events.on("TAKE_ORDER",t=>{this.game.takeOrder(this.getContext(),t),this.events.emit("STATE_UPDATED",{state:this.state,status:this.status})})}}const ja=Dn({length:5});class Xm extends Vm{constructor(){super(),this.#t()}async connect(){this.gameStop(),this.status="WAITING";const t=await this.initializePlayer();this.addPlayer(t),this.playerId=t.id,this.events.emit("GAME_INIT",void 0),await Hm(),this.gameSetup(t),this.gameStart(),tt()}gameSetup(t){const n=this.getContext();this.state=this.game.setup(n),Wm(),t.name=this.config.playerName;const r=this.onPlayerJoin(1,t);this.game.assignSystem(this.state,t.id);const i=zi+ +this.config.numBots;for(let s=2;s<=i;s++){const o=this.onPlayerJoin(s);this.game.assignSystem(this.state,o.id)}this.setupThisPlayer(r.id),localStorage.setItem("starz_playerId",r.id),localStorage.setItem("starz_playerName",r.name),localStorage.setItem("starz_score",r.score.score.toString())}async initializePlayer(){const t=this.playerId=localStorage.getItem("starz_playerId")??ja(),n=this.config.playerName,r=+(localStorage.getItem("starz_score")??0);return localStorage.setItem("starz_playerId",t),localStorage.setItem("starz_playerName",n),localStorage.setItem("starz_score",r.toString()),{id:t,name:n,score:{score:r}}}gameStart(){ki("starz_gamesStarted"),super.gameStart(),ar("Game started.");const t=this.state.playerMap.get(this.playerId);t&&ar(`You are ${t.name}.`)}gameStop(){super.gameStop(),ke(),tt()}onPlayerJoin(t,n={}){const r=Uh[t],i=n.name??`Bot ${t}`,s=ja(),o=t>zi?new Yg({playerIndex:t,id:s,name:i}):void 0;return this.addPlayer({id:s,name:i,bot:o,color:r,...n})}pauseToggle(){this.status==="PAUSED"?(this.status="PLAYING",super.startGameLoop()):this.status==="PLAYING"&&(this.status="PAUSED",super.stopGameLoop())}async onPlayerWin(t,n){n&&ar(n),this.game.revealAllSystems(this.state),ke();let r=!1;t===this.playerId?(ki("starz_gamesWon"),r=await Ms("You have conquered The Bubble!")):(ki("starz_gamesLost",{winnerId:t}),r=await Ms("You have lost your homeworld! Click to return to lobby.  ESC to spectate.")),r&&this.restart()}restart(){this.stopGameLoop(),ke(),this.tick=0,this.state=this.game.initalState(),this.connect()}onEliminatePlayer(t,n){const r=this.state.playerMap.get(t),i=this.state.playerMap.get(n),s=n===null?`${r.name} has been eliminated!`:`${i.name} has eliminated ${r.name}!`;ar(s),t===this.playerId?(this.submitWinLoss(-1),this.onPlayerWin(n)):n===this.playerId&&this.submitWinLoss(1)}async submitWinLoss(t){const n=+(localStorage.getItem("starz_score")??0)+t;localStorage.setItem("starz_score",n.toString())}addPlayer(t){const n=super.addPlayer({color:t.color??Km(),...t});return document.documentElement.style.setProperty(`--player-${n.id}`,n.color),n}setupThisPlayer(t){this.playerId=t;const n=this.state.playerMap.get(t),r=this.game.getPlayersHomeworld(this.state);this.game.visitSystem(this.state,r),Ss(),n.bot||(ke(),On(r.id))}#t(){Bm(),qm(),this.events.on("PLAYER_WIN",({playerId:t,message:n})=>{this.onPlayerWin(t,n)}),this.events.on("PLAYER_ELIMINATED",({loserId:t,winnerId:n})=>{this.onEliminatePlayer(t,n)}),this.events.on("PLAYER_QUIT",({playerId:t})=>{this.game.eliminatePlayer(this.getContext(),t)})}}function Km(){const e="0123456789ABCDEF";let t="#";for(let n=0;n<6;n++)t+=e[Math.floor(Math.random()*16)];return t}var $s;try{$s=new TextDecoder}catch{}var U,te,P=0,et={},K,_e,Lt=0,Xt=0,ft,le,Mt=[],V,Wa={useRecords:!1,mapsAsObjects:!0};class Qm{}const ec=new Qm;ec.name="MessagePack 0xC1";var we=!1,nc=2,Zm;try{new Function("")}catch{nc=1/0}class Qr{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(U)return ac(()=>(Is(),this?this.unpack(t,n):Qr.prototype.unpack.call(Wa,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof Buffer<"u"?Buffer.from(t):new Uint8Array(t)),typeof n=="object"?(te=n.end||t.length,P=n.start||0):(P=0,te=n>-1?n:t.length),Xt=0,_e=null,ft=null,U=t;try{V=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw U=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof Qr){if(et=this,this.structures)return K=this.structures,lr(n);(!K||K.length>0)&&(K=[])}else et=Wa,(!K||K.length>0)&&(K=[]);return lr(n)}unpackMultiple(t,n){let r,i=0;try{we=!0;let s=t.length,o=this?this.unpack(t,s):di.unpack(t,s);if(n){if(n(o,i,P)===!1)return;for(;P<s;)if(i=P,n(lr(),i,P)===!1)return}else{for(r=[o];P<s;)i=P,r.push(lr());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{we=!1,Is()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function lr(e){try{if(!et.trusted&&!we){let n=K.sharedLength||0;n<K.length&&(K.length=n)}let t;if(et.randomAccessStructure&&U[P]<64&&U[P]>=32&&Zm||(t=ot()),ft&&(P=ft.postBundlePosition,ft=null),we&&(K.restoreStructures=null),P==te)K&&K.restoreStructures&&Ya(),K=null,U=null,le&&(le=null);else{if(P>te)throw new Error("Unexpected end of MessagePack data");if(!we){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw K&&K.restoreStructures&&Ya(),Is(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||P>te)&&(t.incomplete=!0),t}}function Ya(){for(let e in K.restoreStructures)K[e]=K.restoreStructures[e];K.restoreStructures=null}function ot(){let e=U[P++];if(e<160)if(e<128){if(e<64)return e;{let t=K[e&63]||et.getStructures&&rc()[e&63];return t?(t.read||(t.read=oo(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,et.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=sc();r==="__proto__"&&(r="__proto_"),t[r]=ot()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(ot(),ot());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=ot();return et.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(Xt>=P)return _e.slice(P-Lt,(P+=t)-Lt);if(Xt==0&&te<140){let n=t<16?ao(t):ic(t);if(n!=null)return n}return As(t)}else{let t;switch(e){case 192:return null;case 193:return ft?(t=ot(),t>0?ft[1].slice(ft.position1,ft.position1+=t):ft[0].slice(ft.position0,ft.position0-=t)):ec;case 194:return!1;case 195:return!0;case 196:if(t=U[P++],t===void 0)throw new Error("Unexpected end of buffer");return Oi(t);case 197:return t=V.getUint16(P),P+=2,Oi(t);case 198:return t=V.getUint32(P),P+=4,Oi(t);case 199:return Me(U[P++]);case 200:return t=V.getUint16(P),P+=2,Me(t);case 201:return t=V.getUint32(P),P+=4,Me(t);case 202:if(t=V.getFloat32(P),et.useFloat32>2){let n=lc[(U[P]&127)<<1|U[P+1]>>7];return P+=4,(n*t+(t>0?.5:-.5)>>0)/n}return P+=4,t;case 203:return t=V.getFloat64(P),P+=8,t;case 204:return U[P++];case 205:return t=V.getUint16(P),P+=2,t;case 206:return t=V.getUint32(P),P+=4,t;case 207:return et.int64AsType==="number"?(t=V.getUint32(P)*4294967296,t+=V.getUint32(P+4)):et.int64AsType==="string"?t=V.getBigUint64(P).toString():et.int64AsType==="auto"?(t=V.getBigUint64(P),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=V.getBigUint64(P),P+=8,t;case 208:return V.getInt8(P++);case 209:return t=V.getInt16(P),P+=2,t;case 210:return t=V.getInt32(P),P+=4,t;case 211:return et.int64AsType==="number"?(t=V.getInt32(P)*4294967296,t+=V.getUint32(P+4)):et.int64AsType==="string"?t=V.getBigInt64(P).toString():et.int64AsType==="auto"?(t=V.getBigInt64(P),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=V.getBigInt64(P),P+=8,t;case 212:if(t=U[P++],t==114)return Ja(U[P++]&63);{let n=Mt[t];if(n)return n.read?(P++,n.read(ot())):n.noBuffer?(P++,n()):n(U.subarray(P,++P));throw new Error("Unknown extension "+t)}case 213:return t=U[P],t==114?(P++,Ja(U[P++]&63,U[P++])):Me(2);case 214:return Me(4);case 215:return Me(8);case 216:return Me(16);case 217:return t=U[P++],Xt>=P?_e.slice(P-Lt,(P+=t)-Lt):ty(t);case 218:return t=V.getUint16(P),P+=2,Xt>=P?_e.slice(P-Lt,(P+=t)-Lt):ey(t);case 219:return t=V.getUint32(P),P+=4,Xt>=P?_e.slice(P-Lt,(P+=t)-Lt):ny(t);case 220:return t=V.getUint16(P),P+=2,Xa(t);case 221:return t=V.getUint32(P),P+=4,Xa(t);case 222:return t=V.getUint16(P),P+=2,Ka(t);case 223:return t=V.getUint32(P),P+=4,Ka(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const Jm=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function oo(e,t){function n(){if(n.count++>nc){let i=e.read=new Function("r","return function(){return "+(et.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":Jm.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(ot);return e.highByte===0&&(e.read=Va(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=ot()}return et.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?Va(t,n):n}const Va=(e,t)=>function(){let n=U[P++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=K[r]||rc()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=oo(i,e)),i.read()};function rc(){let e=ac(()=>(U=null,et.getStructures()));return K=et._mergeStructures(e,K)}var As=Hn,ty=Hn,ey=Hn,ny=Hn;function Hn(e){let t;if(e<16&&(t=ao(e)))return t;if(e>64&&$s)return $s.decode(U.subarray(P,P+=e));const n=P+e,r=[];for(t="";P<n;){const i=U[P++];if((i&128)===0)r.push(i);else if((i&224)===192){const s=U[P++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=U[P++]&63,o=U[P++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=U[P++]&63,o=U[P++]&63,a=U[P++]&63;let l=(i&7)<<18|s<<12|o<<6|a;l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|l&1023),r.push(l)}else r.push(i);r.length>=4096&&(t+=ht.apply(String,r),r.length=0)}return r.length>0&&(t+=ht.apply(String,r)),t}function Xa(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=ot();return et.freezeData?Object.freeze(t):t}function Ka(e){if(et.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=sc();r==="__proto__"&&(r="__proto_"),t[r]=ot()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(ot(),ot());return t}}var ht=String.fromCharCode;function ic(e){let t=P,n=new Array(e);for(let r=0;r<e;r++){const i=U[P++];if((i&128)>0){P=t;return}n[r]=i}return ht.apply(String,n)}function ao(e){if(e<4)if(e<2){if(e===0)return"";{let t=U[P++];if((t&128)>1){P-=1;return}return ht(t)}}else{let t=U[P++],n=U[P++];if((t&128)>0||(n&128)>0){P-=2;return}if(e<3)return ht(t,n);let r=U[P++];if((r&128)>0){P-=3;return}return ht(t,n,r)}else{let t=U[P++],n=U[P++],r=U[P++],i=U[P++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){P-=4;return}if(e<6){if(e===4)return ht(t,n,r,i);{let s=U[P++];if((s&128)>0){P-=5;return}return ht(t,n,r,i,s)}}else if(e<8){let s=U[P++],o=U[P++];if((s&128)>0||(o&128)>0){P-=6;return}if(e<7)return ht(t,n,r,i,s,o);let a=U[P++];if((a&128)>0){P-=7;return}return ht(t,n,r,i,s,o,a)}else{let s=U[P++],o=U[P++],a=U[P++],l=U[P++];if((s&128)>0||(o&128)>0||(a&128)>0||(l&128)>0){P-=8;return}if(e<10){if(e===8)return ht(t,n,r,i,s,o,a,l);{let c=U[P++];if((c&128)>0){P-=9;return}return ht(t,n,r,i,s,o,a,l,c)}}else if(e<12){let c=U[P++],h=U[P++];if((c&128)>0||(h&128)>0){P-=10;return}if(e<11)return ht(t,n,r,i,s,o,a,l,c,h);let u=U[P++];if((u&128)>0){P-=11;return}return ht(t,n,r,i,s,o,a,l,c,h,u)}else{let c=U[P++],h=U[P++],u=U[P++],f=U[P++];if((c&128)>0||(h&128)>0||(u&128)>0||(f&128)>0){P-=12;return}if(e<14){if(e===12)return ht(t,n,r,i,s,o,a,l,c,h,u,f);{let _=U[P++];if((_&128)>0){P-=13;return}return ht(t,n,r,i,s,o,a,l,c,h,u,f,_)}}else{let _=U[P++],b=U[P++];if((_&128)>0||(b&128)>0){P-=14;return}if(e<15)return ht(t,n,r,i,s,o,a,l,c,h,u,f,_,b);let A=U[P++];if((A&128)>0){P-=15;return}return ht(t,n,r,i,s,o,a,l,c,h,u,f,_,b,A)}}}}}function Qa(){let e=U[P++],t;if(e<192)t=e-160;else switch(e){case 217:t=U[P++];break;case 218:t=V.getUint16(P),P+=2;break;case 219:t=V.getUint32(P),P+=4;break;default:throw new Error("Expected string")}return Hn(t)}function Oi(e){return et.copyBuffers?Uint8Array.prototype.slice.call(U,P,P+=e):U.subarray(P,P+=e)}function Me(e){let t=U[P++];if(Mt[t]){let n;return Mt[t](U.subarray(P,n=P+=e),r=>{P=r;try{return ot()}finally{P=n}})}else throw new Error("Unknown extension type "+t)}var Za=new Array(4096);function sc(){let e=U[P++];if(e>=160&&e<192){if(e=e-160,Xt>=P)return _e.slice(P-Lt,(P+=e)-Lt);if(!(Xt==0&&te<180))return As(e)}else return P--,oc(ot());let t=(e<<5^(e>1?V.getUint16(P):e>0?U[P]:0))&4095,n=Za[t],r=P,i=P+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=V.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=U[r++],s!=n[o++]){r=1879048192;break}if(r===i)return P=r,n.string;i-=3,r=P}for(n=[],Za[t]=n,n.bytes=e;r<i;)s=V.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=U[r++],n.push(s);let a=e<16?ao(e):ic(e);return a!=null?n.string=a:n.string=As(e)}function oc(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";if(et.allowArraysInMapKeys&&Array.isArray(e)&&e.flat().every(t=>["string","number","boolean","bigint"].includes(typeof t)))return e.flat().toString();throw new Error(`Invalid property type for record: ${typeof e}`)}const Ja=(e,t)=>{let n=ot().map(oc),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=K[e];return i&&(i.isShared||we)&&((K.restoreStructures||(K.restoreStructures=[]))[e]=i),K[e]=n,n.read=oo(n,r),n.read()};Mt[0]=()=>{};Mt[0].noBuffer=!0;Mt[66]=e=>{let t=e.byteLength%8||8,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);if(e.byteLength!==t){let r=new DataView(e.buffer,e.byteOffset,e.byteLength),i=(s,o)=>{let a=o-s;if(a<=40){let u=r.getBigUint64(s);for(let f=s+8;f<o;f+=8)u<<=64n,u|=r.getBigUint64(f);return u}let l=s+(a>>4<<3),c=i(s,l),h=i(l,o);return c<<BigInt((o-l)*8)|h};n=n<<BigInt((r.byteLength-t)*8)|i(t,r.byteLength)}return n};let tl={Error,EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,AggregateError:typeof AggregateError=="function"?AggregateError:null};Mt[101]=()=>{let e=ot();if(!tl[e[0]]){let t=Error(e[1],{cause:e[2]});return t.name=e[0],t}return tl[e[0]](e[1],{cause:e[2]})};Mt[105]=e=>{if(et.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=V.getUint32(P-4);le||(le=new Map);let n=U[P],r;n>=144&&n<160||n==220||n==221?r=[]:n>=128&&n<144||n==222||n==223?r=new Map:(n>=199&&n<=201||n>=212&&n<=216)&&U[P+1]===115?r=new Set:r={};let i={target:r};le.set(t,i);let s=ot();if(i.used)Object.assign(r,s);else return i.target=s;if(r instanceof Map)for(let[o,a]of s.entries())r.set(o,a);if(r instanceof Set)for(let o of Array.from(s))r.add(o);return r};Mt[112]=e=>{if(et.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=V.getUint32(P-4),n=le.get(t);return n.used=!0,n.target};Mt[115]=()=>new Set(ot());const ry=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let iy=typeof globalThis=="object"?globalThis:window;Mt[116]=e=>{let t=e[0],n=Uint8Array.prototype.slice.call(e,1).buffer,r=ry[t];if(!r){if(t===16)return n;if(t===17)return new DataView(n);throw new Error("Could not find typed array for code "+t)}return new iy[r](n)};Mt[120]=()=>{let e=ot();return new RegExp(e[0],e[1])};const sy=[];Mt[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=P;return P+=t-e.length,ft=sy,ft=[Qa(),Qa()],ft.position0=0,ft.position1=0,ft.postBundlePosition=P,P=n,ot()};Mt[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function ac(e){let t=te,n=P,r=Lt,i=Xt,s=_e,o=le,a=ft,l=new Uint8Array(U.slice(0,te)),c=K,h=K.slice(0,K.length),u=et,f=we,_=e();return te=t,P=n,Lt=r,Xt=i,_e=s,le=o,ft=a,U=l,we=f,K=c,K.splice(0,K.length,...h),et=u,V=new DataView(U.buffer,U.byteOffset,U.byteLength),_}function Is(){U=null,le=null,K=null}const lc=new Array(147);for(let e=0;e<256;e++)lc[e]=+("1e"+Math.floor(45.15-e*.30103));var di=new Qr({useRecords:!1});const oy=di.unpack;di.unpackMultiple;di.unpack;let ay=new Float32Array(1);new Uint8Array(ay.buffer,0,4);const ly=Dn({length:4}),uy=Dn({length:28}),cy="https://starz-io-party.hypercubed.partykit.dev",el="https://starz-io-party.hypercubed.partykit.dev",Li="starz-game-room-leaderboard-prod";class hy extends Xm{async playkitConnect(t,n,r){return console.log("Connecting to PartyKit..."),this.partySocket=new vi({host:cy,room:Li,query:{playerId:t,playerToken:n,playerName:r}}),new Promise((i,s)=>{this.partySocket.onopen=()=>{console.log("Connected to PartyKit"),i()},this.partySocket.onerror=o=>{console.error("PartyKit connection error:",o),this.partySocket=void 0,s(o)}})}async initializePlayer(){console.log("Initializing player..."),this.playerId=localStorage.getItem("starz_playerId")??ly(),localStorage.setItem("starz_playerId",this.playerId),this.playerToken=localStorage.getItem("starz_playerToken")??uy(),localStorage.setItem("starz_playerToken",this.playerToken);const t=localStorage.getItem("starz_playerName")??this.config.playerName;localStorage.setItem("starz_playerName",t);let n=+(localStorage.getItem("starz_score")??"0");if(localStorage.setItem("starz_score",n.toString()),!this.partySocket){try{await this.playkitConnect(this.playerId,this.playerToken,t)}catch{console.error("Failed to connect to PartyKit")}this.partySocket&&(this.#t(),n=await new Promise(r=>{const i=s=>{const o=JSON.parse(s.data);o.type==="init"&&(n=o.playerEntry.score,localStorage.setItem("starz_score",n.toString()),this.partySocket.removeEventListener("message",i),r(n))};this.partySocket.addEventListener("message",i)}))}return console.log(`Player initialized: ${this.playerId} (${t}) with score ${n}`),{id:this.playerId,name:t,score:{score:n}}}async submitWinLoss(t){if(super.submitWinLoss(t),!this.partySocket)return;console.assert(t===1||t===-1,"deltaScore must be 1 or -1");const n=this.state.playerMap.get(this.playerId);if(!n)return;const r={type:t>0?"increment":"decrement",playerId:this.playerId,playerToken:this.playerToken,playerName:n.name};vi.fetch({host:el,room:Li},{method:"POST",body:JSON.stringify(r)})}async loadLeaderboard(){return this.partySocket?await(await vi.fetch({host:el,room:Li},{method:"GET",headers:{"Content-Type":"application/json"}})).json():null}#t(){if(!this.partySocket)return null;this.partySocket.addEventListener("message",async t=>{const n=t.data instanceof Blob?oy(await t.data.arrayBuffer()):JSON.parse(t.data);switch(n.type){case"init":{console.log("Connected to PartyKit with data:",n),console.log("Initial leaderboard data:"),console.table(n.leaderboard);break}default:"message"in n?console.log(n.message):"error"in n&&console.error("PartyKit error:",n.error);break}})}}const on=Symbol("game-manager");var fy=Object.defineProperty,dy=Object.getOwnPropertyDescriptor,uc=(e,t,n,r)=>{for(var i=r>1?void 0:r?dy(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&fy(t,n,i),i};let Ts=class extends Qt{constructor(){super(...arguments),this.gameManager=new hy}connectedCallback(){super.connectedCallback(),globalThis.gameManager=this.gameManager,this.gameManager.connect()}createRenderRoot(){return this}};uc([dc({context:on}),Uc()],Ts.prototype,"gameManager",2);Ts=uc([sn("app-root")],Ts);var py=Object.defineProperty,gy=Object.getOwnPropertyDescriptor,lo=(e,t,n,r)=>{for(var i=r>1?void 0:r?gy(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&py(t,n,i),i};const my=Ys(".3~s");let Zr=class extends Qt{constructor(){super(...arguments),this.stats=[]}connectedCallback(){super.connectedCallback(),this.gameManager.events.on("STATE_UPDATED",({state:e})=>{const t=Array.from(e.playerMap.values());this.stats=t.sort((n,r)=>r.stats.systems-n.stats.systems||r.stats.ships-n.stats.ships)})}createRenderRoot(){return this}render(){return Kt`
      <table id="leaderbox">
        ${this.renderHeader()} ${this.renderBody()}
      </table>
    `}renderBody(){return Kt`<tbody>
      ${this.stats.map(t=>Kt`<tr
            style="--owner-color: ${t.color||null}"
            title="${t.bot?t.bot.name:"Human"}"
            class="${t.isAlive?"":"eliminated"}"
          >
            <td>${" "}${t.name}${" "}</td>
            <td>${" "}${t.stats.systems}${" "}</td>
            <td>${" "}${my(t.stats.ships)}${" "}</td>
          </tr>`)}
    </tbody>`}renderHeader(){return Kt`<thead>
        <tr>
          <th>Player</th>
          <th>Systems</th>
          <th>Ships</th>
        </tr>
      </thead>
      <tbody></tbody>`}};lo([Ln({context:on,subscribe:!0}),$t({attribute:!1})],Zr.prototype,"gameManager",2);lo([$t()],Zr.prototype,"stats",2);Zr=lo([sn("leaderboard-element")],Zr);var yy=Object.defineProperty,_y=Object.getOwnPropertyDescriptor,uo=(e,t,n,r)=>{for(var i=r>1?void 0:r?_y(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&yy(t,n,i),i};let Jr=class extends Qt{constructor(){super(...arguments),this.tick=0}connectedCallback(){super.connectedCallback(),this.gameManager.events.on("GAME_TICK",({tick:e})=>{this.tick=e??0})}createRenderRoot(){return this}render(){const e=~~(this.tick/2),t=this.tick%2===1?".":"";return Kt`${e}${t}`}};uo([Ln({context:on,subscribe:!0}),$t({attribute:!1})],Jr.prototype,"gameManager",2);uo([$t({type:Number})],Jr.prototype,"tick",2);Jr=uo([sn("tick-box")],Jr);var wy=Object.defineProperty,vy=Object.getOwnPropertyDescriptor,ze=(e,t,n,r)=>{for(var i=r>1?void 0:r?vy(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&wy(t,n,i),i};let ve=class extends Qt{constructor(){super(...arguments),this.version=nl,this.playerName="Player",this.playerScore=0,this.playerRank=null,this.shortId=""}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this.updatePlayerInfo(),this.gameManager.events.on("GAME_INIT",()=>{this.updatePlayerInfo()})}render(){return Kt`
      <article>
        <h1>STARZ!</h1>
        <small class="version">v${this.version}</small>

        <div class="lore">
          <p>
            Nobody knows why <i>The Bubble</i> exists, or who built the lattice
            of hyperspace lanes threading its hundreds of star systems together
            like a cosmic web. Its discovery was accidental - a distortion
            ripple detected on the edge of settled space, leading explorers to
            the shimmering boundary of a region where physics seemed... wrong.
          </p>
          <p>
            What <i>is</i> known is this: control of <i>The Bubble</i> means
            control of immense resources and power. Rival factions flood its
            systems, each desperate to carve out their claim before somebody
            else does.
          </p>
          <p>
            As a commander, you are the spearhead of your faction's ambitions:
            tasked with expanding your influence, capturing systems, and
            ultimately dominating <i>The Bubble</i>.
          </p>
        </div>

        <h3>Protect our homeworld. Capture the enemy systems.</h3>
        <form method="dialog">
          <div class="grid">
            <div>
              <input
                name="playerName"
                id="playerNameInput"
                type="text"
                value="${this.playerName}"
                placeholder="Player Name"
                minlength="1"
                maxlength="30"
                required
              />
              <small>(Name will be used in leaderboard)</small>
            </div>
            <div>
              ${this.playerName} [${this.shortId}]
              <span>✶ ${this.playerScore}</span>
              <br /><small
                >${this.playerRank?`Rank: ${this.playerRank}`:""}</small
              >
            </div>
          </div>

          <br /><button type="button" @click="${this.onPlay}">Play</button>
          <br /><button type="button" @click="${this.onOptions}">
            Options
          </button>
        </form>
      </article>
    `}updatePlayerInfo(){const{P:e,C:t}=this.gameManager.getContext();this.playerName=e?.name??t.config?.playerName??"Player",this.playerScore=e?.score.score??0,this.playerRank=e?.score?.rank??null,this.shortId=t.playerId.length===4?t.playerId:xy(t.playerId)}onPlay(){const t=this.querySelector("#playerNameInput").value.trim()||"Player";this.gameManager.setConfig({playerName:t}),this.closest("dialog").close()}onOptions(){Zu()}};ze([Ln({context:on,subscribe:!0}),$t({attribute:!1})],ve.prototype,"gameManager",2);ze([$t()],ve.prototype,"version",2);ze([$t()],ve.prototype,"playerName",2);ze([$t()],ve.prototype,"playerScore",2);ze([$t()],ve.prototype,"playerRank",2);ze([$t()],ve.prototype,"shortId",2);ve=ze([sn("start-dialog-content")],ve);function xy(e){const t=e+name,n=Array.from(t).reduce((r,i)=>(r<<5)-r+i.charCodeAt(0),0);return Math.abs(n).toString(36).substring(0,4)}const by={CHILD:2},Sy=e=>(...t)=>({_$litDirective$:e,values:t});class Ey{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,n,r){this._$Ct=t,this._$AM=n,this._$Ci=r}_$AS(t,n){return this.update(t,n)}update(t,n){return this.render(...n)}}class Ps extends Ey{constructor(t){if(super(t),this.it=at,t.type!==by.CHILD)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(t){if(t===at||t==null)return this._t=void 0,this.it=t;if(t===Le)return t;if(typeof t!="string")throw Error(this.constructor.directiveName+"() called with a non-string value");if(t===this.it)return this._t;this.it=t;const n=[t];return n.raw=n,this._t={_$litType$:this.constructor.resultType,strings:n,values:[]}}}Ps.directiveName="unsafeHTML",Ps.resultType=1;const My=Sy(Ps);var $y=Object.defineProperty,Ay=Object.getOwnPropertyDescriptor,co=(e,t,n,r)=>{for(var i=r>1?void 0:r?Ay(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&$y(t,n,i),i};let ti=class extends Qt{constructor(){super(...arguments),this.messages=[]}connectedCallback(){super.connectedCallback(),this.gameManager.events.on("MESSAGES_UPDATED",({messages:e})=>{this.messages=(e??[]).slice(-5)})}createRenderRoot(){return this}render(){return this.messages.length>0?Kt`${this.messages.map(e=>{const t=~~(e.tick/2),n=e.tick%2===1?".":"";return Kt`<div>
          ${My(e.message)} <small>${t}${n}</small>
        </div>`})}`:Kt``}};co([Ln({context:on,subscribe:!0}),$t({attribute:!1})],ti.prototype,"gameManager",2);co([$t()],ti.prototype,"messages",2);ti=co([sn("message-box")],ti);var Iy=Object.defineProperty,Ty=Object.getOwnPropertyDescriptor,cc=(e,t,n,r)=>{for(var i=r>1?void 0:r?Ty(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&Iy(t,n,i),i};let Ns=class extends Qt{connectedCallback(){super.connectedCallback(),this.gameManager.events.on("GAME_START",()=>{Rm(document.getElementById("app"),this.gameManager.getContext())}),this.gameManager.events.on("STATE_UPDATED",()=>{tt()})}createRenderRoot(){return this}render(){return Kt`
      <canvas></canvas>
      <svg></svg>
    `}};cc([Ln({context:on,subscribe:!0}),$t({attribute:!1})],Ns.prototype,"gameManager",2);Ns=cc([sn("game-canvas")],Ns);console.log(`starz.io version ${nl}`);

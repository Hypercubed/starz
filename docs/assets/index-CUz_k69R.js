(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();const xa="0.0.6";let ba=class extends Event{constructor(t,n,i,r){super("context-request",{bubbles:!0,composed:!0}),this.context=t,this.contextTarget=n,this.callback=i,this.subscribe=r??!1}};let Bs=class{constructor(t,n,i,r){if(this.subscribe=!1,this.provided=!1,this.value=void 0,this.t=(s,o)=>{this.unsubscribe&&(this.unsubscribe!==o&&(this.provided=!1,this.unsubscribe()),this.subscribe||this.unsubscribe()),this.value=s,this.host.requestUpdate(),this.provided&&!this.subscribe||(this.provided=!0,this.callback&&this.callback(s,o)),this.unsubscribe=o},this.host=t,n.context!==void 0){const s=n;this.context=s.context,this.callback=s.callback,this.subscribe=s.subscribe??!1}else this.context=n,this.callback=i,this.subscribe=r??!1;this.host.addController(this)}hostConnected(){this.dispatchRequest()}hostDisconnected(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=void 0)}dispatchRequest(){this.host.dispatchEvent(new ba(this.context,this.host,this.t,this.subscribe))}};let bc=class{get value(){return this.o}set value(t){this.setValue(t)}setValue(t,n=!1){const i=n||!Object.is(t,this.o);this.o=t,i&&this.updateObservers()}constructor(t){this.subscriptions=new Map,this.updateObservers=()=>{for(const[n,{disposer:i}]of this.subscriptions)n(this.o,i)},t!==void 0&&(this.value=t)}addCallback(t,n,i){if(!i)return void t(this.value);this.subscriptions.has(t)||this.subscriptions.set(t,{disposer:()=>{this.subscriptions.delete(t)},consumerHost:n});const{disposer:r}=this.subscriptions.get(t);t(this.value,r)}clearCallbacks(){this.subscriptions.clear()}};let Sc=class extends Event{constructor(t,n){super("context-provider",{bubbles:!0,composed:!0}),this.context=t,this.contextTarget=n}},Us=class extends bc{constructor(t,n,i){super(n.context!==void 0?n.initialValue:i),this.onContextRequest=r=>{if(r.context!==this.context)return;const s=r.contextTarget??r.composedPath()[0];s!==this.host&&(r.stopPropagation(),this.addCallback(r.callback,s,r.subscribe))},this.onProviderRequest=r=>{if(r.context!==this.context||(r.contextTarget??r.composedPath()[0])===this.host)return;const s=new Set;for(const[o,{consumerHost:a}]of this.subscriptions)s.has(o)||(s.add(o),a.dispatchEvent(new ba(this.context,a,o,!0)));r.stopPropagation()},this.host=t,n.context!==void 0?this.context=n.context:this.context=n,this.attachListeners(),this.host.addController?.(this)}attachListeners(){this.host.addEventListener("context-request",this.onContextRequest),this.host.addEventListener("context-provider",this.onProviderRequest)}hostConnected(){this.host.dispatchEvent(new Sc(this.context,this.host))}};function Ec({context:e}){return(t,n)=>{const i=new WeakMap;if(typeof n=="object")return{get(){return t.get.call(this)},set(r){return i.get(this).setValue(r),t.set.call(this,r)},init(r){return i.set(this,new Us(this,{context:e,initialValue:r})),r}};{t.constructor.addInitializer((o=>{i.set(o,new Us(o,{context:e}))}));const r=Object.getOwnPropertyDescriptor(t,n);let s;if(r===void 0){const o=new WeakMap;s={get(){return o.get(this)},set(a){i.get(this).setValue(a),o.set(this,a)},configurable:!0,enumerable:!0}}else{const o=r.set;s={...r,set(a){i.get(this).setValue(a),o?.call(this,a)}}}return void Object.defineProperty(t,n,s)}}}function wn({context:e,subscribe:t}){return(n,i)=>{typeof i=="object"?i.addInitializer((function(){new Bs(this,{context:e,callback:r=>{n.set.call(this,r)},subscribe:t})})):n.constructor.addInitializer((r=>{new Bs(r,{context:e,callback:s=>{r[i]=s},subscribe:t})}))}}const Wn=globalThis,ls=Wn.ShadowRoot&&(Wn.ShadyCSS===void 0||Wn.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Sa=Symbol(),Hs=new WeakMap;let Mc=class{constructor(t,n,i){if(this._$cssResult$=!0,i!==Sa)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=n}get styleSheet(){let t=this.o;const n=this.t;if(ls&&t===void 0){const i=n!==void 0&&n.length===1;i&&(t=Hs.get(n)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),i&&Hs.set(n,t))}return t}toString(){return this.cssText}};const $c=e=>new Mc(typeof e=="string"?e:e+"",void 0,Sa),Ac=(e,t)=>{if(ls)e.adoptedStyleSheets=t.map((n=>n instanceof CSSStyleSheet?n:n.styleSheet));else for(const n of t){const i=document.createElement("style"),r=Wn.litNonce;r!==void 0&&i.setAttribute("nonce",r),i.textContent=n.cssText,e.appendChild(i)}},Fs=ls?e=>e:e=>e instanceof CSSStyleSheet?(t=>{let n="";for(const i of t.cssRules)n+=i.cssText;return $c(n)})(e):e;const{is:Ic,defineProperty:Tc,getOwnPropertyDescriptor:Nc,getOwnPropertyNames:Pc,getOwnPropertySymbols:Cc,getPrototypeOf:kc}=Object,Ri=globalThis,qs=Ri.trustedTypes,Oc=qs?qs.emptyScript:"",Lc=Ri.reactiveElementPolyfillSupport,sn=(e,t)=>e,ti={toAttribute(e,t){switch(t){case Boolean:e=e?Oc:null;break;case Object:case Array:e=e==null?e:JSON.stringify(e)}return e},fromAttribute(e,t){let n=e;switch(t){case Boolean:n=e!==null;break;case Number:n=e===null?null:Number(e);break;case Object:case Array:try{n=JSON.parse(e)}catch{n=null}}return n}},cs=(e,t)=>!Ic(e,t),Gs={attribute:!0,type:String,converter:ti,reflect:!1,useDefault:!1,hasChanged:cs};Symbol.metadata??=Symbol("metadata"),Ri.litPropertyMetadata??=new WeakMap;let Ae=class extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,n=Gs){if(n.state&&(n.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((n=Object.create(n)).wrapped=!0),this.elementProperties.set(t,n),!n.noAccessor){const i=Symbol(),r=this.getPropertyDescriptor(t,i,n);r!==void 0&&Tc(this.prototype,t,r)}}static getPropertyDescriptor(t,n,i){const{get:r,set:s}=Nc(this.prototype,t)??{get(){return this[n]},set(o){this[n]=o}};return{get:r,set(o){const a=r?.call(this);s?.call(this,o),this.requestUpdate(t,a,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??Gs}static _$Ei(){if(this.hasOwnProperty(sn("elementProperties")))return;const t=kc(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(sn("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(sn("properties"))){const n=this.properties,i=[...Pc(n),...Cc(n)];for(const r of i)this.createProperty(r,n[r])}const t=this[Symbol.metadata];if(t!==null){const n=litPropertyMetadata.get(t);if(n!==void 0)for(const[i,r]of n)this.elementProperties.set(i,r)}this._$Eh=new Map;for(const[n,i]of this.elementProperties){const r=this._$Eu(n,i);r!==void 0&&this._$Eh.set(r,n)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const n=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const r of i)n.unshift(Fs(r))}else t!==void 0&&n.push(Fs(t));return n}static _$Eu(t,n){const i=n.attribute;return i===!1?void 0:typeof i=="string"?i:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((t=>t(this)))}addController(t){(this._$EO??=new Set).add(t),this.renderRoot!==void 0&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,n=this.constructor.elementProperties;for(const i of n.keys())this.hasOwnProperty(i)&&(t.set(i,this[i]),delete this[i]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return Ac(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((t=>t.hostConnected?.()))}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach((t=>t.hostDisconnected?.()))}attributeChangedCallback(t,n,i){this._$AK(t,i)}_$ET(t,n){const i=this.constructor.elementProperties.get(t),r=this.constructor._$Eu(t,i);if(r!==void 0&&i.reflect===!0){const s=(i.converter?.toAttribute!==void 0?i.converter:ti).toAttribute(n,i.type);this._$Em=t,s==null?this.removeAttribute(r):this.setAttribute(r,s),this._$Em=null}}_$AK(t,n){const i=this.constructor,r=i._$Eh.get(t);if(r!==void 0&&this._$Em!==r){const s=i.getPropertyOptions(r),o=typeof s.converter=="function"?{fromAttribute:s.converter}:s.converter?.fromAttribute!==void 0?s.converter:ti;this._$Em=r;const a=o.fromAttribute(n,s.type);this[r]=a??this._$Ej?.get(r)??a,this._$Em=null}}requestUpdate(t,n,i){if(t!==void 0){const r=this.constructor,s=this[t];if(i??=r.getPropertyOptions(t),!((i.hasChanged??cs)(s,n)||i.useDefault&&i.reflect&&s===this._$Ej?.get(t)&&!this.hasAttribute(r._$Eu(t,i))))return;this.C(t,n,i)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(t,n,{useDefault:i,reflect:r,wrapped:s},o){i&&!(this._$Ej??=new Map).has(t)&&(this._$Ej.set(t,o??n??this[t]),s!==!0||o!==void 0)||(this._$AL.has(t)||(this.hasUpdated||i||(n=void 0),this._$AL.set(t,n)),r===!0&&this._$Em!==t&&(this._$Eq??=new Set).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(n){Promise.reject(n)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[r,s]of this._$Ep)this[r]=s;this._$Ep=void 0}const i=this.constructor.elementProperties;if(i.size>0)for(const[r,s]of i){const{wrapped:o}=s,a=this[r];o!==!0||this._$AL.has(r)||a===void 0||this.C(r,void 0,s,a)}}let t=!1;const n=this._$AL;try{t=this.shouldUpdate(n),t?(this.willUpdate(n),this._$EO?.forEach((i=>i.hostUpdate?.())),this.update(n)):this._$EM()}catch(i){throw t=!1,this._$EM(),i}t&&this._$AE(n)}willUpdate(t){}_$AE(t){this._$EO?.forEach((n=>n.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&=this._$Eq.forEach((n=>this._$ET(n,this[n]))),this._$EM()}updated(t){}firstUpdated(t){}};Ae.elementStyles=[],Ae.shadowRootOptions={mode:"open"},Ae[sn("elementProperties")]=new Map,Ae[sn("finalized")]=new Map,Lc?.({ReactiveElement:Ae}),(Ri.reactiveElementVersions??=[]).push("2.1.1");const us=globalThis,ei=us.trustedTypes,Ws=ei?ei.createPolicy("lit-html",{createHTML:e=>e}):void 0,Ea="$lit$",ne=`lit$${Math.random().toFixed(9).slice(2)}$`,Ma="?"+ne,Rc=`<${Ma}>`,_e=document,ln=()=>_e.createComment(""),cn=e=>e===null||typeof e!="object"&&typeof e!="function",hs=Array.isArray,Dc=e=>hs(e)||typeof e?.[Symbol.iterator]=="function",Ki=`[ 	
\f\r]`,We=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Ys=/-->/g,Xs=/>/g,ae=RegExp(`>|${Ki}(?:([^\\s"'>=/]+)(${Ki}*=${Ki}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Vs=/'/g,Ks=/"/g,$a=/^(?:script|style|textarea|title)$/i,zc=e=>(t,...n)=>({_$litType$:e,strings:t,values:n}),Bt=zc(1),we=Symbol.for("lit-noChange"),et=Symbol.for("lit-nothing"),js=new WeakMap,he=_e.createTreeWalker(_e,129);function Aa(e,t){if(!hs(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return Ws!==void 0?Ws.createHTML(t):t}const Bc=(e,t)=>{const n=e.length-1,i=[];let r,s=t===2?"<svg>":t===3?"<math>":"",o=We;for(let a=0;a<n;a++){const l=e[a];let u,h,c=-1,f=0;for(;f<l.length&&(o.lastIndex=f,h=o.exec(l),h!==null);)f=o.lastIndex,o===We?h[1]==="!--"?o=Ys:h[1]!==void 0?o=Xs:h[2]!==void 0?($a.test(h[2])&&(r=RegExp("</"+h[2],"g")),o=ae):h[3]!==void 0&&(o=ae):o===ae?h[0]===">"?(o=r??We,c=-1):h[1]===void 0?c=-2:(c=o.lastIndex-h[2].length,u=h[1],o=h[3]===void 0?ae:h[3]==='"'?Ks:Vs):o===Ks||o===Vs?o=ae:o===Ys||o===Xs?o=We:(o=ae,r=void 0);const _=o===ae&&e[a+1].startsWith("/>")?" ":"";s+=o===We?l+Rc:c>=0?(i.push(u),l.slice(0,c)+Ea+l.slice(c)+ne+_):l+ne+(c===-2?a:_)}return[Aa(e,s+(e[n]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),i]};class un{constructor({strings:t,_$litType$:n},i){let r;this.parts=[];let s=0,o=0;const a=t.length-1,l=this.parts,[u,h]=Bc(t,n);if(this.el=un.createElement(u,i),he.currentNode=this.el.content,n===2||n===3){const c=this.el.content.firstChild;c.replaceWith(...c.childNodes)}for(;(r=he.nextNode())!==null&&l.length<a;){if(r.nodeType===1){if(r.hasAttributes())for(const c of r.getAttributeNames())if(c.endsWith(Ea)){const f=h[o++],_=r.getAttribute(c).split(ne),S=/([.?@])?(.*)/.exec(f);l.push({type:1,index:s,name:S[2],strings:_,ctor:S[1]==="."?Hc:S[1]==="?"?Fc:S[1]==="@"?qc:Di}),r.removeAttribute(c)}else c.startsWith(ne)&&(l.push({type:6,index:s}),r.removeAttribute(c));if($a.test(r.tagName)){const c=r.textContent.split(ne),f=c.length-1;if(f>0){r.textContent=ei?ei.emptyScript:"";for(let _=0;_<f;_++)r.append(c[_],ln()),he.nextNode(),l.push({type:2,index:++s});r.append(c[f],ln())}}}else if(r.nodeType===8)if(r.data===Ma)l.push({type:2,index:s});else{let c=-1;for(;(c=r.data.indexOf(ne,c+1))!==-1;)l.push({type:7,index:s}),c+=ne.length-1}s++}}static createElement(t,n){const i=_e.createElement("template");return i.innerHTML=t,i}}function ke(e,t,n=e,i){if(t===we)return t;let r=i!==void 0?n._$Co?.[i]:n._$Cl;const s=cn(t)?void 0:t._$litDirective$;return r?.constructor!==s&&(r?._$AO?.(!1),s===void 0?r=void 0:(r=new s(e),r._$AT(e,n,i)),i!==void 0?(n._$Co??=[])[i]=r:n._$Cl=r),r!==void 0&&(t=ke(e,r._$AS(e,t.values),r,i)),t}class Uc{constructor(t,n){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:n},parts:i}=this._$AD,r=(t?.creationScope??_e).importNode(n,!0);he.currentNode=r;let s=he.nextNode(),o=0,a=0,l=i[0];for(;l!==void 0;){if(o===l.index){let u;l.type===2?u=new vn(s,s.nextSibling,this,t):l.type===1?u=new l.ctor(s,l.name,l.strings,this,t):l.type===6&&(u=new Gc(s,this,t)),this._$AV.push(u),l=i[++a]}o!==l?.index&&(s=he.nextNode(),o++)}return he.currentNode=_e,r}p(t){let n=0;for(const i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(t,i,n),n+=i.strings.length-2):i._$AI(t[n])),n++}}class vn{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,n,i,r){this.type=2,this._$AH=et,this._$AN=void 0,this._$AA=t,this._$AB=n,this._$AM=i,this.options=r,this._$Cv=r?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const n=this._$AM;return n!==void 0&&t?.nodeType===11&&(t=n.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,n=this){t=ke(this,t,n),cn(t)?t===et||t==null||t===""?(this._$AH!==et&&this._$AR(),this._$AH=et):t!==this._$AH&&t!==we&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):Dc(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==et&&cn(this._$AH)?this._$AA.nextSibling.data=t:this.T(_e.createTextNode(t)),this._$AH=t}$(t){const{values:n,_$litType$:i}=t,r=typeof i=="number"?this._$AC(t):(i.el===void 0&&(i.el=un.createElement(Aa(i.h,i.h[0]),this.options)),i);if(this._$AH?._$AD===r)this._$AH.p(n);else{const s=new Uc(r,this),o=s.u(this.options);s.p(n),this.T(o),this._$AH=s}}_$AC(t){let n=js.get(t.strings);return n===void 0&&js.set(t.strings,n=new un(t)),n}k(t){hs(this._$AH)||(this._$AH=[],this._$AR());const n=this._$AH;let i,r=0;for(const s of t)r===n.length?n.push(i=new vn(this.O(ln()),this.O(ln()),this,this.options)):i=n[r],i._$AI(s),r++;r<n.length&&(this._$AR(i&&i._$AB.nextSibling,r),n.length=r)}_$AR(t=this._$AA.nextSibling,n){for(this._$AP?.(!1,!0,n);t!==this._$AB;){const i=t.nextSibling;t.remove(),t=i}}setConnected(t){this._$AM===void 0&&(this._$Cv=t,this._$AP?.(t))}}class Di{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,n,i,r,s){this.type=1,this._$AH=et,this._$AN=void 0,this.element=t,this.name=n,this._$AM=r,this.options=s,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=et}_$AI(t,n=this,i,r){const s=this.strings;let o=!1;if(s===void 0)t=ke(this,t,n,0),o=!cn(t)||t!==this._$AH&&t!==we,o&&(this._$AH=t);else{const a=t;let l,u;for(t=s[0],l=0;l<s.length-1;l++)u=ke(this,a[i+l],n,l),u===we&&(u=this._$AH[l]),o||=!cn(u)||u!==this._$AH[l],u===et?t=et:t!==et&&(t+=(u??"")+s[l+1]),this._$AH[l]=u}o&&!r&&this.j(t)}j(t){t===et?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class Hc extends Di{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===et?void 0:t}}class Fc extends Di{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==et)}}class qc extends Di{constructor(t,n,i,r,s){super(t,n,i,r,s),this.type=5}_$AI(t,n=this){if((t=ke(this,t,n,0)??et)===we)return;const i=this._$AH,r=t===et&&i!==et||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,s=t!==et&&(i===et||r);r&&this.element.removeEventListener(this.name,this,i),s&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class Gc{constructor(t,n,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=n,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){ke(this,t)}}const Wc=us.litHtmlPolyfillSupport;Wc?.(un,vn),(us.litHtmlVersions??=[]).push("3.3.1");const Yc=(e,t,n)=>{const i=n?.renderBefore??t;let r=i._$litPart$;if(r===void 0){const s=n?.renderBefore??null;i._$litPart$=r=new vn(t.insertBefore(ln(),s),s,void 0,n??{})}return r._$AI(e),r};const fs=globalThis;let Ut=class extends Ae{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const n=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=Yc(n,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return we}};Ut._$litElement$=!0,Ut.finalized=!0,fs.litElementHydrateSupport?.({LitElement:Ut});const Xc=fs.litElementPolyfillSupport;Xc?.({LitElement:Ut});(fs.litElementVersions??=[]).push("4.2.1");const Fe=e=>(t,n)=>{n!==void 0?n.addInitializer((()=>{customElements.define(e,t)})):customElements.define(e,t)};const Vc={attribute:!0,type:String,converter:ti,reflect:!1,hasChanged:cs},Kc=(e=Vc,t,n)=>{const{kind:i,metadata:r}=n;let s=globalThis.litPropertyMetadata.get(r);if(s===void 0&&globalThis.litPropertyMetadata.set(r,s=new Map),i==="setter"&&((e=Object.create(e)).wrapped=!0),s.set(n.name,e),i==="accessor"){const{name:o}=n;return{set(a){const l=t.get.call(this);t.set.call(this,a),this.requestUpdate(o,l,e)},init(a){return a!==void 0&&this.C(o,void 0,e,a),a}}}if(i==="setter"){const{name:o}=n;return function(a){const l=this[o];t.call(this,a),this.requestUpdate(o,l,e)}}throw Error("Unsupported decorator location: "+i)};function yt(e){return(t,n)=>typeof n=="object"?Kc(e,t,n):((i,r,s)=>{const o=r.hasOwnProperty(s);return r.constructor.createProperty(s,i),o?Object.getOwnPropertyDescriptor(r,s):void 0})(e,t,n)}function jc(e){return yt({...e,state:!0,attribute:!1})}const $n=BigInt(2**32-1),Qs=BigInt(32);function Qc(e,t=!1){return t?{h:Number(e&$n),l:Number(e>>Qs&$n)}:{h:Number(e>>Qs&$n)|0,l:Number(e&$n)|0}}function Zc(e,t=!1){const n=e.length;let i=new Uint32Array(n),r=new Uint32Array(n);for(let s=0;s<n;s++){const{h:o,l:a}=Qc(e[s],t);[i[s],r[s]]=[o,a]}return[i,r]}const Jc=(e,t,n)=>e<<n|t>>>32-n,tu=(e,t,n)=>t<<n|e>>>32-n,eu=(e,t,n)=>t<<n-32|e>>>64-n,nu=(e,t,n)=>e<<n-32|t>>>64-n;function iu(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Zs(e,t=""){if(!Number.isSafeInteger(e)||e<0){const n=t&&`"${t}" `;throw new Error(`${n}expected integer >= 0, got ${e}`)}}function gr(e,t,n=""){const i=iu(e),r=e?.length;if(!i||t!==void 0){const o=n&&`"${n}" `,a="",l=i?`length=${r}`:`type=${typeof e}`;throw new Error(o+"expected Uint8Array"+a+", got "+l)}return e}function Js(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function ru(e,t){gr(e,void 0,"digestInto() output");const n=t.outputLen;if(e.length<n)throw new Error('"digestInto() output" expected to be of length >='+n)}function su(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function Ia(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}const ou=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function au(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function lu(e){for(let t=0;t<e.length;t++)e[t]=au(e[t]);return e}const to=ou?e=>e:lu;function cu(e,t={}){const n=(r,s)=>e(s).update(r).digest(),i=e(void 0);return n.outputLen=i.outputLen,n.blockLen=i.blockLen,n.create=r=>e(r),Object.assign(n,t),Object.freeze(n)}const uu=e=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,e])}),hu=BigInt(0),Ye=BigInt(1),fu=BigInt(2),du=BigInt(7),pu=BigInt(256),gu=BigInt(113),Ta=[],Na=[],Pa=[];for(let e=0,t=Ye,n=1,i=0;e<24;e++){[n,i]=[i,(2*n+3*i)%5],Ta.push(2*(5*i+n)),Na.push((e+1)*(e+2)/2%64);let r=hu;for(let s=0;s<7;s++)t=(t<<Ye^(t>>du)*gu)%pu,t&fu&&(r^=Ye<<(Ye<<BigInt(s))-Ye);Pa.push(r)}const Ca=Zc(Pa,!0),mu=Ca[0],yu=Ca[1],eo=(e,t,n)=>n>32?eu(e,t,n):Jc(e,t,n),no=(e,t,n)=>n>32?nu(e,t,n):tu(e,t,n);function _u(e,t=24){const n=new Uint32Array(10);for(let i=24-t;i<24;i++){for(let o=0;o<10;o++)n[o]=e[o]^e[o+10]^e[o+20]^e[o+30]^e[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,l=(o+2)%10,u=n[l],h=n[l+1],c=eo(u,h,1)^n[a],f=no(u,h,1)^n[a+1];for(let _=0;_<50;_+=10)e[o+_]^=c,e[o+_+1]^=f}let r=e[2],s=e[3];for(let o=0;o<24;o++){const a=Na[o],l=eo(r,s,a),u=no(r,s,a),h=Ta[o];r=e[h],s=e[h+1],e[h]=l,e[h+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=e[o+a];for(let a=0;a<10;a++)e[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}e[0]^=mu[i],e[1]^=yu[i]}Ia(n)}class ds{state;pos=0;posOut=0;finished=!1;state32;destroyed=!1;blockLen;suffix;outputLen;enableXOF=!1;rounds;constructor(t,n,i,r=!1,s=24){if(this.blockLen=t,this.suffix=n,this.outputLen=i,this.enableXOF=r,this.rounds=s,Zs(i,"outputLen"),!(0<t&&t<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=su(this.state)}clone(){return this._cloneInto()}keccak(){to(this.state32),_u(this.state32,this.rounds),to(this.state32),this.posOut=0,this.pos=0}update(t){Js(this),gr(t);const{blockLen:n,state:i}=this,r=t.length;for(let s=0;s<r;){const o=Math.min(n-this.pos,r-s);for(let a=0;a<o;a++)i[this.pos++]^=t[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:n,pos:i,blockLen:r}=this;t[i]^=n,(n&128)!==0&&i===r-1&&this.keccak(),t[r-1]^=128,this.keccak()}writeInto(t){Js(this,!1),gr(t),this.finish();const n=this.state,{blockLen:i}=this;for(let r=0,s=t.length;r<s;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,s-r);t.set(n.subarray(this.posOut,this.posOut+o),r),this.posOut+=o,r+=o}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return Zs(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(ru(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Ia(this.state)}_cloneInto(t){const{blockLen:n,suffix:i,outputLen:r,rounds:s,enableXOF:o}=this;return t||=new ds(n,i,r,o,s),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=s,t.suffix=i,t.outputLen=r,t.enableXOF=o,t.destroyed=this.destroyed,t}}const wu=(e,t,n,i={})=>cu(()=>new ds(t,e,n),i),vu=wu(6,72,64,uu(10));var xu=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,ji=Math.ceil,Et=Math.floor,gt="[BigNumber Error] ",io=gt+"Number primitive has more than 15 significant digits: ",It=1e14,H=14,Qi=9007199254740991,Zi=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],te=1e7,rt=1e9;function ka(e){var t,n,i,r=$.prototype={constructor:$,toString:null,valueOf:null},s=new $(1),o=20,a=4,l=-7,u=21,h=-1e7,c=1e7,f=!1,_=1,S=0,A={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},N="0123456789abcdefghijklmnopqrstuvwxyz",I=!0;function $(d,g){var w,v,b,M,y,p,m,x,E=this;if(!(E instanceof $))return new $(d,g);if(g==null){if(d&&d._isBigNumber===!0){E.s=d.s,!d.c||d.e>c?E.c=E.e=null:d.e<h?E.c=[E.e=0]:(E.e=d.e,E.c=d.c.slice());return}if((p=typeof d=="number")&&d*0==0){if(E.s=1/d<0?(d=-d,-1):1,d===~~d){for(M=0,y=d;y>=10;y/=10,M++);M>c?E.c=E.e=null:(E.e=M,E.c=[d]);return}x=String(d)}else{if(!xu.test(x=String(d)))return i(E,x,p);E.s=x.charCodeAt(0)==45?(x=x.slice(1),-1):1}(M=x.indexOf("."))>-1&&(x=x.replace(".","")),(y=x.search(/e/i))>0?(M<0&&(M=y),M+=+x.slice(y+1),x=x.substring(0,y)):M<0&&(M=x.length)}else{if(Z(g,2,N.length,"Base"),g==10&&I)return E=new $(d),O(E,o+E.e+1,a);if(x=String(d),p=typeof d=="number"){if(d*0!=0)return i(E,x,p,g);if(E.s=1/d<0?(x=x.slice(1),-1):1,$.DEBUG&&x.replace(/^0\.0*|\./,"").length>15)throw Error(io+d)}else E.s=x.charCodeAt(0)===45?(x=x.slice(1),-1):1;for(w=N.slice(0,g),M=y=0,m=x.length;y<m;y++)if(w.indexOf(v=x.charAt(y))<0){if(v=="."){if(y>M){M=m;continue}}else if(!b&&(x==x.toUpperCase()&&(x=x.toLowerCase())||x==x.toLowerCase()&&(x=x.toUpperCase()))){b=!0,y=-1,M=0;continue}return i(E,String(d),p,g)}p=!1,x=n(x,g,10,E.s),(M=x.indexOf("."))>-1?x=x.replace(".",""):M=x.length}for(y=0;x.charCodeAt(y)===48;y++);for(m=x.length;x.charCodeAt(--m)===48;);if(x=x.slice(y,++m)){if(m-=y,p&&$.DEBUG&&m>15&&(d>Qi||d!==Et(d)))throw Error(io+E.s*d);if((M=M-y-1)>c)E.c=E.e=null;else if(M<h)E.c=[E.e=0];else{if(E.e=M,E.c=[],y=(M+1)%H,M<0&&(y+=H),y<m){for(y&&E.c.push(+x.slice(0,y)),m-=H;y<m;)E.c.push(+x.slice(y,y+=H));y=H-(x=x.slice(y)).length}else y-=m;for(;y--;x+="0");E.c.push(+x)}}else E.c=[E.e=0]}$.clone=ka,$.ROUND_UP=0,$.ROUND_DOWN=1,$.ROUND_CEIL=2,$.ROUND_FLOOR=3,$.ROUND_HALF_UP=4,$.ROUND_HALF_DOWN=5,$.ROUND_HALF_EVEN=6,$.ROUND_HALF_CEIL=7,$.ROUND_HALF_FLOOR=8,$.EUCLID=9,$.config=$.set=function(d){var g,w;if(d!=null)if(typeof d=="object"){if(d.hasOwnProperty(g="DECIMAL_PLACES")&&(w=d[g],Z(w,0,rt,g),o=w),d.hasOwnProperty(g="ROUNDING_MODE")&&(w=d[g],Z(w,0,8,g),a=w),d.hasOwnProperty(g="EXPONENTIAL_AT")&&(w=d[g],w&&w.pop?(Z(w[0],-rt,0,g),Z(w[1],0,rt,g),l=w[0],u=w[1]):(Z(w,-rt,rt,g),l=-(u=w<0?-w:w))),d.hasOwnProperty(g="RANGE"))if(w=d[g],w&&w.pop)Z(w[0],-rt,-1,g),Z(w[1],1,rt,g),h=w[0],c=w[1];else if(Z(w,-rt,rt,g),w)h=-(c=w<0?-w:w);else throw Error(gt+g+" cannot be zero: "+w);if(d.hasOwnProperty(g="CRYPTO"))if(w=d[g],w===!!w)if(w)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))f=w;else throw f=!w,Error(gt+"crypto unavailable");else f=w;else throw Error(gt+g+" not true or false: "+w);if(d.hasOwnProperty(g="MODULO_MODE")&&(w=d[g],Z(w,0,9,g),_=w),d.hasOwnProperty(g="POW_PRECISION")&&(w=d[g],Z(w,0,rt,g),S=w),d.hasOwnProperty(g="FORMAT"))if(w=d[g],typeof w=="object")A=w;else throw Error(gt+g+" not an object: "+w);if(d.hasOwnProperty(g="ALPHABET"))if(w=d[g],typeof w=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(w))I=w.slice(0,10)=="0123456789",N=w;else throw Error(gt+g+" invalid: "+w)}else throw Error(gt+"Object expected: "+d);return{DECIMAL_PLACES:o,ROUNDING_MODE:a,EXPONENTIAL_AT:[l,u],RANGE:[h,c],CRYPTO:f,MODULO_MODE:_,POW_PRECISION:S,FORMAT:A,ALPHABET:N}},$.isBigNumber=function(d){if(!d||d._isBigNumber!==!0)return!1;if(!$.DEBUG)return!0;var g,w,v=d.c,b=d.e,M=d.s;t:if({}.toString.call(v)=="[object Array]"){if((M===1||M===-1)&&b>=-rt&&b<=rt&&b===Et(b)){if(v[0]===0){if(b===0&&v.length===1)return!0;break t}if(g=(b+1)%H,g<1&&(g+=H),String(v[0]).length==g){for(g=0;g<v.length;g++)if(w=v[g],w<0||w>=It||w!==Et(w))break t;if(w!==0)return!0}}}else if(v===null&&b===null&&(M===null||M===1||M===-1))return!0;throw Error(gt+"Invalid BigNumber: "+d)},$.maximum=$.max=function(){return P(arguments,-1)},$.minimum=$.min=function(){return P(arguments,1)},$.random=(function(){var d=9007199254740992,g=Math.random()*d&2097151?function(){return Et(Math.random()*d)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(w){var v,b,M,y,p,m=0,x=[],E=new $(s);if(w==null?w=o:Z(w,0,rt),y=ji(w/H),f)if(crypto.getRandomValues){for(v=crypto.getRandomValues(new Uint32Array(y*=2));m<y;)p=v[m]*131072+(v[m+1]>>>11),p>=9e15?(b=crypto.getRandomValues(new Uint32Array(2)),v[m]=b[0],v[m+1]=b[1]):(x.push(p%1e14),m+=2);m=y/2}else if(crypto.randomBytes){for(v=crypto.randomBytes(y*=7);m<y;)p=(v[m]&31)*281474976710656+v[m+1]*1099511627776+v[m+2]*4294967296+v[m+3]*16777216+(v[m+4]<<16)+(v[m+5]<<8)+v[m+6],p>=9e15?crypto.randomBytes(7).copy(v,m):(x.push(p%1e14),m+=7);m=y/7}else throw f=!1,Error(gt+"crypto unavailable");if(!f)for(;m<y;)p=g(),p<9e15&&(x[m++]=p%1e14);for(y=x[--m],w%=H,y&&w&&(p=Zi[H-w],x[m]=Et(y/p)*p);x[m]===0;x.pop(),m--);if(m<0)x=[M=0];else{for(M=-1;x[0]===0;x.splice(0,1),M-=H);for(m=1,p=x[0];p>=10;p/=10,m++);m<H&&(M-=H-m)}return E.e=M,E.c=x,E}})(),$.sum=function(){for(var d=1,g=arguments,w=new $(g[0]);d<g.length;)w=w.plus(g[d++]);return w},n=(function(){var d="0123456789";function g(w,v,b,M){for(var y,p=[0],m,x=0,E=w.length;x<E;){for(m=p.length;m--;p[m]*=v);for(p[0]+=M.indexOf(w.charAt(x++)),y=0;y<p.length;y++)p[y]>b-1&&(p[y+1]==null&&(p[y+1]=0),p[y+1]+=p[y]/b|0,p[y]%=b)}return p.reverse()}return function(w,v,b,M,y){var p,m,x,E,T,L,R,z,U=w.indexOf("."),F=o,B=a;for(U>=0&&(E=S,S=0,w=w.replace(".",""),z=new $(v),L=z.pow(w.length-U),S=E,z.c=g(Wt(St(L.c),L.e,"0"),10,b,d),z.e=z.c.length),R=g(w,v,b,y?(p=N,d):(p=d,N)),x=E=R.length;R[--E]==0;R.pop());if(!R[0])return p.charAt(0);if(U<0?--x:(L.c=R,L.e=x,L.s=M,L=t(L,z,F,B,b),R=L.c,T=L.r,x=L.e),m=x+F+1,U=R[m],E=b/2,T=T||m<0||R[m+1]!=null,T=B<4?(U!=null||T)&&(B==0||B==(L.s<0?3:2)):U>E||U==E&&(B==4||T||B==6&&R[m-1]&1||B==(L.s<0?8:7)),m<1||!R[0])w=T?Wt(p.charAt(1),-F,p.charAt(0)):p.charAt(0);else{if(R.length=m,T)for(--b;++R[--m]>b;)R[m]=0,m||(++x,R=[1].concat(R));for(E=R.length;!R[--E];);for(U=0,w="";U<=E;w+=p.charAt(R[U++]));w=Wt(w,x,p.charAt(0))}return w}})(),t=(function(){function d(v,b,M){var y,p,m,x,E=0,T=v.length,L=b%te,R=b/te|0;for(v=v.slice();T--;)m=v[T]%te,x=v[T]/te|0,y=R*m+x*L,p=L*m+y%te*te+E,E=(p/M|0)+(y/te|0)+R*x,v[T]=p%M;return E&&(v=[E].concat(v)),v}function g(v,b,M,y){var p,m;if(M!=y)m=M>y?1:-1;else for(p=m=0;p<M;p++)if(v[p]!=b[p]){m=v[p]>b[p]?1:-1;break}return m}function w(v,b,M,y){for(var p=0;M--;)v[M]-=p,p=v[M]<b[M]?1:0,v[M]=p*y+v[M]-b[M];for(;!v[0]&&v.length>1;v.splice(0,1));}return function(v,b,M,y,p){var m,x,E,T,L,R,z,U,F,B,G,K,pt,oe,Vi,Lt,Ge,bt=v.s==b.s?1:-1,lt=v.c,tt=b.c;if(!lt||!lt[0]||!tt||!tt[0])return new $(!v.s||!b.s||(lt?tt&&lt[0]==tt[0]:!tt)?NaN:lt&&lt[0]==0||!tt?bt*0:bt/0);for(U=new $(bt),F=U.c=[],x=v.e-b.e,bt=M+x+1,p||(p=It,x=Mt(v.e/H)-Mt(b.e/H),bt=bt/H|0),E=0;tt[E]==(lt[E]||0);E++);if(tt[E]>(lt[E]||0)&&x--,bt<0)F.push(1),T=!0;else{for(oe=lt.length,Lt=tt.length,E=0,bt+=2,L=Et(p/(tt[0]+1)),L>1&&(tt=d(tt,L,p),lt=d(lt,L,p),Lt=tt.length,oe=lt.length),pt=Lt,B=lt.slice(0,Lt),G=B.length;G<Lt;B[G++]=0);Ge=tt.slice(),Ge=[0].concat(Ge),Vi=tt[0],tt[1]>=p/2&&Vi++;do{if(L=0,m=g(tt,B,Lt,G),m<0){if(K=B[0],Lt!=G&&(K=K*p+(B[1]||0)),L=Et(K/Vi),L>1)for(L>=p&&(L=p-1),R=d(tt,L,p),z=R.length,G=B.length;g(R,B,z,G)==1;)L--,w(R,Lt<z?Ge:tt,z,p),z=R.length,m=1;else L==0&&(m=L=1),R=tt.slice(),z=R.length;if(z<G&&(R=[0].concat(R)),w(B,R,G,p),G=B.length,m==-1)for(;g(tt,B,Lt,G)<1;)L++,w(B,Lt<G?Ge:tt,G,p),G=B.length}else m===0&&(L++,B=[0]);F[E++]=L,B[0]?B[G++]=lt[pt]||0:(B=[lt[pt]],G=1)}while((pt++<oe||B[0]!=null)&&bt--);T=B[0]!=null,F[0]||F.splice(0,1)}if(p==It){for(E=1,bt=F[0];bt>=10;bt/=10,E++);O(U,M+(U.e=E+x*H-1)+1,y,T)}else U.e=x,U.r=+T;return U}})();function C(d,g,w,v){var b,M,y,p,m;if(w==null?w=a:Z(w,0,8),!d.c)return d.toString();if(b=d.c[0],y=d.e,g==null)m=St(d.c),m=v==1||v==2&&(y<=l||y>=u)?In(m,y):Wt(m,y,"0");else if(d=O(new $(d),g,w),M=d.e,m=St(d.c),p=m.length,v==1||v==2&&(g<=M||M<=l)){for(;p<g;m+="0",p++);m=In(m,M)}else if(g-=y+(v===2&&M>y),m=Wt(m,M,"0"),M+1>p){if(--g>0)for(m+=".";g--;m+="0");}else if(g+=M-p,g>0)for(M+1==p&&(m+=".");g--;m+="0");return d.s<0&&b?"-"+m:m}function P(d,g){for(var w,v,b=1,M=new $(d[0]);b<d.length;b++)v=new $(d[b]),(!v.s||(w=le(M,v))===g||w===0&&M.s===g)&&(M=v);return M}function k(d,g,w){for(var v=1,b=g.length;!g[--b];g.pop());for(b=g[0];b>=10;b/=10,v++);return(w=v+w*H-1)>c?d.c=d.e=null:w<h?d.c=[d.e=0]:(d.e=w,d.c=g),d}i=(function(){var d=/^(-?)0([xbo])(?=\w[\w.]*$)/i,g=/^([^.]+)\.$/,w=/^\.([^.]+)$/,v=/^-?(Infinity|NaN)$/,b=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(M,y,p,m){var x,E=p?y:y.replace(b,"");if(v.test(E))M.s=isNaN(E)?null:E<0?-1:1;else{if(!p&&(E=E.replace(d,function(T,L,R){return x=(R=R.toLowerCase())=="x"?16:R=="b"?2:8,!m||m==x?L:T}),m&&(x=m,E=E.replace(g,"$1").replace(w,"0.$1")),y!=E))return new $(E,x);if($.DEBUG)throw Error(gt+"Not a"+(m?" base "+m:"")+" number: "+y);M.s=null}M.c=M.e=null}})();function O(d,g,w,v){var b,M,y,p,m,x,E,T=d.c,L=Zi;if(T){t:{for(b=1,p=T[0];p>=10;p/=10,b++);if(M=g-b,M<0)M+=H,y=g,m=T[x=0],E=Et(m/L[b-y-1]%10);else if(x=ji((M+1)/H),x>=T.length)if(v){for(;T.length<=x;T.push(0));m=E=0,b=1,M%=H,y=M-H+1}else break t;else{for(m=p=T[x],b=1;p>=10;p/=10,b++);M%=H,y=M-H+b,E=y<0?0:Et(m/L[b-y-1]%10)}if(v=v||g<0||T[x+1]!=null||(y<0?m:m%L[b-y-1]),v=w<4?(E||v)&&(w==0||w==(d.s<0?3:2)):E>5||E==5&&(w==4||v||w==6&&(M>0?y>0?m/L[b-y]:0:T[x-1])%10&1||w==(d.s<0?8:7)),g<1||!T[0])return T.length=0,v?(g-=d.e+1,T[0]=L[(H-g%H)%H],d.e=-g||0):T[0]=d.e=0,d;if(M==0?(T.length=x,p=1,x--):(T.length=x+1,p=L[H-M],T[x]=y>0?Et(m/L[b-y]%L[y])*p:0),v)for(;;)if(x==0){for(M=1,y=T[0];y>=10;y/=10,M++);for(y=T[0]+=p,p=1;y>=10;y/=10,p++);M!=p&&(d.e++,T[0]==It&&(T[0]=1));break}else{if(T[x]+=p,T[x]!=It)break;T[x--]=0,p=1}for(M=T.length;T[--M]===0;T.pop());}d.e>c?d.c=d.e=null:d.e<h&&(d.c=[d.e=0])}return d}function D(d){var g,w=d.e;return w===null?d.toString():(g=St(d.c),g=w<=l||w>=u?In(g,w):Wt(g,w,"0"),d.s<0?"-"+g:g)}return r.absoluteValue=r.abs=function(){var d=new $(this);return d.s<0&&(d.s=1),d},r.comparedTo=function(d,g){return le(this,new $(d,g))},r.decimalPlaces=r.dp=function(d,g){var w,v,b,M=this;if(d!=null)return Z(d,0,rt),g==null?g=a:Z(g,0,8),O(new $(M),d+M.e+1,g);if(!(w=M.c))return null;if(v=((b=w.length-1)-Mt(this.e/H))*H,b=w[b])for(;b%10==0;b/=10,v--);return v<0&&(v=0),v},r.dividedBy=r.div=function(d,g){return t(this,new $(d,g),o,a)},r.dividedToIntegerBy=r.idiv=function(d,g){return t(this,new $(d,g),0,1)},r.exponentiatedBy=r.pow=function(d,g){var w,v,b,M,y,p,m,x,E,T=this;if(d=new $(d),d.c&&!d.isInteger())throw Error(gt+"Exponent not an integer: "+D(d));if(g!=null&&(g=new $(g)),p=d.e>14,!T.c||!T.c[0]||T.c[0]==1&&!T.e&&T.c.length==1||!d.c||!d.c[0])return E=new $(Math.pow(+D(T),p?d.s*(2-An(d)):+D(d))),g?E.mod(g):E;if(m=d.s<0,g){if(g.c?!g.c[0]:!g.s)return new $(NaN);v=!m&&T.isInteger()&&g.isInteger(),v&&(T=T.mod(g))}else{if(d.e>9&&(T.e>0||T.e<-1||(T.e==0?T.c[0]>1||p&&T.c[1]>=24e7:T.c[0]<8e13||p&&T.c[0]<=9999975e7)))return M=T.s<0&&An(d)?-0:0,T.e>-1&&(M=1/M),new $(m?1/M:M);S&&(M=ji(S/H+2))}for(p?(w=new $(.5),m&&(d.s=1),x=An(d)):(b=Math.abs(+D(d)),x=b%2),E=new $(s);;){if(x){if(E=E.times(T),!E.c)break;M?E.c.length>M&&(E.c.length=M):v&&(E=E.mod(g))}if(b){if(b=Et(b/2),b===0)break;x=b%2}else if(d=d.times(w),O(d,d.e+1,1),d.e>14)x=An(d);else{if(b=+D(d),b===0)break;x=b%2}T=T.times(T),M?T.c&&T.c.length>M&&(T.c.length=M):v&&(T=T.mod(g))}return v?E:(m&&(E=s.div(E)),g?E.mod(g):M?O(E,S,a,y):E)},r.integerValue=function(d){var g=new $(this);return d==null?d=a:Z(d,0,8),O(g,g.e+1,d)},r.isEqualTo=r.eq=function(d,g){return le(this,new $(d,g))===0},r.isFinite=function(){return!!this.c},r.isGreaterThan=r.gt=function(d,g){return le(this,new $(d,g))>0},r.isGreaterThanOrEqualTo=r.gte=function(d,g){return(g=le(this,new $(d,g)))===1||g===0},r.isInteger=function(){return!!this.c&&Mt(this.e/H)>this.c.length-2},r.isLessThan=r.lt=function(d,g){return le(this,new $(d,g))<0},r.isLessThanOrEqualTo=r.lte=function(d,g){return(g=le(this,new $(d,g)))===-1||g===0},r.isNaN=function(){return!this.s},r.isNegative=function(){return this.s<0},r.isPositive=function(){return this.s>0},r.isZero=function(){return!!this.c&&this.c[0]==0},r.minus=function(d,g){var w,v,b,M,y=this,p=y.s;if(d=new $(d,g),g=d.s,!p||!g)return new $(NaN);if(p!=g)return d.s=-g,y.plus(d);var m=y.e/H,x=d.e/H,E=y.c,T=d.c;if(!m||!x){if(!E||!T)return E?(d.s=-g,d):new $(T?y:NaN);if(!E[0]||!T[0])return T[0]?(d.s=-g,d):new $(E[0]?y:a==3?-0:0)}if(m=Mt(m),x=Mt(x),E=E.slice(),p=m-x){for((M=p<0)?(p=-p,b=E):(x=m,b=T),b.reverse(),g=p;g--;b.push(0));b.reverse()}else for(v=(M=(p=E.length)<(g=T.length))?p:g,p=g=0;g<v;g++)if(E[g]!=T[g]){M=E[g]<T[g];break}if(M&&(b=E,E=T,T=b,d.s=-d.s),g=(v=T.length)-(w=E.length),g>0)for(;g--;E[w++]=0);for(g=It-1;v>p;){if(E[--v]<T[v]){for(w=v;w&&!E[--w];E[w]=g);--E[w],E[v]+=It}E[v]-=T[v]}for(;E[0]==0;E.splice(0,1),--x);return E[0]?k(d,E,x):(d.s=a==3?-1:1,d.c=[d.e=0],d)},r.modulo=r.mod=function(d,g){var w,v,b=this;return d=new $(d,g),!b.c||!d.s||d.c&&!d.c[0]?new $(NaN):!d.c||b.c&&!b.c[0]?new $(b):(_==9?(v=d.s,d.s=1,w=t(b,d,0,3),d.s=v,w.s*=v):w=t(b,d,0,_),d=b.minus(w.times(d)),!d.c[0]&&_==1&&(d.s=b.s),d)},r.multipliedBy=r.times=function(d,g){var w,v,b,M,y,p,m,x,E,T,L,R,z,U,F,B=this,G=B.c,K=(d=new $(d,g)).c;if(!G||!K||!G[0]||!K[0])return!B.s||!d.s||G&&!G[0]&&!K||K&&!K[0]&&!G?d.c=d.e=d.s=null:(d.s*=B.s,!G||!K?d.c=d.e=null:(d.c=[0],d.e=0)),d;for(v=Mt(B.e/H)+Mt(d.e/H),d.s*=B.s,m=G.length,T=K.length,m<T&&(z=G,G=K,K=z,b=m,m=T,T=b),b=m+T,z=[];b--;z.push(0));for(U=It,F=te,b=T;--b>=0;){for(w=0,L=K[b]%F,R=K[b]/F|0,y=m,M=b+y;M>b;)x=G[--y]%F,E=G[y]/F|0,p=R*x+E*L,x=L*x+p%F*F+z[M]+w,w=(x/U|0)+(p/F|0)+R*E,z[M--]=x%U;z[M]=w}return w?++v:z.splice(0,1),k(d,z,v)},r.negated=function(){var d=new $(this);return d.s=-d.s||null,d},r.plus=function(d,g){var w,v=this,b=v.s;if(d=new $(d,g),g=d.s,!b||!g)return new $(NaN);if(b!=g)return d.s=-g,v.minus(d);var M=v.e/H,y=d.e/H,p=v.c,m=d.c;if(!M||!y){if(!p||!m)return new $(b/0);if(!p[0]||!m[0])return m[0]?d:new $(p[0]?v:b*0)}if(M=Mt(M),y=Mt(y),p=p.slice(),b=M-y){for(b>0?(y=M,w=m):(b=-b,w=p),w.reverse();b--;w.push(0));w.reverse()}for(b=p.length,g=m.length,b-g<0&&(w=m,m=p,p=w,g=b),b=0;g;)b=(p[--g]=p[g]+m[g]+b)/It|0,p[g]=It===p[g]?0:p[g]%It;return b&&(p=[b].concat(p),++y),k(d,p,y)},r.precision=r.sd=function(d,g){var w,v,b,M=this;if(d!=null&&d!==!!d)return Z(d,1,rt),g==null?g=a:Z(g,0,8),O(new $(M),d,g);if(!(w=M.c))return null;if(b=w.length-1,v=b*H+1,b=w[b]){for(;b%10==0;b/=10,v--);for(b=w[0];b>=10;b/=10,v++);}return d&&M.e+1>v&&(v=M.e+1),v},r.shiftedBy=function(d){return Z(d,-Qi,Qi),this.times("1e"+d)},r.squareRoot=r.sqrt=function(){var d,g,w,v,b,M=this,y=M.c,p=M.s,m=M.e,x=o+4,E=new $("0.5");if(p!==1||!y||!y[0])return new $(!p||p<0&&(!y||y[0])?NaN:y?M:1/0);if(p=Math.sqrt(+D(M)),p==0||p==1/0?(g=St(y),(g.length+m)%2==0&&(g+="0"),p=Math.sqrt(+g),m=Mt((m+1)/2)-(m<0||m%2),p==1/0?g="5e"+m:(g=p.toExponential(),g=g.slice(0,g.indexOf("e")+1)+m),w=new $(g)):w=new $(p+""),w.c[0]){for(m=w.e,p=m+x,p<3&&(p=0);;)if(b=w,w=E.times(b.plus(t(M,b,x,1))),St(b.c).slice(0,p)===(g=St(w.c)).slice(0,p))if(w.e<m&&--p,g=g.slice(p-3,p+1),g=="9999"||!v&&g=="4999"){if(!v&&(O(b,b.e+o+2,0),b.times(b).eq(M))){w=b;break}x+=4,p+=4,v=1}else{(!+g||!+g.slice(1)&&g.charAt(0)=="5")&&(O(w,w.e+o+2,1),d=!w.times(w).eq(M));break}}return O(w,w.e+o+1,a,d)},r.toExponential=function(d,g){return d!=null&&(Z(d,0,rt),d++),C(this,d,g,1)},r.toFixed=function(d,g){return d!=null&&(Z(d,0,rt),d=d+this.e+1),C(this,d,g)},r.toFormat=function(d,g,w){var v,b=this;if(w==null)d!=null&&g&&typeof g=="object"?(w=g,g=null):d&&typeof d=="object"?(w=d,d=g=null):w=A;else if(typeof w!="object")throw Error(gt+"Argument not an object: "+w);if(v=b.toFixed(d,g),b.c){var M,y=v.split("."),p=+w.groupSize,m=+w.secondaryGroupSize,x=w.groupSeparator||"",E=y[0],T=y[1],L=b.s<0,R=L?E.slice(1):E,z=R.length;if(m&&(M=p,p=m,m=M,z-=M),p>0&&z>0){for(M=z%p||p,E=R.substr(0,M);M<z;M+=p)E+=x+R.substr(M,p);m>0&&(E+=x+R.slice(M)),L&&(E="-"+E)}v=T?E+(w.decimalSeparator||"")+((m=+w.fractionGroupSize)?T.replace(new RegExp("\\d{"+m+"}\\B","g"),"$&"+(w.fractionGroupSeparator||"")):T):E}return(w.prefix||"")+v+(w.suffix||"")},r.toFraction=function(d){var g,w,v,b,M,y,p,m,x,E,T,L,R=this,z=R.c;if(d!=null&&(p=new $(d),!p.isInteger()&&(p.c||p.s!==1)||p.lt(s)))throw Error(gt+"Argument "+(p.isInteger()?"out of range: ":"not an integer: ")+D(p));if(!z)return new $(R);for(g=new $(s),x=w=new $(s),v=m=new $(s),L=St(z),M=g.e=L.length-R.e-1,g.c[0]=Zi[(y=M%H)<0?H+y:y],d=!d||p.comparedTo(g)>0?M>0?g:x:p,y=c,c=1/0,p=new $(L),m.c[0]=0;E=t(p,g,0,1),b=w.plus(E.times(v)),b.comparedTo(d)!=1;)w=v,v=b,x=m.plus(E.times(b=x)),m=b,g=p.minus(E.times(b=g)),p=b;return b=t(d.minus(w),v,0,1),m=m.plus(b.times(x)),w=w.plus(b.times(v)),m.s=x.s=R.s,M=M*2,T=t(x,v,M,a).minus(R).abs().comparedTo(t(m,w,M,a).minus(R).abs())<1?[x,v]:[m,w],c=y,T},r.toNumber=function(){return+D(this)},r.toPrecision=function(d,g){return d!=null&&Z(d,1,rt),C(this,d,g,2)},r.toString=function(d){var g,w=this,v=w.s,b=w.e;return b===null?v?(g="Infinity",v<0&&(g="-"+g)):g="NaN":(d==null?g=b<=l||b>=u?In(St(w.c),b):Wt(St(w.c),b,"0"):d===10&&I?(w=O(new $(w),o+b+1,a),g=Wt(St(w.c),w.e,"0")):(Z(d,2,N.length,"Base"),g=n(Wt(St(w.c),b,"0"),10,d,v,!0)),v<0&&w.c[0]&&(g="-"+g)),g},r.valueOf=r.toJSON=function(){return D(this)},r._isBigNumber=!0,r[Symbol.toStringTag]="BigNumber",r[Symbol.for("nodejs.util.inspect.custom")]=r.valueOf,e!=null&&$.set(e),$}function Mt(e){var t=e|0;return e>0||e===t?t:t-1}function St(e){for(var t,n,i=1,r=e.length,s=e[0]+"";i<r;){for(t=e[i++]+"",n=H-t.length;n--;t="0"+t);s+=t}for(r=s.length;s.charCodeAt(--r)===48;);return s.slice(0,r+1||1)}function le(e,t){var n,i,r=e.c,s=t.c,o=e.s,a=t.s,l=e.e,u=t.e;if(!o||!a)return null;if(n=r&&!r[0],i=s&&!s[0],n||i)return n?i?0:-a:o;if(o!=a)return o;if(n=o<0,i=l==u,!r||!s)return i?0:!r^n?1:-1;if(!i)return l>u^n?1:-1;for(a=(l=r.length)<(u=s.length)?l:u,o=0;o<a;o++)if(r[o]!=s[o])return r[o]>s[o]^n?1:-1;return l==u?0:l>u^n?1:-1}function Z(e,t,n,i){if(e<t||e>n||e!==Et(e))throw Error(gt+(i||"Argument")+(typeof e=="number"?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function An(e){var t=e.c.length-1;return Mt(e.e/H)==t&&e.c[t]%2!=0}function In(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function Wt(e,t,n){var i,r;if(t<0){for(r=n+".";++t;r+=n);e=r+e}else if(i=e.length,++t>i){for(r=n,t-=i;--t;r+=n);e+=r}else t<i&&(e=e.slice(0,t)+"."+e.slice(t));return e}var bu=ka();const Su=24,on=32,Eu=()=>typeof globalThis<"u"&&globalThis.crypto&&typeof globalThis.crypto.getRandomValues=="function"?()=>{const e=new Uint32Array(1);return globalThis.crypto.getRandomValues(e),e[0]/4294967296}:Math.random,ps=Eu(),mr=(e=4,t=ps)=>{let n="";for(;n.length<e;)n=n+Math.floor(t()*36).toString(36);return n};function Mu(e){let t=new bu(0);for(const n of e.values())t=t.multipliedBy(256).plus(n);return t}const Oa=(e="")=>{const t=new TextEncoder;return Mu(vu(t.encode(e))).toString(36).slice(1)},ro=Array.from({length:26},(e,t)=>String.fromCharCode(t+97)),$u=e=>ro[Math.floor(e()*ro.length)],Au=({globalObj:e=typeof global<"u"?global:typeof window<"u"?window:{},random:t=ps}={})=>{const n=Object.keys(e).toString(),i=n.length?n+mr(on,t):mr(on,t);return Oa(i).substring(0,on)},Iu=e=>()=>e++,Tu=476782367,xn=({random:e=ps,counter:t=Iu(Math.floor(e()*Tu)),length:n=Su,fingerprint:i=Au({random:e})}={})=>{if(n>on)throw new Error(`Length must be between 2 and ${on}. Received: ${n}`);return function(){const s=$u(e),o=Date.now().toString(36),a=t().toString(36),l=mr(n,e),u=`${o+l+a+i}`;return`${s+Oa(u).substring(1,n)}`}};xn();(!globalThis.EventTarget||!globalThis.Event)&&console.error(`
  PartySocket requires a global 'EventTarget' class to be available!
  You can polyfill this global by adding this to your code before any partysocket imports: 
  
  \`\`\`
  import 'partysocket/event-target-polyfill';
  \`\`\`
  Please file an issue at https://github.com/partykit/partykit if you're still having trouble.
`);var La=class extends Event{message;error;constructor(e,t){super("error",t),this.message=e.message,this.error=e}},Ra=class extends Event{code;reason;wasClean=!0;constructor(e=1e3,t="",n){super("close",n),this.code=e,this.reason=t}};const Ji={Event,ErrorEvent:La,CloseEvent:Ra};function Nu(e,t){if(!e)throw new Error(t)}function Pu(e){return new e.constructor(e.type,e)}function Cu(e){return"data"in e?new MessageEvent(e.type,e):"code"in e||"reason"in e?new Ra(e.code||1999,e.reason||"unknown reason",e):"error"in e?new La(e.error,e):new Event(e.type,e)}const Tn=typeof process<"u"&&typeof process.versions?.node<"u"&&typeof document>"u"?Cu:Pu,ce={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:Number.POSITIVE_INFINITY,maxEnqueuedMessages:Number.POSITIVE_INFINITY};let so=!1;var ku=class ue extends EventTarget{_ws;_retryCount=-1;_uptimeTimeout;_connectTimeout;_shouldReconnect=!0;_connectLock=!1;_binaryType="blob";_closeCalled=!1;_messageQueue=[];_debugLogger=console.log.bind(console);_url;_protocols;_options;constructor(t,n,i={}){super(),this._url=t,this._protocols=n,this._options=i,this._options.startClosed&&(this._shouldReconnect=!1),this._options.debugLogger&&(this._debugLogger=this._options.debugLogger),this._connect()}static get CONNECTING(){return 0}static get OPEN(){return 1}static get CLOSING(){return 2}static get CLOSED(){return 3}get CONNECTING(){return ue.CONNECTING}get OPEN(){return ue.OPEN}get CLOSING(){return ue.CLOSING}get CLOSED(){return ue.CLOSED}get binaryType(){return this._ws?this._ws.binaryType:this._binaryType}set binaryType(t){this._binaryType=t,this._ws&&(this._ws.binaryType=t)}get retryCount(){return Math.max(this._retryCount,0)}get bufferedAmount(){return this._messageQueue.reduce((t,n)=>(typeof n=="string"?t+=n.length:n instanceof Blob?t+=n.size:t+=n.byteLength,t),0)+(this._ws?this._ws.bufferedAmount:0)}get extensions(){return this._ws?this._ws.extensions:""}get protocol(){return this._ws?this._ws.protocol:""}get readyState(){return this._ws?this._ws.readyState:this._options.startClosed?ue.CLOSED:ue.CONNECTING}get url(){return this._ws?this._ws.url:""}get shouldReconnect(){return this._shouldReconnect}onclose=null;onerror=null;onmessage=null;onopen=null;close(t=1e3,n){if(this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(t,n)}reconnect(t,n){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(t,n),this._connect())}send(t){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",t),this._ws.send(t);else{const{maxEnqueuedMessages:n=ce.maxEnqueuedMessages}=this._options;this._messageQueue.length<n&&(this._debug("enqueue",t),this._messageQueue.push(t))}}_debug(...t){this._options.debug&&this._debugLogger("RWS>",...t)}_getNextDelay(){const{reconnectionDelayGrowFactor:t=ce.reconnectionDelayGrowFactor,minReconnectionDelay:n=ce.minReconnectionDelay,maxReconnectionDelay:i=ce.maxReconnectionDelay}=this._options;let r=0;return this._retryCount>0&&(r=n*t**(this._retryCount-1),r>i&&(r=i)),this._debug("next delay",r),r}_wait(){return new Promise(t=>{setTimeout(t,this._getNextDelay())})}_getNextProtocols(t){if(!t)return Promise.resolve(null);if(typeof t=="string"||Array.isArray(t))return Promise.resolve(t);if(typeof t=="function"){const n=t();if(!n)return Promise.resolve(null);if(typeof n=="string"||Array.isArray(n))return Promise.resolve(n);if(n.then)return n}throw Error("Invalid protocols")}_getNextUrl(t){if(typeof t=="string")return Promise.resolve(t);if(typeof t=="function"){const n=t();if(typeof n=="string")return Promise.resolve(n);if(n.then)return n}throw Error("Invalid URL")}_connect(){if(this._connectLock||!this._shouldReconnect)return;this._connectLock=!0;const{maxRetries:t=ce.maxRetries,connectionTimeout:n=ce.connectionTimeout}=this._options;if(this._retryCount>=t){this._debug("max retries reached",this._retryCount,">=",t);return}this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),this._wait().then(()=>Promise.all([this._getNextUrl(this._url),this._getNextProtocols(this._protocols||null)])).then(([i,r])=>{if(this._closeCalled){this._connectLock=!1;return}!this._options.WebSocket&&typeof WebSocket>"u"&&!so&&(console.error(`‼️ No WebSocket implementation available. You should define options.WebSocket. 

For example, if you're using node.js, run \`npm install ws\`, and then in your code:

import PartySocket from 'partysocket';
import WS from 'ws';

const partysocket = new PartySocket({
  host: "127.0.0.1:1999",
  room: "test-room",
  WebSocket: WS
});

`),so=!0);const s=this._options.WebSocket||WebSocket;this._debug("connect",{url:i,protocols:r}),this._ws=r?new s(i,r):new s(i),this._ws.binaryType=this._binaryType,this._connectLock=!1,this._addListeners(),this._connectTimeout=setTimeout(()=>this._handleTimeout(),n)}).catch(i=>{this._connectLock=!1,this._handleError(new Ji.ErrorEvent(Error(i.message),this))})}_handleTimeout(){this._debug("timeout event"),this._handleError(new Ji.ErrorEvent(Error("TIMEOUT"),this))}_disconnect(t=1e3,n){if(this._clearTimeouts(),!!this._ws){this._removeListeners();try{(this._ws.readyState===this.OPEN||this._ws.readyState===this.CONNECTING)&&this._ws.close(t,n),this._handleClose(new Ji.CloseEvent(t,n,this))}catch{}}}_acceptOpen(){this._debug("accept open"),this._retryCount=0}_handleOpen=t=>{this._debug("open event");const{minUptime:n=ce.minUptime}=this._options;clearTimeout(this._connectTimeout),this._uptimeTimeout=setTimeout(()=>this._acceptOpen(),n),Nu(this._ws,"WebSocket is not defined"),this._ws.binaryType=this._binaryType,this._messageQueue.forEach(i=>{this._ws?.send(i)}),this._messageQueue=[],this.onopen&&this.onopen(t),this.dispatchEvent(Tn(t))};_handleMessage=t=>{this._debug("message event"),this.onmessage&&this.onmessage(t),this.dispatchEvent(Tn(t))};_handleError=t=>{this._debug("error event",t.message),this._disconnect(void 0,t.message==="TIMEOUT"?"timeout":void 0),this.onerror&&this.onerror(t),this._debug("exec error listeners"),this.dispatchEvent(Tn(t)),this._connect()};_handleClose=t=>{this._debug("close event"),this._clearTimeouts(),this._shouldReconnect&&this._connect(),this.onclose&&this.onclose(t),this.dispatchEvent(Tn(t))};_removeListeners(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))}_addListeners(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))}_clearTimeouts(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)}};const Ou=e=>e[1]!==null&&e[1]!==void 0;function Lu(){if(crypto?.randomUUID)return crypto.randomUUID();let e=Date.now(),t=performance?.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){let i=Math.random()*16;return e>0?(i=(e+i)%16|0,e=Math.floor(e/16)):(i=(t+i)%16|0,t=Math.floor(t/16)),(n==="x"?i:i&3|8).toString(16)})}function Da(e,t,n={}){const{host:i,path:r,protocol:s,room:o,party:a,basePath:l,prefix:u,query:h}=e;let c=i.replace(/^(http|https|ws|wss):\/\//,"");if(c.endsWith("/")&&(c=c.slice(0,-1)),r?.startsWith("/"))throw new Error("path must not start with a slash");const f=a??"main",_=r?`/${r}`:"",S=s||(c.startsWith("localhost:")||c.startsWith("127.0.0.1:")||c.startsWith("192.168.")||c.startsWith("10.")||c.startsWith("172.")&&c.split(".")[1]>="16"&&c.split(".")[1]<="31"||c.startsWith("[::ffff:7f00:1]:")?t:`${t}s`),A=`${S}://${c}/${l||`${u||"parties"}/${f}/${o}`}${_}`,N=($={})=>`${A}?${new URLSearchParams([...Object.entries(n),...Object.entries($).filter(Ou)])}`,I=typeof h=="function"?async()=>N(await h()):N(h);return{host:c,path:_,room:o,name:f,protocol:S,partyUrl:A,urlProvider:I}}var tr=class extends ku{_pk;_pkurl;name;room;host;path;constructor(e){const t=oo(e);super(t.urlProvider,t.protocols,t.socketOptions),this.partySocketOptions=e,this.setWSProperties(t),e.disableNameValidation||(e.party?.includes("/")&&console.warn(`PartySocket: party name "${e.party}" contains forward slash which may cause routing issues. Consider using a name without forward slashes or set disableNameValidation: true to bypass this warning.`),e.room?.includes("/")&&console.warn(`PartySocket: room name "${e.room}" contains forward slash which may cause routing issues. Consider using a name without forward slashes or set disableNameValidation: true to bypass this warning.`))}updateProperties(e){const t=oo({...this.partySocketOptions,...e,host:e.host??this.host,room:e.room??this.room,path:e.path??this.path});this._url=t.urlProvider,this._protocols=t.protocols,this._options=t.socketOptions,this.setWSProperties(t)}setWSProperties(e){const{_pk:t,_pkurl:n,name:i,room:r,host:s,path:o}=e;this._pk=t,this._pkurl=n,this.name=i,this.room=r,this.host=s,this.path=o}reconnect(e,t){if(!this.room||!this.host)throw new Error("The room and host must be set before connecting, use `updateProperties` method to set them or pass them to the constructor.");super.reconnect(e,t)}get id(){return this._pk}get roomUrl(){return this._pkurl}static async fetch(e,t){const n=Da(e,"http"),i=typeof n.urlProvider=="string"?n.urlProvider:await n.urlProvider();return(e.fetch??fetch)(i,t)}};function oo(e){const{id:t,host:n,path:i,party:r,room:s,protocol:o,query:a,protocols:l,...u}=e,h=t||Lu(),c=Da(e,"ws",{_pk:h});return{_pk:h,_pkurl:c.partyUrl,name:c.name,room:c.room,host:c.host,path:c.path,protocols:l,socketOptions:u,urlProvider:c.urlProvider}}const Ru={DEV:!1,PROD:!0},ni=750,re=750,Du="Orthographic",zu=500,Bu=2,Uu=25,Hu=1,Fu=1,za=40,qu=!0,Gu=384,yr=1,Wu=4,Yu=.1,Ba=Ru||{},ii=Ba.DEV??!0,Xu=Ba.PROD??!1,Vu=Xu,Ku=ii,Ua=ii,ju=["#c0392b","#f1c40f","#9b59b6","#00b386","#cc6600","#0a4c8c"];function Ha(e,t){let n,i;for(const r of e)r!=null&&(n===void 0?r>=r&&(n=i=r):(n>r&&(n=r),i<r&&(i=r)));return[n,i]}class kt{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let i=0;for(let r=0;r<this._n&&r<32;r++){const s=n[r],o=t+s,a=Math.abs(t)<Math.abs(s)?t-(o-s):s-(o-t);a&&(n[i++]=a),t=o}return n[i]=t,this._n=i+1,this}valueOf(){const t=this._partials;let n=this._n,i,r,s,o=0;if(n>0){for(o=t[--n];n>0&&(i=o,r=t[--n],o=i+r,s=r-(o-i),!s););n>0&&(s<0&&t[n-1]<0||s>0&&t[n-1]>0)&&(r=s*2,i=o+r,r==i-o&&(o=i))}return o}}function ao(e,t){let n=0,i=0;if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(++n,i+=r);else{let r=-1;for(let s of e)(s=t(s,++r,e))!=null&&(s=+s)>=s&&(++n,i+=s)}if(n)return i/n}function*Qu(e){for(const t of e)yield*t}function Fa(e){return Array.from(Qu(e))}function Ie(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((t-e)/n))|0,s=new Array(r);++i<r;)s[i]=e+i*n;return s}var Zu={value:()=>{}};function zi(){for(var e=0,t=arguments.length,n={},i;e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new Yn(n)}function Yn(e){this._=e}function Ju(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}Yn.prototype=zi.prototype={constructor:Yn,on:function(e,t){var n=this._,i=Ju(e+"",n),r,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((r=(e=i[s]).type)&&(r=th(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<o;)if(r=(e=i[s]).type)n[r]=lo(n[r],e.name,t);else if(t==null)for(r in n)n[r]=lo(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Yn(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],i=0,r=s.length;i<r;++i)s[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,s=i.length;r<s;++r)i[r].value.apply(t,n)}};function th(e,t){for(var n=0,i=e.length,r;n<i;++n)if((r=e[n]).name===t)return r.value}function lo(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=Zu,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}var _r="http://www.w3.org/1999/xhtml";const co={svg:"http://www.w3.org/2000/svg",xhtml:_r,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Bi(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),co.hasOwnProperty(t)?{space:co[t],local:e}:e}function eh(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===_r&&t.documentElement.namespaceURI===_r?t.createElement(e):t.createElementNS(n,e)}}function nh(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function qa(e){var t=Bi(e);return(t.local?nh:eh)(t)}function ih(){}function gs(e){return e==null?ih:function(){return this.querySelector(e)}}function rh(e){typeof e!="function"&&(e=gs(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s=t[r],o=s.length,a=i[r]=new Array(o),l,u,h=0;h<o;++h)(l=s[h])&&(u=e.call(l,l.__data__,h,s))&&("__data__"in l&&(u.__data__=l.__data__),a[h]=u);return new vt(i,this._parents)}function sh(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function oh(){return[]}function Ga(e){return e==null?oh:function(){return this.querySelectorAll(e)}}function ah(e){return function(){return sh(e.apply(this,arguments))}}function lh(e){typeof e=="function"?e=ah(e):e=Ga(e);for(var t=this._groups,n=t.length,i=[],r=[],s=0;s<n;++s)for(var o=t[s],a=o.length,l,u=0;u<a;++u)(l=o[u])&&(i.push(e.call(l,l.__data__,u,o)),r.push(l));return new vt(i,r)}function Wa(e){return function(){return this.matches(e)}}function Ya(e){return function(t){return t.matches(e)}}var ch=Array.prototype.find;function uh(e){return function(){return ch.call(this.children,e)}}function hh(){return this.firstElementChild}function fh(e){return this.select(e==null?hh:uh(typeof e=="function"?e:Ya(e)))}var dh=Array.prototype.filter;function ph(){return Array.from(this.children)}function gh(e){return function(){return dh.call(this.children,e)}}function mh(e){return this.selectAll(e==null?ph:gh(typeof e=="function"?e:Ya(e)))}function yh(e){typeof e!="function"&&(e=Wa(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s=t[r],o=s.length,a=i[r]=[],l,u=0;u<o;++u)(l=s[u])&&e.call(l,l.__data__,u,s)&&a.push(l);return new vt(i,this._parents)}function Xa(e){return new Array(e.length)}function _h(){return new vt(this._enter||this._groups.map(Xa),this._parents)}function ri(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}ri.prototype={constructor:ri,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function wh(e){return function(){return e}}function vh(e,t,n,i,r,s){for(var o=0,a,l=t.length,u=s.length;o<u;++o)(a=t[o])?(a.__data__=s[o],i[o]=a):n[o]=new ri(e,s[o]);for(;o<l;++o)(a=t[o])&&(r[o]=a)}function xh(e,t,n,i,r,s,o){var a,l,u=new Map,h=t.length,c=s.length,f=new Array(h),_;for(a=0;a<h;++a)(l=t[a])&&(f[a]=_=o.call(l,l.__data__,a,t)+"",u.has(_)?r[a]=l:u.set(_,l));for(a=0;a<c;++a)_=o.call(e,s[a],a,s)+"",(l=u.get(_))?(i[a]=l,l.__data__=s[a],u.delete(_)):n[a]=new ri(e,s[a]);for(a=0;a<h;++a)(l=t[a])&&u.get(f[a])===l&&(r[a]=l)}function bh(e){return e.__data__}function Sh(e,t){if(!arguments.length)return Array.from(this,bh);var n=t?xh:vh,i=this._parents,r=this._groups;typeof e!="function"&&(e=wh(e));for(var s=r.length,o=new Array(s),a=new Array(s),l=new Array(s),u=0;u<s;++u){var h=i[u],c=r[u],f=c.length,_=Eh(e.call(h,h&&h.__data__,u,i)),S=_.length,A=a[u]=new Array(S),N=o[u]=new Array(S),I=l[u]=new Array(f);n(h,c,A,N,I,_,t);for(var $=0,C=0,P,k;$<S;++$)if(P=A[$]){for($>=C&&(C=$+1);!(k=N[C])&&++C<S;);P._next=k||null}}return o=new vt(o,i),o._enter=a,o._exit=l,o}function Eh(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Mh(){return new vt(this._exit||this._groups.map(Xa),this._parents)}function $h(e,t,n){var i=this.enter(),r=this,s=this.exit();return typeof e=="function"?(i=e(i),i&&(i=i.selection())):i=i.append(e+""),t!=null&&(r=t(r),r&&(r=r.selection())),n==null?s.remove():n(s),i&&r?i.merge(r).order():r}function Ah(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,r=n.length,s=i.length,o=Math.min(r,s),a=new Array(r),l=0;l<o;++l)for(var u=n[l],h=i[l],c=u.length,f=a[l]=new Array(c),_,S=0;S<c;++S)(_=u[S]||h[S])&&(f[S]=_);for(;l<r;++l)a[l]=n[l];return new vt(a,this._parents)}function Ih(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i=e[t],r=i.length-1,s=i[r],o;--r>=0;)(o=i[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function Th(e){e||(e=Nh);function t(c,f){return c&&f?e(c.__data__,f.__data__):!c-!f}for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o=n[s],a=o.length,l=r[s]=new Array(a),u,h=0;h<a;++h)(u=o[h])&&(l[h]=u);l.sort(t)}return new vt(r,this._parents).order()}function Nh(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Ph(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Ch(){return Array.from(this)}function kh(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null}function Oh(){let e=0;for(const t of this)++e;return e}function Lh(){return!this.node()}function Rh(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var r=t[n],s=0,o=r.length,a;s<o;++s)(a=r[s])&&e.call(a,a.__data__,s,r);return this}function Dh(e){return function(){this.removeAttribute(e)}}function zh(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Bh(e,t){return function(){this.setAttribute(e,t)}}function Uh(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Hh(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function Fh(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function qh(e,t){var n=Bi(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((t==null?n.local?zh:Dh:typeof t=="function"?n.local?Fh:Hh:n.local?Uh:Bh)(n,t))}function Va(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Gh(e){return function(){this.style.removeProperty(e)}}function Wh(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Yh(e,t,n){return function(){var i=t.apply(this,arguments);i==null?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function Xh(e,t,n){return arguments.length>1?this.each((t==null?Gh:typeof t=="function"?Yh:Wh)(e,t,n??"")):Oe(this.node(),e)}function Oe(e,t){return e.style.getPropertyValue(t)||Va(e).getComputedStyle(e,null).getPropertyValue(t)}function Vh(e){return function(){delete this[e]}}function Kh(e,t){return function(){this[e]=t}}function jh(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function Qh(e,t){return arguments.length>1?this.each((t==null?Vh:typeof t=="function"?jh:Kh)(e,t)):this.node()[e]}function Ka(e){return e.trim().split(/^|\s+/)}function ms(e){return e.classList||new ja(e)}function ja(e){this._node=e,this._names=Ka(e.getAttribute("class")||"")}ja.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Qa(e,t){for(var n=ms(e),i=-1,r=t.length;++i<r;)n.add(t[i])}function Za(e,t){for(var n=ms(e),i=-1,r=t.length;++i<r;)n.remove(t[i])}function Zh(e){return function(){Qa(this,e)}}function Jh(e){return function(){Za(this,e)}}function tf(e,t){return function(){(t.apply(this,arguments)?Qa:Za)(this,e)}}function ef(e,t){var n=Ka(e+"");if(arguments.length<2){for(var i=ms(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?tf:t?Zh:Jh)(n,t))}function nf(){this.textContent=""}function rf(e){return function(){this.textContent=e}}function sf(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function of(e){return arguments.length?this.each(e==null?nf:(typeof e=="function"?sf:rf)(e)):this.node().textContent}function af(){this.innerHTML=""}function lf(e){return function(){this.innerHTML=e}}function cf(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function uf(e){return arguments.length?this.each(e==null?af:(typeof e=="function"?cf:lf)(e)):this.node().innerHTML}function hf(){this.nextSibling&&this.parentNode.appendChild(this)}function ff(){return this.each(hf)}function df(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function pf(){return this.each(df)}function gf(e){var t=typeof e=="function"?e:qa(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function mf(){return null}function yf(e,t){var n=typeof e=="function"?e:qa(e),i=t==null?mf:typeof t=="function"?t:gs(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function _f(){var e=this.parentNode;e&&e.removeChild(this)}function wf(){return this.each(_f)}function vf(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function xf(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function bf(e){return this.select(e?xf:vf)}function Sf(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Ef(e){return function(t){e.call(this,t,this.__data__)}}function Mf(e){return e.trim().split(/^|\s+/).map(function(t){var n="",i=t.indexOf(".");return i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),{type:t,name:n}})}function $f(e){return function(){var t=this.__on;if(t){for(var n=0,i=-1,r=t.length,s;n<r;++n)s=t[n],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.options):t[++i]=s;++i?t.length=i:delete this.__on}}}function Af(e,t,n){return function(){var i=this.__on,r,s=Ef(t);if(i){for(var o=0,a=i.length;o<a;++o)if((r=i[o]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),r.value=t;return}}this.addEventListener(e.type,s,n),r={type:e.type,name:e.name,value:t,listener:s,options:n},i?i.push(r):this.__on=[r]}}function If(e,t,n){var i=Mf(e+""),r,s=i.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,u=a.length,h;l<u;++l)for(r=0,h=a[l];r<s;++r)if((o=i[r]).type===h.type&&o.name===h.name)return h.value}return}for(a=t?Af:$f,r=0;r<s;++r)this.each(a(i[r],t,n));return this}function Ja(e,t,n){var i=Va(e),r=i.CustomEvent;typeof r=="function"?r=new r(t,n):(r=i.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function Tf(e,t){return function(){return Ja(this,e,t)}}function Nf(e,t){return function(){return Ja(this,e,t.apply(this,arguments))}}function Pf(e,t){return this.each((typeof t=="function"?Nf:Tf)(e,t))}function*Cf(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,s=i.length,o;r<s;++r)(o=i[r])&&(yield o)}var tl=[null];function vt(e,t){this._groups=e,this._parents=t}function bn(){return new vt([[document.documentElement]],tl)}function kf(){return this}vt.prototype=bn.prototype={constructor:vt,select:rh,selectAll:lh,selectChild:fh,selectChildren:mh,filter:yh,data:Sh,enter:_h,exit:Mh,join:$h,merge:Ah,selection:kf,order:Ih,sort:Th,call:Ph,nodes:Ch,node:kh,size:Oh,empty:Lh,each:Rh,attr:qh,style:Xh,property:Qh,classed:ef,text:of,html:uf,raise:ff,lower:pf,append:gf,insert:yf,remove:wf,clone:bf,datum:Sf,on:If,dispatch:Pf,[Symbol.iterator]:Cf};function st(e){return typeof e=="string"?new vt([[document.querySelector(e)]],[document.documentElement]):new vt([[e]],tl)}function el(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Rt(e,t){if(e=el(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}}return[e.pageX,e.pageY]}function Of(e,t){return e.target&&(e=el(e),t===void 0&&(t=e.currentTarget),e=e.touches||[e]),Array.from(e,n=>Rt(n,t))}const Lf={passive:!1},hn={capture:!0,passive:!1};function er(e){e.stopImmediatePropagation()}function Pe(e){e.preventDefault(),e.stopImmediatePropagation()}function nl(e){var t=e.document.documentElement,n=st(e).on("dragstart.drag",Pe,hn);"onselectstart"in t?n.on("selectstart.drag",Pe,hn):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function il(e,t){var n=e.document.documentElement,i=st(e).on("dragstart.drag",null);t&&(i.on("click.drag",Pe,hn),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Nn=e=>()=>e;function wr(e,{sourceEvent:t,subject:n,target:i,identifier:r,active:s,x:o,y:a,dx:l,dy:u,dispatch:h}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:h}})}wr.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function Rf(e){return!e.ctrlKey&&!e.button}function Df(){return this.parentNode}function zf(e,t){return t??{x:e.x,y:e.y}}function Bf(){return navigator.maxTouchPoints||"ontouchstart"in this}function Uf(){var e=Rf,t=Df,n=zf,i=Bf,r={},s=zi("start","drag","end"),o=0,a,l,u,h,c=0;function f(P){P.on("mousedown.drag",_).filter(i).on("touchstart.drag",N).on("touchmove.drag",I,Lf).on("touchend.drag touchcancel.drag",$).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function _(P,k){if(!(h||!e.call(this,P,k))){var O=C(this,t.call(this,P,k),P,k,"mouse");O&&(st(P.view).on("mousemove.drag",S,hn).on("mouseup.drag",A,hn),nl(P.view),er(P),u=!1,a=P.clientX,l=P.clientY,O("start",P))}}function S(P){if(Pe(P),!u){var k=P.clientX-a,O=P.clientY-l;u=k*k+O*O>c}r.mouse("drag",P)}function A(P){st(P.view).on("mousemove.drag mouseup.drag",null),il(P.view,u),Pe(P),r.mouse("end",P)}function N(P,k){if(e.call(this,P,k)){var O=P.changedTouches,D=t.call(this,P,k),d=O.length,g,w;for(g=0;g<d;++g)(w=C(this,D,P,k,O[g].identifier,O[g]))&&(er(P),w("start",P,O[g]))}}function I(P){var k=P.changedTouches,O=k.length,D,d;for(D=0;D<O;++D)(d=r[k[D].identifier])&&(Pe(P),d("drag",P,k[D]))}function $(P){var k=P.changedTouches,O=k.length,D,d;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),D=0;D<O;++D)(d=r[k[D].identifier])&&(er(P),d("end",P,k[D]))}function C(P,k,O,D,d,g){var w=s.copy(),v=Rt(g||O,k),b,M,y;if((y=n.call(P,new wr("beforestart",{sourceEvent:O,target:f,identifier:d,active:o,x:v[0],y:v[1],dx:0,dy:0,dispatch:w}),D))!=null)return b=y.x-v[0]||0,M=y.y-v[1]||0,function p(m,x,E){var T=v,L;switch(m){case"start":r[d]=p,L=o++;break;case"end":delete r[d],--o;case"drag":v=Rt(E||x,k),L=o;break}w.call(m,P,new wr(m,{sourceEvent:x,subject:y,target:f,identifier:d,active:L,x:v[0]+b,y:v[1]+M,dx:v[0]-T[0],dy:v[1]-T[1],dispatch:w}),D)}}return f.filter=function(P){return arguments.length?(e=typeof P=="function"?P:Nn(!!P),f):e},f.container=function(P){return arguments.length?(t=typeof P=="function"?P:Nn(P),f):t},f.subject=function(P){return arguments.length?(n=typeof P=="function"?P:Nn(P),f):n},f.touchable=function(P){return arguments.length?(i=typeof P=="function"?P:Nn(!!P),f):i},f.on=function(){var P=s.on.apply(s,arguments);return P===s?f:P},f.clickDistance=function(P){return arguments.length?(c=(P=+P)*P,f):Math.sqrt(c)},f}function ys(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function rl(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function Sn(){}var fn=.7,si=1/fn,Ce="\\s*([+-]?\\d+)\\s*",dn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ht="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Hf=/^#([0-9a-f]{3,8})$/,Ff=new RegExp(`^rgb\\(${Ce},${Ce},${Ce}\\)$`),qf=new RegExp(`^rgb\\(${Ht},${Ht},${Ht}\\)$`),Gf=new RegExp(`^rgba\\(${Ce},${Ce},${Ce},${dn}\\)$`),Wf=new RegExp(`^rgba\\(${Ht},${Ht},${Ht},${dn}\\)$`),Yf=new RegExp(`^hsl\\(${dn},${Ht},${Ht}\\)$`),Xf=new RegExp(`^hsla\\(${dn},${Ht},${Ht},${dn}\\)$`),uo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ys(Sn,pn,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:ho,formatHex:ho,formatHex8:Vf,formatHsl:Kf,formatRgb:fo,toString:fo});function ho(){return this.rgb().formatHex()}function Vf(){return this.rgb().formatHex8()}function Kf(){return sl(this).formatHsl()}function fo(){return this.rgb().formatRgb()}function pn(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Hf.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?po(t):n===3?new mt(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?Pn(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?Pn(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Ff.exec(e))?new mt(t[1],t[2],t[3],1):(t=qf.exec(e))?new mt(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Gf.exec(e))?Pn(t[1],t[2],t[3],t[4]):(t=Wf.exec(e))?Pn(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Yf.exec(e))?yo(t[1],t[2]/100,t[3]/100,1):(t=Xf.exec(e))?yo(t[1],t[2]/100,t[3]/100,t[4]):uo.hasOwnProperty(e)?po(uo[e]):e==="transparent"?new mt(NaN,NaN,NaN,0):null}function po(e){return new mt(e>>16&255,e>>8&255,e&255,1)}function Pn(e,t,n,i){return i<=0&&(e=t=n=NaN),new mt(e,t,n,i)}function jf(e){return e instanceof Sn||(e=pn(e)),e?(e=e.rgb(),new mt(e.r,e.g,e.b,e.opacity)):new mt}function vr(e,t,n,i){return arguments.length===1?jf(e):new mt(e,t,n,i??1)}function mt(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}ys(mt,vr,rl(Sn,{brighter(e){return e=e==null?si:Math.pow(si,e),new mt(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?fn:Math.pow(fn,e),new mt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new mt(ye(this.r),ye(this.g),ye(this.b),oi(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:go,formatHex:go,formatHex8:Qf,formatRgb:mo,toString:mo}));function go(){return`#${fe(this.r)}${fe(this.g)}${fe(this.b)}`}function Qf(){return`#${fe(this.r)}${fe(this.g)}${fe(this.b)}${fe((isNaN(this.opacity)?1:this.opacity)*255)}`}function mo(){const e=oi(this.opacity);return`${e===1?"rgb(":"rgba("}${ye(this.r)}, ${ye(this.g)}, ${ye(this.b)}${e===1?")":`, ${e})`}`}function oi(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function ye(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function fe(e){return e=ye(e),(e<16?"0":"")+e.toString(16)}function yo(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Pt(e,t,n,i)}function sl(e){if(e instanceof Pt)return new Pt(e.h,e.s,e.l,e.opacity);if(e instanceof Sn||(e=pn(e)),!e)return new Pt;if(e instanceof Pt)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),s=Math.max(t,n,i),o=NaN,a=s-r,l=(s+r)/2;return a?(t===s?o=(n-i)/a+(n<i)*6:n===s?o=(i-t)/a+2:o=(t-n)/a+4,a/=l<.5?s+r:2-s-r,o*=60):a=l>0&&l<1?0:o,new Pt(o,a,l,e.opacity)}function Zf(e,t,n,i){return arguments.length===1?sl(e):new Pt(e,t,n,i??1)}function Pt(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}ys(Pt,Zf,rl(Sn,{brighter(e){return e=e==null?si:Math.pow(si,e),new Pt(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?fn:Math.pow(fn,e),new Pt(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new mt(nr(e>=240?e-240:e+120,r,i),nr(e,r,i),nr(e<120?e+240:e-120,r,i),this.opacity)},clamp(){return new Pt(_o(this.h),Cn(this.s),Cn(this.l),oi(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=oi(this.opacity);return`${e===1?"hsl(":"hsla("}${_o(this.h)}, ${Cn(this.s)*100}%, ${Cn(this.l)*100}%${e===1?")":`, ${e})`}`}}));function _o(e){return e=(e||0)%360,e<0?e+360:e}function Cn(e){return Math.max(0,Math.min(1,e||0))}function nr(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const ol=e=>()=>e;function Jf(e,t){return function(n){return e+n*t}}function t0(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function e0(e){return(e=+e)==1?al:function(t,n){return n-t?t0(t,n,e):ol(isNaN(t)?n:t)}}function al(e,t){var n=t-e;return n?Jf(e,n):ol(isNaN(e)?t:e)}const wo=(function e(t){var n=e0(t);function i(r,s){var o=n((r=vr(r)).r,(s=vr(s)).r),a=n(r.g,s.g),l=n(r.b,s.b),u=al(r.opacity,s.opacity);return function(h){return r.r=o(h),r.g=a(h),r.b=l(h),r.opacity=u(h),r+""}}return i.gamma=e,i})(1);function ee(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var xr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ir=new RegExp(xr.source,"g");function n0(e){return function(){return e}}function i0(e){return function(t){return e(t)+""}}function r0(e,t){var n=xr.lastIndex=ir.lastIndex=0,i,r,s,o=-1,a=[],l=[];for(e=e+"",t=t+"";(i=xr.exec(e))&&(r=ir.exec(t));)(s=r.index)>n&&(s=t.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(i=i[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,l.push({i:o,x:ee(i,r)})),n=ir.lastIndex;return n<t.length&&(s=t.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?i0(l[0].x):n0(t):(t=l.length,function(u){for(var h=0,c;h<t;++h)a[(c=l[h]).i]=c.x(u);return a.join("")})}var vo=180/Math.PI,br={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ll(e,t,n,i,r,s){var o,a,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*i)&&(n-=e*l,i-=t*l),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,l/=a),e*i<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(t,e)*vo,skewX:Math.atan(l)*vo,scaleX:o,scaleY:a}}var kn;function s0(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?br:ll(t.a,t.b,t.c,t.d,t.e,t.f)}function o0(e){return e==null||(kn||(kn=document.createElementNS("http://www.w3.org/2000/svg","g")),kn.setAttribute("transform",e),!(e=kn.transform.baseVal.consolidate()))?br:(e=e.matrix,ll(e.a,e.b,e.c,e.d,e.e,e.f))}function cl(e,t,n,i){function r(u){return u.length?u.pop()+" ":""}function s(u,h,c,f,_,S){if(u!==c||h!==f){var A=_.push("translate(",null,t,null,n);S.push({i:A-4,x:ee(u,c)},{i:A-2,x:ee(h,f)})}else(c||f)&&_.push("translate("+c+t+f+n)}function o(u,h,c,f){u!==h?(u-h>180?h+=360:h-u>180&&(u+=360),f.push({i:c.push(r(c)+"rotate(",null,i)-2,x:ee(u,h)})):h&&c.push(r(c)+"rotate("+h+i)}function a(u,h,c,f){u!==h?f.push({i:c.push(r(c)+"skewX(",null,i)-2,x:ee(u,h)}):h&&c.push(r(c)+"skewX("+h+i)}function l(u,h,c,f,_,S){if(u!==c||h!==f){var A=_.push(r(_)+"scale(",null,",",null,")");S.push({i:A-4,x:ee(u,c)},{i:A-2,x:ee(h,f)})}else(c!==1||f!==1)&&_.push(r(_)+"scale("+c+","+f+")")}return function(u,h){var c=[],f=[];return u=e(u),h=e(h),s(u.translateX,u.translateY,h.translateX,h.translateY,c,f),o(u.rotate,h.rotate,c,f),a(u.skewX,h.skewX,c,f),l(u.scaleX,u.scaleY,h.scaleX,h.scaleY,c,f),u=h=null,function(_){for(var S=-1,A=f.length,N;++S<A;)c[(N=f[S]).i]=N.x(_);return c.join("")}}}var a0=cl(s0,"px, ","px)","deg)"),l0=cl(o0,", ",")",")"),c0=1e-12;function xo(e){return((e=Math.exp(e))+1/e)/2}function u0(e){return((e=Math.exp(e))-1/e)/2}function h0(e){return((e=Math.exp(2*e))-1)/(e+1)}const f0=(function e(t,n,i){function r(s,o){var a=s[0],l=s[1],u=s[2],h=o[0],c=o[1],f=o[2],_=h-a,S=c-l,A=_*_+S*S,N,I;if(A<c0)I=Math.log(f/u)/t,N=function(D){return[a+D*_,l+D*S,u*Math.exp(t*D*I)]};else{var $=Math.sqrt(A),C=(f*f-u*u+i*A)/(2*u*n*$),P=(f*f-u*u-i*A)/(2*f*n*$),k=Math.log(Math.sqrt(C*C+1)-C),O=Math.log(Math.sqrt(P*P+1)-P);I=(O-k)/t,N=function(D){var d=D*I,g=xo(k),w=u/(n*$)*(g*h0(t*d+k)-u0(k));return[a+w*_,l+w*S,u*g/xo(t*d+k)]}}return N.duration=I*1e3*t/Math.SQRT2,N}return r.rho=function(s){var o=Math.max(.001,+s),a=o*o,l=a*a;return e(o,a,l)},r})(Math.SQRT2,2,4);var Le=0,je=0,Xe=0,ul=1e3,ai,Qe,li=0,ve=0,Ui=0,gn=typeof performance=="object"&&performance.now?performance:Date,hl=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function _s(){return ve||(hl(d0),ve=gn.now()+Ui)}function d0(){ve=0}function ci(){this._call=this._time=this._next=null}ci.prototype=fl.prototype={constructor:ci,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?_s():+n)+(t==null?0:+t),!this._next&&Qe!==this&&(Qe?Qe._next=this:ai=this,Qe=this),this._call=e,this._time=n,Sr()},stop:function(){this._call&&(this._call=null,this._time=1/0,Sr())}};function fl(e,t,n){var i=new ci;return i.restart(e,t,n),i}function p0(){_s(),++Le;for(var e=ai,t;e;)(t=ve-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Le}function bo(){ve=(li=gn.now())+Ui,Le=je=0;try{p0()}finally{Le=0,m0(),ve=0}}function g0(){var e=gn.now(),t=e-li;t>ul&&(Ui-=t,li=e)}function m0(){for(var e,t=ai,n,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:ai=n);Qe=e,Sr(i)}function Sr(e){if(!Le){je&&(je=clearTimeout(je));var t=e-ve;t>24?(e<1/0&&(je=setTimeout(bo,e-gn.now()-Ui)),Xe&&(Xe=clearInterval(Xe))):(Xe||(li=gn.now(),Xe=setInterval(g0,ul)),Le=1,hl(bo))}}function So(e,t,n){var i=new ci;return t=t==null?0:+t,i.restart(r=>{i.stop(),e(r+t)},t,n),i}var y0=zi("start","end","cancel","interrupt"),_0=[],dl=0,Eo=1,Er=2,Xn=3,Mo=4,Mr=5,Vn=6;function Hi(e,t,n,i,r,s){var o=e.__transition;if(!o)e.__transition={};else if(n in o)return;w0(e,n,{name:t,index:i,group:r,on:y0,tween:_0,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:dl})}function ws(e,t){var n=Ot(e,t);if(n.state>dl)throw new Error("too late; already scheduled");return n}function qt(e,t){var n=Ot(e,t);if(n.state>Xn)throw new Error("too late; already running");return n}function Ot(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function w0(e,t,n){var i=e.__transition,r;i[t]=n,n.timer=fl(s,0,n.time);function s(u){n.state=Eo,n.timer.restart(o,n.delay,n.time),n.delay<=u&&o(u-n.delay)}function o(u){var h,c,f,_;if(n.state!==Eo)return l();for(h in i)if(_=i[h],_.name===n.name){if(_.state===Xn)return So(o);_.state===Mo?(_.state=Vn,_.timer.stop(),_.on.call("interrupt",e,e.__data__,_.index,_.group),delete i[h]):+h<t&&(_.state=Vn,_.timer.stop(),_.on.call("cancel",e,e.__data__,_.index,_.group),delete i[h])}if(So(function(){n.state===Xn&&(n.state=Mo,n.timer.restart(a,n.delay,n.time),a(u))}),n.state=Er,n.on.call("start",e,e.__data__,n.index,n.group),n.state===Er){for(n.state=Xn,r=new Array(f=n.tween.length),h=0,c=-1;h<f;++h)(_=n.tween[h].value.call(e,e.__data__,n.index,n.group))&&(r[++c]=_);r.length=c+1}}function a(u){for(var h=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(l),n.state=Mr,1),c=-1,f=r.length;++c<f;)r[c].call(e,h);n.state===Mr&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){n.state=Vn,n.timer.stop(),delete i[t];for(var u in i)return;delete e.__transition}}function Kn(e,t){var n=e.__transition,i,r,s=!0,o;if(n){t=t==null?null:t+"";for(o in n){if((i=n[o]).name!==t){s=!1;continue}r=i.state>Er&&i.state<Mr,i.state=Vn,i.timer.stop(),i.on.call(r?"interrupt":"cancel",e,e.__data__,i.index,i.group),delete n[o]}s&&delete e.__transition}}function v0(e){return this.each(function(){Kn(this,e)})}function x0(e,t){var n,i;return function(){var r=qt(this,e),s=r.tween;if(s!==n){i=n=s;for(var o=0,a=i.length;o<a;++o)if(i[o].name===t){i=i.slice(),i.splice(o,1);break}}r.tween=i}}function b0(e,t,n){var i,r;if(typeof n!="function")throw new Error;return function(){var s=qt(this,e),o=s.tween;if(o!==i){r=(i=o).slice();for(var a={name:t,value:n},l=0,u=r.length;l<u;++l)if(r[l].name===t){r[l]=a;break}l===u&&r.push(a)}s.tween=r}}function S0(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i=Ot(this.node(),n).tween,r=0,s=i.length,o;r<s;++r)if((o=i[r]).name===e)return o.value;return null}return this.each((t==null?x0:b0)(n,e,t))}function vs(e,t,n){var i=e._id;return e.each(function(){var r=qt(this,i);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return Ot(r,i).value[t]}}function pl(e,t){var n;return(typeof t=="number"?ee:t instanceof pn?wo:(n=pn(t))?(t=n,wo):r0)(e,t)}function E0(e){return function(){this.removeAttribute(e)}}function M0(e){return function(){this.removeAttributeNS(e.space,e.local)}}function $0(e,t,n){var i,r=n+"",s;return function(){var o=this.getAttribute(e);return o===r?null:o===i?s:s=t(i=o,n)}}function A0(e,t,n){var i,r=n+"",s;return function(){var o=this.getAttributeNS(e.space,e.local);return o===r?null:o===i?s:s=t(i=o,n)}}function I0(e,t,n){var i,r,s;return function(){var o,a=n(this),l;return a==null?void this.removeAttribute(e):(o=this.getAttribute(e),l=a+"",o===l?null:o===i&&l===r?s:(r=l,s=t(i=o,a)))}}function T0(e,t,n){var i,r,s;return function(){var o,a=n(this),l;return a==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),l=a+"",o===l?null:o===i&&l===r?s:(r=l,s=t(i=o,a)))}}function N0(e,t){var n=Bi(e),i=n==="transform"?l0:pl;return this.attrTween(e,typeof t=="function"?(n.local?T0:I0)(n,i,vs(this,"attr."+e,t)):t==null?(n.local?M0:E0)(n):(n.local?A0:$0)(n,i,t))}function P0(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function C0(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function k0(e,t){var n,i;function r(){var s=t.apply(this,arguments);return s!==i&&(n=(i=s)&&C0(e,s)),n}return r._value=t,r}function O0(e,t){var n,i;function r(){var s=t.apply(this,arguments);return s!==i&&(n=(i=s)&&P0(e,s)),n}return r._value=t,r}function L0(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var i=Bi(e);return this.tween(n,(i.local?k0:O0)(i,t))}function R0(e,t){return function(){ws(this,e).delay=+t.apply(this,arguments)}}function D0(e,t){return t=+t,function(){ws(this,e).delay=t}}function z0(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?R0:D0)(t,e)):Ot(this.node(),t).delay}function B0(e,t){return function(){qt(this,e).duration=+t.apply(this,arguments)}}function U0(e,t){return t=+t,function(){qt(this,e).duration=t}}function H0(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?B0:U0)(t,e)):Ot(this.node(),t).duration}function F0(e,t){if(typeof t!="function")throw new Error;return function(){qt(this,e).ease=t}}function q0(e){var t=this._id;return arguments.length?this.each(F0(t,e)):Ot(this.node(),t).ease}function G0(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;qt(this,e).ease=n}}function W0(e){if(typeof e!="function")throw new Error;return this.each(G0(this._id,e))}function Y0(e){typeof e!="function"&&(e=Wa(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s=t[r],o=s.length,a=i[r]=[],l,u=0;u<o;++u)(l=s[u])&&e.call(l,l.__data__,u,s)&&a.push(l);return new jt(i,this._parents,this._name,this._id)}function X0(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,r=n.length,s=Math.min(i,r),o=new Array(i),a=0;a<s;++a)for(var l=t[a],u=n[a],h=l.length,c=o[a]=new Array(h),f,_=0;_<h;++_)(f=l[_]||u[_])&&(c[_]=f);for(;a<i;++a)o[a]=t[a];return new jt(o,this._parents,this._name,this._id)}function V0(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function K0(e,t,n){var i,r,s=V0(t)?ws:qt;return function(){var o=s(this,e),a=o.on;a!==i&&(r=(i=a).copy()).on(t,n),o.on=r}}function j0(e,t){var n=this._id;return arguments.length<2?Ot(this.node(),n).on.on(e):this.each(K0(n,e,t))}function Q0(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Z0(){return this.on("end.remove",Q0(this._id))}function J0(e){var t=this._name,n=this._id;typeof e!="function"&&(e=gs(e));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var a=i[o],l=a.length,u=s[o]=new Array(l),h,c,f=0;f<l;++f)(h=a[f])&&(c=e.call(h,h.__data__,f,a))&&("__data__"in h&&(c.__data__=h.__data__),u[f]=c,Hi(u[f],t,n,f,u,Ot(h,n)));return new jt(s,this._parents,t,n)}function td(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Ga(e));for(var i=this._groups,r=i.length,s=[],o=[],a=0;a<r;++a)for(var l=i[a],u=l.length,h,c=0;c<u;++c)if(h=l[c]){for(var f=e.call(h,h.__data__,c,l),_,S=Ot(h,n),A=0,N=f.length;A<N;++A)(_=f[A])&&Hi(_,t,n,A,f,S);s.push(f),o.push(h)}return new jt(s,o,t,n)}var ed=bn.prototype.constructor;function nd(){return new ed(this._groups,this._parents)}function id(e,t){var n,i,r;return function(){var s=Oe(this,e),o=(this.style.removeProperty(e),Oe(this,e));return s===o?null:s===n&&o===i?r:r=t(n=s,i=o)}}function gl(e){return function(){this.style.removeProperty(e)}}function rd(e,t,n){var i,r=n+"",s;return function(){var o=Oe(this,e);return o===r?null:o===i?s:s=t(i=o,n)}}function sd(e,t,n){var i,r,s;return function(){var o=Oe(this,e),a=n(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(e),Oe(this,e))),o===l?null:o===i&&l===r?s:(r=l,s=t(i=o,a))}}function od(e,t){var n,i,r,s="style."+t,o="end."+s,a;return function(){var l=qt(this,e),u=l.on,h=l.value[s]==null?a||(a=gl(t)):void 0;(u!==n||r!==h)&&(i=(n=u).copy()).on(o,r=h),l.on=i}}function ad(e,t,n){var i=(e+="")=="transform"?a0:pl;return t==null?this.styleTween(e,id(e,i)).on("end.style."+e,gl(e)):typeof t=="function"?this.styleTween(e,sd(e,i,vs(this,"style."+e,t))).each(od(this._id,e)):this.styleTween(e,rd(e,i,t),n).on("end.style."+e,null)}function ld(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}function cd(e,t,n){var i,r;function s(){var o=t.apply(this,arguments);return o!==r&&(i=(r=o)&&ld(e,o,n)),i}return s._value=t,s}function ud(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;return this.tween(i,cd(e,t,n??""))}function hd(e){return function(){this.textContent=e}}function fd(e){return function(){var t=e(this);this.textContent=t??""}}function dd(e){return this.tween("text",typeof e=="function"?fd(vs(this,"text",e)):hd(e==null?"":e+""))}function pd(e){return function(t){this.textContent=e.call(this,t)}}function gd(e){var t,n;function i(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&pd(r)),t}return i._value=e,i}function md(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,gd(e))}function yd(){for(var e=this._name,t=this._id,n=ml(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],a=o.length,l,u=0;u<a;++u)if(l=o[u]){var h=Ot(l,t);Hi(l,e,n,u,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new jt(i,this._parents,e,n)}function _d(){var e,t,n=this,i=n._id,r=n.size();return new Promise(function(s,o){var a={value:o},l={value:function(){--r===0&&s()}};n.each(function(){var u=qt(this,i),h=u.on;h!==e&&(t=(e=h).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),u.on=t}),r===0&&s()})}var wd=0;function jt(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function ml(){return++wd}var Yt=bn.prototype;jt.prototype={constructor:jt,select:J0,selectAll:td,selectChild:Yt.selectChild,selectChildren:Yt.selectChildren,filter:Y0,merge:X0,selection:nd,transition:yd,call:Yt.call,nodes:Yt.nodes,node:Yt.node,size:Yt.size,empty:Yt.empty,each:Yt.each,on:j0,attr:N0,attrTween:L0,style:ad,styleTween:ud,text:dd,textTween:md,remove:Z0,tween:S0,delay:z0,duration:H0,ease:q0,easeVarying:W0,end:_d,[Symbol.iterator]:Yt[Symbol.iterator]};function vd(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var xd={time:null,delay:0,duration:250,ease:vd};function bd(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Sd(e){var t,n;e instanceof jt?(t=e._id,e=e._name):(t=ml(),(n=xd).time=_s(),e=e==null?null:e+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],a=o.length,l,u=0;u<a;++u)(l=o[u])&&Hi(l,e,t,u,o,n||bd(l,t));return new jt(i,this._parents,e,t)}bn.prototype.interrupt=v0;bn.prototype.transition=Sd;const Kt=11102230246251565e-32,ot=134217729,Ed=(3+8*Kt)*Kt;function rr(e,t,n,i,r){let s,o,a,l,u=t[0],h=i[0],c=0,f=0;h>u==h>-u?(s=u,u=t[++c]):(s=h,h=i[++f]);let _=0;if(c<e&&f<n)for(h>u==h>-u?(o=u+s,a=s-(o-u),u=t[++c]):(o=h+s,a=s-(o-h),h=i[++f]),s=o,a!==0&&(r[_++]=a);c<e&&f<n;)h>u==h>-u?(o=s+u,l=o-s,a=s-(o-l)+(u-l),u=t[++c]):(o=s+h,l=o-s,a=s-(o-l)+(h-l),h=i[++f]),s=o,a!==0&&(r[_++]=a);for(;c<e;)o=s+u,l=o-s,a=s-(o-l)+(u-l),u=t[++c],s=o,a!==0&&(r[_++]=a);for(;f<n;)o=s+h,l=o-s,a=s-(o-l)+(h-l),h=i[++f],s=o,a!==0&&(r[_++]=a);return(s!==0||_===0)&&(r[_++]=s),_}function Md(e,t){let n=t[0];for(let i=1;i<e;i++)n+=t[i];return n}function En(e){return new Float64Array(e)}const $d=(3+16*Kt)*Kt,Ad=(2+12*Kt)*Kt,Id=(9+64*Kt)*Kt*Kt,Se=En(4),$o=En(8),Ao=En(12),Io=En(16),ct=En(4);function Td(e,t,n,i,r,s,o){let a,l,u,h,c,f,_,S,A,N,I,$,C,P,k,O,D,d;const g=e-r,w=n-r,v=t-s,b=i-s;P=g*b,f=ot*g,_=f-(f-g),S=g-_,f=ot*b,A=f-(f-b),N=b-A,k=S*N-(P-_*A-S*A-_*N),O=v*w,f=ot*v,_=f-(f-v),S=v-_,f=ot*w,A=f-(f-w),N=w-A,D=S*N-(O-_*A-S*A-_*N),I=k-D,c=k-I,Se[0]=k-(I+c)+(c-D),$=P+I,c=$-P,C=P-($-c)+(I-c),I=C-O,c=C-I,Se[1]=C-(I+c)+(c-O),d=$+I,c=d-$,Se[2]=$-(d-c)+(I-c),Se[3]=d;let M=Md(4,Se),y=Ad*o;if(M>=y||-M>=y||(c=e-g,a=e-(g+c)+(c-r),c=n-w,u=n-(w+c)+(c-r),c=t-v,l=t-(v+c)+(c-s),c=i-b,h=i-(b+c)+(c-s),a===0&&l===0&&u===0&&h===0)||(y=Id*o+Ed*Math.abs(M),M+=g*h+b*a-(v*u+w*l),M>=y||-M>=y))return M;P=a*b,f=ot*a,_=f-(f-a),S=a-_,f=ot*b,A=f-(f-b),N=b-A,k=S*N-(P-_*A-S*A-_*N),O=l*w,f=ot*l,_=f-(f-l),S=l-_,f=ot*w,A=f-(f-w),N=w-A,D=S*N-(O-_*A-S*A-_*N),I=k-D,c=k-I,ct[0]=k-(I+c)+(c-D),$=P+I,c=$-P,C=P-($-c)+(I-c),I=C-O,c=C-I,ct[1]=C-(I+c)+(c-O),d=$+I,c=d-$,ct[2]=$-(d-c)+(I-c),ct[3]=d;const p=rr(4,Se,4,ct,$o);P=g*h,f=ot*g,_=f-(f-g),S=g-_,f=ot*h,A=f-(f-h),N=h-A,k=S*N-(P-_*A-S*A-_*N),O=v*u,f=ot*v,_=f-(f-v),S=v-_,f=ot*u,A=f-(f-u),N=u-A,D=S*N-(O-_*A-S*A-_*N),I=k-D,c=k-I,ct[0]=k-(I+c)+(c-D),$=P+I,c=$-P,C=P-($-c)+(I-c),I=C-O,c=C-I,ct[1]=C-(I+c)+(c-O),d=$+I,c=d-$,ct[2]=$-(d-c)+(I-c),ct[3]=d;const m=rr(p,$o,4,ct,Ao);P=a*h,f=ot*a,_=f-(f-a),S=a-_,f=ot*h,A=f-(f-h),N=h-A,k=S*N-(P-_*A-S*A-_*N),O=l*u,f=ot*l,_=f-(f-l),S=l-_,f=ot*u,A=f-(f-u),N=u-A,D=S*N-(O-_*A-S*A-_*N),I=k-D,c=k-I,ct[0]=k-(I+c)+(c-D),$=P+I,c=$-P,C=P-($-c)+(I-c),I=C-O,c=C-I,ct[1]=C-(I+c)+(c-O),d=$+I,c=d-$,ct[2]=$-(d-c)+(I-c),ct[3]=d;const x=rr(m,Ao,4,ct,Io);return Io[x-1]}function On(e,t,n,i,r,s){const o=(t-s)*(n-r),a=(e-r)*(i-s),l=o-a,u=Math.abs(o+a);return Math.abs(l)>=$d*u?l:-Td(e,t,n,i,r,s,u)}const To=Math.pow(2,-52),Ln=new Uint32Array(512);class ui{static from(t,n=Od,i=Ld){const r=t.length,s=new Float64Array(r*2);for(let o=0;o<r;o++){const a=t[o];s[2*o]=n(a),s[2*o+1]=i(a)}return new ui(s)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const i=Math.max(2*n-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:i,_hullTri:r,_hullHash:s}=this,o=t.length>>1;let a=1/0,l=1/0,u=-1/0,h=-1/0;for(let g=0;g<o;g++){const w=t[2*g],v=t[2*g+1];w<a&&(a=w),v<l&&(l=v),w>u&&(u=w),v>h&&(h=v),this._ids[g]=g}const c=(a+u)/2,f=(l+h)/2;let _,S,A;for(let g=0,w=1/0;g<o;g++){const v=sr(c,f,t[2*g],t[2*g+1]);v<w&&(_=g,w=v)}const N=t[2*_],I=t[2*_+1];for(let g=0,w=1/0;g<o;g++){if(g===_)continue;const v=sr(N,I,t[2*g],t[2*g+1]);v<w&&v>0&&(S=g,w=v)}let $=t[2*S],C=t[2*S+1],P=1/0;for(let g=0;g<o;g++){if(g===_||g===S)continue;const w=Cd(N,I,$,C,t[2*g],t[2*g+1]);w<P&&(A=g,P=w)}let k=t[2*A],O=t[2*A+1];if(P===1/0){for(let v=0;v<o;v++)this._dists[v]=t[2*v]-t[0]||t[2*v+1]-t[1];Te(this._ids,this._dists,0,o-1);const g=new Uint32Array(o);let w=0;for(let v=0,b=-1/0;v<o;v++){const M=this._ids[v],y=this._dists[M];y>b&&(g[w++]=M,b=y)}this.hull=g.subarray(0,w),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(On(N,I,$,C,k,O)<0){const g=S,w=$,v=C;S=A,$=k,C=O,A=g,k=w,O=v}const D=kd(N,I,$,C,k,O);this._cx=D.x,this._cy=D.y;for(let g=0;g<o;g++)this._dists[g]=sr(t[2*g],t[2*g+1],D.x,D.y);Te(this._ids,this._dists,0,o-1),this._hullStart=_;let d=3;i[_]=n[A]=S,i[S]=n[_]=A,i[A]=n[S]=_,r[_]=0,r[S]=1,r[A]=2,s.fill(-1),s[this._hashKey(N,I)]=_,s[this._hashKey($,C)]=S,s[this._hashKey(k,O)]=A,this.trianglesLen=0,this._addTriangle(_,S,A,-1,-1,-1);for(let g=0,w,v;g<this._ids.length;g++){const b=this._ids[g],M=t[2*b],y=t[2*b+1];if(g>0&&Math.abs(M-w)<=To&&Math.abs(y-v)<=To||(w=M,v=y,b===_||b===S||b===A))continue;let p=0;for(let L=0,R=this._hashKey(M,y);L<this._hashSize&&(p=s[(R+L)%this._hashSize],!(p!==-1&&p!==i[p]));L++);p=n[p];let m=p,x;for(;x=i[m],On(M,y,t[2*m],t[2*m+1],t[2*x],t[2*x+1])>=0;)if(m=x,m===p){m=-1;break}if(m===-1)continue;let E=this._addTriangle(m,b,i[m],-1,-1,r[m]);r[b]=this._legalize(E+2),r[m]=E,d++;let T=i[m];for(;x=i[T],On(M,y,t[2*T],t[2*T+1],t[2*x],t[2*x+1])<0;)E=this._addTriangle(T,b,x,r[b],-1,r[T]),r[b]=this._legalize(E+2),i[T]=T,d--,T=x;if(m===p)for(;x=n[m],On(M,y,t[2*x],t[2*x+1],t[2*m],t[2*m+1])<0;)E=this._addTriangle(x,b,m,-1,r[m],r[x]),this._legalize(E+2),r[x]=E,i[m]=m,d--,m=x;this._hullStart=n[b]=m,i[m]=n[T]=b,i[b]=T,s[this._hashKey(M,y)]=b,s[this._hashKey(t[2*m],t[2*m+1])]=m}this.hull=new Uint32Array(d);for(let g=0,w=this._hullStart;g<d;g++)this.hull[g]=w,w=i[w];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(Nd(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:i,coords:r}=this;let s=0,o=0;for(;;){const a=i[t],l=t-t%3;if(o=l+(t+2)%3,a===-1){if(s===0)break;t=Ln[--s];continue}const u=a-a%3,h=l+(t+1)%3,c=u+(a+2)%3,f=n[o],_=n[t],S=n[h],A=n[c];if(Pd(r[2*f],r[2*f+1],r[2*_],r[2*_+1],r[2*S],r[2*S+1],r[2*A],r[2*A+1])){n[t]=A,n[a]=f;const I=i[c];if(I===-1){let C=this._hullStart;do{if(this._hullTri[C]===c){this._hullTri[C]=t;break}C=this._hullPrev[C]}while(C!==this._hullStart)}this._link(t,I),this._link(a,i[o]),this._link(o,c);const $=u+(a+1)%3;s<Ln.length&&(Ln[s++]=$)}else{if(s===0)break;t=Ln[--s]}}return o}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,i,r,s,o){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=n,this._triangles[a+2]=i,this._link(a,r),this._link(a+1,s),this._link(a+2,o),this.trianglesLen+=3,a}}function Nd(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function sr(e,t,n,i){const r=e-n,s=t-i;return r*r+s*s}function Pd(e,t,n,i,r,s,o,a){const l=e-o,u=t-a,h=n-o,c=i-a,f=r-o,_=s-a,S=l*l+u*u,A=h*h+c*c,N=f*f+_*_;return l*(c*N-A*_)-u*(h*N-A*f)+S*(h*_-c*f)<0}function Cd(e,t,n,i,r,s){const o=n-e,a=i-t,l=r-e,u=s-t,h=o*o+a*a,c=l*l+u*u,f=.5/(o*u-a*l),_=(u*h-a*c)*f,S=(o*c-l*h)*f;return _*_+S*S}function kd(e,t,n,i,r,s){const o=n-e,a=i-t,l=r-e,u=s-t,h=o*o+a*a,c=l*l+u*u,f=.5/(o*u-a*l),_=e+(u*h-a*c)*f,S=t+(o*c-l*h)*f;return{x:_,y:S}}function Te(e,t,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){const s=e[r],o=t[s];let a=r-1;for(;a>=n&&t[e[a]]>o;)e[a+1]=e[a--];e[a+1]=s}else{const r=n+i>>1;let s=n+1,o=i;Ve(e,r,s),t[e[n]]>t[e[i]]&&Ve(e,n,i),t[e[s]]>t[e[i]]&&Ve(e,s,i),t[e[n]]>t[e[s]]&&Ve(e,n,s);const a=e[s],l=t[a];for(;;){do s++;while(t[e[s]]<l);do o--;while(t[e[o]]>l);if(o<s)break;Ve(e,s,o)}e[n+1]=e[o],e[o]=a,i-s+1>=o-n?(Te(e,t,s,i),Te(e,t,n,o-1)):(Te(e,t,n,o-1),Te(e,t,s,i))}}function Ve(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function Od(e){return e[0]}function Ld(e){return e[1]}const No=1e-6;class de{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,i){t=+t,n=+n,i=+i;const r=t+i,s=n;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${r},${s}`:(Math.abs(this._x1-r)>No||Math.abs(this._y1-s)>No)&&(this._+="L"+r+","+s),i&&(this._+=`A${i},${i},0,1,1,${t-i},${n}A${i},${i},0,1,1,${this._x1=r},${this._y1=s}`)}rect(t,n,i,r){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+i}v${+r}h${-i}Z`}value(){return this._||null}}class $r{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}class Rd{constructor(t,[n,i,r,s]=[0,0,960,500]){if(!((r=+r)>=(n=+n))||!((s=+s)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=r,this.xmin=n,this.ymax=s,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:i},vectors:r}=this;let s,o;const a=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let A=0,N=0,I=i.length,$,C;A<I;A+=3,N+=2){const P=i[A]*2,k=i[A+1]*2,O=i[A+2]*2,D=t[P],d=t[P+1],g=t[k],w=t[k+1],v=t[O],b=t[O+1],M=g-D,y=w-d,p=v-D,m=b-d,x=(M*m-y*p)*2;if(Math.abs(x)<1e-9){if(s===void 0){s=o=0;for(const T of n)s+=t[T*2],o+=t[T*2+1];s/=n.length,o/=n.length}const E=1e9*Math.sign((s-D)*m-(o-d)*p);$=(D+v)/2-E*m,C=(d+b)/2+E*p}else{const E=1/x,T=M*M+y*y,L=p*p+m*m;$=D+(m*T-y*L)*E,C=d+(M*L-p*T)*E}a[N]=$,a[N+1]=C}let l=n[n.length-1],u,h=l*4,c,f=t[2*l],_,S=t[2*l+1];r.fill(0);for(let A=0;A<n.length;++A)l=n[A],u=h,c=f,_=S,h=l*4,f=t[2*l],S=t[2*l+1],r[u+2]=r[h]=_-S,r[u+3]=r[h+1]=f-c}render(t){const n=t==null?t=new de:void 0,{delaunay:{halfedges:i,inedges:r,hull:s},circumcenters:o,vectors:a}=this;if(s.length<=1)return null;for(let h=0,c=i.length;h<c;++h){const f=i[h];if(f<h)continue;const _=Math.floor(h/3)*2,S=Math.floor(f/3)*2,A=o[_],N=o[_+1],I=o[S],$=o[S+1];this._renderSegment(A,N,I,$,t)}let l,u=s[s.length-1];for(let h=0;h<s.length;++h){l=u,u=s[h];const c=Math.floor(r[u]/3)*2,f=o[c],_=o[c+1],S=l*4,A=this._project(f,_,a[S+2],a[S+3]);A&&this._renderSegment(f,_,A[0],A[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new de:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const i=n==null?n=new de:void 0,r=this._clip(t);if(r===null||!r.length)return;n.moveTo(r[0],r[1]);let s=r.length;for(;r[0]===r[s-2]&&r[1]===r[s-1]&&s>1;)s-=2;for(let o=2;o<s;o+=2)(r[o]!==r[o-2]||r[o+1]!==r[o-1])&&n.lineTo(r[o],r[o+1]);return n.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,i=t.length/2;n<i;++n){const r=this.cellPolygon(n);r&&(r.index=n,yield r)}}cellPolygon(t){const n=new $r;return this.renderCell(t,n),n.value()}_renderSegment(t,n,i,r,s){let o;const a=this._regioncode(t,n),l=this._regioncode(i,r);a===0&&l===0?(s.moveTo(t,n),s.lineTo(i,r)):(o=this._clipSegment(t,n,i,r,a,l))&&(s.moveTo(o[0],o[1]),s.lineTo(o[2],o[3]))}contains(t,n,i){return n=+n,n!==n||(i=+i,i!==i)?!1:this.delaunay._step(t,n,i)===t}*neighbors(t){const n=this._clip(t);if(n)for(const i of this.delaunay.neighbors(t)){const r=this._clip(i);if(r){t:for(let s=0,o=n.length;s<o;s+=2)for(let a=0,l=r.length;a<l;a+=2)if(n[s]===r[a]&&n[s+1]===r[a+1]&&n[(s+2)%o]===r[(a+l-2)%l]&&n[(s+3)%o]===r[(a+l-1)%l]){yield i;break t}}}}_cell(t){const{circumcenters:n,delaunay:{inedges:i,halfedges:r,triangles:s}}=this,o=i[t];if(o===-1)return null;const a=[];let l=o;do{const u=Math.floor(l/3);if(a.push(n[u*2],n[u*2+1]),l=l%3===2?l-2:l+1,s[l]!==t)break;l=r[l]}while(l!==o&&l!==-1);return a}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:i}=this,r=t*4;return this._simplify(i[r]||i[r+1]?this._clipInfinite(t,n,i[r],i[r+1],i[r+2],i[r+3]):this._clipFinite(t,n))}_clipFinite(t,n){const i=n.length;let r=null,s,o,a=n[i-2],l=n[i-1],u,h=this._regioncode(a,l),c,f=0;for(let _=0;_<i;_+=2)if(s=a,o=l,a=n[_],l=n[_+1],u=h,h=this._regioncode(a,l),u===0&&h===0)c=f,f=0,r?r.push(a,l):r=[a,l];else{let S,A,N,I,$;if(u===0){if((S=this._clipSegment(s,o,a,l,u,h))===null)continue;[A,N,I,$]=S}else{if((S=this._clipSegment(a,l,s,o,h,u))===null)continue;[I,$,A,N]=S,c=f,f=this._edgecode(A,N),c&&f&&this._edge(t,c,f,r,r.length),r?r.push(A,N):r=[A,N]}c=f,f=this._edgecode(I,$),c&&f&&this._edge(t,c,f,r,r.length),r?r.push(I,$):r=[I,$]}if(r)c=f,f=this._edgecode(r[0],r[1]),c&&f&&this._edge(t,c,f,r,r.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return r}_clipSegment(t,n,i,r,s,o){const a=s<o;for(a&&([t,n,i,r,s,o]=[i,r,t,n,o,s]);;){if(s===0&&o===0)return a?[i,r,t,n]:[t,n,i,r];if(s&o)return null;let l,u,h=s||o;h&8?(l=t+(i-t)*(this.ymax-n)/(r-n),u=this.ymax):h&4?(l=t+(i-t)*(this.ymin-n)/(r-n),u=this.ymin):h&2?(u=n+(r-n)*(this.xmax-t)/(i-t),l=this.xmax):(u=n+(r-n)*(this.xmin-t)/(i-t),l=this.xmin),s?(t=l,n=u,s=this._regioncode(t,n)):(i=l,r=u,o=this._regioncode(i,r))}}_clipInfinite(t,n,i,r,s,o){let a=Array.from(n),l;if((l=this._project(a[0],a[1],i,r))&&a.unshift(l[0],l[1]),(l=this._project(a[a.length-2],a[a.length-1],s,o))&&a.push(l[0],l[1]),a=this._clipFinite(t,a))for(let u=0,h=a.length,c,f=this._edgecode(a[h-2],a[h-1]);u<h;u+=2)c=f,f=this._edgecode(a[u],a[u+1]),c&&f&&(u=this._edge(t,c,f,a,u),h=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,n,i,r,s){for(;n!==i;){let o,a;switch(n){case 5:n=4;continue;case 4:n=6,o=this.xmax,a=this.ymin;break;case 6:n=2;continue;case 2:n=10,o=this.xmax,a=this.ymax;break;case 10:n=8;continue;case 8:n=9,o=this.xmin,a=this.ymax;break;case 9:n=1;continue;case 1:n=5,o=this.xmin,a=this.ymin;break}(r[s]!==o||r[s+1]!==a)&&this.contains(t,o,a)&&(r.splice(s,0,o,a),s+=2)}return s}_project(t,n,i,r){let s=1/0,o,a,l;if(r<0){if(n<=this.ymin)return null;(o=(this.ymin-n)/r)<s&&(l=this.ymin,a=t+(s=o)*i)}else if(r>0){if(n>=this.ymax)return null;(o=(this.ymax-n)/r)<s&&(l=this.ymax,a=t+(s=o)*i)}if(i>0){if(t>=this.xmax)return null;(o=(this.xmax-t)/i)<s&&(a=this.xmax,l=n+(s=o)*r)}else if(i<0){if(t<=this.xmin)return null;(o=(this.xmin-t)/i)<s&&(a=this.xmin,l=n+(s=o)*r)}return[a,l]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}_simplify(t){if(t&&t.length>4){for(let n=0;n<t.length;n+=2){const i=(n+2)%t.length,r=(n+4)%t.length;(t[n]===t[i]&&t[i]===t[r]||t[n+1]===t[i+1]&&t[i+1]===t[r+1])&&(t.splice(i,2),n-=2)}t.length||(t=null)}return t}}const Dd=2*Math.PI,Ee=Math.pow;function zd(e){return e[0]}function Bd(e){return e[1]}function Ud(e){const{triangles:t,coords:n}=e;for(let i=0;i<t.length;i+=3){const r=2*t[i],s=2*t[i+1],o=2*t[i+2];if((n[o]-n[r])*(n[s+1]-n[r+1])-(n[s]-n[r])*(n[o+1]-n[r+1])>1e-10)return!1}return!0}function Hd(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class xs{static from(t,n=zd,i=Bd,r){return new xs("length"in t?Fd(t,n,i,r):Float64Array.from(qd(t,n,i,r)))}constructor(t){this._delaunator=new ui(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&Ud(t)){this.collinear=Int32Array.from({length:n.length/2},(f,_)=>_).sort((f,_)=>n[2*f]-n[2*_]||n[2*f+1]-n[2*_+1]);const l=this.collinear[0],u=this.collinear[this.collinear.length-1],h=[n[2*l],n[2*l+1],n[2*u],n[2*u+1]],c=1e-8*Math.hypot(h[3]-h[1],h[2]-h[0]);for(let f=0,_=n.length/2;f<_;++f){const S=Hd(n[2*f],n[2*f+1],c);n[2*f]=S[0],n[2*f+1]=S[1]}this._delaunator=new ui(n)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let l=0,u=i.length;l<u;++l){const h=s[l%3===2?l-2:l+1];(i[l]===-1||o[h]===-1)&&(o[h]=l)}for(let l=0,u=r.length;l<u;++l)a[r[l]]=l;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],o[r[0]]=1,r.length===2&&(o[r[1]]=0,this.triangles[1]=r[1],this.triangles[2]=r[1]))}voronoi(t){return new Rd(this,t)}*neighbors(t){const{inedges:n,hull:i,_hullIndex:r,halfedges:s,triangles:o,collinear:a}=this;if(a){const c=a.indexOf(t);c>0&&(yield a[c-1]),c<a.length-1&&(yield a[c+1]);return}const l=n[t];if(l===-1)return;let u=l,h=-1;do{if(yield h=o[u],u=u%3===2?u-2:u+1,o[u]!==t)return;if(u=s[u],u===-1){const c=i[(r[t]+1)%i.length];c!==h&&(yield c);return}}while(u!==l)}find(t,n,i=0){if(t=+t,t!==t||(n=+n,n!==n))return-1;const r=i;let s;for(;(s=this._step(i,t,n))>=0&&s!==i&&s!==r;)i=s;return s}_step(t,n,i){const{inedges:r,hull:s,_hullIndex:o,halfedges:a,triangles:l,points:u}=this;if(r[t]===-1||!u.length)return(t+1)%(u.length>>1);let h=t,c=Ee(n-u[t*2],2)+Ee(i-u[t*2+1],2);const f=r[t];let _=f;do{let S=l[_];const A=Ee(n-u[S*2],2)+Ee(i-u[S*2+1],2);if(A<c&&(c=A,h=S),_=_%3===2?_-2:_+1,l[_]!==t)break;if(_=a[_],_===-1){if(_=s[(o[t]+1)%s.length],_!==S&&Ee(n-u[_*2],2)+Ee(i-u[_*2+1],2)<c)return _;break}}while(_!==f);return h}render(t){const n=t==null?t=new de:void 0,{points:i,halfedges:r,triangles:s}=this;for(let o=0,a=r.length;o<a;++o){const l=r[o];if(l<o)continue;const u=s[o]*2,h=s[l]*2;t.moveTo(i[u],i[u+1]),t.lineTo(i[h],i[h+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n){n===void 0&&(!t||typeof t.moveTo!="function")&&(n=t,t=null),n=n==null?2:+n;const i=t==null?t=new de:void 0,{points:r}=this;for(let s=0,o=r.length;s<o;s+=2){const a=r[s],l=r[s+1];t.moveTo(a+n,l),t.arc(a,l,n,0,Dd)}return i&&i.value()}renderHull(t){const n=t==null?t=new de:void 0,{hull:i,points:r}=this,s=i[0]*2,o=i.length;t.moveTo(r[s],r[s+1]);for(let a=1;a<o;++a){const l=2*i[a];t.lineTo(r[l],r[l+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new $r;return this.renderHull(t),t.value()}renderTriangle(t,n){const i=n==null?n=new de:void 0,{points:r,triangles:s}=this,o=s[t*=3]*2,a=s[t+1]*2,l=s[t+2]*2;return n.moveTo(r[o],r[o+1]),n.lineTo(r[a],r[a+1]),n.lineTo(r[l],r[l+1]),n.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,i=t.length/3;n<i;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new $r;return this.renderTriangle(t,n),n.value()}}function Fd(e,t,n,i){const r=e.length,s=new Float64Array(r*2);for(let o=0;o<r;++o){const a=e[o];s[o*2]=t.call(i,a,o,e),s[o*2+1]=n.call(i,a,o,e)}return s}function*qd(e,t,n,i){let r=0;for(const s of e)yield t.call(i,s,r,e),yield n.call(i,s,r,e),++r}function Gd(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function hi(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function Wd(e){return e=hi(Math.abs(e)),e?e[1]:NaN}function Yd(e,t){return function(n,i){for(var r=n.length,s=[],o=0,a=e[0],l=0;r>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),s.push(n.substring(r-=a,r+a)),!((l+=a+1)>i));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function Xd(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var Vd=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ar(e){if(!(t=Vd.exec(e)))throw new Error("invalid format: "+e);var t;return new bs({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Ar.prototype=bs.prototype;function bs(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}bs.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Kd(e){t:for(var t=e.length,n=1,i=-1,r;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+e[n])break t;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(r+1):e}var yl;function jd(e,t){var n=hi(e,t);if(!n)return e+"";var i=n[0],r=n[1],s=r-(yl=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+hi(e,Math.max(0,t+s-1))[0]}function Po(e,t){var n=hi(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const Co={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:Gd,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Po(e*100,t),r:Po,s:jd,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function ko(e){return e}var Oo=Array.prototype.map,Lo=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Qd(e){var t=e.grouping===void 0||e.thousands===void 0?ko:Yd(Oo.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?ko:Xd(Oo.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"−":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function u(c){c=Ar(c);var f=c.fill,_=c.align,S=c.sign,A=c.symbol,N=c.zero,I=c.width,$=c.comma,C=c.precision,P=c.trim,k=c.type;k==="n"?($=!0,k="g"):Co[k]||(C===void 0&&(C=12),P=!0,k="g"),(N||f==="0"&&_==="=")&&(N=!0,f="0",_="=");var O=A==="$"?n:A==="#"&&/[boxX]/.test(k)?"0"+k.toLowerCase():"",D=A==="$"?i:/[%p]/.test(k)?o:"",d=Co[k],g=/[defgprs%]/.test(k);C=C===void 0?6:/[gprs]/.test(k)?Math.max(1,Math.min(21,C)):Math.max(0,Math.min(20,C));function w(v){var b=O,M=D,y,p,m;if(k==="c")M=d(v)+M,v="";else{v=+v;var x=v<0||1/v<0;if(v=isNaN(v)?l:d(Math.abs(v),C),P&&(v=Kd(v)),x&&+v==0&&S!=="+"&&(x=!1),b=(x?S==="("?S:a:S==="-"||S==="("?"":S)+b,M=(k==="s"?Lo[8+yl/3]:"")+M+(x&&S==="("?")":""),g){for(y=-1,p=v.length;++y<p;)if(m=v.charCodeAt(y),48>m||m>57){M=(m===46?r+v.slice(y+1):v.slice(y))+M,v=v.slice(0,y);break}}}$&&!N&&(v=t(v,1/0));var E=b.length+v.length+M.length,T=E<I?new Array(I-E+1).join(f):"";switch($&&N&&(v=t(T+v,T.length?I-M.length:1/0),T=""),_){case"<":v=b+v+M+T;break;case"=":v=b+T+v+M;break;case"^":v=T.slice(0,E=T.length>>1)+b+v+M+T.slice(E);break;default:v=T+b+v+M;break}return s(v)}return w.toString=function(){return c+""},w}function h(c,f){var _=u((c=Ar(c),c.type="f",c)),S=Math.max(-8,Math.min(8,Math.floor(Wd(f)/3)))*3,A=Math.pow(10,-S),N=Lo[8+S/3];return function(I){return _(A*I)+N}}return{format:u,formatPrefix:h}}var Rn,Ss;Zd({thousands:",",grouping:[3],currency:["$",""]});function Zd(e){return Rn=Qd(e),Ss=Rn.format,Rn.formatPrefix,Rn}var Y=1e-6,Ir=1e-12,X=Math.PI,at=X/2,Ro=X/4,xt=X*2,ut=180/X,V=X/180,Q=Math.abs,Fi=Math.atan,Qt=Math.atan2,W=Math.cos,Dn=Math.ceil,_l=Math.exp,Tr=Math.hypot,wl=Math.log,q=Math.sin,Jd=Math.sign||function(e){return e>0?1:e<0?-1:0},Gt=Math.sqrt,vl=Math.tan;function tp(e){return e>1?0:e<-1?X:Math.acos(e)}function Zt(e){return e>1?at:e<-1?-at:Math.asin(e)}function nt(){}function fi(e,t){e&&zo.hasOwnProperty(e.type)&&zo[e.type](e,t)}var Do={Feature:function(e,t){fi(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)fi(n[i].geometry,t)}},zo={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){Nr(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)Nr(n[i],t,0)},Polygon:function(e,t){Bo(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)Bo(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)fi(n[i],t)}};function Nr(e,t,n){var i=-1,r=e.length-n,s;for(t.lineStart();++i<r;)s=e[i],t.point(s[0],s[1],s[2]);t.lineEnd()}function Bo(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)Nr(e[n],t,1);t.polygonEnd()}function ie(e,t){e&&Do.hasOwnProperty(e.type)?Do[e.type](e,t):fi(e,t)}function Pr(e){return[Qt(e[1],e[0]),Zt(e[2])]}function Re(e){var t=e[0],n=e[1],i=W(n);return[i*W(t),i*q(t),q(n)]}function zn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function di(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function or(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Bn(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Cr(e){var t=Gt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var Ze,pi,gi,mi,yi,_i,wi,vi,kr,Or,Lr,xl,bl,ht,ft,dt,Ct={sphere:nt,point:Es,lineStart:Uo,lineEnd:Ho,polygonStart:function(){Ct.lineStart=ip,Ct.lineEnd=rp},polygonEnd:function(){Ct.lineStart=Uo,Ct.lineEnd=Ho}};function Es(e,t){e*=V,t*=V;var n=W(t);Mn(n*W(e),n*q(e),q(t))}function Mn(e,t,n){++Ze,gi+=(e-gi)/Ze,mi+=(t-mi)/Ze,yi+=(n-yi)/Ze}function Uo(){Ct.point=ep}function ep(e,t){e*=V,t*=V;var n=W(t);ht=n*W(e),ft=n*q(e),dt=q(t),Ct.point=np,Mn(ht,ft,dt)}function np(e,t){e*=V,t*=V;var n=W(t),i=n*W(e),r=n*q(e),s=q(t),o=Qt(Gt((o=ft*s-dt*r)*o+(o=dt*i-ht*s)*o+(o=ht*r-ft*i)*o),ht*i+ft*r+dt*s);pi+=o,_i+=o*(ht+(ht=i)),wi+=o*(ft+(ft=r)),vi+=o*(dt+(dt=s)),Mn(ht,ft,dt)}function Ho(){Ct.point=Es}function ip(){Ct.point=sp}function rp(){Sl(xl,bl),Ct.point=Es}function sp(e,t){xl=e,bl=t,e*=V,t*=V,Ct.point=Sl;var n=W(t);ht=n*W(e),ft=n*q(e),dt=q(t),Mn(ht,ft,dt)}function Sl(e,t){e*=V,t*=V;var n=W(t),i=n*W(e),r=n*q(e),s=q(t),o=ft*s-dt*r,a=dt*i-ht*s,l=ht*r-ft*i,u=Tr(o,a,l),h=Zt(u),c=u&&-h/u;kr.add(c*o),Or.add(c*a),Lr.add(c*l),pi+=h,_i+=h*(ht+(ht=i)),wi+=h*(ft+(ft=r)),vi+=h*(dt+(dt=s)),Mn(ht,ft,dt)}function Fo(e){Ze=pi=gi=mi=yi=_i=wi=vi=0,kr=new kt,Or=new kt,Lr=new kt,ie(e,Ct);var t=+kr,n=+Or,i=+Lr,r=Tr(t,n,i);return r<Ir&&(t=_i,n=wi,i=vi,pi<Y&&(t=gi,n=mi,i=yi),r=Tr(t,n,i),r<Ir)?[NaN,NaN]:[Qt(n,t)*ut,Zt(i/r)*ut]}function Rr(e,t){function n(i,r){return i=e(i,r),t(i[0],i[1])}return e.invert&&t.invert&&(n.invert=function(i,r){return i=t.invert(i,r),i&&e.invert(i[0],i[1])}),n}function Dr(e,t){return Q(e)>X&&(e-=Math.round(e/xt)*xt),[e,t]}Dr.invert=Dr;function El(e,t,n){return(e%=xt)?t||n?Rr(Go(e),Wo(t,n)):Go(e):t||n?Wo(t,n):Dr}function qo(e){return function(t,n){return t+=e,Q(t)>X&&(t-=Math.round(t/xt)*xt),[t,n]}}function Go(e){var t=qo(e);return t.invert=qo(-e),t}function Wo(e,t){var n=W(e),i=q(e),r=W(t),s=q(t);function o(a,l){var u=W(l),h=W(a)*u,c=q(a)*u,f=q(l),_=f*n+h*i;return[Qt(c*r-_*s,h*n-f*i),Zt(_*r+c*s)]}return o.invert=function(a,l){var u=W(l),h=W(a)*u,c=q(a)*u,f=q(l),_=f*r-c*s;return[Qt(c*r+f*s,h*n+_*i),Zt(_*n-h*i)]},o}function xi(e){e=El(e[0]*V,e[1]*V,e.length>2?e[2]*V:0);function t(n){return n=e(n[0]*V,n[1]*V),n[0]*=ut,n[1]*=ut,n}return t.invert=function(n){return n=e.invert(n[0]*V,n[1]*V),n[0]*=ut,n[1]*=ut,n},t}function op(e,t,n,i,r,s){if(n){var o=W(t),a=q(t),l=i*n;r==null?(r=t+i*xt,s=t-l/2):(r=Yo(o,r),s=Yo(o,s),(i>0?r<s:r>s)&&(r+=i*xt));for(var u,h=r;i>0?h>s:h<s;h-=l)u=Pr([o,-a*W(h),-a*q(h)]),e.point(u[0],u[1])}}function Yo(e,t){t=Re(t),t[0]-=e,Cr(t);var n=tp(-t[1]);return((-t[2]<0?-n:n)+xt-Y)%xt}function Ml(){var e=[],t;return{point:function(n,i,r){t.push([n,i,r])},lineStart:function(){e.push(t=[])},lineEnd:nt,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function jn(e,t){return Q(e[0]-t[0])<Y&&Q(e[1]-t[1])<Y}function Un(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function $l(e,t,n,i,r){var s=[],o=[],a,l;if(e.forEach(function(S){if(!((A=S.length-1)<=0)){var A,N=S[0],I=S[A],$;if(jn(N,I)){if(!N[2]&&!I[2]){for(r.lineStart(),a=0;a<A;++a)r.point((N=S[a])[0],N[1]);r.lineEnd();return}I[0]+=2*Y}s.push($=new Un(N,S,null,!0)),o.push($.o=new Un(N,null,$,!1)),s.push($=new Un(I,S,null,!1)),o.push($.o=new Un(I,null,$,!0))}}),!!s.length){for(o.sort(t),Xo(s),Xo(o),a=0,l=o.length;a<l;++a)o[a].e=n=!n;for(var u=s[0],h,c;;){for(var f=u,_=!0;f.v;)if((f=f.n)===u)return;h=f.z,r.lineStart();do{if(f.v=f.o.v=!0,f.e){if(_)for(a=0,l=h.length;a<l;++a)r.point((c=h[a])[0],c[1]);else i(f.x,f.n.x,1,r);f=f.n}else{if(_)for(h=f.p.z,a=h.length-1;a>=0;--a)r.point((c=h[a])[0],c[1]);else i(f.x,f.p.x,-1,r);f=f.p}f=f.o,h=f.z,_=!_}while(!f.v);r.lineEnd()}}}function Xo(e){if(t=e.length){for(var t,n=0,i=e[0],r;++n<t;)i.n=r=e[n],r.p=i,i=r;i.n=r=e[0],r.p=i}}function ar(e){return Q(e[0])<=X?e[0]:Jd(e[0])*((Q(e[0])+X)%xt-X)}function ap(e,t){var n=ar(t),i=t[1],r=q(i),s=[q(n),-W(n),0],o=0,a=0,l=new kt;r===1?i=at+Y:r===-1&&(i=-at-Y);for(var u=0,h=e.length;u<h;++u)if(f=(c=e[u]).length)for(var c,f,_=c[f-1],S=ar(_),A=_[1]/2+Ro,N=q(A),I=W(A),$=0;$<f;++$,S=P,N=O,I=D,_=C){var C=c[$],P=ar(C),k=C[1]/2+Ro,O=q(k),D=W(k),d=P-S,g=d>=0?1:-1,w=g*d,v=w>X,b=N*O;if(l.add(Qt(b*g*q(w),I*D+b*W(w))),o+=v?d+g*xt:d,v^S>=n^P>=n){var M=di(Re(_),Re(C));Cr(M);var y=di(s,M);Cr(y);var p=(v^d>=0?-1:1)*Zt(y[2]);(i>p||i===p&&(M[0]||M[1]))&&(a+=v^d>=0?1:-1)}}return(o<-Y||o<Y&&l<-Ir)^a&1}function Al(e,t,n,i){return function(r){var s=t(r),o=Ml(),a=t(o),l=!1,u,h,c,f={point:_,lineStart:A,lineEnd:N,polygonStart:function(){f.point=I,f.lineStart=$,f.lineEnd=C,h=[],u=[]},polygonEnd:function(){f.point=_,f.lineStart=A,f.lineEnd=N,h=Fa(h);var P=ap(u,i);h.length?(l||(r.polygonStart(),l=!0),$l(h,cp,P,n,r)):P&&(l||(r.polygonStart(),l=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),l&&(r.polygonEnd(),l=!1),h=u=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function _(P,k){e(P,k)&&r.point(P,k)}function S(P,k){s.point(P,k)}function A(){f.point=S,s.lineStart()}function N(){f.point=_,s.lineEnd()}function I(P,k){c.push([P,k]),a.point(P,k)}function $(){a.lineStart(),c=[]}function C(){I(c[0][0],c[0][1]),a.lineEnd();var P=a.clean(),k=o.result(),O,D=k.length,d,g,w;if(c.pop(),u.push(c),c=null,!!D){if(P&1){if(g=k[0],(d=g.length-1)>0){for(l||(r.polygonStart(),l=!0),r.lineStart(),O=0;O<d;++O)r.point((w=g[O])[0],w[1]);r.lineEnd()}return}D>1&&P&2&&k.push(k.pop().concat(k.shift())),h.push(k.filter(lp))}}return f}}function lp(e){return e.length>1}function cp(e,t){return((e=e.x)[0]<0?e[1]-at-Y:at-e[1])-((t=t.x)[0]<0?t[1]-at-Y:at-t[1])}const Vo=Al(function(){return!0},up,fp,[-X,-at]);function up(e){var t=NaN,n=NaN,i=NaN,r;return{lineStart:function(){e.lineStart(),r=1},point:function(s,o){var a=s>0?X:-X,l=Q(s-t);Q(l-X)<Y?(e.point(t,n=(n+o)/2>0?at:-at),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(a,n),e.point(s,n),r=0):i!==a&&l>=X&&(Q(t-i)<Y&&(t-=i*Y),Q(s-a)<Y&&(s-=a*Y),n=hp(t,n,s,o),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(a,n),r=0),e.point(t=s,n=o),i=a},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-r}}}function hp(e,t,n,i){var r,s,o=q(e-n);return Q(o)>Y?Fi((q(t)*(s=W(i))*q(n)-q(i)*(r=W(t))*q(e))/(r*s*o)):(t+i)/2}function fp(e,t,n,i){var r;if(e==null)r=n*at,i.point(-X,r),i.point(0,r),i.point(X,r),i.point(X,0),i.point(X,-r),i.point(0,-r),i.point(-X,-r),i.point(-X,0),i.point(-X,r);else if(Q(e[0]-t[0])>Y){var s=e[0]<t[0]?X:-X;r=n*s/2,i.point(-s,r),i.point(0,r),i.point(s,r)}else i.point(t[0],t[1])}function dp(e){var t=W(e),n=2*V,i=t>0,r=Q(t)>Y;function s(h,c,f,_){op(_,e,n,f,h,c)}function o(h,c){return W(h)*W(c)>t}function a(h){var c,f,_,S,A;return{lineStart:function(){S=_=!1,A=1},point:function(N,I){var $=[N,I],C,P=o(N,I),k=i?P?0:u(N,I):P?u(N+(N<0?X:-X),I):0;if(!c&&(S=_=P)&&h.lineStart(),P!==_&&(C=l(c,$),(!C||jn(c,C)||jn($,C))&&($[2]=1)),P!==_)A=0,P?(h.lineStart(),C=l($,c),h.point(C[0],C[1])):(C=l(c,$),h.point(C[0],C[1],2),h.lineEnd()),c=C;else if(r&&c&&i^P){var O;!(k&f)&&(O=l($,c,!0))&&(A=0,i?(h.lineStart(),h.point(O[0][0],O[0][1]),h.point(O[1][0],O[1][1]),h.lineEnd()):(h.point(O[1][0],O[1][1]),h.lineEnd(),h.lineStart(),h.point(O[0][0],O[0][1],3)))}P&&(!c||!jn(c,$))&&h.point($[0],$[1]),c=$,_=P,f=k},lineEnd:function(){_&&h.lineEnd(),c=null},clean:function(){return A|(S&&_)<<1}}}function l(h,c,f){var _=Re(h),S=Re(c),A=[1,0,0],N=di(_,S),I=zn(N,N),$=N[0],C=I-$*$;if(!C)return!f&&h;var P=t*I/C,k=-t*$/C,O=di(A,N),D=Bn(A,P),d=Bn(N,k);or(D,d);var g=O,w=zn(D,g),v=zn(g,g),b=w*w-v*(zn(D,D)-1);if(!(b<0)){var M=Gt(b),y=Bn(g,(-w-M)/v);if(or(y,D),y=Pr(y),!f)return y;var p=h[0],m=c[0],x=h[1],E=c[1],T;m<p&&(T=p,p=m,m=T);var L=m-p,R=Q(L-X)<Y,z=R||L<Y;if(!R&&E<x&&(T=x,x=E,E=T),z?R?x+E>0^y[1]<(Q(y[0]-p)<Y?x:E):x<=y[1]&&y[1]<=E:L>X^(p<=y[0]&&y[0]<=m)){var U=Bn(g,(-w+M)/v);return or(U,D),[y,Pr(U)]}}}function u(h,c){var f=i?e:X-e,_=0;return h<-f?_|=1:h>f&&(_|=2),c<-f?_|=4:c>f&&(_|=8),_}return Al(o,a,s,i?[0,-e]:[-X,e-X])}function pp(e,t,n,i,r,s){var o=e[0],a=e[1],l=t[0],u=t[1],h=0,c=1,f=l-o,_=u-a,S;if(S=n-o,!(!f&&S>0)){if(S/=f,f<0){if(S<h)return;S<c&&(c=S)}else if(f>0){if(S>c)return;S>h&&(h=S)}if(S=r-o,!(!f&&S<0)){if(S/=f,f<0){if(S>c)return;S>h&&(h=S)}else if(f>0){if(S<h)return;S<c&&(c=S)}if(S=i-a,!(!_&&S>0)){if(S/=_,_<0){if(S<h)return;S<c&&(c=S)}else if(_>0){if(S>c)return;S>h&&(h=S)}if(S=s-a,!(!_&&S<0)){if(S/=_,_<0){if(S>c)return;S>h&&(h=S)}else if(_>0){if(S<h)return;S<c&&(c=S)}return h>0&&(e[0]=o+h*f,e[1]=a+h*_),c<1&&(t[0]=o+c*f,t[1]=a+c*_),!0}}}}}var Je=1e9,Hn=-Je;function gp(e,t,n,i){function r(u,h){return e<=u&&u<=n&&t<=h&&h<=i}function s(u,h,c,f){var _=0,S=0;if(u==null||(_=o(u,c))!==(S=o(h,c))||l(u,h)<0^c>0)do f.point(_===0||_===3?e:n,_>1?i:t);while((_=(_+c+4)%4)!==S);else f.point(h[0],h[1])}function o(u,h){return Q(u[0]-e)<Y?h>0?0:3:Q(u[0]-n)<Y?h>0?2:1:Q(u[1]-t)<Y?h>0?1:0:h>0?3:2}function a(u,h){return l(u.x,h.x)}function l(u,h){var c=o(u,1),f=o(h,1);return c!==f?c-f:c===0?h[1]-u[1]:c===1?u[0]-h[0]:c===2?u[1]-h[1]:h[0]-u[0]}return function(u){var h=u,c=Ml(),f,_,S,A,N,I,$,C,P,k,O,D={point:d,lineStart:b,lineEnd:M,polygonStart:w,polygonEnd:v};function d(p,m){r(p,m)&&h.point(p,m)}function g(){for(var p=0,m=0,x=_.length;m<x;++m)for(var E=_[m],T=1,L=E.length,R=E[0],z,U,F=R[0],B=R[1];T<L;++T)z=F,U=B,R=E[T],F=R[0],B=R[1],U<=i?B>i&&(F-z)*(i-U)>(B-U)*(e-z)&&++p:B<=i&&(F-z)*(i-U)<(B-U)*(e-z)&&--p;return p}function w(){h=c,f=[],_=[],O=!0}function v(){var p=g(),m=O&&p,x=(f=Fa(f)).length;(m||x)&&(u.polygonStart(),m&&(u.lineStart(),s(null,null,1,u),u.lineEnd()),x&&$l(f,a,p,s,u),u.polygonEnd()),h=u,f=_=S=null}function b(){D.point=y,_&&_.push(S=[]),k=!0,P=!1,$=C=NaN}function M(){f&&(y(A,N),I&&P&&c.rejoin(),f.push(c.result())),D.point=d,P&&h.lineEnd()}function y(p,m){var x=r(p,m);if(_&&S.push([p,m]),k)A=p,N=m,I=x,k=!1,x&&(h.lineStart(),h.point(p,m));else if(x&&P)h.point(p,m);else{var E=[$=Math.max(Hn,Math.min(Je,$)),C=Math.max(Hn,Math.min(Je,C))],T=[p=Math.max(Hn,Math.min(Je,p)),m=Math.max(Hn,Math.min(Je,m))];pp(E,T,e,t,n,i)?(P||(h.lineStart(),h.point(E[0],E[1])),h.point(T[0],T[1]),x||h.lineEnd(),O=!1):x&&(h.lineStart(),h.point(p,m),O=!1)}$=p,C=m,P=x}return D}}var zr,Br,Qn,Zn,De={sphere:nt,point:nt,lineStart:mp,lineEnd:nt,polygonStart:nt,polygonEnd:nt};function mp(){De.point=_p,De.lineEnd=yp}function yp(){De.point=De.lineEnd=nt}function _p(e,t){e*=V,t*=V,Br=e,Qn=q(t),Zn=W(t),De.point=wp}function wp(e,t){e*=V,t*=V;var n=q(t),i=W(t),r=Q(e-Br),s=W(r),o=q(r),a=i*o,l=Zn*n-Qn*i*s,u=Qn*n+Zn*i*s;zr.add(Qt(Gt(a*a+l*l),u)),Br=e,Qn=n,Zn=i}function vp(e){return zr=new kt,ie(e,De),+zr}var Ur=[null,null],xp={type:"LineString",coordinates:Ur};function bi(e,t){return Ur[0]=e,Ur[1]=t,vp(xp)}function Ko(e,t,n){var i=Ie(e,t-Y,n).concat(t);return function(r){return i.map(function(s){return[r,s]})}}function jo(e,t,n){var i=Ie(e,t-Y,n).concat(t);return function(r){return i.map(function(s){return[s,r]})}}function bp(){var e,t,n,i,r,s,o,a,l=10,u=l,h=90,c=360,f,_,S,A,N=2.5;function I(){return{type:"MultiLineString",coordinates:$()}}function $(){return Ie(Dn(i/h)*h,n,h).map(S).concat(Ie(Dn(a/c)*c,o,c).map(A)).concat(Ie(Dn(t/l)*l,e,l).filter(function(C){return Q(C%h)>Y}).map(f)).concat(Ie(Dn(s/u)*u,r,u).filter(function(C){return Q(C%c)>Y}).map(_))}return I.lines=function(){return $().map(function(C){return{type:"LineString",coordinates:C}})},I.outline=function(){return{type:"Polygon",coordinates:[S(i).concat(A(o).slice(1),S(n).reverse().slice(1),A(a).reverse().slice(1))]}},I.extent=function(C){return arguments.length?I.extentMajor(C).extentMinor(C):I.extentMinor()},I.extentMajor=function(C){return arguments.length?(i=+C[0][0],n=+C[1][0],a=+C[0][1],o=+C[1][1],i>n&&(C=i,i=n,n=C),a>o&&(C=a,a=o,o=C),I.precision(N)):[[i,a],[n,o]]},I.extentMinor=function(C){return arguments.length?(t=+C[0][0],e=+C[1][0],s=+C[0][1],r=+C[1][1],t>e&&(C=t,t=e,e=C),s>r&&(C=s,s=r,r=C),I.precision(N)):[[t,s],[e,r]]},I.step=function(C){return arguments.length?I.stepMajor(C).stepMinor(C):I.stepMinor()},I.stepMajor=function(C){return arguments.length?(h=+C[0],c=+C[1],I):[h,c]},I.stepMinor=function(C){return arguments.length?(l=+C[0],u=+C[1],I):[l,u]},I.precision=function(C){return arguments.length?(N=+C,f=Ko(s,r,90),_=jo(t,e,N),S=Ko(a,o,90),A=jo(i,n,N),I):N},I.extentMajor([[-180,-90+Y],[180,90-Y]]).extentMinor([[-180,-80-Y],[180,80+Y]])}const Hr=e=>e;var lr=new kt,Fr=new kt,Il,Tl,qr,Gr,Xt={point:nt,lineStart:nt,lineEnd:nt,polygonStart:function(){Xt.lineStart=Sp,Xt.lineEnd=Mp},polygonEnd:function(){Xt.lineStart=Xt.lineEnd=Xt.point=nt,lr.add(Q(Fr)),Fr=new kt},result:function(){var e=lr/2;return lr=new kt,e}};function Sp(){Xt.point=Ep}function Ep(e,t){Xt.point=Nl,Il=qr=e,Tl=Gr=t}function Nl(e,t){Fr.add(Gr*e-qr*t),qr=e,Gr=t}function Mp(){Nl(Il,Tl)}var ze=1/0,Si=ze,mn=-ze,Ei=mn,Mi={point:$p,lineStart:nt,lineEnd:nt,polygonStart:nt,polygonEnd:nt,result:function(){var e=[[ze,Si],[mn,Ei]];return mn=Ei=-(Si=ze=1/0),e}};function $p(e,t){e<ze&&(ze=e),e>mn&&(mn=e),t<Si&&(Si=t),t>Ei&&(Ei=t)}var Wr=0,Yr=0,tn=0,$i=0,Ai=0,Ne=0,Xr=0,Vr=0,en=0,Pl,Cl,Dt,zt,At={point:xe,lineStart:Qo,lineEnd:Zo,polygonStart:function(){At.lineStart=Tp,At.lineEnd=Np},polygonEnd:function(){At.point=xe,At.lineStart=Qo,At.lineEnd=Zo},result:function(){var e=en?[Xr/en,Vr/en]:Ne?[$i/Ne,Ai/Ne]:tn?[Wr/tn,Yr/tn]:[NaN,NaN];return Wr=Yr=tn=$i=Ai=Ne=Xr=Vr=en=0,e}};function xe(e,t){Wr+=e,Yr+=t,++tn}function Qo(){At.point=Ap}function Ap(e,t){At.point=Ip,xe(Dt=e,zt=t)}function Ip(e,t){var n=e-Dt,i=t-zt,r=Gt(n*n+i*i);$i+=r*(Dt+e)/2,Ai+=r*(zt+t)/2,Ne+=r,xe(Dt=e,zt=t)}function Zo(){At.point=xe}function Tp(){At.point=Pp}function Np(){kl(Pl,Cl)}function Pp(e,t){At.point=kl,xe(Pl=Dt=e,Cl=zt=t)}function kl(e,t){var n=e-Dt,i=t-zt,r=Gt(n*n+i*i);$i+=r*(Dt+e)/2,Ai+=r*(zt+t)/2,Ne+=r,r=zt*e-Dt*t,Xr+=r*(Dt+e),Vr+=r*(zt+t),en+=r*3,xe(Dt=e,zt=t)}function Ol(e){this._context=e}Ol.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,xt);break}}},result:nt};var Kr=new kt,cr,Ll,Rl,nn,rn,yn={point:nt,lineStart:function(){yn.point=Cp},lineEnd:function(){cr&&Dl(Ll,Rl),yn.point=nt},polygonStart:function(){cr=!0},polygonEnd:function(){cr=null},result:function(){var e=+Kr;return Kr=new kt,e}};function Cp(e,t){yn.point=Dl,Ll=nn=e,Rl=rn=t}function Dl(e,t){nn-=e,rn-=t,Kr.add(Gt(nn*nn+rn*rn)),nn=e,rn=t}let Jo,Ii,ta,ea;class na{constructor(t){this._append=t==null?zl:kp(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,n){switch(this._point){case 0:{this._append`M${t},${n}`,this._point=1;break}case 1:{this._append`L${t},${n}`;break}default:{if(this._append`M${t},${n}`,this._radius!==ta||this._append!==Ii){const i=this._radius,r=this._;this._="",this._append`m0,${i}a${i},${i} 0 1,1 0,${-2*i}a${i},${i} 0 1,1 0,${2*i}z`,ta=i,Ii=this._append,ea=this._,this._=r}this._+=ea;break}}}result(){const t=this._;return this._="",t.length?t:null}}function zl(e){let t=1;this._+=e[0];for(const n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function kp(e){const t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return zl;if(t!==Jo){const n=10**t;Jo=t,Ii=function(r){let s=1;this._+=r[0];for(const o=r.length;s<o;++s)this._+=Math.round(arguments[s]*n)/n+r[s]}}return Ii}function Ms(e,t){let n=3,i=4.5,r,s;function o(a){return a&&(typeof i=="function"&&s.pointRadius(+i.apply(this,arguments)),ie(a,r(s))),s.result()}return o.area=function(a){return ie(a,r(Xt)),Xt.result()},o.measure=function(a){return ie(a,r(yn)),yn.result()},o.bounds=function(a){return ie(a,r(Mi)),Mi.result()},o.centroid=function(a){return ie(a,r(At)),At.result()},o.projection=function(a){return arguments.length?(r=a==null?(e=null,Hr):(e=a).stream,o):e},o.context=function(a){return arguments.length?(s=a==null?(t=null,new na(n)):new Ol(t=a),typeof i!="function"&&s.pointRadius(i),o):t},o.pointRadius=function(a){return arguments.length?(i=typeof a=="function"?a:(s.pointRadius(+a),+a),o):i},o.digits=function(a){if(!arguments.length)return n;if(a==null)n=null;else{const l=Math.floor(a);if(!(l>=0))throw new RangeError(`invalid digits: ${a}`);n=l}return t===null&&(s=new na(n)),o},o.projection(e).digits(n).context(t)}function $s(e){return function(t){var n=new jr;for(var i in e)n[i]=e[i];return n.stream=t,n}}function jr(){}jr.prototype={constructor:jr,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function As(e,t,n){var i=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),i!=null&&e.clipExtent(null),ie(n,e.stream(Mi)),t(Mi.result()),i!=null&&e.clipExtent(i),e}function Bl(e,t,n){return As(e,function(i){var r=t[1][0]-t[0][0],s=t[1][1]-t[0][1],o=Math.min(r/(i[1][0]-i[0][0]),s/(i[1][1]-i[0][1])),a=+t[0][0]+(r-o*(i[1][0]+i[0][0]))/2,l=+t[0][1]+(s-o*(i[1][1]+i[0][1]))/2;e.scale(150*o).translate([a,l])},n)}function Op(e,t,n){return Bl(e,[[0,0],t],n)}function Lp(e,t,n){return As(e,function(i){var r=+t,s=r/(i[1][0]-i[0][0]),o=(r-s*(i[1][0]+i[0][0]))/2,a=-s*i[0][1];e.scale(150*s).translate([o,a])},n)}function Rp(e,t,n){return As(e,function(i){var r=+t,s=r/(i[1][1]-i[0][1]),o=-s*i[0][0],a=(r-s*(i[1][1]+i[0][1]))/2;e.scale(150*s).translate([o,a])},n)}var ia=16,Dp=W(30*V);function ra(e,t){return+t?Bp(e,t):zp(e)}function zp(e){return $s({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function Bp(e,t){function n(i,r,s,o,a,l,u,h,c,f,_,S,A,N){var I=u-i,$=h-r,C=I*I+$*$;if(C>4*t&&A--){var P=o+f,k=a+_,O=l+S,D=Gt(P*P+k*k+O*O),d=Zt(O/=D),g=Q(Q(O)-1)<Y||Q(s-c)<Y?(s+c)/2:Qt(k,P),w=e(g,d),v=w[0],b=w[1],M=v-i,y=b-r,p=$*M-I*y;(p*p/C>t||Q((I*M+$*y)/C-.5)>.3||o*f+a*_+l*S<Dp)&&(n(i,r,s,o,a,l,v,b,g,P/=D,k/=D,O,A,N),N.point(v,b),n(v,b,g,P,k,O,u,h,c,f,_,S,A,N))}}return function(i){var r,s,o,a,l,u,h,c,f,_,S,A,N={point:I,lineStart:$,lineEnd:P,polygonStart:function(){i.polygonStart(),N.lineStart=k},polygonEnd:function(){i.polygonEnd(),N.lineStart=$}};function I(d,g){d=e(d,g),i.point(d[0],d[1])}function $(){c=NaN,N.point=C,i.lineStart()}function C(d,g){var w=Re([d,g]),v=e(d,g);n(c,f,h,_,S,A,c=v[0],f=v[1],h=d,_=w[0],S=w[1],A=w[2],ia,i),i.point(c,f)}function P(){N.point=I,i.lineEnd()}function k(){$(),N.point=O,N.lineEnd=D}function O(d,g){C(r=d,g),s=c,o=f,a=_,l=S,u=A,N.point=C}function D(){n(c,f,h,_,S,A,s,o,r,a,l,u,ia,i),N.lineEnd=P,P()}return N}}var Up=$s({point:function(e,t){this.stream.point(e*V,t*V)}});function Hp(e){return $s({point:function(t,n){var i=e(t,n);return this.stream.point(i[0],i[1])}})}function Fp(e,t,n,i,r){function s(o,a){return o*=i,a*=r,[t+e*o,n-e*a]}return s.invert=function(o,a){return[(o-t)/e*i,(n-a)/e*r]},s}function sa(e,t,n,i,r,s){if(!s)return Fp(e,t,n,i,r);var o=W(s),a=q(s),l=o*e,u=a*e,h=o/e,c=a/e,f=(a*n-o*t)/e,_=(a*t+o*n)/e;function S(A,N){return A*=i,N*=r,[l*A-u*N+t,n-u*A-l*N]}return S.invert=function(A,N){return[i*(h*A-c*N+f),r*(_-c*A-h*N)]},S}function Is(e){return qp(function(){return e})()}function qp(e){var t,n=150,i=480,r=250,s=0,o=0,a=0,l=0,u=0,h,c=0,f=1,_=1,S=null,A=Vo,N=null,I,$,C,P=Hr,k=.5,O,D,d,g,w;function v(p){return d(p[0]*V,p[1]*V)}function b(p){return p=d.invert(p[0],p[1]),p&&[p[0]*ut,p[1]*ut]}v.stream=function(p){return g&&w===p?g:g=Up(Hp(h)(A(O(P(w=p)))))},v.preclip=function(p){return arguments.length?(A=p,S=void 0,y()):A},v.postclip=function(p){return arguments.length?(P=p,N=I=$=C=null,y()):P},v.clipAngle=function(p){return arguments.length?(A=+p?dp(S=p*V):(S=null,Vo),y()):S*ut},v.clipExtent=function(p){return arguments.length?(P=p==null?(N=I=$=C=null,Hr):gp(N=+p[0][0],I=+p[0][1],$=+p[1][0],C=+p[1][1]),y()):N==null?null:[[N,I],[$,C]]},v.scale=function(p){return arguments.length?(n=+p,M()):n},v.translate=function(p){return arguments.length?(i=+p[0],r=+p[1],M()):[i,r]},v.center=function(p){return arguments.length?(s=p[0]%360*V,o=p[1]%360*V,M()):[s*ut,o*ut]},v.rotate=function(p){return arguments.length?(a=p[0]%360*V,l=p[1]%360*V,u=p.length>2?p[2]%360*V:0,M()):[a*ut,l*ut,u*ut]},v.angle=function(p){return arguments.length?(c=p%360*V,M()):c*ut},v.reflectX=function(p){return arguments.length?(f=p?-1:1,M()):f<0},v.reflectY=function(p){return arguments.length?(_=p?-1:1,M()):_<0},v.precision=function(p){return arguments.length?(O=ra(D,k=p*p),y()):Gt(k)},v.fitExtent=function(p,m){return Bl(v,p,m)},v.fitSize=function(p,m){return Op(v,p,m)},v.fitWidth=function(p,m){return Lp(v,p,m)},v.fitHeight=function(p,m){return Rp(v,p,m)};function M(){var p=sa(n,0,0,f,_,c).apply(null,t(s,o)),m=sa(n,i-p[0],r-p[1],f,_,c);return h=El(a,l,u),D=Rr(t,m),d=Rr(h,D),O=ra(D,k),y()}function y(){return g=w=null,v}return function(){return t=e.apply(this,arguments),v.invert=t.invert&&b,M()}}function Ul(e){return function(t,n){var i=Gt(t*t+n*n),r=e(i),s=q(r),o=W(r);return[Qt(t*s,i*o),Zt(i&&n*s/i)]}}function Ts(e,t){return[e,wl(vl((at+t)/2))]}Ts.invert=function(e,t){return[e,2*Fi(_l(t))-at]};function Gp(){return Hl(Ts).scale(961/xt)}function Hl(e){var t=Is(e),n=t.center,i=t.scale,r=t.translate,s=t.clipExtent,o=null,a,l,u;t.scale=function(c){return arguments.length?(i(c),h()):i()},t.translate=function(c){return arguments.length?(r(c),h()):r()},t.center=function(c){return arguments.length?(n(c),h()):n()},t.clipExtent=function(c){return arguments.length?(c==null?o=a=l=u=null:(o=+c[0][0],a=+c[0][1],l=+c[1][0],u=+c[1][1]),h()):o==null?null:[[o,a],[l,u]]};function h(){var c=X*i(),f=t(xi(t.rotate()).invert([0,0]));return s(o==null?[[f[0]-c,f[1]-c],[f[0]+c,f[1]+c]]:e===Ts?[[Math.max(f[0]-c,o),a],[Math.min(f[0]+c,l),u]]:[[o,Math.max(f[1]-c,a)],[l,Math.min(f[1]+c,u)]])}return h()}function Fl(e,t){return[W(t)*q(e),q(t)]}Fl.invert=Ul(Zt);function Wp(){return Is(Fl).scale(249.5).clipAngle(90+Y)}function ql(e,t){var n=W(t),i=1+W(e)*n;return[n*q(e)/i,q(t)/i]}ql.invert=Ul(function(e){return 2*Fi(e)});function Gl(){return Is(ql).scale(250).clipAngle(142)}function Wl(e,t){return[wl(vl((at+t)/2)),-e]}Wl.invert=function(e,t){return[-t,2*Fi(_l(e))-at]};function Yp(){var e=Hl(Wl),t=e.center,n=e.rotate;return e.center=function(i){return arguments.length?t([-i[1],i[0]]):(i=t(),[i[1],-i[0]])},e.rotate=function(i){return arguments.length?n([i[0],i[1],i.length>2?i[2]+90:90]):(i=n(),[i[0],i[1],i[2]-90])},n([0,0,90]).scale(159.155)}const Fn=e=>()=>e;function Xp(e,{sourceEvent:t,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function Vt(e,t,n){this.k=e,this.x=t,this.y=n}Vt.prototype={constructor:Vt,scale:function(e){return e===1?this:new Vt(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Vt(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Yl=new Vt(1,0,0);Vt.prototype;function ur(e){e.stopImmediatePropagation()}function Ke(e){e.preventDefault(),e.stopImmediatePropagation()}function Vp(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function Kp(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function oa(){return this.__zoom||Yl}function jp(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function Qp(){return navigator.maxTouchPoints||"ontouchstart"in this}function Zp(e,t,n){var i=e.invertX(t[0][0])-n[0][0],r=e.invertX(t[1][0])-n[1][0],s=e.invertY(t[0][1])-n[0][1],o=e.invertY(t[1][1])-n[1][1];return e.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function Jp(){var e=Vp,t=Kp,n=Zp,i=jp,r=Qp,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,l=f0,u=zi("start","zoom","end"),h,c,f,_=500,S=150,A=0,N=10;function I(y){y.property("__zoom",oa).on("wheel.zoom",d,{passive:!1}).on("mousedown.zoom",g).on("dblclick.zoom",w).filter(r).on("touchstart.zoom",v).on("touchmove.zoom",b).on("touchend.zoom touchcancel.zoom",M).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}I.transform=function(y,p,m,x){var E=y.selection?y.selection():y;E.property("__zoom",oa),y!==E?k(y,p,m,x):E.interrupt().each(function(){O(this,arguments).event(x).start().zoom(null,typeof p=="function"?p.apply(this,arguments):p).end()})},I.scaleBy=function(y,p,m,x){I.scaleTo(y,function(){var E=this.__zoom.k,T=typeof p=="function"?p.apply(this,arguments):p;return E*T},m,x)},I.scaleTo=function(y,p,m,x){I.transform(y,function(){var E=t.apply(this,arguments),T=this.__zoom,L=m==null?P(E):typeof m=="function"?m.apply(this,arguments):m,R=T.invert(L),z=typeof p=="function"?p.apply(this,arguments):p;return n(C($(T,z),L,R),E,o)},m,x)},I.translateBy=function(y,p,m,x){I.transform(y,function(){return n(this.__zoom.translate(typeof p=="function"?p.apply(this,arguments):p,typeof m=="function"?m.apply(this,arguments):m),t.apply(this,arguments),o)},null,x)},I.translateTo=function(y,p,m,x,E){I.transform(y,function(){var T=t.apply(this,arguments),L=this.__zoom,R=x==null?P(T):typeof x=="function"?x.apply(this,arguments):x;return n(Yl.translate(R[0],R[1]).scale(L.k).translate(typeof p=="function"?-p.apply(this,arguments):-p,typeof m=="function"?-m.apply(this,arguments):-m),T,o)},x,E)};function $(y,p){return p=Math.max(s[0],Math.min(s[1],p)),p===y.k?y:new Vt(p,y.x,y.y)}function C(y,p,m){var x=p[0]-m[0]*y.k,E=p[1]-m[1]*y.k;return x===y.x&&E===y.y?y:new Vt(y.k,x,E)}function P(y){return[(+y[0][0]+ +y[1][0])/2,(+y[0][1]+ +y[1][1])/2]}function k(y,p,m,x){y.on("start.zoom",function(){O(this,arguments).event(x).start()}).on("interrupt.zoom end.zoom",function(){O(this,arguments).event(x).end()}).tween("zoom",function(){var E=this,T=arguments,L=O(E,T).event(x),R=t.apply(E,T),z=m==null?P(R):typeof m=="function"?m.apply(E,T):m,U=Math.max(R[1][0]-R[0][0],R[1][1]-R[0][1]),F=E.__zoom,B=typeof p=="function"?p.apply(E,T):p,G=l(F.invert(z).concat(U/F.k),B.invert(z).concat(U/B.k));return function(K){if(K===1)K=B;else{var pt=G(K),oe=U/pt[2];K=new Vt(oe,z[0]-pt[0]*oe,z[1]-pt[1]*oe)}L.zoom(null,K)}})}function O(y,p,m){return!m&&y.__zooming||new D(y,p)}function D(y,p){this.that=y,this.args=p,this.active=0,this.sourceEvent=null,this.extent=t.apply(y,p),this.taps=0}D.prototype={event:function(y){return y&&(this.sourceEvent=y),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(y,p){return this.mouse&&y!=="mouse"&&(this.mouse[1]=p.invert(this.mouse[0])),this.touch0&&y!=="touch"&&(this.touch0[1]=p.invert(this.touch0[0])),this.touch1&&y!=="touch"&&(this.touch1[1]=p.invert(this.touch1[0])),this.that.__zoom=p,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(y){var p=st(this.that).datum();u.call(y,this.that,new Xp(y,{sourceEvent:this.sourceEvent,target:I,transform:this.that.__zoom,dispatch:u}),p)}};function d(y,...p){if(!e.apply(this,arguments))return;var m=O(this,p).event(y),x=this.__zoom,E=Math.max(s[0],Math.min(s[1],x.k*Math.pow(2,i.apply(this,arguments)))),T=Rt(y);if(m.wheel)(m.mouse[0][0]!==T[0]||m.mouse[0][1]!==T[1])&&(m.mouse[1]=x.invert(m.mouse[0]=T)),clearTimeout(m.wheel);else{if(x.k===E)return;m.mouse=[T,x.invert(T)],Kn(this),m.start()}Ke(y),m.wheel=setTimeout(L,S),m.zoom("mouse",n(C($(x,E),m.mouse[0],m.mouse[1]),m.extent,o));function L(){m.wheel=null,m.end()}}function g(y,...p){if(f||!e.apply(this,arguments))return;var m=y.currentTarget,x=O(this,p,!0).event(y),E=st(y.view).on("mousemove.zoom",z,!0).on("mouseup.zoom",U,!0),T=Rt(y,m),L=y.clientX,R=y.clientY;nl(y.view),ur(y),x.mouse=[T,this.__zoom.invert(T)],Kn(this),x.start();function z(F){if(Ke(F),!x.moved){var B=F.clientX-L,G=F.clientY-R;x.moved=B*B+G*G>A}x.event(F).zoom("mouse",n(C(x.that.__zoom,x.mouse[0]=Rt(F,m),x.mouse[1]),x.extent,o))}function U(F){E.on("mousemove.zoom mouseup.zoom",null),il(F.view,x.moved),Ke(F),x.event(F).end()}}function w(y,...p){if(e.apply(this,arguments)){var m=this.__zoom,x=Rt(y.changedTouches?y.changedTouches[0]:y,this),E=m.invert(x),T=m.k*(y.shiftKey?.5:2),L=n(C($(m,T),x,E),t.apply(this,p),o);Ke(y),a>0?st(this).transition().duration(a).call(k,L,x,y):st(this).call(I.transform,L,x,y)}}function v(y,...p){if(e.apply(this,arguments)){var m=y.touches,x=m.length,E=O(this,p,y.changedTouches.length===x).event(y),T,L,R,z;for(ur(y),L=0;L<x;++L)R=m[L],z=Rt(R,this),z=[z,this.__zoom.invert(z),R.identifier],E.touch0?!E.touch1&&E.touch0[2]!==z[2]&&(E.touch1=z,E.taps=0):(E.touch0=z,T=!0,E.taps=1+!!h);h&&(h=clearTimeout(h)),T&&(E.taps<2&&(c=z[0],h=setTimeout(function(){h=null},_)),Kn(this),E.start())}}function b(y,...p){if(this.__zooming){var m=O(this,p).event(y),x=y.changedTouches,E=x.length,T,L,R,z;for(Ke(y),T=0;T<E;++T)L=x[T],R=Rt(L,this),m.touch0&&m.touch0[2]===L.identifier?m.touch0[0]=R:m.touch1&&m.touch1[2]===L.identifier&&(m.touch1[0]=R);if(L=m.that.__zoom,m.touch1){var U=m.touch0[0],F=m.touch0[1],B=m.touch1[0],G=m.touch1[1],K=(K=B[0]-U[0])*K+(K=B[1]-U[1])*K,pt=(pt=G[0]-F[0])*pt+(pt=G[1]-F[1])*pt;L=$(L,Math.sqrt(K/pt)),R=[(U[0]+B[0])/2,(U[1]+B[1])/2],z=[(F[0]+G[0])/2,(F[1]+G[1])/2]}else if(m.touch0)R=m.touch0[0],z=m.touch0[1];else return;m.zoom("touch",n(C(L,R,z),m.extent,o))}}function M(y,...p){if(this.__zooming){var m=O(this,p).event(y),x=y.changedTouches,E=x.length,T,L;for(ur(y),f&&clearTimeout(f),f=setTimeout(function(){f=null},_),T=0;T<E;++T)L=x[T],m.touch0&&m.touch0[2]===L.identifier?delete m.touch0:m.touch1&&m.touch1[2]===L.identifier&&delete m.touch1;if(m.touch1&&!m.touch0&&(m.touch0=m.touch1,delete m.touch1),m.touch0)m.touch0[1]=this.__zoom.invert(m.touch0[0]);else if(m.end(),m.taps===2&&(L=Rt(L,this),Math.hypot(c[0]-L[0],c[1]-L[1])<N)){var R=st(this).on("dblclick.zoom");R&&R.apply(this,arguments)}}}return I.wheelDelta=function(y){return arguments.length?(i=typeof y=="function"?y:Fn(+y),I):i},I.filter=function(y){return arguments.length?(e=typeof y=="function"?y:Fn(!!y),I):e},I.touchable=function(y){return arguments.length?(r=typeof y=="function"?y:Fn(!!y),I):r},I.extent=function(y){return arguments.length?(t=typeof y=="function"?y:Fn([[+y[0][0],+y[0][1]],[+y[1][0],+y[1][1]]]),I):t},I.scaleExtent=function(y){return arguments.length?(s[0]=+y[0],s[1]=+y[1],I):[s[0],s[1]]},I.translateExtent=function(y){return arguments.length?(o[0][0]=+y[0][0],o[1][0]=+y[1][0],o[0][1]=+y[0][1],o[1][1]=+y[1][1],I):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},I.constrain=function(y){return arguments.length?(n=y,I):n},I.duration=function(y){return arguments.length?(a=+y,I):a},I.interpolate=function(y){return arguments.length?(l=y,I):l},I.on=function(){var y=u.on.apply(u,arguments);return y===u?I:y},I.clickDistance=function(y){return arguments.length?(A=(y=+y)*y,I):Math.sqrt(A)},I.tapDistance=function(y){return arguments.length?(N=+y,I):N},I}function qi(){return{systemMap:new Map,laneMap:new Map,neighborMap:new Map}}function Xl(e,t){e.systemMap.set(t.id,t)}function Qr(e,t,n){const i=[t.id,n.id].sort((s,o)=>s.localeCompare(o)).join("-");if(e.laneMap.has(i))return;const r={id:i,fromId:t.id,toId:n.id,movement:[0,0]};e.laneMap.set(i,r)}function Gi(e){const t=new Map;for(const n of e.laneMap.values())t.has(n.fromId)||t.set(n.fromId,[]),t.get(n.fromId)?.push(n.toId),t.has(n.toId)||t.set(n.toId,[]),t.get(n.toId)?.push(n.fromId);e.neighborMap=t}function _t(e,t){const n=e.systemMap.get(t);if(!n)return[];(!e.neighborMap||e.neighborMap.size===0)&&Gi(e);const i=e.neighborMap.get(n.id);return i?i.map(r=>e.systemMap.get(r)).filter(r=>!!r):[]}function Wi(e,t,n){return e.neighborMap.get(t)?.includes(n)||!1}function Vl(e,t){return Ns(t,Array.from(e.systemMap.values()))}function Ns(e,t){if(t.length===0)return null;let n=null,i=1/0;return t.forEach(r=>{if(r.location[0]===e[0]&&r.location[1]===e[1])return;const s=bi(e,r.location);s<i&&(i=s,n=r)}),n}function tg(e){console.log("Loading world from JSON...",e);const t=qi();return t.systemMap=new Map(e.systems),t.laneMap=new Map(e.lanes),Gi(t),t}function eg(e){return{systems:Array.from(e.systemMap.entries()),lanes:Array.from(e.laneMap.entries())}}function Kl(){return{playerName:localStorage.getItem("starz_playerName")??"Player",numBots:Wu,fow:qu,numSystems:Gu,timeScale:1}}function Ps(){return{world:qi(),playerMap:new Map}}function jl(e,t){e.playerMap.set(t.id,t)}function Cs(e){const{C:t}=globalThis.gameManager.getContext();if(!t.playerId)return null;for(const n of e.world.systemMap.values())if(n.homeworld===t.playerId)return n;return null}function Yi(e,t){const{P:n}=globalThis.gameManager.getContext();if(!n)return;n.revealedSystems.add(t.id),n.visitedSystems.add(t.id);const i=_t(e.world,t.id);if(i)return i.forEach(r=>n.revealedSystems.add(r.id)),e}function Ql(e){const{P:t}=globalThis.gameManager.getContext();if(t)for(const n of e.world.systemMap.values())t.revealedSystems.add(n.id)}function Zl(e,t,n,i,r){e.moveQueue.push({ships:n,toId:t.id,fromId:e.id,playerId:i,message:r})}const qn=100,hr={territory:{aggression:.3,expansion:1,defensiveness:.5,riskTolerance:.4,speed:qn},rusher:{aggression:1,expansion:.4,defensiveness:.1,riskTolerance:.7,speed:qn},turtle:{aggression:.1,expansion:.3,defensiveness:.95,riskTolerance:.2,speed:qn},balanced:{aggression:.5,expansion:.5,defensiveness:.5,riskTolerance:.5,speed:qn}};function ng({S:e}){for(const t of e.playerMap.values())t.bot?.makeMoves()}let ig=0;class rg{constructor(t={}){this.queuedMoves=0,this.threatLevels=new Map,this.frontline=new Set,this.backline=new Set;const n=t.playerIndex??ig++;this.id=t.id??`${n}`;let i=t.personality;if(!i){const r=Object.keys(hr);i=r[n%r.length]}this.name=t.name??i,this.personality=i==="idle"?hr.balanced:hr[i]}makeMoves(){if(this.name==="idle")return;const n=gameManager.getState().world.systemMap.values();if(this.botSystems=Array.from(n).filter(l=>l.ownerId===this.id),this.botSystems.length===0)return;for(const l of this.botSystems)l.moveQueue=[];this.queuedMoves=0,this.analyzeMap();const i=this.getDefensiveMoves();if(this.chooseMoves(i,1-this.personality.defensiveness),this.queuedMoves>=this.personality.speed)return;const r=this.getCoordinatedAttackMoves();if(this.chooseMoves(r,this.personality.aggression),this.queuedMoves>=this.personality.speed)return;const s=this.getExterminateMoves();if(this.chooseMoves(s,this.personality.defensiveness),this.queuedMoves>=this.personality.speed)return;const o=this.getExploreMoves();if(this.chooseMoves(o,this.personality.expansion),this.queuedMoves>=this.personality.speed)return;const a=this.getLogisticsMoves();this.chooseMoves(a,1),this.queuedMoves>=this.personality.speed}analyzeMap(){this.threatLevels.clear(),this.frontline.clear(),this.backline.clear();const t=gameManager.getState();this.botSystems.forEach(n=>{const i=_t(t.world,n.id),r=i.filter(a=>a.ownerId&&a.ownerId!==this.id),s=i.filter(a=>!a.ownerId),o=r.reduce((a,l)=>a+l.ships,0);this.threatLevels.set(n.id,o),r.length>0||s.length>0?this.frontline.add(n.id):this.backline.add(n.id)})}getDefensiveMoves(){const t=gameManager.getState();return this.botSystems.map(n=>{if(n.moveQueue.length>0)return[];const i=[],r=this.threatLevels.get(n.id)??0;if(r>0){const s=r*1.1;if(n.ships<s)if(n.ships<r*.5){const o=_t(t.world,n.id).filter(a=>a.ownerId===this.id).sort((a,l)=>(this.threatLevels.get(a.id)||0)-(this.threatLevels.get(l.id)||0))[0];o&&i.push({message:`Retreating from ${n.id}`,from:n,to:o,units:n.ships-1,score:1e3})}else i.push({message:`Holding ${n.id}`,from:n,to:n,units:0,score:r});else n.ships<s*1.5&&i.push({message:`Defending ${n.id} from threat level ${r}`,from:n,to:n,units:0,score:r})}return i})}getCoordinatedAttackMoves(){const t=gameManager.getState(),n=new Map;this.botSystems.forEach(r=>{if(r.moveQueue.length>0||r.ships<5)return;const s=_t(t.world,r.id);s&&s.forEach(o=>{if(o.ownerId!==null&&o.ownerId!==this.id){if(_t(t.world,r.id).filter(l=>l.ownerId&&l.ownerId!==this.id&&l.id!==o.id).length>0)return;n.has(o.id)||n.set(o.id,{target:o,attackers:[]}),n.get(o.id).attackers.push(r)}})});const i=[];return n.forEach(({target:r,attackers:s})=>{const a=_t(t.world,r.id).filter(c=>c.ownerId===r.ownerId).length===0?1.5:1,l=s.reduce((c,f)=>{const _=this.threatLevels.get(f.id)||0,S=Math.max(0,f.ships-_*1.1);return c+Math.floor(S*(1-this.personality.defensiveness))},0),h=(r.ships+(r.homeworld?10:0))*(1.3-this.personality.riskTolerance);l>h&&s.forEach(c=>{if(c.moveQueue.length>0)return;const f=this.threatLevels.get(c.id)||0,_=Math.max(0,c.ships-f*1.1),S=Math.floor(_*(1-this.personality.defensiveness)),A=this.getBestMoveAmount(c,r,S);A>0&&i.push([{message:`Coordinated attack on ${r.id}`,from:c,to:r,units:A,score:(100+(r.homeworld?50:0))*a}])})}),i}getExterminateMoves(){const t=gameManager.getState();return this.botSystems.map(n=>n.moveQueue.length>0?[]:n.ships<3?[]:_t(t.world,n.id).flatMap(r=>{if(r.ownerId===this.id)return[];if(r.ownerId===null&&r.type==="UNINHABITED")return[];if(n.ships>r.ships*1.5+5){const s=n.ships-2;return[{message:`Crushing weak neighbor ${r.id}`,from:n,to:r,units:s,score:40}]}return[]}))}getExploreMoves(){const t=gameManager.getState();return this.botSystems.map(n=>n.moveQueue.length>0?[]:n.ships<2?[]:_t(t.world,n.id).flatMap(r=>{if(r.ownerId!==null)return[];if(r.type==="INHABITED")return[];const s=Math.max(1,Math.floor(n.ships*.3));return[{message:`Exploring ${r.id}`,from:n,to:r,units:s,score:30}]}))}getLogisticsMoves(){const t=gameManager.getState();return this.botSystems.map(n=>{if(n.moveQueue.length>0)return[];if(n.ships<2)return[];if(this.backline.has(n.id)){const i=_t(t.world,n.id).filter(o=>this.frontline.has(o.id)&&o.ownerId===this.id);if(i.length>0){const o=i.sort((a,l)=>a.ships-l.ships)[0];return[{message:"Logistics: Frontline Support",from:n,to:o,units:n.ships-1,score:10}]}const s=_t(t.world,n.id).filter(o=>o.ownerId===this.id).sort((o,a)=>o.ships-a.ships)[0];if(s&&s.ships<n.ships-2)return[{message:"Logistics: Balancing",from:n,to:s,units:Math.floor((n.ships-s.ships)/2),score:5}]}if(this.frontline.has(n.id)){const i=_t(t.world,n.id).filter(r=>r.ownerId===this.id&&(this.threatLevels.get(r.id)||0)>r.ships);if(i.length>0&&(this.threatLevels.get(n.id)||0)<n.ships){const r=i[0];return[{message:"Logistics: Emergency Reinforce",from:n,to:r,units:Math.floor(n.ships/2),score:50}]}}return[]})}getBestMoveAmount(t,n,i){const r=Math.max(0,t.ships-1);let s=0;return n.ownerId===t.ownerId?s=Math.floor((t.ships-n.ships)/2):s=Math.floor(t.ships/2),s=Math.max(0,s),Math.abs(r-i)<Math.abs(s-i)?r:s}chooseMoves(t,n=1){if(t.length===0)return;const i=t.flat().sort(sg);for(const r of i){if(this.queuedMoves>=this.personality.speed)return;if(Math.random()<n){if(r.from.moveQueue.length>0)continue;Zl(r.from,r.to,r.units,this.id,r.message),r.units>0&&this.queuedMoves++}}}}function sg(e,t){return e.score!==t.score?t.score-e.score:Math.random()-.5}function Be(e,...t){const n=globalThis.gameManager?.getContext?.().C;Ku&&console.log(`[DEBUG][Tick ${n?.tick??null}] ${e}`,...t)}function fr(e,t={}){if(!Vu)return;const n=globalThis.gameManager?.getContext?.().C;let i=1;try{i=parseInt(localStorage.getItem(e)??"0",10)+1}catch(r){console.error("Error reading event count from localStorage:",r)}if(localStorage.setItem(e,i+""),window&&window.sa_event)try{window.sa_event(e,{[e]:i,tick:n?.tick??null,...t})}catch(r){console.error("Error tracking event:",r)}}function Jl(e,t,n,i){if(i!==0){if(i<0){if(t.ownerId!==n.ownerId)return;const r=t;t=n,n=r,i=-i}t.ships<i||(n.ownerId===t.ownerId?lg(e,t,n,i):og(e,t,n,i))}}function og(e,t,n,i){const r=t.ownerId,s=n.ships??0;if(ec(e.S.world,t,n,i),i>s){const o=i-s;t.ships=t.ships-i,n.ships=o,ag(e,r,n)}else t.ships=t.ships-i,n.ships=s-i}function ag(e,t,n){n.ownerId=t,n.moveQueue=[],t===e.C.playerId&&Yi(e.S,n),n.homeworld&&n.homeworld!==t&&tc(e,n.homeworld,t)}function tc({S:e,E:t,C:n},i,r=null){for(const o of e.world.systemMap.values())o.ownerId===i&&(o.ownerId=r,o.ships=Math.max(Math.floor((o.ships??0)/2),1),o.homeworld=null,o.moveQueue=[],r===n.playerId&&Yi(e,o)),o.homeworld===i&&(o.homeworld=null);const s=e.playerMap.get(i);s.isAlive=!1,t.emit("PLAYER_ELIMINATED",{loserId:i,winnerId:r})}function ec(e,t,n,i){t.movement=[t.movement[0],t.movement[1]+i],n.movement=[n.movement[0]+i,n.movement[1]];for(const r of e.laneMap.values())r.fromId===t.id&&r.toId===n.id?r.movement=[r.movement[0]+i,r.movement[1]]:r.fromId===n.id&&r.toId===t.id&&(r.movement=[r.movement[0],r.movement[1]+i])}function lg({S:e,C:t},n,i,r){n.ships<r||(n.ships-=r,i.ships+=r,ec(e.world,n,i,r),i.ownerId===t.playerId&&Yi(e,i))}function nc(e){for(const t of e.S.world.systemMap.values())for(t.lastMove=null;t.moveQueue.length>0;){const n=t.moveQueue.shift();n&&ic(e,n)}}function ic(e,t){t.playerId===e.C.playerId&&Be(`player move: ${JSON.stringify(t)}`);const n=e.S.world.systemMap.get(t.fromId),i=e.S.world.systemMap.get(t.toId);Jl(e,n,i,t.ships),n.lastMove=t,e.E.emit("MAKE_MOVE",t)}function cg(e,t){const n=rc(e.S,t);n&&ic(e,n)}function ug(e,t){const n=e.world.systemMap.get(t.fromId);return!(n.ownerId!==t.playerId||!Wi(e.world,t.fromId,t.toId)||n.ships<=1)}function rc(e,t){if(!ug(e,t))return null;switch(t.type){case"MASS_MOVE":return n(t.fromId,t.toId);case"BALANCED_MOVE":return i(t.fromId,t.toId)}return null;function n(r,s){const{C:o}=globalThis.gameManager.getContext(),l=e.world.systemMap.get(r).ships-1;return l<=0?null:{message:`Move ${l} ships from ${r} to ${s}`,ships:l,toId:s,fromId:r,playerId:o.playerId}}function i(r,s){const{C:o}=globalThis.gameManager.getContext(),a=e.world.systemMap.get(r),l=e.world.systemMap.get(s),u=l.ownerId===a.ownerId?Math.floor((a.ships-l.ships)/2):Math.floor(a.ships/2);return u<=0?null:{message:`Move ${u} ships from ${a.id} to ${l.id}`,ships:u,toId:l.id,fromId:a.id,playerId:o.playerId}}}function sc(e){for(const t of e.playerMap.values()){const n={playerId:t.id,systems:0,ships:0,homeworld:0};for(const i of e.world.systemMap.values())i.ownerId===t.id&&(n.systems+=1,n.ships+=i.ships??0,i.homeworld===t.id&&(n.homeworld=i.ships??0));t.stats=n}}function oc(e){for(const t of e.world.systemMap.values())t.type==="INHABITED"&&(t.ownerId||t.ships<za)&&(t.ships=(t.ships??0)+Hu)}function ac(e){for(const t of e.world.systemMap.values())t.ownerId!=null&&(t.ships=(t.ships??0)+Fu)}function hg({S:e,C:t,E:n,P:i}){if(t.status==="PLAYING"&&i)if(e.playerMap.size>1){const r=Array.from(e.playerMap.values());if(r.reduce((o,a)=>(o+=a.stats.homeworld>0?1:0,o),0)===1){const o=r.find(l=>l.stats.homeworld>0).id,a=e.playerMap.get(o);n.emit("PLAYER_WIN",{playerId:o,message:`${a.name} has conquered The Bubble!`}),n.emit("GAME_STOP",void 0)}}else Array.from(e.world.systemMap.values()).filter(s=>s.ownerId!==t.playerId).length===0&&(n.emit("PLAYER_WIN",{playerId:t.playerId,message:`${i.name} has conquered The Bubble!`}),n.emit("GAME_STOP",void 0))}function fg(e,t=!1){const{S:n,C:i}=e;i.tick%Bu===0&&oc(n),i.tick%Uu===0&&ac(n);for(const r of n.world.systemMap.values())r.movement=[0,0];for(const r of n.world.laneMap.values())r.movement=[0,0];t||(ng(e),nc(e)),sc(n)}const dg=xn({length:5});function lc({S:e,C:t}){e.world=qi();const n=re/(t.config.numSystems-1),i=-re/2,r=re/2;Be("Generating map...");const s=Math.min(.08,Math.sqrt(Math.PI/t.config.numSystems));for(let h=i;h<r;h+=n){const c=Math.asin(h/(re/2))*(180/Math.PI),_=[Math.random()*360-180,c],S=gg(_),A=Vl(e.world,S.location);if(A){if(bi(_,A.location)<s){h-=n;continue}Qr(e.world,S,A)}Xl(e.world,S)}const o=Array.from(e.world.systemMap.values()),a=[o[o.length-1]];for(let h=o.length-2;h>=0;h--){const c=o[h],f=Ns(c.location,a);f&&Qr(e.world,c,f),a.push(c)}Gi(e.world),Be(`Generated ${e.world.systemMap.size} systems and ${e.world.laneMap.size} lanes.`);const l=[...o],u=Math.max(Yu*t.config.numSystems,yr+t.config.numBots);for(let h=0;h<u&&l.length!==0;h++){const c=Math.floor(Math.random()*l.length);if(c===0){h--;continue}const f=l[c];f.ownerId=null,f.type="INHABITED",f.ships=za+Math.floor(Math.random()*10),f.homeworld=null,l.splice(c,1)}}function pg(e,t){const n=Array.from(e.world.systemMap.values()).filter(s=>!s.ownerId&&s.type==="INHABITED");if(n.length===0)throw"No available homeworlds to join.";const i=Math.floor(Math.random()*n.length),r=n[i];return r.ships=1,r.ownerId=r.homeworld=t,r.type="INHABITED",r}function gg(e){return{id:"s"+dg(),type:"UNINHABITED",location:e,ownerId:null,ships:0,homeworld:null,moveQueue:[],lastMove:null,movement:[0,0]}}function mg(e){const t=Ps();return lc({...e,S:t}),t}const yg=Object.freeze(Object.defineProperty({__proto__:null,addLane:Qr,addPlayer:jl,addSystem:Xl,assignSystem:pg,buildNeighborMap:Gi,checkVictory:hg,createWorld:qi,defaultConfig:Kl,doQueuedMoves:nc,eliminatePlayer:tc,findClosestSystem:Vl,findClosestSystemInList:Ns,gameTick:fg,generateMap:lc,getAdjacentSystems:_t,getPlayersHomeworld:Cs,hasLane:Wi,initalState:Ps,moveShips:Jl,orderToMove:rc,queueMove:Zl,revealAllSystems:Ql,roundUpdate:ac,setup:mg,takeOrder:cg,turnUpdate:oc,updateStats:sc,visitSystem:Yi,worldFromJson:tg,worldToJson:eg},Symbol.toStringTag,{value:"Module"})),ks=Math.PI,aa=ks/2,la=180/ks,ca=ks/180,_g=Math.atan2,ua=Math.cos,wg=Math.max,vg=Math.min,ha=Math.sin,xg=Math.sign||function(e){return e>0?1:e<0?-1:0},cc=Math.sqrt;function bg(e){return e>1?aa:e<-1?-aa:Math.asin(e)}function uc(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function wt(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Ti(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]}function Ni(e){var t=cc(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]}function Os(e){return[_g(e[1],e[0])*la,bg(wg(-1,vg(1,e[2])))*la]}function Ft(e){const t=e[0]*ca,n=e[1]*ca,i=ua(n);return[i*ua(t),i*ha(t),ha(n)]}function Ls(e){return e=e.map(t=>Ft(t)),uc(e[0],wt(e[2],e[1]))}function Sg(e){const t=Mg(e),n=Ag(t),i=$g(n,e),r=Tg(n,e.length),s=Eg(r,e),o=Ig(n,e),{polygons:a,centers:l}=Ng(o,n,e),u=Pg(a),h=kg(n,e),c=Cg(i,n);return{delaunay:t,edges:i,triangles:n,centers:l,neighbors:r,polygons:a,mesh:u,hull:h,urquhart:c,find:s}}function Eg(e,t){function n(i,r){let s=i[0]-r[0],o=i[1]-r[1],a=i[2]-r[2];return s*s+o*o+a*a}return function(r,s,o){o===void 0&&(o=0);let a,l,u=o;const h=Ft([r,s]);do a=o,o=null,l=n(h,Ft(t[a])),e[a].forEach(c=>{let f=n(h,Ft(t[c]));if(f<l){l=f,o=c,u=c;return}});while(o!==null);return u}}function Mg(e){if(e.length<2)return{};let t=0;for(;isNaN(e[t][0]+e[t][1])&&t++<e.length;);const n=xi(e[t]),i=Gl().translate([0,0]).scale(1).rotate(n.invert([180,0]));e=e.map(i);const r=[];let s=1;for(let c=0,f=e.length;c<f;c++){let _=e[c][0]**2+e[c][1]**2;!isFinite(_)||_>1e32?r.push(c):_>s&&(s=_)}const o=1e6*cc(s);r.forEach(c=>e[c]=[o,0]),e.push([0,o]),e.push([-o,0]),e.push([0,-o]);const a=xs.from(e);a.projection=i;const{triangles:l,halfedges:u,inedges:h}=a;for(let c=0,f=u.length;c<f;c++)if(u[c]<0){const _=c%3==2?c-2:c+1,S=c%3==0?c+2:c-1,A=u[_],N=u[S];u[A]=N,u[N]=A,u[_]=u[S]=-1,l[c]=l[_]=l[S]=t,h[l[A]]=A%3==0?A+2:A-1,h[l[N]]=N%3==0?N+2:N-1,c+=2-c%3}else l[c]>e.length-3-1&&(l[c]=t);return a}function $g(e,t){const n=new Set;return t.length===2?[[0,1]]:(e.forEach(i=>{if(i[0]!==i[1]&&!(Ls(i.map(r=>t[r]))<0))for(let r=0,s;r<3;r++)s=(r+1)%3,n.add(Ha([i[r],i[s]]).join("-"))}),Array.from(n,i=>i.split("-").map(Number)))}function Ag(e){const{triangles:t}=e;if(!t)return[];const n=[];for(let i=0,r=t.length/3;i<r;i++){const s=t[3*i],o=t[3*i+1],a=t[3*i+2];s!==o&&o!==a&&n.push([s,a,o])}return n}function Ig(e,t){return e.map(n=>{const i=n.map(s=>t[s]).map(Ft),r=Ti(Ti(wt(i[1],i[0]),wt(i[2],i[1])),wt(i[0],i[2]));return Os(Ni(r))})}function Tg(e,t){const n=[];return e.forEach(i=>{for(let r=0;r<3;r++){const s=i[r],o=i[(r+1)%3];n[s]=n[s]||[],n[s].push(o)}}),e.length===0&&(t===2?(n[0]=[1],n[1]=[0]):t===1&&(n[0]=[])),n}function Ng(e,t,n){const i=[],r=e.slice();if(t.length===0){if(n.length<2)return{polygons:i,centers:r};if(n.length===2){const a=Ft(n[0]),l=Ft(n[1]),u=Ni(Ti(a,l)),h=Ni(wt(a,l)),c=wt(u,h),f=[u,wt(u,c),wt(wt(u,c),c),wt(wt(wt(u,c),c),c)].map(Os).map(o);return i.push(f),i.push(f.slice().reverse()),{polygons:i,centers:r}}}t.forEach((a,l)=>{for(let u=0;u<3;u++){const h=a[u],c=a[(u+1)%3],f=a[(u+2)%3];i[h]=i[h]||[],i[h].push([c,f,l,[h,c,f]])}});const s=i.map(a=>{const l=[a[0][2]];let u=a[0][1];for(let h=1;h<a.length;h++)for(let c=0;c<a.length;c++)if(a[c][0]==u){u=a[c][1],l.push(a[c][2]);break}if(l.length>2)return l;if(l.length==2){const h=fa(n[a[0][3][0]],n[a[0][3][1]],r[l[0]]),c=fa(n[a[0][3][2]],n[a[0][3][0]],r[l[0]]),f=o(h),_=o(c);return[l[0],_,l[1],f]}});function o(a){let l=-1;return r.slice(t.length,1/0).forEach((u,h)=>{u[0]===a[0]&&u[1]===a[1]&&(l=h+t.length)}),l<0&&(l=r.length,r.push(a)),l}return{polygons:s,centers:r}}function fa(e,t,n){e=Ft(e),t=Ft(t),n=Ft(n);const i=xg(uc(wt(t,e),n));return Os(Ni(Ti(e,t)).map(r=>i*r))}function Pg(e){const t=[];return e.forEach(n=>{if(!n)return;let i=n[n.length-1];for(let r of n)r>i&&t.push([i,r]),i=r}),t}function Cg(e,t){return function(n){const i=new Map,r=new Map;return e.forEach((s,o)=>{const a=s.join("-");i.set(a,n[o]),r.set(a,!0)}),t.forEach(s=>{let o=0,a=-1;for(let l=0;l<3;l++){let u=Ha([s[l],s[(l+1)%3]]).join("-");i.get(u)>o&&(o=i.get(u),a=u)}r.set(a,!1)}),e.map(s=>r.get(s.join("-")))}}function kg(e,t){const n=new Set,i=[];e.map(a=>{if(!(Ls(a.map(l=>t[l>t.length?0:l]))>1e-12))for(let l=0;l<3;l++){let u=[a[l],a[(l+1)%3]],h=`${u[0]}-${u[1]}`;n.has(h)?n.delete(h):n.add(`${u[1]}-${u[0]}`)}});const r=new Map;let s;if(n.forEach(a=>{a=a.split("-").map(Number),r.set(a[0],a[1]),s=a[0]}),s===void 0)return i;let o=s;do{i.push(o);let a=r.get(o);r.set(o,-1),o=a}while(o>-1&&o!==s);return i}function Og(e){const t=function(n){if(t.delaunay=null,t._data=n,typeof t._data=="object"&&t._data.type==="FeatureCollection"&&(t._data=t._data.features),typeof t._data=="object"){const i=t._data.map(r=>[t._vx(r),t._vy(r),r]).filter(r=>isFinite(r[0]+r[1]));t.points=i.map(r=>[r[0],r[1]]),t.valid=i.map(r=>r[2]),t.delaunay=Sg(t.points)}return t};return t._vx=function(n){if(typeof n=="object"&&"type"in n)return Fo(n)[0];if(0 in n)return n[0]},t._vy=function(n){if(typeof n=="object"&&"type"in n)return Fo(n)[1];if(1 in n)return n[1]},t.x=function(n){return n?(t._vx=n,t):t._vx},t.y=function(n){return n?(t._vy=n,t):t._vy},t.polygons=function(n){if(n!==void 0&&t(n),!t.delaunay)return!1;const i={type:"FeatureCollection",features:[]};return t.valid.length===0||(t.delaunay.polygons.forEach((r,s)=>i.features.push({type:"Feature",geometry:r?{type:"Polygon",coordinates:[[...r,r[0]].map(o=>t.delaunay.centers[o])]}:null,properties:{site:t.valid[s],sitecoordinates:t.points[s],neighbours:t.delaunay.neighbors[s]}})),t.valid.length===1&&i.features.push({type:"Feature",geometry:{type:"Sphere"},properties:{site:t.valid[0],sitecoordinates:t.points[0],neighbours:[]}})),i},t.triangles=function(n){return n!==void 0&&t(n),t.delaunay?{type:"FeatureCollection",features:t.delaunay.triangles.map((i,r)=>(i=i.map(s=>t.points[s]),i.center=t.delaunay.centers[r],i)).filter(i=>Ls(i)>0).map(i=>({type:"Feature",properties:{circumcenter:i.center},geometry:{type:"Polygon",coordinates:[[...i,i[0]]]}}))}:!1},t.links=function(n){if(n!==void 0&&t(n),!t.delaunay)return!1;const i=t.delaunay.edges.map(s=>bi(t.points[s[0]],t.points[s[1]])),r=t.delaunay.urquhart(i);return{type:"FeatureCollection",features:t.delaunay.edges.map((s,o)=>({type:"Feature",properties:{source:t.valid[s[0]],target:t.valid[s[1]],length:i[o],urquhart:!!r[o]},geometry:{type:"LineString",coordinates:[t.points[s[0]],t.points[s[1]]]}}))}},t.mesh=function(n){return n!==void 0&&t(n),t.delaunay?{type:"MultiLineString",coordinates:t.delaunay.edges.map(i=>[t.points[i[0]],t.points[i[1]]])}:!1},t.cellMesh=function(n){if(n!==void 0&&t(n),!t.delaunay)return!1;const{centers:i,polygons:r}=t.delaunay,s=[];for(const o of r)if(o)for(let a=o.length,l=o[a-1],u=o[0],h=0;h<a;l=u,u=o[++h])u>l&&s.push([i[l],i[u]]);return{type:"MultiLineString",coordinates:s}},t._found=void 0,t.find=function(n,i,r){if(t._found=t.delaunay.find(n,i,t._found),!r||bi([n,i],t.points[t._found])<r)return t._found},t.hull=function(n){n!==void 0&&t(n);const i=t.delaunay.hull,r=t.points;return i.length===0?null:{type:"Polygon",coordinates:[[...i.map(s=>r[s]),r[i[0]]]]}},e?t(e):t}const hc=Math.acos,Lg=Math.asin,da=Math.atan2,pe=Math.cos,pa=Math.hypot,Zr=Math.max,Jr=Math.min,fc=Math.PI,ge=Math.sin,an=fc/180,dr=180/fc;class Tt{static fromCartesian([t,n,i]){return[0,i,-n,t]}static fromAngles([t,n,i]){t*=an/2,n*=an/2,i=(i||0)*an/2;const r=ge(t),s=pe(t),o=ge(n),a=pe(n),l=ge(i),u=pe(i);return[s*a*u+r*o*l,r*a*u-s*o*l,s*o*u+r*a*l,s*a*l-r*o*u]}static toAngles([t,n,i,r]){return[da(2*(t*n+i*r),1-2*(n*n+i*i))*dr,Lg(Zr(-1,Jr(1,2*(t*i-r*n))))*dr,da(2*(t*r+n*i),1-2*(i*i+r*r))*dr]}static interpolateAngles(t,n){const i=Tt.interpolate(Tt.fromAngles(t),Tt.fromAngles(n));return r=>Tt.toAngles(i(r))}static interpolateLinear([t,n,i,r],[s,o,a,l]){s-=t,o-=n,a-=i,l-=r;const u=new Array(4);return h=>{const c=pa(u[0]=t+s*h,u[1]=n+o*h,u[2]=i+a*h,u[3]=r+l*h);return u[0]/=c,u[1]/=c,u[2]/=c,u[3]/=c,u}}static interpolate([t,n,i,r],[s,o,a,l]){let u=Tt.dot([t,n,i,r],[s,o,a,l]);if(u<0&&(s=-s,o=-o,a=-a,l=-l,u=-u),u>.9995)return Tt.interpolateLinear([t,n,i,r],[s,o,a,l]);const h=hc(Zr(-1,Jr(1,u))),c=new Array(4),f=pa(s-=t*u,o-=n*u,a-=i*u,l-=r*u);return s/=f,o/=f,a/=f,l/=f,_=>{const S=h*_,A=ge(S),N=pe(S);return c[0]=t*N+s*A,c[1]=n*N+o*A,c[2]=i*N+a*A,c[3]=r*N+l*A,c}}static dot([t,n,i,r],[s,o,a,l]){return t*s+n*o+i*a+r*l}static multiply([t,n,i,r],[s,o,a,l]){return[t*s-n*o-i*a-r*l,t*o+n*s+i*l-r*a,t*a-n*l+i*s+r*o,t*l+n*a-i*o+r*s]}}const $t=Tt.fromAngles;$t.multiply=Tt.multiply;$t.rotation=Tt.toAngles;$t.interpolate=Tt.interpolateAngles;$t.cartesian=function(e){const t=e[0]*an,n=e[1]*an,i=pe(n);return[i*pe(t),i*ge(t),ge(n)]};$t.delta=function(e,t,n){arguments.length==2&&(n=1);const i=Math.sqrt;function r(h,c){return[h[1]*c[2]-h[2]*c[1],h[2]*c[0]-h[0]*c[2],h[0]*c[1]-h[1]*c[0]]}function s(h,c){return h[0]*c[0]+h[1]*c[1]+h[2]*c[2]}const o=r(e,t),a=i(s(o,o));if(!a)return[1,0,0,0];const l=n*hc(Zr(-1,Jr(1,s(e,t))))/2,u=ge(l);return[pe(l),o[2]/a*u,-o[1]/a*u,o[0]/a*u]};const it={all:new Set,last:null};function me(){it.all.clear(),it.last=null}function _n(e){it.all.add(e),it.last=e}function Rg(e){it.all.clear(),it.all.add(e),it.last=e}function Dg(e){it.all.delete(e),it.last===e&&(it.last=null)}function dc(e){return it.all.has(e)}function zg(e){dc(e)?Dg(e):_n(e)}function Bg({S:e,C:t},n){if(it.last==null)return;const i=[[it.last]],r=new Set;for(r.add(it.last);i.length>0;){const s=i.shift(),o=s[s.length-1];if(o===n){s.forEach(a=>it.all.add(a)),it.last=n;return}for(const a of _t(e.world,o))!r.has(a.id)&&a.ownerId===t.playerId&&(r.add(a.id),i.push([...s,a.id]))}}const ga=.5,Ug=.25,Hg=100,Fg=20,qg=Ss(".3~s"),Ue={Orthographic:Wp,Stereographic:Gl,Mercator:Gp,TransverseMercator:Yp};let ts,Nt,He=Ue[Du],J=He().translate([0,0]),Jt=J.scale(),Xi=Ms().projection(J),Jn;const Gg=Og().x(e=>e.location[0]).y(e=>e.location[1]);function Wg(){const e=Object.keys(Ue),n=(e.findIndex(i=>Ue[i]===He)+1)%e.length;Yg(e[n])}function Yg(e){He=Ue[e],J=He(),J.translate([0,0]).rotate([0,0,0]).scale(Jt),Jt=J.scale(),Xi=Ms().projection(J)}function Me(e){const t=J.rotate();t[0]+=e[0],t[1]+=e[1],e.length===3&&(t[2]+=e[2]),J.rotate(t)}function Xg(e,t){ts=st(e),Nt=ts.select("svg"),Nt.attr("width","100vw").attr("height","100vh").attr("viewBox",`-${ni/2} -${re/2} ${ni} ${re}`).on("contextmenu",o=>o.preventDefault()),es(t.S),gc(t),mc(t),pc(t),Nt.call(n()),Nt.call(i()),window.addEventListener("resize",s);function n(){return r().on("drag.render",()=>j()).on("end.render",()=>j())}function i(){return Jp().filter(o=>o.type==="wheel").on("zoom",o=>{if(o.transform.k>ga){const a=Jt*o.transform.k;J.scale(a),j()}else o.transform.k=ga})}function r(){let o,a,l,u,h;function c(A,N){const I=Of(A,N);if(I.length!==h&&(h=I.length,h>1&&(u=Math.atan2(I[1][1]-I[0][1],I[1][0]-I[0][0])),f.apply(N,[A,N])),h>1){const $=ao(I,k=>k[0]),C=ao(I,k=>k[1]),P=Math.atan2(I[1][1]-I[0][1],I[1][0]-I[0][0]);return[$,C,P]}return I[0]}function f({x:A,y:N}){const I=S([A,N]);o=$t.cartesian(J.invert(I)),l=J.rotate(),a=$t(l)}function _(A){const N=S([A.x,A.y]),I=$t.cartesian(J.rotate(l).invert(N)),$=$t.delta(o,I);let C=$t.multiply(a,$);const P=c(A,this);if(P[2]){const k=(P[2]-u)/2,O=-Math.sin(k),D=Math.sign(Math.cos(k));C=$t.multiply([Math.sqrt(1-O*O),0,0,D*O],C)}J.rotate($t.rotation(C)),$[0]<.7&&f.apply(this,[A,this])}function S(A){const N=parseInt(Nt.style("width")),I=parseInt(Nt.style("height"));return[A[0]-N/2,A[1]-I/2]}return Uf().filter(A=>A.button===1||A.touches).on("start",f).on("drag",_)}function s(){const{S:o}=globalThis.gameManager.getContext();es(o)}}function es(e){const t=Nt.node()?.getBoundingClientRect(),n=window.devicePixelRatio||1,i=t?.height||re,r=t?.width||ni,a=ts.selectAll("canvas").data([null]).join(h=>h.append("canvas").style("position","absolute").style("top",0).style("left",0).style("z-index",-1).style("pointer-events","none")).attr("width",r*n).attr("height",i*n).style("width",`${r}px`).style("height",`${i}px`).node().getContext("2d");a.setTransform(1,0,0,1,0,0),a.scale(n,n),a.translate(r/2,i/2);const l=Math.min(r/ni,i/re);a.scale(l,l);const u="#FFFFFF48";if(He===Ue.Orthographic){const h=J.scale();a.strokeStyle=u,a.lineWidth=1,a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=10,a.shadowColor=u,a.beginPath(),a.arc(0,0,h,0,Math.PI*2),a.stroke(),a.fill()}{a.shadowBlur=0,a.strokeStyle="rgba(51, 51, 51, 0.5)";const h=Vg(e),c=Ms().projection(J).context(a);a.beginPath(),c(h),a.stroke()}}function Vg(e){const t=bp(),n=Cs(e);if(n){if(!Jn){const i=xi([0,90+n.location[1],0]),r=xi([n.location[0],0,0]);Jn={type:"FeatureCollection",features:t.lines().map(s=>({type:"Feature",geometry:{type:"LineString",coordinates:s.coordinates.map(o=>r(i(o)))}}))}}return Jn}return t()}function ma(e){const t=J.scale()*e;t<Jt*Ug||t>Jt*Hg||(J.scale(t),j())}function ns(){const e=globalThis.gameManager.getContext(),t=Cs(e.S);if(!t)return;Jn=null;const n=t.location;He===Ue.Orthographic?is([n[0],n[1]-45]):is(n),J.scale(Jt)}function Kg(e){const n=globalThis.gameManager.getContext().S.world.systemMap.get(e);n&&(is(n.location),J.scale(Jt))}function is(e){J.rotate([-e[0],-e[1],0]),j()}let ya=null;function j(){return cancelAnimationFrame(ya),ya=requestAnimationFrame(()=>e());function e(t){Nt&&(t??=globalThis.gameManager.getContext(),gc(t),es(t.S),pc(t),mc(t))}}function pc({S:e,C:t,P:n}){const r=J.scale()/Jt<1;let s=e.world.systemMap.values();n&&t.config.fow&&(s=n.revealedSystems.values().map(l=>e.world.systemMap.get(l))),s=s.filter(l=>!!Xi({type:"Point",coordinates:l.location}));const a=Nt.selectAll("g#systems").data([null]).join(l=>l.append("g").attr("id","systems")).classed("reduced-size",r).classed("hidden",!1).selectAll(".system").data(s,l=>l.id).join(l=>{const u=l.append("g").attr("class","system").attr("id",h=>h.id).on("click",(h,c)=>{Pi(h,c),j()}).on("contextmenu",(h,c)=>{h.preventDefault(),Pi(h,c),j()});return u.append("circle").attr("class","system-outline").attr("cx",0).attr("cy",0).attr("r",Fg/2),u.append("text").attr("class","ship-count").attr("y",-10).attr("x",0).attr("text-anchor","start"),u.append("text").attr("class","system-icon").attr("y",0).attr("x",0).attr("text-anchor","end"),u});a.style("--owner-color",l=>e.playerMap.get(l.ownerId)?.color??null).classed("own",l=>l.ownerId===t.playerId).classed("selected",l=>dc(l.id)).classed("moved",l=>l.movement[0]>0||l.movement[1]>0).classed("inhabited",l=>l.type==="INHABITED").classed("homeworld",l=>!!l.homeworld&&l.ownerId===l.homeworld).classed("visited",l=>n?n.visitedSystems.has(l.id):!0).attr("transform",l=>`translate(${J(l.location)})`),a.select(".system-icon").text(l=>l.homeworld&&l.ownerId===l.homeworld?"✶":l.type==="INHABITED"?"✦":"●"),a.select(".ship-count").text(l=>r?"":(l.type==="INHABITED"?"▴":"")+(l.ships?qg(l.ships):""))}const jg=(()=>{let e=[],t;return n=>{if(!e||t!==n.world.systemMap){t=n.world.systemMap;const i=Array.from(t.values());e=Gg.polygons(i).features}return e}})();function gc({S:e,C:t,P:n}){const r=J.scale()/Jt<1;let s=jg(e);n&&t.config.fow&&(s=s.filter(l=>{const u=l.properties?.site;return n.revealedSystems.has(u.id)})),Nt.selectAll("g#mesh").data([null]).join(l=>l.append("g").attr("id","mesh")).classed("reduced-size",r).classed("hidden",!1).selectAll("path").data(s).join(l=>l.append("path").classed("region",!0).on("click",(u,h)=>{Pi(u,h),j()}).on("contextmenu",(u,h)=>{u.preventDefault(),Pi(u,h),j()})).attr("d",l=>Xi(l)).datum(l=>l.properties.site).classed("visited",l=>n?n.visitedSystems.has(l.id):!0).style("--owner-color",l=>e.playerMap.get(l.ownerId)?.color??null)}function mc({S:e,C:t,P:n}){let i=e.world.laneMap.values();n&&t.config.fow&&(i=i.filter(o=>n.revealedSystems.has(o.fromId)&&n.revealedSystems.has(o.toId)));const s=Nt.selectAll("g#lanes").data([null]).join(o=>o.append("g").attr("id","lanes")).selectAll("g.lane-group").data(i,o=>o.id).join(o=>{const a=o.append("g").attr("class","lane-group").attr("id",l=>l.id).on("click",(l,u)=>{_a(l,u),j()}).on("contextmenu",(l,u)=>{l.preventDefault(),_a(l,u),j()});return a.append("path").attr("class","lane"),a.append("path").attr("class","pulse"),a}).datum(o=>{const a=e.world.systemMap.get(o.toId),l=e.world.systemMap.get(o.fromId),u=Xi({type:"LineString",coordinates:[l.location,a.location]});return{...o,from:e.world.systemMap.get(o.fromId),to:e.world.systemMap.get(o.toId),path:u}});s.style("--owner-color",o=>{const a=o.from;if(!a.ownerId)return null;const l=o.to;return!l.ownerId||a.ownerId!==l.ownerId?null:e.playerMap.get(a.ownerId)?.color??null}),s.select("path.lane").attr("d",o=>o.path).classed("own",o=>{const a=o.from,l=o.to;return a.ownerId===t.playerId||l.ownerId===t.playerId}).style("--path-length",o=>{const a=st(`#${o.id} .lane`).node();return a?a.getTotalLength():200}),s.select("path.pulse").attr("d",o=>o.path).classed("moved",o=>o.movement[0]>0||o.movement[1]>0).style("stroke-width",o=>{if(o.movement[0]===0&&o.movement[1]===0)return null;const a=2,l=Math.floor(Math.log2(Math.max(o.movement[0],o.movement[1])));return`${(a+l)*2}px`}).classed("moved--fwd",o=>o.movement[0]>o.movement[1]).classed("moved--bak",o=>o.movement[1]>o.movement[0])}function Qg(){document.getElementById("optionsButton")?.addEventListener("click",yc),document.getElementById("helpButton").addEventListener("click",_c)}async function yc(){if(await Zg()){const t=document.getElementById("optionsForm"),n=new FormData(t),i=globalThis.gameManager,r=+n.get("numBots"),s=n.get("playerName"),o=n.get("fow")==="on",a=+n.get("numSystems");i.setConfig({numBots:r,playerName:s,fow:o,numSystems:48*2**a})}}function Zg(){const e=document.getElementById("optionsDialog");return e.showModal(),new Promise(t=>{e.addEventListener("close",()=>t(!0)),e.addEventListener("cancel",()=>t(!1))})}function _c(){document.getElementById("helpDialog").showModal()}function rs(e){const t=document.getElementById("endDialog");return t.showModal(),t.querySelector("p#endMessage").textContent=e,new Promise(n=>{t.addEventListener("close",()=>n(!0)),t.addEventListener("cancel",()=>n(!1))})}function Jg(){const e=document.getElementById("startDialog");return e.showModal(),new Promise(t=>{e.addEventListener("close",()=>t(!0)),e.addEventListener("cancel",()=>t(!1))})}const $e=5;function tm(){st("body").on("keypress.controls",null),st("body").on("keyup.controls",null),st("body").on("keyup.cheats",null),Ua&&st("body").on("keyup.cheats",e=>{if(!e.altKey)return;e.preventDefault();const{S:t,C:n}=globalThis.gameManager.getContext();switch(e.code){case"KeyC":for(const i of t.world.systemMap.values())i.ownerId===n.playerId&&(i.ships*=2);j();return;case"KeyR":Ql(t),j();return;case"NumpadAdd":case"Equal":{const i=Math.min(16,n.config.timeScale*2);globalThis.gameManager.setConfig({timeScale:i}),Be(`Time scale increased to ${n.config.timeScale}x`);return}case"NumpadSubtract":case"Minus":{const i=Math.max(.25,n.config.timeScale/2);globalThis.gameManager.setConfig({timeScale:i}),Be(`Time scale decreased to ${n.config.timeScale}x`);return}}}),st("body").on("keyup.controls",async e=>{switch(e.key){case"Escape":me(),j();return;case"?":_c();return;case"x":{if(!e.ctrlKey)return;if(await rs("Are you sure you want to quit?")){const{C:n,E:i}=globalThis.gameManager.getContext();i.emit("PLAYER_QUIT",{playerId:n.playerId})}return}}}),st("body").on("keypress.controls",e=>{switch(e.code){case"Space":"pauseToggle"in globalThis.gameManager&&globalThis.gameManager.pauseToggle();return;case"Equal":case"NumpadAdd":ma(1.2),j();return;case"Minus":case"NumpadSubtract":ma(.8),j();return;case"KeyW":Me([0,$e]),j();return;case"KeyA":Me([-$e,0]),j();return;case"KeyS":Me([0,-$e]),j();return;case"KeyD":Me([$e,0]),j();return;case"KeyQ":Me([0,0,$e]),j();break;case"KeyE":Me([0,0,-$e]),j();break;case"KeyH":ns(),j();return;case"KeyC":it.last&&(Kg(it.last),j());return;case"KeyP":Wg(),ns(),j();return}})}function _a(e,t){const{S:n,C:i}=globalThis.gameManager.getContext();if(i.status==="PLAYING")switch(e.button){case 0:break;case 2:{let r=n.world.systemMap.get(t.fromId),s=n.world.systemMap.get(t.toId);if(r.ownerId!==i.playerId&&s.ownerId!==i.playerId)return;if(r.ownerId!==i.playerId){const o=r;r=s,s=o}else if(r.ownerId===r.ownerId&&s.ships>r.ships){const o=r;r=s,s=o}if(em(r.id,s.id),s.ownerId!==i.playerId)return;e.altKey||(!e.ctrlKey&&!e.shiftKey&&me(),_n(r.id),s.ownerId===i.playerId&&_n(s.id));break}}}function Pi(e,t){const n=globalThis.gameManager.getContext();if(n.C.status==="PLAYING")switch(Ua&&e.altKey&&(Be(""+t.id,t.lastMove?.message??"none",t.lastMove?.ships??0),console.log(t)),e.button){case 0:if(t.ownerId!==n.C.playerId)return;e.ctrlKey||e.metaKey?zg(t.id):e.shiftKey?Bg(n,t.id):Rg(t.id);break;case-1:case 2:{const i=Array.from(it.all);if(i.length===0)return;i.forEach(r=>{nm(r,t.id),t.ownerId===n.C.playerId&&(e.altKey||(!e.ctrlKey&&!e.shiftKey&&me(),_n(t.id)))});break}}}function em(e,t){const{S:n,E:i,C:r}=globalThis.gameManager.getContext();if(!Wi(n.world,e,t))return;const s={type:"BALANCED_MOVE",message:`Balanced move from ${e} to ${t}`,toId:t,fromId:e,playerId:r.playerId};i.emit("TAKE_ORDER",s)}function nm(e,t){const{S:n,E:i,C:r}=globalThis.gameManager.getContext();if(!Wi(n.world,e,t))return;const s={type:"MASS_MOVE",toId:t,fromId:e,playerId:r.playerId,message:`Mass move from ${e} to ${t}`};i.emit("TAKE_ORDER",s)}let wc=0;const Ci=[];function im(){wc=0,Ci.length=0;const{E:e}=globalThis.gameManager.getContext();e.emit("MESSAGES_UPDATED",{messages:Ci})}function Gn(e){const{C:t,E:n}=globalThis.gameManager.getContext();Ci.push({id:wc++,message:e,tick:t.tick}),n.emit("MESSAGES_UPDATED",{messages:Ci})}class rm{constructor(){this.listeners={}}on(t,n){return this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(n),()=>{this.listeners[t]=this.listeners[t].filter(i=>i!==n)}}emit(t,n){const i=this.listeners[t];if(i)for(const r of i)try{r(n)}catch(s){console.error(`Error in listener for event ${String(t)}:`,s)}}clear(){this.listeners={}}}class sm{constructor(){this.events=new rm,this.game=yg,this.state=Ps(),this.config=Kl(),this.tick=0,this.status="WAITING",this.runningInterval=null,this.#e()}getState(){return ii?Object.freeze({...this.state}):this.state}getConfig(){return ii?Object.freeze({...this.config}):this.config}setConfig(t){this.config={...this.config,...t}}getContext(){return{S:this.state,E:this.events,P:this.state.playerMap.get(this.playerId),C:{tick:this.tick,status:this.status,playerId:this.playerId,config:this.getConfig()}}}addPlayer(t){if(this.state.playerMap.has(t.id))return this.state.playerMap.get(t.id);const n=t.score??{userId:t.id,playerName:t.name??`Player ${this.state.playerMap.size+1}`,score:0,tick:0,timestamp:Date.now()},i={name:t.name??`Player ${this.state.playerMap.size+1}`,score:n,color:"#000000",...t,stats:{playerId:t.id,systems:0,ships:0,homeworld:0},isAlive:!0,visitedSystems:new Set,revealedSystems:new Set};return jl(this.state,i),i}gameStart(){this.status="PLAYING",this.tick=0,this.events.emit("GAME_START",void 0),this.#t()}gameStop(){this.status="FINISHED",this.stopGameLoop()}gameTick(){this.tick++,this.game.gameTick(this.getContext()),this.game.checkVictory(this.getContext()),this.events.emit("STATE_UPDATED",{state:this.state,status:this.status})}#t(){if(this.status!=="PLAYING"){this.gameStop();return}this.stopGameLoop(),this.gameTick(),this.events.emit("GAME_TICK",{tick:this.tick}),this.runningInterval=setTimeout(()=>this.#t(),zu/this.config.timeScale)}startGameLoop(){this.#t()}stopGameLoop(){this.runningInterval&&(clearTimeout(this.runningInterval),this.runningInterval=null)}#e(){this.events.on("GAME_STOP",()=>{this.gameStop()}),this.events.on("TAKE_ORDER",t=>{this.game.takeOrder(this.getContext(),t),this.events.emit("STATE_UPDATED",{state:this.state,status:this.status})})}}const wa=xn({length:5});class om extends sm{constructor(){super(),this.#t()}async connect(){this.gameStop(),this.status="WAITING";const t=await this.initializePlayer();this.addPlayer(t),this.playerId=t.id,this.events.emit("GAME_INIT",void 0),await Jg(),this.gameSetup(t),this.gameStart(),j()}gameSetup(t){const n=this.getContext();this.state=this.game.setup(n),im(),t.name=this.config.playerName;const i=this.onPlayerJoin(1,t);this.game.assignSystem(this.state,t.id);const r=yr+ +this.config.numBots;for(let s=2;s<=r;s++){const o=this.onPlayerJoin(s);this.game.assignSystem(this.state,o.id)}this.setupThisPlayer(i.id),localStorage.setItem("starz_playerId",i.id),localStorage.setItem("starz_playerName",i.name),localStorage.setItem("starz_score",i.score.score.toString())}async initializePlayer(){const t=this.playerId=localStorage.getItem("starz_playerId")??wa(),n=this.config.playerName,i=+(localStorage.getItem("starz_score")??0);return localStorage.setItem("starz_playerId",t),localStorage.setItem("starz_playerName",n),localStorage.setItem("starz_score",i.toString()),{id:t,name:n,score:{score:i}}}gameStart(){fr("starz_gamesStarted"),super.gameStart(),Gn("Game started.");const t=this.state.playerMap.get(this.playerId);t&&Gn(`You are Player ${t.name}.`)}gameStop(){super.gameStop(),me(),j()}onPlayerJoin(t,n={}){const i=ju[t],r=n.name??`Bot ${t}`,s=wa(),o=t>yr?new rg({playerIndex:t,id:s,name:r}):void 0;return this.addPlayer({id:s,name:r,bot:o,color:i,...n})}pauseToggle(){this.status==="PAUSED"?(this.status="PLAYING",super.startGameLoop()):this.status==="PLAYING"&&(this.status="PAUSED",super.stopGameLoop())}async onPlayerWin(t,n){n&&Gn(n),this.game.revealAllSystems(this.state),me();let i=!1;t===this.playerId?(fr("starz_gamesWon"),i=await rs("You have conquered The Bubble!")):(fr("starz_gamesLost",{winnerId:t}),i=await rs("You have lost your homeworld! Click to return to lobby.  ESC to spectate.")),i&&this.restart()}restart(){this.stopGameLoop(),me(),this.tick=0,this.state=this.game.initalState(),this.connect()}onEliminatePlayer(t,n){const i=this.state.playerMap.get(t),r=this.state.playerMap.get(n),s=n===null?`${i.name} has been eliminated!`:`${r.name} has eliminated ${i.name}!`;Gn(s),t===this.playerId?(this.submitWinLoss(-1),this.onPlayerWin(n)):n===this.playerId&&this.submitWinLoss(1)}async submitWinLoss(t){const n=+(localStorage.getItem("starz_score")??0)+t;localStorage.setItem("starz_score",n.toString())}addPlayer(t){const n=super.addPlayer({color:t.color??am(),...t});return document.documentElement.style.setProperty(`--player-${n.id}`,n.color),n}setupThisPlayer(t){this.playerId=t;const n=this.state.playerMap.get(t),i=this.game.getPlayersHomeworld(this.state);this.game.visitSystem(this.state,i),ns(),n.bot||(me(),_n(i.id))}#t(){Qg(),tm(),this.events.on("PLAYER_WIN",({playerId:t,message:n})=>{this.onPlayerWin(t,n)}),this.events.on("PLAYER_ELIMINATED",({loserId:t,winnerId:n})=>{this.onEliminatePlayer(t,n)}),this.events.on("PLAYER_QUIT",({playerId:t})=>{this.game.eliminatePlayer(this.getContext(),t)})}}function am(){const e="0123456789ABCDEF";let t="#";for(let n=0;n<6;n++)t+=e[Math.floor(Math.random()*16)];return t}const lm=xn({length:4}),cm=xn({length:28}),um="localhost:1999",va="localhost:5173/api/",pr="starz-game-room-leaderboard-prod";class hm extends om{async playkitConnect(t,n,i){return console.log("Connecting to PartyKit..."),this.partySocket=new tr({host:um,room:pr,query:{playerId:t,playerToken:n,playerName:i}}),new Promise((r,s)=>{this.partySocket.onopen=()=>{console.log("Connected to PartyKit"),r()},this.partySocket.onerror=o=>{console.error("PartyKit connection error:",o),s(o)}})}async initializePlayer(){console.log("Initializing player..."),this.playerId=localStorage.getItem("starz_playerId")??lm(),localStorage.setItem("starz_playerId",this.playerId),this.playerToken=localStorage.getItem("starz_playerToken")??cm(),localStorage.setItem("starz_playerToken",this.playerToken);const t=localStorage.getItem("starz_playerName")??this.config.playerName;localStorage.setItem("starz_playerName",t);let n=+(localStorage.getItem("starz_score")??"0");return localStorage.setItem("starz_score",n.toString()),this.partySocket||(await this.playkitConnect(this.playerId,this.playerToken,t),this.#t(),n=await new Promise(i=>{const r=s=>{const o=JSON.parse(s.data);o.type==="init"&&(n=o.playerEntry.score,localStorage.setItem("starz_score",n.toString()),this.partySocket.removeEventListener("message",r),i(n))};this.partySocket.addEventListener("message",r)})),{id:this.playerId,name:t,score:{score:n}}}async submitWinLoss(t){super.submitWinLoss(t),console.assert(t===1||t===-1,"deltaScore must be 1 or -1");const n=this.state.playerMap.get(this.playerId);if(!n)return;const i={type:t>0?"increment":"decrement",playerId:this.playerId,playerToken:this.playerToken,playerName:n.name};tr.fetch({host:va,room:pr},{method:"POST",body:JSON.stringify(i)})}async loadLeaderboard(){return await(await tr.fetch({host:va,room:pr},{method:"GET",headers:{"Content-Type":"application/json"}})).json()}#t(){this.partySocket.addEventListener("message",t=>{const n=JSON.parse(t.data);switch(n.type){case"init":{console.log("Initial leaderboard data:"),console.table(n.leaderboard);break}default:"message"in n?console.log(n.message):"error"in n&&console.error("PartyKit error:",n.error);break}})}}const qe=Symbol("game-manager");var fm=Object.defineProperty,dm=Object.getOwnPropertyDescriptor,vc=(e,t,n,i)=>{for(var r=i>1?void 0:i?dm(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(r=(i?o(t,n,r):o(r))||r);return i&&r&&fm(t,n,r),r};let ss=class extends Ut{constructor(){super(...arguments),this.gameManager=new hm}connectedCallback(){super.connectedCallback(),globalThis.gameManager=this.gameManager,this.gameManager.connect()}createRenderRoot(){return this}};vc([Ec({context:qe}),jc()],ss.prototype,"gameManager",2);ss=vc([Fe("app-root")],ss);var pm=Object.defineProperty,gm=Object.getOwnPropertyDescriptor,Rs=(e,t,n,i)=>{for(var r=i>1?void 0:i?gm(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(r=(i?o(t,n,r):o(r))||r);return i&&r&&pm(t,n,r),r};const mm=Ss(".3~s");let ki=class extends Ut{constructor(){super(...arguments),this.stats=[]}connectedCallback(){super.connectedCallback(),this.gameManager.events.on("STATE_UPDATED",({state:e})=>{const t=Array.from(e.playerMap.values());this.stats=t.sort((n,i)=>i.stats.systems-n.stats.systems||i.stats.ships-n.stats.ships)})}createRenderRoot(){return this}render(){return Bt`
      <table id="leaderbox">
        ${this.renderHeader()} ${this.renderBody()}
      </table>
    `}renderBody(){return Bt`<tbody>
      ${this.stats.map(t=>Bt`<tr
            style="--owner-color: ${t.color||null}"
            title="${t.bot?t.bot.name:"Human"}"
            class="${t.isAlive?"":"eliminated"}"
          >
            <td>${" "}${t.name}${" "}</td>
            <td>${" "}${t.stats.systems}${" "}</td>
            <td>${" "}${mm(t.stats.ships)}${" "}</td>
          </tr>`)}
    </tbody>`}renderHeader(){return Bt`<thead>
        <tr>
          <th>Player</th>
          <th>Systems</th>
          <th>Ships</th>
        </tr>
      </thead>
      <tbody></tbody>`}};Rs([wn({context:qe,subscribe:!0}),yt({attribute:!1})],ki.prototype,"gameManager",2);Rs([yt()],ki.prototype,"stats",2);ki=Rs([Fe("leaderboard-element")],ki);var ym=Object.defineProperty,_m=Object.getOwnPropertyDescriptor,Ds=(e,t,n,i)=>{for(var r=i>1?void 0:i?_m(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(r=(i?o(t,n,r):o(r))||r);return i&&r&&ym(t,n,r),r};let Oi=class extends Ut{constructor(){super(...arguments),this.tick=0}connectedCallback(){super.connectedCallback(),this.gameManager.events.on("GAME_TICK",({tick:e})=>{this.tick=e??0})}createRenderRoot(){return this}render(){const e=~~(this.tick/2),t=this.tick%2===1?".":"";return Bt`${e}${t}`}};Ds([wn({context:qe,subscribe:!0}),yt({attribute:!1})],Oi.prototype,"gameManager",2);Ds([yt({type:Number})],Oi.prototype,"tick",2);Oi=Ds([Fe("tick-box")],Oi);var wm=Object.defineProperty,vm=Object.getOwnPropertyDescriptor,be=(e,t,n,i)=>{for(var r=i>1?void 0:i?vm(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(r=(i?o(t,n,r):o(r))||r);return i&&r&&wm(t,n,r),r};let se=class extends Ut{constructor(){super(...arguments),this.version=xa,this.playerName="Player",this.playerScore=0,this.playerRank=null,this.shortId=""}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this.updatePlayerInfo(),this.gameManager.events.on("GAME_INIT",()=>{this.updatePlayerInfo()})}render(){return Bt`
      <article>
        <h1>STARZ!</h1>
        <small class="version">v${this.version}</small>

        <div class="lore">
          <p>
            Nobody knows why <i>The Bubble</i> exists, or who built the lattice
            of hyperspace lanes threading its hundreds of star systems together
            like a cosmic web. Its discovery was accidental - a distortion
            ripple detected on the edge of settled space, leading explorers to
            the shimmering boundary of a region where physics seemed... wrong.
          </p>
          <p>
            What <i>is</i> known is this: control of <i>The Bubble</i> means
            control of immense resources and power. Rival factions flood its
            systems, each desperate to carve out their claim before somebody
            else does.
          </p>
          <p>
            As a commander, you are the spearhead of your faction's ambitions:
            tasked with expanding your influence, capturing systems, and
            ultimately dominating <i>The Bubble</i>.
          </p>
        </div>

        <h3>Protect our homeworld. Capture the enemy systems.</h3>
        <form method="dialog">
          <div class="grid">
            <div>
              <input
                name="playerName"
                id="playerNameInput"
                type="text"
                value="${this.playerName}"
                placeholder="Player Name"
                minlength="1"
                maxlength="30"
                required
              />
              <small>(Name will be used in leaderboard)</small>
            </div>
            <div>
              ${this.playerName} [${this.shortId}]
              <span>✶ ${this.playerScore}</span>
              <br /><small
                >${this.playerRank?`Rank: ${this.playerRank}`:""}</small
              >
            </div>
          </div>

          <br /><button type="button" @click="${this.onPlay}">Play</button>
          <br /><button type="button" @click="${this.onOptions}">
            Options
          </button>
        </form>
      </article>
    `}updatePlayerInfo(){const{P:e,C:t}=this.gameManager.getContext();this.playerName=e?.name??t.config?.playerName??"Player",this.playerScore=e?.score.score??0,this.playerRank=e?.score?.rank??null,this.shortId=t.playerId.length===4?t.playerId:xm(t.playerId)}onPlay(){const t=this.querySelector("#playerNameInput").value.trim()||"Player";this.gameManager.setConfig({playerName:t}),this.closest("dialog").close()}onOptions(){yc()}};be([wn({context:qe,subscribe:!0}),yt({attribute:!1})],se.prototype,"gameManager",2);be([yt()],se.prototype,"version",2);be([yt()],se.prototype,"playerName",2);be([yt()],se.prototype,"playerScore",2);be([yt()],se.prototype,"playerRank",2);be([yt()],se.prototype,"shortId",2);se=be([Fe("start-dialog-content")],se);function xm(e){const t=e+name,n=Array.from(t).reduce((i,r)=>(i<<5)-i+r.charCodeAt(0),0);return Math.abs(n).toString(36).substring(0,4)}const bm={CHILD:2},Sm=e=>(...t)=>({_$litDirective$:e,values:t});class Em{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,n,i){this._$Ct=t,this._$AM=n,this._$Ci=i}_$AS(t,n){return this.update(t,n)}update(t,n){return this.render(...n)}}class os extends Em{constructor(t){if(super(t),this.it=et,t.type!==bm.CHILD)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(t){if(t===et||t==null)return this._t=void 0,this.it=t;if(t===we)return t;if(typeof t!="string")throw Error(this.constructor.directiveName+"() called with a non-string value");if(t===this.it)return this._t;this.it=t;const n=[t];return n.raw=n,this._t={_$litType$:this.constructor.resultType,strings:n,values:[]}}}os.directiveName="unsafeHTML",os.resultType=1;const Mm=Sm(os);var $m=Object.defineProperty,Am=Object.getOwnPropertyDescriptor,zs=(e,t,n,i)=>{for(var r=i>1?void 0:i?Am(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(r=(i?o(t,n,r):o(r))||r);return i&&r&&$m(t,n,r),r};let Li=class extends Ut{constructor(){super(...arguments),this.messages=[]}connectedCallback(){super.connectedCallback(),this.gameManager.events.on("MESSAGES_UPDATED",({messages:e})=>{this.messages=(e??[]).slice(-5)})}createRenderRoot(){return this}render(){return this.messages.length>0?Bt`${this.messages.map(e=>{const t=~~(e.tick/2),n=e.tick%2===1?".":"";return Bt`<div>
          ${Mm(e.message)} <small>${t}${n}</small>
        </div>`})}`:Bt``}};zs([wn({context:qe,subscribe:!0}),yt({attribute:!1})],Li.prototype,"gameManager",2);zs([yt()],Li.prototype,"messages",2);Li=zs([Fe("message-box")],Li);var Im=Object.defineProperty,Tm=Object.getOwnPropertyDescriptor,xc=(e,t,n,i)=>{for(var r=i>1?void 0:i?Tm(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(r=(i?o(t,n,r):o(r))||r);return i&&r&&Im(t,n,r),r};let as=class extends Ut{connectedCallback(){super.connectedCallback(),this.gameManager.events.on("GAME_START",()=>{Xg(document.getElementById("app"),this.gameManager.getContext())}),this.gameManager.events.on("STATE_UPDATED",()=>{j()})}createRenderRoot(){return this}render(){return Bt`
      <canvas></canvas>
      <svg></svg>
    `}};xc([wn({context:qe,subscribe:!0}),yt({attribute:!1})],as.prototype,"gameManager",2);as=xc([Fe("game-canvas")],as);console.log(`starz.io version ${xa}`);

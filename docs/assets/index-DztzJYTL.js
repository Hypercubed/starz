(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();const Zf="0.0.6";let ed=class extends Event{constructor(e,n,i,r){super("context-request",{bubbles:!0,composed:!0}),this.context=e,this.contextTarget=n,this.callback=i,this.subscribe=r??!1}};let uu=class{constructor(e,n,i,r){if(this.subscribe=!1,this.provided=!1,this.value=void 0,this.t=(s,o)=>{this.unsubscribe&&(this.unsubscribe!==o&&(this.provided=!1,this.unsubscribe()),this.subscribe||this.unsubscribe()),this.value=s,this.host.requestUpdate(),this.provided&&!this.subscribe||(this.provided=!0,this.callback&&this.callback(s,o)),this.unsubscribe=o},this.host=e,n.context!==void 0){const s=n;this.context=s.context,this.callback=s.callback,this.subscribe=s.subscribe??!1}else this.context=n,this.callback=i,this.subscribe=r??!1;this.host.addController(this)}hostConnected(){this.dispatchRequest()}hostDisconnected(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=void 0)}dispatchRequest(){this.host.dispatchEvent(new ed(this.context,this.host,this.t,this.subscribe))}};let c_=class{get value(){return this.o}set value(e){this.setValue(e)}setValue(e,n=!1){const i=n||!Object.is(e,this.o);this.o=e,i&&this.updateObservers()}constructor(e){this.subscriptions=new Map,this.updateObservers=()=>{for(const[n,{disposer:i}]of this.subscriptions)n(this.o,i)},e!==void 0&&(this.value=e)}addCallback(e,n,i){if(!i)return void e(this.value);this.subscriptions.has(e)||this.subscriptions.set(e,{disposer:()=>{this.subscriptions.delete(e)},consumerHost:n});const{disposer:r}=this.subscriptions.get(e);e(this.value,r)}clearCallbacks(){this.subscriptions.clear()}};let u_=class extends Event{constructor(e,n){super("context-provider",{bubbles:!0,composed:!0}),this.context=e,this.contextTarget=n}},hu=class extends c_{constructor(e,n,i){super(n.context!==void 0?n.initialValue:i),this.onContextRequest=r=>{if(r.context!==this.context)return;const s=r.contextTarget??r.composedPath()[0];s!==this.host&&(r.stopPropagation(),this.addCallback(r.callback,s,r.subscribe))},this.onProviderRequest=r=>{if(r.context!==this.context||(r.contextTarget??r.composedPath()[0])===this.host)return;const s=new Set;for(const[o,{consumerHost:a}]of this.subscriptions)s.has(o)||(s.add(o),a.dispatchEvent(new ed(this.context,a,o,!0)));r.stopPropagation()},this.host=e,n.context!==void 0?this.context=n.context:this.context=n,this.attachListeners(),this.host.addController?.(this)}attachListeners(){this.host.addEventListener("context-request",this.onContextRequest),this.host.addEventListener("context-provider",this.onProviderRequest)}hostConnected(){this.host.dispatchEvent(new u_(this.context,this.host))}};function h_({context:t}){return(e,n)=>{const i=new WeakMap;if(typeof n=="object")return{get(){return e.get.call(this)},set(r){return i.get(this).setValue(r),e.set.call(this,r)},init(r){return i.set(this,new hu(this,{context:t,initialValue:r})),r}};{e.constructor.addInitializer((o=>{i.set(o,new hu(o,{context:t}))}));const r=Object.getOwnPropertyDescriptor(e,n);let s;if(r===void 0){const o=new WeakMap;s={get(){return o.get(this)},set(a){i.get(this).setValue(a),o.set(this,a)},configurable:!0,enumerable:!0}}else{const o=r.set;s={...r,set(a){i.get(this).setValue(a),o?.call(this,a)}}}return void Object.defineProperty(e,n,s)}}}function Ir({context:t,subscribe:e}){return(n,i)=>{typeof i=="object"?i.addInitializer((function(){new uu(this,{context:t,callback:r=>{n.set.call(this,r)},subscribe:e})})):n.constructor.addInitializer((r=>{new uu(r,{context:t,callback:s=>{r[i]=s},subscribe:e})}))}}const os=globalThis,Vl=os.ShadowRoot&&(os.ShadyCSS===void 0||os.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,td=Symbol(),fu=new WeakMap;let f_=class{constructor(e,n,i){if(this._$cssResult$=!0,i!==td)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=n}get styleSheet(){let e=this.o;const n=this.t;if(Vl&&e===void 0){const i=n!==void 0&&n.length===1;i&&(e=fu.get(n)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),i&&fu.set(n,e))}return e}toString(){return this.cssText}};const d_=t=>new f_(typeof t=="string"?t:t+"",void 0,td),p_=(t,e)=>{if(Vl)t.adoptedStyleSheets=e.map((n=>n instanceof CSSStyleSheet?n:n.styleSheet));else for(const n of e){const i=document.createElement("style"),r=os.litNonce;r!==void 0&&i.setAttribute("nonce",r),i.textContent=n.cssText,t.appendChild(i)}},du=Vl?t=>t:t=>t instanceof CSSStyleSheet?(e=>{let n="";for(const i of e.cssRules)n+=i.cssText;return d_(n)})(t):t;const{is:g_,defineProperty:m_,getOwnPropertyDescriptor:__,getOwnPropertyNames:y_,getOwnPropertySymbols:v_,getPrototypeOf:w_}=Object,Co=globalThis,pu=Co.trustedTypes,E_=pu?pu.emptyScript:"",I_=Co.reactiveElementPolyfillSupport,Vi=(t,e)=>t,ws={toAttribute(t,e){switch(e){case Boolean:t=t?E_:null;break;case Object:case Array:t=t==null?t:JSON.stringify(t)}return t},fromAttribute(t,e){let n=t;switch(e){case Boolean:n=t!==null;break;case Number:n=t===null?null:Number(t);break;case Object:case Array:try{n=JSON.parse(t)}catch{n=null}}return n}},ql=(t,e)=>!g_(t,e),gu={attribute:!0,type:String,converter:ws,reflect:!1,useDefault:!1,hasChanged:ql};Symbol.metadata??=Symbol("metadata"),Co.litPropertyMetadata??=new WeakMap;let Wn=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,n=gu){if(n.state&&(n.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((n=Object.create(n)).wrapped=!0),this.elementProperties.set(e,n),!n.noAccessor){const i=Symbol(),r=this.getPropertyDescriptor(e,i,n);r!==void 0&&m_(this.prototype,e,r)}}static getPropertyDescriptor(e,n,i){const{get:r,set:s}=__(this.prototype,e)??{get(){return this[n]},set(o){this[n]=o}};return{get:r,set(o){const a=r?.call(this);s?.call(this,o),this.requestUpdate(e,a,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??gu}static _$Ei(){if(this.hasOwnProperty(Vi("elementProperties")))return;const e=w_(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(Vi("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Vi("properties"))){const n=this.properties,i=[...y_(n),...v_(n)];for(const r of i)this.createProperty(r,n[r])}const e=this[Symbol.metadata];if(e!==null){const n=litPropertyMetadata.get(e);if(n!==void 0)for(const[i,r]of n)this.elementProperties.set(i,r)}this._$Eh=new Map;for(const[n,i]of this.elementProperties){const r=this._$Eu(n,i);r!==void 0&&this._$Eh.set(r,n)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const n=[];if(Array.isArray(e)){const i=new Set(e.flat(1/0).reverse());for(const r of i)n.unshift(du(r))}else e!==void 0&&n.push(du(e));return n}static _$Eu(e,n){const i=n.attribute;return i===!1?void 0:typeof i=="string"?i:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((e=>e(this)))}addController(e){(this._$EO??=new Set).add(e),this.renderRoot!==void 0&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,n=this.constructor.elementProperties;for(const i of n.keys())this.hasOwnProperty(i)&&(e.set(i,this[i]),delete this[i]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return p_(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((e=>e.hostConnected?.()))}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach((e=>e.hostDisconnected?.()))}attributeChangedCallback(e,n,i){this._$AK(e,i)}_$ET(e,n){const i=this.constructor.elementProperties.get(e),r=this.constructor._$Eu(e,i);if(r!==void 0&&i.reflect===!0){const s=(i.converter?.toAttribute!==void 0?i.converter:ws).toAttribute(n,i.type);this._$Em=e,s==null?this.removeAttribute(r):this.setAttribute(r,s),this._$Em=null}}_$AK(e,n){const i=this.constructor,r=i._$Eh.get(e);if(r!==void 0&&this._$Em!==r){const s=i.getPropertyOptions(r),o=typeof s.converter=="function"?{fromAttribute:s.converter}:s.converter?.fromAttribute!==void 0?s.converter:ws;this._$Em=r;const a=o.fromAttribute(n,s.type);this[r]=a??this._$Ej?.get(r)??a,this._$Em=null}}requestUpdate(e,n,i){if(e!==void 0){const r=this.constructor,s=this[e];if(i??=r.getPropertyOptions(e),!((i.hasChanged??ql)(s,n)||i.useDefault&&i.reflect&&s===this._$Ej?.get(e)&&!this.hasAttribute(r._$Eu(e,i))))return;this.C(e,n,i)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(e,n,{useDefault:i,reflect:r,wrapped:s},o){i&&!(this._$Ej??=new Map).has(e)&&(this._$Ej.set(e,o??n??this[e]),s!==!0||o!==void 0)||(this._$AL.has(e)||(this.hasUpdated||i||(n=void 0),this._$AL.set(e,n)),r===!0&&this._$Em!==e&&(this._$Eq??=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(n){Promise.reject(n)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[r,s]of this._$Ep)this[r]=s;this._$Ep=void 0}const i=this.constructor.elementProperties;if(i.size>0)for(const[r,s]of i){const{wrapped:o}=s,a=this[r];o!==!0||this._$AL.has(r)||a===void 0||this.C(r,void 0,s,a)}}let e=!1;const n=this._$AL;try{e=this.shouldUpdate(n),e?(this.willUpdate(n),this._$EO?.forEach((i=>i.hostUpdate?.())),this.update(n)):this._$EM()}catch(i){throw e=!1,this._$EM(),i}e&&this._$AE(n)}willUpdate(e){}_$AE(e){this._$EO?.forEach((n=>n.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach((n=>this._$ET(n,this[n]))),this._$EM()}updated(e){}firstUpdated(e){}};Wn.elementStyles=[],Wn.shadowRootOptions={mode:"open"},Wn[Vi("elementProperties")]=new Map,Wn[Vi("finalized")]=new Map,I_?.({ReactiveElement:Wn}),(Co.reactiveElementVersions??=[]).push("2.1.1");const Gl=globalThis,Es=Gl.trustedTypes,mu=Es?Es.createPolicy("lit-html",{createHTML:t=>t}):void 0,nd="$lit$",Gt=`lit$${Math.random().toFixed(9).slice(2)}$`,id="?"+Gt,S_=`<${id}>`,Tn=document,er=()=>Tn.createComment(""),tr=t=>t===null||typeof t!="object"&&typeof t!="function",jl=Array.isArray,b_=t=>jl(t)||typeof t?.[Symbol.iterator]=="function",ea=`[ 	
\f\r]`,Ai=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,_u=/-->/g,yu=/>/g,dn=RegExp(`>|${ea}(?:([^\\s"'>=/]+)(${ea}*=${ea}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),vu=/'/g,wu=/"/g,rd=/^(?:script|style|textarea|title)$/i,C_=t=>(e,...n)=>({_$litType$:t,strings:e,values:n}),gt=C_(1),An=Symbol.for("lit-noChange"),de=Symbol.for("lit-nothing"),Eu=new WeakMap,_n=Tn.createTreeWalker(Tn,129);function sd(t,e){if(!jl(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return mu!==void 0?mu.createHTML(e):e}const T_=(t,e)=>{const n=t.length-1,i=[];let r,s=e===2?"<svg>":e===3?"<math>":"",o=Ai;for(let a=0;a<n;a++){const l=t[a];let c,h,u=-1,f=0;for(;f<l.length&&(o.lastIndex=f,h=o.exec(l),h!==null);)f=o.lastIndex,o===Ai?h[1]==="!--"?o=_u:h[1]!==void 0?o=yu:h[2]!==void 0?(rd.test(h[2])&&(r=RegExp("</"+h[2],"g")),o=dn):h[3]!==void 0&&(o=dn):o===dn?h[0]===">"?(o=r??Ai,u=-1):h[1]===void 0?u=-2:(u=o.lastIndex-h[2].length,c=h[1],o=h[3]===void 0?dn:h[3]==='"'?wu:vu):o===wu||o===vu?o=dn:o===_u||o===yu?o=Ai:(o=dn,r=void 0);const d=o===dn&&t[a+1].startsWith("/>")?" ":"";s+=o===Ai?l+S_:u>=0?(i.push(c),l.slice(0,u)+nd+l.slice(u)+Gt+d):l+Gt+(u===-2?a:d)}return[sd(t,s+(t[n]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),i]};class nr{constructor({strings:e,_$litType$:n},i){let r;this.parts=[];let s=0,o=0;const a=e.length-1,l=this.parts,[c,h]=T_(e,n);if(this.el=nr.createElement(c,i),_n.currentNode=this.el.content,n===2||n===3){const u=this.el.content.firstChild;u.replaceWith(...u.childNodes)}for(;(r=_n.nextNode())!==null&&l.length<a;){if(r.nodeType===1){if(r.hasAttributes())for(const u of r.getAttributeNames())if(u.endsWith(nd)){const f=h[o++],d=r.getAttribute(u).split(Gt),w=/([.?@])?(.*)/.exec(f);l.push({type:1,index:s,name:w[2],strings:d,ctor:w[1]==="."?x_:w[1]==="?"?N_:w[1]==="@"?M_:To}),r.removeAttribute(u)}else u.startsWith(Gt)&&(l.push({type:6,index:s}),r.removeAttribute(u));if(rd.test(r.tagName)){const u=r.textContent.split(Gt),f=u.length-1;if(f>0){r.textContent=Es?Es.emptyScript:"";for(let d=0;d<f;d++)r.append(u[d],er()),_n.nextNode(),l.push({type:2,index:++s});r.append(u[f],er())}}}else if(r.nodeType===8)if(r.data===id)l.push({type:2,index:s});else{let u=-1;for(;(u=r.data.indexOf(Gt,u+1))!==-1;)l.push({type:7,index:s}),u+=Gt.length-1}s++}}static createElement(e,n){const i=Tn.createElement("template");return i.innerHTML=e,i}}function ni(t,e,n=t,i){if(e===An)return e;let r=i!==void 0?n._$Co?.[i]:n._$Cl;const s=tr(e)?void 0:e._$litDirective$;return r?.constructor!==s&&(r?._$AO?.(!1),s===void 0?r=void 0:(r=new s(t),r._$AT(t,n,i)),i!==void 0?(n._$Co??=[])[i]=r:n._$Cl=r),r!==void 0&&(e=ni(t,r._$AS(t,e.values),r,i)),e}class A_{constructor(e,n){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:n},parts:i}=this._$AD,r=(e?.creationScope??Tn).importNode(n,!0);_n.currentNode=r;let s=_n.nextNode(),o=0,a=0,l=i[0];for(;l!==void 0;){if(o===l.index){let c;l.type===2?c=new Sr(s,s.nextSibling,this,e):l.type===1?c=new l.ctor(s,l.name,l.strings,this,e):l.type===6&&(c=new k_(s,this,e)),this._$AV.push(c),l=i[++a]}o!==l?.index&&(s=_n.nextNode(),o++)}return _n.currentNode=Tn,r}p(e){let n=0;for(const i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(e,i,n),n+=i.strings.length-2):i._$AI(e[n])),n++}}class Sr{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,n,i,r){this.type=2,this._$AH=de,this._$AN=void 0,this._$AA=e,this._$AB=n,this._$AM=i,this.options=r,this._$Cv=r?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const n=this._$AM;return n!==void 0&&e?.nodeType===11&&(e=n.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,n=this){e=ni(this,e,n),tr(e)?e===de||e==null||e===""?(this._$AH!==de&&this._$AR(),this._$AH=de):e!==this._$AH&&e!==An&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):b_(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==de&&tr(this._$AH)?this._$AA.nextSibling.data=e:this.T(Tn.createTextNode(e)),this._$AH=e}$(e){const{values:n,_$litType$:i}=e,r=typeof i=="number"?this._$AC(e):(i.el===void 0&&(i.el=nr.createElement(sd(i.h,i.h[0]),this.options)),i);if(this._$AH?._$AD===r)this._$AH.p(n);else{const s=new A_(r,this),o=s.u(this.options);s.p(n),this.T(o),this._$AH=s}}_$AC(e){let n=Eu.get(e.strings);return n===void 0&&Eu.set(e.strings,n=new nr(e)),n}k(e){jl(this._$AH)||(this._$AH=[],this._$AR());const n=this._$AH;let i,r=0;for(const s of e)r===n.length?n.push(i=new Sr(this.O(er()),this.O(er()),this,this.options)):i=n[r],i._$AI(s),r++;r<n.length&&(this._$AR(i&&i._$AB.nextSibling,r),n.length=r)}_$AR(e=this._$AA.nextSibling,n){for(this._$AP?.(!1,!0,n);e!==this._$AB;){const i=e.nextSibling;e.remove(),e=i}}setConnected(e){this._$AM===void 0&&(this._$Cv=e,this._$AP?.(e))}}class To{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,n,i,r,s){this.type=1,this._$AH=de,this._$AN=void 0,this.element=e,this.name=n,this._$AM=r,this.options=s,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=de}_$AI(e,n=this,i,r){const s=this.strings;let o=!1;if(s===void 0)e=ni(this,e,n,0),o=!tr(e)||e!==this._$AH&&e!==An,o&&(this._$AH=e);else{const a=e;let l,c;for(e=s[0],l=0;l<s.length-1;l++)c=ni(this,a[i+l],n,l),c===An&&(c=this._$AH[l]),o||=!tr(c)||c!==this._$AH[l],c===de?e=de:e!==de&&(e+=(c??"")+s[l+1]),this._$AH[l]=c}o&&!r&&this.j(e)}j(e){e===de?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class x_ extends To{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===de?void 0:e}}class N_ extends To{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==de)}}class M_ extends To{constructor(e,n,i,r,s){super(e,n,i,r,s),this.type=5}_$AI(e,n=this){if((e=ni(this,e,n,0)??de)===An)return;const i=this._$AH,r=e===de&&i!==de||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,s=e!==de&&(i===de||r);r&&this.element.removeEventListener(this.name,this,i),s&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class k_{constructor(e,n,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=n,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){ni(this,e)}}const P_=Gl.litHtmlPolyfillSupport;P_?.(nr,Sr),(Gl.litHtmlVersions??=[]).push("3.3.1");const R_=(t,e,n)=>{const i=n?.renderBefore??e;let r=i._$litPart$;if(r===void 0){const s=n?.renderBefore??null;i._$litPart$=r=new Sr(e.insertBefore(er(),s),s,void 0,n??{})}return r._$AI(t),r};const Kl=globalThis;let mt=class extends Wn{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const n=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=R_(n,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return An}};mt._$litElement$=!0,mt.finalized=!0,Kl.litElementHydrateSupport?.({LitElement:mt});const O_=Kl.litElementPolyfillSupport;O_?.({LitElement:mt});(Kl.litElementVersions??=[]).push("4.2.1");const mi=t=>(e,n)=>{n!==void 0?n.addInitializer((()=>{customElements.define(t,e)})):customElements.define(t,e)};const D_={attribute:!0,type:String,converter:ws,reflect:!1,hasChanged:ql},L_=(t=D_,e,n)=>{const{kind:i,metadata:r}=n;let s=globalThis.litPropertyMetadata.get(r);if(s===void 0&&globalThis.litPropertyMetadata.set(r,s=new Map),i==="setter"&&((t=Object.create(t)).wrapped=!0),s.set(n.name,t),i==="accessor"){const{name:o}=n;return{set(a){const l=e.get.call(this);e.set.call(this,a),this.requestUpdate(o,l,t)},init(a){return a!==void 0&&this.C(o,void 0,t,a),a}}}if(i==="setter"){const{name:o}=n;return function(a){const l=this[o];e.call(this,a),this.requestUpdate(o,l,t)}}throw Error("Unsupported decorator location: "+i)};function Be(t){return(e,n)=>typeof n=="object"?L_(t,e,n):((i,r,s)=>{const o=r.hasOwnProperty(s);return r.constructor.createProperty(s,i),o?Object.getOwnPropertyDescriptor(r,s):void 0})(t,e,n)}function $_(t){return Be({...t,state:!0,attribute:!1})}const Fr=BigInt(2**32-1),Iu=BigInt(32);function F_(t,e=!1){return e?{h:Number(t&Fr),l:Number(t>>Iu&Fr)}:{h:Number(t>>Iu&Fr)|0,l:Number(t&Fr)|0}}function U_(t,e=!1){const n=t.length;let i=new Uint32Array(n),r=new Uint32Array(n);for(let s=0;s<n;s++){const{h:o,l:a}=F_(t[s],e);[i[s],r[s]]=[o,a]}return[i,r]}const B_=(t,e,n)=>t<<n|e>>>32-n,H_=(t,e,n)=>e<<n|t>>>32-n,z_=(t,e,n)=>e<<n-32|t>>>64-n,W_=(t,e,n)=>t<<n-32|e>>>64-n;function V_(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Su(t,e=""){if(!Number.isSafeInteger(t)||t<0){const n=e&&`"${e}" `;throw new Error(`${n}expected integer >= 0, got ${t}`)}}function ka(t,e,n=""){const i=V_(t),r=t?.length;if(!i||e!==void 0){const o=n&&`"${n}" `,a="",l=i?`length=${r}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+l)}return t}function bu(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function q_(t,e){ka(t,void 0,"digestInto() output");const n=e.outputLen;if(t.length<n)throw new Error('"digestInto() output" expected to be of length >='+n)}function G_(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function od(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}const j_=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function K_(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Y_(t){for(let e=0;e<t.length;e++)t[e]=K_(t[e]);return t}const Cu=j_?t=>t:Y_;function X_(t,e={}){const n=(r,s)=>t(s).update(r).digest(),i=t(void 0);return n.outputLen=i.outputLen,n.blockLen=i.blockLen,n.create=r=>t(r),Object.assign(n,e),Object.freeze(n)}const Q_=t=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,t])}),J_=BigInt(0),xi=BigInt(1),Z_=BigInt(2),e0=BigInt(7),t0=BigInt(256),n0=BigInt(113),ad=[],ld=[],cd=[];for(let t=0,e=xi,n=1,i=0;t<24;t++){[n,i]=[i,(2*n+3*i)%5],ad.push(2*(5*i+n)),ld.push((t+1)*(t+2)/2%64);let r=J_;for(let s=0;s<7;s++)e=(e<<xi^(e>>e0)*n0)%t0,e&Z_&&(r^=xi<<(xi<<BigInt(s))-xi);cd.push(r)}const ud=U_(cd,!0),i0=ud[0],r0=ud[1],Tu=(t,e,n)=>n>32?z_(t,e,n):B_(t,e,n),Au=(t,e,n)=>n>32?W_(t,e,n):H_(t,e,n);function s0(t,e=24){const n=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)n[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,l=(o+2)%10,c=n[l],h=n[l+1],u=Tu(c,h,1)^n[a],f=Au(c,h,1)^n[a+1];for(let d=0;d<50;d+=10)t[o+d]^=u,t[o+d+1]^=f}let r=t[2],s=t[3];for(let o=0;o<24;o++){const a=ld[o],l=Tu(r,s,a),c=Au(r,s,a),h=ad[o];r=t[h],s=t[h+1],t[h]=l,t[h+1]=c}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}t[0]^=i0[i],t[1]^=r0[i]}od(n)}class Yl{state;pos=0;posOut=0;finished=!1;state32;destroyed=!1;blockLen;suffix;outputLen;enableXOF=!1;rounds;constructor(e,n,i,r=!1,s=24){if(this.blockLen=e,this.suffix=n,this.outputLen=i,this.enableXOF=r,this.rounds=s,Su(i,"outputLen"),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=G_(this.state)}clone(){return this._cloneInto()}keccak(){Cu(this.state32),s0(this.state32,this.rounds),Cu(this.state32),this.posOut=0,this.pos=0}update(e){bu(this),ka(e);const{blockLen:n,state:i}=this,r=e.length;for(let s=0;s<r;){const o=Math.min(n-this.pos,r-s);for(let a=0;a<o;a++)i[this.pos++]^=e[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:n,pos:i,blockLen:r}=this;e[i]^=n,(n&128)!==0&&i===r-1&&this.keccak(),e[r-1]^=128,this.keccak()}writeInto(e){bu(this,!1),ka(e),this.finish();const n=this.state,{blockLen:i}=this;for(let r=0,s=e.length;r<s;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,s-r);e.set(n.subarray(this.posOut,this.posOut+o),r),this.posOut+=o,r+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Su(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(q_(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,od(this.state)}_cloneInto(e){const{blockLen:n,suffix:i,outputLen:r,rounds:s,enableXOF:o}=this;return e||=new Yl(n,i,r,o,s),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=i,e.outputLen=r,e.enableXOF=o,e.destroyed=this.destroyed,e}}const o0=(t,e,n,i={})=>X_(()=>new Yl(e,t,n),i),a0=o0(6,72,64,Q_(10));var l0=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,ta=Math.ceil,je=Math.floor,De="[BigNumber Error] ",xu=De+"Number primitive has more than 15 significant digits: ",Je=1e14,V=14,na=9007199254740991,ia=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Wt=1e7,ye=1e9;function hd(t){var e,n,i,r=A.prototype={constructor:A,toString:null,valueOf:null},s=new A(1),o=20,a=4,l=-7,c=21,h=-1e7,u=1e7,f=!1,d=1,w=0,b={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},N="0123456789abcdefghijklmnopqrstuvwxyz",x=!0;function A(p,m){var v,E,S,T,y,g,_,I,C=this;if(!(C instanceof A))return new A(p,m);if(m==null){if(p&&p._isBigNumber===!0){C.s=p.s,!p.c||p.e>u?C.c=C.e=null:p.e<h?C.c=[C.e=0]:(C.e=p.e,C.c=p.c.slice());return}if((g=typeof p=="number")&&p*0==0){if(C.s=1/p<0?(p=-p,-1):1,p===~~p){for(T=0,y=p;y>=10;y/=10,T++);T>u?C.c=C.e=null:(C.e=T,C.c=[p]);return}I=String(p)}else{if(!l0.test(I=String(p)))return i(C,I,g);C.s=I.charCodeAt(0)==45?(I=I.slice(1),-1):1}(T=I.indexOf("."))>-1&&(I=I.replace(".","")),(y=I.search(/e/i))>0?(T<0&&(T=y),T+=+I.slice(y+1),I=I.substring(0,y)):T<0&&(T=I.length)}else{if(ce(m,2,N.length,"Base"),m==10&&x)return C=new A(p),O(C,o+C.e+1,a);if(I=String(p),g=typeof p=="number"){if(p*0!=0)return i(C,I,g,m);if(C.s=1/p<0?(I=I.slice(1),-1):1,A.DEBUG&&I.replace(/^0\.0*|\./,"").length>15)throw Error(xu+p)}else C.s=I.charCodeAt(0)===45?(I=I.slice(1),-1):1;for(v=N.slice(0,m),T=y=0,_=I.length;y<_;y++)if(v.indexOf(E=I.charAt(y))<0){if(E=="."){if(y>T){T=_;continue}}else if(!S&&(I==I.toUpperCase()&&(I=I.toLowerCase())||I==I.toLowerCase()&&(I=I.toUpperCase()))){S=!0,y=-1,T=0;continue}return i(C,String(p),g,m)}g=!1,I=n(I,m,10,C.s),(T=I.indexOf("."))>-1?I=I.replace(".",""):T=I.length}for(y=0;I.charCodeAt(y)===48;y++);for(_=I.length;I.charCodeAt(--_)===48;);if(I=I.slice(y,++_)){if(_-=y,g&&A.DEBUG&&_>15&&(p>na||p!==je(p)))throw Error(xu+C.s*p);if((T=T-y-1)>u)C.c=C.e=null;else if(T<h)C.c=[C.e=0];else{if(C.e=T,C.c=[],y=(T+1)%V,T<0&&(y+=V),y<_){for(y&&C.c.push(+I.slice(0,y)),_-=V;y<_;)C.c.push(+I.slice(y,y+=V));y=V-(I=I.slice(y)).length}else y-=_;for(;y--;I+="0");C.c.push(+I)}}else C.c=[C.e=0]}A.clone=hd,A.ROUND_UP=0,A.ROUND_DOWN=1,A.ROUND_CEIL=2,A.ROUND_FLOOR=3,A.ROUND_HALF_UP=4,A.ROUND_HALF_DOWN=5,A.ROUND_HALF_EVEN=6,A.ROUND_HALF_CEIL=7,A.ROUND_HALF_FLOOR=8,A.EUCLID=9,A.config=A.set=function(p){var m,v;if(p!=null)if(typeof p=="object"){if(p.hasOwnProperty(m="DECIMAL_PLACES")&&(v=p[m],ce(v,0,ye,m),o=v),p.hasOwnProperty(m="ROUNDING_MODE")&&(v=p[m],ce(v,0,8,m),a=v),p.hasOwnProperty(m="EXPONENTIAL_AT")&&(v=p[m],v&&v.pop?(ce(v[0],-ye,0,m),ce(v[1],0,ye,m),l=v[0],c=v[1]):(ce(v,-ye,ye,m),l=-(c=v<0?-v:v))),p.hasOwnProperty(m="RANGE"))if(v=p[m],v&&v.pop)ce(v[0],-ye,-1,m),ce(v[1],1,ye,m),h=v[0],u=v[1];else if(ce(v,-ye,ye,m),v)h=-(u=v<0?-v:v);else throw Error(De+m+" cannot be zero: "+v);if(p.hasOwnProperty(m="CRYPTO"))if(v=p[m],v===!!v)if(v)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))f=v;else throw f=!v,Error(De+"crypto unavailable");else f=v;else throw Error(De+m+" not true or false: "+v);if(p.hasOwnProperty(m="MODULO_MODE")&&(v=p[m],ce(v,0,9,m),d=v),p.hasOwnProperty(m="POW_PRECISION")&&(v=p[m],ce(v,0,ye,m),w=v),p.hasOwnProperty(m="FORMAT"))if(v=p[m],typeof v=="object")b=v;else throw Error(De+m+" not an object: "+v);if(p.hasOwnProperty(m="ALPHABET"))if(v=p[m],typeof v=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(v))x=v.slice(0,10)=="0123456789",N=v;else throw Error(De+m+" invalid: "+v)}else throw Error(De+"Object expected: "+p);return{DECIMAL_PLACES:o,ROUNDING_MODE:a,EXPONENTIAL_AT:[l,c],RANGE:[h,u],CRYPTO:f,MODULO_MODE:d,POW_PRECISION:w,FORMAT:b,ALPHABET:N}},A.isBigNumber=function(p){if(!p||p._isBigNumber!==!0)return!1;if(!A.DEBUG)return!0;var m,v,E=p.c,S=p.e,T=p.s;e:if({}.toString.call(E)=="[object Array]"){if((T===1||T===-1)&&S>=-ye&&S<=ye&&S===je(S)){if(E[0]===0){if(S===0&&E.length===1)return!0;break e}if(m=(S+1)%V,m<1&&(m+=V),String(E[0]).length==m){for(m=0;m<E.length;m++)if(v=E[m],v<0||v>=Je||v!==je(v))break e;if(v!==0)return!0}}}else if(E===null&&S===null&&(T===null||T===1||T===-1))return!0;throw Error(De+"Invalid BigNumber: "+p)},A.maximum=A.max=function(){return k(arguments,-1)},A.minimum=A.min=function(){return k(arguments,1)},A.random=(function(){var p=9007199254740992,m=Math.random()*p&2097151?function(){return je(Math.random()*p)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(v){var E,S,T,y,g,_=0,I=[],C=new A(s);if(v==null?v=o:ce(v,0,ye),y=ta(v/V),f)if(crypto.getRandomValues){for(E=crypto.getRandomValues(new Uint32Array(y*=2));_<y;)g=E[_]*131072+(E[_+1]>>>11),g>=9e15?(S=crypto.getRandomValues(new Uint32Array(2)),E[_]=S[0],E[_+1]=S[1]):(I.push(g%1e14),_+=2);_=y/2}else if(crypto.randomBytes){for(E=crypto.randomBytes(y*=7);_<y;)g=(E[_]&31)*281474976710656+E[_+1]*1099511627776+E[_+2]*4294967296+E[_+3]*16777216+(E[_+4]<<16)+(E[_+5]<<8)+E[_+6],g>=9e15?crypto.randomBytes(7).copy(E,_):(I.push(g%1e14),_+=7);_=y/7}else throw f=!1,Error(De+"crypto unavailable");if(!f)for(;_<y;)g=m(),g<9e15&&(I[_++]=g%1e14);for(y=I[--_],v%=V,y&&v&&(g=ia[V-v],I[_]=je(y/g)*g);I[_]===0;I.pop(),_--);if(_<0)I=[T=0];else{for(T=-1;I[0]===0;I.splice(0,1),T-=V);for(_=1,g=I[0];g>=10;g/=10,_++);_<V&&(T-=V-_)}return C.e=T,C.c=I,C}})(),A.sum=function(){for(var p=1,m=arguments,v=new A(m[0]);p<m.length;)v=v.plus(m[p++]);return v},n=(function(){var p="0123456789";function m(v,E,S,T){for(var y,g=[0],_,I=0,C=v.length;I<C;){for(_=g.length;_--;g[_]*=E);for(g[0]+=T.indexOf(v.charAt(I++)),y=0;y<g.length;y++)g[y]>S-1&&(g[y+1]==null&&(g[y+1]=0),g[y+1]+=g[y]/S|0,g[y]%=S)}return g.reverse()}return function(v,E,S,T,y){var g,_,I,C,M,D,L,U,W=v.indexOf("."),q=o,B=a;for(W>=0&&(C=w,w=0,v=v.replace(".",""),U=new A(E),D=U.pow(v.length-W),w=C,U.c=m(bt(Ge(D.c),D.e,"0"),10,S,p),U.e=U.c.length),L=m(v,E,S,y?(g=N,p):(g=p,N)),I=C=L.length;L[--C]==0;L.pop());if(!L[0])return g.charAt(0);if(W<0?--I:(D.c=L,D.e=I,D.s=T,D=e(D,U,q,B,S),L=D.c,M=D.r,I=D.e),_=I+q+1,W=L[_],C=S/2,M=M||_<0||L[_+1]!=null,M=B<4?(W!=null||M)&&(B==0||B==(D.s<0?3:2)):W>C||W==C&&(B==4||M||B==6&&L[_-1]&1||B==(D.s<0?8:7)),_<1||!L[0])v=M?bt(g.charAt(1),-q,g.charAt(0)):g.charAt(0);else{if(L.length=_,M)for(--S;++L[--_]>S;)L[_]=0,_||(++I,L=[1].concat(L));for(C=L.length;!L[--C];);for(W=0,v="";W<=C;v+=g.charAt(L[W++]));v=bt(v,I,g.charAt(0))}return v}})(),e=(function(){function p(E,S,T){var y,g,_,I,C=0,M=E.length,D=S%Wt,L=S/Wt|0;for(E=E.slice();M--;)_=E[M]%Wt,I=E[M]/Wt|0,y=L*_+I*D,g=D*_+y%Wt*Wt+C,C=(g/T|0)+(y/Wt|0)+L*I,E[M]=g%T;return C&&(E=[C].concat(E)),E}function m(E,S,T,y){var g,_;if(T!=y)_=T>y?1:-1;else for(g=_=0;g<T;g++)if(E[g]!=S[g]){_=E[g]>S[g]?1:-1;break}return _}function v(E,S,T,y){for(var g=0;T--;)E[T]-=g,g=E[T]<S[T]?1:0,E[T]=g*y+E[T]-S[T];for(;!E[0]&&E.length>1;E.splice(0,1));}return function(E,S,T,y,g){var _,I,C,M,D,L,U,W,q,B,j,ne,Oe,fn,Zo,ht,Ti,qe=E.s==S.s?1:-1,Te=E.c,he=S.c;if(!Te||!Te[0]||!he||!he[0])return new A(!E.s||!S.s||(Te?he&&Te[0]==he[0]:!he)?NaN:Te&&Te[0]==0||!he?qe*0:qe/0);for(W=new A(qe),q=W.c=[],I=E.e-S.e,qe=T+I+1,g||(g=Je,I=Ke(E.e/V)-Ke(S.e/V),qe=qe/V|0),C=0;he[C]==(Te[C]||0);C++);if(he[C]>(Te[C]||0)&&I--,qe<0)q.push(1),M=!0;else{for(fn=Te.length,ht=he.length,C=0,qe+=2,D=je(g/(he[0]+1)),D>1&&(he=p(he,D,g),Te=p(Te,D,g),ht=he.length,fn=Te.length),Oe=ht,B=Te.slice(0,ht),j=B.length;j<ht;B[j++]=0);Ti=he.slice(),Ti=[0].concat(Ti),Zo=he[0],he[1]>=g/2&&Zo++;do{if(D=0,_=m(he,B,ht,j),_<0){if(ne=B[0],ht!=j&&(ne=ne*g+(B[1]||0)),D=je(ne/Zo),D>1)for(D>=g&&(D=g-1),L=p(he,D,g),U=L.length,j=B.length;m(L,B,U,j)==1;)D--,v(L,ht<U?Ti:he,U,g),U=L.length,_=1;else D==0&&(_=D=1),L=he.slice(),U=L.length;if(U<j&&(L=[0].concat(L)),v(B,L,j,g),j=B.length,_==-1)for(;m(he,B,ht,j)<1;)D++,v(B,ht<j?Ti:he,j,g),j=B.length}else _===0&&(D++,B=[0]);q[C++]=D,B[0]?B[j++]=Te[Oe]||0:(B=[Te[Oe]],j=1)}while((Oe++<fn||B[0]!=null)&&qe--);M=B[0]!=null,q[0]||q.splice(0,1)}if(g==Je){for(C=1,qe=q[0];qe>=10;qe/=10,C++);O(W,T+(W.e=C+I*V-1)+1,y,M)}else W.e=I,W.r=+M;return W}})();function P(p,m,v,E){var S,T,y,g,_;if(v==null?v=a:ce(v,0,8),!p.c)return p.toString();if(S=p.c[0],y=p.e,m==null)_=Ge(p.c),_=E==1||E==2&&(y<=l||y>=c)?Br(_,y):bt(_,y,"0");else if(p=O(new A(p),m,v),T=p.e,_=Ge(p.c),g=_.length,E==1||E==2&&(m<=T||T<=l)){for(;g<m;_+="0",g++);_=Br(_,T)}else if(m-=y+(E===2&&T>y),_=bt(_,T,"0"),T+1>g){if(--m>0)for(_+=".";m--;_+="0");}else if(m+=T-g,m>0)for(T+1==g&&(_+=".");m--;_+="0");return p.s<0&&S?"-"+_:_}function k(p,m){for(var v,E,S=1,T=new A(p[0]);S<p.length;S++)E=new A(p[S]),(!E.s||(v=pn(T,E))===m||v===0&&T.s===m)&&(T=E);return T}function R(p,m,v){for(var E=1,S=m.length;!m[--S];m.pop());for(S=m[0];S>=10;S/=10,E++);return(v=E+v*V-1)>u?p.c=p.e=null:v<h?p.c=[p.e=0]:(p.e=v,p.c=m),p}i=(function(){var p=/^(-?)0([xbo])(?=\w[\w.]*$)/i,m=/^([^.]+)\.$/,v=/^\.([^.]+)$/,E=/^-?(Infinity|NaN)$/,S=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(T,y,g,_){var I,C=g?y:y.replace(S,"");if(E.test(C))T.s=isNaN(C)?null:C<0?-1:1;else{if(!g&&(C=C.replace(p,function(M,D,L){return I=(L=L.toLowerCase())=="x"?16:L=="b"?2:8,!_||_==I?D:M}),_&&(I=_,C=C.replace(m,"$1").replace(v,"0.$1")),y!=C))return new A(C,I);if(A.DEBUG)throw Error(De+"Not a"+(_?" base "+_:"")+" number: "+y);T.s=null}T.c=T.e=null}})();function O(p,m,v,E){var S,T,y,g,_,I,C,M=p.c,D=ia;if(M){e:{for(S=1,g=M[0];g>=10;g/=10,S++);if(T=m-S,T<0)T+=V,y=m,_=M[I=0],C=je(_/D[S-y-1]%10);else if(I=ta((T+1)/V),I>=M.length)if(E){for(;M.length<=I;M.push(0));_=C=0,S=1,T%=V,y=T-V+1}else break e;else{for(_=g=M[I],S=1;g>=10;g/=10,S++);T%=V,y=T-V+S,C=y<0?0:je(_/D[S-y-1]%10)}if(E=E||m<0||M[I+1]!=null||(y<0?_:_%D[S-y-1]),E=v<4?(C||E)&&(v==0||v==(p.s<0?3:2)):C>5||C==5&&(v==4||E||v==6&&(T>0?y>0?_/D[S-y]:0:M[I-1])%10&1||v==(p.s<0?8:7)),m<1||!M[0])return M.length=0,E?(m-=p.e+1,M[0]=D[(V-m%V)%V],p.e=-m||0):M[0]=p.e=0,p;if(T==0?(M.length=I,g=1,I--):(M.length=I+1,g=D[V-T],M[I]=y>0?je(_/D[S-y]%D[y])*g:0),E)for(;;)if(I==0){for(T=1,y=M[0];y>=10;y/=10,T++);for(y=M[0]+=g,g=1;y>=10;y/=10,g++);T!=g&&(p.e++,M[0]==Je&&(M[0]=1));break}else{if(M[I]+=g,M[I]!=Je)break;M[I--]=0,g=1}for(T=M.length;M[--T]===0;M.pop());}p.e>u?p.c=p.e=null:p.e<h&&(p.c=[p.e=0])}return p}function $(p){var m,v=p.e;return v===null?p.toString():(m=Ge(p.c),m=v<=l||v>=c?Br(m,v):bt(m,v,"0"),p.s<0?"-"+m:m)}return r.absoluteValue=r.abs=function(){var p=new A(this);return p.s<0&&(p.s=1),p},r.comparedTo=function(p,m){return pn(this,new A(p,m))},r.decimalPlaces=r.dp=function(p,m){var v,E,S,T=this;if(p!=null)return ce(p,0,ye),m==null?m=a:ce(m,0,8),O(new A(T),p+T.e+1,m);if(!(v=T.c))return null;if(E=((S=v.length-1)-Ke(this.e/V))*V,S=v[S])for(;S%10==0;S/=10,E--);return E<0&&(E=0),E},r.dividedBy=r.div=function(p,m){return e(this,new A(p,m),o,a)},r.dividedToIntegerBy=r.idiv=function(p,m){return e(this,new A(p,m),0,1)},r.exponentiatedBy=r.pow=function(p,m){var v,E,S,T,y,g,_,I,C,M=this;if(p=new A(p),p.c&&!p.isInteger())throw Error(De+"Exponent not an integer: "+$(p));if(m!=null&&(m=new A(m)),g=p.e>14,!M.c||!M.c[0]||M.c[0]==1&&!M.e&&M.c.length==1||!p.c||!p.c[0])return C=new A(Math.pow(+$(M),g?p.s*(2-Ur(p)):+$(p))),m?C.mod(m):C;if(_=p.s<0,m){if(m.c?!m.c[0]:!m.s)return new A(NaN);E=!_&&M.isInteger()&&m.isInteger(),E&&(M=M.mod(m))}else{if(p.e>9&&(M.e>0||M.e<-1||(M.e==0?M.c[0]>1||g&&M.c[1]>=24e7:M.c[0]<8e13||g&&M.c[0]<=9999975e7)))return T=M.s<0&&Ur(p)?-0:0,M.e>-1&&(T=1/T),new A(_?1/T:T);w&&(T=ta(w/V+2))}for(g?(v=new A(.5),_&&(p.s=1),I=Ur(p)):(S=Math.abs(+$(p)),I=S%2),C=new A(s);;){if(I){if(C=C.times(M),!C.c)break;T?C.c.length>T&&(C.c.length=T):E&&(C=C.mod(m))}if(S){if(S=je(S/2),S===0)break;I=S%2}else if(p=p.times(v),O(p,p.e+1,1),p.e>14)I=Ur(p);else{if(S=+$(p),S===0)break;I=S%2}M=M.times(M),T?M.c&&M.c.length>T&&(M.c.length=T):E&&(M=M.mod(m))}return E?C:(_&&(C=s.div(C)),m?C.mod(m):T?O(C,w,a,y):C)},r.integerValue=function(p){var m=new A(this);return p==null?p=a:ce(p,0,8),O(m,m.e+1,p)},r.isEqualTo=r.eq=function(p,m){return pn(this,new A(p,m))===0},r.isFinite=function(){return!!this.c},r.isGreaterThan=r.gt=function(p,m){return pn(this,new A(p,m))>0},r.isGreaterThanOrEqualTo=r.gte=function(p,m){return(m=pn(this,new A(p,m)))===1||m===0},r.isInteger=function(){return!!this.c&&Ke(this.e/V)>this.c.length-2},r.isLessThan=r.lt=function(p,m){return pn(this,new A(p,m))<0},r.isLessThanOrEqualTo=r.lte=function(p,m){return(m=pn(this,new A(p,m)))===-1||m===0},r.isNaN=function(){return!this.s},r.isNegative=function(){return this.s<0},r.isPositive=function(){return this.s>0},r.isZero=function(){return!!this.c&&this.c[0]==0},r.minus=function(p,m){var v,E,S,T,y=this,g=y.s;if(p=new A(p,m),m=p.s,!g||!m)return new A(NaN);if(g!=m)return p.s=-m,y.plus(p);var _=y.e/V,I=p.e/V,C=y.c,M=p.c;if(!_||!I){if(!C||!M)return C?(p.s=-m,p):new A(M?y:NaN);if(!C[0]||!M[0])return M[0]?(p.s=-m,p):new A(C[0]?y:a==3?-0:0)}if(_=Ke(_),I=Ke(I),C=C.slice(),g=_-I){for((T=g<0)?(g=-g,S=C):(I=_,S=M),S.reverse(),m=g;m--;S.push(0));S.reverse()}else for(E=(T=(g=C.length)<(m=M.length))?g:m,g=m=0;m<E;m++)if(C[m]!=M[m]){T=C[m]<M[m];break}if(T&&(S=C,C=M,M=S,p.s=-p.s),m=(E=M.length)-(v=C.length),m>0)for(;m--;C[v++]=0);for(m=Je-1;E>g;){if(C[--E]<M[E]){for(v=E;v&&!C[--v];C[v]=m);--C[v],C[E]+=Je}C[E]-=M[E]}for(;C[0]==0;C.splice(0,1),--I);return C[0]?R(p,C,I):(p.s=a==3?-1:1,p.c=[p.e=0],p)},r.modulo=r.mod=function(p,m){var v,E,S=this;return p=new A(p,m),!S.c||!p.s||p.c&&!p.c[0]?new A(NaN):!p.c||S.c&&!S.c[0]?new A(S):(d==9?(E=p.s,p.s=1,v=e(S,p,0,3),p.s=E,v.s*=E):v=e(S,p,0,d),p=S.minus(v.times(p)),!p.c[0]&&d==1&&(p.s=S.s),p)},r.multipliedBy=r.times=function(p,m){var v,E,S,T,y,g,_,I,C,M,D,L,U,W,q,B=this,j=B.c,ne=(p=new A(p,m)).c;if(!j||!ne||!j[0]||!ne[0])return!B.s||!p.s||j&&!j[0]&&!ne||ne&&!ne[0]&&!j?p.c=p.e=p.s=null:(p.s*=B.s,!j||!ne?p.c=p.e=null:(p.c=[0],p.e=0)),p;for(E=Ke(B.e/V)+Ke(p.e/V),p.s*=B.s,_=j.length,M=ne.length,_<M&&(U=j,j=ne,ne=U,S=_,_=M,M=S),S=_+M,U=[];S--;U.push(0));for(W=Je,q=Wt,S=M;--S>=0;){for(v=0,D=ne[S]%q,L=ne[S]/q|0,y=_,T=S+y;T>S;)I=j[--y]%q,C=j[y]/q|0,g=L*I+C*D,I=D*I+g%q*q+U[T]+v,v=(I/W|0)+(g/q|0)+L*C,U[T--]=I%W;U[T]=v}return v?++E:U.splice(0,1),R(p,U,E)},r.negated=function(){var p=new A(this);return p.s=-p.s||null,p},r.plus=function(p,m){var v,E=this,S=E.s;if(p=new A(p,m),m=p.s,!S||!m)return new A(NaN);if(S!=m)return p.s=-m,E.minus(p);var T=E.e/V,y=p.e/V,g=E.c,_=p.c;if(!T||!y){if(!g||!_)return new A(S/0);if(!g[0]||!_[0])return _[0]?p:new A(g[0]?E:S*0)}if(T=Ke(T),y=Ke(y),g=g.slice(),S=T-y){for(S>0?(y=T,v=_):(S=-S,v=g),v.reverse();S--;v.push(0));v.reverse()}for(S=g.length,m=_.length,S-m<0&&(v=_,_=g,g=v,m=S),S=0;m;)S=(g[--m]=g[m]+_[m]+S)/Je|0,g[m]=Je===g[m]?0:g[m]%Je;return S&&(g=[S].concat(g),++y),R(p,g,y)},r.precision=r.sd=function(p,m){var v,E,S,T=this;if(p!=null&&p!==!!p)return ce(p,1,ye),m==null?m=a:ce(m,0,8),O(new A(T),p,m);if(!(v=T.c))return null;if(S=v.length-1,E=S*V+1,S=v[S]){for(;S%10==0;S/=10,E--);for(S=v[0];S>=10;S/=10,E++);}return p&&T.e+1>E&&(E=T.e+1),E},r.shiftedBy=function(p){return ce(p,-na,na),this.times("1e"+p)},r.squareRoot=r.sqrt=function(){var p,m,v,E,S,T=this,y=T.c,g=T.s,_=T.e,I=o+4,C=new A("0.5");if(g!==1||!y||!y[0])return new A(!g||g<0&&(!y||y[0])?NaN:y?T:1/0);if(g=Math.sqrt(+$(T)),g==0||g==1/0?(m=Ge(y),(m.length+_)%2==0&&(m+="0"),g=Math.sqrt(+m),_=Ke((_+1)/2)-(_<0||_%2),g==1/0?m="5e"+_:(m=g.toExponential(),m=m.slice(0,m.indexOf("e")+1)+_),v=new A(m)):v=new A(g+""),v.c[0]){for(_=v.e,g=_+I,g<3&&(g=0);;)if(S=v,v=C.times(S.plus(e(T,S,I,1))),Ge(S.c).slice(0,g)===(m=Ge(v.c)).slice(0,g))if(v.e<_&&--g,m=m.slice(g-3,g+1),m=="9999"||!E&&m=="4999"){if(!E&&(O(S,S.e+o+2,0),S.times(S).eq(T))){v=S;break}I+=4,g+=4,E=1}else{(!+m||!+m.slice(1)&&m.charAt(0)=="5")&&(O(v,v.e+o+2,1),p=!v.times(v).eq(T));break}}return O(v,v.e+o+1,a,p)},r.toExponential=function(p,m){return p!=null&&(ce(p,0,ye),p++),P(this,p,m,1)},r.toFixed=function(p,m){return p!=null&&(ce(p,0,ye),p=p+this.e+1),P(this,p,m)},r.toFormat=function(p,m,v){var E,S=this;if(v==null)p!=null&&m&&typeof m=="object"?(v=m,m=null):p&&typeof p=="object"?(v=p,p=m=null):v=b;else if(typeof v!="object")throw Error(De+"Argument not an object: "+v);if(E=S.toFixed(p,m),S.c){var T,y=E.split("."),g=+v.groupSize,_=+v.secondaryGroupSize,I=v.groupSeparator||"",C=y[0],M=y[1],D=S.s<0,L=D?C.slice(1):C,U=L.length;if(_&&(T=g,g=_,_=T,U-=T),g>0&&U>0){for(T=U%g||g,C=L.substr(0,T);T<U;T+=g)C+=I+L.substr(T,g);_>0&&(C+=I+L.slice(T)),D&&(C="-"+C)}E=M?C+(v.decimalSeparator||"")+((_=+v.fractionGroupSize)?M.replace(new RegExp("\\d{"+_+"}\\B","g"),"$&"+(v.fractionGroupSeparator||"")):M):C}return(v.prefix||"")+E+(v.suffix||"")},r.toFraction=function(p){var m,v,E,S,T,y,g,_,I,C,M,D,L=this,U=L.c;if(p!=null&&(g=new A(p),!g.isInteger()&&(g.c||g.s!==1)||g.lt(s)))throw Error(De+"Argument "+(g.isInteger()?"out of range: ":"not an integer: ")+$(g));if(!U)return new A(L);for(m=new A(s),I=v=new A(s),E=_=new A(s),D=Ge(U),T=m.e=D.length-L.e-1,m.c[0]=ia[(y=T%V)<0?V+y:y],p=!p||g.comparedTo(m)>0?T>0?m:I:g,y=u,u=1/0,g=new A(D),_.c[0]=0;C=e(g,m,0,1),S=v.plus(C.times(E)),S.comparedTo(p)!=1;)v=E,E=S,I=_.plus(C.times(S=I)),_=S,m=g.minus(C.times(S=m)),g=S;return S=e(p.minus(v),E,0,1),_=_.plus(S.times(I)),v=v.plus(S.times(E)),_.s=I.s=L.s,T=T*2,M=e(I,E,T,a).minus(L).abs().comparedTo(e(_,v,T,a).minus(L).abs())<1?[I,E]:[_,v],u=y,M},r.toNumber=function(){return+$(this)},r.toPrecision=function(p,m){return p!=null&&ce(p,1,ye),P(this,p,m,2)},r.toString=function(p){var m,v=this,E=v.s,S=v.e;return S===null?E?(m="Infinity",E<0&&(m="-"+m)):m="NaN":(p==null?m=S<=l||S>=c?Br(Ge(v.c),S):bt(Ge(v.c),S,"0"):p===10&&x?(v=O(new A(v),o+S+1,a),m=bt(Ge(v.c),v.e,"0")):(ce(p,2,N.length,"Base"),m=n(bt(Ge(v.c),S,"0"),10,p,E,!0)),E<0&&v.c[0]&&(m="-"+m)),m},r.valueOf=r.toJSON=function(){return $(this)},r._isBigNumber=!0,r[Symbol.toStringTag]="BigNumber",r[Symbol.for("nodejs.util.inspect.custom")]=r.valueOf,t!=null&&A.set(t),A}function Ke(t){var e=t|0;return t>0||t===e?e:e-1}function Ge(t){for(var e,n,i=1,r=t.length,s=t[0]+"";i<r;){for(e=t[i++]+"",n=V-e.length;n--;e="0"+e);s+=e}for(r=s.length;s.charCodeAt(--r)===48;);return s.slice(0,r+1||1)}function pn(t,e){var n,i,r=t.c,s=e.c,o=t.s,a=e.s,l=t.e,c=e.e;if(!o||!a)return null;if(n=r&&!r[0],i=s&&!s[0],n||i)return n?i?0:-a:o;if(o!=a)return o;if(n=o<0,i=l==c,!r||!s)return i?0:!r^n?1:-1;if(!i)return l>c^n?1:-1;for(a=(l=r.length)<(c=s.length)?l:c,o=0;o<a;o++)if(r[o]!=s[o])return r[o]>s[o]^n?1:-1;return l==c?0:l>c^n?1:-1}function ce(t,e,n,i){if(t<e||t>n||t!==je(t))throw Error(De+(i||"Argument")+(typeof t=="number"?t<e||t>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(t))}function Ur(t){var e=t.c.length-1;return Ke(t.e/V)==e&&t.c[e]%2!=0}function Br(t,e){return(t.length>1?t.charAt(0)+"."+t.slice(1):t)+(e<0?"e":"e+")+e}function bt(t,e,n){var i,r;if(e<0){for(r=n+".";++e;r+=n);t=r+t}else if(i=t.length,++e>i){for(r=n,e-=i;--e;r+=n);t+=r}else e<i&&(t=t.slice(0,e)+"."+t.slice(e));return t}var c0=hd();const u0=24,qi=32,h0=()=>typeof globalThis<"u"&&globalThis.crypto&&typeof globalThis.crypto.getRandomValues=="function"?()=>{const t=new Uint32Array(1);return globalThis.crypto.getRandomValues(t),t[0]/4294967296}:Math.random,Xl=h0(),Pa=(t=4,e=Xl)=>{let n="";for(;n.length<t;)n=n+Math.floor(e()*36).toString(36);return n};function f0(t){let e=new c0(0);for(const n of t.values())e=e.multipliedBy(256).plus(n);return e}const fd=(t="")=>{const e=new TextEncoder;return f0(a0(e.encode(t))).toString(36).slice(1)},Nu=Array.from({length:26},(t,e)=>String.fromCharCode(e+97)),d0=t=>Nu[Math.floor(t()*Nu.length)],p0=({globalObj:t=typeof global<"u"?global:typeof window<"u"?window:{},random:e=Xl}={})=>{const n=Object.keys(t).toString(),i=n.length?n+Pa(qi,e):Pa(qi,e);return fd(i).substring(0,qi)},g0=t=>()=>t++,m0=476782367,Ao=({random:t=Xl,counter:e=g0(Math.floor(t()*m0)),length:n=u0,fingerprint:i=p0({random:t})}={})=>{if(n>qi)throw new Error(`Length must be between 2 and ${qi}. Received: ${n}`);return function(){const s=d0(t),o=Date.now().toString(36),a=e().toString(36),l=Pa(n,t),c=`${o+l+a+i}`;return`${s+fd(c).substring(1,n)}`}};Ao();const _0=()=>{};var Mu={};const dd={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const F=function(t,e){if(!t)throw _i(e)},_i=function(t){return new Error("Firebase Database ("+dd.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};const pd=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let r=t.charCodeAt(i);r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=r&63|128):(r&64512)===55296&&i+1<t.length&&(t.charCodeAt(i+1)&64512)===56320?(r=65536+((r&1023)<<10)+(t.charCodeAt(++i)&1023),e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=r&63|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=r&63|128)}return e},y0=function(t){const e=[];let n=0,i=0;for(;n<t.length;){const r=t[n++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=t[n++];e[i++]=String.fromCharCode((r&31)<<6|s&63)}else if(r>239&&r<365){const s=t[n++],o=t[n++],a=t[n++],l=((r&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(l>>10)),e[i++]=String.fromCharCode(56320+(l&1023))}else{const s=t[n++],o=t[n++];e[i++]=String.fromCharCode((r&15)<<12|(s&63)<<6|o&63)}}return e.join("")},Ql={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<t.length;r+=3){const s=t[r],o=r+1<t.length,a=o?t[r+1]:0,l=r+2<t.length,c=l?t[r+2]:0,h=s>>2,u=(s&3)<<4|a>>4;let f=(a&15)<<2|c>>6,d=c&63;l||(d=64,o||(f=64)),i.push(n[h],n[u],n[f],n[d])}return i.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(pd(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):y0(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<t.length;){const s=n[t.charAt(r++)],a=r<t.length?n[t.charAt(r)]:0;++r;const c=r<t.length?n[t.charAt(r)]:64;++r;const u=r<t.length?n[t.charAt(r)]:64;if(++r,s==null||a==null||c==null||u==null)throw new v0;const f=s<<2|a>>4;if(i.push(f),c!==64){const d=a<<4&240|c>>2;if(i.push(d),u!==64){const w=c<<6&192|u;i.push(w)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class v0 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const gd=function(t){const e=pd(t);return Ql.encodeByteArray(e,!0)},Is=function(t){return gd(t).replace(/\./g,"")},Ss=function(t){try{return Ql.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function w0(t){return md(void 0,t)}function md(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!E0(n)||(t[n]=md(t[n],e[n]));return t}function E0(t){return t!=="__proto__"}function I0(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const S0=()=>I0().__FIREBASE_DEFAULTS__,b0=()=>{if(typeof process>"u"||typeof Mu>"u")return;const t=Mu.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},C0=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Ss(t[1]);return e&&JSON.parse(e)},Jl=()=>{try{return _0()||S0()||b0()||C0()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},_d=t=>Jl()?.emulatorHosts?.[t],T0=t=>{const e=_d(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),i]:[e.substring(0,n),i]},yd=()=>Jl()?.config,vd=t=>Jl()?.[`_${t}`];class xo{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,i)=>{n?this.reject(n):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,i))}}}function yi(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function wd(t){return(await fetch(t,{credentials:"include"})).ok}function A0(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},i=e||"demo-project",r=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${i}`,aud:i,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...t};return[Is(JSON.stringify(n)),Is(JSON.stringify(o)),""].join(".")}const Gi={};function x0(){const t={prod:[],emulator:[]};for(const e of Object.keys(Gi))Gi[e]?t.emulator.push(e):t.prod.push(e);return t}function N0(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let ku=!1;function Ed(t,e){if(typeof window>"u"||typeof document>"u"||!yi(window.location.host)||Gi[t]===e||Gi[t]||ku)return;Gi[t]=e;function n(f){return`__firebase__banner__${f}`}const i="__firebase__banner",s=x0().prod.length>0;function o(){const f=document.getElementById(i);f&&f.remove()}function a(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function l(f,d){f.setAttribute("width","24"),f.setAttribute("id",d),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function c(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{ku=!0,o()},f}function h(f,d){f.setAttribute("id",d),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function u(){const f=N0(i),d=n("text"),w=document.getElementById(d)||document.createElement("span"),b=n("learnmore"),N=document.getElementById(b)||document.createElement("a"),x=n("preprendIcon"),A=document.getElementById(x)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const P=f.element;a(P),h(N,b);const k=c();l(A,x),P.append(A,w,N,k),document.body.appendChild(P)}s?(w.innerText="Preview backend disconnected.",A.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(A.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,w.innerText="Preview backend running in this workspace."),w.setAttribute("id",d)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",u):u()}function Re(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Zl(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Re())}function M0(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function k0(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function Id(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function P0(){const t=Re();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function R0(){return dd.NODE_ADMIN===!0}function O0(){try{return typeof indexedDB=="object"}catch{return!1}}function D0(){return new Promise((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{e(r.error?.message||"")}}catch(n){e(n)}})}const L0="FirebaseError";class hn extends Error{constructor(e,n,i){super(n),this.code=e,this.customData=i,this.name=L0,Object.setPrototypeOf(this,hn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,br.prototype.create)}}class br{constructor(e,n,i){this.service=e,this.serviceName=n,this.errors=i}create(e,...n){const i=n[0]||{},r=`${this.service}/${e}`,s=this.errors[e],o=s?$0(s,i):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new hn(r,a,i)}}function $0(t,e){return t.replace(F0,(n,i)=>{const r=e[i];return r!=null?String(r):`<${i}?>`})}const F0=/\{\$([^}]+)}/g;function ir(t){return JSON.parse(t)}function pe(t){return JSON.stringify(t)}const Sd=function(t){let e={},n={},i={},r="";try{const s=t.split(".");e=ir(Ss(s[0])||""),n=ir(Ss(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:i,signature:r}},U0=function(t){const e=Sd(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},B0=function(t){const e=Sd(t).claims;return typeof e=="object"&&e.admin===!0};function Ht(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ii(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function Ra(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function bs(t,e,n){const i={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=e.call(n,t[r],r,t));return i}function xn(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const r of n){if(!i.includes(r))return!1;const s=t[r],o=e[r];if(Pu(s)&&Pu(o)){if(!xn(s,o))return!1}else if(s!==o)return!1}for(const r of i)if(!n.includes(r))return!1;return!0}function Pu(t){return t!==null&&typeof t=="object"}function vi(t){const e=[];for(const[n,i]of Object.entries(t))Array.isArray(i)?i.forEach(r=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}class H0{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const i=this.W_;if(typeof e=="string")for(let u=0;u<16;u++)i[u]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let u=0;u<16;u++)i[u]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let u=16;u<80;u++){const f=i[u-3]^i[u-8]^i[u-14]^i[u-16];i[u]=(f<<1|f>>>31)&4294967295}let r=this.chain_[0],s=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],c,h;for(let u=0;u<80;u++){u<40?u<20?(c=a^s&(o^a),h=1518500249):(c=s^o^a,h=1859775393):u<60?(c=s&o|a&(s|o),h=2400959708):(c=s^o^a,h=3395469782);const f=(r<<5|r>>>27)+c+l+h+i[u]&4294967295;l=a,a=o,o=(s<<30|s>>>2)&4294967295,s=r,r=f}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const i=n-this.blockSize;let r=0;const s=this.buf_;let o=this.inbuf_;for(;r<n;){if(o===0)for(;r<=i;)this.compress_(e,r),r+=this.blockSize;if(typeof e=="string"){for(;r<n;)if(s[o]=e.charCodeAt(r),++o,++r,o===this.blockSize){this.compress_(s),o=0;break}}else for(;r<n;)if(s[o]=e[r],++o,++r,o===this.blockSize){this.compress_(s),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=n&255,n/=256;this.compress_(this.buf_);let i=0;for(let r=0;r<5;r++)for(let s=24;s>=0;s-=8)e[i]=this.chain_[r]>>s&255,++i;return e}}function z0(t,e){const n=new W0(t,e);return n.subscribe.bind(n)}class W0{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,i){let r;if(e===void 0&&n===void 0&&i===void 0)throw new Error("Missing Observer.");V0(e,["next","error","complete"])?r=e:r={next:e,error:n,complete:i},r.next===void 0&&(r.next=ra),r.error===void 0&&(r.error=ra),r.complete===void 0&&(r.complete=ra);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function V0(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function ra(){}function ec(t,e){return`${t} failed: ${e} argument `}const q0=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let r=t.charCodeAt(i);if(r>=55296&&r<=56319){const s=r-55296;i++,F(i<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(i)-56320;r=65536+(s<<10)+o}r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=r&63|128):r<65536?(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=r&63|128):(e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=r&63|128)}return e},No=function(t){let e=0;for(let n=0;n<t.length;n++){const i=t.charCodeAt(n);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,n++):e+=3}return e};function Qe(t){return t&&t._delegate?t._delegate:t}class Nn{constructor(e,n,i){this.name=e,this.instanceFactory=n,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const gn="[DEFAULT]";class G0{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const i=new xo;if(this.instancesDeferred.set(n,i),this.isInitialized(n)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:n});r&&i.resolve(r)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),i=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(r){if(i)return null;throw r}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(K0(e))try{this.getOrInitializeService({instanceIdentifier:gn})}catch{}for(const[n,i]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(n);try{const s=this.getOrInitializeService({instanceIdentifier:r});i.resolve(s)}catch{}}}}clearInstance(e=gn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=gn){return this.instances.has(e)}getOptions(e=gn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:i,options:n});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);i===a&&o.resolve(r)}return r}onInit(e,n){const i=this.normalizeInstanceIdentifier(n),r=this.onInitCallbacks.get(i)??new Set;r.add(e),this.onInitCallbacks.set(i,r);const s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,n){const i=this.onInitCallbacks.get(n);if(i)for(const r of i)try{r(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:j0(e),options:n}),this.instances.set(e,i),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=gn){return this.component?this.component.multipleInstances?e:gn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function j0(t){return t===gn?void 0:t}function K0(t){return t.instantiationMode==="EAGER"}class Y0{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new G0(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var re;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(re||(re={}));const X0={debug:re.DEBUG,verbose:re.VERBOSE,info:re.INFO,warn:re.WARN,error:re.ERROR,silent:re.SILENT},Q0=re.INFO,J0={[re.DEBUG]:"log",[re.VERBOSE]:"log",[re.INFO]:"info",[re.WARN]:"warn",[re.ERROR]:"error"},Z0=(t,e,...n)=>{if(e<t.logLevel)return;const i=new Date().toISOString(),r=J0[e];if(r)console[r](`[${i}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class tc{constructor(e){this.name=e,this._logLevel=Q0,this._logHandler=Z0,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in re))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?X0[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,re.DEBUG,...e),this._logHandler(this,re.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,re.VERBOSE,...e),this._logHandler(this,re.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,re.INFO,...e),this._logHandler(this,re.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,re.WARN,...e),this._logHandler(this,re.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,re.ERROR,...e),this._logHandler(this,re.ERROR,...e)}}const ey=(t,e)=>e.some(n=>t instanceof n);let Ru,Ou;function ty(){return Ru||(Ru=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ny(){return Ou||(Ou=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const bd=new WeakMap,Oa=new WeakMap,Cd=new WeakMap,sa=new WeakMap,nc=new WeakMap;function iy(t){const e=new Promise((n,i)=>{const r=()=>{t.removeEventListener("success",s),t.removeEventListener("error",o)},s=()=>{n(Zt(t.result)),r()},o=()=>{i(t.error),r()};t.addEventListener("success",s),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&bd.set(n,t)}).catch(()=>{}),nc.set(e,t),e}function ry(t){if(Oa.has(t))return;const e=new Promise((n,i)=>{const r=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",o),t.removeEventListener("abort",o)},s=()=>{n(),r()},o=()=>{i(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",s),t.addEventListener("error",o),t.addEventListener("abort",o)});Oa.set(t,e)}let Da={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Oa.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Cd.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Zt(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function sy(t){Da=t(Da)}function oy(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const i=t.call(oa(this),e,...n);return Cd.set(i,e.sort?e.sort():[e]),Zt(i)}:ny().includes(t)?function(...e){return t.apply(oa(this),e),Zt(bd.get(this))}:function(...e){return Zt(t.apply(oa(this),e))}}function ay(t){return typeof t=="function"?oy(t):(t instanceof IDBTransaction&&ry(t),ey(t,ty())?new Proxy(t,Da):t)}function Zt(t){if(t instanceof IDBRequest)return iy(t);if(sa.has(t))return sa.get(t);const e=ay(t);return e!==t&&(sa.set(t,e),nc.set(e,t)),e}const oa=t=>nc.get(t);function ly(t,e,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(t,e),a=Zt(o);return i&&o.addEventListener("upgradeneeded",l=>{i(Zt(o.result),l.oldVersion,l.newVersion,Zt(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{s&&l.addEventListener("close",()=>s()),r&&l.addEventListener("versionchange",c=>r(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const cy=["get","getKey","getAll","getAllKeys","count"],uy=["put","add","delete","clear"],aa=new Map;function Du(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(aa.get(e))return aa.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,r=uy.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(r||cy.includes(n)))return;const s=async function(o,...a){const l=this.transaction(o,r?"readwrite":"readonly");let c=l.store;return i&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),r&&l.done]))[0]};return aa.set(e,s),s}sy(t=>({...t,get:(e,n,i)=>Du(e,n)||t.get(e,n,i),has:(e,n)=>!!Du(e,n)||t.has(e,n)}));class hy{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(fy(n)){const i=n.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(n=>n).join(" ")}}function fy(t){return t.getComponent()?.type==="VERSION"}const La="@firebase/app",Lu="0.14.6";const Rt=new tc("@firebase/app"),dy="@firebase/app-compat",py="@firebase/analytics-compat",gy="@firebase/analytics",my="@firebase/app-check-compat",_y="@firebase/app-check",yy="@firebase/auth",vy="@firebase/auth-compat",wy="@firebase/database",Ey="@firebase/data-connect",Iy="@firebase/database-compat",Sy="@firebase/functions",by="@firebase/functions-compat",Cy="@firebase/installations",Ty="@firebase/installations-compat",Ay="@firebase/messaging",xy="@firebase/messaging-compat",Ny="@firebase/performance",My="@firebase/performance-compat",ky="@firebase/remote-config",Py="@firebase/remote-config-compat",Ry="@firebase/storage",Oy="@firebase/storage-compat",Dy="@firebase/firestore",Ly="@firebase/ai",$y="@firebase/firestore-compat",Fy="firebase",Uy="12.6.0";const $a="[DEFAULT]",By={[La]:"fire-core",[dy]:"fire-core-compat",[gy]:"fire-analytics",[py]:"fire-analytics-compat",[_y]:"fire-app-check",[my]:"fire-app-check-compat",[yy]:"fire-auth",[vy]:"fire-auth-compat",[wy]:"fire-rtdb",[Ey]:"fire-data-connect",[Iy]:"fire-rtdb-compat",[Sy]:"fire-fn",[by]:"fire-fn-compat",[Cy]:"fire-iid",[Ty]:"fire-iid-compat",[Ay]:"fire-fcm",[xy]:"fire-fcm-compat",[Ny]:"fire-perf",[My]:"fire-perf-compat",[ky]:"fire-rc",[Py]:"fire-rc-compat",[Ry]:"fire-gcs",[Oy]:"fire-gcs-compat",[Dy]:"fire-fst",[$y]:"fire-fst-compat",[Ly]:"fire-vertex","fire-js":"fire-js",[Fy]:"fire-js-all"};const Cs=new Map,Hy=new Map,Fa=new Map;function $u(t,e){try{t.container.addComponent(e)}catch(n){Rt.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function ri(t){const e=t.name;if(Fa.has(e))return Rt.debug(`There were multiple attempts to register component ${e}.`),!1;Fa.set(e,t);for(const n of Cs.values())$u(n,t);for(const n of Hy.values())$u(n,t);return!0}function ic(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function tt(t){return t==null?!1:t.settings!==void 0}const zy={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},en=new br("app","Firebase",zy);class Wy{constructor(e,n,i){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Nn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw en.create("app-deleted",{appName:this._name})}}const wi=Uy;function Td(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const i={name:$a,automaticDataCollectionEnabled:!0,...e},r=i.name;if(typeof r!="string"||!r)throw en.create("bad-app-name",{appName:String(r)});if(n||(n=yd()),!n)throw en.create("no-options");const s=Cs.get(r);if(s){if(xn(n,s.options)&&xn(i,s.config))return s;throw en.create("duplicate-app",{appName:r})}const o=new Y0(r);for(const l of Fa.values())o.addComponent(l);const a=new Wy(n,i,o);return Cs.set(r,a),a}function Ad(t=$a){const e=Cs.get(t);if(!e&&t===$a&&yd())return Td();if(!e)throw en.create("no-app",{appName:t});return e}function tn(t,e,n){let i=By[t]??t;n&&(i+=`-${n}`);const r=i.match(/\s|\//),s=e.match(/\s|\//);if(r||s){const o=[`Unable to register library "${i}" with version "${e}":`];r&&o.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&s&&o.push("and"),s&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Rt.warn(o.join(" "));return}ri(new Nn(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}const Vy="firebase-heartbeat-database",qy=1,rr="firebase-heartbeat-store";let la=null;function xd(){return la||(la=ly(Vy,qy,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(rr)}catch(n){console.warn(n)}}}}).catch(t=>{throw en.create("idb-open",{originalErrorMessage:t.message})})),la}async function Gy(t){try{const n=(await xd()).transaction(rr),i=await n.objectStore(rr).get(Nd(t));return await n.done,i}catch(e){if(e instanceof hn)Rt.warn(e.message);else{const n=en.create("idb-get",{originalErrorMessage:e?.message});Rt.warn(n.message)}}}async function Fu(t,e){try{const i=(await xd()).transaction(rr,"readwrite");await i.objectStore(rr).put(e,Nd(t)),await i.done}catch(n){if(n instanceof hn)Rt.warn(n.message);else{const i=en.create("idb-set",{originalErrorMessage:n?.message});Rt.warn(i.message)}}}function Nd(t){return`${t.name}!${t.options.appId}`}const jy=1024,Ky=30;class Yy{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new Qy(n),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Uu();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(r=>r.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats.length>Ky){const r=Jy(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(r,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Rt.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Uu(),{heartbeatsToSend:n,unsentEntries:i}=Xy(this._heartbeatsCache.heartbeats),r=Is(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return Rt.warn(e),""}}}function Uu(){return new Date().toISOString().substring(0,10)}function Xy(t,e=jy){const n=[];let i=t.slice();for(const r of t){const s=n.find(o=>o.agent===r.agent);if(s){if(s.dates.push(r.date),Bu(n)>e){s.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),Bu(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}class Qy{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return O0()?D0().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await Gy(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return Fu(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return Fu(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function Bu(t){return Is(JSON.stringify({version:2,heartbeats:t})).length}function Jy(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let i=1;i<t.length;i++)t[i].date<n&&(n=t[i].date,e=i);return e}function Zy(t){ri(new Nn("platform-logger",e=>new hy(e),"PRIVATE")),ri(new Nn("heartbeat",e=>new Yy(e),"PRIVATE")),tn(La,Lu,t),tn(La,Lu,"esm2020"),tn("fire-js","")}Zy("");var ev="firebase",tv="12.7.0";tn(ev,tv,"app");function Md(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const nv=Md,kd=new br("auth","Firebase",Md());const Ts=new tc("@firebase/auth");function iv(t,...e){Ts.logLevel<=re.WARN&&Ts.warn(`Auth (${wi}): ${t}`,...e)}function as(t,...e){Ts.logLevel<=re.ERROR&&Ts.error(`Auth (${wi}): ${t}`,...e)}function Ot(t,...e){throw rc(t,...e)}function _t(t,...e){return rc(t,...e)}function Pd(t,e,n){const i={...nv(),[e]:n};return new br("auth","Firebase",i).create(e,{appName:t.name})}function nn(t){return Pd(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function rc(t,...e){if(typeof t!="string"){const n=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=t.name),t._errorFactory.create(n,...i)}return kd.create(t,...e)}function z(t,e,...n){if(!t)throw rc(e,...n)}function At(t){const e="INTERNAL ASSERTION FAILED: "+t;throw as(e),new Error(e)}function Dt(t,e){t||At(e)}function Ua(){return typeof self<"u"&&self.location?.href||""}function rv(){return Hu()==="http:"||Hu()==="https:"}function Hu(){return typeof self<"u"&&self.location?.protocol||null}function sv(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(rv()||k0()||"connection"in navigator)?navigator.onLine:!0}function ov(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}class Cr{constructor(e,n){this.shortDelay=e,this.longDelay=n,Dt(n>e,"Short delay should be less than long delay!"),this.isMobile=Zl()||Id()}get(){return sv()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function sc(t,e){Dt(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class Rd{static initialize(e,n,i){this.fetchImpl=e,n&&(this.headersImpl=n),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;At("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;At("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;At("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const av={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const lv=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],cv=new Cr(3e4,6e4);function Mo(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Ei(t,e,n,i,r={}){return Od(t,r,async()=>{let s={},o={};i&&(e==="GET"?o=i:s={body:JSON.stringify(i)});const a=vi({key:t.config.apiKey,...o}).slice(1),l=await t._getAdditionalHeaders();l["Content-Type"]="application/json",t.languageCode&&(l["X-Firebase-Locale"]=t.languageCode);const c={method:e,headers:l,...s};return M0()||(c.referrerPolicy="no-referrer"),t.emulatorConfig&&yi(t.emulatorConfig.host)&&(c.credentials="include"),Rd.fetch()(await Ld(t,t.config.apiHost,n,a),c)})}async function Od(t,e,n){t._canInitEmulator=!1;const i={...av,...e};try{const r=new uv(t),s=await Promise.race([n(),r.promise]);r.clearNetworkTimeout();const o=await s.json();if("needConfirmation"in o)throw Hr(t,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Hr(t,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Hr(t,"email-already-in-use",o);if(l==="USER_DISABLED")throw Hr(t,"user-disabled",o);const h=i[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw Pd(t,h,c);Ot(t,h)}}catch(r){if(r instanceof hn)throw r;Ot(t,"network-request-failed",{message:String(r)})}}async function Dd(t,e,n,i,r={}){const s=await Ei(t,e,n,i,r);return"mfaPendingCredential"in s&&Ot(t,"multi-factor-auth-required",{_serverResponse:s}),s}async function Ld(t,e,n,i){const r=`${e}${n}?${i}`,s=t,o=s.config.emulator?sc(t.config,r):`${t.config.apiScheme}://${r}`;return lv.includes(n)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(o).toString():o}class uv{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,i)=>{this.timer=setTimeout(()=>i(_t(this.auth,"network-request-failed")),cv.get())})}}function Hr(t,e,n){const i={appName:t.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const r=_t(t,e,i);return r.customData._tokenResponse=n,r}async function hv(t,e){return Ei(t,"POST","/v1/accounts:delete",e)}async function As(t,e){return Ei(t,"POST","/v1/accounts:lookup",e)}function ji(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function fv(t,e=!1){const n=Qe(t),i=await n.getIdToken(e),r=oc(i);z(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const s=typeof r.firebase=="object"?r.firebase:void 0,o=s?.sign_in_provider;return{claims:r,token:i,authTime:ji(ca(r.auth_time)),issuedAtTime:ji(ca(r.iat)),expirationTime:ji(ca(r.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}}function ca(t){return Number(t)*1e3}function oc(t){const[e,n,i]=t.split(".");if(e===void 0||n===void 0||i===void 0)return as("JWT malformed, contained fewer than 3 sections"),null;try{const r=Ss(n);return r?JSON.parse(r):(as("Failed to decode base64 JWT payload"),null)}catch(r){return as("Caught error parsing JWT payload as JSON",r?.toString()),null}}function zu(t){const e=oc(t);return z(e,"internal-error"),z(typeof e.exp<"u","internal-error"),z(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function sr(t,e,n=!1){if(n)return e;try{return await e}catch(i){throw i instanceof hn&&dv(i)&&t.auth.currentUser===t&&await t.auth.signOut(),i}}function dv({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}class pv{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const i=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Ba{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=ji(this.lastLoginAt),this.creationTime=ji(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function xs(t){const e=t.auth,n=await t.getIdToken(),i=await sr(t,As(e,{idToken:n}));z(i?.users.length,e,"internal-error");const r=i.users[0];t._notifyReloadListener(r);const s=r.providerUserInfo?.length?$d(r.providerUserInfo):[],o=mv(t.providerData,s),a=t.isAnonymous,l=!(t.email&&r.passwordHash)&&!o?.length,c=a?l:!1,h={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new Ba(r.createdAt,r.lastLoginAt),isAnonymous:c};Object.assign(t,h)}async function gv(t){const e=Qe(t);await xs(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function mv(t,e){return[...t.filter(i=>!e.some(r=>r.providerId===i.providerId)),...e]}function $d(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function _v(t,e){const n=await Od(t,{},async()=>{const i=vi({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:s}=t.config,o=await Ld(t,r,"/v1/token",`key=${s}`),a=await t._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:i};return t.emulatorConfig&&yi(t.emulatorConfig.host)&&(l.credentials="include"),Rd.fetch()(o,l)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function yv(t,e){return Ei(t,"POST","/v2/accounts:revokeToken",Mo(t,e))}class Yn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){z(e.idToken,"internal-error"),z(typeof e.idToken<"u","internal-error"),z(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):zu(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){z(e.length!==0,"internal-error");const n=zu(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(z(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:i,refreshToken:r,expiresIn:s}=await _v(e,n);this.updateTokensAndExpiration(i,r,Number(s))}updateTokensAndExpiration(e,n,i){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,n){const{refreshToken:i,accessToken:r,expirationTime:s}=n,o=new Yn;return i&&(z(typeof i=="string","internal-error",{appName:e}),o.refreshToken=i),r&&(z(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),s&&(z(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Yn,this.toJSON())}_performRefresh(){return At("not implemented")}}function Vt(t,e){z(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class rt{constructor({uid:e,auth:n,stsTokenManager:i,...r}){this.providerId="firebase",this.proactiveRefresh=new pv(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Ba(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const n=await sr(this,this.stsTokenManager.getToken(this.auth,e));return z(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return fv(this,e)}reload(){return gv(this)}_assign(e){this!==e&&(z(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new rt({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){z(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),n&&await xs(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(tt(this.auth.app))return Promise.reject(nn(this.auth));const e=await this.getIdToken();return await sr(this,hv(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const i=n.displayName??void 0,r=n.email??void 0,s=n.phoneNumber??void 0,o=n.photoURL??void 0,a=n.tenantId??void 0,l=n._redirectEventId??void 0,c=n.createdAt??void 0,h=n.lastLoginAt??void 0,{uid:u,emailVerified:f,isAnonymous:d,providerData:w,stsTokenManager:b}=n;z(u&&b,e,"internal-error");const N=Yn.fromJSON(this.name,b);z(typeof u=="string",e,"internal-error"),Vt(i,e.name),Vt(r,e.name),z(typeof f=="boolean",e,"internal-error"),z(typeof d=="boolean",e,"internal-error"),Vt(s,e.name),Vt(o,e.name),Vt(a,e.name),Vt(l,e.name),Vt(c,e.name),Vt(h,e.name);const x=new rt({uid:u,auth:e,email:r,emailVerified:f,displayName:i,isAnonymous:d,photoURL:o,phoneNumber:s,tenantId:a,stsTokenManager:N,createdAt:c,lastLoginAt:h});return w&&Array.isArray(w)&&(x.providerData=w.map(A=>({...A}))),l&&(x._redirectEventId=l),x}static async _fromIdTokenResponse(e,n,i=!1){const r=new Yn;r.updateFromServerResponse(n);const s=new rt({uid:n.localId,auth:e,stsTokenManager:r,isAnonymous:i});return await xs(s),s}static async _fromGetAccountInfoResponse(e,n,i){const r=n.users[0];z(r.localId!==void 0,"internal-error");const s=r.providerUserInfo!==void 0?$d(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!s?.length,a=new Yn;a.updateFromIdToken(i);const l=new rt({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new Ba(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!s?.length};return Object.assign(l,c),l}}const Wu=new Map;function xt(t){Dt(t instanceof Function,"Expected a class definition");let e=Wu.get(t);return e?(Dt(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Wu.set(t,e),e)}class Fd{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}Fd.type="NONE";const Vu=Fd;function ls(t,e,n){return`firebase:${t}:${e}:${n}`}class Xn{constructor(e,n,i){this.persistence=e,this.auth=n,this.userKey=i;const{config:r,name:s}=this.auth;this.fullUserKey=ls(this.userKey,r.apiKey,s),this.fullPersistenceKey=ls("persistence",r.apiKey,s),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await As(this.auth,{idToken:e}).catch(()=>{});return n?rt._fromGetAccountInfoResponse(this.auth,n,e):null}return rt._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,i="authUser"){if(!n.length)return new Xn(xt(Vu),e,i);const r=(await Promise.all(n.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let s=r[0]||xt(Vu);const o=ls(i,e.config.apiKey,e.name);let a=null;for(const c of n)try{const h=await c._get(o);if(h){let u;if(typeof h=="string"){const f=await As(e,{idToken:h}).catch(()=>{});if(!f)break;u=await rt._fromGetAccountInfoResponse(e,f,h)}else u=rt._fromJSON(e,h);c!==s&&(a=u),s=c;break}}catch{}const l=r.filter(c=>c._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new Xn(s,e,i):(s=l[0],a&&await s._set(o,a.toJSON()),await Promise.all(n.map(async c=>{if(c!==s)try{await c._remove(o)}catch{}})),new Xn(s,e,i))}}function qu(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(zd(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Ud(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Vd(e))return"Blackberry";if(qd(e))return"Webos";if(Bd(e))return"Safari";if((e.includes("chrome/")||Hd(e))&&!e.includes("edge/"))return"Chrome";if(Wd(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=t.match(n);if(i?.length===2)return i[1]}return"Other"}function Ud(t=Re()){return/firefox\//i.test(t)}function Bd(t=Re()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Hd(t=Re()){return/crios\//i.test(t)}function zd(t=Re()){return/iemobile/i.test(t)}function Wd(t=Re()){return/android/i.test(t)}function Vd(t=Re()){return/blackberry/i.test(t)}function qd(t=Re()){return/webos/i.test(t)}function ac(t=Re()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function vv(t=Re()){return ac(t)&&!!window.navigator?.standalone}function wv(){return P0()&&document.documentMode===10}function Gd(t=Re()){return ac(t)||Wd(t)||qd(t)||Vd(t)||/windows phone/i.test(t)||zd(t)}function jd(t,e=[]){let n;switch(t){case"Browser":n=qu(Re());break;case"Worker":n=`${qu(Re())}-${t}`;break;default:n=t}const i=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${wi}/${i}`}class Ev{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const i=s=>new Promise((o,a)=>{try{const l=e(s);o(l)}catch(l){a(l)}});i.onAbort=n,this.queue.push(i);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const i of this.queue)await i(e),i.onAbort&&n.push(i.onAbort)}catch(i){n.reverse();for(const r of n)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}}}async function Iv(t,e={}){return Ei(t,"GET","/v2/passwordPolicy",Mo(t,e))}const Sv=6;class bv{constructor(e){const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??Sv,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const i=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;i&&(n.meetsMinPasswordLength=e.length>=i),r&&(n.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let i;for(let r=0;r<e.length;r++)i=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(n,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,n,i,r,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class Cv{constructor(e,n,i,r){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=i,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Gu(this),this.idTokenSubscription=new Gu(this),this.beforeStateQueue=new Ev(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=kd,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=xt(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Xn.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await As(this,{idToken:e}),i=await rt._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(i)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(tt(this.app)){const s=this.app.settings.authIdToken;return s?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(s).then(o,o))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let i=n,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const s=this.redirectUser?._redirectEventId,o=i?._redirectEventId,a=await this.tryRedirectSignIn(e);(!s||s===o)&&a?.user&&(i=a.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(s){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return z(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await xs(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=ov()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(tt(this.app))return Promise.reject(nn(this));const n=e?Qe(e):null;return n&&z(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&z(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return tt(this.app)?Promise.reject(nn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return tt(this.app)?Promise.reject(nn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(xt(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Iv(this),n=new bv(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new br("auth","Firebase",e())}onAuthStateChanged(e,n,i){return this.registerStateListener(this.authStateSubscription,e,n,i)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,i){return this.registerStateListener(this.idTokenSubscription,e,n,i)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(i.tenantId=this.tenantId),await yv(this,i)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,n){const i=await this.getOrInitRedirectPersistenceManager(n);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&xt(e)||this._popupRedirectResolver;z(n,this,"argument-error"),this.redirectPersistenceManager=await Xn.create(this,[xt(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,i,r){if(this._deleted)return()=>{};const s=typeof n=="function"?n:n.next.bind(n);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(z(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof n=="function"){const l=e.addObserver(n,i,r);return()=>{o=!0,l()}}else{const l=e.addObserver(n);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return z(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=jd(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(e["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(e["X-Firebase-AppCheck"]=i),e}async _getAppCheckToken(){if(tt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&iv(`Error while retrieving App Check token: ${e.error}`),e?.token}}function ko(t){return Qe(t)}class Gu{constructor(e){this.auth=e,this.observer=null,this.addObserver=z0(n=>this.observer=n)}get next(){return z(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let lc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Tv(t){lc=t}function Av(t){return lc.loadJS(t)}function xv(){return lc.gapiScript}function Nv(t){return`__${t}${Math.floor(Math.random()*1e6)}`}function Mv(t,e){const n=ic(t,"auth");if(n.isInitialized()){const r=n.getImmediate(),s=n.getOptions();if(xn(s,e??{}))return r;Ot(r,"already-initialized")}return n.initialize({options:e})}function kv(t,e){const n=e?.persistence||[],i=(Array.isArray(n)?n:[n]).map(xt);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(i,e?.popupRedirectResolver)}function Pv(t,e,n){const i=ko(t);z(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const r=!1,s=Kd(e),{host:o,port:a}=Rv(e),l=a===null?"":`:${a}`,c={url:`${s}//${o}${l}/`},h=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!i._canInitEmulator){z(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),z(xn(c,i.config.emulator)&&xn(h,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=c,i.emulatorConfig=h,i.settings.appVerificationDisabledForTesting=!0,yi(o)?(wd(`${s}//${o}${l}`),Ed("Auth",!0)):Ov()}function Kd(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function Rv(t){const e=Kd(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const s=r[1];return{host:s,port:ju(i.substr(s.length+1))}}else{const[s,o]=i.split(":");return{host:s,port:ju(o)}}}function ju(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function Ov(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}class Yd{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return At("not implemented")}_getIdTokenResponse(e){return At("not implemented")}_linkToIdToken(e,n){return At("not implemented")}_getReauthenticationResolver(e){return At("not implemented")}}async function Qn(t,e){return Dd(t,"POST","/v1/accounts:signInWithIdp",Mo(t,e))}const Dv="http://localhost";class Mn extends Yd{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Mn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Ot("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:r,...s}=n;if(!i||!r)return null;const o=new Mn(i,r);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return Qn(e,n)}_linkToIdToken(e,n){const i=this.buildRequest();return i.idToken=n,Qn(e,i)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Qn(e,n)}buildRequest(){const e={requestUri:Dv,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=vi(n)}return e}}class Xd{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Tr extends Xd{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class jt extends Tr{constructor(){super("facebook.com")}static credential(e){return Mn._fromParams({providerId:jt.PROVIDER_ID,signInMethod:jt.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return jt.credentialFromTaggedObject(e)}static credentialFromError(e){return jt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return jt.credential(e.oauthAccessToken)}catch{return null}}}jt.FACEBOOK_SIGN_IN_METHOD="facebook.com";jt.PROVIDER_ID="facebook.com";class Kt extends Tr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Mn._fromParams({providerId:Kt.PROVIDER_ID,signInMethod:Kt.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Kt.credentialFromTaggedObject(e)}static credentialFromError(e){return Kt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:i}=e;if(!n&&!i)return null;try{return Kt.credential(n,i)}catch{return null}}}Kt.GOOGLE_SIGN_IN_METHOD="google.com";Kt.PROVIDER_ID="google.com";class Yt extends Tr{constructor(){super("github.com")}static credential(e){return Mn._fromParams({providerId:Yt.PROVIDER_ID,signInMethod:Yt.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Yt.credentialFromTaggedObject(e)}static credentialFromError(e){return Yt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Yt.credential(e.oauthAccessToken)}catch{return null}}}Yt.GITHUB_SIGN_IN_METHOD="github.com";Yt.PROVIDER_ID="github.com";class Xt extends Tr{constructor(){super("twitter.com")}static credential(e,n){return Mn._fromParams({providerId:Xt.PROVIDER_ID,signInMethod:Xt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Xt.credentialFromTaggedObject(e)}static credentialFromError(e){return Xt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:i}=e;if(!n||!i)return null;try{return Xt.credential(n,i)}catch{return null}}}Xt.TWITTER_SIGN_IN_METHOD="twitter.com";Xt.PROVIDER_ID="twitter.com";async function Lv(t,e){return Dd(t,"POST","/v1/accounts:signUp",Mo(t,e))}class on{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,i,r=!1){const s=await rt._fromIdTokenResponse(e,i,r),o=Ku(i);return new on({user:s,providerId:o,_tokenResponse:i,operationType:n})}static async _forOperation(e,n,i){await e._updateTokensIfNecessary(i,!0);const r=Ku(i);return new on({user:e,providerId:r,_tokenResponse:i,operationType:n})}}function Ku(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}async function $v(t){if(tt(t.app))return Promise.reject(nn(t));const e=ko(t);if(await e._initializationPromise,e.currentUser?.isAnonymous)return new on({user:e.currentUser,providerId:null,operationType:"signIn"});const n=await Lv(e,{returnSecureToken:!0}),i=await on._fromIdTokenResponse(e,"signIn",n,!0);return await e._updateCurrentUser(i.user),i}class Ns extends hn{constructor(e,n,i,r){super(n.code,n.message),this.operationType=i,this.user=r,Object.setPrototypeOf(this,Ns.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,n,i,r){return new Ns(e,n,i,r)}}function Qd(t,e,n,i){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Ns._fromErrorAndOperation(t,s,e,i):s})}async function Fv(t,e,n=!1){const i=await sr(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return on._forOperation(t,"link",i)}async function Uv(t,e,n=!1){const{auth:i}=t;if(tt(i.app))return Promise.reject(nn(i));const r="reauthenticate";try{const s=await sr(t,Qd(i,r,e,t),n);z(s.idToken,i,"internal-error");const o=oc(s.idToken);z(o,i,"internal-error");const{sub:a}=o;return z(t.uid===a,i,"user-mismatch"),on._forOperation(t,r,s)}catch(s){throw s?.code==="auth/user-not-found"&&Ot(i,"user-mismatch"),s}}async function Bv(t,e,n=!1){if(tt(t.app))return Promise.reject(nn(t));const i="signIn",r=await Qd(t,i,e),s=await on._fromIdTokenResponse(t,i,r);return n||await t._updateCurrentUser(s.user),s}function Hv(t,e,n,i){return Qe(t).onIdTokenChanged(e,n,i)}function zv(t,e,n){return Qe(t).beforeAuthStateChanged(e,n)}const Ms="__sak";class Jd{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Ms,"1"),this.storage.removeItem(Ms),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Wv=1e3,Vv=10;class Zd extends Jd{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Gd(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const i=this.storage.getItem(n),r=this.localCache[n];i!==r&&e(n,r,i)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const i=e.key;n?this.detachListener():this.stopPolling();const r=()=>{const o=this.storage.getItem(i);!n&&this.localCache[i]===o||this.notifyListeners(i,o)},s=this.storage.getItem(i);wv()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,Vv):r()}notifyListeners(e,n){this.localCache[e]=n;const i=this.listeners[e];if(i)for(const r of Array.from(i))r(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:i}),!0)})},Wv)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}Zd.type="LOCAL";const qv=Zd;class ep extends Jd{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}ep.type="SESSION";const tp=ep;function Gv(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}class Po{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(r=>r.isListeningto(e));if(n)return n;const i=new Po(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:i,eventType:r,data:s}=n.data,o=this.handlersMap[r];if(!o?.size)return;n.ports[0].postMessage({status:"ack",eventId:i,eventType:r});const a=Array.from(o).map(async c=>c(n.origin,s)),l=await Gv(a);n.ports[0].postMessage({status:"done",eventId:i,eventType:r,response:l})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Po.receivers=[];function cc(t="",e=10){let n="";for(let i=0;i<e;i++)n+=Math.floor(Math.random()*10);return t+n}class jv{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,i=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,o;return new Promise((a,l)=>{const c=cc("",20);r.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},i);o={messageChannel:r,onMessage(u){const f=u;if(f.data.eventId===c)switch(f.data.status){case"ack":clearTimeout(h),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(f.data.response);break;default:clearTimeout(h),clearTimeout(s),l(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:n},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}function yt(){return window}function Kv(t){yt().location.href=t}function np(){return typeof yt().WorkerGlobalScope<"u"&&typeof yt().importScripts=="function"}async function Yv(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Xv(){return navigator?.serviceWorker?.controller||null}function Qv(){return np()?self:null}const ip="firebaseLocalStorageDb",Jv=1,ks="firebaseLocalStorage",rp="fbase_key";class Ar{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Ro(t,e){return t.transaction([ks],e?"readwrite":"readonly").objectStore(ks)}function Zv(){const t=indexedDB.deleteDatabase(ip);return new Ar(t).toPromise()}function Ha(){const t=indexedDB.open(ip,Jv);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const i=t.result;try{i.createObjectStore(ks,{keyPath:rp})}catch(r){n(r)}}),t.addEventListener("success",async()=>{const i=t.result;i.objectStoreNames.contains(ks)?e(i):(i.close(),await Zv(),e(await Ha()))})})}async function Yu(t,e,n){const i=Ro(t,!0).put({[rp]:e,value:n});return new Ar(i).toPromise()}async function ew(t,e){const n=Ro(t,!1).get(e),i=await new Ar(n).toPromise();return i===void 0?null:i.value}function Xu(t,e){const n=Ro(t,!0).delete(e);return new Ar(n).toPromise()}const tw=800,nw=3;class sp{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Ha(),this.db)}async _withRetries(e){let n=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(n++>nw)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return np()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Po._getInstance(Qv()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await Yv(),!this.activeServiceWorker)return;this.sender=new jv(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Xv()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Ha();return await Yu(e,Ms,"1"),await Xu(e,Ms),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(i=>Yu(i,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(i=>ew(i,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Xu(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const s=Ro(r,!1).getAll();return new Ar(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],i=new Set;if(e.length!==0)for(const{fbase_key:r,value:s}of e)i.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(s)&&(this.notifyListeners(r,s),n.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!i.has(r)&&(this.notifyListeners(r,null),n.push(r));return n}notifyListeners(e,n){this.localCache[e]=n;const i=this.listeners[e];if(i)for(const r of Array.from(i))r(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),tw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}sp.type="LOCAL";const iw=sp;new Cr(3e4,6e4);function rw(t,e){return e?xt(e):(z(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}class uc extends Yd{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Qn(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Qn(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Qn(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function sw(t){return Bv(t.auth,new uc(t),t.bypassAuthState)}function ow(t){const{auth:e,user:n}=t;return z(n,e,"internal-error"),Uv(n,new uc(t),t.bypassAuthState)}async function aw(t){const{auth:e,user:n}=t;return z(n,e,"internal-error"),Fv(n,new uc(t),t.bypassAuthState)}class op{constructor(e,n,i,r,s=!1){this.auth=e,this.resolver=i,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:i,postBody:r,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:n,sessionId:i,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return sw;case"linkViaPopup":case"linkViaRedirect":return aw;case"reauthViaPopup":case"reauthViaRedirect":return ow;default:Ot(this.auth,"internal-error")}}resolve(e){Dt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Dt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const lw=new Cr(2e3,1e4);class Vn extends op{constructor(e,n,i,r,s){super(e,n,r,s),this.provider=i,this.authWindow=null,this.pollId=null,Vn.currentPopupAction&&Vn.currentPopupAction.cancel(),Vn.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return z(e,this.auth,"internal-error"),e}async onExecution(){Dt(this.filter.length===1,"Popup operations only handle one event");const e=cc();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(_t(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(_t(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Vn.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(_t(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,lw.get())};e()}}Vn.currentPopupAction=null;const cw="pendingRedirect",cs=new Map;class uw extends op{constructor(e,n,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,i),this.eventId=null}async execute(){let e=cs.get(this.auth._key());if(!e){try{const i=await hw(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(n){e=()=>Promise.reject(n)}cs.set(this.auth._key(),e)}return this.bypassAuthState||cs.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function hw(t,e){const n=pw(e),i=dw(t);if(!await i._isAvailable())return!1;const r=await i._get(n)==="true";return await i._remove(n),r}function fw(t,e){cs.set(t._key(),e)}function dw(t){return xt(t._redirectPersistence)}function pw(t){return ls(cw,t.config.apiKey,t.name)}async function gw(t,e,n=!1){if(tt(t.app))return Promise.reject(nn(t));const i=ko(t),r=rw(i,e),o=await new uw(i,r,n).execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,e)),o}const mw=600*1e3;class _w{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(n=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!yw(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){if(e.error&&!ap(e)){const i=e.error.code?.split("auth/")[1]||"internal-error";n.onError(_t(this.auth,i))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const i=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=mw&&this.cachedEventUids.clear(),this.cachedEventUids.has(Qu(e))}saveEventToCache(e){this.cachedEventUids.add(Qu(e)),this.lastProcessedEventTime=Date.now()}}function Qu(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function ap({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function yw(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ap(t);default:return!1}}async function vw(t,e={}){return Ei(t,"GET","/v1/projects",e)}const ww=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Ew=/^https?/;async function Iw(t){if(t.config.emulator)return;const{authorizedDomains:e}=await vw(t);for(const n of e)try{if(Sw(n))return}catch{}Ot(t,"unauthorized-domain")}function Sw(t){const e=Ua(),{protocol:n,hostname:i}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&i===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===i}if(!Ew.test(n))return!1;if(ww.test(t))return i===t;const r=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}const bw=new Cr(3e4,6e4);function Ju(){const t=yt().___jsl;if(t?.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function Cw(t){return new Promise((e,n)=>{function i(){Ju(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Ju(),n(_t(t,"network-request-failed"))},timeout:bw.get()})}if(yt().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(yt().gapi?.load)i();else{const r=Nv("iframefcb");return yt()[r]=()=>{gapi.load?i():n(_t(t,"network-request-failed"))},Av(`${xv()}?onload=${r}`).catch(s=>n(s))}}).catch(e=>{throw us=null,e})}let us=null;function Tw(t){return us=us||Cw(t),us}const Aw=new Cr(5e3,15e3),xw="__/auth/iframe",Nw="emulator/auth/iframe",Mw={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},kw=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Pw(t){const e=t.config;z(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?sc(e,Nw):`https://${t.config.authDomain}/${xw}`,i={apiKey:e.apiKey,appName:t.name,v:wi},r=kw.get(t.config.apiHost);r&&(i.eid=r);const s=t._getFrameworks();return s.length&&(i.fw=s.join(",")),`${n}?${vi(i).slice(1)}`}async function Rw(t){const e=await Tw(t),n=yt().gapi;return z(n,t,"internal-error"),e.open({where:document.body,url:Pw(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Mw,dontclear:!0},i=>new Promise(async(r,s)=>{await i.restyle({setHideOnLeave:!1});const o=_t(t,"network-request-failed"),a=yt().setTimeout(()=>{s(o)},Aw.get());function l(){yt().clearTimeout(a),r(i)}i.ping(l).then(l,()=>{s(o)})}))}const Ow={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Dw=500,Lw=600,$w="_blank",Fw="http://localhost";class Zu{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Uw(t,e,n,i=Dw,r=Lw){const s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const l={...Ow,width:i.toString(),height:r.toString(),top:s,left:o},c=Re().toLowerCase();n&&(a=Hd(c)?$w:n),Ud(c)&&(e=e||Fw,l.scrollbars="yes");const h=Object.entries(l).reduce((f,[d,w])=>`${f}${d}=${w},`,"");if(vv(c)&&a!=="_self")return Bw(e||"",a),new Zu(null);const u=window.open(e||"",a,h);z(u,t,"popup-blocked");try{u.focus()}catch{}return new Zu(u)}function Bw(t,e){const n=document.createElement("a");n.href=t,n.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}const Hw="__/auth/handler",zw="emulator/auth/handler",Ww=encodeURIComponent("fac");async function eh(t,e,n,i,r,s){z(t.config.authDomain,t,"auth-domain-config-required"),z(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:i,v:wi,eventId:r};if(e instanceof Xd){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",Ra(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,u]of Object.entries({}))o[h]=u}if(e instanceof Tr){const h=e.getScopes().filter(u=>u!=="");h.length>0&&(o.scopes=h.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await t._getAppCheckToken(),c=l?`#${Ww}=${encodeURIComponent(l)}`:"";return`${Vw(t)}?${vi(a).slice(1)}${c}`}function Vw({config:t}){return t.emulator?sc(t,zw):`https://${t.authDomain}/${Hw}`}const ua="webStorageSupport";class qw{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=tp,this._completeRedirectFn=gw,this._overrideRedirectResult=fw}async _openPopup(e,n,i,r){Dt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const s=await eh(e,n,i,Ua(),r);return Uw(e,s,cc())}async _openRedirect(e,n,i,r){await this._originValidation(e);const s=await eh(e,n,i,Ua(),r);return Kv(s),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:r,promise:s}=this.eventManagers[n];return r?Promise.resolve(r):(Dt(s,"If manager is not set, promise should be"),s)}const i=this.initAndGetManager(e);return this.eventManagers[n]={promise:i},i.catch(()=>{delete this.eventManagers[n]}),i}async initAndGetManager(e){const n=await Rw(e),i=new _w(e);return n.register("authEvent",r=>(z(r?.authEvent,e,"invalid-auth-event"),{status:i.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=n,i}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(ua,{type:ua},r=>{const s=r?.[0]?.[ua];s!==void 0&&n(!!s),Ot(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=Iw(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return Gd()||Bd()||ac()}}const Gw=qw;var th="@firebase/auth",nh="1.12.0";class jw{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(i=>{e(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){z(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Kw(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Yw(t){ri(new Nn("auth",(e,{options:n})=>{const i=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=i.options;z(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});const l={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:jd(t)},c=new Cv(i,r,s,l);return kv(c,n),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,i)=>{e.getProvider("auth-internal").initialize()})),ri(new Nn("auth-internal",e=>{const n=ko(e.getProvider("auth").getImmediate());return(i=>new jw(i))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),tn(th,nh,Kw(t)),tn(th,nh,"esm2020")}const Xw=300,Qw=vd("authIdTokenMaxAge")||Xw;let ih=null;const Jw=t=>async e=>{const n=e&&await e.getIdTokenResult(),i=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(i&&i>Qw)return;const r=n?.token;ih!==r&&(ih=r,await fetch(t,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function Zw(t=Ad()){const e=ic(t,"auth");if(e.isInitialized())return e.getImmediate();const n=Mv(t,{popupRedirectResolver:Gw,persistence:[iw,qv,tp]}),i=vd("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(i,location.origin);if(location.origin===s.origin){const o=Jw(s.toString());zv(n,o,()=>o(n.currentUser)),Hv(n,a=>o(a))}}const r=_d("auth");return r&&Pv(n,`http://${r}`),n}function e1(){return document.getElementsByTagName("head")?.[0]??document}Tv({loadJS(t){return new Promise((e,n)=>{const i=document.createElement("script");i.setAttribute("src",t),i.onload=e,i.onerror=r=>{const s=_t("internal-error");s.customData=r,n(s)},i.type="text/javascript",i.charset="UTF-8",e1().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Yw("Browser");var rh={};const sh="@firebase/database",oh="1.1.0";let lp="";function t1(t){lp=t}class n1{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),pe(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:ir(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class i1{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return Ht(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const cp=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new n1(e)}}catch{}return new i1},yn=cp("localStorage"),r1=cp("sessionStorage");const Jn=new tc("@firebase/database"),s1=(function(){let t=1;return function(){return t++}})(),up=function(t){const e=q0(t),n=new H0;n.update(e);const i=n.digest();return Ql.encodeByteArray(i)},xr=function(...t){let e="";for(let n=0;n<t.length;n++){const i=t[n];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=xr.apply(null,i):typeof i=="object"?e+=pe(i):e+=i,e+=" "}return e};let Ki=null,ah=!0;const o1=function(t,e){F(!0,"Can't turn on custom loggers persistently."),Jn.logLevel=re.VERBOSE,Ki=Jn.log.bind(Jn)},be=function(...t){if(ah===!0&&(ah=!1,Ki===null&&r1.get("logging_enabled")===!0&&o1()),Ki){const e=xr.apply(null,t);Ki(e)}},Nr=function(t){return function(...e){be(t,...e)}},za=function(...t){const e="FIREBASE INTERNAL ERROR: "+xr(...t);Jn.error(e)},Lt=function(...t){const e=`FIREBASE FATAL ERROR: ${xr(...t)}`;throw Jn.error(e),new Error(e)},Fe=function(...t){const e="FIREBASE WARNING: "+xr(...t);Jn.warn(e)},a1=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Fe("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},hp=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},l1=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},si="[MIN_NAME]",kn="[MAX_NAME]",Ii=function(t,e){if(t===e)return 0;if(t===si||e===kn)return-1;if(e===si||t===kn)return 1;{const n=lh(t),i=lh(e);return n!==null?i!==null?n-i===0?t.length-e.length:n-i:-1:i!==null?1:t<e?-1:1}},c1=function(t,e){return t===e?0:t<e?-1:1},Ni=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+pe(e))},hc=function(t){if(typeof t!="object"||t===null)return pe(t);const e=[];for(const i in t)e.push(i);e.sort();let n="{";for(let i=0;i<e.length;i++)i!==0&&(n+=","),n+=pe(e[i]),n+=":",n+=hc(t[e[i]]);return n+="}",n},fp=function(t,e){const n=t.length;if(n<=e)return[t];const i=[];for(let r=0;r<n;r+=e)r+e>n?i.push(t.substring(r,n)):i.push(t.substring(r,r+e));return i};function Ue(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const dp=function(t){F(!hp(t),"Invalid JSON number");const e=11,n=52,i=(1<<e-1)-1;let r,s,o,a,l;t===0?(s=0,o=0,r=1/t===-1/0?1:0):(r=t<0,t=Math.abs(t),t>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),i),s=a+i,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(s=0,o=Math.round(t/Math.pow(2,1-i-n))));const c=[];for(l=n;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(s%2?1:0),s=Math.floor(s/2);c.push(r?1:0),c.reverse();const h=c.join("");let u="";for(l=0;l<64;l+=8){let f=parseInt(h.substr(l,8),2).toString(16);f.length===1&&(f="0"+f),u=u+f}return u.toLowerCase()},u1=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},h1=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function f1(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const i=new Error(t+" at "+e._path.toString()+": "+n);return i.code=t.toUpperCase(),i}const d1=new RegExp("^-?(0*)\\d{1,10}$"),p1=-2147483648,g1=2147483647,lh=function(t){if(d1.test(t)){const e=Number(t);if(e>=p1&&e<=g1)return e}return null},Si=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw Fe("Exception was thrown by user callback.",n),e},Math.floor(0))}},m1=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Yi=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};class _1{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,tt(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n?.getImmediate({optional:!0}),this.appCheck||n?.get().then(i=>this.appCheck=i)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,i):n(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(n=>n.addTokenListener(e))}notifyForInvalidToken(){Fe(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class y1{constructor(e,n,i){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(be("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,i):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Fe(e)}}class hs{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}hs.OWNER="owner";const fc="5",pp="v",gp="s",mp="r",_p="f",yp=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,vp="ls",wp="p",Wa="ac",Ep="websocket",Ip="long_polling";class Sp{constructor(e,n,i,r,s=!1,o="",a=!1,l=!1,c=null){this.secure=n,this.namespace=i,this.webSocketOnly=r,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=yn.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&yn.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function v1(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function bp(t,e,n){F(typeof e=="string","typeof type must == string"),F(typeof n=="object","typeof params must == object");let i;if(e===Ep)i=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===Ip)i=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);v1(t)&&(n.ns=t.namespace);const r=[];return Ue(n,(s,o)=>{r.push(s+"="+o)}),i+r.join("&")}class w1{constructor(){this.counters_={}}incrementCounter(e,n=1){Ht(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return w0(this.counters_)}}const ha={},fa={};function dc(t){const e=t.toString();return ha[e]||(ha[e]=new w1),ha[e]}function E1(t,e){const n=t.toString();return fa[n]||(fa[n]=e()),fa[n]}class I1{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<i.length;++r)i[r]&&Si(()=>{this.onMessage_(i[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const ch="start",S1="close",b1="pLPCommand",C1="pRTLPCB",Cp="id",Tp="pw",Ap="ser",T1="cb",A1="seg",x1="ts",N1="d",M1="dframe",xp=1870,Np=30,k1=xp-Np,P1=25e3,R1=3e4;class qn{constructor(e,n,i,r,s,o,a){this.connId=e,this.repoInfo=n,this.applicationId=i,this.appCheckToken=r,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Nr(e),this.stats_=dc(n),this.urlFn=l=>(this.appCheckToken&&(l[Wa]=this.appCheckToken),bp(n,Ip,l))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new I1(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(R1)),l1(()=>{if(this.isClosed_)return;this.scriptTagHolder=new pc((...s)=>{const[o,a,l,c,h]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===ch)this.id=a,this.password=l;else if(o===S1)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{const[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const i={};i[ch]="t",i[Ap]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[T1]=this.scriptTagHolder.uniqueCallbackIdentifier),i[pp]=fc,this.transportSessionId&&(i[gp]=this.transportSessionId),this.lastSessionId&&(i[vp]=this.lastSessionId),this.applicationId&&(i[wp]=this.applicationId),this.appCheckToken&&(i[Wa]=this.appCheckToken),typeof location<"u"&&location.hostname&&yp.test(location.hostname)&&(i[mp]=_p);const r=this.urlFn(i);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){qn.forceAllow_=!0}static forceDisallow(){qn.forceDisallow_=!0}static isAvailable(){return qn.forceAllow_?!0:!qn.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!u1()&&!h1()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=pe(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const i=gd(n),r=fp(i,k1);for(let s=0;s<r.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[s]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const i={};i[M1]="t",i[Cp]=e,i[Tp]=n,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=pe(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class pc{constructor(e,n,i,r){this.onDisconnect=i,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=s1(),window[b1+this.uniqueCallbackIdentifier]=e,window[C1+this.uniqueCallbackIdentifier]=n,this.myIFrame=pc.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){be("frame writing exception"),a.stack&&be(a.stack),be(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||be("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[Cp]=this.myID,e[Tp]=this.myPW,e[Ap]=this.currentSerial;let n=this.urlFn(e),i="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Np+i.length<=xp;){const o=this.pendingSegs.shift();i=i+"&"+A1+r+"="+o.seg+"&"+x1+r+"="+o.ts+"&"+N1+r+"="+o.d,r++}return n=n+i,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,i){this.pendingSegs.push({seg:e,ts:n,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const i=()=>{this.outstandingRequests.delete(n),this.newRequest_()},r=setTimeout(i,Math.floor(P1)),s=()=>{clearTimeout(r),i()};this.addTag(e,s)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const r=i.readyState;(!r||r==="loaded"||r==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),n())},i.onerror=()=>{be("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}const O1=16384,D1=45e3;let Ps=null;typeof MozWebSocket<"u"?Ps=MozWebSocket:typeof WebSocket<"u"&&(Ps=WebSocket);class nt{constructor(e,n,i,r,s,o,a){this.connId=e,this.applicationId=i,this.appCheckToken=r,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Nr(this.connId),this.stats_=dc(n),this.connURL=nt.connectionURL_(n,o,a,r,i),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,i,r,s){const o={};return o[pp]=fc,typeof location<"u"&&location.hostname&&yp.test(location.hostname)&&(o[mp]=_p),n&&(o[gp]=n),i&&(o[vp]=i),r&&(o[Wa]=r),s&&(o[wp]=s),bp(e,Ep,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,yn.set("previous_websocket_failure",!0);try{let i;R0(),this.mySock=new Ps(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");const r=i.message||i.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");const r=i.message||i.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){nt.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(n);i&&i.length>1&&parseFloat(i[1])<4.4&&(e=!0)}return!e&&Ps!==null&&!nt.forceDisallow_}static previouslyFailed(){return yn.isInMemoryStorage||yn.get("previous_websocket_failure")===!0}markConnectionHealthy(){yn.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const i=ir(n);this.onMessage(i)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(F(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const i=this.extractFrameCount_(n);i!==null&&this.appendFrame_(i)}}send(e){this.resetKeepAlive();const n=pe(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const i=fp(n,O1);i.length>1&&this.sendString_(String(i.length));for(let r=0;r<i.length;r++)this.sendString_(i[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(D1))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}nt.responsesRequiredToBeHealthy=2;nt.healthyTimeout=3e4;class or{static get ALL_TRANSPORTS(){return[qn,nt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=nt&&nt.isAvailable();let i=n&&!nt.previouslyFailed();if(e.webSocketOnly&&(n||Fe("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[nt];else{const r=this.transports_=[];for(const s of or.ALL_TRANSPORTS)s&&s.isAvailable()&&r.push(s);or.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}or.globalTransportInitialized_=!1;const L1=6e4,$1=5e3,F1=10*1024,U1=100*1024,da="t",uh="d",B1="s",hh="r",H1="e",fh="o",dh="a",ph="n",gh="p",z1="h";class W1{constructor(e,n,i,r,s,o,a,l,c,h){this.id=e,this.repoInfo_=n,this.applicationId_=i,this.appCheckToken_=r,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Nr("c:"+this.id+":"),this.transportManager_=new or(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,i)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=Yi(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>U1?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>F1?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(da in e){const n=e[da];n===dh?this.upgradeIfSecondaryHealthy_():n===hh?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===fh&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=Ni("t",e),i=Ni("d",e);if(n==="c")this.onSecondaryControl_(i);else if(n==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:gh,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:dh,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:ph,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=Ni("t",e),i=Ni("d",e);n==="c"?this.onControl_(i):n==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=Ni(da,e);if(uh in e){const i=e[uh];if(n===z1){const r={...i};this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(n===ph){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===B1?this.onConnectionShutdown_(i):n===hh?this.onReset_(i):n===H1?za("Server Error: "+i):n===fh?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):za("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,i=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),fc!==i&&Fe("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,i),Yi(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(L1))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Yi(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor($1))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:gh,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(yn.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Mp{put(e,n,i,r){}merge(e,n,i,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,i){}onDisconnectMerge(e,n,i){}onDisconnectCancel(e,n){}reportStats(e){}}class kp{constructor(e){this.allowedEvents_=e,this.listeners_={},F(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let r=0;r<i.length;r++)i[r].callback.apply(i[r].context,n)}}on(e,n,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:i});const r=this.getInitialEvent(e);r&&n.apply(i,r)}off(e,n,i){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let s=0;s<r.length;s++)if(r[s].callback===n&&(!i||i===r[s].context)){r.splice(s,1);return}}validateEventType_(e){F(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}class Rs extends kp{static getInstance(){return new Rs}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Zl()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return F(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const mh=32,_h=768;let se=class{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let i=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[i]=this.pieces_[r],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}};function te(){return new se("")}function Q(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function an(t){return t.pieces_.length-t.pieceNum_}function oe(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new se(t.pieces_,e)}function Pp(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function V1(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function Rp(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Op(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new se(e,0)}function ge(t,e){const n=[];for(let i=t.pieceNum_;i<t.pieces_.length;i++)n.push(t.pieces_[i]);if(e instanceof se)for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);else{const i=e.split("/");for(let r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new se(n,0)}function X(t){return t.pieceNum_>=t.pieces_.length}function Pe(t,e){const n=Q(t),i=Q(e);if(n===null)return e;if(n===i)return Pe(oe(t),oe(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function Dp(t,e){if(an(t)!==an(e))return!1;for(let n=t.pieceNum_,i=e.pieceNum_;n<=t.pieces_.length;n++,i++)if(t.pieces_[n]!==e.pieces_[i])return!1;return!0}function st(t,e){let n=t.pieceNum_,i=e.pieceNum_;if(an(t)>an(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[i])return!1;++n,++i}return!0}class q1{constructor(e,n){this.errorPrefix_=n,this.parts_=Rp(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=No(this.parts_[i]);Lp(this)}}function G1(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=No(e),Lp(t)}function j1(t){const e=t.parts_.pop();t.byteLength_-=No(e),t.parts_.length>0&&(t.byteLength_-=1)}function Lp(t){if(t.byteLength_>_h)throw new Error(t.errorPrefix_+"has a key path longer than "+_h+" bytes ("+t.byteLength_+").");if(t.parts_.length>mh)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+mh+") or object contains a cycle "+mn(t))}function mn(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}class gc extends kp{static getInstance(){return new gc}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(e){return F(e==="visible","Unknown event type: "+e),[this.visible_]}}const Mi=1e3,K1=300*1e3,yh=30*1e3,Y1=1.3,X1=3e4,Q1="server_kill",vh=3;class kt extends Mp{constructor(e,n,i,r,s,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=i,this.onConnectStatus_=r,this.onServerInfoUpdate_=s,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=kt.nextPersistentConnectionId_++,this.log_=Nr("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Mi,this.maxReconnectDelay_=K1,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");gc.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Rs.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,i){const r=++this.requestNumber_,s={r,a:e,b:n};this.log_(pe(s)),F(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),i&&(this.requestCBHash_[r]=i)}get(e){this.initConnection_();const n=new xo,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?n.resolve(a):n.reject(a)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const s=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(s),n.promise}listen(e,n,i,r){this.initConnection_();const s=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+s),this.listens.has(o)||this.listens.set(o,new Map),F(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),F(!this.listens.get(o).has(s),"listen() called twice for same path/queryId.");const a={onComplete:r,hashFn:n,query:e,tag:i};this.listens.get(o).set(s,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,i=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(i)})}sendListen_(e){const n=e.query,i=n._path.toString(),r=n._queryIdentifier;this.log_("Listen on "+i+" for "+r);const s={p:i},o="q";e.tag&&(s.q=n._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest(o,s,a=>{const l=a.d,c=a.s;kt.warnOnListenWarnings_(l,n),(this.listens.get(i)&&this.listens.get(i).get(r))===e&&(this.log_("listen response",a),c!=="ok"&&this.removeListen_(i,r),e.onComplete&&e.onComplete(c,l))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&Ht(e,"w")){const i=ii(e,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const r='".indexOn": "'+n._queryParams.getIndex().toString()+'"',s=n._path.toString();Fe(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${s} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||B0(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=yh)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=U0(e)?"auth":"gauth",i={cred:e};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(n,i,r=>{const s=r.s,o=r.d||"error";this.authToken_===e&&(s==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(s,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,i=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,i)})}unlisten(e,n){const i=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+r),F(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,r)&&this.connected_&&this.sendUnlisten_(i,r,e._queryObject,n)}sendUnlisten_(e,n,i,r){this.log_("Unlisten on "+e+" for "+n);const s={p:e},o="n";r&&(s.q=i,s.t=r),this.sendRequest(o,s)}onDisconnectPut(e,n,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:i})}onDisconnectMerge(e,n,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:i})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,i,r){const s={p:n,d:i};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,o=>{r&&setTimeout(()=>{r(o.s,o.d)},Math.floor(0))})}put(e,n,i,r){this.putInternal("p",e,n,i,r)}merge(e,n,i,r){this.putInternal("m",e,n,i,r)}putInternal(e,n,i,r,s){this.initConnection_();const o={p:n,d:i};s!==void 0&&(o.h=s),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,i=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,i,s=>{this.log_(n+" response",s),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(s.s,s.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,i=>{if(i.s!=="ok"){const s=i.d;this.log_("reportStats","Error sending stats: "+s)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+pe(e));const n=e.r,i=this.requestCBHash_[n];i&&(delete this.requestCBHash_[n],i(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):za("Unrecognized action received from server: "+pe(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){F(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Mi,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Mi,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>X1&&(this.reconnectDelay_=Mi),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Y1)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+kt.nextConnectionId_++,s=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,i())},c=function(u){F(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(u)};this.realtime_={close:l,sendRequest:c};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[u,f]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?be("getToken() completed but was canceled"):(be("getToken() completed. Creating connection."),this.authToken_=u&&u.accessToken,this.appCheckToken_=f&&f.token,a=new W1(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,i,d=>{Fe(d+" ("+this.repoInfo_.toString()+")"),this.interrupt(Q1)},s))}catch(u){this.log_("Failed to get token: "+u),o||(this.repoInfo_.nodeAdmin&&Fe(u),l())}}}interrupt(e){be("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){be("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Ra(this.interruptReasons_)&&(this.reconnectDelay_=Mi,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let i;n?i=n.map(s=>hc(s)).join("$"):i="default";const r=this.removeListen_(e,i);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,n){const i=new se(e).toString();let r;if(this.listens.has(i)){const s=this.listens.get(i);r=s.get(n),s.delete(n),s.size===0&&this.listens.delete(i)}else r=void 0;return r}onAuthRevoked_(e,n){be("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=vh&&(this.reconnectDelay_=yh,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){be("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=vh&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+lp.replace(/\./g,"-")]=1,Zl()?e["framework.cordova"]=1:Id()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Rs.getInstance().currentlyOnline();return Ra(this.interruptReasons_)&&e}}kt.nextPersistentConnectionId_=0;kt.nextConnectionId_=0;class K{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new K(e,n)}}class Oo{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const i=new K(si,e),r=new K(si,n);return this.compare(i,r)!==0}minPost(){return K.MIN}}let zr;class $p extends Oo{static get __EMPTY_NODE(){return zr}static set __EMPTY_NODE(e){zr=e}compare(e,n){return Ii(e.name,n.name)}isDefinedOn(e){throw _i("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return K.MIN}maxPost(){return new K(kn,zr)}makePost(e,n){return F(typeof e=="string","KeyIndex indexValue must always be a string."),new K(e,zr)}toString(){return".key"}}const Zn=new $p;class Wr{constructor(e,n,i,r,s=null){this.isReverse_=r,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?i(e.key,n):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class we{constructor(e,n,i,r,s){this.key=e,this.value=n,this.color=i??we.RED,this.left=r??Le.EMPTY_NODE,this.right=s??Le.EMPTY_NODE}copy(e,n,i,r,s){return new we(e??this.key,n??this.value,i??this.color,r??this.left,s??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,i){let r=this;const s=i(e,r.key);return s<0?r=r.copy(null,null,null,r.left.insert(e,n,i),null):s===0?r=r.copy(null,n,null,null,null):r=r.copy(null,null,null,null,r.right.insert(e,n,i)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return Le.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let i,r;if(i=this,n(e,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),n(e,i.key)===0){if(i.right.isEmpty())return Le.EMPTY_NODE;r=i.right.min_(),i=i.copy(r.key,r.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,we.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,we.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}we.RED=!0;we.BLACK=!1;class J1{copy(e,n,i,r,s){return this}insert(e,n,i){return new we(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Le{constructor(e,n=Le.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new Le(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,we.BLACK,null,null))}remove(e){return new Le(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,we.BLACK,null,null))}get(e){let n,i=this.root_;for(;!i.isEmpty();){if(n=this.comparator_(e,i.key),n===0)return i.value;n<0?i=i.left:n>0&&(i=i.right)}return null}getPredecessorKey(e){let n,i=this.root_,r=null;for(;!i.isEmpty();)if(n=this.comparator_(e,i.key),n===0){if(i.left.isEmpty())return r?r.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else n<0?i=i.left:n>0&&(r=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Wr(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new Wr(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new Wr(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new Wr(this.root_,null,this.comparator_,!0,e)}}Le.EMPTY_NODE=new J1;function Z1(t,e){return Ii(t.name,e.name)}function mc(t,e){return Ii(t,e)}let Va;function eE(t){Va=t}const Fp=function(t){return typeof t=="number"?"number:"+dp(t):"string:"+t},Up=function(t){if(t.isLeafNode()){const e=t.val();F(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Ht(e,".sv"),"Priority must be a string or number.")}else F(t===Va||t.isEmpty(),"priority of unexpected type.");F(t===Va||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let wh;class ve{static set __childrenNodeConstructor(e){wh=e}static get __childrenNodeConstructor(){return wh}constructor(e,n=ve.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,F(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Up(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new ve(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:ve.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return X(e)?this:Q(e)===".priority"?this.priorityNode_:ve.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:ve.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const i=Q(e);return i===null?n:n.isEmpty()&&i!==".priority"?this:(F(i!==".priority"||an(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,ve.__childrenNodeConstructor.EMPTY_NODE.updateChild(oe(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Fp(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=dp(this.value_):e+=this.value_,this.lazyHash_=up(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===ve.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof ve.__childrenNodeConstructor?-1:(F(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,i=typeof this.value_,r=ve.VALUE_TYPE_ORDER.indexOf(n),s=ve.VALUE_TYPE_ORDER.indexOf(i);return F(r>=0,"Unknown leaf type: "+n),F(s>=0,"Unknown leaf type: "+i),r===s?i==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}ve.VALUE_TYPE_ORDER=["object","boolean","number","string"];let Bp,Hp;function tE(t){Bp=t}function nE(t){Hp=t}class iE extends Oo{compare(e,n){const i=e.node.getPriority(),r=n.node.getPriority(),s=i.compareTo(r);return s===0?Ii(e.name,n.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return K.MIN}maxPost(){return new K(kn,new ve("[PRIORITY-POST]",Hp))}makePost(e,n){const i=Bp(e);return new K(n,new ve("[PRIORITY-POST]",i))}toString(){return".priority"}}const fe=new iE;const rE=Math.log(2);class sE{constructor(e){const n=s=>parseInt(Math.log(s)/rE,10),i=s=>parseInt(Array(s+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const r=i(this.count);this.bits_=e+1&r}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Os=function(t,e,n,i){t.sort(e);const r=function(l,c){const h=c-l;let u,f;if(h===0)return null;if(h===1)return u=t[l],f=n?n(u):u,new we(f,u.node,we.BLACK,null,null);{const d=parseInt(h/2,10)+l,w=r(l,d),b=r(d+1,c);return u=t[d],f=n?n(u):u,new we(f,u.node,we.BLACK,w,b)}},s=function(l){let c=null,h=null,u=t.length;const f=function(w,b){const N=u-w,x=u;u-=w;const A=r(N+1,x),P=t[N],k=n?n(P):P;d(new we(k,P.node,b,null,A))},d=function(w){c?(c.left=w,c=w):(h=w,c=w)};for(let w=0;w<l.count;++w){const b=l.nextBitIsOne(),N=Math.pow(2,l.count-(w+1));b?f(N,we.BLACK):(f(N,we.BLACK),f(N,we.RED))}return h},o=new sE(t.length),a=s(o);return new Le(i||e,a)};let pa;const Fn={};class Nt{static get Default(){return F(Fn&&fe,"ChildrenNode.ts has not been loaded"),pa=pa||new Nt({".priority":Fn},{".priority":fe}),pa}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=ii(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof Le?n:null}hasIndex(e){return Ht(this.indexSet_,e.toString())}addIndex(e,n){F(e!==Zn,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let r=!1;const s=n.getIterator(K.Wrap);let o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();let a;r?a=Os(i,e.getCompare()):a=Fn;const l=e.toString(),c={...this.indexSet_};c[l]=e;const h={...this.indexes_};return h[l]=a,new Nt(h,c)}addToIndexes(e,n){const i=bs(this.indexes_,(r,s)=>{const o=ii(this.indexSet_,s);if(F(o,"Missing index implementation for "+s),r===Fn)if(o.isDefinedOn(e.node)){const a=[],l=n.getIterator(K.Wrap);let c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),Os(a,o.getCompare())}else return Fn;else{const a=n.get(e.name);let l=r;return a&&(l=l.remove(new K(e.name,a))),l.insert(e,e.node)}});return new Nt(i,this.indexSet_)}removeFromIndexes(e,n){const i=bs(this.indexes_,r=>{if(r===Fn)return r;{const s=n.get(e.name);return s?r.remove(new K(e.name,s)):r}});return new Nt(i,this.indexSet_)}}let ki;class H{static get EMPTY_NODE(){return ki||(ki=new H(new Le(mc),null,Nt.Default))}constructor(e,n,i){this.children_=e,this.priorityNode_=n,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&Up(this.priorityNode_),this.children_.isEmpty()&&F(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ki}updatePriority(e){return this.children_.isEmpty()?this:new H(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?ki:n}}getChild(e){const n=Q(e);return n===null?this:this.getImmediateChild(n).getChild(oe(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(F(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const i=new K(e,n);let r,s;n.isEmpty()?(r=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(i,this.children_)):(r=this.children_.insert(e,n),s=this.indexMap_.addToIndexes(i,this.children_));const o=r.isEmpty()?ki:this.priorityNode_;return new H(r,o,s)}}updateChild(e,n){const i=Q(e);if(i===null)return n;{F(Q(e)!==".priority"||an(e)===1,".priority must be the last token in a path");const r=this.getImmediateChild(i).updateChild(oe(e),n);return this.updateImmediateChild(i,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let i=0,r=0,s=!0;if(this.forEachChild(fe,(o,a)=>{n[o]=a.val(e),i++,s&&H.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):s=!1}),!e&&s&&r<2*i){const o=[];for(const a in n)o[a]=n[a];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Fp(this.getPriority().val())+":"),this.forEachChild(fe,(n,i)=>{const r=i.hash();r!==""&&(e+=":"+n+":"+r)}),this.lazyHash_=e===""?"":up(e)}return this.lazyHash_}getPredecessorChildName(e,n,i){const r=this.resolveIndex_(i);if(r){const s=r.getPredecessorKey(new K(e,n));return s?s.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const i=n.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new K(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const i=n.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new K(n,this.children_.get(n)):null}forEachChild(e,n){const i=this.resolveIndex_(e);return i?i.inorderTraversal(r=>n(r.name,r.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const i=this.resolveIndex_(n);if(i)return i.getIteratorFrom(e,r=>r);{const r=this.children_.getIteratorFrom(e.name,K.Wrap);let s=r.peek();for(;s!=null&&n.compare(s,e)<0;)r.getNext(),s=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const i=this.resolveIndex_(n);if(i)return i.getReverseIteratorFrom(e,r=>r);{const r=this.children_.getReverseIteratorFrom(e.name,K.Wrap);let s=r.peek();for(;s!=null&&n.compare(s,e)>0;)r.getNext(),s=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Mr?-1:0}withIndex(e){if(e===Zn||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new H(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===Zn||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const i=this.getIterator(fe),r=n.getIterator(fe);let s=i.getNext(),o=r.getNext();for(;s&&o;){if(s.name!==o.name||!s.node.equals(o.node))return!1;s=i.getNext(),o=r.getNext()}return s===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Zn?null:this.indexMap_.get(e.toString())}}H.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class oE extends H{constructor(){super(new Le(mc),H.EMPTY_NODE,Nt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return H.EMPTY_NODE}isEmpty(){return!1}}const Mr=new oE;Object.defineProperties(K,{MIN:{value:new K(si,H.EMPTY_NODE)},MAX:{value:new K(kn,Mr)}});$p.__EMPTY_NODE=H.EMPTY_NODE;ve.__childrenNodeConstructor=H;eE(Mr);nE(Mr);const aE=!0;function Ee(t,e=null){if(t===null)return H.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),F(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new ve(n,Ee(e))}if(!(t instanceof Array)&&aE){const n=[];let i=!1;if(Ue(t,(o,a)=>{if(o.substring(0,1)!=="."){const l=Ee(a);l.isEmpty()||(i=i||!l.getPriority().isEmpty(),n.push(new K(o,l)))}}),n.length===0)return H.EMPTY_NODE;const s=Os(n,Z1,o=>o.name,mc);if(i){const o=Os(n,fe.getCompare());return new H(s,Ee(e),new Nt({".priority":o},{".priority":fe}))}else return new H(s,Ee(e),Nt.Default)}else{let n=H.EMPTY_NODE;return Ue(t,(i,r)=>{if(Ht(t,i)&&i.substring(0,1)!=="."){const s=Ee(r);(s.isLeafNode()||!s.isEmpty())&&(n=n.updateImmediateChild(i,s))}}),n.updatePriority(Ee(e))}}tE(Ee);class lE extends Oo{constructor(e){super(),this.indexPath_=e,F(!X(e)&&Q(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const i=this.extractChild(e.node),r=this.extractChild(n.node),s=i.compareTo(r);return s===0?Ii(e.name,n.name):s}makePost(e,n){const i=Ee(e),r=H.EMPTY_NODE.updateChild(this.indexPath_,i);return new K(n,r)}maxPost(){const e=H.EMPTY_NODE.updateChild(this.indexPath_,Mr);return new K(kn,e)}toString(){return Rp(this.indexPath_,0).join("/")}}class cE extends Oo{compare(e,n){const i=e.node.compareTo(n.node);return i===0?Ii(e.name,n.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return K.MIN}maxPost(){return K.MAX}makePost(e,n){const i=Ee(e);return new K(n,i)}toString(){return".value"}}const uE=new cE;function zp(t){return{type:"value",snapshotNode:t}}function oi(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function ar(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function lr(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function hE(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}class _c{constructor(e){this.index_=e}updateChild(e,n,i,r,s,o){F(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(n);return a.getChild(r).equals(i.getChild(r))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(n)?o.trackChildChange(ar(n,a)):F(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(oi(n,i)):o.trackChildChange(lr(n,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(n,i).withIndex(this.index_)}updateFullNode(e,n,i){return i!=null&&(e.isLeafNode()||e.forEachChild(fe,(r,s)=>{n.hasChild(r)||i.trackChildChange(ar(r,s))}),n.isLeafNode()||n.forEachChild(fe,(r,s)=>{if(e.hasChild(r)){const o=e.getImmediateChild(r);o.equals(s)||i.trackChildChange(lr(r,s,o))}else i.trackChildChange(oi(r,s))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?H.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class cr{constructor(e){this.indexedFilter_=new _c(e.getIndex()),this.index_=e.getIndex(),this.startPost_=cr.getStartPost_(e),this.endPost_=cr.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&i}updateChild(e,n,i,r,s,o){return this.matches(new K(n,i))||(i=H.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,i,r,s,o)}updateFullNode(e,n,i){n.isLeafNode()&&(n=H.EMPTY_NODE);let r=n.withIndex(this.index_);r=r.updatePriority(H.EMPTY_NODE);const s=this;return n.forEachChild(fe,(o,a)=>{s.matches(new K(o,a))||(r=r.updateImmediateChild(o,H.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,i)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}class fE{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const i=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=n=>{const i=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new cr(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,i,r,s,o){return this.rangedFilter_.matches(new K(n,i))||(i=H.EMPTY_NODE),e.getImmediateChild(n).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,i,r,s,o):this.fullLimitUpdateChild_(e,n,i,s,o)}updateFullNode(e,n,i){let r;if(n.isLeafNode()||n.isEmpty())r=H.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){r=H.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){const a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=n.withIndex(this.index_),r=r.updatePriority(H.EMPTY_NODE);let s;this.reverse_?s=r.getReverseIterator(this.index_):s=r.getIterator(this.index_);let o=0;for(;s.hasNext();){const a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,H.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,i)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,i,r,s){let o;if(this.reverse_){const u=this.index_.getCompare();o=(f,d)=>u(d,f)}else o=this.index_.getCompare();const a=e;F(a.numChildren()===this.limit_,"");const l=new K(n,i),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(n)){const u=a.getImmediateChild(n);let f=r.getChildAfterChild(this.index_,c,this.reverse_);for(;f!=null&&(f.name===n||a.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);const d=f==null?1:o(f,l);if(h&&!i.isEmpty()&&d>=0)return s?.trackChildChange(lr(n,i,u)),a.updateImmediateChild(n,i);{s?.trackChildChange(ar(n,u));const b=a.updateImmediateChild(n,H.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(s?.trackChildChange(oi(f.name,f.node)),b.updateImmediateChild(f.name,f.node)):b}}else return i.isEmpty()?e:h&&o(c,l)>=0?(s!=null&&(s.trackChildChange(ar(c.name,c.node)),s.trackChildChange(oi(n,i))),a.updateImmediateChild(n,i).updateImmediateChild(c.name,H.EMPTY_NODE)):e}}class yc{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=fe}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return F(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return F(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:si}hasEnd(){return this.endSet_}getIndexEndValue(){return F(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return F(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:kn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return F(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===fe}copy(){const e=new yc;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function dE(t){return t.loadsAllData()?new _c(t.getIndex()):t.hasLimit()?new fE(t):new cr(t)}function Eh(t){const e={};if(t.isDefault())return e;let n;if(t.index_===fe?n="$priority":t.index_===uE?n="$value":t.index_===Zn?n="$key":(F(t.index_ instanceof lE,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=pe(n),t.startSet_){const i=t.startAfterSet_?"startAfter":"startAt";e[i]=pe(t.indexStartValue_),t.startNameSet_&&(e[i]+=","+pe(t.indexStartName_))}if(t.endSet_){const i=t.endBeforeSet_?"endBefore":"endAt";e[i]=pe(t.indexEndValue_),t.endNameSet_&&(e[i]+=","+pe(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function Ih(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==fe&&(e.i=t.index_.toString()),e}class Ds extends Mp{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(F(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,i,r){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=i,this.appCheckTokenProvider_=r,this.log_=Nr("p:rest:"),this.listens_={}}listen(e,n,i,r){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const o=Ds.getListenId_(e,i),a={};this.listens_[o]=a;const l=Eh(e._queryParams);this.restRequest_(s+".json",l,(c,h)=>{let u=h;if(c===404&&(u=null,c=null),c===null&&this.onDataUpdate_(s,u,!1,i),ii(this.listens_,o)===a){let f;c?c===401?f="permission_denied":f="rest_error:"+c:f="ok",r(f,null)}})}unlisten(e,n){const i=Ds.getListenId_(e,n);delete this.listens_[i]}get(e){const n=Eh(e._queryParams),i=e._path.toString(),r=new xo;return this.restRequest_(i+".json",n,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(i,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,n={},i){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,s])=>{r&&r.accessToken&&(n.auth=r.accessToken),s&&s.token&&(n.ac=s.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+vi(n);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=ir(a.responseText)}catch{Fe("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,l)}else a.status!==401&&a.status!==404&&Fe("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}}class pE{constructor(){this.rootNode_=H.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}function Ls(){return{value:null,children:new Map}}function Wp(t,e,n){if(X(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const i=Q(e);t.children.has(i)||t.children.set(i,Ls());const r=t.children.get(i);e=oe(e),Wp(r,e,n)}}function qa(t,e,n){t.value!==null?n(e,t.value):gE(t,(i,r)=>{const s=new se(e.toString()+"/"+i);qa(r,s,n)})}function gE(t,e){t.children.forEach((n,i)=>{e(i,n)})}class mE{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n={...e};return this.last_&&Ue(this.last_,(i,r)=>{n[i]=n[i]-r}),this.last_=e,n}}const Sh=10*1e3,_E=30*1e3,yE=300*1e3;class vE{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new mE(e);const i=Sh+(_E-Sh)*Math.random();Yi(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),n={};let i=!1;Ue(e,(r,s)=>{s>0&&Ht(this.statsToReport_,r)&&(n[r]=s,i=!0)}),i&&this.server_.reportStats(n),Yi(this.reportStats_.bind(this),Math.floor(Math.random()*2*yE))}}var ot;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(ot||(ot={}));function Vp(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function vc(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function wc(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}class $s{constructor(e,n,i){this.path=e,this.affectedTree=n,this.revert=i,this.type=ot.ACK_USER_WRITE,this.source=Vp()}operationForChild(e){if(X(this.path)){if(this.affectedTree.value!=null)return F(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new se(e));return new $s(te(),n,this.revert)}}else return F(Q(this.path)===e,"operationForChild called for unrelated child."),new $s(oe(this.path),this.affectedTree,this.revert)}}class ur{constructor(e,n){this.source=e,this.path=n,this.type=ot.LISTEN_COMPLETE}operationForChild(e){return X(this.path)?new ur(this.source,te()):new ur(this.source,oe(this.path))}}class Pn{constructor(e,n,i){this.source=e,this.path=n,this.snap=i,this.type=ot.OVERWRITE}operationForChild(e){return X(this.path)?new Pn(this.source,te(),this.snap.getImmediateChild(e)):new Pn(this.source,oe(this.path),this.snap)}}class hr{constructor(e,n,i){this.source=e,this.path=n,this.children=i,this.type=ot.MERGE}operationForChild(e){if(X(this.path)){const n=this.children.subtree(new se(e));return n.isEmpty()?null:n.value?new Pn(this.source,te(),n.value):new hr(this.source,te(),n)}else return F(Q(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new hr(this.source,oe(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class ln{constructor(e,n,i){this.node_=e,this.fullyInitialized_=n,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(X(e))return this.isFullyInitialized()&&!this.filtered_;const n=Q(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class wE{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function EE(t,e,n,i){const r=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(hE(o.childName,o.snapshotNode))}),Pi(t,r,"child_removed",e,i,n),Pi(t,r,"child_added",e,i,n),Pi(t,r,"child_moved",s,i,n),Pi(t,r,"child_changed",e,i,n),Pi(t,r,"value",e,i,n),r}function Pi(t,e,n,i,r,s){const o=i.filter(a=>a.type===n);o.sort((a,l)=>SE(t,a,l)),o.forEach(a=>{const l=IE(t,a,s);r.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,t.query_))})})}function IE(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function SE(t,e,n){if(e.childName==null||n.childName==null)throw _i("Should only compare child_ events.");const i=new K(e.childName,e.snapshotNode),r=new K(n.childName,n.snapshotNode);return t.index_.compare(i,r)}function Do(t,e){return{eventCache:t,serverCache:e}}function Xi(t,e,n,i){return Do(new ln(e,n,i),t.serverCache)}function qp(t,e,n,i){return Do(t.eventCache,new ln(e,n,i))}function Fs(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Rn(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}let ga;const bE=()=>(ga||(ga=new Le(c1)),ga);class le{static fromObject(e){let n=new le(null);return Ue(e,(i,r)=>{n=n.set(new se(i),r)}),n}constructor(e,n=bE()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:te(),value:this.value};if(X(e))return null;{const i=Q(e),r=this.children.get(i);if(r!==null){const s=r.findRootMostMatchingPathAndValue(oe(e),n);return s!=null?{path:ge(new se(i),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(X(e))return this;{const n=Q(e),i=this.children.get(n);return i!==null?i.subtree(oe(e)):new le(null)}}set(e,n){if(X(e))return new le(n,this.children);{const i=Q(e),s=(this.children.get(i)||new le(null)).set(oe(e),n),o=this.children.insert(i,s);return new le(this.value,o)}}remove(e){if(X(e))return this.children.isEmpty()?new le(null):new le(null,this.children);{const n=Q(e),i=this.children.get(n);if(i){const r=i.remove(oe(e));let s;return r.isEmpty()?s=this.children.remove(n):s=this.children.insert(n,r),this.value===null&&s.isEmpty()?new le(null):new le(this.value,s)}else return this}}get(e){if(X(e))return this.value;{const n=Q(e),i=this.children.get(n);return i?i.get(oe(e)):null}}setTree(e,n){if(X(e))return n;{const i=Q(e),s=(this.children.get(i)||new le(null)).setTree(oe(e),n);let o;return s.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,s),new le(this.value,o)}}fold(e){return this.fold_(te(),e)}fold_(e,n){const i={};return this.children.inorderTraversal((r,s)=>{i[r]=s.fold_(ge(e,r),n)}),n(e,this.value,i)}findOnPath(e,n){return this.findOnPath_(e,te(),n)}findOnPath_(e,n,i){const r=this.value?i(n,this.value):!1;if(r)return r;if(X(e))return null;{const s=Q(e),o=this.children.get(s);return o?o.findOnPath_(oe(e),ge(n,s),i):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,te(),n)}foreachOnPath_(e,n,i){if(X(e))return this;{this.value&&i(n,this.value);const r=Q(e),s=this.children.get(r);return s?s.foreachOnPath_(oe(e),ge(n,r),i):new le(null)}}foreach(e){this.foreach_(te(),e)}foreach_(e,n){this.children.inorderTraversal((i,r)=>{r.foreach_(ge(e,i),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,i)=>{i.value&&e(n,i.value)})}}class lt{constructor(e){this.writeTree_=e}static empty(){return new lt(new le(null))}}function Qi(t,e,n){if(X(e))return new lt(new le(n));{const i=t.writeTree_.findRootMostValueAndPath(e);if(i!=null){const r=i.path;let s=i.value;const o=Pe(r,e);return s=s.updateChild(o,n),new lt(t.writeTree_.set(r,s))}else{const r=new le(n),s=t.writeTree_.setTree(e,r);return new lt(s)}}}function bh(t,e,n){let i=t;return Ue(n,(r,s)=>{i=Qi(i,ge(e,r),s)}),i}function Ch(t,e){if(X(e))return lt.empty();{const n=t.writeTree_.setTree(e,new le(null));return new lt(n)}}function Ga(t,e){return Ln(t,e)!=null}function Ln(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(Pe(n.path,e)):null}function Th(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(fe,(i,r)=>{e.push(new K(i,r))}):t.writeTree_.children.inorderTraversal((i,r)=>{r.value!=null&&e.push(new K(i,r.value))}),e}function rn(t,e){if(X(e))return t;{const n=Ln(t,e);return n!=null?new lt(new le(n)):new lt(t.writeTree_.subtree(e))}}function ja(t){return t.writeTree_.isEmpty()}function ai(t,e){return Gp(te(),t.writeTree_,e)}function Gp(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let i=null;return e.children.inorderTraversal((r,s)=>{r===".priority"?(F(s.value!==null,"Priority writes must always be leaf nodes"),i=s.value):n=Gp(ge(t,r),s,n)}),!n.getChild(t).isEmpty()&&i!==null&&(n=n.updateChild(ge(t,".priority"),i)),n}}function Lo(t,e){return Xp(e,t)}function CE(t,e,n,i,r){F(i>t.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),t.allWrites.push({path:e,snap:n,writeId:i,visible:r}),r&&(t.visibleWrites=Qi(t.visibleWrites,e,n)),t.lastWriteId=i}function TE(t,e){for(let n=0;n<t.allWrites.length;n++){const i=t.allWrites[n];if(i.writeId===e)return i}return null}function AE(t,e){const n=t.allWrites.findIndex(a=>a.writeId===e);F(n>=0,"removeWrite called with nonexistent writeId.");const i=t.allWrites[n];t.allWrites.splice(n,1);let r=i.visible,s=!1,o=t.allWrites.length-1;for(;r&&o>=0;){const a=t.allWrites[o];a.visible&&(o>=n&&xE(a,i.path)?r=!1:st(i.path,a.path)&&(s=!0)),o--}if(r){if(s)return NE(t),!0;if(i.snap)t.visibleWrites=Ch(t.visibleWrites,i.path);else{const a=i.children;Ue(a,l=>{t.visibleWrites=Ch(t.visibleWrites,ge(i.path,l))})}return!0}else return!1}function xE(t,e){if(t.snap)return st(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&st(ge(t.path,n),e))return!0;return!1}function NE(t){t.visibleWrites=jp(t.allWrites,ME,te()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function ME(t){return t.visible}function jp(t,e,n){let i=lt.empty();for(let r=0;r<t.length;++r){const s=t[r];if(e(s)){const o=s.path;let a;if(s.snap)st(n,o)?(a=Pe(n,o),i=Qi(i,a,s.snap)):st(o,n)&&(a=Pe(o,n),i=Qi(i,te(),s.snap.getChild(a)));else if(s.children){if(st(n,o))a=Pe(n,o),i=bh(i,a,s.children);else if(st(o,n))if(a=Pe(o,n),X(a))i=bh(i,te(),s.children);else{const l=ii(s.children,Q(a));if(l){const c=l.getChild(oe(a));i=Qi(i,te(),c)}}}else throw _i("WriteRecord should have .snap or .children")}}return i}function Kp(t,e,n,i,r){if(!i&&!r){const s=Ln(t.visibleWrites,e);if(s!=null)return s;{const o=rn(t.visibleWrites,e);if(ja(o))return n;if(n==null&&!Ga(o,te()))return null;{const a=n||H.EMPTY_NODE;return ai(o,a)}}}else{const s=rn(t.visibleWrites,e);if(!r&&ja(s))return n;if(!r&&n==null&&!Ga(s,te()))return null;{const o=function(c){return(c.visible||r)&&(!i||!~i.indexOf(c.writeId))&&(st(c.path,e)||st(e,c.path))},a=jp(t.allWrites,o,e),l=n||H.EMPTY_NODE;return ai(a,l)}}}function kE(t,e,n){let i=H.EMPTY_NODE;const r=Ln(t.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(fe,(s,o)=>{i=i.updateImmediateChild(s,o)}),i;if(n){const s=rn(t.visibleWrites,e);return n.forEachChild(fe,(o,a)=>{const l=ai(rn(s,new se(o)),a);i=i.updateImmediateChild(o,l)}),Th(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{const s=rn(t.visibleWrites,e);return Th(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function PE(t,e,n,i,r){F(i||r,"Either existingEventSnap or existingServerSnap must exist");const s=ge(e,n);if(Ga(t.visibleWrites,s))return null;{const o=rn(t.visibleWrites,s);return ja(o)?r.getChild(n):ai(o,r.getChild(n))}}function RE(t,e,n,i){const r=ge(e,n),s=Ln(t.visibleWrites,r);if(s!=null)return s;if(i.isCompleteForChild(n)){const o=rn(t.visibleWrites,r);return ai(o,i.getNode().getImmediateChild(n))}else return null}function OE(t,e){return Ln(t.visibleWrites,e)}function DE(t,e,n,i,r,s,o){let a;const l=rn(t.visibleWrites,e),c=Ln(l,te());if(c!=null)a=c;else if(n!=null)a=ai(l,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],u=o.getCompare(),f=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let d=f.getNext();for(;d&&h.length<r;)u(d,i)!==0&&h.push(d),d=f.getNext();return h}else return[]}function LE(){return{visibleWrites:lt.empty(),allWrites:[],lastWriteId:-1}}function Us(t,e,n,i){return Kp(t.writeTree,t.treePath,e,n,i)}function Ec(t,e){return kE(t.writeTree,t.treePath,e)}function Ah(t,e,n,i){return PE(t.writeTree,t.treePath,e,n,i)}function Bs(t,e){return OE(t.writeTree,ge(t.treePath,e))}function $E(t,e,n,i,r,s){return DE(t.writeTree,t.treePath,e,n,i,r,s)}function Ic(t,e,n){return RE(t.writeTree,t.treePath,e,n)}function Yp(t,e){return Xp(ge(t.treePath,e),t.writeTree)}function Xp(t,e){return{treePath:t,writeTree:e}}class FE{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,i=e.childName;F(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),F(i!==".priority","Only non-priority child changes can be tracked.");const r=this.changeMap.get(i);if(r){const s=r.type;if(n==="child_added"&&s==="child_removed")this.changeMap.set(i,lr(i,e.snapshotNode,r.snapshotNode));else if(n==="child_removed"&&s==="child_added")this.changeMap.delete(i);else if(n==="child_removed"&&s==="child_changed")this.changeMap.set(i,ar(i,r.oldSnap));else if(n==="child_changed"&&s==="child_added")this.changeMap.set(i,oi(i,e.snapshotNode));else if(n==="child_changed"&&s==="child_changed")this.changeMap.set(i,lr(i,e.snapshotNode,r.oldSnap));else throw _i("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}class UE{getCompleteChild(e){return null}getChildAfterChild(e,n,i){return null}}const Qp=new UE;class Sc{constructor(e,n,i=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=i}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const i=this.optCompleteServerCache_!=null?new ln(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Ic(this.writes_,e,i)}}getChildAfterChild(e,n,i){const r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Rn(this.viewCache_),s=$E(this.writes_,r,n,1,i,e);return s.length===0?null:s[0]}}function BE(t){return{filter:t}}function HE(t,e){F(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),F(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function zE(t,e,n,i,r){const s=new FE;let o,a;if(n.type===ot.OVERWRITE){const c=n;c.source.fromUser?o=Ka(t,e,c.path,c.snap,i,r,s):(F(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!X(c.path),o=Hs(t,e,c.path,c.snap,i,r,a,s))}else if(n.type===ot.MERGE){const c=n;c.source.fromUser?o=VE(t,e,c.path,c.children,i,r,s):(F(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=Ya(t,e,c.path,c.children,i,r,a,s))}else if(n.type===ot.ACK_USER_WRITE){const c=n;c.revert?o=jE(t,e,c.path,i,r,s):o=qE(t,e,c.path,c.affectedTree,i,r,s)}else if(n.type===ot.LISTEN_COMPLETE)o=GE(t,e,n.path,i,s);else throw _i("Unknown operation type: "+n.type);const l=s.getChanges();return WE(e,o,l),{viewCache:o,changes:l}}function WE(t,e,n){const i=e.eventCache;if(i.isFullyInitialized()){const r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=Fs(t);(n.length>0||!t.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&n.push(zp(Fs(e)))}}function Jp(t,e,n,i,r,s){const o=e.eventCache;if(Bs(i,n)!=null)return e;{let a,l;if(X(n))if(F(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const c=Rn(e),h=c instanceof H?c:H.EMPTY_NODE,u=Ec(i,h);a=t.filter.updateFullNode(e.eventCache.getNode(),u,s)}else{const c=Us(i,Rn(e));a=t.filter.updateFullNode(e.eventCache.getNode(),c,s)}else{const c=Q(n);if(c===".priority"){F(an(n)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const u=Ah(i,n,h,l);u!=null?a=t.filter.updatePriority(h,u):a=o.getNode()}else{const h=oe(n);let u;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();const f=Ah(i,n,o.getNode(),l);f!=null?u=o.getNode().getImmediateChild(c).updateChild(h,f):u=o.getNode().getImmediateChild(c)}else u=Ic(i,c,e.serverCache);u!=null?a=t.filter.updateChild(o.getNode(),c,u,h,r,s):a=o.getNode()}}return Xi(e,a,o.isFullyInitialized()||X(n),t.filter.filtersNodes())}}function Hs(t,e,n,i,r,s,o,a){const l=e.serverCache;let c;const h=o?t.filter:t.filter.getIndexedFilter();if(X(n))c=h.updateFullNode(l.getNode(),i,null);else if(h.filtersNodes()&&!l.isFiltered()){const d=l.getNode().updateChild(n,i);c=h.updateFullNode(l.getNode(),d,null)}else{const d=Q(n);if(!l.isCompleteForPath(n)&&an(n)>1)return e;const w=oe(n),N=l.getNode().getImmediateChild(d).updateChild(w,i);d===".priority"?c=h.updatePriority(l.getNode(),N):c=h.updateChild(l.getNode(),d,N,w,Qp,null)}const u=qp(e,c,l.isFullyInitialized()||X(n),h.filtersNodes()),f=new Sc(r,u,s);return Jp(t,u,n,r,f,a)}function Ka(t,e,n,i,r,s,o){const a=e.eventCache;let l,c;const h=new Sc(r,e,s);if(X(n))c=t.filter.updateFullNode(e.eventCache.getNode(),i,o),l=Xi(e,c,!0,t.filter.filtersNodes());else{const u=Q(n);if(u===".priority")c=t.filter.updatePriority(e.eventCache.getNode(),i),l=Xi(e,c,a.isFullyInitialized(),a.isFiltered());else{const f=oe(n),d=a.getNode().getImmediateChild(u);let w;if(X(f))w=i;else{const b=h.getCompleteChild(u);b!=null?Pp(f)===".priority"&&b.getChild(Op(f)).isEmpty()?w=b:w=b.updateChild(f,i):w=H.EMPTY_NODE}if(d.equals(w))l=e;else{const b=t.filter.updateChild(a.getNode(),u,w,f,h,o);l=Xi(e,b,a.isFullyInitialized(),t.filter.filtersNodes())}}}return l}function xh(t,e){return t.eventCache.isCompleteForChild(e)}function VE(t,e,n,i,r,s,o){let a=e;return i.foreach((l,c)=>{const h=ge(n,l);xh(e,Q(h))&&(a=Ka(t,a,h,c,r,s,o))}),i.foreach((l,c)=>{const h=ge(n,l);xh(e,Q(h))||(a=Ka(t,a,h,c,r,s,o))}),a}function Nh(t,e,n){return n.foreach((i,r)=>{e=e.updateChild(i,r)}),e}function Ya(t,e,n,i,r,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;X(n)?c=i:c=new le(null).setTree(n,i);const h=e.serverCache.getNode();return c.children.inorderTraversal((u,f)=>{if(h.hasChild(u)){const d=e.serverCache.getNode().getImmediateChild(u),w=Nh(t,d,f);l=Hs(t,l,new se(u),w,r,s,o,a)}}),c.children.inorderTraversal((u,f)=>{const d=!e.serverCache.isCompleteForChild(u)&&f.value===null;if(!h.hasChild(u)&&!d){const w=e.serverCache.getNode().getImmediateChild(u),b=Nh(t,w,f);l=Hs(t,l,new se(u),b,r,s,o,a)}}),l}function qE(t,e,n,i,r,s,o){if(Bs(r,n)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(i.value!=null){if(X(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return Hs(t,e,n,l.getNode().getChild(n),r,s,a,o);if(X(n)){let c=new le(null);return l.getNode().forEachChild(Zn,(h,u)=>{c=c.set(new se(h),u)}),Ya(t,e,n,c,r,s,a,o)}else return e}else{let c=new le(null);return i.foreach((h,u)=>{const f=ge(n,h);l.isCompleteForPath(f)&&(c=c.set(h,l.getNode().getChild(f)))}),Ya(t,e,n,c,r,s,a,o)}}function GE(t,e,n,i,r){const s=e.serverCache,o=qp(e,s.getNode(),s.isFullyInitialized()||X(n),s.isFiltered());return Jp(t,o,n,i,Qp,r)}function jE(t,e,n,i,r,s){let o;if(Bs(i,n)!=null)return e;{const a=new Sc(i,e,r),l=e.eventCache.getNode();let c;if(X(n)||Q(n)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=Us(i,Rn(e));else{const u=e.serverCache.getNode();F(u instanceof H,"serverChildren would be complete if leaf node"),h=Ec(i,u)}h=h,c=t.filter.updateFullNode(l,h,s)}else{const h=Q(n);let u=Ic(i,h,e.serverCache);u==null&&e.serverCache.isCompleteForChild(h)&&(u=l.getImmediateChild(h)),u!=null?c=t.filter.updateChild(l,h,u,oe(n),a,s):e.eventCache.getNode().hasChild(h)?c=t.filter.updateChild(l,h,H.EMPTY_NODE,oe(n),a,s):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Us(i,Rn(e)),o.isLeafNode()&&(c=t.filter.updateFullNode(c,o,s)))}return o=e.serverCache.isFullyInitialized()||Bs(i,te())!=null,Xi(e,c,o,t.filter.filtersNodes())}}class KE{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const i=this.query_._queryParams,r=new _c(i.getIndex()),s=dE(i);this.processor_=BE(s);const o=n.serverCache,a=n.eventCache,l=r.updateFullNode(H.EMPTY_NODE,o.getNode(),null),c=s.updateFullNode(H.EMPTY_NODE,a.getNode(),null),h=new ln(l,o.isFullyInitialized(),r.filtersNodes()),u=new ln(c,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=Do(u,h),this.eventGenerator_=new wE(this.query_)}get query(){return this.query_}}function YE(t){return t.viewCache_.serverCache.getNode()}function XE(t){return Fs(t.viewCache_)}function QE(t,e){const n=Rn(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!X(e)&&!n.getImmediateChild(Q(e)).isEmpty())?n.getChild(e):null}function Mh(t){return t.eventRegistrations_.length===0}function JE(t,e){t.eventRegistrations_.push(e)}function kh(t,e,n){const i=[];if(n){F(e==null,"A cancel should cancel all event registrations.");const r=t.query._path;t.eventRegistrations_.forEach(s=>{const o=s.createCancelEvent(n,r);o&&i.push(o)})}if(e){let r=[];for(let s=0;s<t.eventRegistrations_.length;++s){const o=t.eventRegistrations_[s];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(t.eventRegistrations_.slice(s+1));break}}t.eventRegistrations_=r}else t.eventRegistrations_=[];return i}function Ph(t,e,n,i){e.type===ot.MERGE&&e.source.queryId!==null&&(F(Rn(t.viewCache_),"We should always have a full cache before handling merges"),F(Fs(t.viewCache_),"Missing event cache, even though we have a server cache"));const r=t.viewCache_,s=zE(t.processor_,r,e,n,i);return HE(t.processor_,s.viewCache),F(s.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=s.viewCache,Zp(t,s.changes,s.viewCache.eventCache.getNode(),null)}function ZE(t,e){const n=t.viewCache_.eventCache,i=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(fe,(s,o)=>{i.push(oi(s,o))}),n.isFullyInitialized()&&i.push(zp(n.getNode())),Zp(t,i,n.getNode(),e)}function Zp(t,e,n,i){const r=i?[i]:t.eventRegistrations_;return EE(t.eventGenerator_,e,n,r)}let zs;class eg{constructor(){this.views=new Map}}function eI(t){F(!zs,"__referenceConstructor has already been defined"),zs=t}function tI(){return F(zs,"Reference.ts has not been loaded"),zs}function nI(t){return t.views.size===0}function bc(t,e,n,i){const r=e.source.queryId;if(r!==null){const s=t.views.get(r);return F(s!=null,"SyncTree gave us an op for an invalid query."),Ph(s,e,n,i)}else{let s=[];for(const o of t.views.values())s=s.concat(Ph(o,e,n,i));return s}}function tg(t,e,n,i,r){const s=e._queryIdentifier,o=t.views.get(s);if(!o){let a=Us(n,r?i:null),l=!1;a?l=!0:i instanceof H?(a=Ec(n,i),l=!1):(a=H.EMPTY_NODE,l=!1);const c=Do(new ln(a,l,!1),new ln(i,r,!1));return new KE(e,c)}return o}function iI(t,e,n,i,r,s){const o=tg(t,e,i,r,s);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),JE(o,n),ZE(o,n)}function rI(t,e,n,i){const r=e._queryIdentifier,s=[];let o=[];const a=cn(t);if(r==="default")for(const[l,c]of t.views.entries())o=o.concat(kh(c,n,i)),Mh(c)&&(t.views.delete(l),c.query._queryParams.loadsAllData()||s.push(c.query));else{const l=t.views.get(r);l&&(o=o.concat(kh(l,n,i)),Mh(l)&&(t.views.delete(r),l.query._queryParams.loadsAllData()||s.push(l.query)))}return a&&!cn(t)&&s.push(new(tI())(e._repo,e._path)),{removed:s,events:o}}function ng(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function sn(t,e){let n=null;for(const i of t.views.values())n=n||QE(i,e);return n}function ig(t,e){if(e._queryParams.loadsAllData())return $o(t);{const i=e._queryIdentifier;return t.views.get(i)}}function rg(t,e){return ig(t,e)!=null}function cn(t){return $o(t)!=null}function $o(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let Ws;function sI(t){F(!Ws,"__referenceConstructor has already been defined"),Ws=t}function oI(){return F(Ws,"Reference.ts has not been loaded"),Ws}let aI=1;class Rh{constructor(e){this.listenProvider_=e,this.syncPointTree_=new le(null),this.pendingWriteTree_=LE(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function sg(t,e,n,i,r){return CE(t.pendingWriteTree_,e,n,i,r),r?Pr(t,new Pn(Vp(),e,n)):[]}function vn(t,e,n=!1){const i=TE(t.pendingWriteTree_,e);if(AE(t.pendingWriteTree_,e)){let s=new le(null);return i.snap!=null?s=s.set(te(),!0):Ue(i.children,o=>{s=s.set(new se(o),!0)}),Pr(t,new $s(i.path,s,n))}else return[]}function kr(t,e,n){return Pr(t,new Pn(vc(),e,n))}function lI(t,e,n){const i=le.fromObject(n);return Pr(t,new hr(vc(),e,i))}function cI(t,e){return Pr(t,new ur(vc(),e))}function uI(t,e,n){const i=Tc(t,n);if(i){const r=Ac(i),s=r.path,o=r.queryId,a=Pe(s,e),l=new ur(wc(o),a);return xc(t,s,l)}else return[]}function og(t,e,n,i,r=!1){const s=e._path,o=t.syncPointTree_.get(s);let a=[];if(o&&(e._queryIdentifier==="default"||rg(o,e))){const l=rI(o,e,n,i);nI(o)&&(t.syncPointTree_=t.syncPointTree_.remove(s));const c=l.removed;if(a=l.events,!r){const h=c.findIndex(f=>f._queryParams.loadsAllData())!==-1,u=t.syncPointTree_.findOnPath(s,(f,d)=>cn(d));if(h&&!u){const f=t.syncPointTree_.subtree(s);if(!f.isEmpty()){const d=pI(f);for(let w=0;w<d.length;++w){const b=d[w],N=b.query,x=ug(t,b);t.listenProvider_.startListening(Ji(N),fr(t,N),x.hashFn,x.onComplete)}}}!u&&c.length>0&&!i&&(h?t.listenProvider_.stopListening(Ji(e),null):c.forEach(f=>{const d=t.queryToTagMap.get(Fo(f));t.listenProvider_.stopListening(Ji(f),d)}))}gI(t,c)}return a}function ag(t,e,n,i){const r=Tc(t,i);if(r!=null){const s=Ac(r),o=s.path,a=s.queryId,l=Pe(o,e),c=new Pn(wc(a),l,n);return xc(t,o,c)}else return[]}function hI(t,e,n,i){const r=Tc(t,i);if(r){const s=Ac(r),o=s.path,a=s.queryId,l=Pe(o,e),c=le.fromObject(n),h=new hr(wc(a),l,c);return xc(t,o,h)}else return[]}function fI(t,e,n,i=!1){const r=e._path;let s=null,o=!1;t.syncPointTree_.foreachOnPath(r,(f,d)=>{const w=Pe(f,r);s=s||sn(d,w),o=o||cn(d)});let a=t.syncPointTree_.get(r);a?(o=o||cn(a),s=s||sn(a,te())):(a=new eg,t.syncPointTree_=t.syncPointTree_.set(r,a));let l;s!=null?l=!0:(l=!1,s=H.EMPTY_NODE,t.syncPointTree_.subtree(r).foreachChild((d,w)=>{const b=sn(w,te());b&&(s=s.updateImmediateChild(d,b))}));const c=rg(a,e);if(!c&&!e._queryParams.loadsAllData()){const f=Fo(e);F(!t.queryToTagMap.has(f),"View does not exist, but we have a tag");const d=mI();t.queryToTagMap.set(f,d),t.tagToQueryMap.set(d,f)}const h=Lo(t.pendingWriteTree_,r);let u=iI(a,e,n,h,s,l);if(!c&&!o&&!i){const f=ig(a,e);u=u.concat(_I(t,e,f))}return u}function Cc(t,e,n){const r=t.pendingWriteTree_,s=t.syncPointTree_.findOnPath(e,(o,a)=>{const l=Pe(o,e),c=sn(a,l);if(c)return c});return Kp(r,e,s,n,!0)}function dI(t,e){const n=e._path;let i=null;t.syncPointTree_.foreachOnPath(n,(c,h)=>{const u=Pe(c,n);i=i||sn(h,u)});let r=t.syncPointTree_.get(n);r?i=i||sn(r,te()):(r=new eg,t.syncPointTree_=t.syncPointTree_.set(n,r));const s=i!=null,o=s?new ln(i,!0,!1):null,a=Lo(t.pendingWriteTree_,e._path),l=tg(r,e,a,s?o.getNode():H.EMPTY_NODE,s);return XE(l)}function Pr(t,e){return lg(e,t.syncPointTree_,null,Lo(t.pendingWriteTree_,te()))}function lg(t,e,n,i){if(X(t.path))return cg(t,e,n,i);{const r=e.get(te());n==null&&r!=null&&(n=sn(r,te()));let s=[];const o=Q(t.path),a=t.operationForChild(o),l=e.children.get(o);if(l&&a){const c=n?n.getImmediateChild(o):null,h=Yp(i,o);s=s.concat(lg(a,l,c,h))}return r&&(s=s.concat(bc(r,t,i,n))),s}}function cg(t,e,n,i){const r=e.get(te());n==null&&r!=null&&(n=sn(r,te()));let s=[];return e.children.inorderTraversal((o,a)=>{const l=n?n.getImmediateChild(o):null,c=Yp(i,o),h=t.operationForChild(o);h&&(s=s.concat(cg(h,a,l,c)))}),r&&(s=s.concat(bc(r,t,i,n))),s}function ug(t,e){const n=e.query,i=fr(t,n);return{hashFn:()=>(YE(e)||H.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return i?uI(t,n._path,i):cI(t,n._path);{const s=f1(r,n);return og(t,n,null,s)}}}}function fr(t,e){const n=Fo(e);return t.queryToTagMap.get(n)}function Fo(t){return t._path.toString()+"$"+t._queryIdentifier}function Tc(t,e){return t.tagToQueryMap.get(e)}function Ac(t){const e=t.indexOf("$");return F(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new se(t.substr(0,e))}}function xc(t,e,n){const i=t.syncPointTree_.get(e);F(i,"Missing sync point for query tag that we're tracking");const r=Lo(t.pendingWriteTree_,e);return bc(i,n,r,null)}function pI(t){return t.fold((e,n,i)=>{if(n&&cn(n))return[$o(n)];{let r=[];return n&&(r=ng(n)),Ue(i,(s,o)=>{r=r.concat(o)}),r}})}function Ji(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(oI())(t._repo,t._path):t}function gI(t,e){for(let n=0;n<e.length;++n){const i=e[n];if(!i._queryParams.loadsAllData()){const r=Fo(i),s=t.queryToTagMap.get(r);t.queryToTagMap.delete(r),t.tagToQueryMap.delete(s)}}}function mI(){return aI++}function _I(t,e,n){const i=e._path,r=fr(t,e),s=ug(t,n),o=t.listenProvider_.startListening(Ji(e),r,s.hashFn,s.onComplete),a=t.syncPointTree_.subtree(i);if(r)F(!cn(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((c,h,u)=>{if(!X(c)&&h&&cn(h))return[$o(h).query];{let f=[];return h&&(f=f.concat(ng(h).map(d=>d.query))),Ue(u,(d,w)=>{f=f.concat(w)}),f}});for(let c=0;c<l.length;++c){const h=l[c];t.listenProvider_.stopListening(Ji(h),fr(t,h))}}return o}class Nc{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new Nc(n)}node(){return this.node_}}class Mc{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=ge(this.path_,e);return new Mc(this.syncTree_,n)}node(){return Cc(this.syncTree_,this.path_)}}const yI=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},Oh=function(t,e,n){if(!t||typeof t!="object")return t;if(F(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return vI(t[".sv"],e,n);if(typeof t[".sv"]=="object")return wI(t[".sv"],e);F(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},vI=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:F(!1,"Unexpected server value: "+t)}},wI=function(t,e,n){t.hasOwnProperty("increment")||F(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const i=t.increment;typeof i!="number"&&F(!1,"Unexpected increment value: "+i);const r=e.node();if(F(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;const o=r.getValue();return typeof o!="number"?i:o+i},EI=function(t,e,n,i){return kc(e,new Mc(n,t),i)},hg=function(t,e,n){return kc(t,new Nc(e),n)};function kc(t,e,n){const i=t.getPriority().val(),r=Oh(i,e.getImmediateChild(".priority"),n);let s;if(t.isLeafNode()){const o=t,a=Oh(o.getValue(),e,n);return a!==o.getValue()||r!==o.getPriority().val()?new ve(a,Ee(r)):t}else{const o=t;return s=o,r!==o.getPriority().val()&&(s=s.updatePriority(new ve(r))),o.forEachChild(fe,(a,l)=>{const c=kc(l,e.getImmediateChild(a),n);c!==l&&(s=s.updateImmediateChild(a,c))}),s}}class Pc{constructor(e="",n=null,i={children:{},childCount:0}){this.name=e,this.parent=n,this.node=i}}function Rc(t,e){let n=e instanceof se?e:new se(e),i=t,r=Q(n);for(;r!==null;){const s=ii(i.node.children,r)||{children:{},childCount:0};i=new Pc(r,i,s),n=oe(n),r=Q(n)}return i}function bi(t){return t.node.value}function fg(t,e){t.node.value=e,Xa(t)}function dg(t){return t.node.childCount>0}function II(t){return bi(t)===void 0&&!dg(t)}function Uo(t,e){Ue(t.node.children,(n,i)=>{e(new Pc(n,t,i))})}function pg(t,e,n,i){n&&e(t),Uo(t,r=>{pg(r,e,!0)})}function SI(t,e,n){let i=t.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function Rr(t){return new se(t.parent===null?t.name:Rr(t.parent)+"/"+t.name)}function Xa(t){t.parent!==null&&bI(t.parent,t.name,t)}function bI(t,e,n){const i=II(n),r=Ht(t.node.children,e);i&&r?(delete t.node.children[e],t.node.childCount--,Xa(t)):!i&&!r&&(t.node.children[e]=n.node,t.node.childCount++,Xa(t))}const CI=/[\[\].#$\/\u0000-\u001F\u007F]/,TI=/[\[\].#$\u0000-\u001F\u007F]/,ma=10*1024*1024,gg=function(t){return typeof t=="string"&&t.length!==0&&!CI.test(t)},mg=function(t){return typeof t=="string"&&t.length!==0&&!TI.test(t)},AI=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),mg(t)},xI=function(t,e,n,i){Oc(ec(t,"value"),e,n)},Oc=function(t,e,n){const i=n instanceof se?new q1(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+mn(i));if(typeof e=="function")throw new Error(t+"contains a function "+mn(i)+" with contents = "+e.toString());if(hp(e))throw new Error(t+"contains "+e.toString()+" "+mn(i));if(typeof e=="string"&&e.length>ma/3&&No(e)>ma)throw new Error(t+"contains a string greater than "+ma+" utf8 bytes "+mn(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,s=!1;if(Ue(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!gg(o)))throw new Error(t+" contains an invalid key ("+o+") "+mn(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);G1(i,o),Oc(t,a,i),j1(i)}),r&&s)throw new Error(t+' contains ".value" child '+mn(i)+" in addition to actual children.")}},_g=function(t,e,n,i){if(!mg(n))throw new Error(ec(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},NI=function(t,e,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),_g(t,e,n)},MI=function(t,e){if(Q(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},kI=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!gg(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!AI(n))throw new Error(ec(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class PI{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function yg(t,e){let n=null;for(let i=0;i<e.length;i++){const r=e[i],s=r.getPath();n!==null&&!Dp(s,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:s}),n.events.push(r)}n&&t.eventLists_.push(n)}function Et(t,e,n){yg(t,n),RI(t,i=>st(i,e)||st(e,i))}function RI(t,e){t.recursionDepth_++;let n=!0;for(let i=0;i<t.eventLists_.length;i++){const r=t.eventLists_[i];if(r){const s=r.path;e(s)?(OI(t.eventLists_[i]),t.eventLists_[i]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function OI(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const i=n.getEventRunner();Ki&&be("event: "+n.toString()),Si(i)}}}const DI="repo_interrupt",LI=25;class $I{constructor(e,n,i,r){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=i,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new PI,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Ls(),this.transactionQueueTree_=new Pc,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function FI(t,e,n){if(t.stats_=dc(t.repoInfo_),t.forceRestClient_||m1())t.server_=new Ds(t.repoInfo_,(i,r,s,o)=>{Dh(t,i,r,s,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>Lh(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{pe(n)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}t.persistentConnection_=new kt(t.repoInfo_,e,(i,r,s,o)=>{Dh(t,i,r,s,o)},i=>{Lh(t,i)},i=>{BI(t,i)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(i=>{t.server_.refreshAuthToken(i)}),t.appCheckProvider_.addTokenChangeListener(i=>{t.server_.refreshAppCheckToken(i.token)}),t.statsReporter_=E1(t.repoInfo_,()=>new vE(t.stats_,t.server_)),t.infoData_=new pE,t.infoSyncTree_=new Rh({startListening:(i,r,s,o)=>{let a=[];const l=t.infoData_.getNode(i._path);return l.isEmpty()||(a=kr(t.infoSyncTree_,i._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Lc(t,"connected",!1),t.serverSyncTree_=new Rh({startListening:(i,r,s,o)=>(t.server_.listen(i,s,r,(a,l)=>{const c=o(a,l);Et(t.eventQueue_,i._path,c)}),[]),stopListening:(i,r)=>{t.server_.unlisten(i,r)}})}function UI(t){const n=t.infoData_.getNode(new se(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function Dc(t){return yI({timestamp:UI(t)})}function Dh(t,e,n,i,r){t.dataUpdateCount++;const s=new se(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(r)if(i){const l=bs(n,c=>Ee(c));o=hI(t.serverSyncTree_,s,l,r)}else{const l=Ee(n);o=ag(t.serverSyncTree_,s,l,r)}else if(i){const l=bs(n,c=>Ee(c));o=lI(t.serverSyncTree_,s,l)}else{const l=Ee(n);o=kr(t.serverSyncTree_,s,l)}let a=s;o.length>0&&(a=Ho(t,s)),Et(t.eventQueue_,a,o)}function Lh(t,e){Lc(t,"connected",e),e===!1&&WI(t)}function BI(t,e){Ue(e,(n,i)=>{Lc(t,n,i)})}function Lc(t,e,n){const i=new se("/.info/"+e),r=Ee(n);t.infoData_.updateSnapshot(i,r);const s=kr(t.infoSyncTree_,i,r);Et(t.eventQueue_,i,s)}function vg(t){return t.nextWriteId_++}function HI(t,e,n){const i=dI(t.serverSyncTree_,e);return i!=null?Promise.resolve(i):t.server_.get(e).then(r=>{const s=Ee(r).withIndex(e._queryParams.getIndex());fI(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=kr(t.serverSyncTree_,e._path,s);else{const a=fr(t.serverSyncTree_,e);o=ag(t.serverSyncTree_,e._path,s,a)}return Et(t.eventQueue_,e._path,o),og(t.serverSyncTree_,e,n,null,!0),s},r=>(Bo(t,"get for query "+pe(e)+" failed: "+r),Promise.reject(new Error(r))))}function zI(t,e,n,i,r){Bo(t,"set",{path:e.toString(),value:n,priority:i});const s=Dc(t),o=Ee(n,i),a=Cc(t.serverSyncTree_,e),l=hg(o,a,s),c=vg(t),h=sg(t.serverSyncTree_,e,l,c,!0);yg(t.eventQueue_,h),t.server_.put(e.toString(),o.val(!0),(f,d)=>{const w=f==="ok";w||Fe("set at "+e+" failed: "+f);const b=vn(t.serverSyncTree_,c,!w);Et(t.eventQueue_,e,b),qI(t,r,f,d)});const u=bg(t,e);Ho(t,u),Et(t.eventQueue_,u,[])}function WI(t){Bo(t,"onDisconnectEvents");const e=Dc(t),n=Ls();qa(t.onDisconnect_,te(),(r,s)=>{const o=EI(r,s,t.serverSyncTree_,e);Wp(n,r,o)});let i=[];qa(n,te(),(r,s)=>{i=i.concat(kr(t.serverSyncTree_,r,s));const o=bg(t,r);Ho(t,o)}),t.onDisconnect_=Ls(),Et(t.eventQueue_,te(),i)}function VI(t){t.persistentConnection_&&t.persistentConnection_.interrupt(DI)}function Bo(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),be(n,...e)}function qI(t,e,n,i){e&&Si(()=>{if(n==="ok")e(null);else{const r=(n||"error").toUpperCase();let s=r;i&&(s+=": "+i);const o=new Error(s);o.code=r,e(o)}})}function wg(t,e,n){return Cc(t.serverSyncTree_,e,n)||H.EMPTY_NODE}function $c(t,e=t.transactionQueueTree_){if(e||zo(t,e),bi(e)){const n=Ig(t,e);F(n.length>0,"Sending zero length transaction queue"),n.every(r=>r.status===0)&&GI(t,Rr(e),n)}else dg(e)&&Uo(e,n=>{$c(t,n)})}function GI(t,e,n){const i=n.map(c=>c.currentWriteId),r=wg(t,e,i);let s=r;const o=r.hash();for(let c=0;c<n.length;c++){const h=n[c];F(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const u=Pe(e,h.path);s=s.updateChild(u,h.currentOutputSnapshotRaw)}const a=s.val(!0),l=e;t.server_.put(l.toString(),a,c=>{Bo(t,"transaction put response",{path:l.toString(),status:c});let h=[];if(c==="ok"){const u=[];for(let f=0;f<n.length;f++)n[f].status=2,h=h.concat(vn(t.serverSyncTree_,n[f].currentWriteId)),n[f].onComplete&&u.push(()=>n[f].onComplete(null,!0,n[f].currentOutputSnapshotResolved)),n[f].unwatcher();zo(t,Rc(t.transactionQueueTree_,e)),$c(t,t.transactionQueueTree_),Et(t.eventQueue_,e,h);for(let f=0;f<u.length;f++)Si(u[f])}else{if(c==="datastale")for(let u=0;u<n.length;u++)n[u].status===3?n[u].status=4:n[u].status=0;else{Fe("transaction at "+l.toString()+" failed: "+c);for(let u=0;u<n.length;u++)n[u].status=4,n[u].abortReason=c}Ho(t,e)}},o)}function Ho(t,e){const n=Eg(t,e),i=Rr(n),r=Ig(t,n);return jI(t,r,i),i}function jI(t,e,n){if(e.length===0)return;const i=[];let r=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],c=Pe(n,l.path);let h=!1,u;if(F(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,u=l.abortReason,r=r.concat(vn(t.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=LI)h=!0,u="maxretry",r=r.concat(vn(t.serverSyncTree_,l.currentWriteId,!0));else{const f=wg(t,l.path,o);l.currentInputSnapshot=f;const d=e[a].update(f.val());if(d!==void 0){Oc("transaction failed: Data returned ",d,l.path);let w=Ee(d);typeof d=="object"&&d!=null&&Ht(d,".priority")||(w=w.updatePriority(f.getPriority()));const N=l.currentWriteId,x=Dc(t),A=hg(w,f,x);l.currentOutputSnapshotRaw=w,l.currentOutputSnapshotResolved=A,l.currentWriteId=vg(t),o.splice(o.indexOf(N),1),r=r.concat(sg(t.serverSyncTree_,l.path,A,l.currentWriteId,l.applyLocally)),r=r.concat(vn(t.serverSyncTree_,N,!0))}else h=!0,u="nodata",r=r.concat(vn(t.serverSyncTree_,l.currentWriteId,!0))}Et(t.eventQueue_,n,r),r=[],h&&(e[a].status=2,(function(f){setTimeout(f,Math.floor(0))})(e[a].unwatcher),e[a].onComplete&&(u==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(u),!1,null))))}zo(t,t.transactionQueueTree_);for(let a=0;a<i.length;a++)Si(i[a]);$c(t,t.transactionQueueTree_)}function Eg(t,e){let n,i=t.transactionQueueTree_;for(n=Q(e);n!==null&&bi(i)===void 0;)i=Rc(i,n),e=oe(e),n=Q(e);return i}function Ig(t,e){const n=[];return Sg(t,e,n),n.sort((i,r)=>i.order-r.order),n}function Sg(t,e,n){const i=bi(e);if(i)for(let r=0;r<i.length;r++)n.push(i[r]);Uo(e,r=>{Sg(t,r,n)})}function zo(t,e){const n=bi(e);if(n){let i=0;for(let r=0;r<n.length;r++)n[r].status!==2&&(n[i]=n[r],i++);n.length=i,fg(e,n.length>0?n:void 0)}Uo(e,i=>{zo(t,i)})}function bg(t,e){const n=Rr(Eg(t,e)),i=Rc(t.transactionQueueTree_,e);return SI(i,r=>{_a(t,r)}),_a(t,i),pg(i,r=>{_a(t,r)}),n}function _a(t,e){const n=bi(e);if(n){const i=[];let r=[],s=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(F(s===o-1,"All SENT items should be at beginning of queue."),s=o,n[o].status=3,n[o].abortReason="set"):(F(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),r=r.concat(vn(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&i.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?fg(e,void 0):n.length=s+1,Et(t.eventQueue_,Rr(e),r);for(let o=0;o<i.length;o++)Si(i[o])}}function KI(t){let e="";const n=t.split("/");for(let i=0;i<n.length;i++)if(n[i].length>0){let r=n[i];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function YI(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const i=n.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Fe(`Invalid query segment '${n}' in query '${t}'`)}return e}const $h=function(t,e){const n=XI(t),i=n.namespace;n.domain==="firebase.com"&&Lt(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&n.domain!=="localhost"&&Lt("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||a1();const r=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new Sp(n.host,n.secure,i,r,e,"",i!==n.subdomain),path:new se(n.pathString)}},XI=function(t){let e="",n="",i="",r="",s="",o=!0,a="https",l=443;if(typeof t=="string"){let c=t.indexOf("//");c>=0&&(a=t.substring(0,c-1),t=t.substring(c+2));let h=t.indexOf("/");h===-1&&(h=t.length);let u=t.indexOf("?");u===-1&&(u=t.length),e=t.substring(0,Math.min(h,u)),h<u&&(r=KI(t.substring(h,u)));const f=YI(t.substring(Math.min(t.length,u)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;const d=e.slice(0,c);if(d.toLowerCase()==="localhost")n="localhost";else if(d.split(".").length<=2)n=d;else{const w=e.indexOf(".");i=e.substring(0,w).toLowerCase(),n=e.substring(w+1),s=i}"ns"in f&&(s=f.ns)}return{host:e,port:l,domain:n,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};class QI{constructor(e,n,i,r){this.eventType=e,this.eventRegistration=n,this.snapshot=i,this.prevName=r}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+pe(this.snapshot.exportVal())}}class JI{constructor(e,n,i){this.eventRegistration=e,this.error=n,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class ZI{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return F(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Fc{constructor(e,n,i,r){this._repo=e,this._path=n,this._queryParams=i,this._orderByCalled=r}get key(){return X(this._path)?null:Pp(this._path)}get ref(){return new zt(this._repo,this._path)}get _queryIdentifier(){const e=Ih(this._queryParams),n=hc(e);return n==="{}"?"default":n}get _queryObject(){return Ih(this._queryParams)}isEqual(e){if(e=Qe(e),!(e instanceof Fc))return!1;const n=this._repo===e._repo,i=Dp(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return n&&i&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+V1(this._path)}}class zt extends Fc{constructor(e,n){super(e,n,new yc,!1)}get parent(){const e=Op(this._path);return e===null?null:new zt(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class dr{constructor(e,n,i){this._node=e,this.ref=n,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new se(e),i=Qa(this.ref,e);return new dr(this._node.getChild(n),i,fe)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,r)=>e(new dr(r,Qa(this.ref,i),fe)))}hasChild(e){const n=new se(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Vr(t,e){return t=Qe(t),t._checkNotDeleted("ref"),e!==void 0?Qa(t._root,e):t._root}function Qa(t,e){return t=Qe(t),Q(t._path)===null?NI("child","path",e):_g("child","path",e),new zt(t._repo,ge(t._path,e))}function Fh(t,e){t=Qe(t),MI("set",t._path),xI("set",e,t._path);const n=new xo;return zI(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function Uh(t){t=Qe(t);const e=new ZI(()=>{}),n=new Uc(e);return HI(t._repo,t,n).then(i=>new dr(i,new zt(t._repo,t._path),t._queryParams.getIndex()))}class Uc{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const i=n._queryParams.getIndex();return new QI("value",this,new dr(e.snapshotNode,new zt(n._repo,n._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new JI(this,e,n):null}matches(e){return e instanceof Uc?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}eI(zt);sI(zt);const eS="FIREBASE_DATABASE_EMULATOR_HOST",Ja={};let tS=!1;function nS(t,e,n,i){const r=e.lastIndexOf(":"),s=e.substring(0,r),o=yi(s);t.repoInfo_=new Sp(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),i&&(t.authTokenProvider_=i)}function iS(t,e,n,i,r){let s=i||t.options.databaseURL;s===void 0&&(t.options.projectId||Lt("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),be("Using default host for project ",t.options.projectId),s=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=$h(s,r),a=o.repoInfo,l;typeof process<"u"&&rh&&(l=rh[eS]),l?(s=`http://${l}?ns=${a.namespace}`,o=$h(s,r),a=o.repoInfo):o.repoInfo.secure;const c=new y1(t.name,t.options,e);kI("Invalid Firebase Database URL",o),X(o.path)||Lt("Database URL must point to the root of a Firebase Database (not including a child path).");const h=sS(a,t,c,new _1(t,n));return new oS(h,t)}function rS(t,e){const n=Ja[e];(!n||n[t.key]!==t)&&Lt(`Database ${e}(${t.repoInfo_}) has already been deleted.`),VI(t),delete n[t.key]}function sS(t,e,n,i){let r=Ja[e.name];r||(r={},Ja[e.name]=r);let s=r[t.toURLString()];return s&&Lt("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new $I(t,tS,n,i),r[t.toURLString()]=s,s}class oS{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(FI(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new zt(this._repo,te())),this._rootInternal}_delete(){return this._rootInternal!==null&&(rS(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Lt("Cannot call "+e+" on a deleted database.")}}function aS(t=Ad(),e){const n=ic(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const i=T0("database");i&&lS(n,...i)}return n}function lS(t,e,n,i={}){t=Qe(t),t._checkNotDeleted("useEmulator");const r=`${e}:${n}`,s=t._repoInternal;if(t._instanceStarted){if(r===t._repoInternal.repoInfo_.host&&xn(i,s.repoInfo_.emulatorOptions))return;Lt("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&Lt('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new hs(hs.OWNER);else if(i.mockUserToken){const a=typeof i.mockUserToken=="string"?i.mockUserToken:A0(i.mockUserToken,t.app.options.projectId);o=new hs(a)}yi(e)&&(wd(e),Ed("Database",!0)),nS(s,r,i,o)}function cS(t){t1(wi),ri(new Nn("database",(e,{instanceIdentifier:n})=>{const i=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return iS(i,r,s,n)},"PUBLIC").setMultipleInstances(!0)),tn(sh,oh,t),tn(sh,oh,"esm2020")}function uS(t){return{".sv":{increment:t}}}kt.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};kt.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};cS();const hS={DEV:!1,PROD:!0},Vs=750,Jt=750,fS="Orthographic",dS=500,pS=2,gS=25,mS=1,_S=1,Cg=40,yS=!0,vS=384,Za=1,wS=4,ES=.1,Tg=hS||{},qs=Tg.DEV??!0,IS=Tg.PROD??!1,SS=IS,bS=qs,Ag=qs,CS=["#c0392b","#f1c40f","#9b59b6","#00b386","#cc6600","#0a4c8c"];function xg(t,e){let n,i;for(const r of t)r!=null&&(n===void 0?r>=r&&(n=i=r):(n>r&&(n=r),i<r&&(i=r)));return[n,i]}class ct{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const n=this._partials;let i=0;for(let r=0;r<this._n&&r<32;r++){const s=n[r],o=e+s,a=Math.abs(e)<Math.abs(s)?e-(o-s):s-(o-e);a&&(n[i++]=a),e=o}return n[i]=e,this._n=i+1,this}valueOf(){const e=this._partials;let n=this._n,i,r,s,o=0;if(n>0){for(o=e[--n];n>0&&(i=o,r=e[--n],o=i+r,s=r-(o-i),!s););n>0&&(s<0&&e[n-1]<0||s>0&&e[n-1]>0)&&(r=s*2,i=o+r,r==i-o&&(o=i))}return o}}function Bh(t,e){let n=0,i=0;if(e===void 0)for(let r of t)r!=null&&(r=+r)>=r&&(++n,i+=r);else{let r=-1;for(let s of t)(s=e(s,++r,t))!=null&&(s=+s)>=s&&(++n,i+=s)}if(n)return i/n}function*TS(t){for(const e of t)yield*e}function Ng(t){return Array.from(TS(t))}function Gn(t,e,n){t=+t,e=+e,n=(r=arguments.length)<2?(e=t,t=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((e-t)/n))|0,s=new Array(r);++i<r;)s[i]=t+i*n;return s}var AS={value:()=>{}};function Wo(){for(var t=0,e=arguments.length,n={},i;t<e;++t){if(!(i=arguments[t]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new fs(n)}function fs(t){this._=t}function xS(t,e){return t.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}fs.prototype=Wo.prototype={constructor:fs,on:function(t,e){var n=this._,i=xS(t+"",n),r,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((r=(t=i[s]).type)&&(r=NS(n[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(r=(t=i[s]).type)n[r]=Hh(n[r],t.name,e);else if(e==null)for(r in n)n[r]=Hh(n[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new fs(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],i=0,r=s.length;i<r;++i)s[i].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,s=i.length;r<s;++r)i[r].value.apply(e,n)}};function NS(t,e){for(var n=0,i=t.length,r;n<i;++n)if((r=t[n]).name===e)return r.value}function Hh(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=AS,t=t.slice(0,i).concat(t.slice(i+1));break}return n!=null&&t.push({name:e,value:n}),t}var el="http://www.w3.org/1999/xhtml";const zh={svg:"http://www.w3.org/2000/svg",xhtml:el,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Vo(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),zh.hasOwnProperty(e)?{space:zh[e],local:t}:t}function MS(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===el&&e.documentElement.namespaceURI===el?e.createElement(t):e.createElementNS(n,t)}}function kS(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Mg(t){var e=Vo(t);return(e.local?kS:MS)(e)}function PS(){}function Bc(t){return t==null?PS:function(){return this.querySelector(t)}}function RS(t){typeof t!="function"&&(t=Bc(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,a=i[r]=new Array(o),l,c,h=0;h<o;++h)(l=s[h])&&(c=t.call(l,l.__data__,h,s))&&("__data__"in l&&(c.__data__=l.__data__),a[h]=c);return new We(i,this._parents)}function OS(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function DS(){return[]}function kg(t){return t==null?DS:function(){return this.querySelectorAll(t)}}function LS(t){return function(){return OS(t.apply(this,arguments))}}function $S(t){typeof t=="function"?t=LS(t):t=kg(t);for(var e=this._groups,n=e.length,i=[],r=[],s=0;s<n;++s)for(var o=e[s],a=o.length,l,c=0;c<a;++c)(l=o[c])&&(i.push(t.call(l,l.__data__,c,o)),r.push(l));return new We(i,r)}function Pg(t){return function(){return this.matches(t)}}function Rg(t){return function(e){return e.matches(t)}}var FS=Array.prototype.find;function US(t){return function(){return FS.call(this.children,t)}}function BS(){return this.firstElementChild}function HS(t){return this.select(t==null?BS:US(typeof t=="function"?t:Rg(t)))}var zS=Array.prototype.filter;function WS(){return Array.from(this.children)}function VS(t){return function(){return zS.call(this.children,t)}}function qS(t){return this.selectAll(t==null?WS:VS(typeof t=="function"?t:Rg(t)))}function GS(t){typeof t!="function"&&(t=Pg(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,a=i[r]=[],l,c=0;c<o;++c)(l=s[c])&&t.call(l,l.__data__,c,s)&&a.push(l);return new We(i,this._parents)}function Og(t){return new Array(t.length)}function jS(){return new We(this._enter||this._groups.map(Og),this._parents)}function Gs(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Gs.prototype={constructor:Gs,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function KS(t){return function(){return t}}function YS(t,e,n,i,r,s){for(var o=0,a,l=e.length,c=s.length;o<c;++o)(a=e[o])?(a.__data__=s[o],i[o]=a):n[o]=new Gs(t,s[o]);for(;o<l;++o)(a=e[o])&&(r[o]=a)}function XS(t,e,n,i,r,s,o){var a,l,c=new Map,h=e.length,u=s.length,f=new Array(h),d;for(a=0;a<h;++a)(l=e[a])&&(f[a]=d=o.call(l,l.__data__,a,e)+"",c.has(d)?r[a]=l:c.set(d,l));for(a=0;a<u;++a)d=o.call(t,s[a],a,s)+"",(l=c.get(d))?(i[a]=l,l.__data__=s[a],c.delete(d)):n[a]=new Gs(t,s[a]);for(a=0;a<h;++a)(l=e[a])&&c.get(f[a])===l&&(r[a]=l)}function QS(t){return t.__data__}function JS(t,e){if(!arguments.length)return Array.from(this,QS);var n=e?XS:YS,i=this._parents,r=this._groups;typeof t!="function"&&(t=KS(t));for(var s=r.length,o=new Array(s),a=new Array(s),l=new Array(s),c=0;c<s;++c){var h=i[c],u=r[c],f=u.length,d=ZS(t.call(h,h&&h.__data__,c,i)),w=d.length,b=a[c]=new Array(w),N=o[c]=new Array(w),x=l[c]=new Array(f);n(h,u,b,N,x,d,e);for(var A=0,P=0,k,R;A<w;++A)if(k=b[A]){for(A>=P&&(P=A+1);!(R=N[P])&&++P<w;);k._next=R||null}}return o=new We(o,i),o._enter=a,o._exit=l,o}function ZS(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function eb(){return new We(this._exit||this._groups.map(Og),this._parents)}function tb(t,e,n){var i=this.enter(),r=this,s=this.exit();return typeof t=="function"?(i=t(i),i&&(i=i.selection())):i=i.append(t+""),e!=null&&(r=e(r),r&&(r=r.selection())),n==null?s.remove():n(s),i&&r?i.merge(r).order():r}function nb(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,s=i.length,o=Math.min(r,s),a=new Array(r),l=0;l<o;++l)for(var c=n[l],h=i[l],u=c.length,f=a[l]=new Array(u),d,w=0;w<u;++w)(d=c[w]||h[w])&&(f[w]=d);for(;l<r;++l)a[l]=n[l];return new We(a,this._parents)}function ib(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i=t[e],r=i.length-1,s=i[r],o;--r>=0;)(o=i[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function rb(t){t||(t=sb);function e(u,f){return u&&f?t(u.__data__,f.__data__):!u-!f}for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o=n[s],a=o.length,l=r[s]=new Array(a),c,h=0;h<a;++h)(c=o[h])&&(l[h]=c);l.sort(e)}return new We(r,this._parents).order()}function sb(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function ob(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function ab(){return Array.from(this)}function lb(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null}function cb(){let t=0;for(const e of this)++t;return t}function ub(){return!this.node()}function hb(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r=e[n],s=0,o=r.length,a;s<o;++s)(a=r[s])&&t.call(a,a.__data__,s,r);return this}function fb(t){return function(){this.removeAttribute(t)}}function db(t){return function(){this.removeAttributeNS(t.space,t.local)}}function pb(t,e){return function(){this.setAttribute(t,e)}}function gb(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function mb(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function _b(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function yb(t,e){var n=Vo(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((e==null?n.local?db:fb:typeof e=="function"?n.local?_b:mb:n.local?gb:pb)(n,e))}function Dg(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function vb(t){return function(){this.style.removeProperty(t)}}function wb(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Eb(t,e,n){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function Ib(t,e,n){return arguments.length>1?this.each((e==null?vb:typeof e=="function"?Eb:wb)(t,e,n??"")):li(this.node(),t)}function li(t,e){return t.style.getPropertyValue(e)||Dg(t).getComputedStyle(t,null).getPropertyValue(e)}function Sb(t){return function(){delete this[t]}}function bb(t,e){return function(){this[t]=e}}function Cb(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function Tb(t,e){return arguments.length>1?this.each((e==null?Sb:typeof e=="function"?Cb:bb)(t,e)):this.node()[t]}function Lg(t){return t.trim().split(/^|\s+/)}function Hc(t){return t.classList||new $g(t)}function $g(t){this._node=t,this._names=Lg(t.getAttribute("class")||"")}$g.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Fg(t,e){for(var n=Hc(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function Ug(t,e){for(var n=Hc(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function Ab(t){return function(){Fg(this,t)}}function xb(t){return function(){Ug(this,t)}}function Nb(t,e){return function(){(e.apply(this,arguments)?Fg:Ug)(this,t)}}function Mb(t,e){var n=Lg(t+"");if(arguments.length<2){for(var i=Hc(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof e=="function"?Nb:e?Ab:xb)(n,e))}function kb(){this.textContent=""}function Pb(t){return function(){this.textContent=t}}function Rb(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Ob(t){return arguments.length?this.each(t==null?kb:(typeof t=="function"?Rb:Pb)(t)):this.node().textContent}function Db(){this.innerHTML=""}function Lb(t){return function(){this.innerHTML=t}}function $b(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Fb(t){return arguments.length?this.each(t==null?Db:(typeof t=="function"?$b:Lb)(t)):this.node().innerHTML}function Ub(){this.nextSibling&&this.parentNode.appendChild(this)}function Bb(){return this.each(Ub)}function Hb(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function zb(){return this.each(Hb)}function Wb(t){var e=typeof t=="function"?t:Mg(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Vb(){return null}function qb(t,e){var n=typeof t=="function"?t:Mg(t),i=e==null?Vb:typeof e=="function"?e:Bc(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function Gb(){var t=this.parentNode;t&&t.removeChild(this)}function jb(){return this.each(Gb)}function Kb(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Yb(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Xb(t){return this.select(t?Yb:Kb)}function Qb(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Jb(t){return function(e){t.call(this,e,this.__data__)}}function Zb(t){return t.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");return i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),{type:e,name:n}})}function eC(t){return function(){var e=this.__on;if(e){for(var n=0,i=-1,r=e.length,s;n<r;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++i]=s;++i?e.length=i:delete this.__on}}}function tC(t,e,n){return function(){var i=this.__on,r,s=Jb(e);if(i){for(var o=0,a=i.length;o<a;++o)if((r=i[o]).type===t.type&&r.name===t.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),r.value=e;return}}this.addEventListener(t.type,s,n),r={type:t.type,name:t.name,value:e,listener:s,options:n},i?i.push(r):this.__on=[r]}}function nC(t,e,n){var i=Zb(t+""),r,s=i.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,h;l<c;++l)for(r=0,h=a[l];r<s;++r)if((o=i[r]).type===h.type&&o.name===h.name)return h.value}return}for(a=e?tC:eC,r=0;r<s;++r)this.each(a(i[r],e,n));return this}function Bg(t,e,n){var i=Dg(t),r=i.CustomEvent;typeof r=="function"?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function iC(t,e){return function(){return Bg(this,t,e)}}function rC(t,e){return function(){return Bg(this,t,e.apply(this,arguments))}}function sC(t,e){return this.each((typeof e=="function"?rC:iC)(t,e))}function*oC(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length,o;r<s;++r)(o=i[r])&&(yield o)}var Hg=[null];function We(t,e){this._groups=t,this._parents=e}function Or(){return new We([[document.documentElement]],Hg)}function aC(){return this}We.prototype=Or.prototype={constructor:We,select:RS,selectAll:$S,selectChild:HS,selectChildren:qS,filter:GS,data:JS,enter:jS,exit:eb,join:tb,merge:nb,selection:aC,order:ib,sort:rb,call:ob,nodes:ab,node:lb,size:cb,empty:ub,each:hb,attr:yb,style:Ib,property:Tb,classed:Mb,text:Ob,html:Fb,raise:Bb,lower:zb,append:Wb,insert:qb,remove:jb,clone:Xb,datum:Qb,on:nC,dispatch:sC,[Symbol.iterator]:oC};function Ie(t){return typeof t=="string"?new We([[document.querySelector(t)]],[document.documentElement]):new We([[t]],Hg)}function zg(t){let e;for(;e=t.sourceEvent;)t=e;return t}function ft(t,e){if(t=zg(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}function lC(t,e){return t.target&&(t=zg(t),e===void 0&&(e=t.currentTarget),t=t.touches||[t]),Array.from(t,n=>ft(n,e))}const cC={passive:!1},pr={capture:!0,passive:!1};function ya(t){t.stopImmediatePropagation()}function ei(t){t.preventDefault(),t.stopImmediatePropagation()}function Wg(t){var e=t.document.documentElement,n=Ie(t).on("dragstart.drag",ei,pr);"onselectstart"in e?n.on("selectstart.drag",ei,pr):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Vg(t,e){var n=t.document.documentElement,i=Ie(t).on("dragstart.drag",null);e&&(i.on("click.drag",ei,pr),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const qr=t=>()=>t;function tl(t,{sourceEvent:e,subject:n,target:i,identifier:r,active:s,x:o,y:a,dx:l,dy:c,dispatch:h}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:h}})}tl.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function uC(t){return!t.ctrlKey&&!t.button}function hC(){return this.parentNode}function fC(t,e){return e??{x:t.x,y:t.y}}function dC(){return navigator.maxTouchPoints||"ontouchstart"in this}function pC(){var t=uC,e=hC,n=fC,i=dC,r={},s=Wo("start","drag","end"),o=0,a,l,c,h,u=0;function f(k){k.on("mousedown.drag",d).filter(i).on("touchstart.drag",N).on("touchmove.drag",x,cC).on("touchend.drag touchcancel.drag",A).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function d(k,R){if(!(h||!t.call(this,k,R))){var O=P(this,e.call(this,k,R),k,R,"mouse");O&&(Ie(k.view).on("mousemove.drag",w,pr).on("mouseup.drag",b,pr),Wg(k.view),ya(k),c=!1,a=k.clientX,l=k.clientY,O("start",k))}}function w(k){if(ei(k),!c){var R=k.clientX-a,O=k.clientY-l;c=R*R+O*O>u}r.mouse("drag",k)}function b(k){Ie(k.view).on("mousemove.drag mouseup.drag",null),Vg(k.view,c),ei(k),r.mouse("end",k)}function N(k,R){if(t.call(this,k,R)){var O=k.changedTouches,$=e.call(this,k,R),p=O.length,m,v;for(m=0;m<p;++m)(v=P(this,$,k,R,O[m].identifier,O[m]))&&(ya(k),v("start",k,O[m]))}}function x(k){var R=k.changedTouches,O=R.length,$,p;for($=0;$<O;++$)(p=r[R[$].identifier])&&(ei(k),p("drag",k,R[$]))}function A(k){var R=k.changedTouches,O=R.length,$,p;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),$=0;$<O;++$)(p=r[R[$].identifier])&&(ya(k),p("end",k,R[$]))}function P(k,R,O,$,p,m){var v=s.copy(),E=ft(m||O,R),S,T,y;if((y=n.call(k,new tl("beforestart",{sourceEvent:O,target:f,identifier:p,active:o,x:E[0],y:E[1],dx:0,dy:0,dispatch:v}),$))!=null)return S=y.x-E[0]||0,T=y.y-E[1]||0,function g(_,I,C){var M=E,D;switch(_){case"start":r[p]=g,D=o++;break;case"end":delete r[p],--o;case"drag":E=ft(C||I,R),D=o;break}v.call(_,k,new tl(_,{sourceEvent:I,subject:y,target:f,identifier:p,active:D,x:E[0]+S,y:E[1]+T,dx:E[0]-M[0],dy:E[1]-M[1],dispatch:v}),$)}}return f.filter=function(k){return arguments.length?(t=typeof k=="function"?k:qr(!!k),f):t},f.container=function(k){return arguments.length?(e=typeof k=="function"?k:qr(k),f):e},f.subject=function(k){return arguments.length?(n=typeof k=="function"?k:qr(k),f):n},f.touchable=function(k){return arguments.length?(i=typeof k=="function"?k:qr(!!k),f):i},f.on=function(){var k=s.on.apply(s,arguments);return k===s?f:k},f.clickDistance=function(k){return arguments.length?(u=(k=+k)*k,f):Math.sqrt(u)},f}function zc(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function qg(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function Dr(){}var gr=.7,js=1/gr,ti="\\s*([+-]?\\d+)\\s*",mr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",vt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",gC=/^#([0-9a-f]{3,8})$/,mC=new RegExp(`^rgb\\(${ti},${ti},${ti}\\)$`),_C=new RegExp(`^rgb\\(${vt},${vt},${vt}\\)$`),yC=new RegExp(`^rgba\\(${ti},${ti},${ti},${mr}\\)$`),vC=new RegExp(`^rgba\\(${vt},${vt},${vt},${mr}\\)$`),wC=new RegExp(`^hsl\\(${mr},${vt},${vt}\\)$`),EC=new RegExp(`^hsla\\(${mr},${vt},${vt},${mr}\\)$`),Wh={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};zc(Dr,_r,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Vh,formatHex:Vh,formatHex8:IC,formatHsl:SC,formatRgb:qh,toString:qh});function Vh(){return this.rgb().formatHex()}function IC(){return this.rgb().formatHex8()}function SC(){return Gg(this).formatHsl()}function qh(){return this.rgb().formatRgb()}function _r(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=gC.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Gh(e):n===3?new $e(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Gr(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Gr(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=mC.exec(t))?new $e(e[1],e[2],e[3],1):(e=_C.exec(t))?new $e(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=yC.exec(t))?Gr(e[1],e[2],e[3],e[4]):(e=vC.exec(t))?Gr(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=wC.exec(t))?Yh(e[1],e[2]/100,e[3]/100,1):(e=EC.exec(t))?Yh(e[1],e[2]/100,e[3]/100,e[4]):Wh.hasOwnProperty(t)?Gh(Wh[t]):t==="transparent"?new $e(NaN,NaN,NaN,0):null}function Gh(t){return new $e(t>>16&255,t>>8&255,t&255,1)}function Gr(t,e,n,i){return i<=0&&(t=e=n=NaN),new $e(t,e,n,i)}function bC(t){return t instanceof Dr||(t=_r(t)),t?(t=t.rgb(),new $e(t.r,t.g,t.b,t.opacity)):new $e}function nl(t,e,n,i){return arguments.length===1?bC(t):new $e(t,e,n,i??1)}function $e(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}zc($e,nl,qg(Dr,{brighter(t){return t=t==null?js:Math.pow(js,t),new $e(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?gr:Math.pow(gr,t),new $e(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new $e(Cn(this.r),Cn(this.g),Cn(this.b),Ks(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:jh,formatHex:jh,formatHex8:CC,formatRgb:Kh,toString:Kh}));function jh(){return`#${wn(this.r)}${wn(this.g)}${wn(this.b)}`}function CC(){return`#${wn(this.r)}${wn(this.g)}${wn(this.b)}${wn((isNaN(this.opacity)?1:this.opacity)*255)}`}function Kh(){const t=Ks(this.opacity);return`${t===1?"rgb(":"rgba("}${Cn(this.r)}, ${Cn(this.g)}, ${Cn(this.b)}${t===1?")":`, ${t})`}`}function Ks(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Cn(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function wn(t){return t=Cn(t),(t<16?"0":"")+t.toString(16)}function Yh(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new it(t,e,n,i)}function Gg(t){if(t instanceof it)return new it(t.h,t.s,t.l,t.opacity);if(t instanceof Dr||(t=_r(t)),!t)return new it;if(t instanceof it)return t;t=t.rgb();var e=t.r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),s=Math.max(e,n,i),o=NaN,a=s-r,l=(s+r)/2;return a?(e===s?o=(n-i)/a+(n<i)*6:n===s?o=(i-e)/a+2:o=(e-n)/a+4,a/=l<.5?s+r:2-s-r,o*=60):a=l>0&&l<1?0:o,new it(o,a,l,t.opacity)}function TC(t,e,n,i){return arguments.length===1?Gg(t):new it(t,e,n,i??1)}function it(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}zc(it,TC,qg(Dr,{brighter(t){return t=t==null?js:Math.pow(js,t),new it(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?gr:Math.pow(gr,t),new it(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new $e(va(t>=240?t-240:t+120,r,i),va(t,r,i),va(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new it(Xh(this.h),jr(this.s),jr(this.l),Ks(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Ks(this.opacity);return`${t===1?"hsl(":"hsla("}${Xh(this.h)}, ${jr(this.s)*100}%, ${jr(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Xh(t){return t=(t||0)%360,t<0?t+360:t}function jr(t){return Math.max(0,Math.min(1,t||0))}function va(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const jg=t=>()=>t;function AC(t,e){return function(n){return t+n*e}}function xC(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}function NC(t){return(t=+t)==1?Kg:function(e,n){return n-e?xC(e,n,t):jg(isNaN(e)?n:e)}}function Kg(t,e){var n=e-t;return n?AC(t,n):jg(isNaN(t)?e:t)}const Qh=(function t(e){var n=NC(e);function i(r,s){var o=n((r=nl(r)).r,(s=nl(s)).r),a=n(r.g,s.g),l=n(r.b,s.b),c=Kg(r.opacity,s.opacity);return function(h){return r.r=o(h),r.g=a(h),r.b=l(h),r.opacity=c(h),r+""}}return i.gamma=t,i})(1);function qt(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var il=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,wa=new RegExp(il.source,"g");function MC(t){return function(){return t}}function kC(t){return function(e){return t(e)+""}}function PC(t,e){var n=il.lastIndex=wa.lastIndex=0,i,r,s,o=-1,a=[],l=[];for(t=t+"",e=e+"";(i=il.exec(t))&&(r=wa.exec(e));)(s=r.index)>n&&(s=e.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(i=i[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,l.push({i:o,x:qt(i,r)})),n=wa.lastIndex;return n<e.length&&(s=e.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?kC(l[0].x):MC(e):(e=l.length,function(c){for(var h=0,u;h<e;++h)a[(u=l[h]).i]=u.x(c);return a.join("")})}var Jh=180/Math.PI,rl={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Yg(t,e,n,i,r,s){var o,a,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*n+e*i)&&(n-=t*l,i-=e*l),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,l/=a),t*i<e*n&&(t=-t,e=-e,l=-l,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(e,t)*Jh,skewX:Math.atan(l)*Jh,scaleX:o,scaleY:a}}var Kr;function RC(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?rl:Yg(e.a,e.b,e.c,e.d,e.e,e.f)}function OC(t){return t==null||(Kr||(Kr=document.createElementNS("http://www.w3.org/2000/svg","g")),Kr.setAttribute("transform",t),!(t=Kr.transform.baseVal.consolidate()))?rl:(t=t.matrix,Yg(t.a,t.b,t.c,t.d,t.e,t.f))}function Xg(t,e,n,i){function r(c){return c.length?c.pop()+" ":""}function s(c,h,u,f,d,w){if(c!==u||h!==f){var b=d.push("translate(",null,e,null,n);w.push({i:b-4,x:qt(c,u)},{i:b-2,x:qt(h,f)})}else(u||f)&&d.push("translate("+u+e+f+n)}function o(c,h,u,f){c!==h?(c-h>180?h+=360:h-c>180&&(c+=360),f.push({i:u.push(r(u)+"rotate(",null,i)-2,x:qt(c,h)})):h&&u.push(r(u)+"rotate("+h+i)}function a(c,h,u,f){c!==h?f.push({i:u.push(r(u)+"skewX(",null,i)-2,x:qt(c,h)}):h&&u.push(r(u)+"skewX("+h+i)}function l(c,h,u,f,d,w){if(c!==u||h!==f){var b=d.push(r(d)+"scale(",null,",",null,")");w.push({i:b-4,x:qt(c,u)},{i:b-2,x:qt(h,f)})}else(u!==1||f!==1)&&d.push(r(d)+"scale("+u+","+f+")")}return function(c,h){var u=[],f=[];return c=t(c),h=t(h),s(c.translateX,c.translateY,h.translateX,h.translateY,u,f),o(c.rotate,h.rotate,u,f),a(c.skewX,h.skewX,u,f),l(c.scaleX,c.scaleY,h.scaleX,h.scaleY,u,f),c=h=null,function(d){for(var w=-1,b=f.length,N;++w<b;)u[(N=f[w]).i]=N.x(d);return u.join("")}}}var DC=Xg(RC,"px, ","px)","deg)"),LC=Xg(OC,", ",")",")"),$C=1e-12;function Zh(t){return((t=Math.exp(t))+1/t)/2}function FC(t){return((t=Math.exp(t))-1/t)/2}function UC(t){return((t=Math.exp(2*t))-1)/(t+1)}const BC=(function t(e,n,i){function r(s,o){var a=s[0],l=s[1],c=s[2],h=o[0],u=o[1],f=o[2],d=h-a,w=u-l,b=d*d+w*w,N,x;if(b<$C)x=Math.log(f/c)/e,N=function($){return[a+$*d,l+$*w,c*Math.exp(e*$*x)]};else{var A=Math.sqrt(b),P=(f*f-c*c+i*b)/(2*c*n*A),k=(f*f-c*c-i*b)/(2*f*n*A),R=Math.log(Math.sqrt(P*P+1)-P),O=Math.log(Math.sqrt(k*k+1)-k);x=(O-R)/e,N=function($){var p=$*x,m=Zh(R),v=c/(n*A)*(m*UC(e*p+R)-FC(R));return[a+v*d,l+v*w,c*m/Zh(e*p+R)]}}return N.duration=x*1e3*e/Math.SQRT2,N}return r.rho=function(s){var o=Math.max(.001,+s),a=o*o,l=a*a;return t(o,a,l)},r})(Math.SQRT2,2,4);var ci=0,Li=0,Ri=0,Qg=1e3,Ys,$i,Xs=0,On=0,qo=0,yr=typeof performance=="object"&&performance.now?performance:Date,Jg=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Wc(){return On||(Jg(HC),On=yr.now()+qo)}function HC(){On=0}function Qs(){this._call=this._time=this._next=null}Qs.prototype=Zg.prototype={constructor:Qs,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Wc():+n)+(e==null?0:+e),!this._next&&$i!==this&&($i?$i._next=this:Ys=this,$i=this),this._call=t,this._time=n,sl()},stop:function(){this._call&&(this._call=null,this._time=1/0,sl())}};function Zg(t,e,n){var i=new Qs;return i.restart(t,e,n),i}function zC(){Wc(),++ci;for(var t=Ys,e;t;)(e=On-t._time)>=0&&t._call.call(void 0,e),t=t._next;--ci}function ef(){On=(Xs=yr.now())+qo,ci=Li=0;try{zC()}finally{ci=0,VC(),On=0}}function WC(){var t=yr.now(),e=t-Xs;e>Qg&&(qo-=e,Xs=t)}function VC(){for(var t,e=Ys,n,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Ys=n);$i=t,sl(i)}function sl(t){if(!ci){Li&&(Li=clearTimeout(Li));var e=t-On;e>24?(t<1/0&&(Li=setTimeout(ef,t-yr.now()-qo)),Ri&&(Ri=clearInterval(Ri))):(Ri||(Xs=yr.now(),Ri=setInterval(WC,Qg)),ci=1,Jg(ef))}}function tf(t,e,n){var i=new Qs;return e=e==null?0:+e,i.restart(r=>{i.stop(),t(r+e)},e,n),i}var qC=Wo("start","end","cancel","interrupt"),GC=[],em=0,nf=1,ol=2,ds=3,rf=4,al=5,ps=6;function Go(t,e,n,i,r,s){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;jC(t,n,{name:e,index:i,group:r,on:qC,tween:GC,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:em})}function Vc(t,e){var n=ut(t,e);if(n.state>em)throw new Error("too late; already scheduled");return n}function It(t,e){var n=ut(t,e);if(n.state>ds)throw new Error("too late; already running");return n}function ut(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function jC(t,e,n){var i=t.__transition,r;i[e]=n,n.timer=Zg(s,0,n.time);function s(c){n.state=nf,n.timer.restart(o,n.delay,n.time),n.delay<=c&&o(c-n.delay)}function o(c){var h,u,f,d;if(n.state!==nf)return l();for(h in i)if(d=i[h],d.name===n.name){if(d.state===ds)return tf(o);d.state===rf?(d.state=ps,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete i[h]):+h<e&&(d.state=ps,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete i[h])}if(tf(function(){n.state===ds&&(n.state=rf,n.timer.restart(a,n.delay,n.time),a(c))}),n.state=ol,n.on.call("start",t,t.__data__,n.index,n.group),n.state===ol){for(n.state=ds,r=new Array(f=n.tween.length),h=0,u=-1;h<f;++h)(d=n.tween[h].value.call(t,t.__data__,n.index,n.group))&&(r[++u]=d);r.length=u+1}}function a(c){for(var h=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(l),n.state=al,1),u=-1,f=r.length;++u<f;)r[u].call(t,h);n.state===al&&(n.on.call("end",t,t.__data__,n.index,n.group),l())}function l(){n.state=ps,n.timer.stop(),delete i[e];for(var c in i)return;delete t.__transition}}function gs(t,e){var n=t.__transition,i,r,s=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((i=n[o]).name!==e){s=!1;continue}r=i.state>ol&&i.state<al,i.state=ps,i.timer.stop(),i.on.call(r?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete n[o]}s&&delete t.__transition}}function KC(t){return this.each(function(){gs(this,t)})}function YC(t,e){var n,i;return function(){var r=It(this,t),s=r.tween;if(s!==n){i=n=s;for(var o=0,a=i.length;o<a;++o)if(i[o].name===e){i=i.slice(),i.splice(o,1);break}}r.tween=i}}function XC(t,e,n){var i,r;if(typeof n!="function")throw new Error;return function(){var s=It(this,t),o=s.tween;if(o!==i){r=(i=o).slice();for(var a={name:e,value:n},l=0,c=r.length;l<c;++l)if(r[l].name===e){r[l]=a;break}l===c&&r.push(a)}s.tween=r}}function QC(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i=ut(this.node(),n).tween,r=0,s=i.length,o;r<s;++r)if((o=i[r]).name===t)return o.value;return null}return this.each((e==null?YC:XC)(n,t,e))}function qc(t,e,n){var i=t._id;return t.each(function(){var r=It(this,i);(r.value||(r.value={}))[e]=n.apply(this,arguments)}),function(r){return ut(r,i).value[e]}}function tm(t,e){var n;return(typeof e=="number"?qt:e instanceof _r?Qh:(n=_r(e))?(e=n,Qh):PC)(t,e)}function JC(t){return function(){this.removeAttribute(t)}}function ZC(t){return function(){this.removeAttributeNS(t.space,t.local)}}function eT(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttribute(t);return o===r?null:o===i?s:s=e(i=o,n)}}function tT(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttributeNS(t.space,t.local);return o===r?null:o===i?s:s=e(i=o,n)}}function nT(t,e,n){var i,r,s;return function(){var o,a=n(this),l;return a==null?void this.removeAttribute(t):(o=this.getAttribute(t),l=a+"",o===l?null:o===i&&l===r?s:(r=l,s=e(i=o,a)))}}function iT(t,e,n){var i,r,s;return function(){var o,a=n(this),l;return a==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),l=a+"",o===l?null:o===i&&l===r?s:(r=l,s=e(i=o,a)))}}function rT(t,e){var n=Vo(t),i=n==="transform"?LC:tm;return this.attrTween(t,typeof e=="function"?(n.local?iT:nT)(n,i,qc(this,"attr."+t,e)):e==null?(n.local?ZC:JC)(n):(n.local?tT:eT)(n,i,e))}function sT(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function oT(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function aT(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&oT(t,s)),n}return r._value=e,r}function lT(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&sT(t,s)),n}return r._value=e,r}function cT(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var i=Vo(t);return this.tween(n,(i.local?aT:lT)(i,e))}function uT(t,e){return function(){Vc(this,t).delay=+e.apply(this,arguments)}}function hT(t,e){return e=+e,function(){Vc(this,t).delay=e}}function fT(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?uT:hT)(e,t)):ut(this.node(),e).delay}function dT(t,e){return function(){It(this,t).duration=+e.apply(this,arguments)}}function pT(t,e){return e=+e,function(){It(this,t).duration=e}}function gT(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?dT:pT)(e,t)):ut(this.node(),e).duration}function mT(t,e){if(typeof e!="function")throw new Error;return function(){It(this,t).ease=e}}function _T(t){var e=this._id;return arguments.length?this.each(mT(e,t)):ut(this.node(),e).ease}function yT(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;It(this,t).ease=n}}function vT(t){if(typeof t!="function")throw new Error;return this.each(yT(this._id,t))}function wT(t){typeof t!="function"&&(t=Pg(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,a=i[r]=[],l,c=0;c<o;++c)(l=s[c])&&t.call(l,l.__data__,c,s)&&a.push(l);return new $t(i,this._parents,this._name,this._id)}function ET(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,s=Math.min(i,r),o=new Array(i),a=0;a<s;++a)for(var l=e[a],c=n[a],h=l.length,u=o[a]=new Array(h),f,d=0;d<h;++d)(f=l[d]||c[d])&&(u[d]=f);for(;a<i;++a)o[a]=e[a];return new $t(o,this._parents,this._name,this._id)}function IT(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function ST(t,e,n){var i,r,s=IT(e)?Vc:It;return function(){var o=s(this,t),a=o.on;a!==i&&(r=(i=a).copy()).on(e,n),o.on=r}}function bT(t,e){var n=this._id;return arguments.length<2?ut(this.node(),n).on.on(t):this.each(ST(n,t,e))}function CT(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function TT(){return this.on("end.remove",CT(this._id))}function AT(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Bc(t));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var a=i[o],l=a.length,c=s[o]=new Array(l),h,u,f=0;f<l;++f)(h=a[f])&&(u=t.call(h,h.__data__,f,a))&&("__data__"in h&&(u.__data__=h.__data__),c[f]=u,Go(c[f],e,n,f,c,ut(h,n)));return new $t(s,this._parents,e,n)}function xT(t){var e=this._name,n=this._id;typeof t!="function"&&(t=kg(t));for(var i=this._groups,r=i.length,s=[],o=[],a=0;a<r;++a)for(var l=i[a],c=l.length,h,u=0;u<c;++u)if(h=l[u]){for(var f=t.call(h,h.__data__,u,l),d,w=ut(h,n),b=0,N=f.length;b<N;++b)(d=f[b])&&Go(d,e,n,b,f,w);s.push(f),o.push(h)}return new $t(s,o,e,n)}var NT=Or.prototype.constructor;function MT(){return new NT(this._groups,this._parents)}function kT(t,e){var n,i,r;return function(){var s=li(this,t),o=(this.style.removeProperty(t),li(this,t));return s===o?null:s===n&&o===i?r:r=e(n=s,i=o)}}function nm(t){return function(){this.style.removeProperty(t)}}function PT(t,e,n){var i,r=n+"",s;return function(){var o=li(this,t);return o===r?null:o===i?s:s=e(i=o,n)}}function RT(t,e,n){var i,r,s;return function(){var o=li(this,t),a=n(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(t),li(this,t))),o===l?null:o===i&&l===r?s:(r=l,s=e(i=o,a))}}function OT(t,e){var n,i,r,s="style."+e,o="end."+s,a;return function(){var l=It(this,t),c=l.on,h=l.value[s]==null?a||(a=nm(e)):void 0;(c!==n||r!==h)&&(i=(n=c).copy()).on(o,r=h),l.on=i}}function DT(t,e,n){var i=(t+="")=="transform"?DC:tm;return e==null?this.styleTween(t,kT(t,i)).on("end.style."+t,nm(t)):typeof e=="function"?this.styleTween(t,RT(t,i,qc(this,"style."+t,e))).each(OT(this._id,t)):this.styleTween(t,PT(t,i,e),n).on("end.style."+t,null)}function LT(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function $T(t,e,n){var i,r;function s(){var o=e.apply(this,arguments);return o!==r&&(i=(r=o)&&LT(t,o,n)),i}return s._value=e,s}function FT(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,$T(t,e,n??""))}function UT(t){return function(){this.textContent=t}}function BT(t){return function(){var e=t(this);this.textContent=e??""}}function HT(t){return this.tween("text",typeof t=="function"?BT(qc(this,"text",t)):UT(t==null?"":t+""))}function zT(t){return function(e){this.textContent=t.call(this,e)}}function WT(t){var e,n;function i(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&zT(r)),e}return i._value=t,i}function VT(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,WT(t))}function qT(){for(var t=this._name,e=this._id,n=im(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],a=o.length,l,c=0;c<a;++c)if(l=o[c]){var h=ut(l,e);Go(l,t,n,c,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new $t(i,this._parents,t,n)}function GT(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(s,o){var a={value:o},l={value:function(){--r===0&&s()}};n.each(function(){var c=It(this,i),h=c.on;h!==t&&(e=(t=h).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),c.on=e}),r===0&&s()})}var jT=0;function $t(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function im(){return++jT}var Ct=Or.prototype;$t.prototype={constructor:$t,select:AT,selectAll:xT,selectChild:Ct.selectChild,selectChildren:Ct.selectChildren,filter:wT,merge:ET,selection:MT,transition:qT,call:Ct.call,nodes:Ct.nodes,node:Ct.node,size:Ct.size,empty:Ct.empty,each:Ct.each,on:bT,attr:rT,attrTween:cT,style:DT,styleTween:FT,text:HT,textTween:VT,remove:TT,tween:QC,delay:fT,duration:gT,ease:_T,easeVarying:vT,end:GT,[Symbol.iterator]:Ct[Symbol.iterator]};function KT(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var YT={time:null,delay:0,duration:250,ease:KT};function XT(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function QT(t){var e,n;t instanceof $t?(e=t._id,t=t._name):(e=im(),(n=YT).time=Wc(),t=t==null?null:t+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],a=o.length,l,c=0;c<a;++c)(l=o[c])&&Go(l,t,e,c,o,n||XT(l,e));return new $t(i,this._parents,t,e)}Or.prototype.interrupt=KC;Or.prototype.transition=QT;const Pt=11102230246251565e-32,Se=134217729,JT=(3+8*Pt)*Pt;function Ea(t,e,n,i,r){let s,o,a,l,c=e[0],h=i[0],u=0,f=0;h>c==h>-c?(s=c,c=e[++u]):(s=h,h=i[++f]);let d=0;if(u<t&&f<n)for(h>c==h>-c?(o=c+s,a=s-(o-c),c=e[++u]):(o=h+s,a=s-(o-h),h=i[++f]),s=o,a!==0&&(r[d++]=a);u<t&&f<n;)h>c==h>-c?(o=s+c,l=o-s,a=s-(o-l)+(c-l),c=e[++u]):(o=s+h,l=o-s,a=s-(o-l)+(h-l),h=i[++f]),s=o,a!==0&&(r[d++]=a);for(;u<t;)o=s+c,l=o-s,a=s-(o-l)+(c-l),c=e[++u],s=o,a!==0&&(r[d++]=a);for(;f<n;)o=s+h,l=o-s,a=s-(o-l)+(h-l),h=i[++f],s=o,a!==0&&(r[d++]=a);return(s!==0||d===0)&&(r[d++]=s),d}function ZT(t,e){let n=e[0];for(let i=1;i<t;i++)n+=e[i];return n}function Lr(t){return new Float64Array(t)}const eA=(3+16*Pt)*Pt,tA=(2+12*Pt)*Pt,nA=(9+64*Pt)*Pt*Pt,Un=Lr(4),sf=Lr(8),of=Lr(12),af=Lr(16),Ae=Lr(4);function iA(t,e,n,i,r,s,o){let a,l,c,h,u,f,d,w,b,N,x,A,P,k,R,O,$,p;const m=t-r,v=n-r,E=e-s,S=i-s;k=m*S,f=Se*m,d=f-(f-m),w=m-d,f=Se*S,b=f-(f-S),N=S-b,R=w*N-(k-d*b-w*b-d*N),O=E*v,f=Se*E,d=f-(f-E),w=E-d,f=Se*v,b=f-(f-v),N=v-b,$=w*N-(O-d*b-w*b-d*N),x=R-$,u=R-x,Un[0]=R-(x+u)+(u-$),A=k+x,u=A-k,P=k-(A-u)+(x-u),x=P-O,u=P-x,Un[1]=P-(x+u)+(u-O),p=A+x,u=p-A,Un[2]=A-(p-u)+(x-u),Un[3]=p;let T=ZT(4,Un),y=tA*o;if(T>=y||-T>=y||(u=t-m,a=t-(m+u)+(u-r),u=n-v,c=n-(v+u)+(u-r),u=e-E,l=e-(E+u)+(u-s),u=i-S,h=i-(S+u)+(u-s),a===0&&l===0&&c===0&&h===0)||(y=nA*o+JT*Math.abs(T),T+=m*h+S*a-(E*c+v*l),T>=y||-T>=y))return T;k=a*S,f=Se*a,d=f-(f-a),w=a-d,f=Se*S,b=f-(f-S),N=S-b,R=w*N-(k-d*b-w*b-d*N),O=l*v,f=Se*l,d=f-(f-l),w=l-d,f=Se*v,b=f-(f-v),N=v-b,$=w*N-(O-d*b-w*b-d*N),x=R-$,u=R-x,Ae[0]=R-(x+u)+(u-$),A=k+x,u=A-k,P=k-(A-u)+(x-u),x=P-O,u=P-x,Ae[1]=P-(x+u)+(u-O),p=A+x,u=p-A,Ae[2]=A-(p-u)+(x-u),Ae[3]=p;const g=Ea(4,Un,4,Ae,sf);k=m*h,f=Se*m,d=f-(f-m),w=m-d,f=Se*h,b=f-(f-h),N=h-b,R=w*N-(k-d*b-w*b-d*N),O=E*c,f=Se*E,d=f-(f-E),w=E-d,f=Se*c,b=f-(f-c),N=c-b,$=w*N-(O-d*b-w*b-d*N),x=R-$,u=R-x,Ae[0]=R-(x+u)+(u-$),A=k+x,u=A-k,P=k-(A-u)+(x-u),x=P-O,u=P-x,Ae[1]=P-(x+u)+(u-O),p=A+x,u=p-A,Ae[2]=A-(p-u)+(x-u),Ae[3]=p;const _=Ea(g,sf,4,Ae,of);k=a*h,f=Se*a,d=f-(f-a),w=a-d,f=Se*h,b=f-(f-h),N=h-b,R=w*N-(k-d*b-w*b-d*N),O=l*c,f=Se*l,d=f-(f-l),w=l-d,f=Se*c,b=f-(f-c),N=c-b,$=w*N-(O-d*b-w*b-d*N),x=R-$,u=R-x,Ae[0]=R-(x+u)+(u-$),A=k+x,u=A-k,P=k-(A-u)+(x-u),x=P-O,u=P-x,Ae[1]=P-(x+u)+(u-O),p=A+x,u=p-A,Ae[2]=A-(p-u)+(x-u),Ae[3]=p;const I=Ea(_,of,4,Ae,af);return af[I-1]}function Yr(t,e,n,i,r,s){const o=(e-s)*(n-r),a=(t-r)*(i-s),l=o-a,c=Math.abs(o+a);return Math.abs(l)>=eA*c?l:-iA(t,e,n,i,r,s,c)}const lf=Math.pow(2,-52),Xr=new Uint32Array(512);class Js{static from(e,n=lA,i=cA){const r=e.length,s=new Float64Array(r*2);for(let o=0;o<r;o++){const a=e[o];s[2*o]=n(a),s[2*o+1]=i(a)}return new Js(s)}constructor(e){const n=e.length>>1;if(n>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const i=Math.max(2*n-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:e,_hullPrev:n,_hullNext:i,_hullTri:r,_hullHash:s}=this,o=e.length>>1;let a=1/0,l=1/0,c=-1/0,h=-1/0;for(let m=0;m<o;m++){const v=e[2*m],E=e[2*m+1];v<a&&(a=v),E<l&&(l=E),v>c&&(c=v),E>h&&(h=E),this._ids[m]=m}const u=(a+c)/2,f=(l+h)/2;let d,w,b;for(let m=0,v=1/0;m<o;m++){const E=Ia(u,f,e[2*m],e[2*m+1]);E<v&&(d=m,v=E)}const N=e[2*d],x=e[2*d+1];for(let m=0,v=1/0;m<o;m++){if(m===d)continue;const E=Ia(N,x,e[2*m],e[2*m+1]);E<v&&E>0&&(w=m,v=E)}let A=e[2*w],P=e[2*w+1],k=1/0;for(let m=0;m<o;m++){if(m===d||m===w)continue;const v=oA(N,x,A,P,e[2*m],e[2*m+1]);v<k&&(b=m,k=v)}let R=e[2*b],O=e[2*b+1];if(k===1/0){for(let E=0;E<o;E++)this._dists[E]=e[2*E]-e[0]||e[2*E+1]-e[1];jn(this._ids,this._dists,0,o-1);const m=new Uint32Array(o);let v=0;for(let E=0,S=-1/0;E<o;E++){const T=this._ids[E],y=this._dists[T];y>S&&(m[v++]=T,S=y)}this.hull=m.subarray(0,v),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(Yr(N,x,A,P,R,O)<0){const m=w,v=A,E=P;w=b,A=R,P=O,b=m,R=v,O=E}const $=aA(N,x,A,P,R,O);this._cx=$.x,this._cy=$.y;for(let m=0;m<o;m++)this._dists[m]=Ia(e[2*m],e[2*m+1],$.x,$.y);jn(this._ids,this._dists,0,o-1),this._hullStart=d;let p=3;i[d]=n[b]=w,i[w]=n[d]=b,i[b]=n[w]=d,r[d]=0,r[w]=1,r[b]=2,s.fill(-1),s[this._hashKey(N,x)]=d,s[this._hashKey(A,P)]=w,s[this._hashKey(R,O)]=b,this.trianglesLen=0,this._addTriangle(d,w,b,-1,-1,-1);for(let m=0,v,E;m<this._ids.length;m++){const S=this._ids[m],T=e[2*S],y=e[2*S+1];if(m>0&&Math.abs(T-v)<=lf&&Math.abs(y-E)<=lf||(v=T,E=y,S===d||S===w||S===b))continue;let g=0;for(let D=0,L=this._hashKey(T,y);D<this._hashSize&&(g=s[(L+D)%this._hashSize],!(g!==-1&&g!==i[g]));D++);g=n[g];let _=g,I;for(;I=i[_],Yr(T,y,e[2*_],e[2*_+1],e[2*I],e[2*I+1])>=0;)if(_=I,_===g){_=-1;break}if(_===-1)continue;let C=this._addTriangle(_,S,i[_],-1,-1,r[_]);r[S]=this._legalize(C+2),r[_]=C,p++;let M=i[_];for(;I=i[M],Yr(T,y,e[2*M],e[2*M+1],e[2*I],e[2*I+1])<0;)C=this._addTriangle(M,S,I,r[S],-1,r[M]),r[S]=this._legalize(C+2),i[M]=M,p--,M=I;if(_===g)for(;I=n[_],Yr(T,y,e[2*I],e[2*I+1],e[2*_],e[2*_+1])<0;)C=this._addTriangle(I,S,_,-1,r[_],r[I]),this._legalize(C+2),r[I]=C,i[_]=_,p--,_=I;this._hullStart=n[S]=_,i[_]=n[M]=S,i[S]=M,s[this._hashKey(T,y)]=S,s[this._hashKey(e[2*_],e[2*_+1])]=_}this.hull=new Uint32Array(p);for(let m=0,v=this._hullStart;m<p;m++)this.hull[m]=v,v=i[v];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,n){return Math.floor(rA(e-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:n,_halfedges:i,coords:r}=this;let s=0,o=0;for(;;){const a=i[e],l=e-e%3;if(o=l+(e+2)%3,a===-1){if(s===0)break;e=Xr[--s];continue}const c=a-a%3,h=l+(e+1)%3,u=c+(a+2)%3,f=n[o],d=n[e],w=n[h],b=n[u];if(sA(r[2*f],r[2*f+1],r[2*d],r[2*d+1],r[2*w],r[2*w+1],r[2*b],r[2*b+1])){n[e]=b,n[a]=f;const x=i[u];if(x===-1){let P=this._hullStart;do{if(this._hullTri[P]===u){this._hullTri[P]=e;break}P=this._hullPrev[P]}while(P!==this._hullStart)}this._link(e,x),this._link(a,i[o]),this._link(o,u);const A=c+(a+1)%3;s<Xr.length&&(Xr[s++]=A)}else{if(s===0)break;e=Xr[--s]}}return o}_link(e,n){this._halfedges[e]=n,n!==-1&&(this._halfedges[n]=e)}_addTriangle(e,n,i,r,s,o){const a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=n,this._triangles[a+2]=i,this._link(a,r),this._link(a+1,s),this._link(a+2,o),this.trianglesLen+=3,a}}function rA(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}function Ia(t,e,n,i){const r=t-n,s=e-i;return r*r+s*s}function sA(t,e,n,i,r,s,o,a){const l=t-o,c=e-a,h=n-o,u=i-a,f=r-o,d=s-a,w=l*l+c*c,b=h*h+u*u,N=f*f+d*d;return l*(u*N-b*d)-c*(h*N-b*f)+w*(h*d-u*f)<0}function oA(t,e,n,i,r,s){const o=n-t,a=i-e,l=r-t,c=s-e,h=o*o+a*a,u=l*l+c*c,f=.5/(o*c-a*l),d=(c*h-a*u)*f,w=(o*u-l*h)*f;return d*d+w*w}function aA(t,e,n,i,r,s){const o=n-t,a=i-e,l=r-t,c=s-e,h=o*o+a*a,u=l*l+c*c,f=.5/(o*c-a*l),d=t+(c*h-a*u)*f,w=e+(o*u-l*h)*f;return{x:d,y:w}}function jn(t,e,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){const s=t[r],o=e[s];let a=r-1;for(;a>=n&&e[t[a]]>o;)t[a+1]=t[a--];t[a+1]=s}else{const r=n+i>>1;let s=n+1,o=i;Oi(t,r,s),e[t[n]]>e[t[i]]&&Oi(t,n,i),e[t[s]]>e[t[i]]&&Oi(t,s,i),e[t[n]]>e[t[s]]&&Oi(t,n,s);const a=t[s],l=e[a];for(;;){do s++;while(e[t[s]]<l);do o--;while(e[t[o]]>l);if(o<s)break;Oi(t,s,o)}t[n+1]=t[o],t[o]=a,i-s+1>=o-n?(jn(t,e,s,i),jn(t,e,n,o-1)):(jn(t,e,n,o-1),jn(t,e,s,i))}}function Oi(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function lA(t){return t[0]}function cA(t){return t[1]}const cf=1e-6;class En{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,n){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,n){this._+=`L${this._x1=+e},${this._y1=+n}`}arc(e,n,i){e=+e,n=+n,i=+i;const r=e+i,s=n;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${r},${s}`:(Math.abs(this._x1-r)>cf||Math.abs(this._y1-s)>cf)&&(this._+="L"+r+","+s),i&&(this._+=`A${i},${i},0,1,1,${e-i},${n}A${i},${i},0,1,1,${this._x1=r},${this._y1=s}`)}rect(e,n,i,r){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${+i}v${+r}h${-i}Z`}value(){return this._||null}}class ll{constructor(){this._=[]}moveTo(e,n){this._.push([e,n])}closePath(){this._.push(this._[0].slice())}lineTo(e,n){this._.push([e,n])}value(){return this._.length?this._:null}}class uA{constructor(e,[n,i,r,s]=[0,0,960,500]){if(!((r=+r)>=(n=+n))||!((s=+s)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(e.points.length*2),this.vectors=new Float64Array(e.points.length*2),this.xmax=r,this.xmin=n,this.ymax=s,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:n,triangles:i},vectors:r}=this;let s,o;const a=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let b=0,N=0,x=i.length,A,P;b<x;b+=3,N+=2){const k=i[b]*2,R=i[b+1]*2,O=i[b+2]*2,$=e[k],p=e[k+1],m=e[R],v=e[R+1],E=e[O],S=e[O+1],T=m-$,y=v-p,g=E-$,_=S-p,I=(T*_-y*g)*2;if(Math.abs(I)<1e-9){if(s===void 0){s=o=0;for(const M of n)s+=e[M*2],o+=e[M*2+1];s/=n.length,o/=n.length}const C=1e9*Math.sign((s-$)*_-(o-p)*g);A=($+E)/2-C*_,P=(p+S)/2+C*g}else{const C=1/I,M=T*T+y*y,D=g*g+_*_;A=$+(_*M-y*D)*C,P=p+(T*D-g*M)*C}a[N]=A,a[N+1]=P}let l=n[n.length-1],c,h=l*4,u,f=e[2*l],d,w=e[2*l+1];r.fill(0);for(let b=0;b<n.length;++b)l=n[b],c=h,u=f,d=w,h=l*4,f=e[2*l],w=e[2*l+1],r[c+2]=r[h]=d-w,r[c+3]=r[h+1]=f-u}render(e){const n=e==null?e=new En:void 0,{delaunay:{halfedges:i,inedges:r,hull:s},circumcenters:o,vectors:a}=this;if(s.length<=1)return null;for(let h=0,u=i.length;h<u;++h){const f=i[h];if(f<h)continue;const d=Math.floor(h/3)*2,w=Math.floor(f/3)*2,b=o[d],N=o[d+1],x=o[w],A=o[w+1];this._renderSegment(b,N,x,A,e)}let l,c=s[s.length-1];for(let h=0;h<s.length;++h){l=c,c=s[h];const u=Math.floor(r[c]/3)*2,f=o[u],d=o[u+1],w=l*4,b=this._project(f,d,a[w+2],a[w+3]);b&&this._renderSegment(f,d,b[0],b[1],e)}return n&&n.value()}renderBounds(e){const n=e==null?e=new En:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(e,n){const i=n==null?n=new En:void 0,r=this._clip(e);if(r===null||!r.length)return;n.moveTo(r[0],r[1]);let s=r.length;for(;r[0]===r[s-2]&&r[1]===r[s-1]&&s>1;)s-=2;for(let o=2;o<s;o+=2)(r[o]!==r[o-2]||r[o+1]!==r[o-1])&&n.lineTo(r[o],r[o+1]);return n.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let n=0,i=e.length/2;n<i;++n){const r=this.cellPolygon(n);r&&(r.index=n,yield r)}}cellPolygon(e){const n=new ll;return this.renderCell(e,n),n.value()}_renderSegment(e,n,i,r,s){let o;const a=this._regioncode(e,n),l=this._regioncode(i,r);a===0&&l===0?(s.moveTo(e,n),s.lineTo(i,r)):(o=this._clipSegment(e,n,i,r,a,l))&&(s.moveTo(o[0],o[1]),s.lineTo(o[2],o[3]))}contains(e,n,i){return n=+n,n!==n||(i=+i,i!==i)?!1:this.delaunay._step(e,n,i)===e}*neighbors(e){const n=this._clip(e);if(n)for(const i of this.delaunay.neighbors(e)){const r=this._clip(i);if(r){e:for(let s=0,o=n.length;s<o;s+=2)for(let a=0,l=r.length;a<l;a+=2)if(n[s]===r[a]&&n[s+1]===r[a+1]&&n[(s+2)%o]===r[(a+l-2)%l]&&n[(s+3)%o]===r[(a+l-1)%l]){yield i;break e}}}}_cell(e){const{circumcenters:n,delaunay:{inedges:i,halfedges:r,triangles:s}}=this,o=i[e];if(o===-1)return null;const a=[];let l=o;do{const c=Math.floor(l/3);if(a.push(n[c*2],n[c*2+1]),l=l%3===2?l-2:l+1,s[l]!==e)break;l=r[l]}while(l!==o&&l!==-1);return a}_clip(e){if(e===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(e);if(n===null)return null;const{vectors:i}=this,r=e*4;return this._simplify(i[r]||i[r+1]?this._clipInfinite(e,n,i[r],i[r+1],i[r+2],i[r+3]):this._clipFinite(e,n))}_clipFinite(e,n){const i=n.length;let r=null,s,o,a=n[i-2],l=n[i-1],c,h=this._regioncode(a,l),u,f=0;for(let d=0;d<i;d+=2)if(s=a,o=l,a=n[d],l=n[d+1],c=h,h=this._regioncode(a,l),c===0&&h===0)u=f,f=0,r?r.push(a,l):r=[a,l];else{let w,b,N,x,A;if(c===0){if((w=this._clipSegment(s,o,a,l,c,h))===null)continue;[b,N,x,A]=w}else{if((w=this._clipSegment(a,l,s,o,h,c))===null)continue;[x,A,b,N]=w,u=f,f=this._edgecode(b,N),u&&f&&this._edge(e,u,f,r,r.length),r?r.push(b,N):r=[b,N]}u=f,f=this._edgecode(x,A),u&&f&&this._edge(e,u,f,r,r.length),r?r.push(x,A):r=[x,A]}if(r)u=f,f=this._edgecode(r[0],r[1]),u&&f&&this._edge(e,u,f,r,r.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return r}_clipSegment(e,n,i,r,s,o){const a=s<o;for(a&&([e,n,i,r,s,o]=[i,r,e,n,o,s]);;){if(s===0&&o===0)return a?[i,r,e,n]:[e,n,i,r];if(s&o)return null;let l,c,h=s||o;h&8?(l=e+(i-e)*(this.ymax-n)/(r-n),c=this.ymax):h&4?(l=e+(i-e)*(this.ymin-n)/(r-n),c=this.ymin):h&2?(c=n+(r-n)*(this.xmax-e)/(i-e),l=this.xmax):(c=n+(r-n)*(this.xmin-e)/(i-e),l=this.xmin),s?(e=l,n=c,s=this._regioncode(e,n)):(i=l,r=c,o=this._regioncode(i,r))}}_clipInfinite(e,n,i,r,s,o){let a=Array.from(n),l;if((l=this._project(a[0],a[1],i,r))&&a.unshift(l[0],l[1]),(l=this._project(a[a.length-2],a[a.length-1],s,o))&&a.push(l[0],l[1]),a=this._clipFinite(e,a))for(let c=0,h=a.length,u,f=this._edgecode(a[h-2],a[h-1]);c<h;c+=2)u=f,f=this._edgecode(a[c],a[c+1]),u&&f&&(c=this._edge(e,u,f,a,c),h=a.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(e,n,i,r,s){for(;n!==i;){let o,a;switch(n){case 5:n=4;continue;case 4:n=6,o=this.xmax,a=this.ymin;break;case 6:n=2;continue;case 2:n=10,o=this.xmax,a=this.ymax;break;case 10:n=8;continue;case 8:n=9,o=this.xmin,a=this.ymax;break;case 9:n=1;continue;case 1:n=5,o=this.xmin,a=this.ymin;break}(r[s]!==o||r[s+1]!==a)&&this.contains(e,o,a)&&(r.splice(s,0,o,a),s+=2)}return s}_project(e,n,i,r){let s=1/0,o,a,l;if(r<0){if(n<=this.ymin)return null;(o=(this.ymin-n)/r)<s&&(l=this.ymin,a=e+(s=o)*i)}else if(r>0){if(n>=this.ymax)return null;(o=(this.ymax-n)/r)<s&&(l=this.ymax,a=e+(s=o)*i)}if(i>0){if(e>=this.xmax)return null;(o=(this.xmax-e)/i)<s&&(a=this.xmax,l=n+(s=o)*r)}else if(i<0){if(e<=this.xmin)return null;(o=(this.xmin-e)/i)<s&&(a=this.xmin,l=n+(s=o)*r)}return[a,l]}_edgecode(e,n){return(e===this.xmin?1:e===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(e,n){return(e<this.xmin?1:e>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}_simplify(e){if(e&&e.length>4){for(let n=0;n<e.length;n+=2){const i=(n+2)%e.length,r=(n+4)%e.length;(e[n]===e[i]&&e[i]===e[r]||e[n+1]===e[i+1]&&e[i+1]===e[r+1])&&(e.splice(i,2),n-=2)}e.length||(e=null)}return e}}const hA=2*Math.PI,Bn=Math.pow;function fA(t){return t[0]}function dA(t){return t[1]}function pA(t){const{triangles:e,coords:n}=t;for(let i=0;i<e.length;i+=3){const r=2*e[i],s=2*e[i+1],o=2*e[i+2];if((n[o]-n[r])*(n[s+1]-n[r+1])-(n[s]-n[r])*(n[o+1]-n[r+1])>1e-10)return!1}return!0}function gA(t,e,n){return[t+Math.sin(t+e)*n,e+Math.cos(t-e)*n]}class Gc{static from(e,n=fA,i=dA,r){return new Gc("length"in e?mA(e,n,i,r):Float64Array.from(_A(e,n,i,r)))}constructor(e){this._delaunator=new Js(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,n=this.points;if(e.hull&&e.hull.length>2&&pA(e)){this.collinear=Int32Array.from({length:n.length/2},(f,d)=>d).sort((f,d)=>n[2*f]-n[2*d]||n[2*f+1]-n[2*d+1]);const l=this.collinear[0],c=this.collinear[this.collinear.length-1],h=[n[2*l],n[2*l+1],n[2*c],n[2*c+1]],u=1e-8*Math.hypot(h[3]-h[1],h[2]-h[0]);for(let f=0,d=n.length/2;f<d;++f){const w=gA(n[2*f],n[2*f+1],u);n[2*f]=w[0],n[2*f+1]=w[1]}this._delaunator=new Js(n)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let l=0,c=i.length;l<c;++l){const h=s[l%3===2?l-2:l+1];(i[l]===-1||o[h]===-1)&&(o[h]=l)}for(let l=0,c=r.length;l<c;++l)a[r[l]]=l;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],o[r[0]]=1,r.length===2&&(o[r[1]]=0,this.triangles[1]=r[1],this.triangles[2]=r[1]))}voronoi(e){return new uA(this,e)}*neighbors(e){const{inedges:n,hull:i,_hullIndex:r,halfedges:s,triangles:o,collinear:a}=this;if(a){const u=a.indexOf(e);u>0&&(yield a[u-1]),u<a.length-1&&(yield a[u+1]);return}const l=n[e];if(l===-1)return;let c=l,h=-1;do{if(yield h=o[c],c=c%3===2?c-2:c+1,o[c]!==e)return;if(c=s[c],c===-1){const u=i[(r[e]+1)%i.length];u!==h&&(yield u);return}}while(c!==l)}find(e,n,i=0){if(e=+e,e!==e||(n=+n,n!==n))return-1;const r=i;let s;for(;(s=this._step(i,e,n))>=0&&s!==i&&s!==r;)i=s;return s}_step(e,n,i){const{inedges:r,hull:s,_hullIndex:o,halfedges:a,triangles:l,points:c}=this;if(r[e]===-1||!c.length)return(e+1)%(c.length>>1);let h=e,u=Bn(n-c[e*2],2)+Bn(i-c[e*2+1],2);const f=r[e];let d=f;do{let w=l[d];const b=Bn(n-c[w*2],2)+Bn(i-c[w*2+1],2);if(b<u&&(u=b,h=w),d=d%3===2?d-2:d+1,l[d]!==e)break;if(d=a[d],d===-1){if(d=s[(o[e]+1)%s.length],d!==w&&Bn(n-c[d*2],2)+Bn(i-c[d*2+1],2)<u)return d;break}}while(d!==f);return h}render(e){const n=e==null?e=new En:void 0,{points:i,halfedges:r,triangles:s}=this;for(let o=0,a=r.length;o<a;++o){const l=r[o];if(l<o)continue;const c=s[o]*2,h=s[l]*2;e.moveTo(i[c],i[c+1]),e.lineTo(i[h],i[h+1])}return this.renderHull(e),n&&n.value()}renderPoints(e,n){n===void 0&&(!e||typeof e.moveTo!="function")&&(n=e,e=null),n=n==null?2:+n;const i=e==null?e=new En:void 0,{points:r}=this;for(let s=0,o=r.length;s<o;s+=2){const a=r[s],l=r[s+1];e.moveTo(a+n,l),e.arc(a,l,n,0,hA)}return i&&i.value()}renderHull(e){const n=e==null?e=new En:void 0,{hull:i,points:r}=this,s=i[0]*2,o=i.length;e.moveTo(r[s],r[s+1]);for(let a=1;a<o;++a){const l=2*i[a];e.lineTo(r[l],r[l+1])}return e.closePath(),n&&n.value()}hullPolygon(){const e=new ll;return this.renderHull(e),e.value()}renderTriangle(e,n){const i=n==null?n=new En:void 0,{points:r,triangles:s}=this,o=s[e*=3]*2,a=s[e+1]*2,l=s[e+2]*2;return n.moveTo(r[o],r[o+1]),n.lineTo(r[a],r[a+1]),n.lineTo(r[l],r[l+1]),n.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:e}=this;for(let n=0,i=e.length/3;n<i;++n)yield this.trianglePolygon(n)}trianglePolygon(e){const n=new ll;return this.renderTriangle(e,n),n.value()}}function mA(t,e,n,i){const r=t.length,s=new Float64Array(r*2);for(let o=0;o<r;++o){const a=t[o];s[o*2]=e.call(i,a,o,t),s[o*2+1]=n.call(i,a,o,t)}return s}function*_A(t,e,n,i){let r=0;for(const s of t)yield e.call(i,s,r,t),yield n.call(i,s,r,t),++r}function yA(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Zs(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function vA(t){return t=Zs(Math.abs(t)),t?t[1]:NaN}function wA(t,e){return function(n,i){for(var r=n.length,s=[],o=0,a=t[0],l=0;r>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),s.push(n.substring(r-=a,r+a)),!((l+=a+1)>i));)a=t[o=(o+1)%t.length];return s.reverse().join(e)}}function EA(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var IA=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function cl(t){if(!(e=IA.exec(t)))throw new Error("invalid format: "+t);var e;return new jc({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}cl.prototype=jc.prototype;function jc(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}jc.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function SA(t){e:for(var e=t.length,n=1,i=-1,r;n<e;++n)switch(t[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+t[n])break e;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(r+1):t}var rm;function bA(t,e){var n=Zs(t,e);if(!n)return t+"";var i=n[0],r=n[1],s=r-(rm=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+Zs(t,Math.max(0,e+s-1))[0]}function uf(t,e){var n=Zs(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const hf={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:yA,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>uf(t*100,e),r:uf,s:bA,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function ff(t){return t}var df=Array.prototype.map,pf=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"];function CA(t){var e=t.grouping===void 0||t.thousands===void 0?ff:wA(df.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",i=t.currency===void 0?"":t.currency[1]+"",r=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?ff:EA(df.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"â":t.minus+"",l=t.nan===void 0?"NaN":t.nan+"";function c(u){u=cl(u);var f=u.fill,d=u.align,w=u.sign,b=u.symbol,N=u.zero,x=u.width,A=u.comma,P=u.precision,k=u.trim,R=u.type;R==="n"?(A=!0,R="g"):hf[R]||(P===void 0&&(P=12),k=!0,R="g"),(N||f==="0"&&d==="=")&&(N=!0,f="0",d="=");var O=b==="$"?n:b==="#"&&/[boxX]/.test(R)?"0"+R.toLowerCase():"",$=b==="$"?i:/[%p]/.test(R)?o:"",p=hf[R],m=/[defgprs%]/.test(R);P=P===void 0?6:/[gprs]/.test(R)?Math.max(1,Math.min(21,P)):Math.max(0,Math.min(20,P));function v(E){var S=O,T=$,y,g,_;if(R==="c")T=p(E)+T,E="";else{E=+E;var I=E<0||1/E<0;if(E=isNaN(E)?l:p(Math.abs(E),P),k&&(E=SA(E)),I&&+E==0&&w!=="+"&&(I=!1),S=(I?w==="("?w:a:w==="-"||w==="("?"":w)+S,T=(R==="s"?pf[8+rm/3]:"")+T+(I&&w==="("?")":""),m){for(y=-1,g=E.length;++y<g;)if(_=E.charCodeAt(y),48>_||_>57){T=(_===46?r+E.slice(y+1):E.slice(y))+T,E=E.slice(0,y);break}}}A&&!N&&(E=e(E,1/0));var C=S.length+E.length+T.length,M=C<x?new Array(x-C+1).join(f):"";switch(A&&N&&(E=e(M+E,M.length?x-T.length:1/0),M=""),d){case"<":E=S+E+T+M;break;case"=":E=S+M+E+T;break;case"^":E=M.slice(0,C=M.length>>1)+S+E+T+M.slice(C);break;default:E=M+S+E+T;break}return s(E)}return v.toString=function(){return u+""},v}function h(u,f){var d=c((u=cl(u),u.type="f",u)),w=Math.max(-8,Math.min(8,Math.floor(vA(f)/3)))*3,b=Math.pow(10,-w),N=pf[8+w/3];return function(x){return d(b*x)+N}}return{format:c,formatPrefix:h}}var Qr,Kc;TA({thousands:",",grouping:[3],currency:["$",""]});function TA(t){return Qr=CA(t),Kc=Qr.format,Qr.formatPrefix,Qr}var J=1e-6,ul=1e-12,Z=Math.PI,Ce=Z/2,gf=Z/4,Ve=Z*2,xe=180/Z,ee=Z/180,ae=Math.abs,jo=Math.atan,Ft=Math.atan2,Y=Math.cos,Jr=Math.ceil,sm=Math.exp,hl=Math.hypot,om=Math.log,G=Math.sin,AA=Math.sign||function(t){return t>0?1:t<0?-1:0},St=Math.sqrt,am=Math.tan;function xA(t){return t>1?0:t<-1?Z:Math.acos(t)}function Ut(t){return t>1?Ce:t<-1?-Ce:Math.asin(t)}function me(){}function eo(t,e){t&&_f.hasOwnProperty(t.type)&&_f[t.type](t,e)}var mf={Feature:function(t,e){eo(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,i=-1,r=n.length;++i<r;)eo(n[i].geometry,e)}},_f={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)t=n[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){fl(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)fl(n[i],e,0)},Polygon:function(t,e){yf(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)yf(n[i],e)},GeometryCollection:function(t,e){for(var n=t.geometries,i=-1,r=n.length;++i<r;)eo(n[i],e)}};function fl(t,e,n){var i=-1,r=t.length-n,s;for(e.lineStart();++i<r;)s=t[i],e.point(s[0],s[1],s[2]);e.lineEnd()}function yf(t,e){var n=-1,i=t.length;for(e.polygonStart();++n<i;)fl(t[n],e,1);e.polygonEnd()}function Qt(t,e){t&&mf.hasOwnProperty(t.type)?mf[t.type](t,e):eo(t,e)}function dl(t){return[Ft(t[1],t[0]),Ut(t[2])]}function ui(t){var e=t[0],n=t[1],i=Y(n);return[i*Y(e),i*G(e),G(n)]}function Zr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function to(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Sa(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function es(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function pl(t){var e=St(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}var Fi,no,io,ro,so,oo,ao,lo,gl,ml,_l,lm,cm,Ne,Me,ke,at={sphere:me,point:Yc,lineStart:vf,lineEnd:wf,polygonStart:function(){at.lineStart=kA,at.lineEnd=PA},polygonEnd:function(){at.lineStart=vf,at.lineEnd=wf}};function Yc(t,e){t*=ee,e*=ee;var n=Y(e);$r(n*Y(t),n*G(t),G(e))}function $r(t,e,n){++Fi,io+=(t-io)/Fi,ro+=(e-ro)/Fi,so+=(n-so)/Fi}function vf(){at.point=NA}function NA(t,e){t*=ee,e*=ee;var n=Y(e);Ne=n*Y(t),Me=n*G(t),ke=G(e),at.point=MA,$r(Ne,Me,ke)}function MA(t,e){t*=ee,e*=ee;var n=Y(e),i=n*Y(t),r=n*G(t),s=G(e),o=Ft(St((o=Me*s-ke*r)*o+(o=ke*i-Ne*s)*o+(o=Ne*r-Me*i)*o),Ne*i+Me*r+ke*s);no+=o,oo+=o*(Ne+(Ne=i)),ao+=o*(Me+(Me=r)),lo+=o*(ke+(ke=s)),$r(Ne,Me,ke)}function wf(){at.point=Yc}function kA(){at.point=RA}function PA(){um(lm,cm),at.point=Yc}function RA(t,e){lm=t,cm=e,t*=ee,e*=ee,at.point=um;var n=Y(e);Ne=n*Y(t),Me=n*G(t),ke=G(e),$r(Ne,Me,ke)}function um(t,e){t*=ee,e*=ee;var n=Y(e),i=n*Y(t),r=n*G(t),s=G(e),o=Me*s-ke*r,a=ke*i-Ne*s,l=Ne*r-Me*i,c=hl(o,a,l),h=Ut(c),u=c&&-h/c;gl.add(u*o),ml.add(u*a),_l.add(u*l),no+=h,oo+=h*(Ne+(Ne=i)),ao+=h*(Me+(Me=r)),lo+=h*(ke+(ke=s)),$r(Ne,Me,ke)}function Ef(t){Fi=no=io=ro=so=oo=ao=lo=0,gl=new ct,ml=new ct,_l=new ct,Qt(t,at);var e=+gl,n=+ml,i=+_l,r=hl(e,n,i);return r<ul&&(e=oo,n=ao,i=lo,no<J&&(e=io,n=ro,i=so),r=hl(e,n,i),r<ul)?[NaN,NaN]:[Ft(n,e)*xe,Ut(i/r)*xe]}function yl(t,e){function n(i,r){return i=t(i,r),e(i[0],i[1])}return t.invert&&e.invert&&(n.invert=function(i,r){return i=e.invert(i,r),i&&t.invert(i[0],i[1])}),n}function vl(t,e){return ae(t)>Z&&(t-=Math.round(t/Ve)*Ve),[t,e]}vl.invert=vl;function hm(t,e,n){return(t%=Ve)?e||n?yl(Sf(t),bf(e,n)):Sf(t):e||n?bf(e,n):vl}function If(t){return function(e,n){return e+=t,ae(e)>Z&&(e-=Math.round(e/Ve)*Ve),[e,n]}}function Sf(t){var e=If(t);return e.invert=If(-t),e}function bf(t,e){var n=Y(t),i=G(t),r=Y(e),s=G(e);function o(a,l){var c=Y(l),h=Y(a)*c,u=G(a)*c,f=G(l),d=f*n+h*i;return[Ft(u*r-d*s,h*n-f*i),Ut(d*r+u*s)]}return o.invert=function(a,l){var c=Y(l),h=Y(a)*c,u=G(a)*c,f=G(l),d=f*r-u*s;return[Ft(u*r+f*s,h*n+d*i),Ut(d*n-h*i)]},o}function co(t){t=hm(t[0]*ee,t[1]*ee,t.length>2?t[2]*ee:0);function e(n){return n=t(n[0]*ee,n[1]*ee),n[0]*=xe,n[1]*=xe,n}return e.invert=function(n){return n=t.invert(n[0]*ee,n[1]*ee),n[0]*=xe,n[1]*=xe,n},e}function OA(t,e,n,i,r,s){if(n){var o=Y(e),a=G(e),l=i*n;r==null?(r=e+i*Ve,s=e-l/2):(r=Cf(o,r),s=Cf(o,s),(i>0?r<s:r>s)&&(r+=i*Ve));for(var c,h=r;i>0?h>s:h<s;h-=l)c=dl([o,-a*Y(h),-a*G(h)]),t.point(c[0],c[1])}}function Cf(t,e){e=ui(e),e[0]-=t,pl(e);var n=xA(-e[1]);return((-e[2]<0?-n:n)+Ve-J)%Ve}function fm(){var t=[],e;return{point:function(n,i,r){e.push([n,i,r])},lineStart:function(){t.push(e=[])},lineEnd:me,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function ms(t,e){return ae(t[0]-e[0])<J&&ae(t[1]-e[1])<J}function ts(t,e,n,i){this.x=t,this.z=e,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function dm(t,e,n,i,r){var s=[],o=[],a,l;if(t.forEach(function(w){if(!((b=w.length-1)<=0)){var b,N=w[0],x=w[b],A;if(ms(N,x)){if(!N[2]&&!x[2]){for(r.lineStart(),a=0;a<b;++a)r.point((N=w[a])[0],N[1]);r.lineEnd();return}x[0]+=2*J}s.push(A=new ts(N,w,null,!0)),o.push(A.o=new ts(N,null,A,!1)),s.push(A=new ts(x,w,null,!1)),o.push(A.o=new ts(x,null,A,!0))}}),!!s.length){for(o.sort(e),Tf(s),Tf(o),a=0,l=o.length;a<l;++a)o[a].e=n=!n;for(var c=s[0],h,u;;){for(var f=c,d=!0;f.v;)if((f=f.n)===c)return;h=f.z,r.lineStart();do{if(f.v=f.o.v=!0,f.e){if(d)for(a=0,l=h.length;a<l;++a)r.point((u=h[a])[0],u[1]);else i(f.x,f.n.x,1,r);f=f.n}else{if(d)for(h=f.p.z,a=h.length-1;a>=0;--a)r.point((u=h[a])[0],u[1]);else i(f.x,f.p.x,-1,r);f=f.p}f=f.o,h=f.z,d=!d}while(!f.v);r.lineEnd()}}}function Tf(t){if(e=t.length){for(var e,n=0,i=t[0],r;++n<e;)i.n=r=t[n],r.p=i,i=r;i.n=r=t[0],r.p=i}}function ba(t){return ae(t[0])<=Z?t[0]:AA(t[0])*((ae(t[0])+Z)%Ve-Z)}function DA(t,e){var n=ba(e),i=e[1],r=G(i),s=[G(n),-Y(n),0],o=0,a=0,l=new ct;r===1?i=Ce+J:r===-1&&(i=-Ce-J);for(var c=0,h=t.length;c<h;++c)if(f=(u=t[c]).length)for(var u,f,d=u[f-1],w=ba(d),b=d[1]/2+gf,N=G(b),x=Y(b),A=0;A<f;++A,w=k,N=O,x=$,d=P){var P=u[A],k=ba(P),R=P[1]/2+gf,O=G(R),$=Y(R),p=k-w,m=p>=0?1:-1,v=m*p,E=v>Z,S=N*O;if(l.add(Ft(S*m*G(v),x*$+S*Y(v))),o+=E?p+m*Ve:p,E^w>=n^k>=n){var T=to(ui(d),ui(P));pl(T);var y=to(s,T);pl(y);var g=(E^p>=0?-1:1)*Ut(y[2]);(i>g||i===g&&(T[0]||T[1]))&&(a+=E^p>=0?1:-1)}}return(o<-J||o<J&&l<-ul)^a&1}function pm(t,e,n,i){return function(r){var s=e(r),o=fm(),a=e(o),l=!1,c,h,u,f={point:d,lineStart:b,lineEnd:N,polygonStart:function(){f.point=x,f.lineStart=A,f.lineEnd=P,h=[],c=[]},polygonEnd:function(){f.point=d,f.lineStart=b,f.lineEnd=N,h=Ng(h);var k=DA(c,i);h.length?(l||(r.polygonStart(),l=!0),dm(h,$A,k,n,r)):k&&(l||(r.polygonStart(),l=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),l&&(r.polygonEnd(),l=!1),h=c=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function d(k,R){t(k,R)&&r.point(k,R)}function w(k,R){s.point(k,R)}function b(){f.point=w,s.lineStart()}function N(){f.point=d,s.lineEnd()}function x(k,R){u.push([k,R]),a.point(k,R)}function A(){a.lineStart(),u=[]}function P(){x(u[0][0],u[0][1]),a.lineEnd();var k=a.clean(),R=o.result(),O,$=R.length,p,m,v;if(u.pop(),c.push(u),u=null,!!$){if(k&1){if(m=R[0],(p=m.length-1)>0){for(l||(r.polygonStart(),l=!0),r.lineStart(),O=0;O<p;++O)r.point((v=m[O])[0],v[1]);r.lineEnd()}return}$>1&&k&2&&R.push(R.pop().concat(R.shift())),h.push(R.filter(LA))}}return f}}function LA(t){return t.length>1}function $A(t,e){return((t=t.x)[0]<0?t[1]-Ce-J:Ce-t[1])-((e=e.x)[0]<0?e[1]-Ce-J:Ce-e[1])}const Af=pm(function(){return!0},FA,BA,[-Z,-Ce]);function FA(t){var e=NaN,n=NaN,i=NaN,r;return{lineStart:function(){t.lineStart(),r=1},point:function(s,o){var a=s>0?Z:-Z,l=ae(s-e);ae(l-Z)<J?(t.point(e,n=(n+o)/2>0?Ce:-Ce),t.point(i,n),t.lineEnd(),t.lineStart(),t.point(a,n),t.point(s,n),r=0):i!==a&&l>=Z&&(ae(e-i)<J&&(e-=i*J),ae(s-a)<J&&(s-=a*J),n=UA(e,n,s,o),t.point(i,n),t.lineEnd(),t.lineStart(),t.point(a,n),r=0),t.point(e=s,n=o),i=a},lineEnd:function(){t.lineEnd(),e=n=NaN},clean:function(){return 2-r}}}function UA(t,e,n,i){var r,s,o=G(t-n);return ae(o)>J?jo((G(e)*(s=Y(i))*G(n)-G(i)*(r=Y(e))*G(t))/(r*s*o)):(e+i)/2}function BA(t,e,n,i){var r;if(t==null)r=n*Ce,i.point(-Z,r),i.point(0,r),i.point(Z,r),i.point(Z,0),i.point(Z,-r),i.point(0,-r),i.point(-Z,-r),i.point(-Z,0),i.point(-Z,r);else if(ae(t[0]-e[0])>J){var s=t[0]<e[0]?Z:-Z;r=n*s/2,i.point(-s,r),i.point(0,r),i.point(s,r)}else i.point(e[0],e[1])}function HA(t){var e=Y(t),n=2*ee,i=e>0,r=ae(e)>J;function s(h,u,f,d){OA(d,t,n,f,h,u)}function o(h,u){return Y(h)*Y(u)>e}function a(h){var u,f,d,w,b;return{lineStart:function(){w=d=!1,b=1},point:function(N,x){var A=[N,x],P,k=o(N,x),R=i?k?0:c(N,x):k?c(N+(N<0?Z:-Z),x):0;if(!u&&(w=d=k)&&h.lineStart(),k!==d&&(P=l(u,A),(!P||ms(u,P)||ms(A,P))&&(A[2]=1)),k!==d)b=0,k?(h.lineStart(),P=l(A,u),h.point(P[0],P[1])):(P=l(u,A),h.point(P[0],P[1],2),h.lineEnd()),u=P;else if(r&&u&&i^k){var O;!(R&f)&&(O=l(A,u,!0))&&(b=0,i?(h.lineStart(),h.point(O[0][0],O[0][1]),h.point(O[1][0],O[1][1]),h.lineEnd()):(h.point(O[1][0],O[1][1]),h.lineEnd(),h.lineStart(),h.point(O[0][0],O[0][1],3)))}k&&(!u||!ms(u,A))&&h.point(A[0],A[1]),u=A,d=k,f=R},lineEnd:function(){d&&h.lineEnd(),u=null},clean:function(){return b|(w&&d)<<1}}}function l(h,u,f){var d=ui(h),w=ui(u),b=[1,0,0],N=to(d,w),x=Zr(N,N),A=N[0],P=x-A*A;if(!P)return!f&&h;var k=e*x/P,R=-e*A/P,O=to(b,N),$=es(b,k),p=es(N,R);Sa($,p);var m=O,v=Zr($,m),E=Zr(m,m),S=v*v-E*(Zr($,$)-1);if(!(S<0)){var T=St(S),y=es(m,(-v-T)/E);if(Sa(y,$),y=dl(y),!f)return y;var g=h[0],_=u[0],I=h[1],C=u[1],M;_<g&&(M=g,g=_,_=M);var D=_-g,L=ae(D-Z)<J,U=L||D<J;if(!L&&C<I&&(M=I,I=C,C=M),U?L?I+C>0^y[1]<(ae(y[0]-g)<J?I:C):I<=y[1]&&y[1]<=C:D>Z^(g<=y[0]&&y[0]<=_)){var W=es(m,(-v+T)/E);return Sa(W,$),[y,dl(W)]}}}function c(h,u){var f=i?t:Z-t,d=0;return h<-f?d|=1:h>f&&(d|=2),u<-f?d|=4:u>f&&(d|=8),d}return pm(o,a,s,i?[0,-t]:[-Z,t-Z])}function zA(t,e,n,i,r,s){var o=t[0],a=t[1],l=e[0],c=e[1],h=0,u=1,f=l-o,d=c-a,w;if(w=n-o,!(!f&&w>0)){if(w/=f,f<0){if(w<h)return;w<u&&(u=w)}else if(f>0){if(w>u)return;w>h&&(h=w)}if(w=r-o,!(!f&&w<0)){if(w/=f,f<0){if(w>u)return;w>h&&(h=w)}else if(f>0){if(w<h)return;w<u&&(u=w)}if(w=i-a,!(!d&&w>0)){if(w/=d,d<0){if(w<h)return;w<u&&(u=w)}else if(d>0){if(w>u)return;w>h&&(h=w)}if(w=s-a,!(!d&&w<0)){if(w/=d,d<0){if(w>u)return;w>h&&(h=w)}else if(d>0){if(w<h)return;w<u&&(u=w)}return h>0&&(t[0]=o+h*f,t[1]=a+h*d),u<1&&(e[0]=o+u*f,e[1]=a+u*d),!0}}}}}var Ui=1e9,ns=-Ui;function WA(t,e,n,i){function r(c,h){return t<=c&&c<=n&&e<=h&&h<=i}function s(c,h,u,f){var d=0,w=0;if(c==null||(d=o(c,u))!==(w=o(h,u))||l(c,h)<0^u>0)do f.point(d===0||d===3?t:n,d>1?i:e);while((d=(d+u+4)%4)!==w);else f.point(h[0],h[1])}function o(c,h){return ae(c[0]-t)<J?h>0?0:3:ae(c[0]-n)<J?h>0?2:1:ae(c[1]-e)<J?h>0?1:0:h>0?3:2}function a(c,h){return l(c.x,h.x)}function l(c,h){var u=o(c,1),f=o(h,1);return u!==f?u-f:u===0?h[1]-c[1]:u===1?c[0]-h[0]:u===2?c[1]-h[1]:h[0]-c[0]}return function(c){var h=c,u=fm(),f,d,w,b,N,x,A,P,k,R,O,$={point:p,lineStart:S,lineEnd:T,polygonStart:v,polygonEnd:E};function p(g,_){r(g,_)&&h.point(g,_)}function m(){for(var g=0,_=0,I=d.length;_<I;++_)for(var C=d[_],M=1,D=C.length,L=C[0],U,W,q=L[0],B=L[1];M<D;++M)U=q,W=B,L=C[M],q=L[0],B=L[1],W<=i?B>i&&(q-U)*(i-W)>(B-W)*(t-U)&&++g:B<=i&&(q-U)*(i-W)<(B-W)*(t-U)&&--g;return g}function v(){h=u,f=[],d=[],O=!0}function E(){var g=m(),_=O&&g,I=(f=Ng(f)).length;(_||I)&&(c.polygonStart(),_&&(c.lineStart(),s(null,null,1,c),c.lineEnd()),I&&dm(f,a,g,s,c),c.polygonEnd()),h=c,f=d=w=null}function S(){$.point=y,d&&d.push(w=[]),R=!0,k=!1,A=P=NaN}function T(){f&&(y(b,N),x&&k&&u.rejoin(),f.push(u.result())),$.point=p,k&&h.lineEnd()}function y(g,_){var I=r(g,_);if(d&&w.push([g,_]),R)b=g,N=_,x=I,R=!1,I&&(h.lineStart(),h.point(g,_));else if(I&&k)h.point(g,_);else{var C=[A=Math.max(ns,Math.min(Ui,A)),P=Math.max(ns,Math.min(Ui,P))],M=[g=Math.max(ns,Math.min(Ui,g)),_=Math.max(ns,Math.min(Ui,_))];zA(C,M,t,e,n,i)?(k||(h.lineStart(),h.point(C[0],C[1])),h.point(M[0],M[1]),I||h.lineEnd(),O=!1):I&&(h.lineStart(),h.point(g,_),O=!1)}A=g,P=_,k=I}return $}}var wl,El,_s,ys,hi={sphere:me,point:me,lineStart:VA,lineEnd:me,polygonStart:me,polygonEnd:me};function VA(){hi.point=GA,hi.lineEnd=qA}function qA(){hi.point=hi.lineEnd=me}function GA(t,e){t*=ee,e*=ee,El=t,_s=G(e),ys=Y(e),hi.point=jA}function jA(t,e){t*=ee,e*=ee;var n=G(e),i=Y(e),r=ae(t-El),s=Y(r),o=G(r),a=i*o,l=ys*n-_s*i*s,c=_s*n+ys*i*s;wl.add(Ft(St(a*a+l*l),c)),El=t,_s=n,ys=i}function KA(t){return wl=new ct,Qt(t,hi),+wl}var Il=[null,null],YA={type:"LineString",coordinates:Il};function uo(t,e){return Il[0]=t,Il[1]=e,KA(YA)}function xf(t,e,n){var i=Gn(t,e-J,n).concat(e);return function(r){return i.map(function(s){return[r,s]})}}function Nf(t,e,n){var i=Gn(t,e-J,n).concat(e);return function(r){return i.map(function(s){return[s,r]})}}function XA(){var t,e,n,i,r,s,o,a,l=10,c=l,h=90,u=360,f,d,w,b,N=2.5;function x(){return{type:"MultiLineString",coordinates:A()}}function A(){return Gn(Jr(i/h)*h,n,h).map(w).concat(Gn(Jr(a/u)*u,o,u).map(b)).concat(Gn(Jr(e/l)*l,t,l).filter(function(P){return ae(P%h)>J}).map(f)).concat(Gn(Jr(s/c)*c,r,c).filter(function(P){return ae(P%u)>J}).map(d))}return x.lines=function(){return A().map(function(P){return{type:"LineString",coordinates:P}})},x.outline=function(){return{type:"Polygon",coordinates:[w(i).concat(b(o).slice(1),w(n).reverse().slice(1),b(a).reverse().slice(1))]}},x.extent=function(P){return arguments.length?x.extentMajor(P).extentMinor(P):x.extentMinor()},x.extentMajor=function(P){return arguments.length?(i=+P[0][0],n=+P[1][0],a=+P[0][1],o=+P[1][1],i>n&&(P=i,i=n,n=P),a>o&&(P=a,a=o,o=P),x.precision(N)):[[i,a],[n,o]]},x.extentMinor=function(P){return arguments.length?(e=+P[0][0],t=+P[1][0],s=+P[0][1],r=+P[1][1],e>t&&(P=e,e=t,t=P),s>r&&(P=s,s=r,r=P),x.precision(N)):[[e,s],[t,r]]},x.step=function(P){return arguments.length?x.stepMajor(P).stepMinor(P):x.stepMinor()},x.stepMajor=function(P){return arguments.length?(h=+P[0],u=+P[1],x):[h,u]},x.stepMinor=function(P){return arguments.length?(l=+P[0],c=+P[1],x):[l,c]},x.precision=function(P){return arguments.length?(N=+P,f=xf(s,r,90),d=Nf(e,t,N),w=xf(a,o,90),b=Nf(i,n,N),x):N},x.extentMajor([[-180,-90+J],[180,90-J]]).extentMinor([[-180,-80-J],[180,80+J]])}const Sl=t=>t;var Ca=new ct,bl=new ct,gm,mm,Cl,Tl,Tt={point:me,lineStart:me,lineEnd:me,polygonStart:function(){Tt.lineStart=QA,Tt.lineEnd=ZA},polygonEnd:function(){Tt.lineStart=Tt.lineEnd=Tt.point=me,Ca.add(ae(bl)),bl=new ct},result:function(){var t=Ca/2;return Ca=new ct,t}};function QA(){Tt.point=JA}function JA(t,e){Tt.point=_m,gm=Cl=t,mm=Tl=e}function _m(t,e){bl.add(Tl*t-Cl*e),Cl=t,Tl=e}function ZA(){_m(gm,mm)}var fi=1/0,ho=fi,vr=-fi,fo=vr,po={point:ex,lineStart:me,lineEnd:me,polygonStart:me,polygonEnd:me,result:function(){var t=[[fi,ho],[vr,fo]];return vr=fo=-(ho=fi=1/0),t}};function ex(t,e){t<fi&&(fi=t),t>vr&&(vr=t),e<ho&&(ho=e),e>fo&&(fo=e)}var Al=0,xl=0,Bi=0,go=0,mo=0,Kn=0,Nl=0,Ml=0,Hi=0,ym,vm,dt,pt,Xe={point:Dn,lineStart:Mf,lineEnd:kf,polygonStart:function(){Xe.lineStart=ix,Xe.lineEnd=rx},polygonEnd:function(){Xe.point=Dn,Xe.lineStart=Mf,Xe.lineEnd=kf},result:function(){var t=Hi?[Nl/Hi,Ml/Hi]:Kn?[go/Kn,mo/Kn]:Bi?[Al/Bi,xl/Bi]:[NaN,NaN];return Al=xl=Bi=go=mo=Kn=Nl=Ml=Hi=0,t}};function Dn(t,e){Al+=t,xl+=e,++Bi}function Mf(){Xe.point=tx}function tx(t,e){Xe.point=nx,Dn(dt=t,pt=e)}function nx(t,e){var n=t-dt,i=e-pt,r=St(n*n+i*i);go+=r*(dt+t)/2,mo+=r*(pt+e)/2,Kn+=r,Dn(dt=t,pt=e)}function kf(){Xe.point=Dn}function ix(){Xe.point=sx}function rx(){wm(ym,vm)}function sx(t,e){Xe.point=wm,Dn(ym=dt=t,vm=pt=e)}function wm(t,e){var n=t-dt,i=e-pt,r=St(n*n+i*i);go+=r*(dt+t)/2,mo+=r*(pt+e)/2,Kn+=r,r=pt*t-dt*e,Nl+=r*(dt+t),Ml+=r*(pt+e),Hi+=r*3,Dn(dt=t,pt=e)}function Em(t){this._context=t}Em.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:{this._context.moveTo(t,e),this._point=1;break}case 1:{this._context.lineTo(t,e);break}default:{this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,Ve);break}}},result:me};var kl=new ct,Ta,Im,Sm,zi,Wi,wr={point:me,lineStart:function(){wr.point=ox},lineEnd:function(){Ta&&bm(Im,Sm),wr.point=me},polygonStart:function(){Ta=!0},polygonEnd:function(){Ta=null},result:function(){var t=+kl;return kl=new ct,t}};function ox(t,e){wr.point=bm,Im=zi=t,Sm=Wi=e}function bm(t,e){zi-=t,Wi-=e,kl.add(St(zi*zi+Wi*Wi)),zi=t,Wi=e}let Pf,_o,Rf,Of;class Df{constructor(e){this._append=e==null?Cm:ax(e),this._radius=4.5,this._=""}pointRadius(e){return this._radius=+e,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(e,n){switch(this._point){case 0:{this._append`M${e},${n}`,this._point=1;break}case 1:{this._append`L${e},${n}`;break}default:{if(this._append`M${e},${n}`,this._radius!==Rf||this._append!==_o){const i=this._radius,r=this._;this._="",this._append`m0,${i}a${i},${i} 0 1,1 0,${-2*i}a${i},${i} 0 1,1 0,${2*i}z`,Rf=i,_o=this._append,Of=this._,this._=r}this._+=Of;break}}}result(){const e=this._;return this._="",e.length?e:null}}function Cm(t){let e=1;this._+=t[0];for(const n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function ax(t){const e=Math.floor(t);if(!(e>=0))throw new RangeError(`invalid digits: ${t}`);if(e>15)return Cm;if(e!==Pf){const n=10**e;Pf=e,_o=function(r){let s=1;this._+=r[0];for(const o=r.length;s<o;++s)this._+=Math.round(arguments[s]*n)/n+r[s]}}return _o}function Xc(t,e){let n=3,i=4.5,r,s;function o(a){return a&&(typeof i=="function"&&s.pointRadius(+i.apply(this,arguments)),Qt(a,r(s))),s.result()}return o.area=function(a){return Qt(a,r(Tt)),Tt.result()},o.measure=function(a){return Qt(a,r(wr)),wr.result()},o.bounds=function(a){return Qt(a,r(po)),po.result()},o.centroid=function(a){return Qt(a,r(Xe)),Xe.result()},o.projection=function(a){return arguments.length?(r=a==null?(t=null,Sl):(t=a).stream,o):t},o.context=function(a){return arguments.length?(s=a==null?(e=null,new Df(n)):new Em(e=a),typeof i!="function"&&s.pointRadius(i),o):e},o.pointRadius=function(a){return arguments.length?(i=typeof a=="function"?a:(s.pointRadius(+a),+a),o):i},o.digits=function(a){if(!arguments.length)return n;if(a==null)n=null;else{const l=Math.floor(a);if(!(l>=0))throw new RangeError(`invalid digits: ${a}`);n=l}return e===null&&(s=new Df(n)),o},o.projection(t).digits(n).context(e)}function Qc(t){return function(e){var n=new Pl;for(var i in t)n[i]=t[i];return n.stream=e,n}}function Pl(){}Pl.prototype={constructor:Pl,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Jc(t,e,n){var i=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),i!=null&&t.clipExtent(null),Qt(n,t.stream(po)),e(po.result()),i!=null&&t.clipExtent(i),t}function Tm(t,e,n){return Jc(t,function(i){var r=e[1][0]-e[0][0],s=e[1][1]-e[0][1],o=Math.min(r/(i[1][0]-i[0][0]),s/(i[1][1]-i[0][1])),a=+e[0][0]+(r-o*(i[1][0]+i[0][0]))/2,l=+e[0][1]+(s-o*(i[1][1]+i[0][1]))/2;t.scale(150*o).translate([a,l])},n)}function lx(t,e,n){return Tm(t,[[0,0],e],n)}function cx(t,e,n){return Jc(t,function(i){var r=+e,s=r/(i[1][0]-i[0][0]),o=(r-s*(i[1][0]+i[0][0]))/2,a=-s*i[0][1];t.scale(150*s).translate([o,a])},n)}function ux(t,e,n){return Jc(t,function(i){var r=+e,s=r/(i[1][1]-i[0][1]),o=-s*i[0][0],a=(r-s*(i[1][1]+i[0][1]))/2;t.scale(150*s).translate([o,a])},n)}var Lf=16,hx=Y(30*ee);function $f(t,e){return+e?dx(t,e):fx(t)}function fx(t){return Qc({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}function dx(t,e){function n(i,r,s,o,a,l,c,h,u,f,d,w,b,N){var x=c-i,A=h-r,P=x*x+A*A;if(P>4*e&&b--){var k=o+f,R=a+d,O=l+w,$=St(k*k+R*R+O*O),p=Ut(O/=$),m=ae(ae(O)-1)<J||ae(s-u)<J?(s+u)/2:Ft(R,k),v=t(m,p),E=v[0],S=v[1],T=E-i,y=S-r,g=A*T-x*y;(g*g/P>e||ae((x*T+A*y)/P-.5)>.3||o*f+a*d+l*w<hx)&&(n(i,r,s,o,a,l,E,S,m,k/=$,R/=$,O,b,N),N.point(E,S),n(E,S,m,k,R,O,c,h,u,f,d,w,b,N))}}return function(i){var r,s,o,a,l,c,h,u,f,d,w,b,N={point:x,lineStart:A,lineEnd:k,polygonStart:function(){i.polygonStart(),N.lineStart=R},polygonEnd:function(){i.polygonEnd(),N.lineStart=A}};function x(p,m){p=t(p,m),i.point(p[0],p[1])}function A(){u=NaN,N.point=P,i.lineStart()}function P(p,m){var v=ui([p,m]),E=t(p,m);n(u,f,h,d,w,b,u=E[0],f=E[1],h=p,d=v[0],w=v[1],b=v[2],Lf,i),i.point(u,f)}function k(){N.point=x,i.lineEnd()}function R(){A(),N.point=O,N.lineEnd=$}function O(p,m){P(r=p,m),s=u,o=f,a=d,l=w,c=b,N.point=P}function $(){n(u,f,h,d,w,b,s,o,r,a,l,c,Lf,i),N.lineEnd=k,k()}return N}}var px=Qc({point:function(t,e){this.stream.point(t*ee,e*ee)}});function gx(t){return Qc({point:function(e,n){var i=t(e,n);return this.stream.point(i[0],i[1])}})}function mx(t,e,n,i,r){function s(o,a){return o*=i,a*=r,[e+t*o,n-t*a]}return s.invert=function(o,a){return[(o-e)/t*i,(n-a)/t*r]},s}function Ff(t,e,n,i,r,s){if(!s)return mx(t,e,n,i,r);var o=Y(s),a=G(s),l=o*t,c=a*t,h=o/t,u=a/t,f=(a*n-o*e)/t,d=(a*e+o*n)/t;function w(b,N){return b*=i,N*=r,[l*b-c*N+e,n-c*b-l*N]}return w.invert=function(b,N){return[i*(h*b-u*N+f),r*(d-u*b-h*N)]},w}function Zc(t){return _x(function(){return t})()}function _x(t){var e,n=150,i=480,r=250,s=0,o=0,a=0,l=0,c=0,h,u=0,f=1,d=1,w=null,b=Af,N=null,x,A,P,k=Sl,R=.5,O,$,p,m,v;function E(g){return p(g[0]*ee,g[1]*ee)}function S(g){return g=p.invert(g[0],g[1]),g&&[g[0]*xe,g[1]*xe]}E.stream=function(g){return m&&v===g?m:m=px(gx(h)(b(O(k(v=g)))))},E.preclip=function(g){return arguments.length?(b=g,w=void 0,y()):b},E.postclip=function(g){return arguments.length?(k=g,N=x=A=P=null,y()):k},E.clipAngle=function(g){return arguments.length?(b=+g?HA(w=g*ee):(w=null,Af),y()):w*xe},E.clipExtent=function(g){return arguments.length?(k=g==null?(N=x=A=P=null,Sl):WA(N=+g[0][0],x=+g[0][1],A=+g[1][0],P=+g[1][1]),y()):N==null?null:[[N,x],[A,P]]},E.scale=function(g){return arguments.length?(n=+g,T()):n},E.translate=function(g){return arguments.length?(i=+g[0],r=+g[1],T()):[i,r]},E.center=function(g){return arguments.length?(s=g[0]%360*ee,o=g[1]%360*ee,T()):[s*xe,o*xe]},E.rotate=function(g){return arguments.length?(a=g[0]%360*ee,l=g[1]%360*ee,c=g.length>2?g[2]%360*ee:0,T()):[a*xe,l*xe,c*xe]},E.angle=function(g){return arguments.length?(u=g%360*ee,T()):u*xe},E.reflectX=function(g){return arguments.length?(f=g?-1:1,T()):f<0},E.reflectY=function(g){return arguments.length?(d=g?-1:1,T()):d<0},E.precision=function(g){return arguments.length?(O=$f($,R=g*g),y()):St(R)},E.fitExtent=function(g,_){return Tm(E,g,_)},E.fitSize=function(g,_){return lx(E,g,_)},E.fitWidth=function(g,_){return cx(E,g,_)},E.fitHeight=function(g,_){return ux(E,g,_)};function T(){var g=Ff(n,0,0,f,d,u).apply(null,e(s,o)),_=Ff(n,i-g[0],r-g[1],f,d,u);return h=hm(a,l,c),$=yl(e,_),p=yl(h,$),O=$f($,R),y()}function y(){return m=v=null,E}return function(){return e=t.apply(this,arguments),E.invert=e.invert&&S,T()}}function Am(t){return function(e,n){var i=St(e*e+n*n),r=t(i),s=G(r),o=Y(r);return[Ft(e*s,i*o),Ut(i&&n*s/i)]}}function eu(t,e){return[t,om(am((Ce+e)/2))]}eu.invert=function(t,e){return[t,2*jo(sm(e))-Ce]};function yx(){return xm(eu).scale(961/Ve)}function xm(t){var e=Zc(t),n=e.center,i=e.scale,r=e.translate,s=e.clipExtent,o=null,a,l,c;e.scale=function(u){return arguments.length?(i(u),h()):i()},e.translate=function(u){return arguments.length?(r(u),h()):r()},e.center=function(u){return arguments.length?(n(u),h()):n()},e.clipExtent=function(u){return arguments.length?(u==null?o=a=l=c=null:(o=+u[0][0],a=+u[0][1],l=+u[1][0],c=+u[1][1]),h()):o==null?null:[[o,a],[l,c]]};function h(){var u=Z*i(),f=e(co(e.rotate()).invert([0,0]));return s(o==null?[[f[0]-u,f[1]-u],[f[0]+u,f[1]+u]]:t===eu?[[Math.max(f[0]-u,o),a],[Math.min(f[0]+u,l),c]]:[[o,Math.max(f[1]-u,a)],[l,Math.min(f[1]+u,c)]])}return h()}function Nm(t,e){return[Y(e)*G(t),G(e)]}Nm.invert=Am(Ut);function vx(){return Zc(Nm).scale(249.5).clipAngle(90+J)}function Mm(t,e){var n=Y(e),i=1+Y(t)*n;return[n*G(t)/i,G(e)/i]}Mm.invert=Am(function(t){return 2*jo(t)});function km(){return Zc(Mm).scale(250).clipAngle(142)}function Pm(t,e){return[om(am((Ce+e)/2)),-t]}Pm.invert=function(t,e){return[-e,2*jo(sm(t))-Ce]};function wx(){var t=xm(Pm),e=t.center,n=t.rotate;return t.center=function(i){return arguments.length?e([-i[1],i[0]]):(i=e(),[i[1],-i[0]])},t.rotate=function(i){return arguments.length?n([i[0],i[1],i.length>2?i[2]+90:90]):(i=n(),[i[0],i[1],i[2]-90])},n([0,0,90]).scale(159.155)}const is=t=>()=>t;function Ex(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function Mt(t,e,n){this.k=t,this.x=e,this.y=n}Mt.prototype={constructor:Mt,scale:function(t){return t===1?this:new Mt(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Mt(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Rm=new Mt(1,0,0);Mt.prototype;function Aa(t){t.stopImmediatePropagation()}function Di(t){t.preventDefault(),t.stopImmediatePropagation()}function Ix(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function Sx(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function Uf(){return this.__zoom||Rm}function bx(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Cx(){return navigator.maxTouchPoints||"ontouchstart"in this}function Tx(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function Ax(){var t=Ix,e=Sx,n=Tx,i=bx,r=Cx,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,l=BC,c=Wo("start","zoom","end"),h,u,f,d=500,w=150,b=0,N=10;function x(y){y.property("__zoom",Uf).on("wheel.zoom",p,{passive:!1}).on("mousedown.zoom",m).on("dblclick.zoom",v).filter(r).on("touchstart.zoom",E).on("touchmove.zoom",S).on("touchend.zoom touchcancel.zoom",T).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}x.transform=function(y,g,_,I){var C=y.selection?y.selection():y;C.property("__zoom",Uf),y!==C?R(y,g,_,I):C.interrupt().each(function(){O(this,arguments).event(I).start().zoom(null,typeof g=="function"?g.apply(this,arguments):g).end()})},x.scaleBy=function(y,g,_,I){x.scaleTo(y,function(){var C=this.__zoom.k,M=typeof g=="function"?g.apply(this,arguments):g;return C*M},_,I)},x.scaleTo=function(y,g,_,I){x.transform(y,function(){var C=e.apply(this,arguments),M=this.__zoom,D=_==null?k(C):typeof _=="function"?_.apply(this,arguments):_,L=M.invert(D),U=typeof g=="function"?g.apply(this,arguments):g;return n(P(A(M,U),D,L),C,o)},_,I)},x.translateBy=function(y,g,_,I){x.transform(y,function(){return n(this.__zoom.translate(typeof g=="function"?g.apply(this,arguments):g,typeof _=="function"?_.apply(this,arguments):_),e.apply(this,arguments),o)},null,I)},x.translateTo=function(y,g,_,I,C){x.transform(y,function(){var M=e.apply(this,arguments),D=this.__zoom,L=I==null?k(M):typeof I=="function"?I.apply(this,arguments):I;return n(Rm.translate(L[0],L[1]).scale(D.k).translate(typeof g=="function"?-g.apply(this,arguments):-g,typeof _=="function"?-_.apply(this,arguments):-_),M,o)},I,C)};function A(y,g){return g=Math.max(s[0],Math.min(s[1],g)),g===y.k?y:new Mt(g,y.x,y.y)}function P(y,g,_){var I=g[0]-_[0]*y.k,C=g[1]-_[1]*y.k;return I===y.x&&C===y.y?y:new Mt(y.k,I,C)}function k(y){return[(+y[0][0]+ +y[1][0])/2,(+y[0][1]+ +y[1][1])/2]}function R(y,g,_,I){y.on("start.zoom",function(){O(this,arguments).event(I).start()}).on("interrupt.zoom end.zoom",function(){O(this,arguments).event(I).end()}).tween("zoom",function(){var C=this,M=arguments,D=O(C,M).event(I),L=e.apply(C,M),U=_==null?k(L):typeof _=="function"?_.apply(C,M):_,W=Math.max(L[1][0]-L[0][0],L[1][1]-L[0][1]),q=C.__zoom,B=typeof g=="function"?g.apply(C,M):g,j=l(q.invert(U).concat(W/q.k),B.invert(U).concat(W/B.k));return function(ne){if(ne===1)ne=B;else{var Oe=j(ne),fn=W/Oe[2];ne=new Mt(fn,U[0]-Oe[0]*fn,U[1]-Oe[1]*fn)}D.zoom(null,ne)}})}function O(y,g,_){return!_&&y.__zooming||new $(y,g)}function $(y,g){this.that=y,this.args=g,this.active=0,this.sourceEvent=null,this.extent=e.apply(y,g),this.taps=0}$.prototype={event:function(y){return y&&(this.sourceEvent=y),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(y,g){return this.mouse&&y!=="mouse"&&(this.mouse[1]=g.invert(this.mouse[0])),this.touch0&&y!=="touch"&&(this.touch0[1]=g.invert(this.touch0[0])),this.touch1&&y!=="touch"&&(this.touch1[1]=g.invert(this.touch1[0])),this.that.__zoom=g,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(y){var g=Ie(this.that).datum();c.call(y,this.that,new Ex(y,{sourceEvent:this.sourceEvent,target:x,transform:this.that.__zoom,dispatch:c}),g)}};function p(y,...g){if(!t.apply(this,arguments))return;var _=O(this,g).event(y),I=this.__zoom,C=Math.max(s[0],Math.min(s[1],I.k*Math.pow(2,i.apply(this,arguments)))),M=ft(y);if(_.wheel)(_.mouse[0][0]!==M[0]||_.mouse[0][1]!==M[1])&&(_.mouse[1]=I.invert(_.mouse[0]=M)),clearTimeout(_.wheel);else{if(I.k===C)return;_.mouse=[M,I.invert(M)],gs(this),_.start()}Di(y),_.wheel=setTimeout(D,w),_.zoom("mouse",n(P(A(I,C),_.mouse[0],_.mouse[1]),_.extent,o));function D(){_.wheel=null,_.end()}}function m(y,...g){if(f||!t.apply(this,arguments))return;var _=y.currentTarget,I=O(this,g,!0).event(y),C=Ie(y.view).on("mousemove.zoom",U,!0).on("mouseup.zoom",W,!0),M=ft(y,_),D=y.clientX,L=y.clientY;Wg(y.view),Aa(y),I.mouse=[M,this.__zoom.invert(M)],gs(this),I.start();function U(q){if(Di(q),!I.moved){var B=q.clientX-D,j=q.clientY-L;I.moved=B*B+j*j>b}I.event(q).zoom("mouse",n(P(I.that.__zoom,I.mouse[0]=ft(q,_),I.mouse[1]),I.extent,o))}function W(q){C.on("mousemove.zoom mouseup.zoom",null),Vg(q.view,I.moved),Di(q),I.event(q).end()}}function v(y,...g){if(t.apply(this,arguments)){var _=this.__zoom,I=ft(y.changedTouches?y.changedTouches[0]:y,this),C=_.invert(I),M=_.k*(y.shiftKey?.5:2),D=n(P(A(_,M),I,C),e.apply(this,g),o);Di(y),a>0?Ie(this).transition().duration(a).call(R,D,I,y):Ie(this).call(x.transform,D,I,y)}}function E(y,...g){if(t.apply(this,arguments)){var _=y.touches,I=_.length,C=O(this,g,y.changedTouches.length===I).event(y),M,D,L,U;for(Aa(y),D=0;D<I;++D)L=_[D],U=ft(L,this),U=[U,this.__zoom.invert(U),L.identifier],C.touch0?!C.touch1&&C.touch0[2]!==U[2]&&(C.touch1=U,C.taps=0):(C.touch0=U,M=!0,C.taps=1+!!h);h&&(h=clearTimeout(h)),M&&(C.taps<2&&(u=U[0],h=setTimeout(function(){h=null},d)),gs(this),C.start())}}function S(y,...g){if(this.__zooming){var _=O(this,g).event(y),I=y.changedTouches,C=I.length,M,D,L,U;for(Di(y),M=0;M<C;++M)D=I[M],L=ft(D,this),_.touch0&&_.touch0[2]===D.identifier?_.touch0[0]=L:_.touch1&&_.touch1[2]===D.identifier&&(_.touch1[0]=L);if(D=_.that.__zoom,_.touch1){var W=_.touch0[0],q=_.touch0[1],B=_.touch1[0],j=_.touch1[1],ne=(ne=B[0]-W[0])*ne+(ne=B[1]-W[1])*ne,Oe=(Oe=j[0]-q[0])*Oe+(Oe=j[1]-q[1])*Oe;D=A(D,Math.sqrt(ne/Oe)),L=[(W[0]+B[0])/2,(W[1]+B[1])/2],U=[(q[0]+j[0])/2,(q[1]+j[1])/2]}else if(_.touch0)L=_.touch0[0],U=_.touch0[1];else return;_.zoom("touch",n(P(D,L,U),_.extent,o))}}function T(y,...g){if(this.__zooming){var _=O(this,g).event(y),I=y.changedTouches,C=I.length,M,D;for(Aa(y),f&&clearTimeout(f),f=setTimeout(function(){f=null},d),M=0;M<C;++M)D=I[M],_.touch0&&_.touch0[2]===D.identifier?delete _.touch0:_.touch1&&_.touch1[2]===D.identifier&&delete _.touch1;if(_.touch1&&!_.touch0&&(_.touch0=_.touch1,delete _.touch1),_.touch0)_.touch0[1]=this.__zoom.invert(_.touch0[0]);else if(_.end(),_.taps===2&&(D=ft(D,this),Math.hypot(u[0]-D[0],u[1]-D[1])<N)){var L=Ie(this).on("dblclick.zoom");L&&L.apply(this,arguments)}}}return x.wheelDelta=function(y){return arguments.length?(i=typeof y=="function"?y:is(+y),x):i},x.filter=function(y){return arguments.length?(t=typeof y=="function"?y:is(!!y),x):t},x.touchable=function(y){return arguments.length?(r=typeof y=="function"?y:is(!!y),x):r},x.extent=function(y){return arguments.length?(e=typeof y=="function"?y:is([[+y[0][0],+y[0][1]],[+y[1][0],+y[1][1]]]),x):e},x.scaleExtent=function(y){return arguments.length?(s[0]=+y[0],s[1]=+y[1],x):[s[0],s[1]]},x.translateExtent=function(y){return arguments.length?(o[0][0]=+y[0][0],o[1][0]=+y[1][0],o[0][1]=+y[0][1],o[1][1]=+y[1][1],x):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},x.constrain=function(y){return arguments.length?(n=y,x):n},x.duration=function(y){return arguments.length?(a=+y,x):a},x.interpolate=function(y){return arguments.length?(l=y,x):l},x.on=function(){var y=c.on.apply(c,arguments);return y===c?x:y},x.clickDistance=function(y){return arguments.length?(b=(y=+y)*y,x):Math.sqrt(b)},x.tapDistance=function(y){return arguments.length?(N=+y,x):N},x}function Ko(){return{systemMap:new Map,laneMap:new Map,neighborMap:new Map}}function Om(t,e){t.systemMap.set(e.id,e)}function Rl(t,e,n){const i=[e.id,n.id].sort((s,o)=>s.localeCompare(o)).join("-");if(t.laneMap.has(i))return;const r={id:i,fromId:e.id,toId:n.id,movement:[0,0]};t.laneMap.set(i,r)}function Yo(t){const e=new Map;for(const n of t.laneMap.values())e.has(n.fromId)||e.set(n.fromId,[]),e.get(n.fromId)?.push(n.toId),e.has(n.toId)||e.set(n.toId,[]),e.get(n.toId)?.push(n.fromId);t.neighborMap=e}function He(t,e){const n=t.systemMap.get(e);if(!n)return[];(!t.neighborMap||t.neighborMap.size===0)&&Yo(t);const i=t.neighborMap.get(n.id);return i?i.map(r=>t.systemMap.get(r)).filter(r=>!!r):[]}function Xo(t,e,n){return t.neighborMap.get(e)?.includes(n)||!1}function Dm(t,e){return tu(e,Array.from(t.systemMap.values()))}function tu(t,e){if(e.length===0)return null;let n=null,i=1/0;return e.forEach(r=>{if(r.location[0]===t[0]&&r.location[1]===t[1])return;const s=uo(t,r.location);s<i&&(i=s,n=r)}),n}function xx(t){console.log("Loading world from JSON...",t);const e=Ko();return e.systemMap=new Map(t.systems),e.laneMap=new Map(t.lanes),Yo(e),e}function Nx(t){return{systems:Array.from(t.systemMap.entries()),lanes:Array.from(t.laneMap.entries())}}function Lm(){return{playerName:localStorage.getItem("starz_playerName")??"Player",numBots:wS,fow:yS,numSystems:vS,timeScale:1}}function nu(){return{world:Ko(),playerMap:new Map}}function $m(t,e){t.playerMap.set(e.id,e)}function iu(t){const{C:e}=globalThis.gameManager.getContext();if(!e.playerId)return null;for(const n of t.world.systemMap.values())if(n.homeworld===e.playerId)return n;return null}function Qo(t,e){const{P:n}=globalThis.gameManager.getContext();if(!n)return;n.revealedSystems.add(e.id),n.visitedSystems.add(e.id);const i=He(t.world,e.id);if(i)return i.forEach(r=>n.revealedSystems.add(r.id)),t}function Fm(t){const{P:e}=globalThis.gameManager.getContext();if(e)for(const n of t.world.systemMap.values())e.revealedSystems.add(n.id)}function Um(t,e,n,i,r){t.moveQueue.push({ships:n,toId:e.id,fromId:t.id,playerId:i,message:r})}const rs=100,xa={territory:{aggression:.3,expansion:1,defensiveness:.5,riskTolerance:.4,speed:rs},rusher:{aggression:1,expansion:.4,defensiveness:.1,riskTolerance:.7,speed:rs},turtle:{aggression:.1,expansion:.3,defensiveness:.95,riskTolerance:.2,speed:rs},balanced:{aggression:.5,expansion:.5,defensiveness:.5,riskTolerance:.5,speed:rs}};function Mx({S:t}){for(const e of t.playerMap.values())e.bot?.makeMoves()}let kx=0;class Px{constructor(e={}){this.queuedMoves=0,this.threatLevels=new Map,this.frontline=new Set,this.backline=new Set;const n=e.playerIndex??kx++;this.id=e.id??`${n}`;let i=e.personality;if(!i){const r=Object.keys(xa);i=r[n%r.length]}this.name=e.name??i,this.personality=i==="idle"?xa.balanced:xa[i]}makeMoves(){if(this.name==="idle")return;const n=gameManager.getState().world.systemMap.values();if(this.botSystems=Array.from(n).filter(l=>l.ownerId===this.id),this.botSystems.length===0)return;for(const l of this.botSystems)l.moveQueue=[];this.queuedMoves=0,this.analyzeMap();const i=this.getDefensiveMoves();if(this.chooseMoves(i,1-this.personality.defensiveness),this.queuedMoves>=this.personality.speed)return;const r=this.getCoordinatedAttackMoves();if(this.chooseMoves(r,this.personality.aggression),this.queuedMoves>=this.personality.speed)return;const s=this.getExterminateMoves();if(this.chooseMoves(s,this.personality.defensiveness),this.queuedMoves>=this.personality.speed)return;const o=this.getExploreMoves();if(this.chooseMoves(o,this.personality.expansion),this.queuedMoves>=this.personality.speed)return;const a=this.getLogisticsMoves();this.chooseMoves(a,1),this.queuedMoves>=this.personality.speed}analyzeMap(){this.threatLevels.clear(),this.frontline.clear(),this.backline.clear();const e=gameManager.getState();this.botSystems.forEach(n=>{const i=He(e.world,n.id),r=i.filter(a=>a.ownerId&&a.ownerId!==this.id),s=i.filter(a=>!a.ownerId),o=r.reduce((a,l)=>a+l.ships,0);this.threatLevels.set(n.id,o),r.length>0||s.length>0?this.frontline.add(n.id):this.backline.add(n.id)})}getDefensiveMoves(){const e=gameManager.getState();return this.botSystems.map(n=>{if(n.moveQueue.length>0)return[];const i=[],r=this.threatLevels.get(n.id)??0;if(r>0){const s=r*1.1;if(n.ships<s)if(n.ships<r*.5){const o=He(e.world,n.id).filter(a=>a.ownerId===this.id).sort((a,l)=>(this.threatLevels.get(a.id)||0)-(this.threatLevels.get(l.id)||0))[0];o&&i.push({message:`Retreating from ${n.id}`,from:n,to:o,units:n.ships-1,score:1e3})}else i.push({message:`Holding ${n.id}`,from:n,to:n,units:0,score:r});else n.ships<s*1.5&&i.push({message:`Defending ${n.id} from threat level ${r}`,from:n,to:n,units:0,score:r})}return i})}getCoordinatedAttackMoves(){const e=gameManager.getState(),n=new Map;this.botSystems.forEach(r=>{if(r.moveQueue.length>0||r.ships<5)return;const s=He(e.world,r.id);s&&s.forEach(o=>{if(o.ownerId!==null&&o.ownerId!==this.id){if(He(e.world,r.id).filter(l=>l.ownerId&&l.ownerId!==this.id&&l.id!==o.id).length>0)return;n.has(o.id)||n.set(o.id,{target:o,attackers:[]}),n.get(o.id).attackers.push(r)}})});const i=[];return n.forEach(({target:r,attackers:s})=>{const a=He(e.world,r.id).filter(u=>u.ownerId===r.ownerId).length===0?1.5:1,l=s.reduce((u,f)=>{const d=this.threatLevels.get(f.id)||0,w=Math.max(0,f.ships-d*1.1);return u+Math.floor(w*(1-this.personality.defensiveness))},0),h=(r.ships+(r.homeworld?10:0))*(1.3-this.personality.riskTolerance);l>h&&s.forEach(u=>{if(u.moveQueue.length>0)return;const f=this.threatLevels.get(u.id)||0,d=Math.max(0,u.ships-f*1.1),w=Math.floor(d*(1-this.personality.defensiveness)),b=this.getBestMoveAmount(u,r,w);b>0&&i.push([{message:`Coordinated attack on ${r.id}`,from:u,to:r,units:b,score:(100+(r.homeworld?50:0))*a}])})}),i}getExterminateMoves(){const e=gameManager.getState();return this.botSystems.map(n=>n.moveQueue.length>0?[]:n.ships<3?[]:He(e.world,n.id).flatMap(r=>{if(r.ownerId===this.id)return[];if(r.ownerId===null&&r.type==="UNINHABITED")return[];if(n.ships>r.ships*1.5+5){const s=n.ships-2;return[{message:`Crushing weak neighbor ${r.id}`,from:n,to:r,units:s,score:40}]}return[]}))}getExploreMoves(){const e=gameManager.getState();return this.botSystems.map(n=>n.moveQueue.length>0?[]:n.ships<2?[]:He(e.world,n.id).flatMap(r=>{if(r.ownerId!==null)return[];if(r.type==="INHABITED")return[];const s=Math.max(1,Math.floor(n.ships*.3));return[{message:`Exploring ${r.id}`,from:n,to:r,units:s,score:30}]}))}getLogisticsMoves(){const e=gameManager.getState();return this.botSystems.map(n=>{if(n.moveQueue.length>0)return[];if(n.ships<2)return[];if(this.backline.has(n.id)){const i=He(e.world,n.id).filter(o=>this.frontline.has(o.id)&&o.ownerId===this.id);if(i.length>0){const o=i.sort((a,l)=>a.ships-l.ships)[0];return[{message:"Logistics: Frontline Support",from:n,to:o,units:n.ships-1,score:10}]}const s=He(e.world,n.id).filter(o=>o.ownerId===this.id).sort((o,a)=>o.ships-a.ships)[0];if(s&&s.ships<n.ships-2)return[{message:"Logistics: Balancing",from:n,to:s,units:Math.floor((n.ships-s.ships)/2),score:5}]}if(this.frontline.has(n.id)){const i=He(e.world,n.id).filter(r=>r.ownerId===this.id&&(this.threatLevels.get(r.id)||0)>r.ships);if(i.length>0&&(this.threatLevels.get(n.id)||0)<n.ships){const r=i[0];return[{message:"Logistics: Emergency Reinforce",from:n,to:r,units:Math.floor(n.ships/2),score:50}]}}return[]})}getBestMoveAmount(e,n,i){const r=Math.max(0,e.ships-1);let s=0;return n.ownerId===e.ownerId?s=Math.floor((e.ships-n.ships)/2):s=Math.floor(e.ships/2),s=Math.max(0,s),Math.abs(r-i)<Math.abs(s-i)?r:s}chooseMoves(e,n=1){if(e.length===0)return;const i=e.flat().sort(Rx);for(const r of i){if(this.queuedMoves>=this.personality.speed)return;if(Math.random()<n){if(r.from.moveQueue.length>0)continue;Um(r.from,r.to,r.units,this.id,r.message),r.units>0&&this.queuedMoves++}}}}function Rx(t,e){return t.score!==e.score?e.score-t.score:Math.random()-.5}function di(t,...e){const n=globalThis.gameManager?.getContext?.().C;bS&&console.log(`[DEBUG][Tick ${n?.tick??null}] ${t}`,...e)}function Na(t,e={}){if(!SS)return;const n=globalThis.gameManager?.getContext?.().C;let i=1;try{i=parseInt(localStorage.getItem(t)??"0",10)+1}catch(r){console.error("Error reading event count from localStorage:",r)}if(localStorage.setItem(t,i+""),window&&window.sa_event)try{window.sa_event(t,{[t]:i,tick:n?.tick??null,...e})}catch(r){console.error("Error tracking event:",r)}}function Bm(t,e,n,i){if(i!==0){if(i<0){if(e.ownerId!==n.ownerId)return;const r=e;e=n,n=r,i=-i}e.ships<i||(n.ownerId===e.ownerId?Lx(t,e,n,i):Ox(t,e,n,i))}}function Ox(t,e,n,i){const r=e.ownerId,s=n.ships??0;if(zm(t.S.world,e,n,i),i>s){const o=i-s;e.ships=e.ships-i,n.ships=o,Dx(t,r,n)}else e.ships=e.ships-i,n.ships=s-i}function Dx(t,e,n){n.ownerId=e,n.moveQueue=[],e===t.C.playerId&&Qo(t.S,n),n.homeworld&&n.homeworld!==e&&Hm(t,n.homeworld,e)}function Hm({S:t,E:e,C:n},i,r=null){for(const o of t.world.systemMap.values())o.ownerId===i&&(o.ownerId=r,o.ships=Math.max(Math.floor((o.ships??0)/2),1),o.homeworld=null,o.moveQueue=[],r===n.playerId&&Qo(t,o)),o.homeworld===i&&(o.homeworld=null);const s=t.playerMap.get(i);s.isAlive=!1,e.emit("PLAYER_ELIMINATED",{loserId:i,winnerId:r})}function zm(t,e,n,i){e.movement=[e.movement[0],e.movement[1]+i],n.movement=[n.movement[0]+i,n.movement[1]];for(const r of t.laneMap.values())r.fromId===e.id&&r.toId===n.id?r.movement=[r.movement[0]+i,r.movement[1]]:r.fromId===n.id&&r.toId===e.id&&(r.movement=[r.movement[0],r.movement[1]+i])}function Lx({S:t,C:e},n,i,r){n.ships<r||(n.ships-=r,i.ships+=r,zm(t.world,n,i,r),i.ownerId===e.playerId&&Qo(t,i))}function Wm(t){for(const e of t.S.world.systemMap.values())for(e.lastMove=null;e.moveQueue.length>0;){const n=e.moveQueue.shift();n&&Vm(t,n)}}function Vm(t,e){e.playerId===t.C.playerId&&di(`player move: ${JSON.stringify(e)}`);const n=t.S.world.systemMap.get(e.fromId),i=t.S.world.systemMap.get(e.toId);Bm(t,n,i,e.ships),n.lastMove=e,t.E.emit("MAKE_MOVE",e)}function $x(t,e){const n=qm(t.S,e);n&&Vm(t,n)}function Fx(t,e){const n=t.world.systemMap.get(e.fromId);return!(n.ownerId!==e.playerId||!Xo(t.world,e.fromId,e.toId)||n.ships<=1)}function qm(t,e){if(!Fx(t,e))return null;switch(e.type){case"MASS_MOVE":return n(e.fromId,e.toId);case"BALANCED_MOVE":return i(e.fromId,e.toId)}return null;function n(r,s){const{C:o}=globalThis.gameManager.getContext(),l=t.world.systemMap.get(r).ships-1;return l<=0?null:{message:`Move ${l} ships from ${r} to ${s}`,ships:l,toId:s,fromId:r,playerId:o.playerId}}function i(r,s){const{C:o}=globalThis.gameManager.getContext(),a=t.world.systemMap.get(r),l=t.world.systemMap.get(s),c=l.ownerId===a.ownerId?Math.floor((a.ships-l.ships)/2):Math.floor(a.ships/2);return c<=0?null:{message:`Move ${c} ships from ${a.id} to ${l.id}`,ships:c,toId:l.id,fromId:a.id,playerId:o.playerId}}}function Gm(t){for(const e of t.playerMap.values()){const n={playerId:e.id,systems:0,ships:0,homeworld:0};for(const i of t.world.systemMap.values())i.ownerId===e.id&&(n.systems+=1,n.ships+=i.ships??0,i.homeworld===e.id&&(n.homeworld=i.ships??0));e.stats=n}}function jm(t){for(const e of t.world.systemMap.values())e.type==="INHABITED"&&(e.ownerId||e.ships<Cg)&&(e.ships=(e.ships??0)+mS)}function Km(t){for(const e of t.world.systemMap.values())e.ownerId!=null&&(e.ships=(e.ships??0)+_S)}function Ux({S:t,C:e,E:n,P:i}){if(e.status==="PLAYING"&&i)if(t.playerMap.size>1){const r=Array.from(t.playerMap.values());if(r.reduce((o,a)=>(o+=a.stats.homeworld>0?1:0,o),0)===1){const o=r.find(l=>l.stats.homeworld>0).id,a=t.playerMap.get(o);n.emit("PLAYER_WIN",{playerId:o,message:`${a.name} has conquered The Bubble!`}),n.emit("GAME_STOP",void 0)}}else Array.from(t.world.systemMap.values()).filter(s=>s.ownerId!==e.playerId).length===0&&(n.emit("PLAYER_WIN",{playerId:e.playerId,message:`${i.name} has conquered The Bubble!`}),n.emit("GAME_STOP",void 0))}function Bx(t,e=!1){const{S:n,C:i}=t;i.tick%pS===0&&jm(n),i.tick%gS===0&&Km(n);for(const r of n.world.systemMap.values())r.movement=[0,0];for(const r of n.world.laneMap.values())r.movement=[0,0];e||(Mx(t),Wm(t)),Gm(n)}const Hx=Ao({length:5});function Ym({S:t,C:e}){t.world=Ko();const n=Jt/(e.config.numSystems-1),i=-Jt/2,r=Jt/2;di("Generating map...");const s=Math.min(.08,Math.sqrt(Math.PI/e.config.numSystems));for(let h=i;h<r;h+=n){const u=Math.asin(h/(Jt/2))*(180/Math.PI),d=[Math.random()*360-180,u],w=Wx(d),b=Dm(t.world,w.location);if(b){if(uo(d,b.location)<s){h-=n;continue}Rl(t.world,w,b)}Om(t.world,w)}const o=Array.from(t.world.systemMap.values()),a=[o[o.length-1]];for(let h=o.length-2;h>=0;h--){const u=o[h],f=tu(u.location,a);f&&Rl(t.world,u,f),a.push(u)}Yo(t.world),di(`Generated ${t.world.systemMap.size} systems and ${t.world.laneMap.size} lanes.`);const l=[...o],c=Math.max(ES*e.config.numSystems,Za+e.config.numBots);for(let h=0;h<c&&l.length!==0;h++){const u=Math.floor(Math.random()*l.length);if(u===0){h--;continue}const f=l[u];f.ownerId=null,f.type="INHABITED",f.ships=Cg+Math.floor(Math.random()*10),f.homeworld=null,l.splice(u,1)}}function zx(t,e){const n=Array.from(t.world.systemMap.values()).filter(s=>!s.ownerId&&s.type==="INHABITED");if(n.length===0)throw"No available homeworlds to join.";const i=Math.floor(Math.random()*n.length),r=n[i];return r.ships=1,r.ownerId=r.homeworld=e,r.type="INHABITED",r}function Wx(t){return{id:"s"+Hx(),type:"UNINHABITED",location:t,ownerId:null,ships:0,homeworld:null,moveQueue:[],lastMove:null,movement:[0,0]}}function Vx(t){const e=nu();return Ym({...t,S:e}),e}const qx=Object.freeze(Object.defineProperty({__proto__:null,addLane:Rl,addPlayer:$m,addSystem:Om,assignSystem:zx,buildNeighborMap:Yo,checkVictory:Ux,createWorld:Ko,defaultConfig:Lm,doQueuedMoves:Wm,eliminatePlayer:Hm,findClosestSystem:Dm,findClosestSystemInList:tu,gameTick:Bx,generateMap:Ym,getAdjacentSystems:He,getPlayersHomeworld:iu,hasLane:Xo,initalState:nu,moveShips:Bm,orderToMove:qm,queueMove:Um,revealAllSystems:Fm,roundUpdate:Km,setup:Vx,takeOrder:$x,turnUpdate:jm,updateStats:Gm,visitSystem:Qo,worldFromJson:xx,worldToJson:Nx},Symbol.toStringTag,{value:"Module"})),ru=Math.PI,Bf=ru/2,Hf=180/ru,zf=ru/180,Gx=Math.atan2,Wf=Math.cos,jx=Math.max,Kx=Math.min,Vf=Math.sin,Yx=Math.sign||function(t){return t>0?1:t<0?-1:0},Xm=Math.sqrt;function Xx(t){return t>1?Bf:t<-1?-Bf:Math.asin(t)}function Qm(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ze(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function yo(t,e){return[t[0]+e[0],t[1]+e[1],t[2]+e[2]]}function vo(t){var e=Xm(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return[t[0]/e,t[1]/e,t[2]/e]}function su(t){return[Gx(t[1],t[0])*Hf,Xx(jx(-1,Kx(1,t[2])))*Hf]}function wt(t){const e=t[0]*zf,n=t[1]*zf,i=Wf(n);return[i*Wf(e),i*Vf(e),Vf(n)]}function ou(t){return t=t.map(e=>wt(e)),Qm(t[0],ze(t[2],t[1]))}function Qx(t){const e=Zx(t),n=tN(e),i=eN(n,t),r=iN(n,t.length),s=Jx(r,t),o=nN(n,t),{polygons:a,centers:l}=rN(o,n,t),c=sN(a),h=aN(n,t),u=oN(i,n);return{delaunay:e,edges:i,triangles:n,centers:l,neighbors:r,polygons:a,mesh:c,hull:h,urquhart:u,find:s}}function Jx(t,e){function n(i,r){let s=i[0]-r[0],o=i[1]-r[1],a=i[2]-r[2];return s*s+o*o+a*a}return function(r,s,o){o===void 0&&(o=0);let a,l,c=o;const h=wt([r,s]);do a=o,o=null,l=n(h,wt(e[a])),t[a].forEach(u=>{let f=n(h,wt(e[u]));if(f<l){l=f,o=u,c=u;return}});while(o!==null);return c}}function Zx(t){if(t.length<2)return{};let e=0;for(;isNaN(t[e][0]+t[e][1])&&e++<t.length;);const n=co(t[e]),i=km().translate([0,0]).scale(1).rotate(n.invert([180,0]));t=t.map(i);const r=[];let s=1;for(let u=0,f=t.length;u<f;u++){let d=t[u][0]**2+t[u][1]**2;!isFinite(d)||d>1e32?r.push(u):d>s&&(s=d)}const o=1e6*Xm(s);r.forEach(u=>t[u]=[o,0]),t.push([0,o]),t.push([-o,0]),t.push([0,-o]);const a=Gc.from(t);a.projection=i;const{triangles:l,halfedges:c,inedges:h}=a;for(let u=0,f=c.length;u<f;u++)if(c[u]<0){const d=u%3==2?u-2:u+1,w=u%3==0?u+2:u-1,b=c[d],N=c[w];c[b]=N,c[N]=b,c[d]=c[w]=-1,l[u]=l[d]=l[w]=e,h[l[b]]=b%3==0?b+2:b-1,h[l[N]]=N%3==0?N+2:N-1,u+=2-u%3}else l[u]>t.length-3-1&&(l[u]=e);return a}function eN(t,e){const n=new Set;return e.length===2?[[0,1]]:(t.forEach(i=>{if(i[0]!==i[1]&&!(ou(i.map(r=>e[r]))<0))for(let r=0,s;r<3;r++)s=(r+1)%3,n.add(xg([i[r],i[s]]).join("-"))}),Array.from(n,i=>i.split("-").map(Number)))}function tN(t){const{triangles:e}=t;if(!e)return[];const n=[];for(let i=0,r=e.length/3;i<r;i++){const s=e[3*i],o=e[3*i+1],a=e[3*i+2];s!==o&&o!==a&&n.push([s,a,o])}return n}function nN(t,e){return t.map(n=>{const i=n.map(s=>e[s]).map(wt),r=yo(yo(ze(i[1],i[0]),ze(i[2],i[1])),ze(i[0],i[2]));return su(vo(r))})}function iN(t,e){const n=[];return t.forEach(i=>{for(let r=0;r<3;r++){const s=i[r],o=i[(r+1)%3];n[s]=n[s]||[],n[s].push(o)}}),t.length===0&&(e===2?(n[0]=[1],n[1]=[0]):e===1&&(n[0]=[])),n}function rN(t,e,n){const i=[],r=t.slice();if(e.length===0){if(n.length<2)return{polygons:i,centers:r};if(n.length===2){const a=wt(n[0]),l=wt(n[1]),c=vo(yo(a,l)),h=vo(ze(a,l)),u=ze(c,h),f=[c,ze(c,u),ze(ze(c,u),u),ze(ze(ze(c,u),u),u)].map(su).map(o);return i.push(f),i.push(f.slice().reverse()),{polygons:i,centers:r}}}e.forEach((a,l)=>{for(let c=0;c<3;c++){const h=a[c],u=a[(c+1)%3],f=a[(c+2)%3];i[h]=i[h]||[],i[h].push([u,f,l,[h,u,f]])}});const s=i.map(a=>{const l=[a[0][2]];let c=a[0][1];for(let h=1;h<a.length;h++)for(let u=0;u<a.length;u++)if(a[u][0]==c){c=a[u][1],l.push(a[u][2]);break}if(l.length>2)return l;if(l.length==2){const h=qf(n[a[0][3][0]],n[a[0][3][1]],r[l[0]]),u=qf(n[a[0][3][2]],n[a[0][3][0]],r[l[0]]),f=o(h),d=o(u);return[l[0],d,l[1],f]}});function o(a){let l=-1;return r.slice(e.length,1/0).forEach((c,h)=>{c[0]===a[0]&&c[1]===a[1]&&(l=h+e.length)}),l<0&&(l=r.length,r.push(a)),l}return{polygons:s,centers:r}}function qf(t,e,n){t=wt(t),e=wt(e),n=wt(n);const i=Yx(Qm(ze(e,t),n));return su(vo(yo(t,e)).map(r=>i*r))}function sN(t){const e=[];return t.forEach(n=>{if(!n)return;let i=n[n.length-1];for(let r of n)r>i&&e.push([i,r]),i=r}),e}function oN(t,e){return function(n){const i=new Map,r=new Map;return t.forEach((s,o)=>{const a=s.join("-");i.set(a,n[o]),r.set(a,!0)}),e.forEach(s=>{let o=0,a=-1;for(let l=0;l<3;l++){let c=xg([s[l],s[(l+1)%3]]).join("-");i.get(c)>o&&(o=i.get(c),a=c)}r.set(a,!1)}),t.map(s=>r.get(s.join("-")))}}function aN(t,e){const n=new Set,i=[];t.map(a=>{if(!(ou(a.map(l=>e[l>e.length?0:l]))>1e-12))for(let l=0;l<3;l++){let c=[a[l],a[(l+1)%3]],h=`${c[0]}-${c[1]}`;n.has(h)?n.delete(h):n.add(`${c[1]}-${c[0]}`)}});const r=new Map;let s;if(n.forEach(a=>{a=a.split("-").map(Number),r.set(a[0],a[1]),s=a[0]}),s===void 0)return i;let o=s;do{i.push(o);let a=r.get(o);r.set(o,-1),o=a}while(o>-1&&o!==s);return i}function lN(t){const e=function(n){if(e.delaunay=null,e._data=n,typeof e._data=="object"&&e._data.type==="FeatureCollection"&&(e._data=e._data.features),typeof e._data=="object"){const i=e._data.map(r=>[e._vx(r),e._vy(r),r]).filter(r=>isFinite(r[0]+r[1]));e.points=i.map(r=>[r[0],r[1]]),e.valid=i.map(r=>r[2]),e.delaunay=Qx(e.points)}return e};return e._vx=function(n){if(typeof n=="object"&&"type"in n)return Ef(n)[0];if(0 in n)return n[0]},e._vy=function(n){if(typeof n=="object"&&"type"in n)return Ef(n)[1];if(1 in n)return n[1]},e.x=function(n){return n?(e._vx=n,e):e._vx},e.y=function(n){return n?(e._vy=n,e):e._vy},e.polygons=function(n){if(n!==void 0&&e(n),!e.delaunay)return!1;const i={type:"FeatureCollection",features:[]};return e.valid.length===0||(e.delaunay.polygons.forEach((r,s)=>i.features.push({type:"Feature",geometry:r?{type:"Polygon",coordinates:[[...r,r[0]].map(o=>e.delaunay.centers[o])]}:null,properties:{site:e.valid[s],sitecoordinates:e.points[s],neighbours:e.delaunay.neighbors[s]}})),e.valid.length===1&&i.features.push({type:"Feature",geometry:{type:"Sphere"},properties:{site:e.valid[0],sitecoordinates:e.points[0],neighbours:[]}})),i},e.triangles=function(n){return n!==void 0&&e(n),e.delaunay?{type:"FeatureCollection",features:e.delaunay.triangles.map((i,r)=>(i=i.map(s=>e.points[s]),i.center=e.delaunay.centers[r],i)).filter(i=>ou(i)>0).map(i=>({type:"Feature",properties:{circumcenter:i.center},geometry:{type:"Polygon",coordinates:[[...i,i[0]]]}}))}:!1},e.links=function(n){if(n!==void 0&&e(n),!e.delaunay)return!1;const i=e.delaunay.edges.map(s=>uo(e.points[s[0]],e.points[s[1]])),r=e.delaunay.urquhart(i);return{type:"FeatureCollection",features:e.delaunay.edges.map((s,o)=>({type:"Feature",properties:{source:e.valid[s[0]],target:e.valid[s[1]],length:i[o],urquhart:!!r[o]},geometry:{type:"LineString",coordinates:[e.points[s[0]],e.points[s[1]]]}}))}},e.mesh=function(n){return n!==void 0&&e(n),e.delaunay?{type:"MultiLineString",coordinates:e.delaunay.edges.map(i=>[e.points[i[0]],e.points[i[1]]])}:!1},e.cellMesh=function(n){if(n!==void 0&&e(n),!e.delaunay)return!1;const{centers:i,polygons:r}=e.delaunay,s=[];for(const o of r)if(o)for(let a=o.length,l=o[a-1],c=o[0],h=0;h<a;l=c,c=o[++h])c>l&&s.push([i[l],i[c]]);return{type:"MultiLineString",coordinates:s}},e._found=void 0,e.find=function(n,i,r){if(e._found=e.delaunay.find(n,i,e._found),!r||uo([n,i],e.points[e._found])<r)return e._found},e.hull=function(n){n!==void 0&&e(n);const i=e.delaunay.hull,r=e.points;return i.length===0?null:{type:"Polygon",coordinates:[[...i.map(s=>r[s]),r[i[0]]]]}},t?e(t):e}const Jm=Math.acos,cN=Math.asin,Gf=Math.atan2,In=Math.cos,jf=Math.hypot,Ol=Math.max,Dl=Math.min,Zm=Math.PI,Sn=Math.sin,Zi=Zm/180,Ma=180/Zm;class Ze{static fromCartesian([e,n,i]){return[0,i,-n,e]}static fromAngles([e,n,i]){e*=Zi/2,n*=Zi/2,i=(i||0)*Zi/2;const r=Sn(e),s=In(e),o=Sn(n),a=In(n),l=Sn(i),c=In(i);return[s*a*c+r*o*l,r*a*c-s*o*l,s*o*c+r*a*l,s*a*l-r*o*c]}static toAngles([e,n,i,r]){return[Gf(2*(e*n+i*r),1-2*(n*n+i*i))*Ma,cN(Ol(-1,Dl(1,2*(e*i-r*n))))*Ma,Gf(2*(e*r+n*i),1-2*(i*i+r*r))*Ma]}static interpolateAngles(e,n){const i=Ze.interpolate(Ze.fromAngles(e),Ze.fromAngles(n));return r=>Ze.toAngles(i(r))}static interpolateLinear([e,n,i,r],[s,o,a,l]){s-=e,o-=n,a-=i,l-=r;const c=new Array(4);return h=>{const u=jf(c[0]=e+s*h,c[1]=n+o*h,c[2]=i+a*h,c[3]=r+l*h);return c[0]/=u,c[1]/=u,c[2]/=u,c[3]/=u,c}}static interpolate([e,n,i,r],[s,o,a,l]){let c=Ze.dot([e,n,i,r],[s,o,a,l]);if(c<0&&(s=-s,o=-o,a=-a,l=-l,c=-c),c>.9995)return Ze.interpolateLinear([e,n,i,r],[s,o,a,l]);const h=Jm(Ol(-1,Dl(1,c))),u=new Array(4),f=jf(s-=e*c,o-=n*c,a-=i*c,l-=r*c);return s/=f,o/=f,a/=f,l/=f,d=>{const w=h*d,b=Sn(w),N=In(w);return u[0]=e*N+s*b,u[1]=n*N+o*b,u[2]=i*N+a*b,u[3]=r*N+l*b,u}}static dot([e,n,i,r],[s,o,a,l]){return e*s+n*o+i*a+r*l}static multiply([e,n,i,r],[s,o,a,l]){return[e*s-n*o-i*a-r*l,e*o+n*s+i*l-r*a,e*a-n*l+i*s+r*o,e*l+n*a-i*o+r*s]}}const Ye=Ze.fromAngles;Ye.multiply=Ze.multiply;Ye.rotation=Ze.toAngles;Ye.interpolate=Ze.interpolateAngles;Ye.cartesian=function(t){const e=t[0]*Zi,n=t[1]*Zi,i=In(n);return[i*In(e),i*Sn(e),Sn(n)]};Ye.delta=function(t,e,n){arguments.length==2&&(n=1);const i=Math.sqrt;function r(h,u){return[h[1]*u[2]-h[2]*u[1],h[2]*u[0]-h[0]*u[2],h[0]*u[1]-h[1]*u[0]]}function s(h,u){return h[0]*u[0]+h[1]*u[1]+h[2]*u[2]}const o=r(t,e),a=i(s(o,o));if(!a)return[1,0,0,0];const l=n*Jm(Ol(-1,Dl(1,s(t,e))))/2,c=Sn(l);return[In(l),o[2]/a*c,-o[1]/a*c,o[0]/a*c]};const _e={all:new Set,last:null};function bn(){_e.all.clear(),_e.last=null}function Er(t){_e.all.add(t),_e.last=t}function uN(t){_e.all.clear(),_e.all.add(t),_e.last=t}function hN(t){_e.all.delete(t),_e.last===t&&(_e.last=null)}function e_(t){return _e.all.has(t)}function fN(t){e_(t)?hN(t):Er(t)}function dN({S:t,C:e},n){if(_e.last==null)return;const i=[[_e.last]],r=new Set;for(r.add(_e.last);i.length>0;){const s=i.shift(),o=s[s.length-1];if(o===n){s.forEach(a=>_e.all.add(a)),_e.last=n;return}for(const a of He(t.world,o))!r.has(a.id)&&a.ownerId===e.playerId&&(r.add(a.id),i.push([...s,a.id]))}}const Kf=.5,pN=.25,gN=100,mN=20,_N=Kc(".3~s"),pi={Orthographic:vx,Stereographic:km,Mercator:yx,TransverseMercator:wx};let Ll,et,gi=pi[fS],ue=gi().translate([0,0]),Bt=ue.scale(),Jo=Xc().projection(ue),vs;const yN=lN().x(t=>t.location[0]).y(t=>t.location[1]);function vN(){const t=Object.keys(pi),n=(t.findIndex(i=>pi[i]===gi)+1)%t.length;wN(t[n])}function wN(t){gi=pi[t],ue=gi(),ue.translate([0,0]).rotate([0,0,0]).scale(Bt),Bt=ue.scale(),Jo=Xc().projection(ue)}function Hn(t){const e=ue.rotate();e[0]+=t[0],e[1]+=t[1],t.length===3&&(e[2]+=t[2]),ue.rotate(e)}function EN(t,e){Ll=Ie(t),et=Ll.select("svg"),et.attr("width","100vw").attr("height","100vh").attr("viewBox",`-${Vs/2} -${Jt/2} ${Vs} ${Jt}`).on("contextmenu",o=>o.preventDefault()),$l(e.S),n_(e),i_(e),t_(e),et.call(n()),et.call(i()),window.addEventListener("resize",s);function n(){return r().on("drag.render",()=>ie()).on("end.render",()=>ie())}function i(){return Ax().filter(o=>o.type==="wheel").on("zoom",o=>{if(o.transform.k>Kf){const a=Bt*o.transform.k;ue.scale(a),ie()}else o.transform.k=Kf})}function r(){let o,a,l,c,h;function u(b,N){const x=lC(b,N);if(x.length!==h&&(h=x.length,h>1&&(c=Math.atan2(x[1][1]-x[0][1],x[1][0]-x[0][0])),f.apply(N,[b,N])),h>1){const A=Bh(x,R=>R[0]),P=Bh(x,R=>R[1]),k=Math.atan2(x[1][1]-x[0][1],x[1][0]-x[0][0]);return[A,P,k]}return x[0]}function f({x:b,y:N}){const x=w([b,N]);o=Ye.cartesian(ue.invert(x)),l=ue.rotate(),a=Ye(l)}function d(b){const N=w([b.x,b.y]),x=Ye.cartesian(ue.rotate(l).invert(N)),A=Ye.delta(o,x);let P=Ye.multiply(a,A);const k=u(b,this);if(k[2]){const R=(k[2]-c)/2,O=-Math.sin(R),$=Math.sign(Math.cos(R));P=Ye.multiply([Math.sqrt(1-O*O),0,0,$*O],P)}ue.rotate(Ye.rotation(P)),A[0]<.7&&f.apply(this,[b,this])}function w(b){const N=parseInt(et.style("width")),x=parseInt(et.style("height"));return[b[0]-N/2,b[1]-x/2]}return pC().filter(b=>b.button===1||b.touches).on("start",f).on("drag",d)}function s(){const{S:o}=globalThis.gameManager.getContext();$l(o)}}function $l(t){const e=et.node()?.getBoundingClientRect(),n=window.devicePixelRatio||1,i=e?.height||Jt,r=e?.width||Vs,a=Ll.selectAll("canvas").data([null]).join(h=>h.append("canvas").style("position","absolute").style("top",0).style("left",0).style("z-index",-1).style("pointer-events","none")).attr("width",r*n).attr("height",i*n).style("width",`${r}px`).style("height",`${i}px`).node().getContext("2d");a.setTransform(1,0,0,1,0,0),a.scale(n,n),a.translate(r/2,i/2);const l=Math.min(r/Vs,i/Jt);a.scale(l,l);const c="#FFFFFF48";if(gi===pi.Orthographic){const h=ue.scale();a.strokeStyle=c,a.lineWidth=1,a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=10,a.shadowColor=c,a.beginPath(),a.arc(0,0,h,0,Math.PI*2),a.stroke(),a.fill()}{a.shadowBlur=0,a.strokeStyle="rgba(51, 51, 51, 0.5)";const h=IN(t),u=Xc().projection(ue).context(a);a.beginPath(),u(h),a.stroke()}}function IN(t){const e=XA(),n=iu(t);if(n){if(!vs){const i=co([0,90+n.location[1],0]),r=co([n.location[0],0,0]);vs={type:"FeatureCollection",features:e.lines().map(s=>({type:"Feature",geometry:{type:"LineString",coordinates:s.coordinates.map(o=>r(i(o)))}}))}}return vs}return e()}function Yf(t){const e=ue.scale()*t;e<Bt*pN||e>Bt*gN||(ue.scale(e),ie())}function Fl(){const t=globalThis.gameManager.getContext(),e=iu(t.S);if(!e)return;vs=null;const n=e.location;gi===pi.Orthographic?Ul([n[0],n[1]-45]):Ul(n),ue.scale(Bt)}function SN(t){const n=globalThis.gameManager.getContext().S.world.systemMap.get(t);n&&(Ul(n.location),ue.scale(Bt))}function Ul(t){ue.rotate([-t[0],-t[1],0]),ie()}let Xf=null;function ie(){return cancelAnimationFrame(Xf),Xf=requestAnimationFrame(()=>t());function t(e){et&&(e??=globalThis.gameManager.getContext(),n_(e),$l(e.S),t_(e),i_(e))}}function t_({S:t,C:e,P:n}){const r=ue.scale()/Bt<1;let s=t.world.systemMap.values();n&&e.config.fow&&(s=n.revealedSystems.values().map(l=>t.world.systemMap.get(l))),s=s.filter(l=>!!Jo({type:"Point",coordinates:l.location}));const a=et.selectAll("g#systems").data([null]).join(l=>l.append("g").attr("id","systems")).classed("reduced-size",r).classed("hidden",!1).selectAll(".system").data(s,l=>l.id).join(l=>{const c=l.append("g").attr("class","system").attr("id",h=>h.id).on("click",(h,u)=>{wo(h,u),ie()}).on("contextmenu",(h,u)=>{h.preventDefault(),wo(h,u),ie()});return c.append("circle").attr("class","system-outline").attr("cx",0).attr("cy",0).attr("r",mN/2),c.append("text").attr("class","ship-count").attr("y",-10).attr("x",0).attr("text-anchor","start"),c.append("text").attr("class","system-icon").attr("y",0).attr("x",0).attr("text-anchor","end"),c});a.style("--owner-color",l=>t.playerMap.get(l.ownerId)?.color??null).classed("own",l=>l.ownerId===e.playerId).classed("selected",l=>e_(l.id)).classed("moved",l=>l.movement[0]>0||l.movement[1]>0).classed("inhabited",l=>l.type==="INHABITED").classed("homeworld",l=>!!l.homeworld&&l.ownerId===l.homeworld).classed("visited",l=>n?n.visitedSystems.has(l.id):!0).attr("transform",l=>`translate(${ue(l.location)})`),a.select(".system-icon").text(l=>l.homeworld&&l.ownerId===l.homeworld?"â¶":l.type==="INHABITED"?"â¦":"â"),a.select(".ship-count").text(l=>r?"":(l.type==="INHABITED"?"â´":"")+(l.ships?_N(l.ships):""))}const bN=(()=>{let t=[],e;return n=>{if(!t||e!==n.world.systemMap){e=n.world.systemMap;const i=Array.from(e.values());t=yN.polygons(i).features}return t}})();function n_({S:t,C:e,P:n}){const r=ue.scale()/Bt<1;let s=bN(t);n&&e.config.fow&&(s=s.filter(l=>{const c=l.properties?.site;return n.revealedSystems.has(c.id)})),et.selectAll("g#mesh").data([null]).join(l=>l.append("g").attr("id","mesh")).classed("reduced-size",r).classed("hidden",!1).selectAll("path").data(s).join(l=>l.append("path").classed("region",!0).on("click",(c,h)=>{wo(c,h),ie()}).on("contextmenu",(c,h)=>{c.preventDefault(),wo(c,h),ie()})).attr("d",l=>Jo(l)).datum(l=>l.properties.site).classed("visited",l=>n?n.visitedSystems.has(l.id):!0).style("--owner-color",l=>t.playerMap.get(l.ownerId)?.color??null)}function i_({S:t,C:e,P:n}){let i=t.world.laneMap.values();n&&e.config.fow&&(i=i.filter(o=>n.revealedSystems.has(o.fromId)&&n.revealedSystems.has(o.toId)));const s=et.selectAll("g#lanes").data([null]).join(o=>o.append("g").attr("id","lanes")).selectAll("g.lane-group").data(i,o=>o.id).join(o=>{const a=o.append("g").attr("class","lane-group").attr("id",l=>l.id).on("click",(l,c)=>{Qf(l,c),ie()}).on("contextmenu",(l,c)=>{l.preventDefault(),Qf(l,c),ie()});return a.append("path").attr("class","lane"),a.append("path").attr("class","pulse"),a}).datum(o=>{const a=t.world.systemMap.get(o.toId),l=t.world.systemMap.get(o.fromId),c=Jo({type:"LineString",coordinates:[l.location,a.location]});return{...o,from:t.world.systemMap.get(o.fromId),to:t.world.systemMap.get(o.toId),path:c}});s.style("--owner-color",o=>{const a=o.from;if(!a.ownerId)return null;const l=o.to;return!l.ownerId||a.ownerId!==l.ownerId?null:t.playerMap.get(a.ownerId)?.color??null}),s.select("path.lane").attr("d",o=>o.path).classed("own",o=>{const a=o.from,l=o.to;return a.ownerId===e.playerId||l.ownerId===e.playerId}).style("--path-length",o=>{const a=Ie(`#${o.id} .lane`).node();return a?a.getTotalLength():200}),s.select("path.pulse").attr("d",o=>o.path).classed("moved",o=>o.movement[0]>0||o.movement[1]>0).style("stroke-width",o=>{if(o.movement[0]===0&&o.movement[1]===0)return null;const a=2,l=Math.floor(Math.log2(Math.max(o.movement[0],o.movement[1])));return`${(a+l)*2}px`}).classed("moved--fwd",o=>o.movement[0]>o.movement[1]).classed("moved--bak",o=>o.movement[1]>o.movement[0])}function CN(){document.getElementById("optionsButton")?.addEventListener("click",r_),document.getElementById("helpButton").addEventListener("click",s_)}async function r_(){if(await TN()){const e=document.getElementById("optionsForm"),n=new FormData(e),i=globalThis.gameManager,r=+n.get("numBots"),s=n.get("playerName"),o=n.get("fow")==="on",a=+n.get("numSystems");i.setConfig({numBots:r,playerName:s,fow:o,numSystems:48*2**a})}}function TN(){const t=document.getElementById("optionsDialog");return t.showModal(),new Promise(e=>{t.addEventListener("close",()=>e(!0)),t.addEventListener("cancel",()=>e(!1))})}function s_(){document.getElementById("helpDialog").showModal()}function Bl(t){const e=document.getElementById("endDialog");return e.showModal(),e.querySelector("p#endMessage").textContent=t,new Promise(n=>{e.addEventListener("close",()=>n(!0)),e.addEventListener("cancel",()=>n(!1))})}function AN(){const t=document.getElementById("startDialog");return t.showModal(),new Promise(e=>{t.addEventListener("close",()=>e(!0)),t.addEventListener("cancel",()=>e(!1))})}const zn=5;function xN(){Ie("body").on("keypress.controls",null),Ie("body").on("keyup.controls",null),Ie("body").on("keyup.cheats",null),Ag&&Ie("body").on("keyup.cheats",t=>{if(!t.altKey)return;t.preventDefault();const{S:e,C:n}=globalThis.gameManager.getContext();switch(t.code){case"KeyC":for(const i of e.world.systemMap.values())i.ownerId===n.playerId&&(i.ships*=2);ie();return;case"KeyR":Fm(e),ie();return;case"NumpadAdd":case"Equal":{const i=Math.min(16,n.config.timeScale*2);globalThis.gameManager.setConfig({timeScale:i}),di(`Time scale increased to ${n.config.timeScale}x`);return}case"NumpadSubtract":case"Minus":{const i=Math.max(.25,n.config.timeScale/2);globalThis.gameManager.setConfig({timeScale:i}),di(`Time scale decreased to ${n.config.timeScale}x`);return}}}),Ie("body").on("keyup.controls",async t=>{switch(t.key){case"Escape":bn(),ie();return;case"?":s_();return;case"x":{if(!t.ctrlKey)return;if(await Bl("Are you sure you want to quit?")){const{C:n,E:i}=globalThis.gameManager.getContext();i.emit("PLAYER_QUIT",{playerId:n.playerId})}return}}}),Ie("body").on("keypress.controls",t=>{switch(t.code){case"Space":"pauseToggle"in globalThis.gameManager&&globalThis.gameManager.pauseToggle();return;case"Equal":case"NumpadAdd":Yf(1.2),ie();return;case"Minus":case"NumpadSubtract":Yf(.8),ie();return;case"KeyW":Hn([0,zn]),ie();return;case"KeyA":Hn([-zn,0]),ie();return;case"KeyS":Hn([0,-zn]),ie();return;case"KeyD":Hn([zn,0]),ie();return;case"KeyQ":Hn([0,0,zn]),ie();break;case"KeyE":Hn([0,0,-zn]),ie();break;case"KeyH":Fl(),ie();return;case"KeyC":_e.last&&(SN(_e.last),ie());return;case"KeyP":vN(),Fl(),ie();return}})}function Qf(t,e){const{S:n,C:i}=globalThis.gameManager.getContext();if(i.status==="PLAYING")switch(t.button){case 0:break;case 2:{let r=n.world.systemMap.get(e.fromId),s=n.world.systemMap.get(e.toId);if(r.ownerId!==i.playerId&&s.ownerId!==i.playerId)return;if(r.ownerId!==i.playerId){const o=r;r=s,s=o}else if(r.ownerId===r.ownerId&&s.ships>r.ships){const o=r;r=s,s=o}if(NN(r.id,s.id),s.ownerId!==i.playerId)return;t.altKey||(!t.ctrlKey&&!t.shiftKey&&bn(),Er(r.id),s.ownerId===i.playerId&&Er(s.id));break}}}function wo(t,e){const n=globalThis.gameManager.getContext();if(n.C.status==="PLAYING")switch(Ag&&t.altKey&&(di(""+e.id,e.lastMove?.message??"none",e.lastMove?.ships??0),console.log(e)),t.button){case 0:if(e.ownerId!==n.C.playerId)return;t.ctrlKey||t.metaKey?fN(e.id):t.shiftKey?dN(n,e.id):uN(e.id);break;case-1:case 2:{const i=Array.from(_e.all);if(i.length===0)return;i.forEach(r=>{MN(r,e.id),e.ownerId===n.C.playerId&&(t.altKey||(!t.ctrlKey&&!t.shiftKey&&bn(),Er(e.id)))});break}}}function NN(t,e){const{S:n,E:i,C:r}=globalThis.gameManager.getContext();if(!Xo(n.world,t,e))return;const s={type:"BALANCED_MOVE",message:`Balanced move from ${t} to ${e}`,toId:e,fromId:t,playerId:r.playerId};i.emit("TAKE_ORDER",s)}function MN(t,e){const{S:n,E:i,C:r}=globalThis.gameManager.getContext();if(!Xo(n.world,t,e))return;const s={type:"MASS_MOVE",toId:e,fromId:t,playerId:r.playerId,message:`Mass move from ${t} to ${e}`};i.emit("TAKE_ORDER",s)}let o_=0;const Eo=[];function kN(){o_=0,Eo.length=0;const{E:t}=globalThis.gameManager.getContext();t.emit("MESSAGES_UPDATED",{messages:Eo})}function ss(t){const{C:e,E:n}=globalThis.gameManager.getContext();Eo.push({id:o_++,message:t,tick:e.tick}),n.emit("MESSAGES_UPDATED",{messages:Eo})}class PN{constructor(){this.listeners={}}on(e,n){return this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(n),()=>{this.listeners[e]=this.listeners[e].filter(i=>i!==n)}}emit(e,n){const i=this.listeners[e];if(i)for(const r of i)try{r(n)}catch(s){console.error(`Error in listener for event ${String(e)}:`,s)}}clear(){this.listeners={}}}class RN{constructor(){this.events=new PN,this.game=qx,this.state=nu(),this.config=Lm(),this.tick=0,this.status="WAITING",this.runningInterval=null,this.#t()}getState(){return qs?Object.freeze({...this.state}):this.state}getConfig(){return qs?Object.freeze({...this.config}):this.config}setConfig(e){this.config={...this.config,...e}}getContext(){return{S:this.state,E:this.events,P:this.state.playerMap.get(this.playerId),C:{tick:this.tick,status:this.status,playerId:this.playerId,config:this.getConfig()}}}addPlayer(e){if(this.state.playerMap.has(e.id))return this.state.playerMap.get(e.id);const n=e.score??{userId:e.id,playerName:e.name??`Player ${this.state.playerMap.size+1}`,score:0,tick:0,timestamp:Date.now()},i={name:e.name??`Player ${this.state.playerMap.size+1}`,score:n,color:"#000000",...e,stats:{playerId:e.id,systems:0,ships:0,homeworld:0},isAlive:!0,visitedSystems:new Set,revealedSystems:new Set};return $m(this.state,i),i}gameStart(){this.status="PLAYING",this.tick=0,this.events.emit("GAME_START",void 0),this.#e()}gameStop(){this.status="FINISHED",this.stopGameLoop()}gameTick(){this.tick++,this.game.gameTick(this.getContext()),this.game.checkVictory(this.getContext()),this.events.emit("STATE_UPDATED",{state:this.state,status:this.status})}#e(){if(this.status!=="PLAYING"){this.gameStop();return}this.stopGameLoop(),this.gameTick(),this.events.emit("GAME_TICK",{tick:this.tick}),this.runningInterval=setTimeout(()=>this.#e(),dS/this.config.timeScale)}startGameLoop(){this.#e()}stopGameLoop(){this.runningInterval&&(clearTimeout(this.runningInterval),this.runningInterval=null)}#t(){this.events.on("GAME_STOP",()=>{this.gameStop()}),this.events.on("TAKE_ORDER",e=>{this.game.takeOrder(this.getContext(),e),this.events.emit("STATE_UPDATED",{state:this.state,status:this.status})})}}const Jf=Ao({length:5});class ON extends RN{constructor(){super(),this.registerUIEvents()}async connect(){this.gameStop(),this.status="WAITING";const e=await this.initializePlayer();this.addPlayer(e),this.playerId=e.id,this.events.emit("GAME_INIT",void 0),await AN(),this.gameSetup(e),this.gameStart(),ie()}gameSetup(e){const n=this.getContext();this.state=this.game.setup(n),kN(),e.name=this.config.playerName;const i=this.onPlayerJoin(1,e);this.game.assignSystem(this.state,e.id);const r=Za+ +this.config.numBots;for(let s=2;s<=r;s++){const o=this.onPlayerJoin(s);this.game.assignSystem(this.state,o.id)}this.setupThisPlayer(i.id),localStorage.setItem("starz_playerId",i.id),localStorage.setItem("starz_playerName",i.name),localStorage.setItem("starz_score",i.score.score.toString())}async initializePlayer(){const e=this.playerId=localStorage.getItem("starz_playerId")??Jf(),n=this.config.playerName,i=+(localStorage.getItem("starz_score")??0);return localStorage.setItem("starz_playerId",e),localStorage.setItem("starz_playerName",n),localStorage.setItem("starz_score",i.toString()),{id:e,name:n,score:{score:i}}}gameStart(){Na("starz_gamesStarted"),super.gameStart(),ss("Game started.");const e=this.state.playerMap.get(this.playerId);e&&ss(`You are Player ${e.name}.`)}gameStop(){super.gameStop(),bn(),ie()}onPlayerJoin(e,n={}){const i=CS[e],r=n.name??`Bot ${e}`,s=Jf(),o=e>Za?new Px({playerIndex:e,id:s,name:r}):void 0;return this.addPlayer({id:s,name:r,bot:o,color:i,...n})}pauseToggle(){this.status==="PAUSED"?(this.status="PLAYING",super.startGameLoop()):this.status==="PLAYING"&&(this.status="PAUSED",super.stopGameLoop())}async onPlayerWin(e,n){n&&ss(n),this.game.revealAllSystems(this.state),bn();let i=!1;e===this.playerId?(Na("starz_gamesWon"),i=await Bl("You have conquered The Bubble!")):(Na("starz_gamesLost",{winnerId:e}),i=await Bl("You have lost your homeworld! Click to return to lobby.  ESC to spectate.")),i&&this.restart()}restart(){this.stopGameLoop(),bn(),this.tick=0,this.state=this.game.initalState(),this.connect()}onEliminatePlayer(e,n){const i=this.state.playerMap.get(e),r=this.state.playerMap.get(n),s=n===null?`${i.name} has been eliminated!`:`${r.name} has eliminated ${i.name}!`;ss(s),e===this.playerId?(this.submitWinLoss(-1),this.onPlayerWin(n)):n===this.playerId&&this.submitWinLoss(1)}async submitWinLoss(e){const n=+(localStorage.getItem("starz_score")??0)+e;localStorage.setItem("starz_score",n.toString())}addPlayer(e){const n=super.addPlayer({color:e.color??DN(),...e});return document.documentElement.style.setProperty(`--player-${n.id}`,n.color),n}setupThisPlayer(e){this.playerId=e;const n=this.state.playerMap.get(e),i=this.game.getPlayersHomeworld(this.state);this.game.visitSystem(this.state,i),Fl(),n.bot||(bn(),Er(i.id))}registerUIEvents(){CN(),xN(),this.events.on("PLAYER_WIN",({playerId:e,message:n})=>{this.onPlayerWin(e,n)}),this.events.on("PLAYER_ELIMINATED",({loserId:e,winnerId:n})=>{this.onEliminatePlayer(e,n)}),this.events.on("PLAYER_QUIT",({playerId:e})=>{this.game.eliminatePlayer(this.getContext(),e)})}}function DN(){const t="0123456789ABCDEF";let e="#";for(let n=0;n<6;n++)e+=t[Math.floor(Math.random()*16)];return e}const LN=Ao({length:5}),$N={apiKey:"AIzaSyDagYwJisyS-3k5LqKnRQ_SwGSAea6tEzU",authDomain:"starz-b007e.firebaseapp.com",projectId:"starz-b007e",storageBucket:"starz-b007e.firebasestorage.app",messagingSenderId:"380282891322",appId:"1:380282891322:web:7f63c3d186df20e2809903"};class FN extends ON{constructor(){super(...arguments),this.app=Td($N),this.auth=Zw(this.app),this.database=aS(this.app)}async initializePlayer(){this.playerId=localStorage.getItem("starz_playerId")??LN();const e=localStorage.getItem("starz_playerName")??this.config.playerName,n=+(localStorage.getItem("starz_score")??"0");try{await $v(this.auth),this.playerId=this.auth.currentUser.uid,console.log("Signed in anonymously as:",this.playerId)}catch(r){console.error("Firebase anonymous sign-in failed:",r)}let i=null;if(this.auth.currentUser)if(i=await this.getUserLeaderboardData(this.playerId),!i)await this.createScore(),i=await this.getUserLeaderboardData(this.playerId);else{const r=await this.loadLeaderboard();console.log("Player leaderboard data:"),console.table(r);const s=r.find(o=>o.userId===this.playerId);s&&(i.rank=s.rank),console.log("Current player entry:",s)}return{id:this.playerId,name:e,score:i??{score:n}}}async createScore(){if(!this.auth.currentUser)return;const e=Vr(this.database,`leaderboard/${this.auth.currentUser.uid}`);await Fh(e,{playerName:this.config.playerName,score:0,timestamp:Date.now()})}async submitWinLoss(e){if(!this.auth.currentUser)return;const n=Vr(this.database,`leaderboard/${this.auth.currentUser.uid}`);await Fh(n,{playerName:this.config.playerName,score:uS(e),timestamp:Date.now()})}async getUserLeaderboardData(e){const n=Vr(this.database,`leaderboard/${e}`),i=await Uh(n);return i.exists()?{userId:e,...i.val()}:null}async loadLeaderboard(){const e=Vr(this.database,"leaderboard"),n=[],i=await Uh(e);return i.exists()&&i.forEach(r=>{n.push({userId:r.key,...r.val()})}),n.sort((r,s)=>s.score-r.score),n.forEach((r,s)=>r.rank=s+1),n}}const Ci=Symbol("game-manager");var UN=Object.defineProperty,BN=Object.getOwnPropertyDescriptor,a_=(t,e,n,i)=>{for(var r=i>1?void 0:i?BN(e,n):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(r=(i?o(e,n,r):o(r))||r);return i&&r&&UN(e,n,r),r};let Hl=class extends mt{constructor(){super(...arguments),this.gameManager=new FN}connectedCallback(){super.connectedCallback(),globalThis.gameManager=this.gameManager,this.gameManager.connect()}createRenderRoot(){return this}};a_([h_({context:Ci}),$_()],Hl.prototype,"gameManager",2);Hl=a_([mi("app-root")],Hl);var HN=Object.defineProperty,zN=Object.getOwnPropertyDescriptor,au=(t,e,n,i)=>{for(var r=i>1?void 0:i?zN(e,n):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(r=(i?o(e,n,r):o(r))||r);return i&&r&&HN(e,n,r),r};const WN=Kc(".3~s");let Io=class extends mt{constructor(){super(...arguments),this.stats=[]}connectedCallback(){super.connectedCallback(),this.gameManager.events.on("STATE_UPDATED",({state:t})=>{const e=Array.from(t.playerMap.values());this.stats=e.sort((n,i)=>i.stats.systems-n.stats.systems||i.stats.ships-n.stats.ships)})}createRenderRoot(){return this}render(){return gt`
      <table id="leaderbox">
        ${this.renderHeader()} ${this.renderBody()}
      </table>
    `}renderBody(){return gt`<tbody>
      ${this.stats.map(e=>gt`<tr
            style="--owner-color: ${e.color||null}"
            title="${e.bot?e.bot.name:"Human"}"
            class="${e.isAlive?"":"eliminated"}"
          >
            <td>${"Â "}${e.name}${"Â "}</td>
            <td>${"Â "}${e.stats.systems}${"Â "}</td>
            <td>${"Â "}${WN(e.stats.ships)}${"Â "}</td>
          </tr>`)}
    </tbody>`}renderHeader(){return gt`<thead>
        <tr>
          <th>Player</th>
          <th>Systems</th>
          <th>Ships</th>
        </tr>
      </thead>
      <tbody></tbody>`}};au([Ir({context:Ci,subscribe:!0}),Be({attribute:!1})],Io.prototype,"gameManager",2);au([Be()],Io.prototype,"stats",2);Io=au([mi("leaderboard-element")],Io);var VN=Object.defineProperty,qN=Object.getOwnPropertyDescriptor,lu=(t,e,n,i)=>{for(var r=i>1?void 0:i?qN(e,n):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(r=(i?o(e,n,r):o(r))||r);return i&&r&&VN(e,n,r),r};let So=class extends mt{constructor(){super(...arguments),this.tick=0}connectedCallback(){super.connectedCallback(),this.gameManager.events.on("GAME_TICK",({tick:t})=>{this.tick=t??0})}createRenderRoot(){return this}render(){const t=~~(this.tick/2),e=this.tick%2===1?".":"";return gt`${t}${e}`}};lu([Ir({context:Ci,subscribe:!0}),Be({attribute:!1})],So.prototype,"gameManager",2);lu([Be({type:Number})],So.prototype,"tick",2);So=lu([mi("tick-box")],So);var GN=Object.defineProperty,jN=Object.getOwnPropertyDescriptor,$n=(t,e,n,i)=>{for(var r=i>1?void 0:i?jN(e,n):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(r=(i?o(e,n,r):o(r))||r);return i&&r&&GN(e,n,r),r};let un=class extends mt{constructor(){super(...arguments),this.version=Zf,this.playerName="Player",this.playerScore=0,this.playerRank=null,this.shortId=""}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this.updatePlayerInfo(),this.gameManager.events.on("GAME_INIT",()=>{this.updatePlayerInfo()})}render(){return gt`
      <article>
        <h1>STARZ!</h1>
        <small class="version">v${this.version}</small>

        <div class="lore">
          <p>
            Nobody knows why <i>The Bubble</i> exists, or who built the lattice
            of hyperspace lanes threading its hundreds of star systems together
            like a cosmic web. Its discovery was accidental - a distortion
            ripple detected on the edge of settled space, leading explorers to
            the shimmering boundary of a region where physics seemed... wrong.
          </p>
          <p>
            What <i>is</i> known is this: control of <i>The Bubble</i> means
            control of immense resources and power. Rival factions flood its
            systems, each desperate to carve out their claim before somebody
            else does.
          </p>
          <p>
            As a commander, you are the spearhead of your faction's ambitions:
            tasked with expanding your influence, capturing systems, and
            ultimately dominating <i>The Bubble</i>.
          </p>
        </div>

        <h3>Protect our homeworld. Capture the enemy systems.</h3>
        <form method="dialog">
          <div class="grid">
            <div>
              <input
                name="playerName"
                id="playerNameInput"
                type="text"
                value="${this.playerName}"
                placeholder="Player Name"
                minlength="1"
                maxlength="30"
                required
              />
              <small>(Name will be used in leaderboard)</small>
            </div>
            <div>
              ${this.playerName} [${this.shortId}]
              <span>â¶ ${this.playerScore}</span>
              <br /><small
                >${this.playerRank?`Rank: ${this.playerRank}`:""}</small
              >
            </div>
          </div>

          <br /><button type="button" @click="${this.onPlay}">Play</button>
          <br /><button type="button" @click="${this.onOptions}">
            Options
          </button>
        </form>
      </article>
    `}updatePlayerInfo(){const{P:t,C:e}=this.gameManager.getContext();this.playerName=t?.name??e.config?.playerName??"Player",this.playerScore=t?.score.score??0,this.playerRank=t?.score?.rank??null,this.shortId=KN(e.playerId)}onPlay(){const e=this.querySelector("#playerNameInput").value.trim()||"Player";this.gameManager.setConfig({playerName:e}),this.closest("dialog").close()}onOptions(){r_()}};$n([Ir({context:Ci,subscribe:!0}),Be({attribute:!1})],un.prototype,"gameManager",2);$n([Be()],un.prototype,"version",2);$n([Be()],un.prototype,"playerName",2);$n([Be()],un.prototype,"playerScore",2);$n([Be()],un.prototype,"playerRank",2);$n([Be()],un.prototype,"shortId",2);un=$n([mi("start-dialog-content")],un);function KN(t){const e=t+name,n=Array.from(e).reduce((i,r)=>(i<<5)-i+r.charCodeAt(0),0);return Math.abs(n).toString(36).substring(0,4)}const YN={CHILD:2},XN=t=>(...e)=>({_$litDirective$:t,values:e});class QN{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,n,i){this._$Ct=e,this._$AM=n,this._$Ci=i}_$AS(e,n){return this.update(e,n)}update(e,n){return this.render(...n)}}class zl extends QN{constructor(e){if(super(e),this.it=de,e.type!==YN.CHILD)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(e){if(e===de||e==null)return this._t=void 0,this.it=e;if(e===An)return e;if(typeof e!="string")throw Error(this.constructor.directiveName+"() called with a non-string value");if(e===this.it)return this._t;this.it=e;const n=[e];return n.raw=n,this._t={_$litType$:this.constructor.resultType,strings:n,values:[]}}}zl.directiveName="unsafeHTML",zl.resultType=1;const JN=XN(zl);var ZN=Object.defineProperty,eM=Object.getOwnPropertyDescriptor,cu=(t,e,n,i)=>{for(var r=i>1?void 0:i?eM(e,n):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(r=(i?o(e,n,r):o(r))||r);return i&&r&&ZN(e,n,r),r};let bo=class extends mt{constructor(){super(...arguments),this.messages=[]}connectedCallback(){super.connectedCallback(),this.gameManager.events.on("MESSAGES_UPDATED",({messages:t})=>{this.messages=(t??[]).slice(-5)})}createRenderRoot(){return this}render(){return this.messages.length>0?gt`${this.messages.map(t=>{const e=~~(t.tick/2),n=t.tick%2===1?".":"";return gt`<div>
          ${JN(t.message)} <small>${e}${n}</small>
        </div>`})}`:gt``}};cu([Ir({context:Ci,subscribe:!0}),Be({attribute:!1})],bo.prototype,"gameManager",2);cu([Be()],bo.prototype,"messages",2);bo=cu([mi("message-box")],bo);var tM=Object.defineProperty,nM=Object.getOwnPropertyDescriptor,l_=(t,e,n,i)=>{for(var r=i>1?void 0:i?nM(e,n):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(r=(i?o(e,n,r):o(r))||r);return i&&r&&tM(e,n,r),r};let Wl=class extends mt{connectedCallback(){super.connectedCallback(),this.gameManager.events.on("GAME_START",()=>{EN(document.getElementById("app"),this.gameManager.getContext())}),this.gameManager.events.on("STATE_UPDATED",()=>{ie()})}createRenderRoot(){return this}render(){return gt`
      <canvas></canvas>
      <svg></svg>
    `}};l_([Ir({context:Ci,subscribe:!0}),Be({attribute:!1})],Wl.prototype,"gameManager",2);Wl=l_([mi("game-canvas")],Wl);console.log(`starz.io version ${Zf}`);

(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();const _a="0.0.7";let xa=class extends Event{constructor(t,n,i,r){super("context-request",{bubbles:!0,composed:!0}),this.context=t,this.contextTarget=n,this.callback=i,this.subscribe=r??!1}};let Fs=class{constructor(t,n,i,r){if(this.subscribe=!1,this.provided=!1,this.value=void 0,this.t=(s,o)=>{this.unsubscribe&&(this.unsubscribe!==o&&(this.provided=!1,this.unsubscribe()),this.subscribe||this.unsubscribe()),this.value=s,this.host.requestUpdate(),this.provided&&!this.subscribe||(this.provided=!0,this.callback&&this.callback(s,o)),this.unsubscribe=o},this.host=t,n.context!==void 0){const s=n;this.context=s.context,this.callback=s.callback,this.subscribe=s.subscribe??!1}else this.context=n,this.callback=i,this.subscribe=r??!1;this.host.addController(this)}hostConnected(){this.dispatchRequest()}hostDisconnected(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=void 0)}dispatchRequest(){this.host.dispatchEvent(new xa(this.context,this.host,this.t,this.subscribe))}};let Su=class{get value(){return this.o}set value(t){this.setValue(t)}setValue(t,n=!1){const i=n||!Object.is(t,this.o);this.o=t,i&&this.updateObservers()}constructor(t){this.subscriptions=new Map,this.updateObservers=()=>{for(const[n,{disposer:i}]of this.subscriptions)n(this.o,i)},t!==void 0&&(this.value=t)}addCallback(t,n,i){if(!i)return void t(this.value);this.subscriptions.has(t)||this.subscriptions.set(t,{disposer:()=>{this.subscriptions.delete(t)},consumerHost:n});const{disposer:r}=this.subscriptions.get(t);t(this.value,r)}clearCallbacks(){this.subscriptions.clear()}};let $u=class extends Event{constructor(t,n){super("context-provider",{bubbles:!0,composed:!0}),this.context=t,this.contextTarget=n}},Us=class extends Su{constructor(t,n,i){super(n.context!==void 0?n.initialValue:i),this.onContextRequest=r=>{if(r.context!==this.context)return;const s=r.contextTarget??r.composedPath()[0];s!==this.host&&(r.stopPropagation(),this.addCallback(r.callback,s,r.subscribe))},this.onProviderRequest=r=>{if(r.context!==this.context||(r.contextTarget??r.composedPath()[0])===this.host)return;const s=new Set;for(const[o,{consumerHost:a}]of this.subscriptions)s.has(o)||(s.add(o),a.dispatchEvent(new xa(this.context,a,o,!0)));r.stopPropagation()},this.host=t,n.context!==void 0?this.context=n.context:this.context=n,this.attachListeners(),this.host.addController?.(this)}attachListeners(){this.host.addEventListener("context-request",this.onContextRequest),this.host.addEventListener("context-provider",this.onProviderRequest)}hostConnected(){this.host.dispatchEvent(new $u(this.context,this.host))}};function yn({context:e}){return(t,n)=>{const i=new WeakMap;if(typeof n=="object")return{get(){return t.get.call(this)},set(r){return i.get(this).setValue(r),t.set.call(this,r)},init(r){return i.set(this,new Us(this,{context:e,initialValue:r})),r}};{t.constructor.addInitializer((o=>{i.set(o,new Us(o,{context:e}))}));const r=Object.getOwnPropertyDescriptor(t,n);let s;if(r===void 0){const o=new WeakMap;s={get(){return o.get(this)},set(a){i.get(this).setValue(a),o.set(this,a)},configurable:!0,enumerable:!0}}else{const o=r.set;s={...r,set(a){i.get(this).setValue(a),o?.call(this,a)}}}return void Object.defineProperty(t,n,s)}}}function ki({context:e,subscribe:t}){return(n,i)=>{typeof i=="object"?i.addInitializer((function(){new Fs(this,{context:e,callback:r=>{n.set.call(this,r)},subscribe:t})})):n.constructor.addInitializer((r=>{new Fs(r,{context:e,callback:s=>{r[i]=s},subscribe:t})}))}}const Hn=globalThis,as=Hn.ShadowRoot&&(Hn.ShadyCSS===void 0||Hn.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,ba=Symbol(),Hs=new WeakMap;let Eu=class{constructor(t,n,i){if(this._$cssResult$=!0,i!==ba)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=n}get styleSheet(){let t=this.o;const n=this.t;if(as&&t===void 0){const i=n!==void 0&&n.length===1;i&&(t=Hs.get(n)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),i&&Hs.set(n,t))}return t}toString(){return this.cssText}};const Au=e=>new Eu(typeof e=="string"?e:e+"",void 0,ba),Iu=(e,t)=>{if(as)e.adoptedStyleSheets=t.map((n=>n instanceof CSSStyleSheet?n:n.styleSheet));else for(const n of t){const i=document.createElement("style"),r=Hn.litNonce;r!==void 0&&i.setAttribute("nonce",r),i.textContent=n.cssText,e.appendChild(i)}},qs=as?e=>e:e=>e instanceof CSSStyleSheet?(t=>{let n="";for(const i of t.cssRules)n+=i.cssText;return Au(n)})(e):e;const{is:Tu,defineProperty:Nu,getOwnPropertyDescriptor:Cu,getOwnPropertyNames:Pu,getOwnPropertySymbols:ku,getPrototypeOf:Ou}=Object,Oi=globalThis,Gs=Oi.trustedTypes,Ru=Gs?Gs.emptyScript:"",Lu=Oi.reactiveElementPolyfillSupport,nn=(e,t)=>e,Jn={toAttribute(e,t){switch(t){case Boolean:e=e?Ru:null;break;case Object:case Array:e=e==null?e:JSON.stringify(e)}return e},fromAttribute(e,t){let n=e;switch(t){case Boolean:n=e!==null;break;case Number:n=e===null?null:Number(e);break;case Object:case Array:try{n=JSON.parse(e)}catch{n=null}}return n}},ls=(e,t)=>!Tu(e,t),Xs={attribute:!0,type:String,converter:Jn,reflect:!1,useDefault:!1,hasChanged:ls};Symbol.metadata??=Symbol("metadata"),Oi.litPropertyMetadata??=new WeakMap;let $e=class extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,n=Xs){if(n.state&&(n.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((n=Object.create(n)).wrapped=!0),this.elementProperties.set(t,n),!n.noAccessor){const i=Symbol(),r=this.getPropertyDescriptor(t,i,n);r!==void 0&&Nu(this.prototype,t,r)}}static getPropertyDescriptor(t,n,i){const{get:r,set:s}=Cu(this.prototype,t)??{get(){return this[n]},set(o){this[n]=o}};return{get:r,set(o){const a=r?.call(this);s?.call(this,o),this.requestUpdate(t,a,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??Xs}static _$Ei(){if(this.hasOwnProperty(nn("elementProperties")))return;const t=Ou(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(nn("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(nn("properties"))){const n=this.properties,i=[...Pu(n),...ku(n)];for(const r of i)this.createProperty(r,n[r])}const t=this[Symbol.metadata];if(t!==null){const n=litPropertyMetadata.get(t);if(n!==void 0)for(const[i,r]of n)this.elementProperties.set(i,r)}this._$Eh=new Map;for(const[n,i]of this.elementProperties){const r=this._$Eu(n,i);r!==void 0&&this._$Eh.set(r,n)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const n=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const r of i)n.unshift(qs(r))}else t!==void 0&&n.push(qs(t));return n}static _$Eu(t,n){const i=n.attribute;return i===!1?void 0:typeof i=="string"?i:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((t=>t(this)))}addController(t){(this._$EO??=new Set).add(t),this.renderRoot!==void 0&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,n=this.constructor.elementProperties;for(const i of n.keys())this.hasOwnProperty(i)&&(t.set(i,this[i]),delete this[i]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return Iu(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((t=>t.hostConnected?.()))}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach((t=>t.hostDisconnected?.()))}attributeChangedCallback(t,n,i){this._$AK(t,i)}_$ET(t,n){const i=this.constructor.elementProperties.get(t),r=this.constructor._$Eu(t,i);if(r!==void 0&&i.reflect===!0){const s=(i.converter?.toAttribute!==void 0?i.converter:Jn).toAttribute(n,i.type);this._$Em=t,s==null?this.removeAttribute(r):this.setAttribute(r,s),this._$Em=null}}_$AK(t,n){const i=this.constructor,r=i._$Eh.get(t);if(r!==void 0&&this._$Em!==r){const s=i.getPropertyOptions(r),o=typeof s.converter=="function"?{fromAttribute:s.converter}:s.converter?.fromAttribute!==void 0?s.converter:Jn;this._$Em=r;const a=o.fromAttribute(n,s.type);this[r]=a??this._$Ej?.get(r)??a,this._$Em=null}}requestUpdate(t,n,i){if(t!==void 0){const r=this.constructor,s=this[t];if(i??=r.getPropertyOptions(t),!((i.hasChanged??ls)(s,n)||i.useDefault&&i.reflect&&s===this._$Ej?.get(t)&&!this.hasAttribute(r._$Eu(t,i))))return;this.C(t,n,i)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(t,n,{useDefault:i,reflect:r,wrapped:s},o){i&&!(this._$Ej??=new Map).has(t)&&(this._$Ej.set(t,o??n??this[t]),s!==!0||o!==void 0)||(this._$AL.has(t)||(this.hasUpdated||i||(n=void 0),this._$AL.set(t,n)),r===!0&&this._$Em!==t&&(this._$Eq??=new Set).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(n){Promise.reject(n)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[r,s]of this._$Ep)this[r]=s;this._$Ep=void 0}const i=this.constructor.elementProperties;if(i.size>0)for(const[r,s]of i){const{wrapped:o}=s,a=this[r];o!==!0||this._$AL.has(r)||a===void 0||this.C(r,void 0,s,a)}}let t=!1;const n=this._$AL;try{t=this.shouldUpdate(n),t?(this.willUpdate(n),this._$EO?.forEach((i=>i.hostUpdate?.())),this.update(n)):this._$EM()}catch(i){throw t=!1,this._$EM(),i}t&&this._$AE(n)}willUpdate(t){}_$AE(t){this._$EO?.forEach((n=>n.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&=this._$Eq.forEach((n=>this._$ET(n,this[n]))),this._$EM()}updated(t){}firstUpdated(t){}};$e.elementStyles=[],$e.shadowRootOptions={mode:"open"},$e[nn("elementProperties")]=new Map,$e[nn("finalized")]=new Map,Lu?.({ReactiveElement:$e}),(Oi.reactiveElementVersions??=[]).push("2.1.1");const us=globalThis,ti=us.trustedTypes,Ys=ti?ti.createPolicy("lit-html",{createHTML:e=>e}):void 0,Ma="$lit$",re=`lit$${Math.random().toFixed(9).slice(2)}$`,Sa="?"+re,Du=`<${Sa}>`,ye=document,on=()=>ye.createComment(""),an=e=>e===null||typeof e!="object"&&typeof e!="function",cs=Array.isArray,zu=e=>cs(e)||typeof e?.[Symbol.iterator]=="function",Wi=`[ 	
\f\r]`,qe=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Ks=/-->/g,Vs=/>/g,le=RegExp(`>|${Wi}(?:([^\\s"'>=/]+)(${Wi}*=${Wi}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),js=/'/g,Ws=/"/g,$a=/^(?:script|style|textarea|title)$/i,Bu=e=>(t,...n)=>({_$litType$:e,strings:t,values:n}),Et=Bu(1),ve=Symbol.for("lit-noChange"),et=Symbol.for("lit-nothing"),Qs=new WeakMap,ce=ye.createTreeWalker(ye,129);function Ea(e,t){if(!cs(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return Ys!==void 0?Ys.createHTML(t):t}const Fu=(e,t)=>{const n=e.length-1,i=[];let r,s=t===2?"<svg>":t===3?"<math>":"",o=qe;for(let a=0;a<n;a++){const l=e[a];let u,h,c=-1,f=0;for(;f<l.length&&(o.lastIndex=f,h=o.exec(l),h!==null);)f=o.lastIndex,o===qe?h[1]==="!--"?o=Ks:h[1]!==void 0?o=Vs:h[2]!==void 0?($a.test(h[2])&&(r=RegExp("</"+h[2],"g")),o=le):h[3]!==void 0&&(o=le):o===le?h[0]===">"?(o=r??qe,c=-1):h[1]===void 0?c=-2:(c=o.lastIndex-h[2].length,u=h[1],o=h[3]===void 0?le:h[3]==='"'?Ws:js):o===Ws||o===js?o=le:o===Ks||o===Vs?o=qe:(o=le,r=void 0);const v=o===le&&e[a+1].startsWith("/>")?" ":"";s+=o===qe?l+Du:c>=0?(i.push(u),l.slice(0,c)+Ma+l.slice(c)+re+v):l+re+(c===-2?a:v)}return[Ea(e,s+(e[n]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),i]};class ln{constructor({strings:t,_$litType$:n},i){let r;this.parts=[];let s=0,o=0;const a=t.length-1,l=this.parts,[u,h]=Fu(t,n);if(this.el=ln.createElement(u,i),ce.currentNode=this.el.content,n===2||n===3){const c=this.el.content.firstChild;c.replaceWith(...c.childNodes)}for(;(r=ce.nextNode())!==null&&l.length<a;){if(r.nodeType===1){if(r.hasAttributes())for(const c of r.getAttributeNames())if(c.endsWith(Ma)){const f=h[o++],v=r.getAttribute(c).split(re),M=/([.?@])?(.*)/.exec(f);l.push({type:1,index:s,name:M[2],strings:v,ctor:M[1]==="."?Hu:M[1]==="?"?qu:M[1]==="@"?Gu:Ri}),r.removeAttribute(c)}else c.startsWith(re)&&(l.push({type:6,index:s}),r.removeAttribute(c));if($a.test(r.tagName)){const c=r.textContent.split(re),f=c.length-1;if(f>0){r.textContent=ti?ti.emptyScript:"";for(let v=0;v<f;v++)r.append(c[v],on()),ce.nextNode(),l.push({type:2,index:++s});r.append(c[f],on())}}}else if(r.nodeType===8)if(r.data===Sa)l.push({type:2,index:s});else{let c=-1;for(;(c=r.data.indexOf(re,c+1))!==-1;)l.push({type:7,index:s}),c+=re.length-1}s++}}static createElement(t,n){const i=ye.createElement("template");return i.innerHTML=t,i}}function Ce(e,t,n=e,i){if(t===ve)return t;let r=i!==void 0?n._$Co?.[i]:n._$Cl;const s=an(t)?void 0:t._$litDirective$;return r?.constructor!==s&&(r?._$AO?.(!1),s===void 0?r=void 0:(r=new s(e),r._$AT(e,n,i)),i!==void 0?(n._$Co??=[])[i]=r:n._$Cl=r),r!==void 0&&(t=Ce(e,r._$AS(e,t.values),r,i)),t}class Uu{constructor(t,n){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:n},parts:i}=this._$AD,r=(t?.creationScope??ye).importNode(n,!0);ce.currentNode=r;let s=ce.nextNode(),o=0,a=0,l=i[0];for(;l!==void 0;){if(o===l.index){let u;l.type===2?u=new vn(s,s.nextSibling,this,t):l.type===1?u=new l.ctor(s,l.name,l.strings,this,t):l.type===6&&(u=new Xu(s,this,t)),this._$AV.push(u),l=i[++a]}o!==l?.index&&(s=ce.nextNode(),o++)}return ce.currentNode=ye,r}p(t){let n=0;for(const i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(t,i,n),n+=i.strings.length-2):i._$AI(t[n])),n++}}class vn{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,n,i,r){this.type=2,this._$AH=et,this._$AN=void 0,this._$AA=t,this._$AB=n,this._$AM=i,this.options=r,this._$Cv=r?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const n=this._$AM;return n!==void 0&&t?.nodeType===11&&(t=n.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,n=this){t=Ce(this,t,n),an(t)?t===et||t==null||t===""?(this._$AH!==et&&this._$AR(),this._$AH=et):t!==this._$AH&&t!==ve&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):zu(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==et&&an(this._$AH)?this._$AA.nextSibling.data=t:this.T(ye.createTextNode(t)),this._$AH=t}$(t){const{values:n,_$litType$:i}=t,r=typeof i=="number"?this._$AC(t):(i.el===void 0&&(i.el=ln.createElement(Ea(i.h,i.h[0]),this.options)),i);if(this._$AH?._$AD===r)this._$AH.p(n);else{const s=new Uu(r,this),o=s.u(this.options);s.p(n),this.T(o),this._$AH=s}}_$AC(t){let n=Qs.get(t.strings);return n===void 0&&Qs.set(t.strings,n=new ln(t)),n}k(t){cs(this._$AH)||(this._$AH=[],this._$AR());const n=this._$AH;let i,r=0;for(const s of t)r===n.length?n.push(i=new vn(this.O(on()),this.O(on()),this,this.options)):i=n[r],i._$AI(s),r++;r<n.length&&(this._$AR(i&&i._$AB.nextSibling,r),n.length=r)}_$AR(t=this._$AA.nextSibling,n){for(this._$AP?.(!1,!0,n);t!==this._$AB;){const i=t.nextSibling;t.remove(),t=i}}setConnected(t){this._$AM===void 0&&(this._$Cv=t,this._$AP?.(t))}}class Ri{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,n,i,r,s){this.type=1,this._$AH=et,this._$AN=void 0,this.element=t,this.name=n,this._$AM=r,this.options=s,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=et}_$AI(t,n=this,i,r){const s=this.strings;let o=!1;if(s===void 0)t=Ce(this,t,n,0),o=!an(t)||t!==this._$AH&&t!==ve,o&&(this._$AH=t);else{const a=t;let l,u;for(t=s[0],l=0;l<s.length-1;l++)u=Ce(this,a[i+l],n,l),u===ve&&(u=this._$AH[l]),o||=!an(u)||u!==this._$AH[l],u===et?t=et:t!==et&&(t+=(u??"")+s[l+1]),this._$AH[l]=u}o&&!r&&this.j(t)}j(t){t===et?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class Hu extends Ri{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===et?void 0:t}}class qu extends Ri{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==et)}}class Gu extends Ri{constructor(t,n,i,r,s){super(t,n,i,r,s),this.type=5}_$AI(t,n=this){if((t=Ce(this,t,n,0)??et)===ve)return;const i=this._$AH,r=t===et&&i!==et||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,s=t!==et&&(i===et||r);r&&this.element.removeEventListener(this.name,this,i),s&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class Xu{constructor(t,n,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=n,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){Ce(this,t)}}const Yu=us.litHtmlPolyfillSupport;Yu?.(ln,vn),(us.litHtmlVersions??=[]).push("3.3.1");const Ku=(e,t,n)=>{const i=n?.renderBefore??t;let r=i._$litPart$;if(r===void 0){const s=n?.renderBefore??null;i._$litPart$=r=new vn(t.insertBefore(on(),s),s,void 0,n??{})}return r._$AI(e),r};const hs=globalThis;let Ft=class extends $e{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const n=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=Ku(n,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return ve}};Ft._$litElement$=!0,Ft.finalized=!0,hs.litElementHydrateSupport?.({LitElement:Ft});const Vu=hs.litElementPolyfillSupport;Vu?.({LitElement:Ft});(hs.litElementVersions??=[]).push("4.2.1");const Ue=e=>(t,n)=>{n!==void 0?n.addInitializer((()=>{customElements.define(e,t)})):customElements.define(e,t)};const ju={attribute:!0,type:String,converter:Jn,reflect:!1,hasChanged:ls},Wu=(e=ju,t,n)=>{const{kind:i,metadata:r}=n;let s=globalThis.litPropertyMetadata.get(r);if(s===void 0&&globalThis.litPropertyMetadata.set(r,s=new Map),i==="setter"&&((e=Object.create(e)).wrapped=!0),s.set(n.name,e),i==="accessor"){const{name:o}=n;return{set(a){const l=t.get.call(this);t.set.call(this,a),this.requestUpdate(o,l,e)},init(a){return a!==void 0&&this.C(o,void 0,e,a),a}}}if(i==="setter"){const{name:o}=n;return function(a){const l=this[o];t.call(this,a),this.requestUpdate(o,l,e)}}throw Error("Unsupported decorator location: "+i)};function fs(e){return(t,n)=>typeof n=="object"?Wu(e,t,n):((i,r,s)=>{const o=r.hasOwnProperty(s);return r.constructor.createProperty(s,i),o?Object.getOwnPropertyDescriptor(r,s):void 0})(e,t,n)}function Ot(e){return fs({...e,state:!0,attribute:!1})}const Qu=(e,t,n)=>(n.configurable=!0,n.enumerable=!0,Reflect.decorate&&typeof t!="object"&&Object.defineProperty(e,t,n),n);function Li(e,t){return(n,i,r)=>{const s=o=>o.renderRoot?.querySelector(e)??null;return Qu(n,i,{get(){return s(this)}})}}const Zu={CHILD:2},Ju=e=>(...t)=>({_$litDirective$:e,values:t});class tc{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,n,i){this._$Ct=t,this._$AM=n,this._$Ci=i}_$AS(t,n){return this.update(t,n)}update(t,n){return this.render(...n)}}class pr extends tc{constructor(t){if(super(t),this.it=et,t.type!==Zu.CHILD)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(t){if(t===et||t==null)return this._t=void 0,this.it=t;if(t===ve)return t;if(typeof t!="string")throw Error(this.constructor.directiveName+"() called with a non-string value");if(t===this.it)return this._t;this.it=t;const n=[t];return n.raw=n,this._t={_$litType$:this.constructor.resultType,strings:n,values:[]}}}pr.directiveName="unsafeHTML",pr.resultType=1;const ds=Ju(pr),ec={DEV:!1,PROD:!0},ei=750,oe=750,nc="Orthographic",ic=500,rc=2,sc=25,oc=1,ac=1,Aa=40,lc=!0,uc=384,qn=1,cc=4,hc=.1,Ia=ec||{},ni=Ia.DEV??!0,fc=Ia.PROD??!1,dc=fc,pc=ni,Ta=ni,gc=["#c0392b","#f1c40f","#9b59b6","#00b386","#cc6600","#0a4c8c"];function Pe(e,...t){const n=globalThis.gameManager?.getContext()?.tick??null;pc&&console.log(`[DEBUG][Tick ${n}] ${e}`,...t)}function Qi(e,t={}){if(!dc)return;const n=globalThis.gameManager?.getContext()?.tick??null;let i=1;try{i=parseInt(localStorage.getItem(e)??"0",10)+1}catch(r){console.error("Error reading event count from localStorage:",r)}if(localStorage.setItem(e,i+""),window&&window.sa_event)try{window.sa_event(e,{[e]:i,tick:n,...t})}catch(r){console.error("Error tracking event:",r)}}function Na(e,t){let n,i;for(const r of e)r!=null&&(n===void 0?r>=r&&(n=i=r):(n>r&&(n=r),i<r&&(i=r)));return[n,i]}class kt{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let i=0;for(let r=0;r<this._n&&r<32;r++){const s=n[r],o=t+s,a=Math.abs(t)<Math.abs(s)?t-(o-s):s-(o-t);a&&(n[i++]=a),t=o}return n[i]=t,this._n=i+1,this}valueOf(){const t=this._partials;let n=this._n,i,r,s,o=0;if(n>0){for(o=t[--n];n>0&&(i=o,r=t[--n],o=i+r,s=r-(o-i),!s););n>0&&(s<0&&t[n-1]<0||s>0&&t[n-1]>0)&&(r=s*2,i=o+r,r==i-o&&(o=i))}return o}}function Zs(e,t){let n=0,i=0;if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(++n,i+=r);else{let r=-1;for(let s of e)(s=t(s,++r,e))!=null&&(s=+s)>=s&&(++n,i+=s)}if(n)return i/n}function*mc(e){for(const t of e)yield*t}function Ca(e){return Array.from(mc(e))}function Ee(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((t-e)/n))|0,s=new Array(r);++i<r;)s[i]=e+i*n;return s}var yc={value:()=>{}};function Di(){for(var e=0,t=arguments.length,n={},i;e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new Gn(n)}function Gn(e){this._=e}function vc(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}Gn.prototype=Di.prototype={constructor:Gn,on:function(e,t){var n=this._,i=vc(e+"",n),r,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((r=(e=i[s]).type)&&(r=wc(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<o;)if(r=(e=i[s]).type)n[r]=Js(n[r],e.name,t);else if(t==null)for(r in n)n[r]=Js(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Gn(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],i=0,r=s.length;i<r;++i)s[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,s=i.length;r<s;++r)i[r].value.apply(t,n)}};function wc(e,t){for(var n=0,i=e.length,r;n<i;++n)if((r=e[n]).name===t)return r.value}function Js(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=yc,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}var gr="http://www.w3.org/1999/xhtml";const to={svg:"http://www.w3.org/2000/svg",xhtml:gr,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function zi(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),to.hasOwnProperty(t)?{space:to[t],local:e}:e}function _c(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===gr&&t.documentElement.namespaceURI===gr?t.createElement(e):t.createElementNS(n,e)}}function xc(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Pa(e){var t=zi(e);return(t.local?xc:_c)(t)}function bc(){}function ps(e){return e==null?bc:function(){return this.querySelector(e)}}function Mc(e){typeof e!="function"&&(e=ps(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s=t[r],o=s.length,a=i[r]=new Array(o),l,u,h=0;h<o;++h)(l=s[h])&&(u=e.call(l,l.__data__,h,s))&&("__data__"in l&&(u.__data__=l.__data__),a[h]=u);return new vt(i,this._parents)}function Sc(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function $c(){return[]}function ka(e){return e==null?$c:function(){return this.querySelectorAll(e)}}function Ec(e){return function(){return Sc(e.apply(this,arguments))}}function Ac(e){typeof e=="function"?e=Ec(e):e=ka(e);for(var t=this._groups,n=t.length,i=[],r=[],s=0;s<n;++s)for(var o=t[s],a=o.length,l,u=0;u<a;++u)(l=o[u])&&(i.push(e.call(l,l.__data__,u,o)),r.push(l));return new vt(i,r)}function Oa(e){return function(){return this.matches(e)}}function Ra(e){return function(t){return t.matches(e)}}var Ic=Array.prototype.find;function Tc(e){return function(){return Ic.call(this.children,e)}}function Nc(){return this.firstElementChild}function Cc(e){return this.select(e==null?Nc:Tc(typeof e=="function"?e:Ra(e)))}var Pc=Array.prototype.filter;function kc(){return Array.from(this.children)}function Oc(e){return function(){return Pc.call(this.children,e)}}function Rc(e){return this.selectAll(e==null?kc:Oc(typeof e=="function"?e:Ra(e)))}function Lc(e){typeof e!="function"&&(e=Oa(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s=t[r],o=s.length,a=i[r]=[],l,u=0;u<o;++u)(l=s[u])&&e.call(l,l.__data__,u,s)&&a.push(l);return new vt(i,this._parents)}function La(e){return new Array(e.length)}function Dc(){return new vt(this._enter||this._groups.map(La),this._parents)}function ii(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}ii.prototype={constructor:ii,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function zc(e){return function(){return e}}function Bc(e,t,n,i,r,s){for(var o=0,a,l=t.length,u=s.length;o<u;++o)(a=t[o])?(a.__data__=s[o],i[o]=a):n[o]=new ii(e,s[o]);for(;o<l;++o)(a=t[o])&&(r[o]=a)}function Fc(e,t,n,i,r,s,o){var a,l,u=new Map,h=t.length,c=s.length,f=new Array(h),v;for(a=0;a<h;++a)(l=t[a])&&(f[a]=v=o.call(l,l.__data__,a,t)+"",u.has(v)?r[a]=l:u.set(v,l));for(a=0;a<c;++a)v=o.call(e,s[a],a,s)+"",(l=u.get(v))?(i[a]=l,l.__data__=s[a],u.delete(v)):n[a]=new ii(e,s[a]);for(a=0;a<h;++a)(l=t[a])&&u.get(f[a])===l&&(r[a]=l)}function Uc(e){return e.__data__}function Hc(e,t){if(!arguments.length)return Array.from(this,Uc);var n=t?Fc:Bc,i=this._parents,r=this._groups;typeof e!="function"&&(e=zc(e));for(var s=r.length,o=new Array(s),a=new Array(s),l=new Array(s),u=0;u<s;++u){var h=i[u],c=r[u],f=c.length,v=qc(e.call(h,h&&h.__data__,u,i)),M=v.length,A=a[u]=new Array(M),N=o[u]=new Array(M),I=l[u]=new Array(f);n(h,c,A,N,I,v,t);for(var E=0,P=0,C,k;E<M;++E)if(C=A[E]){for(E>=P&&(P=E+1);!(k=N[P])&&++P<M;);C._next=k||null}}return o=new vt(o,i),o._enter=a,o._exit=l,o}function qc(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Gc(){return new vt(this._exit||this._groups.map(La),this._parents)}function Xc(e,t,n){var i=this.enter(),r=this,s=this.exit();return typeof e=="function"?(i=e(i),i&&(i=i.selection())):i=i.append(e+""),t!=null&&(r=t(r),r&&(r=r.selection())),n==null?s.remove():n(s),i&&r?i.merge(r).order():r}function Yc(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,r=n.length,s=i.length,o=Math.min(r,s),a=new Array(r),l=0;l<o;++l)for(var u=n[l],h=i[l],c=u.length,f=a[l]=new Array(c),v,M=0;M<c;++M)(v=u[M]||h[M])&&(f[M]=v);for(;l<r;++l)a[l]=n[l];return new vt(a,this._parents)}function Kc(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i=e[t],r=i.length-1,s=i[r],o;--r>=0;)(o=i[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function Vc(e){e||(e=jc);function t(c,f){return c&&f?e(c.__data__,f.__data__):!c-!f}for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o=n[s],a=o.length,l=r[s]=new Array(a),u,h=0;h<a;++h)(u=o[h])&&(l[h]=u);l.sort(t)}return new vt(r,this._parents).order()}function jc(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Wc(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Qc(){return Array.from(this)}function Zc(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null}function Jc(){let e=0;for(const t of this)++e;return e}function th(){return!this.node()}function eh(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var r=t[n],s=0,o=r.length,a;s<o;++s)(a=r[s])&&e.call(a,a.__data__,s,r);return this}function nh(e){return function(){this.removeAttribute(e)}}function ih(e){return function(){this.removeAttributeNS(e.space,e.local)}}function rh(e,t){return function(){this.setAttribute(e,t)}}function sh(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function oh(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function ah(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function lh(e,t){var n=zi(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((t==null?n.local?ih:nh:typeof t=="function"?n.local?ah:oh:n.local?sh:rh)(n,t))}function Da(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function uh(e){return function(){this.style.removeProperty(e)}}function ch(e,t,n){return function(){this.style.setProperty(e,t,n)}}function hh(e,t,n){return function(){var i=t.apply(this,arguments);i==null?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function fh(e,t,n){return arguments.length>1?this.each((t==null?uh:typeof t=="function"?hh:ch)(e,t,n??"")):ke(this.node(),e)}function ke(e,t){return e.style.getPropertyValue(t)||Da(e).getComputedStyle(e,null).getPropertyValue(t)}function dh(e){return function(){delete this[e]}}function ph(e,t){return function(){this[e]=t}}function gh(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function mh(e,t){return arguments.length>1?this.each((t==null?dh:typeof t=="function"?gh:ph)(e,t)):this.node()[e]}function za(e){return e.trim().split(/^|\s+/)}function gs(e){return e.classList||new Ba(e)}function Ba(e){this._node=e,this._names=za(e.getAttribute("class")||"")}Ba.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Fa(e,t){for(var n=gs(e),i=-1,r=t.length;++i<r;)n.add(t[i])}function Ua(e,t){for(var n=gs(e),i=-1,r=t.length;++i<r;)n.remove(t[i])}function yh(e){return function(){Fa(this,e)}}function vh(e){return function(){Ua(this,e)}}function wh(e,t){return function(){(t.apply(this,arguments)?Fa:Ua)(this,e)}}function _h(e,t){var n=za(e+"");if(arguments.length<2){for(var i=gs(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?wh:t?yh:vh)(n,t))}function xh(){this.textContent=""}function bh(e){return function(){this.textContent=e}}function Mh(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Sh(e){return arguments.length?this.each(e==null?xh:(typeof e=="function"?Mh:bh)(e)):this.node().textContent}function $h(){this.innerHTML=""}function Eh(e){return function(){this.innerHTML=e}}function Ah(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Ih(e){return arguments.length?this.each(e==null?$h:(typeof e=="function"?Ah:Eh)(e)):this.node().innerHTML}function Th(){this.nextSibling&&this.parentNode.appendChild(this)}function Nh(){return this.each(Th)}function Ch(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Ph(){return this.each(Ch)}function kh(e){var t=typeof e=="function"?e:Pa(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Oh(){return null}function Rh(e,t){var n=typeof e=="function"?e:Pa(e),i=t==null?Oh:typeof t=="function"?t:ps(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function Lh(){var e=this.parentNode;e&&e.removeChild(this)}function Dh(){return this.each(Lh)}function zh(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Bh(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Fh(e){return this.select(e?Bh:zh)}function Uh(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Hh(e){return function(t){e.call(this,t,this.__data__)}}function qh(e){return e.trim().split(/^|\s+/).map(function(t){var n="",i=t.indexOf(".");return i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),{type:t,name:n}})}function Gh(e){return function(){var t=this.__on;if(t){for(var n=0,i=-1,r=t.length,s;n<r;++n)s=t[n],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.options):t[++i]=s;++i?t.length=i:delete this.__on}}}function Xh(e,t,n){return function(){var i=this.__on,r,s=Hh(t);if(i){for(var o=0,a=i.length;o<a;++o)if((r=i[o]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),r.value=t;return}}this.addEventListener(e.type,s,n),r={type:e.type,name:e.name,value:t,listener:s,options:n},i?i.push(r):this.__on=[r]}}function Yh(e,t,n){var i=qh(e+""),r,s=i.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,u=a.length,h;l<u;++l)for(r=0,h=a[l];r<s;++r)if((o=i[r]).type===h.type&&o.name===h.name)return h.value}return}for(a=t?Xh:Gh,r=0;r<s;++r)this.each(a(i[r],t,n));return this}function Ha(e,t,n){var i=Da(e),r=i.CustomEvent;typeof r=="function"?r=new r(t,n):(r=i.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function Kh(e,t){return function(){return Ha(this,e,t)}}function Vh(e,t){return function(){return Ha(this,e,t.apply(this,arguments))}}function jh(e,t){return this.each((typeof t=="function"?Vh:Kh)(e,t))}function*Wh(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,s=i.length,o;r<s;++r)(o=i[r])&&(yield o)}var qa=[null];function vt(e,t){this._groups=e,this._parents=t}function wn(){return new vt([[document.documentElement]],qa)}function Qh(){return this}vt.prototype=wn.prototype={constructor:vt,select:Mc,selectAll:Ac,selectChild:Cc,selectChildren:Rc,filter:Lc,data:Hc,enter:Dc,exit:Gc,join:Xc,merge:Yc,selection:Qh,order:Kc,sort:Vc,call:Wc,nodes:Qc,node:Zc,size:Jc,empty:th,each:eh,attr:lh,style:fh,property:mh,classed:_h,text:Sh,html:Ih,raise:Nh,lower:Ph,append:kh,insert:Rh,remove:Dh,clone:Fh,datum:Uh,on:Yh,dispatch:jh,[Symbol.iterator]:Wh};function Nt(e){return typeof e=="string"?new vt([[document.querySelector(e)]],[document.documentElement]):new vt([[e]],qa)}function Ga(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Dt(e,t){if(e=Ga(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}}return[e.pageX,e.pageY]}function Zh(e,t){return e.target&&(e=Ga(e),t===void 0&&(t=e.currentTarget),e=e.touches||[e]),Array.from(e,n=>Dt(n,t))}const Jh={passive:!1},un={capture:!0,passive:!1};function Zi(e){e.stopImmediatePropagation()}function Te(e){e.preventDefault(),e.stopImmediatePropagation()}function Xa(e){var t=e.document.documentElement,n=Nt(e).on("dragstart.drag",Te,un);"onselectstart"in t?n.on("selectstart.drag",Te,un):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Ya(e,t){var n=e.document.documentElement,i=Nt(e).on("dragstart.drag",null);t&&(i.on("click.drag",Te,un),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Sn=e=>()=>e;function mr(e,{sourceEvent:t,subject:n,target:i,identifier:r,active:s,x:o,y:a,dx:l,dy:u,dispatch:h}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:h}})}mr.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function tf(e){return!e.ctrlKey&&!e.button}function ef(){return this.parentNode}function nf(e,t){return t??{x:e.x,y:e.y}}function rf(){return navigator.maxTouchPoints||"ontouchstart"in this}function sf(){var e=tf,t=ef,n=nf,i=rf,r={},s=Di("start","drag","end"),o=0,a,l,u,h,c=0;function f(C){C.on("mousedown.drag",v).filter(i).on("touchstart.drag",N).on("touchmove.drag",I,Jh).on("touchend.drag touchcancel.drag",E).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function v(C,k){if(!(h||!e.call(this,C,k))){var O=P(this,t.call(this,C,k),C,k,"mouse");O&&(Nt(C.view).on("mousemove.drag",M,un).on("mouseup.drag",A,un),Xa(C.view),Zi(C),u=!1,a=C.clientX,l=C.clientY,O("start",C))}}function M(C){if(Te(C),!u){var k=C.clientX-a,O=C.clientY-l;u=k*k+O*O>c}r.mouse("drag",C)}function A(C){Nt(C.view).on("mousemove.drag mouseup.drag",null),Ya(C.view,u),Te(C),r.mouse("end",C)}function N(C,k){if(e.call(this,C,k)){var O=C.changedTouches,D=t.call(this,C,k),d=O.length,g,w;for(g=0;g<d;++g)(w=P(this,D,C,k,O[g].identifier,O[g]))&&(Zi(C),w("start",C,O[g]))}}function I(C){var k=C.changedTouches,O=k.length,D,d;for(D=0;D<O;++D)(d=r[k[D].identifier])&&(Te(C),d("drag",C,k[D]))}function E(C){var k=C.changedTouches,O=k.length,D,d;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),D=0;D<O;++D)(d=r[k[D].identifier])&&(Zi(C),d("end",C,k[D]))}function P(C,k,O,D,d,g){var w=s.copy(),_=Dt(g||O,k),b,$,y;if((y=n.call(C,new mr("beforestart",{sourceEvent:O,target:f,identifier:d,active:o,x:_[0],y:_[1],dx:0,dy:0,dispatch:w}),D))!=null)return b=y.x-_[0]||0,$=y.y-_[1]||0,function p(m,x,S){var T=_,R;switch(m){case"start":r[d]=p,R=o++;break;case"end":delete r[d],--o;case"drag":_=Dt(S||x,k),R=o;break}w.call(m,C,new mr(m,{sourceEvent:x,subject:y,target:f,identifier:d,active:R,x:_[0]+b,y:_[1]+$,dx:_[0]-T[0],dy:_[1]-T[1],dispatch:w}),D)}}return f.filter=function(C){return arguments.length?(e=typeof C=="function"?C:Sn(!!C),f):e},f.container=function(C){return arguments.length?(t=typeof C=="function"?C:Sn(C),f):t},f.subject=function(C){return arguments.length?(n=typeof C=="function"?C:Sn(C),f):n},f.touchable=function(C){return arguments.length?(i=typeof C=="function"?C:Sn(!!C),f):i},f.on=function(){var C=s.on.apply(s,arguments);return C===s?f:C},f.clickDistance=function(C){return arguments.length?(c=(C=+C)*C,f):Math.sqrt(c)},f}function ms(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Ka(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function _n(){}var cn=.7,ri=1/cn,Ne="\\s*([+-]?\\d+)\\s*",hn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ut="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",of=/^#([0-9a-f]{3,8})$/,af=new RegExp(`^rgb\\(${Ne},${Ne},${Ne}\\)$`),lf=new RegExp(`^rgb\\(${Ut},${Ut},${Ut}\\)$`),uf=new RegExp(`^rgba\\(${Ne},${Ne},${Ne},${hn}\\)$`),cf=new RegExp(`^rgba\\(${Ut},${Ut},${Ut},${hn}\\)$`),hf=new RegExp(`^hsl\\(${hn},${Ut},${Ut}\\)$`),ff=new RegExp(`^hsla\\(${hn},${Ut},${Ut},${hn}\\)$`),eo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ms(_n,fn,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:no,formatHex:no,formatHex8:df,formatHsl:pf,formatRgb:io,toString:io});function no(){return this.rgb().formatHex()}function df(){return this.rgb().formatHex8()}function pf(){return Va(this).formatHsl()}function io(){return this.rgb().formatRgb()}function fn(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=of.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?ro(t):n===3?new gt(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?$n(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?$n(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=af.exec(e))?new gt(t[1],t[2],t[3],1):(t=lf.exec(e))?new gt(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=uf.exec(e))?$n(t[1],t[2],t[3],t[4]):(t=cf.exec(e))?$n(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=hf.exec(e))?ao(t[1],t[2]/100,t[3]/100,1):(t=ff.exec(e))?ao(t[1],t[2]/100,t[3]/100,t[4]):eo.hasOwnProperty(e)?ro(eo[e]):e==="transparent"?new gt(NaN,NaN,NaN,0):null}function ro(e){return new gt(e>>16&255,e>>8&255,e&255,1)}function $n(e,t,n,i){return i<=0&&(e=t=n=NaN),new gt(e,t,n,i)}function gf(e){return e instanceof _n||(e=fn(e)),e?(e=e.rgb(),new gt(e.r,e.g,e.b,e.opacity)):new gt}function yr(e,t,n,i){return arguments.length===1?gf(e):new gt(e,t,n,i??1)}function gt(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}ms(gt,yr,Ka(_n,{brighter(e){return e=e==null?ri:Math.pow(ri,e),new gt(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?cn:Math.pow(cn,e),new gt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new gt(me(this.r),me(this.g),me(this.b),si(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:so,formatHex:so,formatHex8:mf,formatRgb:oo,toString:oo}));function so(){return`#${he(this.r)}${he(this.g)}${he(this.b)}`}function mf(){return`#${he(this.r)}${he(this.g)}${he(this.b)}${he((isNaN(this.opacity)?1:this.opacity)*255)}`}function oo(){const e=si(this.opacity);return`${e===1?"rgb(":"rgba("}${me(this.r)}, ${me(this.g)}, ${me(this.b)}${e===1?")":`, ${e})`}`}function si(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function me(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function he(e){return e=me(e),(e<16?"0":"")+e.toString(16)}function ao(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Ct(e,t,n,i)}function Va(e){if(e instanceof Ct)return new Ct(e.h,e.s,e.l,e.opacity);if(e instanceof _n||(e=fn(e)),!e)return new Ct;if(e instanceof Ct)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),s=Math.max(t,n,i),o=NaN,a=s-r,l=(s+r)/2;return a?(t===s?o=(n-i)/a+(n<i)*6:n===s?o=(i-t)/a+2:o=(t-n)/a+4,a/=l<.5?s+r:2-s-r,o*=60):a=l>0&&l<1?0:o,new Ct(o,a,l,e.opacity)}function yf(e,t,n,i){return arguments.length===1?Va(e):new Ct(e,t,n,i??1)}function Ct(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}ms(Ct,yf,Ka(_n,{brighter(e){return e=e==null?ri:Math.pow(ri,e),new Ct(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?cn:Math.pow(cn,e),new Ct(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new gt(Ji(e>=240?e-240:e+120,r,i),Ji(e,r,i),Ji(e<120?e+240:e-120,r,i),this.opacity)},clamp(){return new Ct(lo(this.h),En(this.s),En(this.l),si(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=si(this.opacity);return`${e===1?"hsl(":"hsla("}${lo(this.h)}, ${En(this.s)*100}%, ${En(this.l)*100}%${e===1?")":`, ${e})`}`}}));function lo(e){return e=(e||0)%360,e<0?e+360:e}function En(e){return Math.max(0,Math.min(1,e||0))}function Ji(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const ja=e=>()=>e;function vf(e,t){return function(n){return e+n*t}}function wf(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function _f(e){return(e=+e)==1?Wa:function(t,n){return n-t?wf(t,n,e):ja(isNaN(t)?n:t)}}function Wa(e,t){var n=t-e;return n?vf(e,n):ja(isNaN(e)?t:e)}const uo=(function e(t){var n=_f(t);function i(r,s){var o=n((r=yr(r)).r,(s=yr(s)).r),a=n(r.g,s.g),l=n(r.b,s.b),u=Wa(r.opacity,s.opacity);return function(h){return r.r=o(h),r.g=a(h),r.b=l(h),r.opacity=u(h),r+""}}return i.gamma=e,i})(1);function ie(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var vr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,tr=new RegExp(vr.source,"g");function xf(e){return function(){return e}}function bf(e){return function(t){return e(t)+""}}function Mf(e,t){var n=vr.lastIndex=tr.lastIndex=0,i,r,s,o=-1,a=[],l=[];for(e=e+"",t=t+"";(i=vr.exec(e))&&(r=tr.exec(t));)(s=r.index)>n&&(s=t.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(i=i[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,l.push({i:o,x:ie(i,r)})),n=tr.lastIndex;return n<t.length&&(s=t.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?bf(l[0].x):xf(t):(t=l.length,function(u){for(var h=0,c;h<t;++h)a[(c=l[h]).i]=c.x(u);return a.join("")})}var co=180/Math.PI,wr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Qa(e,t,n,i,r,s){var o,a,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*i)&&(n-=e*l,i-=t*l),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,l/=a),e*i<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(t,e)*co,skewX:Math.atan(l)*co,scaleX:o,scaleY:a}}var An;function Sf(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?wr:Qa(t.a,t.b,t.c,t.d,t.e,t.f)}function $f(e){return e==null||(An||(An=document.createElementNS("http://www.w3.org/2000/svg","g")),An.setAttribute("transform",e),!(e=An.transform.baseVal.consolidate()))?wr:(e=e.matrix,Qa(e.a,e.b,e.c,e.d,e.e,e.f))}function Za(e,t,n,i){function r(u){return u.length?u.pop()+" ":""}function s(u,h,c,f,v,M){if(u!==c||h!==f){var A=v.push("translate(",null,t,null,n);M.push({i:A-4,x:ie(u,c)},{i:A-2,x:ie(h,f)})}else(c||f)&&v.push("translate("+c+t+f+n)}function o(u,h,c,f){u!==h?(u-h>180?h+=360:h-u>180&&(u+=360),f.push({i:c.push(r(c)+"rotate(",null,i)-2,x:ie(u,h)})):h&&c.push(r(c)+"rotate("+h+i)}function a(u,h,c,f){u!==h?f.push({i:c.push(r(c)+"skewX(",null,i)-2,x:ie(u,h)}):h&&c.push(r(c)+"skewX("+h+i)}function l(u,h,c,f,v,M){if(u!==c||h!==f){var A=v.push(r(v)+"scale(",null,",",null,")");M.push({i:A-4,x:ie(u,c)},{i:A-2,x:ie(h,f)})}else(c!==1||f!==1)&&v.push(r(v)+"scale("+c+","+f+")")}return function(u,h){var c=[],f=[];return u=e(u),h=e(h),s(u.translateX,u.translateY,h.translateX,h.translateY,c,f),o(u.rotate,h.rotate,c,f),a(u.skewX,h.skewX,c,f),l(u.scaleX,u.scaleY,h.scaleX,h.scaleY,c,f),u=h=null,function(v){for(var M=-1,A=f.length,N;++M<A;)c[(N=f[M]).i]=N.x(v);return c.join("")}}}var Ef=Za(Sf,"px, ","px)","deg)"),Af=Za($f,", ",")",")"),If=1e-12;function ho(e){return((e=Math.exp(e))+1/e)/2}function Tf(e){return((e=Math.exp(e))-1/e)/2}function Nf(e){return((e=Math.exp(2*e))-1)/(e+1)}const Cf=(function e(t,n,i){function r(s,o){var a=s[0],l=s[1],u=s[2],h=o[0],c=o[1],f=o[2],v=h-a,M=c-l,A=v*v+M*M,N,I;if(A<If)I=Math.log(f/u)/t,N=function(D){return[a+D*v,l+D*M,u*Math.exp(t*D*I)]};else{var E=Math.sqrt(A),P=(f*f-u*u+i*A)/(2*u*n*E),C=(f*f-u*u-i*A)/(2*f*n*E),k=Math.log(Math.sqrt(P*P+1)-P),O=Math.log(Math.sqrt(C*C+1)-C);I=(O-k)/t,N=function(D){var d=D*I,g=ho(k),w=u/(n*E)*(g*Nf(t*d+k)-Tf(k));return[a+w*v,l+w*M,u*g/ho(t*d+k)]}}return N.duration=I*1e3*t/Math.SQRT2,N}return r.rho=function(s){var o=Math.max(.001,+s),a=o*o,l=a*a;return e(o,a,l)},r})(Math.SQRT2,2,4);var Oe=0,Ve=0,Ge=0,Ja=1e3,oi,je,ai=0,we=0,Bi=0,dn=typeof performance=="object"&&performance.now?performance:Date,tl=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function ys(){return we||(tl(Pf),we=dn.now()+Bi)}function Pf(){we=0}function li(){this._call=this._time=this._next=null}li.prototype=el.prototype={constructor:li,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?ys():+n)+(t==null?0:+t),!this._next&&je!==this&&(je?je._next=this:oi=this,je=this),this._call=e,this._time=n,_r()},stop:function(){this._call&&(this._call=null,this._time=1/0,_r())}};function el(e,t,n){var i=new li;return i.restart(e,t,n),i}function kf(){ys(),++Oe;for(var e=oi,t;e;)(t=we-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Oe}function fo(){we=(ai=dn.now())+Bi,Oe=Ve=0;try{kf()}finally{Oe=0,Rf(),we=0}}function Of(){var e=dn.now(),t=e-ai;t>Ja&&(Bi-=t,ai=e)}function Rf(){for(var e,t=oi,n,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:oi=n);je=e,_r(i)}function _r(e){if(!Oe){Ve&&(Ve=clearTimeout(Ve));var t=e-we;t>24?(e<1/0&&(Ve=setTimeout(fo,e-dn.now()-Bi)),Ge&&(Ge=clearInterval(Ge))):(Ge||(ai=dn.now(),Ge=setInterval(Of,Ja)),Oe=1,tl(fo))}}function po(e,t,n){var i=new li;return t=t==null?0:+t,i.restart(r=>{i.stop(),e(r+t)},t,n),i}var Lf=Di("start","end","cancel","interrupt"),Df=[],nl=0,go=1,xr=2,Xn=3,mo=4,br=5,Yn=6;function Fi(e,t,n,i,r,s){var o=e.__transition;if(!o)e.__transition={};else if(n in o)return;zf(e,n,{name:t,index:i,group:r,on:Lf,tween:Df,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:nl})}function vs(e,t){var n=Rt(e,t);if(n.state>nl)throw new Error("too late; already scheduled");return n}function Gt(e,t){var n=Rt(e,t);if(n.state>Xn)throw new Error("too late; already running");return n}function Rt(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function zf(e,t,n){var i=e.__transition,r;i[t]=n,n.timer=el(s,0,n.time);function s(u){n.state=go,n.timer.restart(o,n.delay,n.time),n.delay<=u&&o(u-n.delay)}function o(u){var h,c,f,v;if(n.state!==go)return l();for(h in i)if(v=i[h],v.name===n.name){if(v.state===Xn)return po(o);v.state===mo?(v.state=Yn,v.timer.stop(),v.on.call("interrupt",e,e.__data__,v.index,v.group),delete i[h]):+h<t&&(v.state=Yn,v.timer.stop(),v.on.call("cancel",e,e.__data__,v.index,v.group),delete i[h])}if(po(function(){n.state===Xn&&(n.state=mo,n.timer.restart(a,n.delay,n.time),a(u))}),n.state=xr,n.on.call("start",e,e.__data__,n.index,n.group),n.state===xr){for(n.state=Xn,r=new Array(f=n.tween.length),h=0,c=-1;h<f;++h)(v=n.tween[h].value.call(e,e.__data__,n.index,n.group))&&(r[++c]=v);r.length=c+1}}function a(u){for(var h=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(l),n.state=br,1),c=-1,f=r.length;++c<f;)r[c].call(e,h);n.state===br&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){n.state=Yn,n.timer.stop(),delete i[t];for(var u in i)return;delete e.__transition}}function Kn(e,t){var n=e.__transition,i,r,s=!0,o;if(n){t=t==null?null:t+"";for(o in n){if((i=n[o]).name!==t){s=!1;continue}r=i.state>xr&&i.state<br,i.state=Yn,i.timer.stop(),i.on.call(r?"interrupt":"cancel",e,e.__data__,i.index,i.group),delete n[o]}s&&delete e.__transition}}function Bf(e){return this.each(function(){Kn(this,e)})}function Ff(e,t){var n,i;return function(){var r=Gt(this,e),s=r.tween;if(s!==n){i=n=s;for(var o=0,a=i.length;o<a;++o)if(i[o].name===t){i=i.slice(),i.splice(o,1);break}}r.tween=i}}function Uf(e,t,n){var i,r;if(typeof n!="function")throw new Error;return function(){var s=Gt(this,e),o=s.tween;if(o!==i){r=(i=o).slice();for(var a={name:t,value:n},l=0,u=r.length;l<u;++l)if(r[l].name===t){r[l]=a;break}l===u&&r.push(a)}s.tween=r}}function Hf(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i=Rt(this.node(),n).tween,r=0,s=i.length,o;r<s;++r)if((o=i[r]).name===e)return o.value;return null}return this.each((t==null?Ff:Uf)(n,e,t))}function ws(e,t,n){var i=e._id;return e.each(function(){var r=Gt(this,i);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return Rt(r,i).value[t]}}function il(e,t){var n;return(typeof t=="number"?ie:t instanceof fn?uo:(n=fn(t))?(t=n,uo):Mf)(e,t)}function qf(e){return function(){this.removeAttribute(e)}}function Gf(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Xf(e,t,n){var i,r=n+"",s;return function(){var o=this.getAttribute(e);return o===r?null:o===i?s:s=t(i=o,n)}}function Yf(e,t,n){var i,r=n+"",s;return function(){var o=this.getAttributeNS(e.space,e.local);return o===r?null:o===i?s:s=t(i=o,n)}}function Kf(e,t,n){var i,r,s;return function(){var o,a=n(this),l;return a==null?void this.removeAttribute(e):(o=this.getAttribute(e),l=a+"",o===l?null:o===i&&l===r?s:(r=l,s=t(i=o,a)))}}function Vf(e,t,n){var i,r,s;return function(){var o,a=n(this),l;return a==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),l=a+"",o===l?null:o===i&&l===r?s:(r=l,s=t(i=o,a)))}}function jf(e,t){var n=zi(e),i=n==="transform"?Af:il;return this.attrTween(e,typeof t=="function"?(n.local?Vf:Kf)(n,i,ws(this,"attr."+e,t)):t==null?(n.local?Gf:qf)(n):(n.local?Yf:Xf)(n,i,t))}function Wf(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function Qf(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function Zf(e,t){var n,i;function r(){var s=t.apply(this,arguments);return s!==i&&(n=(i=s)&&Qf(e,s)),n}return r._value=t,r}function Jf(e,t){var n,i;function r(){var s=t.apply(this,arguments);return s!==i&&(n=(i=s)&&Wf(e,s)),n}return r._value=t,r}function t0(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var i=zi(e);return this.tween(n,(i.local?Zf:Jf)(i,t))}function e0(e,t){return function(){vs(this,e).delay=+t.apply(this,arguments)}}function n0(e,t){return t=+t,function(){vs(this,e).delay=t}}function i0(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?e0:n0)(t,e)):Rt(this.node(),t).delay}function r0(e,t){return function(){Gt(this,e).duration=+t.apply(this,arguments)}}function s0(e,t){return t=+t,function(){Gt(this,e).duration=t}}function o0(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?r0:s0)(t,e)):Rt(this.node(),t).duration}function a0(e,t){if(typeof t!="function")throw new Error;return function(){Gt(this,e).ease=t}}function l0(e){var t=this._id;return arguments.length?this.each(a0(t,e)):Rt(this.node(),t).ease}function u0(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Gt(this,e).ease=n}}function c0(e){if(typeof e!="function")throw new Error;return this.each(u0(this._id,e))}function h0(e){typeof e!="function"&&(e=Oa(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s=t[r],o=s.length,a=i[r]=[],l,u=0;u<o;++u)(l=s[u])&&e.call(l,l.__data__,u,s)&&a.push(l);return new Qt(i,this._parents,this._name,this._id)}function f0(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,r=n.length,s=Math.min(i,r),o=new Array(i),a=0;a<s;++a)for(var l=t[a],u=n[a],h=l.length,c=o[a]=new Array(h),f,v=0;v<h;++v)(f=l[v]||u[v])&&(c[v]=f);for(;a<i;++a)o[a]=t[a];return new Qt(o,this._parents,this._name,this._id)}function d0(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function p0(e,t,n){var i,r,s=d0(t)?vs:Gt;return function(){var o=s(this,e),a=o.on;a!==i&&(r=(i=a).copy()).on(t,n),o.on=r}}function g0(e,t){var n=this._id;return arguments.length<2?Rt(this.node(),n).on.on(e):this.each(p0(n,e,t))}function m0(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function y0(){return this.on("end.remove",m0(this._id))}function v0(e){var t=this._name,n=this._id;typeof e!="function"&&(e=ps(e));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var a=i[o],l=a.length,u=s[o]=new Array(l),h,c,f=0;f<l;++f)(h=a[f])&&(c=e.call(h,h.__data__,f,a))&&("__data__"in h&&(c.__data__=h.__data__),u[f]=c,Fi(u[f],t,n,f,u,Rt(h,n)));return new Qt(s,this._parents,t,n)}function w0(e){var t=this._name,n=this._id;typeof e!="function"&&(e=ka(e));for(var i=this._groups,r=i.length,s=[],o=[],a=0;a<r;++a)for(var l=i[a],u=l.length,h,c=0;c<u;++c)if(h=l[c]){for(var f=e.call(h,h.__data__,c,l),v,M=Rt(h,n),A=0,N=f.length;A<N;++A)(v=f[A])&&Fi(v,t,n,A,f,M);s.push(f),o.push(h)}return new Qt(s,o,t,n)}var _0=wn.prototype.constructor;function x0(){return new _0(this._groups,this._parents)}function b0(e,t){var n,i,r;return function(){var s=ke(this,e),o=(this.style.removeProperty(e),ke(this,e));return s===o?null:s===n&&o===i?r:r=t(n=s,i=o)}}function rl(e){return function(){this.style.removeProperty(e)}}function M0(e,t,n){var i,r=n+"",s;return function(){var o=ke(this,e);return o===r?null:o===i?s:s=t(i=o,n)}}function S0(e,t,n){var i,r,s;return function(){var o=ke(this,e),a=n(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(e),ke(this,e))),o===l?null:o===i&&l===r?s:(r=l,s=t(i=o,a))}}function $0(e,t){var n,i,r,s="style."+t,o="end."+s,a;return function(){var l=Gt(this,e),u=l.on,h=l.value[s]==null?a||(a=rl(t)):void 0;(u!==n||r!==h)&&(i=(n=u).copy()).on(o,r=h),l.on=i}}function E0(e,t,n){var i=(e+="")=="transform"?Ef:il;return t==null?this.styleTween(e,b0(e,i)).on("end.style."+e,rl(e)):typeof t=="function"?this.styleTween(e,S0(e,i,ws(this,"style."+e,t))).each($0(this._id,e)):this.styleTween(e,M0(e,i,t),n).on("end.style."+e,null)}function A0(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}function I0(e,t,n){var i,r;function s(){var o=t.apply(this,arguments);return o!==r&&(i=(r=o)&&A0(e,o,n)),i}return s._value=t,s}function T0(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;return this.tween(i,I0(e,t,n??""))}function N0(e){return function(){this.textContent=e}}function C0(e){return function(){var t=e(this);this.textContent=t??""}}function P0(e){return this.tween("text",typeof e=="function"?C0(ws(this,"text",e)):N0(e==null?"":e+""))}function k0(e){return function(t){this.textContent=e.call(this,t)}}function O0(e){var t,n;function i(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&k0(r)),t}return i._value=e,i}function R0(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,O0(e))}function L0(){for(var e=this._name,t=this._id,n=sl(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],a=o.length,l,u=0;u<a;++u)if(l=o[u]){var h=Rt(l,t);Fi(l,e,n,u,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new Qt(i,this._parents,e,n)}function D0(){var e,t,n=this,i=n._id,r=n.size();return new Promise(function(s,o){var a={value:o},l={value:function(){--r===0&&s()}};n.each(function(){var u=Gt(this,i),h=u.on;h!==e&&(t=(e=h).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),u.on=t}),r===0&&s()})}var z0=0;function Qt(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function sl(){return++z0}var Yt=wn.prototype;Qt.prototype={constructor:Qt,select:v0,selectAll:w0,selectChild:Yt.selectChild,selectChildren:Yt.selectChildren,filter:h0,merge:f0,selection:x0,transition:L0,call:Yt.call,nodes:Yt.nodes,node:Yt.node,size:Yt.size,empty:Yt.empty,each:Yt.each,on:g0,attr:jf,attrTween:t0,style:E0,styleTween:T0,text:P0,textTween:R0,remove:y0,tween:Hf,delay:i0,duration:o0,ease:l0,easeVarying:c0,end:D0,[Symbol.iterator]:Yt[Symbol.iterator]};function B0(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var F0={time:null,delay:0,duration:250,ease:B0};function U0(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function H0(e){var t,n;e instanceof Qt?(t=e._id,e=e._name):(t=sl(),(n=F0).time=ys(),e=e==null?null:e+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],a=o.length,l,u=0;u<a;++u)(l=o[u])&&Fi(l,e,t,u,o,n||U0(l,t));return new Qt(i,this._parents,e,t)}wn.prototype.interrupt=Bf;wn.prototype.transition=H0;const Wt=11102230246251565e-32,st=134217729,q0=(3+8*Wt)*Wt;function er(e,t,n,i,r){let s,o,a,l,u=t[0],h=i[0],c=0,f=0;h>u==h>-u?(s=u,u=t[++c]):(s=h,h=i[++f]);let v=0;if(c<e&&f<n)for(h>u==h>-u?(o=u+s,a=s-(o-u),u=t[++c]):(o=h+s,a=s-(o-h),h=i[++f]),s=o,a!==0&&(r[v++]=a);c<e&&f<n;)h>u==h>-u?(o=s+u,l=o-s,a=s-(o-l)+(u-l),u=t[++c]):(o=s+h,l=o-s,a=s-(o-l)+(h-l),h=i[++f]),s=o,a!==0&&(r[v++]=a);for(;c<e;)o=s+u,l=o-s,a=s-(o-l)+(u-l),u=t[++c],s=o,a!==0&&(r[v++]=a);for(;f<n;)o=s+h,l=o-s,a=s-(o-l)+(h-l),h=i[++f],s=o,a!==0&&(r[v++]=a);return(s!==0||v===0)&&(r[v++]=s),v}function G0(e,t){let n=t[0];for(let i=1;i<e;i++)n+=t[i];return n}function xn(e){return new Float64Array(e)}const X0=(3+16*Wt)*Wt,Y0=(2+12*Wt)*Wt,K0=(9+64*Wt)*Wt*Wt,xe=xn(4),yo=xn(8),vo=xn(12),wo=xn(16),lt=xn(4);function V0(e,t,n,i,r,s,o){let a,l,u,h,c,f,v,M,A,N,I,E,P,C,k,O,D,d;const g=e-r,w=n-r,_=t-s,b=i-s;C=g*b,f=st*g,v=f-(f-g),M=g-v,f=st*b,A=f-(f-b),N=b-A,k=M*N-(C-v*A-M*A-v*N),O=_*w,f=st*_,v=f-(f-_),M=_-v,f=st*w,A=f-(f-w),N=w-A,D=M*N-(O-v*A-M*A-v*N),I=k-D,c=k-I,xe[0]=k-(I+c)+(c-D),E=C+I,c=E-C,P=C-(E-c)+(I-c),I=P-O,c=P-I,xe[1]=P-(I+c)+(c-O),d=E+I,c=d-E,xe[2]=E-(d-c)+(I-c),xe[3]=d;let $=G0(4,xe),y=Y0*o;if($>=y||-$>=y||(c=e-g,a=e-(g+c)+(c-r),c=n-w,u=n-(w+c)+(c-r),c=t-_,l=t-(_+c)+(c-s),c=i-b,h=i-(b+c)+(c-s),a===0&&l===0&&u===0&&h===0)||(y=K0*o+q0*Math.abs($),$+=g*h+b*a-(_*u+w*l),$>=y||-$>=y))return $;C=a*b,f=st*a,v=f-(f-a),M=a-v,f=st*b,A=f-(f-b),N=b-A,k=M*N-(C-v*A-M*A-v*N),O=l*w,f=st*l,v=f-(f-l),M=l-v,f=st*w,A=f-(f-w),N=w-A,D=M*N-(O-v*A-M*A-v*N),I=k-D,c=k-I,lt[0]=k-(I+c)+(c-D),E=C+I,c=E-C,P=C-(E-c)+(I-c),I=P-O,c=P-I,lt[1]=P-(I+c)+(c-O),d=E+I,c=d-E,lt[2]=E-(d-c)+(I-c),lt[3]=d;const p=er(4,xe,4,lt,yo);C=g*h,f=st*g,v=f-(f-g),M=g-v,f=st*h,A=f-(f-h),N=h-A,k=M*N-(C-v*A-M*A-v*N),O=_*u,f=st*_,v=f-(f-_),M=_-v,f=st*u,A=f-(f-u),N=u-A,D=M*N-(O-v*A-M*A-v*N),I=k-D,c=k-I,lt[0]=k-(I+c)+(c-D),E=C+I,c=E-C,P=C-(E-c)+(I-c),I=P-O,c=P-I,lt[1]=P-(I+c)+(c-O),d=E+I,c=d-E,lt[2]=E-(d-c)+(I-c),lt[3]=d;const m=er(p,yo,4,lt,vo);C=a*h,f=st*a,v=f-(f-a),M=a-v,f=st*h,A=f-(f-h),N=h-A,k=M*N-(C-v*A-M*A-v*N),O=l*u,f=st*l,v=f-(f-l),M=l-v,f=st*u,A=f-(f-u),N=u-A,D=M*N-(O-v*A-M*A-v*N),I=k-D,c=k-I,lt[0]=k-(I+c)+(c-D),E=C+I,c=E-C,P=C-(E-c)+(I-c),I=P-O,c=P-I,lt[1]=P-(I+c)+(c-O),d=E+I,c=d-E,lt[2]=E-(d-c)+(I-c),lt[3]=d;const x=er(m,vo,4,lt,wo);return wo[x-1]}function In(e,t,n,i,r,s){const o=(t-s)*(n-r),a=(e-r)*(i-s),l=o-a,u=Math.abs(o+a);return Math.abs(l)>=X0*u?l:-V0(e,t,n,i,r,s,u)}const _o=Math.pow(2,-52),Tn=new Uint32Array(512);class ui{static from(t,n=J0,i=td){const r=t.length,s=new Float64Array(r*2);for(let o=0;o<r;o++){const a=t[o];s[2*o]=n(a),s[2*o+1]=i(a)}return new ui(s)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const i=Math.max(2*n-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:i,_hullTri:r,_hullHash:s}=this,o=t.length>>1;let a=1/0,l=1/0,u=-1/0,h=-1/0;for(let g=0;g<o;g++){const w=t[2*g],_=t[2*g+1];w<a&&(a=w),_<l&&(l=_),w>u&&(u=w),_>h&&(h=_),this._ids[g]=g}const c=(a+u)/2,f=(l+h)/2;let v,M,A;for(let g=0,w=1/0;g<o;g++){const _=nr(c,f,t[2*g],t[2*g+1]);_<w&&(v=g,w=_)}const N=t[2*v],I=t[2*v+1];for(let g=0,w=1/0;g<o;g++){if(g===v)continue;const _=nr(N,I,t[2*g],t[2*g+1]);_<w&&_>0&&(M=g,w=_)}let E=t[2*M],P=t[2*M+1],C=1/0;for(let g=0;g<o;g++){if(g===v||g===M)continue;const w=Q0(N,I,E,P,t[2*g],t[2*g+1]);w<C&&(A=g,C=w)}let k=t[2*A],O=t[2*A+1];if(C===1/0){for(let _=0;_<o;_++)this._dists[_]=t[2*_]-t[0]||t[2*_+1]-t[1];Ae(this._ids,this._dists,0,o-1);const g=new Uint32Array(o);let w=0;for(let _=0,b=-1/0;_<o;_++){const $=this._ids[_],y=this._dists[$];y>b&&(g[w++]=$,b=y)}this.hull=g.subarray(0,w),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(In(N,I,E,P,k,O)<0){const g=M,w=E,_=P;M=A,E=k,P=O,A=g,k=w,O=_}const D=Z0(N,I,E,P,k,O);this._cx=D.x,this._cy=D.y;for(let g=0;g<o;g++)this._dists[g]=nr(t[2*g],t[2*g+1],D.x,D.y);Ae(this._ids,this._dists,0,o-1),this._hullStart=v;let d=3;i[v]=n[A]=M,i[M]=n[v]=A,i[A]=n[M]=v,r[v]=0,r[M]=1,r[A]=2,s.fill(-1),s[this._hashKey(N,I)]=v,s[this._hashKey(E,P)]=M,s[this._hashKey(k,O)]=A,this.trianglesLen=0,this._addTriangle(v,M,A,-1,-1,-1);for(let g=0,w,_;g<this._ids.length;g++){const b=this._ids[g],$=t[2*b],y=t[2*b+1];if(g>0&&Math.abs($-w)<=_o&&Math.abs(y-_)<=_o||(w=$,_=y,b===v||b===M||b===A))continue;let p=0;for(let R=0,L=this._hashKey($,y);R<this._hashSize&&(p=s[(L+R)%this._hashSize],!(p!==-1&&p!==i[p]));R++);p=n[p];let m=p,x;for(;x=i[m],In($,y,t[2*m],t[2*m+1],t[2*x],t[2*x+1])>=0;)if(m=x,m===p){m=-1;break}if(m===-1)continue;let S=this._addTriangle(m,b,i[m],-1,-1,r[m]);r[b]=this._legalize(S+2),r[m]=S,d++;let T=i[m];for(;x=i[T],In($,y,t[2*T],t[2*T+1],t[2*x],t[2*x+1])<0;)S=this._addTriangle(T,b,x,r[b],-1,r[T]),r[b]=this._legalize(S+2),i[T]=T,d--,T=x;if(m===p)for(;x=n[m],In($,y,t[2*x],t[2*x+1],t[2*m],t[2*m+1])<0;)S=this._addTriangle(x,b,m,-1,r[m],r[x]),this._legalize(S+2),r[x]=S,i[m]=m,d--,m=x;this._hullStart=n[b]=m,i[m]=n[T]=b,i[b]=T,s[this._hashKey($,y)]=b,s[this._hashKey(t[2*m],t[2*m+1])]=m}this.hull=new Uint32Array(d);for(let g=0,w=this._hullStart;g<d;g++)this.hull[g]=w,w=i[w];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(j0(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:i,coords:r}=this;let s=0,o=0;for(;;){const a=i[t],l=t-t%3;if(o=l+(t+2)%3,a===-1){if(s===0)break;t=Tn[--s];continue}const u=a-a%3,h=l+(t+1)%3,c=u+(a+2)%3,f=n[o],v=n[t],M=n[h],A=n[c];if(W0(r[2*f],r[2*f+1],r[2*v],r[2*v+1],r[2*M],r[2*M+1],r[2*A],r[2*A+1])){n[t]=A,n[a]=f;const I=i[c];if(I===-1){let P=this._hullStart;do{if(this._hullTri[P]===c){this._hullTri[P]=t;break}P=this._hullPrev[P]}while(P!==this._hullStart)}this._link(t,I),this._link(a,i[o]),this._link(o,c);const E=u+(a+1)%3;s<Tn.length&&(Tn[s++]=E)}else{if(s===0)break;t=Tn[--s]}}return o}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,i,r,s,o){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=n,this._triangles[a+2]=i,this._link(a,r),this._link(a+1,s),this._link(a+2,o),this.trianglesLen+=3,a}}function j0(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function nr(e,t,n,i){const r=e-n,s=t-i;return r*r+s*s}function W0(e,t,n,i,r,s,o,a){const l=e-o,u=t-a,h=n-o,c=i-a,f=r-o,v=s-a,M=l*l+u*u,A=h*h+c*c,N=f*f+v*v;return l*(c*N-A*v)-u*(h*N-A*f)+M*(h*v-c*f)<0}function Q0(e,t,n,i,r,s){const o=n-e,a=i-t,l=r-e,u=s-t,h=o*o+a*a,c=l*l+u*u,f=.5/(o*u-a*l),v=(u*h-a*c)*f,M=(o*c-l*h)*f;return v*v+M*M}function Z0(e,t,n,i,r,s){const o=n-e,a=i-t,l=r-e,u=s-t,h=o*o+a*a,c=l*l+u*u,f=.5/(o*u-a*l),v=e+(u*h-a*c)*f,M=t+(o*c-l*h)*f;return{x:v,y:M}}function Ae(e,t,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){const s=e[r],o=t[s];let a=r-1;for(;a>=n&&t[e[a]]>o;)e[a+1]=e[a--];e[a+1]=s}else{const r=n+i>>1;let s=n+1,o=i;Xe(e,r,s),t[e[n]]>t[e[i]]&&Xe(e,n,i),t[e[s]]>t[e[i]]&&Xe(e,s,i),t[e[n]]>t[e[s]]&&Xe(e,n,s);const a=e[s],l=t[a];for(;;){do s++;while(t[e[s]]<l);do o--;while(t[e[o]]>l);if(o<s)break;Xe(e,s,o)}e[n+1]=e[o],e[o]=a,i-s+1>=o-n?(Ae(e,t,s,i),Ae(e,t,n,o-1)):(Ae(e,t,n,o-1),Ae(e,t,s,i))}}function Xe(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function J0(e){return e[0]}function td(e){return e[1]}const xo=1e-6;class fe{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,i){t=+t,n=+n,i=+i;const r=t+i,s=n;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${r},${s}`:(Math.abs(this._x1-r)>xo||Math.abs(this._y1-s)>xo)&&(this._+="L"+r+","+s),i&&(this._+=`A${i},${i},0,1,1,${t-i},${n}A${i},${i},0,1,1,${this._x1=r},${this._y1=s}`)}rect(t,n,i,r){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+i}v${+r}h${-i}Z`}value(){return this._||null}}class Mr{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}class ed{constructor(t,[n,i,r,s]=[0,0,960,500]){if(!((r=+r)>=(n=+n))||!((s=+s)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=r,this.xmin=n,this.ymax=s,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:i},vectors:r}=this;let s,o;const a=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let A=0,N=0,I=i.length,E,P;A<I;A+=3,N+=2){const C=i[A]*2,k=i[A+1]*2,O=i[A+2]*2,D=t[C],d=t[C+1],g=t[k],w=t[k+1],_=t[O],b=t[O+1],$=g-D,y=w-d,p=_-D,m=b-d,x=($*m-y*p)*2;if(Math.abs(x)<1e-9){if(s===void 0){s=o=0;for(const T of n)s+=t[T*2],o+=t[T*2+1];s/=n.length,o/=n.length}const S=1e9*Math.sign((s-D)*m-(o-d)*p);E=(D+_)/2-S*m,P=(d+b)/2+S*p}else{const S=1/x,T=$*$+y*y,R=p*p+m*m;E=D+(m*T-y*R)*S,P=d+($*R-p*T)*S}a[N]=E,a[N+1]=P}let l=n[n.length-1],u,h=l*4,c,f=t[2*l],v,M=t[2*l+1];r.fill(0);for(let A=0;A<n.length;++A)l=n[A],u=h,c=f,v=M,h=l*4,f=t[2*l],M=t[2*l+1],r[u+2]=r[h]=v-M,r[u+3]=r[h+1]=f-c}render(t){const n=t==null?t=new fe:void 0,{delaunay:{halfedges:i,inedges:r,hull:s},circumcenters:o,vectors:a}=this;if(s.length<=1)return null;for(let h=0,c=i.length;h<c;++h){const f=i[h];if(f<h)continue;const v=Math.floor(h/3)*2,M=Math.floor(f/3)*2,A=o[v],N=o[v+1],I=o[M],E=o[M+1];this._renderSegment(A,N,I,E,t)}let l,u=s[s.length-1];for(let h=0;h<s.length;++h){l=u,u=s[h];const c=Math.floor(r[u]/3)*2,f=o[c],v=o[c+1],M=l*4,A=this._project(f,v,a[M+2],a[M+3]);A&&this._renderSegment(f,v,A[0],A[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new fe:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const i=n==null?n=new fe:void 0,r=this._clip(t);if(r===null||!r.length)return;n.moveTo(r[0],r[1]);let s=r.length;for(;r[0]===r[s-2]&&r[1]===r[s-1]&&s>1;)s-=2;for(let o=2;o<s;o+=2)(r[o]!==r[o-2]||r[o+1]!==r[o-1])&&n.lineTo(r[o],r[o+1]);return n.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,i=t.length/2;n<i;++n){const r=this.cellPolygon(n);r&&(r.index=n,yield r)}}cellPolygon(t){const n=new Mr;return this.renderCell(t,n),n.value()}_renderSegment(t,n,i,r,s){let o;const a=this._regioncode(t,n),l=this._regioncode(i,r);a===0&&l===0?(s.moveTo(t,n),s.lineTo(i,r)):(o=this._clipSegment(t,n,i,r,a,l))&&(s.moveTo(o[0],o[1]),s.lineTo(o[2],o[3]))}contains(t,n,i){return n=+n,n!==n||(i=+i,i!==i)?!1:this.delaunay._step(t,n,i)===t}*neighbors(t){const n=this._clip(t);if(n)for(const i of this.delaunay.neighbors(t)){const r=this._clip(i);if(r){t:for(let s=0,o=n.length;s<o;s+=2)for(let a=0,l=r.length;a<l;a+=2)if(n[s]===r[a]&&n[s+1]===r[a+1]&&n[(s+2)%o]===r[(a+l-2)%l]&&n[(s+3)%o]===r[(a+l-1)%l]){yield i;break t}}}}_cell(t){const{circumcenters:n,delaunay:{inedges:i,halfedges:r,triangles:s}}=this,o=i[t];if(o===-1)return null;const a=[];let l=o;do{const u=Math.floor(l/3);if(a.push(n[u*2],n[u*2+1]),l=l%3===2?l-2:l+1,s[l]!==t)break;l=r[l]}while(l!==o&&l!==-1);return a}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:i}=this,r=t*4;return this._simplify(i[r]||i[r+1]?this._clipInfinite(t,n,i[r],i[r+1],i[r+2],i[r+3]):this._clipFinite(t,n))}_clipFinite(t,n){const i=n.length;let r=null,s,o,a=n[i-2],l=n[i-1],u,h=this._regioncode(a,l),c,f=0;for(let v=0;v<i;v+=2)if(s=a,o=l,a=n[v],l=n[v+1],u=h,h=this._regioncode(a,l),u===0&&h===0)c=f,f=0,r?r.push(a,l):r=[a,l];else{let M,A,N,I,E;if(u===0){if((M=this._clipSegment(s,o,a,l,u,h))===null)continue;[A,N,I,E]=M}else{if((M=this._clipSegment(a,l,s,o,h,u))===null)continue;[I,E,A,N]=M,c=f,f=this._edgecode(A,N),c&&f&&this._edge(t,c,f,r,r.length),r?r.push(A,N):r=[A,N]}c=f,f=this._edgecode(I,E),c&&f&&this._edge(t,c,f,r,r.length),r?r.push(I,E):r=[I,E]}if(r)c=f,f=this._edgecode(r[0],r[1]),c&&f&&this._edge(t,c,f,r,r.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return r}_clipSegment(t,n,i,r,s,o){const a=s<o;for(a&&([t,n,i,r,s,o]=[i,r,t,n,o,s]);;){if(s===0&&o===0)return a?[i,r,t,n]:[t,n,i,r];if(s&o)return null;let l,u,h=s||o;h&8?(l=t+(i-t)*(this.ymax-n)/(r-n),u=this.ymax):h&4?(l=t+(i-t)*(this.ymin-n)/(r-n),u=this.ymin):h&2?(u=n+(r-n)*(this.xmax-t)/(i-t),l=this.xmax):(u=n+(r-n)*(this.xmin-t)/(i-t),l=this.xmin),s?(t=l,n=u,s=this._regioncode(t,n)):(i=l,r=u,o=this._regioncode(i,r))}}_clipInfinite(t,n,i,r,s,o){let a=Array.from(n),l;if((l=this._project(a[0],a[1],i,r))&&a.unshift(l[0],l[1]),(l=this._project(a[a.length-2],a[a.length-1],s,o))&&a.push(l[0],l[1]),a=this._clipFinite(t,a))for(let u=0,h=a.length,c,f=this._edgecode(a[h-2],a[h-1]);u<h;u+=2)c=f,f=this._edgecode(a[u],a[u+1]),c&&f&&(u=this._edge(t,c,f,a,u),h=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,n,i,r,s){for(;n!==i;){let o,a;switch(n){case 5:n=4;continue;case 4:n=6,o=this.xmax,a=this.ymin;break;case 6:n=2;continue;case 2:n=10,o=this.xmax,a=this.ymax;break;case 10:n=8;continue;case 8:n=9,o=this.xmin,a=this.ymax;break;case 9:n=1;continue;case 1:n=5,o=this.xmin,a=this.ymin;break}(r[s]!==o||r[s+1]!==a)&&this.contains(t,o,a)&&(r.splice(s,0,o,a),s+=2)}return s}_project(t,n,i,r){let s=1/0,o,a,l;if(r<0){if(n<=this.ymin)return null;(o=(this.ymin-n)/r)<s&&(l=this.ymin,a=t+(s=o)*i)}else if(r>0){if(n>=this.ymax)return null;(o=(this.ymax-n)/r)<s&&(l=this.ymax,a=t+(s=o)*i)}if(i>0){if(t>=this.xmax)return null;(o=(this.xmax-t)/i)<s&&(a=this.xmax,l=n+(s=o)*r)}else if(i<0){if(t<=this.xmin)return null;(o=(this.xmin-t)/i)<s&&(a=this.xmin,l=n+(s=o)*r)}return[a,l]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}_simplify(t){if(t&&t.length>4){for(let n=0;n<t.length;n+=2){const i=(n+2)%t.length,r=(n+4)%t.length;(t[n]===t[i]&&t[i]===t[r]||t[n+1]===t[i+1]&&t[i+1]===t[r+1])&&(t.splice(i,2),n-=2)}t.length||(t=null)}return t}}const nd=2*Math.PI,be=Math.pow;function id(e){return e[0]}function rd(e){return e[1]}function sd(e){const{triangles:t,coords:n}=e;for(let i=0;i<t.length;i+=3){const r=2*t[i],s=2*t[i+1],o=2*t[i+2];if((n[o]-n[r])*(n[s+1]-n[r+1])-(n[s]-n[r])*(n[o+1]-n[r+1])>1e-10)return!1}return!0}function od(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class _s{static from(t,n=id,i=rd,r){return new _s("length"in t?ad(t,n,i,r):Float64Array.from(ld(t,n,i,r)))}constructor(t){this._delaunator=new ui(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&sd(t)){this.collinear=Int32Array.from({length:n.length/2},(f,v)=>v).sort((f,v)=>n[2*f]-n[2*v]||n[2*f+1]-n[2*v+1]);const l=this.collinear[0],u=this.collinear[this.collinear.length-1],h=[n[2*l],n[2*l+1],n[2*u],n[2*u+1]],c=1e-8*Math.hypot(h[3]-h[1],h[2]-h[0]);for(let f=0,v=n.length/2;f<v;++f){const M=od(n[2*f],n[2*f+1],c);n[2*f]=M[0],n[2*f+1]=M[1]}this._delaunator=new ui(n)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let l=0,u=i.length;l<u;++l){const h=s[l%3===2?l-2:l+1];(i[l]===-1||o[h]===-1)&&(o[h]=l)}for(let l=0,u=r.length;l<u;++l)a[r[l]]=l;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],o[r[0]]=1,r.length===2&&(o[r[1]]=0,this.triangles[1]=r[1],this.triangles[2]=r[1]))}voronoi(t){return new ed(this,t)}*neighbors(t){const{inedges:n,hull:i,_hullIndex:r,halfedges:s,triangles:o,collinear:a}=this;if(a){const c=a.indexOf(t);c>0&&(yield a[c-1]),c<a.length-1&&(yield a[c+1]);return}const l=n[t];if(l===-1)return;let u=l,h=-1;do{if(yield h=o[u],u=u%3===2?u-2:u+1,o[u]!==t)return;if(u=s[u],u===-1){const c=i[(r[t]+1)%i.length];c!==h&&(yield c);return}}while(u!==l)}find(t,n,i=0){if(t=+t,t!==t||(n=+n,n!==n))return-1;const r=i;let s;for(;(s=this._step(i,t,n))>=0&&s!==i&&s!==r;)i=s;return s}_step(t,n,i){const{inedges:r,hull:s,_hullIndex:o,halfedges:a,triangles:l,points:u}=this;if(r[t]===-1||!u.length)return(t+1)%(u.length>>1);let h=t,c=be(n-u[t*2],2)+be(i-u[t*2+1],2);const f=r[t];let v=f;do{let M=l[v];const A=be(n-u[M*2],2)+be(i-u[M*2+1],2);if(A<c&&(c=A,h=M),v=v%3===2?v-2:v+1,l[v]!==t)break;if(v=a[v],v===-1){if(v=s[(o[t]+1)%s.length],v!==M&&be(n-u[v*2],2)+be(i-u[v*2+1],2)<c)return v;break}}while(v!==f);return h}render(t){const n=t==null?t=new fe:void 0,{points:i,halfedges:r,triangles:s}=this;for(let o=0,a=r.length;o<a;++o){const l=r[o];if(l<o)continue;const u=s[o]*2,h=s[l]*2;t.moveTo(i[u],i[u+1]),t.lineTo(i[h],i[h+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n){n===void 0&&(!t||typeof t.moveTo!="function")&&(n=t,t=null),n=n==null?2:+n;const i=t==null?t=new fe:void 0,{points:r}=this;for(let s=0,o=r.length;s<o;s+=2){const a=r[s],l=r[s+1];t.moveTo(a+n,l),t.arc(a,l,n,0,nd)}return i&&i.value()}renderHull(t){const n=t==null?t=new fe:void 0,{hull:i,points:r}=this,s=i[0]*2,o=i.length;t.moveTo(r[s],r[s+1]);for(let a=1;a<o;++a){const l=2*i[a];t.lineTo(r[l],r[l+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new Mr;return this.renderHull(t),t.value()}renderTriangle(t,n){const i=n==null?n=new fe:void 0,{points:r,triangles:s}=this,o=s[t*=3]*2,a=s[t+1]*2,l=s[t+2]*2;return n.moveTo(r[o],r[o+1]),n.lineTo(r[a],r[a+1]),n.lineTo(r[l],r[l+1]),n.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,i=t.length/3;n<i;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new Mr;return this.renderTriangle(t,n),n.value()}}function ad(e,t,n,i){const r=e.length,s=new Float64Array(r*2);for(let o=0;o<r;++o){const a=e[o];s[o*2]=t.call(i,a,o,e),s[o*2+1]=n.call(i,a,o,e)}return s}function*ld(e,t,n,i){let r=0;for(const s of e)yield t.call(i,s,r,e),yield n.call(i,s,r,e),++r}function ud(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function ci(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function cd(e){return e=ci(Math.abs(e)),e?e[1]:NaN}function hd(e,t){return function(n,i){for(var r=n.length,s=[],o=0,a=e[0],l=0;r>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),s.push(n.substring(r-=a,r+a)),!((l+=a+1)>i));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function fd(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var dd=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Sr(e){if(!(t=dd.exec(e)))throw new Error("invalid format: "+e);var t;return new xs({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Sr.prototype=xs.prototype;function xs(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}xs.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function pd(e){t:for(var t=e.length,n=1,i=-1,r;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+e[n])break t;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(r+1):e}var ol;function gd(e,t){var n=ci(e,t);if(!n)return e+"";var i=n[0],r=n[1],s=r-(ol=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+ci(e,Math.max(0,t+s-1))[0]}function bo(e,t){var n=ci(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const Mo={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:ud,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>bo(e*100,t),r:bo,s:gd,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function So(e){return e}var $o=Array.prototype.map,Eo=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function md(e){var t=e.grouping===void 0||e.thousands===void 0?So:hd($o.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?So:fd($o.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function u(c){c=Sr(c);var f=c.fill,v=c.align,M=c.sign,A=c.symbol,N=c.zero,I=c.width,E=c.comma,P=c.precision,C=c.trim,k=c.type;k==="n"?(E=!0,k="g"):Mo[k]||(P===void 0&&(P=12),C=!0,k="g"),(N||f==="0"&&v==="=")&&(N=!0,f="0",v="=");var O=A==="$"?n:A==="#"&&/[boxX]/.test(k)?"0"+k.toLowerCase():"",D=A==="$"?i:/[%p]/.test(k)?o:"",d=Mo[k],g=/[defgprs%]/.test(k);P=P===void 0?6:/[gprs]/.test(k)?Math.max(1,Math.min(21,P)):Math.max(0,Math.min(20,P));function w(_){var b=O,$=D,y,p,m;if(k==="c")$=d(_)+$,_="";else{_=+_;var x=_<0||1/_<0;if(_=isNaN(_)?l:d(Math.abs(_),P),C&&(_=pd(_)),x&&+_==0&&M!=="+"&&(x=!1),b=(x?M==="("?M:a:M==="-"||M==="("?"":M)+b,$=(k==="s"?Eo[8+ol/3]:"")+$+(x&&M==="("?")":""),g){for(y=-1,p=_.length;++y<p;)if(m=_.charCodeAt(y),48>m||m>57){$=(m===46?r+_.slice(y+1):_.slice(y))+$,_=_.slice(0,y);break}}}E&&!N&&(_=t(_,1/0));var S=b.length+_.length+$.length,T=S<I?new Array(I-S+1).join(f):"";switch(E&&N&&(_=t(T+_,T.length?I-$.length:1/0),T=""),v){case"<":_=b+_+$+T;break;case"=":_=b+T+_+$;break;case"^":_=T.slice(0,S=T.length>>1)+b+_+$+T.slice(S);break;default:_=T+b+_+$;break}return s(_)}return w.toString=function(){return c+""},w}function h(c,f){var v=u((c=Sr(c),c.type="f",c)),M=Math.max(-8,Math.min(8,Math.floor(cd(f)/3)))*3,A=Math.pow(10,-M),N=Eo[8+M/3];return function(I){return v(A*I)+N}}return{format:u,formatPrefix:h}}var Nn,bs;yd({thousands:",",grouping:[3],currency:["$",""]});function yd(e){return Nn=md(e),bs=Nn.format,Nn.formatPrefix,Nn}var Y=1e-6,$r=1e-12,K=Math.PI,ot=K/2,Ao=K/4,wt=K*2,ut=180/K,V=K/180,Q=Math.abs,Ui=Math.atan,Zt=Math.atan2,X=Math.cos,Cn=Math.ceil,al=Math.exp,Er=Math.hypot,ll=Math.log,q=Math.sin,vd=Math.sign||function(e){return e>0?1:e<0?-1:0},Xt=Math.sqrt,ul=Math.tan;function wd(e){return e>1?0:e<-1?K:Math.acos(e)}function Jt(e){return e>1?ot:e<-1?-ot:Math.asin(e)}function nt(){}function hi(e,t){e&&To.hasOwnProperty(e.type)&&To[e.type](e,t)}var Io={Feature:function(e,t){hi(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)hi(n[i].geometry,t)}},To={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){Ar(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)Ar(n[i],t,0)},Polygon:function(e,t){No(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)No(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)hi(n[i],t)}};function Ar(e,t,n){var i=-1,r=e.length-n,s;for(t.lineStart();++i<r;)s=e[i],t.point(s[0],s[1],s[2]);t.lineEnd()}function No(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)Ar(e[n],t,1);t.polygonEnd()}function se(e,t){e&&Io.hasOwnProperty(e.type)?Io[e.type](e,t):hi(e,t)}function Ir(e){return[Zt(e[1],e[0]),Jt(e[2])]}function Re(e){var t=e[0],n=e[1],i=X(n);return[i*X(t),i*q(t),q(n)]}function Pn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function fi(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function ir(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function kn(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Tr(e){var t=Xt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var We,di,pi,gi,mi,yi,vi,wi,Nr,Cr,Pr,cl,hl,ct,ht,ft,Pt={sphere:nt,point:Ms,lineStart:Co,lineEnd:Po,polygonStart:function(){Pt.lineStart=bd,Pt.lineEnd=Md},polygonEnd:function(){Pt.lineStart=Co,Pt.lineEnd=Po}};function Ms(e,t){e*=V,t*=V;var n=X(t);bn(n*X(e),n*q(e),q(t))}function bn(e,t,n){++We,pi+=(e-pi)/We,gi+=(t-gi)/We,mi+=(n-mi)/We}function Co(){Pt.point=_d}function _d(e,t){e*=V,t*=V;var n=X(t);ct=n*X(e),ht=n*q(e),ft=q(t),Pt.point=xd,bn(ct,ht,ft)}function xd(e,t){e*=V,t*=V;var n=X(t),i=n*X(e),r=n*q(e),s=q(t),o=Zt(Xt((o=ht*s-ft*r)*o+(o=ft*i-ct*s)*o+(o=ct*r-ht*i)*o),ct*i+ht*r+ft*s);di+=o,yi+=o*(ct+(ct=i)),vi+=o*(ht+(ht=r)),wi+=o*(ft+(ft=s)),bn(ct,ht,ft)}function Po(){Pt.point=Ms}function bd(){Pt.point=Sd}function Md(){fl(cl,hl),Pt.point=Ms}function Sd(e,t){cl=e,hl=t,e*=V,t*=V,Pt.point=fl;var n=X(t);ct=n*X(e),ht=n*q(e),ft=q(t),bn(ct,ht,ft)}function fl(e,t){e*=V,t*=V;var n=X(t),i=n*X(e),r=n*q(e),s=q(t),o=ht*s-ft*r,a=ft*i-ct*s,l=ct*r-ht*i,u=Er(o,a,l),h=Jt(u),c=u&&-h/u;Nr.add(c*o),Cr.add(c*a),Pr.add(c*l),di+=h,yi+=h*(ct+(ct=i)),vi+=h*(ht+(ht=r)),wi+=h*(ft+(ft=s)),bn(ct,ht,ft)}function ko(e){We=di=pi=gi=mi=yi=vi=wi=0,Nr=new kt,Cr=new kt,Pr=new kt,se(e,Pt);var t=+Nr,n=+Cr,i=+Pr,r=Er(t,n,i);return r<$r&&(t=yi,n=vi,i=wi,di<Y&&(t=pi,n=gi,i=mi),r=Er(t,n,i),r<$r)?[NaN,NaN]:[Zt(n,t)*ut,Jt(i/r)*ut]}function kr(e,t){function n(i,r){return i=e(i,r),t(i[0],i[1])}return e.invert&&t.invert&&(n.invert=function(i,r){return i=t.invert(i,r),i&&e.invert(i[0],i[1])}),n}function Or(e,t){return Q(e)>K&&(e-=Math.round(e/wt)*wt),[e,t]}Or.invert=Or;function dl(e,t,n){return(e%=wt)?t||n?kr(Ro(e),Lo(t,n)):Ro(e):t||n?Lo(t,n):Or}function Oo(e){return function(t,n){return t+=e,Q(t)>K&&(t-=Math.round(t/wt)*wt),[t,n]}}function Ro(e){var t=Oo(e);return t.invert=Oo(-e),t}function Lo(e,t){var n=X(e),i=q(e),r=X(t),s=q(t);function o(a,l){var u=X(l),h=X(a)*u,c=q(a)*u,f=q(l),v=f*n+h*i;return[Zt(c*r-v*s,h*n-f*i),Jt(v*r+c*s)]}return o.invert=function(a,l){var u=X(l),h=X(a)*u,c=q(a)*u,f=q(l),v=f*r-c*s;return[Zt(c*r+f*s,h*n+v*i),Jt(v*n-h*i)]},o}function _i(e){e=dl(e[0]*V,e[1]*V,e.length>2?e[2]*V:0);function t(n){return n=e(n[0]*V,n[1]*V),n[0]*=ut,n[1]*=ut,n}return t.invert=function(n){return n=e.invert(n[0]*V,n[1]*V),n[0]*=ut,n[1]*=ut,n},t}function $d(e,t,n,i,r,s){if(n){var o=X(t),a=q(t),l=i*n;r==null?(r=t+i*wt,s=t-l/2):(r=Do(o,r),s=Do(o,s),(i>0?r<s:r>s)&&(r+=i*wt));for(var u,h=r;i>0?h>s:h<s;h-=l)u=Ir([o,-a*X(h),-a*q(h)]),e.point(u[0],u[1])}}function Do(e,t){t=Re(t),t[0]-=e,Tr(t);var n=wd(-t[1]);return((-t[2]<0?-n:n)+wt-Y)%wt}function pl(){var e=[],t;return{point:function(n,i,r){t.push([n,i,r])},lineStart:function(){e.push(t=[])},lineEnd:nt,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function Vn(e,t){return Q(e[0]-t[0])<Y&&Q(e[1]-t[1])<Y}function On(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function gl(e,t,n,i,r){var s=[],o=[],a,l;if(e.forEach(function(M){if(!((A=M.length-1)<=0)){var A,N=M[0],I=M[A],E;if(Vn(N,I)){if(!N[2]&&!I[2]){for(r.lineStart(),a=0;a<A;++a)r.point((N=M[a])[0],N[1]);r.lineEnd();return}I[0]+=2*Y}s.push(E=new On(N,M,null,!0)),o.push(E.o=new On(N,null,E,!1)),s.push(E=new On(I,M,null,!1)),o.push(E.o=new On(I,null,E,!0))}}),!!s.length){for(o.sort(t),zo(s),zo(o),a=0,l=o.length;a<l;++a)o[a].e=n=!n;for(var u=s[0],h,c;;){for(var f=u,v=!0;f.v;)if((f=f.n)===u)return;h=f.z,r.lineStart();do{if(f.v=f.o.v=!0,f.e){if(v)for(a=0,l=h.length;a<l;++a)r.point((c=h[a])[0],c[1]);else i(f.x,f.n.x,1,r);f=f.n}else{if(v)for(h=f.p.z,a=h.length-1;a>=0;--a)r.point((c=h[a])[0],c[1]);else i(f.x,f.p.x,-1,r);f=f.p}f=f.o,h=f.z,v=!v}while(!f.v);r.lineEnd()}}}function zo(e){if(t=e.length){for(var t,n=0,i=e[0],r;++n<t;)i.n=r=e[n],r.p=i,i=r;i.n=r=e[0],r.p=i}}function rr(e){return Q(e[0])<=K?e[0]:vd(e[0])*((Q(e[0])+K)%wt-K)}function Ed(e,t){var n=rr(t),i=t[1],r=q(i),s=[q(n),-X(n),0],o=0,a=0,l=new kt;r===1?i=ot+Y:r===-1&&(i=-ot-Y);for(var u=0,h=e.length;u<h;++u)if(f=(c=e[u]).length)for(var c,f,v=c[f-1],M=rr(v),A=v[1]/2+Ao,N=q(A),I=X(A),E=0;E<f;++E,M=C,N=O,I=D,v=P){var P=c[E],C=rr(P),k=P[1]/2+Ao,O=q(k),D=X(k),d=C-M,g=d>=0?1:-1,w=g*d,_=w>K,b=N*O;if(l.add(Zt(b*g*q(w),I*D+b*X(w))),o+=_?d+g*wt:d,_^M>=n^C>=n){var $=fi(Re(v),Re(P));Tr($);var y=fi(s,$);Tr(y);var p=(_^d>=0?-1:1)*Jt(y[2]);(i>p||i===p&&($[0]||$[1]))&&(a+=_^d>=0?1:-1)}}return(o<-Y||o<Y&&l<-$r)^a&1}function ml(e,t,n,i){return function(r){var s=t(r),o=pl(),a=t(o),l=!1,u,h,c,f={point:v,lineStart:A,lineEnd:N,polygonStart:function(){f.point=I,f.lineStart=E,f.lineEnd=P,h=[],u=[]},polygonEnd:function(){f.point=v,f.lineStart=A,f.lineEnd=N,h=Ca(h);var C=Ed(u,i);h.length?(l||(r.polygonStart(),l=!0),gl(h,Id,C,n,r)):C&&(l||(r.polygonStart(),l=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),l&&(r.polygonEnd(),l=!1),h=u=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function v(C,k){e(C,k)&&r.point(C,k)}function M(C,k){s.point(C,k)}function A(){f.point=M,s.lineStart()}function N(){f.point=v,s.lineEnd()}function I(C,k){c.push([C,k]),a.point(C,k)}function E(){a.lineStart(),c=[]}function P(){I(c[0][0],c[0][1]),a.lineEnd();var C=a.clean(),k=o.result(),O,D=k.length,d,g,w;if(c.pop(),u.push(c),c=null,!!D){if(C&1){if(g=k[0],(d=g.length-1)>0){for(l||(r.polygonStart(),l=!0),r.lineStart(),O=0;O<d;++O)r.point((w=g[O])[0],w[1]);r.lineEnd()}return}D>1&&C&2&&k.push(k.pop().concat(k.shift())),h.push(k.filter(Ad))}}return f}}function Ad(e){return e.length>1}function Id(e,t){return((e=e.x)[0]<0?e[1]-ot-Y:ot-e[1])-((t=t.x)[0]<0?t[1]-ot-Y:ot-t[1])}const Bo=ml(function(){return!0},Td,Cd,[-K,-ot]);function Td(e){var t=NaN,n=NaN,i=NaN,r;return{lineStart:function(){e.lineStart(),r=1},point:function(s,o){var a=s>0?K:-K,l=Q(s-t);Q(l-K)<Y?(e.point(t,n=(n+o)/2>0?ot:-ot),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(a,n),e.point(s,n),r=0):i!==a&&l>=K&&(Q(t-i)<Y&&(t-=i*Y),Q(s-a)<Y&&(s-=a*Y),n=Nd(t,n,s,o),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(a,n),r=0),e.point(t=s,n=o),i=a},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-r}}}function Nd(e,t,n,i){var r,s,o=q(e-n);return Q(o)>Y?Ui((q(t)*(s=X(i))*q(n)-q(i)*(r=X(t))*q(e))/(r*s*o)):(t+i)/2}function Cd(e,t,n,i){var r;if(e==null)r=n*ot,i.point(-K,r),i.point(0,r),i.point(K,r),i.point(K,0),i.point(K,-r),i.point(0,-r),i.point(-K,-r),i.point(-K,0),i.point(-K,r);else if(Q(e[0]-t[0])>Y){var s=e[0]<t[0]?K:-K;r=n*s/2,i.point(-s,r),i.point(0,r),i.point(s,r)}else i.point(t[0],t[1])}function Pd(e){var t=X(e),n=2*V,i=t>0,r=Q(t)>Y;function s(h,c,f,v){$d(v,e,n,f,h,c)}function o(h,c){return X(h)*X(c)>t}function a(h){var c,f,v,M,A;return{lineStart:function(){M=v=!1,A=1},point:function(N,I){var E=[N,I],P,C=o(N,I),k=i?C?0:u(N,I):C?u(N+(N<0?K:-K),I):0;if(!c&&(M=v=C)&&h.lineStart(),C!==v&&(P=l(c,E),(!P||Vn(c,P)||Vn(E,P))&&(E[2]=1)),C!==v)A=0,C?(h.lineStart(),P=l(E,c),h.point(P[0],P[1])):(P=l(c,E),h.point(P[0],P[1],2),h.lineEnd()),c=P;else if(r&&c&&i^C){var O;!(k&f)&&(O=l(E,c,!0))&&(A=0,i?(h.lineStart(),h.point(O[0][0],O[0][1]),h.point(O[1][0],O[1][1]),h.lineEnd()):(h.point(O[1][0],O[1][1]),h.lineEnd(),h.lineStart(),h.point(O[0][0],O[0][1],3)))}C&&(!c||!Vn(c,E))&&h.point(E[0],E[1]),c=E,v=C,f=k},lineEnd:function(){v&&h.lineEnd(),c=null},clean:function(){return A|(M&&v)<<1}}}function l(h,c,f){var v=Re(h),M=Re(c),A=[1,0,0],N=fi(v,M),I=Pn(N,N),E=N[0],P=I-E*E;if(!P)return!f&&h;var C=t*I/P,k=-t*E/P,O=fi(A,N),D=kn(A,C),d=kn(N,k);ir(D,d);var g=O,w=Pn(D,g),_=Pn(g,g),b=w*w-_*(Pn(D,D)-1);if(!(b<0)){var $=Xt(b),y=kn(g,(-w-$)/_);if(ir(y,D),y=Ir(y),!f)return y;var p=h[0],m=c[0],x=h[1],S=c[1],T;m<p&&(T=p,p=m,m=T);var R=m-p,L=Q(R-K)<Y,z=L||R<Y;if(!L&&S<x&&(T=x,x=S,S=T),z?L?x+S>0^y[1]<(Q(y[0]-p)<Y?x:S):x<=y[1]&&y[1]<=S:R>K^(p<=y[0]&&y[0]<=m)){var F=kn(g,(-w+$)/_);return ir(F,D),[y,Ir(F)]}}}function u(h,c){var f=i?e:K-e,v=0;return h<-f?v|=1:h>f&&(v|=2),c<-f?v|=4:c>f&&(v|=8),v}return ml(o,a,s,i?[0,-e]:[-K,e-K])}function kd(e,t,n,i,r,s){var o=e[0],a=e[1],l=t[0],u=t[1],h=0,c=1,f=l-o,v=u-a,M;if(M=n-o,!(!f&&M>0)){if(M/=f,f<0){if(M<h)return;M<c&&(c=M)}else if(f>0){if(M>c)return;M>h&&(h=M)}if(M=r-o,!(!f&&M<0)){if(M/=f,f<0){if(M>c)return;M>h&&(h=M)}else if(f>0){if(M<h)return;M<c&&(c=M)}if(M=i-a,!(!v&&M>0)){if(M/=v,v<0){if(M<h)return;M<c&&(c=M)}else if(v>0){if(M>c)return;M>h&&(h=M)}if(M=s-a,!(!v&&M<0)){if(M/=v,v<0){if(M>c)return;M>h&&(h=M)}else if(v>0){if(M<h)return;M<c&&(c=M)}return h>0&&(e[0]=o+h*f,e[1]=a+h*v),c<1&&(t[0]=o+c*f,t[1]=a+c*v),!0}}}}}var Qe=1e9,Rn=-Qe;function Od(e,t,n,i){function r(u,h){return e<=u&&u<=n&&t<=h&&h<=i}function s(u,h,c,f){var v=0,M=0;if(u==null||(v=o(u,c))!==(M=o(h,c))||l(u,h)<0^c>0)do f.point(v===0||v===3?e:n,v>1?i:t);while((v=(v+c+4)%4)!==M);else f.point(h[0],h[1])}function o(u,h){return Q(u[0]-e)<Y?h>0?0:3:Q(u[0]-n)<Y?h>0?2:1:Q(u[1]-t)<Y?h>0?1:0:h>0?3:2}function a(u,h){return l(u.x,h.x)}function l(u,h){var c=o(u,1),f=o(h,1);return c!==f?c-f:c===0?h[1]-u[1]:c===1?u[0]-h[0]:c===2?u[1]-h[1]:h[0]-u[0]}return function(u){var h=u,c=pl(),f,v,M,A,N,I,E,P,C,k,O,D={point:d,lineStart:b,lineEnd:$,polygonStart:w,polygonEnd:_};function d(p,m){r(p,m)&&h.point(p,m)}function g(){for(var p=0,m=0,x=v.length;m<x;++m)for(var S=v[m],T=1,R=S.length,L=S[0],z,F,H=L[0],B=L[1];T<R;++T)z=H,F=B,L=S[T],H=L[0],B=L[1],F<=i?B>i&&(H-z)*(i-F)>(B-F)*(e-z)&&++p:B<=i&&(H-z)*(i-F)<(B-F)*(e-z)&&--p;return p}function w(){h=c,f=[],v=[],O=!0}function _(){var p=g(),m=O&&p,x=(f=Ca(f)).length;(m||x)&&(u.polygonStart(),m&&(u.lineStart(),s(null,null,1,u),u.lineEnd()),x&&gl(f,a,p,s,u),u.polygonEnd()),h=u,f=v=M=null}function b(){D.point=y,v&&v.push(M=[]),k=!0,C=!1,E=P=NaN}function $(){f&&(y(A,N),I&&C&&c.rejoin(),f.push(c.result())),D.point=d,C&&h.lineEnd()}function y(p,m){var x=r(p,m);if(v&&M.push([p,m]),k)A=p,N=m,I=x,k=!1,x&&(h.lineStart(),h.point(p,m));else if(x&&C)h.point(p,m);else{var S=[E=Math.max(Rn,Math.min(Qe,E)),P=Math.max(Rn,Math.min(Qe,P))],T=[p=Math.max(Rn,Math.min(Qe,p)),m=Math.max(Rn,Math.min(Qe,m))];kd(S,T,e,t,n,i)?(C||(h.lineStart(),h.point(S[0],S[1])),h.point(T[0],T[1]),x||h.lineEnd(),O=!1):x&&(h.lineStart(),h.point(p,m),O=!1)}E=p,P=m,C=x}return D}}var Rr,Lr,jn,Wn,Le={sphere:nt,point:nt,lineStart:Rd,lineEnd:nt,polygonStart:nt,polygonEnd:nt};function Rd(){Le.point=Dd,Le.lineEnd=Ld}function Ld(){Le.point=Le.lineEnd=nt}function Dd(e,t){e*=V,t*=V,Lr=e,jn=q(t),Wn=X(t),Le.point=zd}function zd(e,t){e*=V,t*=V;var n=q(t),i=X(t),r=Q(e-Lr),s=X(r),o=q(r),a=i*o,l=Wn*n-jn*i*s,u=jn*n+Wn*i*s;Rr.add(Zt(Xt(a*a+l*l),u)),Lr=e,jn=n,Wn=i}function Bd(e){return Rr=new kt,se(e,Le),+Rr}var Dr=[null,null],Fd={type:"LineString",coordinates:Dr};function xi(e,t){return Dr[0]=e,Dr[1]=t,Bd(Fd)}function Fo(e,t,n){var i=Ee(e,t-Y,n).concat(t);return function(r){return i.map(function(s){return[r,s]})}}function Uo(e,t,n){var i=Ee(e,t-Y,n).concat(t);return function(r){return i.map(function(s){return[s,r]})}}function Ud(){var e,t,n,i,r,s,o,a,l=10,u=l,h=90,c=360,f,v,M,A,N=2.5;function I(){return{type:"MultiLineString",coordinates:E()}}function E(){return Ee(Cn(i/h)*h,n,h).map(M).concat(Ee(Cn(a/c)*c,o,c).map(A)).concat(Ee(Cn(t/l)*l,e,l).filter(function(P){return Q(P%h)>Y}).map(f)).concat(Ee(Cn(s/u)*u,r,u).filter(function(P){return Q(P%c)>Y}).map(v))}return I.lines=function(){return E().map(function(P){return{type:"LineString",coordinates:P}})},I.outline=function(){return{type:"Polygon",coordinates:[M(i).concat(A(o).slice(1),M(n).reverse().slice(1),A(a).reverse().slice(1))]}},I.extent=function(P){return arguments.length?I.extentMajor(P).extentMinor(P):I.extentMinor()},I.extentMajor=function(P){return arguments.length?(i=+P[0][0],n=+P[1][0],a=+P[0][1],o=+P[1][1],i>n&&(P=i,i=n,n=P),a>o&&(P=a,a=o,o=P),I.precision(N)):[[i,a],[n,o]]},I.extentMinor=function(P){return arguments.length?(t=+P[0][0],e=+P[1][0],s=+P[0][1],r=+P[1][1],t>e&&(P=t,t=e,e=P),s>r&&(P=s,s=r,r=P),I.precision(N)):[[t,s],[e,r]]},I.step=function(P){return arguments.length?I.stepMajor(P).stepMinor(P):I.stepMinor()},I.stepMajor=function(P){return arguments.length?(h=+P[0],c=+P[1],I):[h,c]},I.stepMinor=function(P){return arguments.length?(l=+P[0],u=+P[1],I):[l,u]},I.precision=function(P){return arguments.length?(N=+P,f=Fo(s,r,90),v=Uo(t,e,N),M=Fo(a,o,90),A=Uo(i,n,N),I):N},I.extentMajor([[-180,-90+Y],[180,90-Y]]).extentMinor([[-180,-80-Y],[180,80+Y]])}const zr=e=>e;var sr=new kt,Br=new kt,yl,vl,Fr,Ur,Vt={point:nt,lineStart:nt,lineEnd:nt,polygonStart:function(){Vt.lineStart=Hd,Vt.lineEnd=Gd},polygonEnd:function(){Vt.lineStart=Vt.lineEnd=Vt.point=nt,sr.add(Q(Br)),Br=new kt},result:function(){var e=sr/2;return sr=new kt,e}};function Hd(){Vt.point=qd}function qd(e,t){Vt.point=wl,yl=Fr=e,vl=Ur=t}function wl(e,t){Br.add(Ur*e-Fr*t),Fr=e,Ur=t}function Gd(){wl(yl,vl)}var De=1/0,bi=De,pn=-De,Mi=pn,Si={point:Xd,lineStart:nt,lineEnd:nt,polygonStart:nt,polygonEnd:nt,result:function(){var e=[[De,bi],[pn,Mi]];return pn=Mi=-(bi=De=1/0),e}};function Xd(e,t){e<De&&(De=e),e>pn&&(pn=e),t<bi&&(bi=t),t>Mi&&(Mi=t)}var Hr=0,qr=0,Ze=0,$i=0,Ei=0,Ie=0,Gr=0,Xr=0,Je=0,_l,xl,zt,Bt,$t={point:_e,lineStart:Ho,lineEnd:qo,polygonStart:function(){$t.lineStart=Vd,$t.lineEnd=jd},polygonEnd:function(){$t.point=_e,$t.lineStart=Ho,$t.lineEnd=qo},result:function(){var e=Je?[Gr/Je,Xr/Je]:Ie?[$i/Ie,Ei/Ie]:Ze?[Hr/Ze,qr/Ze]:[NaN,NaN];return Hr=qr=Ze=$i=Ei=Ie=Gr=Xr=Je=0,e}};function _e(e,t){Hr+=e,qr+=t,++Ze}function Ho(){$t.point=Yd}function Yd(e,t){$t.point=Kd,_e(zt=e,Bt=t)}function Kd(e,t){var n=e-zt,i=t-Bt,r=Xt(n*n+i*i);$i+=r*(zt+e)/2,Ei+=r*(Bt+t)/2,Ie+=r,_e(zt=e,Bt=t)}function qo(){$t.point=_e}function Vd(){$t.point=Wd}function jd(){bl(_l,xl)}function Wd(e,t){$t.point=bl,_e(_l=zt=e,xl=Bt=t)}function bl(e,t){var n=e-zt,i=t-Bt,r=Xt(n*n+i*i);$i+=r*(zt+e)/2,Ei+=r*(Bt+t)/2,Ie+=r,r=Bt*e-zt*t,Gr+=r*(zt+e),Xr+=r*(Bt+t),Je+=r*3,_e(zt=e,Bt=t)}function Ml(e){this._context=e}Ml.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,wt);break}}},result:nt};var Yr=new kt,or,Sl,$l,tn,en,gn={point:nt,lineStart:function(){gn.point=Qd},lineEnd:function(){or&&El(Sl,$l),gn.point=nt},polygonStart:function(){or=!0},polygonEnd:function(){or=null},result:function(){var e=+Yr;return Yr=new kt,e}};function Qd(e,t){gn.point=El,Sl=tn=e,$l=en=t}function El(e,t){tn-=e,en-=t,Yr.add(Xt(tn*tn+en*en)),tn=e,en=t}let Go,Ai,Xo,Yo;class Ko{constructor(t){this._append=t==null?Al:Zd(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,n){switch(this._point){case 0:{this._append`M${t},${n}`,this._point=1;break}case 1:{this._append`L${t},${n}`;break}default:{if(this._append`M${t},${n}`,this._radius!==Xo||this._append!==Ai){const i=this._radius,r=this._;this._="",this._append`m0,${i}a${i},${i} 0 1,1 0,${-2*i}a${i},${i} 0 1,1 0,${2*i}z`,Xo=i,Ai=this._append,Yo=this._,this._=r}this._+=Yo;break}}}result(){const t=this._;return this._="",t.length?t:null}}function Al(e){let t=1;this._+=e[0];for(const n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function Zd(e){const t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return Al;if(t!==Go){const n=10**t;Go=t,Ai=function(r){let s=1;this._+=r[0];for(const o=r.length;s<o;++s)this._+=Math.round(arguments[s]*n)/n+r[s]}}return Ai}function Ss(e,t){let n=3,i=4.5,r,s;function o(a){return a&&(typeof i=="function"&&s.pointRadius(+i.apply(this,arguments)),se(a,r(s))),s.result()}return o.area=function(a){return se(a,r(Vt)),Vt.result()},o.measure=function(a){return se(a,r(gn)),gn.result()},o.bounds=function(a){return se(a,r(Si)),Si.result()},o.centroid=function(a){return se(a,r($t)),$t.result()},o.projection=function(a){return arguments.length?(r=a==null?(e=null,zr):(e=a).stream,o):e},o.context=function(a){return arguments.length?(s=a==null?(t=null,new Ko(n)):new Ml(t=a),typeof i!="function"&&s.pointRadius(i),o):t},o.pointRadius=function(a){return arguments.length?(i=typeof a=="function"?a:(s.pointRadius(+a),+a),o):i},o.digits=function(a){if(!arguments.length)return n;if(a==null)n=null;else{const l=Math.floor(a);if(!(l>=0))throw new RangeError(`invalid digits: ${a}`);n=l}return t===null&&(s=new Ko(n)),o},o.projection(e).digits(n).context(t)}function $s(e){return function(t){var n=new Kr;for(var i in e)n[i]=e[i];return n.stream=t,n}}function Kr(){}Kr.prototype={constructor:Kr,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Es(e,t,n){var i=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),i!=null&&e.clipExtent(null),se(n,e.stream(Si)),t(Si.result()),i!=null&&e.clipExtent(i),e}function Il(e,t,n){return Es(e,function(i){var r=t[1][0]-t[0][0],s=t[1][1]-t[0][1],o=Math.min(r/(i[1][0]-i[0][0]),s/(i[1][1]-i[0][1])),a=+t[0][0]+(r-o*(i[1][0]+i[0][0]))/2,l=+t[0][1]+(s-o*(i[1][1]+i[0][1]))/2;e.scale(150*o).translate([a,l])},n)}function Jd(e,t,n){return Il(e,[[0,0],t],n)}function tp(e,t,n){return Es(e,function(i){var r=+t,s=r/(i[1][0]-i[0][0]),o=(r-s*(i[1][0]+i[0][0]))/2,a=-s*i[0][1];e.scale(150*s).translate([o,a])},n)}function ep(e,t,n){return Es(e,function(i){var r=+t,s=r/(i[1][1]-i[0][1]),o=-s*i[0][0],a=(r-s*(i[1][1]+i[0][1]))/2;e.scale(150*s).translate([o,a])},n)}var Vo=16,np=X(30*V);function jo(e,t){return+t?rp(e,t):ip(e)}function ip(e){return $s({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function rp(e,t){function n(i,r,s,o,a,l,u,h,c,f,v,M,A,N){var I=u-i,E=h-r,P=I*I+E*E;if(P>4*t&&A--){var C=o+f,k=a+v,O=l+M,D=Xt(C*C+k*k+O*O),d=Jt(O/=D),g=Q(Q(O)-1)<Y||Q(s-c)<Y?(s+c)/2:Zt(k,C),w=e(g,d),_=w[0],b=w[1],$=_-i,y=b-r,p=E*$-I*y;(p*p/P>t||Q((I*$+E*y)/P-.5)>.3||o*f+a*v+l*M<np)&&(n(i,r,s,o,a,l,_,b,g,C/=D,k/=D,O,A,N),N.point(_,b),n(_,b,g,C,k,O,u,h,c,f,v,M,A,N))}}return function(i){var r,s,o,a,l,u,h,c,f,v,M,A,N={point:I,lineStart:E,lineEnd:C,polygonStart:function(){i.polygonStart(),N.lineStart=k},polygonEnd:function(){i.polygonEnd(),N.lineStart=E}};function I(d,g){d=e(d,g),i.point(d[0],d[1])}function E(){c=NaN,N.point=P,i.lineStart()}function P(d,g){var w=Re([d,g]),_=e(d,g);n(c,f,h,v,M,A,c=_[0],f=_[1],h=d,v=w[0],M=w[1],A=w[2],Vo,i),i.point(c,f)}function C(){N.point=I,i.lineEnd()}function k(){E(),N.point=O,N.lineEnd=D}function O(d,g){P(r=d,g),s=c,o=f,a=v,l=M,u=A,N.point=P}function D(){n(c,f,h,v,M,A,s,o,r,a,l,u,Vo,i),N.lineEnd=C,C()}return N}}var sp=$s({point:function(e,t){this.stream.point(e*V,t*V)}});function op(e){return $s({point:function(t,n){var i=e(t,n);return this.stream.point(i[0],i[1])}})}function ap(e,t,n,i,r){function s(o,a){return o*=i,a*=r,[t+e*o,n-e*a]}return s.invert=function(o,a){return[(o-t)/e*i,(n-a)/e*r]},s}function Wo(e,t,n,i,r,s){if(!s)return ap(e,t,n,i,r);var o=X(s),a=q(s),l=o*e,u=a*e,h=o/e,c=a/e,f=(a*n-o*t)/e,v=(a*t+o*n)/e;function M(A,N){return A*=i,N*=r,[l*A-u*N+t,n-u*A-l*N]}return M.invert=function(A,N){return[i*(h*A-c*N+f),r*(v-c*A-h*N)]},M}function As(e){return lp(function(){return e})()}function lp(e){var t,n=150,i=480,r=250,s=0,o=0,a=0,l=0,u=0,h,c=0,f=1,v=1,M=null,A=Bo,N=null,I,E,P,C=zr,k=.5,O,D,d,g,w;function _(p){return d(p[0]*V,p[1]*V)}function b(p){return p=d.invert(p[0],p[1]),p&&[p[0]*ut,p[1]*ut]}_.stream=function(p){return g&&w===p?g:g=sp(op(h)(A(O(C(w=p)))))},_.preclip=function(p){return arguments.length?(A=p,M=void 0,y()):A},_.postclip=function(p){return arguments.length?(C=p,N=I=E=P=null,y()):C},_.clipAngle=function(p){return arguments.length?(A=+p?Pd(M=p*V):(M=null,Bo),y()):M*ut},_.clipExtent=function(p){return arguments.length?(C=p==null?(N=I=E=P=null,zr):Od(N=+p[0][0],I=+p[0][1],E=+p[1][0],P=+p[1][1]),y()):N==null?null:[[N,I],[E,P]]},_.scale=function(p){return arguments.length?(n=+p,$()):n},_.translate=function(p){return arguments.length?(i=+p[0],r=+p[1],$()):[i,r]},_.center=function(p){return arguments.length?(s=p[0]%360*V,o=p[1]%360*V,$()):[s*ut,o*ut]},_.rotate=function(p){return arguments.length?(a=p[0]%360*V,l=p[1]%360*V,u=p.length>2?p[2]%360*V:0,$()):[a*ut,l*ut,u*ut]},_.angle=function(p){return arguments.length?(c=p%360*V,$()):c*ut},_.reflectX=function(p){return arguments.length?(f=p?-1:1,$()):f<0},_.reflectY=function(p){return arguments.length?(v=p?-1:1,$()):v<0},_.precision=function(p){return arguments.length?(O=jo(D,k=p*p),y()):Xt(k)},_.fitExtent=function(p,m){return Il(_,p,m)},_.fitSize=function(p,m){return Jd(_,p,m)},_.fitWidth=function(p,m){return tp(_,p,m)},_.fitHeight=function(p,m){return ep(_,p,m)};function $(){var p=Wo(n,0,0,f,v,c).apply(null,t(s,o)),m=Wo(n,i-p[0],r-p[1],f,v,c);return h=dl(a,l,u),D=kr(t,m),d=kr(h,D),O=jo(D,k),y()}function y(){return g=w=null,_}return function(){return t=e.apply(this,arguments),_.invert=t.invert&&b,$()}}function Tl(e){return function(t,n){var i=Xt(t*t+n*n),r=e(i),s=q(r),o=X(r);return[Zt(t*s,i*o),Jt(i&&n*s/i)]}}function Is(e,t){return[e,ll(ul((ot+t)/2))]}Is.invert=function(e,t){return[e,2*Ui(al(t))-ot]};function up(){return Nl(Is).scale(961/wt)}function Nl(e){var t=As(e),n=t.center,i=t.scale,r=t.translate,s=t.clipExtent,o=null,a,l,u;t.scale=function(c){return arguments.length?(i(c),h()):i()},t.translate=function(c){return arguments.length?(r(c),h()):r()},t.center=function(c){return arguments.length?(n(c),h()):n()},t.clipExtent=function(c){return arguments.length?(c==null?o=a=l=u=null:(o=+c[0][0],a=+c[0][1],l=+c[1][0],u=+c[1][1]),h()):o==null?null:[[o,a],[l,u]]};function h(){var c=K*i(),f=t(_i(t.rotate()).invert([0,0]));return s(o==null?[[f[0]-c,f[1]-c],[f[0]+c,f[1]+c]]:e===Is?[[Math.max(f[0]-c,o),a],[Math.min(f[0]+c,l),u]]:[[o,Math.max(f[1]-c,a)],[l,Math.min(f[1]+c,u)]])}return h()}function Cl(e,t){return[X(t)*q(e),q(t)]}Cl.invert=Tl(Jt);function cp(){return As(Cl).scale(249.5).clipAngle(90+Y)}function Pl(e,t){var n=X(t),i=1+X(e)*n;return[n*q(e)/i,q(t)/i]}Pl.invert=Tl(function(e){return 2*Ui(e)});function kl(){return As(Pl).scale(250).clipAngle(142)}function Ol(e,t){return[ll(ul((ot+t)/2)),-e]}Ol.invert=function(e,t){return[-t,2*Ui(al(e))-ot]};function hp(){var e=Nl(Ol),t=e.center,n=e.rotate;return e.center=function(i){return arguments.length?t([-i[1],i[0]]):(i=t(),[i[1],-i[0]])},e.rotate=function(i){return arguments.length?n([i[0],i[1],i.length>2?i[2]+90:90]):(i=n(),[i[0],i[1],i[2]-90])},n([0,0,90]).scale(159.155)}const Ln=e=>()=>e;function fp(e,{sourceEvent:t,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function jt(e,t,n){this.k=e,this.x=t,this.y=n}jt.prototype={constructor:jt,scale:function(e){return e===1?this:new jt(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new jt(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Rl=new jt(1,0,0);jt.prototype;function ar(e){e.stopImmediatePropagation()}function Ye(e){e.preventDefault(),e.stopImmediatePropagation()}function dp(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function pp(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function Qo(){return this.__zoom||Rl}function gp(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function mp(){return navigator.maxTouchPoints||"ontouchstart"in this}function yp(e,t,n){var i=e.invertX(t[0][0])-n[0][0],r=e.invertX(t[1][0])-n[1][0],s=e.invertY(t[0][1])-n[0][1],o=e.invertY(t[1][1])-n[1][1];return e.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function vp(){var e=dp,t=pp,n=yp,i=gp,r=mp,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,l=Cf,u=Di("start","zoom","end"),h,c,f,v=500,M=150,A=0,N=10;function I(y){y.property("__zoom",Qo).on("wheel.zoom",d,{passive:!1}).on("mousedown.zoom",g).on("dblclick.zoom",w).filter(r).on("touchstart.zoom",_).on("touchmove.zoom",b).on("touchend.zoom touchcancel.zoom",$).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}I.transform=function(y,p,m,x){var S=y.selection?y.selection():y;S.property("__zoom",Qo),y!==S?k(y,p,m,x):S.interrupt().each(function(){O(this,arguments).event(x).start().zoom(null,typeof p=="function"?p.apply(this,arguments):p).end()})},I.scaleBy=function(y,p,m,x){I.scaleTo(y,function(){var S=this.__zoom.k,T=typeof p=="function"?p.apply(this,arguments):p;return S*T},m,x)},I.scaleTo=function(y,p,m,x){I.transform(y,function(){var S=t.apply(this,arguments),T=this.__zoom,R=m==null?C(S):typeof m=="function"?m.apply(this,arguments):m,L=T.invert(R),z=typeof p=="function"?p.apply(this,arguments):p;return n(P(E(T,z),R,L),S,o)},m,x)},I.translateBy=function(y,p,m,x){I.transform(y,function(){return n(this.__zoom.translate(typeof p=="function"?p.apply(this,arguments):p,typeof m=="function"?m.apply(this,arguments):m),t.apply(this,arguments),o)},null,x)},I.translateTo=function(y,p,m,x,S){I.transform(y,function(){var T=t.apply(this,arguments),R=this.__zoom,L=x==null?C(T):typeof x=="function"?x.apply(this,arguments):x;return n(Rl.translate(L[0],L[1]).scale(R.k).translate(typeof p=="function"?-p.apply(this,arguments):-p,typeof m=="function"?-m.apply(this,arguments):-m),T,o)},x,S)};function E(y,p){return p=Math.max(s[0],Math.min(s[1],p)),p===y.k?y:new jt(p,y.x,y.y)}function P(y,p,m){var x=p[0]-m[0]*y.k,S=p[1]-m[1]*y.k;return x===y.x&&S===y.y?y:new jt(y.k,x,S)}function C(y){return[(+y[0][0]+ +y[1][0])/2,(+y[0][1]+ +y[1][1])/2]}function k(y,p,m,x){y.on("start.zoom",function(){O(this,arguments).event(x).start()}).on("interrupt.zoom end.zoom",function(){O(this,arguments).event(x).end()}).tween("zoom",function(){var S=this,T=arguments,R=O(S,T).event(x),L=t.apply(S,T),z=m==null?C(L):typeof m=="function"?m.apply(S,T):m,F=Math.max(L[1][0]-L[0][0],L[1][1]-L[0][1]),H=S.__zoom,B=typeof p=="function"?p.apply(S,T):p,G=l(H.invert(z).concat(F/H.k),B.invert(z).concat(F/B.k));return function(W){if(W===1)W=B;else{var dt=G(W),ae=F/dt[2];W=new jt(ae,z[0]-dt[0]*ae,z[1]-dt[1]*ae)}R.zoom(null,W)}})}function O(y,p,m){return!m&&y.__zooming||new D(y,p)}function D(y,p){this.that=y,this.args=p,this.active=0,this.sourceEvent=null,this.extent=t.apply(y,p),this.taps=0}D.prototype={event:function(y){return y&&(this.sourceEvent=y),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(y,p){return this.mouse&&y!=="mouse"&&(this.mouse[1]=p.invert(this.mouse[0])),this.touch0&&y!=="touch"&&(this.touch0[1]=p.invert(this.touch0[0])),this.touch1&&y!=="touch"&&(this.touch1[1]=p.invert(this.touch1[0])),this.that.__zoom=p,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(y){var p=Nt(this.that).datum();u.call(y,this.that,new fp(y,{sourceEvent:this.sourceEvent,target:I,transform:this.that.__zoom,dispatch:u}),p)}};function d(y,...p){if(!e.apply(this,arguments))return;var m=O(this,p).event(y),x=this.__zoom,S=Math.max(s[0],Math.min(s[1],x.k*Math.pow(2,i.apply(this,arguments)))),T=Dt(y);if(m.wheel)(m.mouse[0][0]!==T[0]||m.mouse[0][1]!==T[1])&&(m.mouse[1]=x.invert(m.mouse[0]=T)),clearTimeout(m.wheel);else{if(x.k===S)return;m.mouse=[T,x.invert(T)],Kn(this),m.start()}Ye(y),m.wheel=setTimeout(R,M),m.zoom("mouse",n(P(E(x,S),m.mouse[0],m.mouse[1]),m.extent,o));function R(){m.wheel=null,m.end()}}function g(y,...p){if(f||!e.apply(this,arguments))return;var m=y.currentTarget,x=O(this,p,!0).event(y),S=Nt(y.view).on("mousemove.zoom",z,!0).on("mouseup.zoom",F,!0),T=Dt(y,m),R=y.clientX,L=y.clientY;Xa(y.view),ar(y),x.mouse=[T,this.__zoom.invert(T)],Kn(this),x.start();function z(H){if(Ye(H),!x.moved){var B=H.clientX-R,G=H.clientY-L;x.moved=B*B+G*G>A}x.event(H).zoom("mouse",n(P(x.that.__zoom,x.mouse[0]=Dt(H,m),x.mouse[1]),x.extent,o))}function F(H){S.on("mousemove.zoom mouseup.zoom",null),Ya(H.view,x.moved),Ye(H),x.event(H).end()}}function w(y,...p){if(e.apply(this,arguments)){var m=this.__zoom,x=Dt(y.changedTouches?y.changedTouches[0]:y,this),S=m.invert(x),T=m.k*(y.shiftKey?.5:2),R=n(P(E(m,T),x,S),t.apply(this,p),o);Ye(y),a>0?Nt(this).transition().duration(a).call(k,R,x,y):Nt(this).call(I.transform,R,x,y)}}function _(y,...p){if(e.apply(this,arguments)){var m=y.touches,x=m.length,S=O(this,p,y.changedTouches.length===x).event(y),T,R,L,z;for(ar(y),R=0;R<x;++R)L=m[R],z=Dt(L,this),z=[z,this.__zoom.invert(z),L.identifier],S.touch0?!S.touch1&&S.touch0[2]!==z[2]&&(S.touch1=z,S.taps=0):(S.touch0=z,T=!0,S.taps=1+!!h);h&&(h=clearTimeout(h)),T&&(S.taps<2&&(c=z[0],h=setTimeout(function(){h=null},v)),Kn(this),S.start())}}function b(y,...p){if(this.__zooming){var m=O(this,p).event(y),x=y.changedTouches,S=x.length,T,R,L,z;for(Ye(y),T=0;T<S;++T)R=x[T],L=Dt(R,this),m.touch0&&m.touch0[2]===R.identifier?m.touch0[0]=L:m.touch1&&m.touch1[2]===R.identifier&&(m.touch1[0]=L);if(R=m.that.__zoom,m.touch1){var F=m.touch0[0],H=m.touch0[1],B=m.touch1[0],G=m.touch1[1],W=(W=B[0]-F[0])*W+(W=B[1]-F[1])*W,dt=(dt=G[0]-H[0])*dt+(dt=G[1]-H[1])*dt;R=E(R,Math.sqrt(W/dt)),L=[(F[0]+B[0])/2,(F[1]+B[1])/2],z=[(H[0]+G[0])/2,(H[1]+G[1])/2]}else if(m.touch0)L=m.touch0[0],z=m.touch0[1];else return;m.zoom("touch",n(P(R,L,z),m.extent,o))}}function $(y,...p){if(this.__zooming){var m=O(this,p).event(y),x=y.changedTouches,S=x.length,T,R;for(ar(y),f&&clearTimeout(f),f=setTimeout(function(){f=null},v),T=0;T<S;++T)R=x[T],m.touch0&&m.touch0[2]===R.identifier?delete m.touch0:m.touch1&&m.touch1[2]===R.identifier&&delete m.touch1;if(m.touch1&&!m.touch0&&(m.touch0=m.touch1,delete m.touch1),m.touch0)m.touch0[1]=this.__zoom.invert(m.touch0[0]);else if(m.end(),m.taps===2&&(R=Dt(R,this),Math.hypot(c[0]-R[0],c[1]-R[1])<N)){var L=Nt(this).on("dblclick.zoom");L&&L.apply(this,arguments)}}}return I.wheelDelta=function(y){return arguments.length?(i=typeof y=="function"?y:Ln(+y),I):i},I.filter=function(y){return arguments.length?(e=typeof y=="function"?y:Ln(!!y),I):e},I.touchable=function(y){return arguments.length?(r=typeof y=="function"?y:Ln(!!y),I):r},I.extent=function(y){return arguments.length?(t=typeof y=="function"?y:Ln([[+y[0][0],+y[0][1]],[+y[1][0],+y[1][1]]]),I):t},I.scaleExtent=function(y){return arguments.length?(s[0]=+y[0],s[1]=+y[1],I):[s[0],s[1]]},I.translateExtent=function(y){return arguments.length?(o[0][0]=+y[0][0],o[1][0]=+y[1][0],o[0][1]=+y[0][1],o[1][1]=+y[1][1],I):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},I.constrain=function(y){return arguments.length?(n=y,I):n},I.duration=function(y){return arguments.length?(a=+y,I):a},I.interpolate=function(y){return arguments.length?(l=y,I):l},I.on=function(){var y=u.on.apply(u,arguments);return y===u?I:y},I.clickDistance=function(y){return arguments.length?(A=(y=+y)*y,I):Math.sqrt(A)},I.tapDistance=function(y){return arguments.length?(N=+y,I):N},I}function Hi(){return{systemMap:new Map,laneMap:new Map,neighborMap:new Map}}function Ll(e,t){e.systemMap.set(t.id,t)}function Vr(e,t,n){const i=[t.id,n.id].sort((s,o)=>s.localeCompare(o)).join("-");if(e.laneMap.has(i))return;const r={id:i,fromId:t.id,toId:n.id,movement:[0,0]};e.laneMap.set(i,r)}function qi(e){const t=new Map;for(const n of e.laneMap.values())t.has(n.fromId)||t.set(n.fromId,[]),t.get(n.fromId)?.push(n.toId),t.has(n.toId)||t.set(n.toId,[]),t.get(n.toId)?.push(n.fromId);e.neighborMap=t}function mt(e,t){const n=e.systemMap.get(t);if(!n)return[];(!e.neighborMap||e.neighborMap.size===0)&&qi(e);const i=e.neighborMap.get(n.id);return i?i.map(r=>e.systemMap.get(r)).filter(r=>!!r):[]}function Gi(e,t,n){return e.neighborMap.get(t)?.includes(n)||!1}function Dl(e,t){return Ts(t,Array.from(e.systemMap.values()))}function Ts(e,t){if(t.length===0)return null;let n=null,i=1/0;return t.forEach(r=>{if(r.location[0]===e[0]&&r.location[1]===e[1])return;const s=xi(e,r.location);s<i&&(i=s,n=r)}),n}function wp(e){console.log("Loading world from JSON...",e);const t=Hi();return t.systemMap=new Map(e.systems),t.laneMap=new Map(e.lanes),qi(t),t}function _p(e){return{systems:Array.from(e.systemMap.entries()),lanes:Array.from(e.laneMap.entries())}}function zl(){return{playerName:"",numBots:cc,fow:lc,numSystems:uc,timeScale:1}}function Ns(){return{world:Hi(),playerMap:new Map}}function Bl(e,t){e.playerMap.set(t.id,t)}function Cs(e){const{C:t}=globalThis.gameManager.getFnContext();if(!t.playerId)return null;for(const n of e.world.systemMap.values())if(n.homeworld===t.playerId)return n;return null}function Xi(e,t){const{P:n}=globalThis.gameManager.getFnContext();if(!n)return;n.revealedSystems.add(t.id),n.visitedSystems.add(t.id);const i=mt(e.world,t.id);if(i)return i.forEach(r=>n.revealedSystems.add(r.id)),e}function Fl(e){const{P:t}=globalThis.gameManager.getFnContext();if(t)for(const n of e.world.systemMap.values())t.revealedSystems.add(n.id)}function Ul(e,t,n,i,r){e.moveQueue.push({ships:n,toId:t.id,fromId:e.id,playerId:i,message:r})}function Hl(e,t,n,i){if(i!==0){if(i<0){if(t.ownerId!==n.ownerId)return;const r=t;t=n,n=r,i=-i}t.ships<i||(n.ownerId===t.ownerId?Mp(e,t,n,i):xp(e,t,n,i))}}function xp(e,t,n,i){const r=t.ownerId,s=n.ships??0;if(Gl(e.S.world,t,n,i),i>s){const o=i-s;t.ships=t.ships-i,n.ships=o,bp(e,r,n)}else t.ships=t.ships-i,n.ships=s-i}function bp(e,t,n){n.ownerId=t,n.moveQueue=[],t===e.C.playerId&&Xi(e.S,n),n.homeworld&&n.homeworld!==t&&ql(e,n.homeworld,t)}function ql({S:e,E:t,C:n},i,r=null){for(const o of e.world.systemMap.values())o.ownerId===i&&(o.ownerId=r,o.ships=Math.max(Math.floor((o.ships??0)/2),1),o.homeworld=null,o.moveQueue=[],r===n.playerId&&Xi(e,o)),o.homeworld===i&&(o.homeworld=null);const s=e.playerMap.get(i);s.isAlive=!1,t.emit("PLAYER_ELIMINATED",{loserId:i,winnerId:r})}function Gl(e,t,n,i){t.movement=[t.movement[0],t.movement[1]+i],n.movement=[n.movement[0]+i,n.movement[1]];for(const r of e.laneMap.values())r.fromId===t.id&&r.toId===n.id?r.movement=[r.movement[0]+i,r.movement[1]]:r.fromId===n.id&&r.toId===t.id&&(r.movement=[r.movement[0],r.movement[1]+i])}function Mp({S:e,C:t},n,i,r){n.ships<r||(n.ships-=r,i.ships+=r,Gl(e.world,n,i,r),i.ownerId===t.playerId&&Xi(e,i))}function Xl(e){for(const t of e.S.world.systemMap.values())for(t.lastMove=null;t.moveQueue.length>0;){const n=t.moveQueue.shift();n&&Yl(e,n)}}function Yl(e,t){t.playerId===e.C.playerId&&Pe(`player move: ${JSON.stringify(t)}`);const n=e.S.world.systemMap.get(t.fromId),i=e.S.world.systemMap.get(t.toId);Hl(e,n,i,t.ships),n.lastMove=t,e.E.emit("MAKE_MOVE",t)}function Sp(e,t){const n=Kl(e.S,t);n&&Yl(e,n)}function $p(e,t){const n=e.world.systemMap.get(t.fromId);return!(n.ownerId!==t.playerId||!Gi(e.world,t.fromId,t.toId)||n.ships<=1)}function Kl(e,t){if(!$p(e,t))return null;switch(t.type){case"MASS_MOVE":return n(t.fromId,t.toId);case"BALANCED_MOVE":return i(t.fromId,t.toId)}return null;function n(r,s){const{C:o}=globalThis.gameManager.getFnContext(),l=e.world.systemMap.get(r).ships-1;return l<=0?null:{message:`Move ${l} ships from ${r} to ${s}`,ships:l,toId:s,fromId:r,playerId:o.playerId}}function i(r,s){const{C:o}=globalThis.gameManager.getFnContext(),a=e.world.systemMap.get(r),l=e.world.systemMap.get(s),u=l.ownerId===a.ownerId?Math.floor((a.ships-l.ships)/2):Math.floor(a.ships/2);return u<=0?null:{message:`Move ${u} ships from ${a.id} to ${l.id}`,ships:u,toId:l.id,fromId:a.id,playerId:o.playerId}}}const Dn=100,lr={territory:{aggression:.3,expansion:1,defensiveness:.5,riskTolerance:.4,speed:Dn},rusher:{aggression:1,expansion:.4,defensiveness:.1,riskTolerance:.7,speed:Dn},turtle:{aggression:.1,expansion:.3,defensiveness:.95,riskTolerance:.2,speed:Dn},balanced:{aggression:.5,expansion:.5,defensiveness:.5,riskTolerance:.5,speed:Dn}};function Ep({S:e}){for(const t of e.playerMap.values())t.bot?.makeMoves()}let Ap=0;class Ip{constructor(t={}){this.queuedMoves=0,this.threatLevels=new Map,this.frontline=new Set,this.backline=new Set;const n=t.playerIndex??Ap++;this.id=t.id??`${n}`;let i=t.personality;if(!i){const r=Object.keys(lr);i=r[n%r.length]}this.name=t.name??i,this.personality=i==="idle"?lr.balanced:lr[i]}makeMoves(){if(this.name==="idle")return;const n=gameManager.getState().world.systemMap.values();if(this.botSystems=Array.from(n).filter(l=>l.ownerId===this.id),this.botSystems.length===0)return;for(const l of this.botSystems)l.moveQueue=[];this.queuedMoves=0,this.analyzeMap();const i=this.getDefensiveMoves();if(this.chooseMoves(i,1-this.personality.defensiveness),this.queuedMoves>=this.personality.speed)return;const r=this.getCoordinatedAttackMoves();if(this.chooseMoves(r,this.personality.aggression),this.queuedMoves>=this.personality.speed)return;const s=this.getExterminateMoves();if(this.chooseMoves(s,this.personality.defensiveness),this.queuedMoves>=this.personality.speed)return;const o=this.getExploreMoves();if(this.chooseMoves(o,this.personality.expansion),this.queuedMoves>=this.personality.speed)return;const a=this.getLogisticsMoves();this.chooseMoves(a,1),this.queuedMoves>=this.personality.speed}analyzeMap(){this.threatLevels.clear(),this.frontline.clear(),this.backline.clear();const t=gameManager.getState();this.botSystems.forEach(n=>{const i=mt(t.world,n.id),r=i.filter(a=>a.ownerId&&a.ownerId!==this.id),s=i.filter(a=>!a.ownerId),o=r.reduce((a,l)=>a+l.ships,0);this.threatLevels.set(n.id,o),r.length>0||s.length>0?this.frontline.add(n.id):this.backline.add(n.id)})}getDefensiveMoves(){const t=gameManager.getState();return this.botSystems.map(n=>{if(n.moveQueue.length>0)return[];const i=[],r=this.threatLevels.get(n.id)??0;if(r>0){const s=r*1.1;if(n.ships<s)if(n.ships<r*.5){const o=mt(t.world,n.id).filter(a=>a.ownerId===this.id).sort((a,l)=>(this.threatLevels.get(a.id)||0)-(this.threatLevels.get(l.id)||0))[0];o&&i.push({message:`Retreating from ${n.id}`,from:n,to:o,units:n.ships-1,score:1e3})}else i.push({message:`Holding ${n.id}`,from:n,to:n,units:0,score:r});else n.ships<s*1.5&&i.push({message:`Defending ${n.id} from threat level ${r}`,from:n,to:n,units:0,score:r})}return i})}getCoordinatedAttackMoves(){const t=gameManager.getState(),n=new Map;this.botSystems.forEach(r=>{if(r.moveQueue.length>0||r.ships<5)return;const s=mt(t.world,r.id);s&&s.forEach(o=>{if(o.ownerId!==null&&o.ownerId!==this.id){if(mt(t.world,r.id).filter(l=>l.ownerId&&l.ownerId!==this.id&&l.id!==o.id).length>0)return;n.has(o.id)||n.set(o.id,{target:o,attackers:[]}),n.get(o.id).attackers.push(r)}})});const i=[];return n.forEach(({target:r,attackers:s})=>{const a=mt(t.world,r.id).filter(c=>c.ownerId===r.ownerId).length===0?1.5:1,l=s.reduce((c,f)=>{const v=this.threatLevels.get(f.id)||0,M=Math.max(0,f.ships-v*1.1);return c+Math.floor(M*(1-this.personality.defensiveness))},0),h=(r.ships+(r.homeworld?10:0))*(1.3-this.personality.riskTolerance);l>h&&s.forEach(c=>{if(c.moveQueue.length>0)return;const f=this.threatLevels.get(c.id)||0,v=Math.max(0,c.ships-f*1.1),M=Math.floor(v*(1-this.personality.defensiveness)),A=this.getBestMoveAmount(c,r,M);A>0&&i.push([{message:`Coordinated attack on ${r.id}`,from:c,to:r,units:A,score:(100+(r.homeworld?50:0))*a}])})}),i}getExterminateMoves(){const t=gameManager.getState();return this.botSystems.map(n=>n.moveQueue.length>0?[]:n.ships<3?[]:mt(t.world,n.id).flatMap(r=>{if(r.ownerId===this.id)return[];if(r.ownerId===null&&r.type==="UNINHABITED")return[];if(n.ships>r.ships*1.5+5){const s=n.ships-2;return[{message:`Crushing weak neighbor ${r.id}`,from:n,to:r,units:s,score:40}]}return[]}))}getExploreMoves(){const t=gameManager.getState();return this.botSystems.map(n=>n.moveQueue.length>0?[]:n.ships<2?[]:mt(t.world,n.id).flatMap(r=>{if(r.ownerId!==null)return[];if(r.type==="INHABITED")return[];const s=Math.max(1,Math.floor(n.ships*.3));return[{message:`Exploring ${r.id}`,from:n,to:r,units:s,score:30}]}))}getLogisticsMoves(){const t=gameManager.getState();return this.botSystems.map(n=>{if(n.moveQueue.length>0)return[];if(n.ships<2)return[];if(this.backline.has(n.id)){const i=mt(t.world,n.id).filter(o=>this.frontline.has(o.id)&&o.ownerId===this.id);if(i.length>0){const o=i.sort((a,l)=>a.ships-l.ships)[0];return[{message:"Logistics: Frontline Support",from:n,to:o,units:n.ships-1,score:10}]}const s=mt(t.world,n.id).filter(o=>o.ownerId===this.id).sort((o,a)=>o.ships-a.ships)[0];if(s&&s.ships<n.ships-2)return[{message:"Logistics: Balancing",from:n,to:s,units:Math.floor((n.ships-s.ships)/2),score:5}]}if(this.frontline.has(n.id)){const i=mt(t.world,n.id).filter(r=>r.ownerId===this.id&&(this.threatLevels.get(r.id)||0)>r.ships);if(i.length>0&&(this.threatLevels.get(n.id)||0)<n.ships){const r=i[0];return[{message:"Logistics: Emergency Reinforce",from:n,to:r,units:Math.floor(n.ships/2),score:50}]}}return[]})}getBestMoveAmount(t,n,i){const r=Math.max(0,t.ships-1);let s=0;return n.ownerId===t.ownerId?s=Math.floor((t.ships-n.ships)/2):s=Math.floor(t.ships/2),s=Math.max(0,s),Math.abs(r-i)<Math.abs(s-i)?r:s}chooseMoves(t,n=1){if(t.length===0)return;const i=t.flat().sort(Tp);for(const r of i){if(this.queuedMoves>=this.personality.speed)return;if(Math.random()<n){if(r.from.moveQueue.length>0)continue;Ul(r.from,r.to,r.units,this.id,r.message),r.units>0&&this.queuedMoves++}}}}function Tp(e,t){return e.score!==t.score?t.score-e.score:Math.random()-.5}function Vl(e){for(const t of e.playerMap.values()){const n={playerId:t.id,systems:0,ships:0,homeworld:0};for(const i of e.world.systemMap.values())i.ownerId===t.id&&(n.systems+=1,n.ships+=i.ships??0,i.homeworld===t.id&&(n.homeworld=i.ships??0));t.stats=n}}function jl(e){for(const t of e.world.systemMap.values())t.type==="INHABITED"&&(t.ownerId||t.ships<Aa)&&(t.ships=(t.ships??0)+oc)}function Wl(e){for(const t of e.world.systemMap.values())t.ownerId!=null&&(t.ships=(t.ships??0)+ac)}function Np({S:e,C:t,E:n,P:i}){if(t.status==="PLAYING"&&i)if(e.playerMap.size>1){const r=Array.from(e.playerMap.values());if(r.reduce((o,a)=>(o+=a.stats.homeworld>0?1:0,o),0)===1){const o=r.find(l=>l.stats.homeworld>0).id,a=e.playerMap.get(o);n.emit("PLAYER_WIN",{playerId:o,message:`${a.name} has conquered The Bubble!`}),n.emit("GAME_STOP",void 0)}}else Array.from(e.world.systemMap.values()).filter(s=>s.ownerId!==t.playerId).length===0&&(n.emit("PLAYER_WIN",{playerId:t.playerId,message:`${i.name} has conquered The Bubble!`}),n.emit("GAME_STOP",void 0))}function Cp(e,t=!1){const{S:n,C:i}=e;i.tick%rc===0&&jl(n),i.tick%sc===0&&Wl(n);for(const r of n.world.systemMap.values())r.movement=[0,0];for(const r of n.world.laneMap.values())r.movement=[0,0];t||(Ep(e),Xl(e)),Vl(n)}const zn=BigInt(2**32-1),Zo=BigInt(32);function Pp(e,t=!1){return t?{h:Number(e&zn),l:Number(e>>Zo&zn)}:{h:Number(e>>Zo&zn)|0,l:Number(e&zn)|0}}function kp(e,t=!1){const n=e.length;let i=new Uint32Array(n),r=new Uint32Array(n);for(let s=0;s<n;s++){const{h:o,l:a}=Pp(e[s],t);[i[s],r[s]]=[o,a]}return[i,r]}const Op=(e,t,n)=>e<<n|t>>>32-n,Rp=(e,t,n)=>t<<n|e>>>32-n,Lp=(e,t,n)=>t<<n-32|e>>>64-n,Dp=(e,t,n)=>e<<n-32|t>>>64-n;function zp(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Jo(e,t=""){if(!Number.isSafeInteger(e)||e<0){const n=t&&`"${t}" `;throw new Error(`${n}expected integer >= 0, got ${e}`)}}function jr(e,t,n=""){const i=zp(e),r=e?.length;if(!i||t!==void 0){const o=n&&`"${n}" `,a="",l=i?`length=${r}`:`type=${typeof e}`;throw new Error(o+"expected Uint8Array"+a+", got "+l)}return e}function ta(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Bp(e,t){jr(e,void 0,"digestInto() output");const n=t.outputLen;if(e.length<n)throw new Error('"digestInto() output" expected to be of length >='+n)}function Fp(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function Ql(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}const Up=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Hp(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function qp(e){for(let t=0;t<e.length;t++)e[t]=Hp(e[t]);return e}const ea=Up?e=>e:qp;function Gp(e,t={}){const n=(r,s)=>e(s).update(r).digest(),i=e(void 0);return n.outputLen=i.outputLen,n.blockLen=i.blockLen,n.create=r=>e(r),Object.assign(n,t),Object.freeze(n)}const Xp=e=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,e])}),Yp=BigInt(0),Ke=BigInt(1),Kp=BigInt(2),Vp=BigInt(7),jp=BigInt(256),Wp=BigInt(113),Zl=[],Jl=[],tu=[];for(let e=0,t=Ke,n=1,i=0;e<24;e++){[n,i]=[i,(2*n+3*i)%5],Zl.push(2*(5*i+n)),Jl.push((e+1)*(e+2)/2%64);let r=Yp;for(let s=0;s<7;s++)t=(t<<Ke^(t>>Vp)*Wp)%jp,t&Kp&&(r^=Ke<<(Ke<<BigInt(s))-Ke);tu.push(r)}const eu=kp(tu,!0),Qp=eu[0],Zp=eu[1],na=(e,t,n)=>n>32?Lp(e,t,n):Op(e,t,n),ia=(e,t,n)=>n>32?Dp(e,t,n):Rp(e,t,n);function Jp(e,t=24){const n=new Uint32Array(10);for(let i=24-t;i<24;i++){for(let o=0;o<10;o++)n[o]=e[o]^e[o+10]^e[o+20]^e[o+30]^e[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,l=(o+2)%10,u=n[l],h=n[l+1],c=na(u,h,1)^n[a],f=ia(u,h,1)^n[a+1];for(let v=0;v<50;v+=10)e[o+v]^=c,e[o+v+1]^=f}let r=e[2],s=e[3];for(let o=0;o<24;o++){const a=Jl[o],l=na(r,s,a),u=ia(r,s,a),h=Zl[o];r=e[h],s=e[h+1],e[h]=l,e[h+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=e[o+a];for(let a=0;a<10;a++)e[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}e[0]^=Qp[i],e[1]^=Zp[i]}Ql(n)}class Ps{state;pos=0;posOut=0;finished=!1;state32;destroyed=!1;blockLen;suffix;outputLen;enableXOF=!1;rounds;constructor(t,n,i,r=!1,s=24){if(this.blockLen=t,this.suffix=n,this.outputLen=i,this.enableXOF=r,this.rounds=s,Jo(i,"outputLen"),!(0<t&&t<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Fp(this.state)}clone(){return this._cloneInto()}keccak(){ea(this.state32),Jp(this.state32,this.rounds),ea(this.state32),this.posOut=0,this.pos=0}update(t){ta(this),jr(t);const{blockLen:n,state:i}=this,r=t.length;for(let s=0;s<r;){const o=Math.min(n-this.pos,r-s);for(let a=0;a<o;a++)i[this.pos++]^=t[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:n,pos:i,blockLen:r}=this;t[i]^=n,(n&128)!==0&&i===r-1&&this.keccak(),t[r-1]^=128,this.keccak()}writeInto(t){ta(this,!1),jr(t),this.finish();const n=this.state,{blockLen:i}=this;for(let r=0,s=t.length;r<s;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,s-r);t.set(n.subarray(this.posOut,this.posOut+o),r),this.posOut+=o,r+=o}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return Jo(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(Bp(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Ql(this.state)}_cloneInto(t){const{blockLen:n,suffix:i,outputLen:r,rounds:s,enableXOF:o}=this;return t||=new Ps(n,i,r,o,s),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=s,t.suffix=i,t.outputLen=r,t.enableXOF=o,t.destroyed=this.destroyed,t}}const tg=(e,t,n,i={})=>Gp(()=>new Ps(t,e,n),i),eg=tg(6,72,64,Xp(10));var ng=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,ur=Math.ceil,bt=Math.floor,pt="[BigNumber Error] ",ra=pt+"Number primitive has more than 15 significant digits: ",At=1e14,U=14,cr=9007199254740991,hr=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],ne=1e7,rt=1e9;function nu(e){var t,n,i,r=E.prototype={constructor:E,toString:null,valueOf:null},s=new E(1),o=20,a=4,l=-7,u=21,h=-1e7,c=1e7,f=!1,v=1,M=0,A={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},N="0123456789abcdefghijklmnopqrstuvwxyz",I=!0;function E(d,g){var w,_,b,$,y,p,m,x,S=this;if(!(S instanceof E))return new E(d,g);if(g==null){if(d&&d._isBigNumber===!0){S.s=d.s,!d.c||d.e>c?S.c=S.e=null:d.e<h?S.c=[S.e=0]:(S.e=d.e,S.c=d.c.slice());return}if((p=typeof d=="number")&&d*0==0){if(S.s=1/d<0?(d=-d,-1):1,d===~~d){for($=0,y=d;y>=10;y/=10,$++);$>c?S.c=S.e=null:(S.e=$,S.c=[d]);return}x=String(d)}else{if(!ng.test(x=String(d)))return i(S,x,p);S.s=x.charCodeAt(0)==45?(x=x.slice(1),-1):1}($=x.indexOf("."))>-1&&(x=x.replace(".","")),(y=x.search(/e/i))>0?($<0&&($=y),$+=+x.slice(y+1),x=x.substring(0,y)):$<0&&($=x.length)}else{if(Z(g,2,N.length,"Base"),g==10&&I)return S=new E(d),O(S,o+S.e+1,a);if(x=String(d),p=typeof d=="number"){if(d*0!=0)return i(S,x,p,g);if(S.s=1/d<0?(x=x.slice(1),-1):1,E.DEBUG&&x.replace(/^0\.0*|\./,"").length>15)throw Error(ra+d)}else S.s=x.charCodeAt(0)===45?(x=x.slice(1),-1):1;for(w=N.slice(0,g),$=y=0,m=x.length;y<m;y++)if(w.indexOf(_=x.charAt(y))<0){if(_=="."){if(y>$){$=m;continue}}else if(!b&&(x==x.toUpperCase()&&(x=x.toLowerCase())||x==x.toLowerCase()&&(x=x.toUpperCase()))){b=!0,y=-1,$=0;continue}return i(S,String(d),p,g)}p=!1,x=n(x,g,10,S.s),($=x.indexOf("."))>-1?x=x.replace(".",""):$=x.length}for(y=0;x.charCodeAt(y)===48;y++);for(m=x.length;x.charCodeAt(--m)===48;);if(x=x.slice(y,++m)){if(m-=y,p&&E.DEBUG&&m>15&&(d>cr||d!==bt(d)))throw Error(ra+S.s*d);if(($=$-y-1)>c)S.c=S.e=null;else if($<h)S.c=[S.e=0];else{if(S.e=$,S.c=[],y=($+1)%U,$<0&&(y+=U),y<m){for(y&&S.c.push(+x.slice(0,y)),m-=U;y<m;)S.c.push(+x.slice(y,y+=U));y=U-(x=x.slice(y)).length}else y-=m;for(;y--;x+="0");S.c.push(+x)}}else S.c=[S.e=0]}E.clone=nu,E.ROUND_UP=0,E.ROUND_DOWN=1,E.ROUND_CEIL=2,E.ROUND_FLOOR=3,E.ROUND_HALF_UP=4,E.ROUND_HALF_DOWN=5,E.ROUND_HALF_EVEN=6,E.ROUND_HALF_CEIL=7,E.ROUND_HALF_FLOOR=8,E.EUCLID=9,E.config=E.set=function(d){var g,w;if(d!=null)if(typeof d=="object"){if(d.hasOwnProperty(g="DECIMAL_PLACES")&&(w=d[g],Z(w,0,rt,g),o=w),d.hasOwnProperty(g="ROUNDING_MODE")&&(w=d[g],Z(w,0,8,g),a=w),d.hasOwnProperty(g="EXPONENTIAL_AT")&&(w=d[g],w&&w.pop?(Z(w[0],-rt,0,g),Z(w[1],0,rt,g),l=w[0],u=w[1]):(Z(w,-rt,rt,g),l=-(u=w<0?-w:w))),d.hasOwnProperty(g="RANGE"))if(w=d[g],w&&w.pop)Z(w[0],-rt,-1,g),Z(w[1],1,rt,g),h=w[0],c=w[1];else if(Z(w,-rt,rt,g),w)h=-(c=w<0?-w:w);else throw Error(pt+g+" cannot be zero: "+w);if(d.hasOwnProperty(g="CRYPTO"))if(w=d[g],w===!!w)if(w)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))f=w;else throw f=!w,Error(pt+"crypto unavailable");else f=w;else throw Error(pt+g+" not true or false: "+w);if(d.hasOwnProperty(g="MODULO_MODE")&&(w=d[g],Z(w,0,9,g),v=w),d.hasOwnProperty(g="POW_PRECISION")&&(w=d[g],Z(w,0,rt,g),M=w),d.hasOwnProperty(g="FORMAT"))if(w=d[g],typeof w=="object")A=w;else throw Error(pt+g+" not an object: "+w);if(d.hasOwnProperty(g="ALPHABET"))if(w=d[g],typeof w=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(w))I=w.slice(0,10)=="0123456789",N=w;else throw Error(pt+g+" invalid: "+w)}else throw Error(pt+"Object expected: "+d);return{DECIMAL_PLACES:o,ROUNDING_MODE:a,EXPONENTIAL_AT:[l,u],RANGE:[h,c],CRYPTO:f,MODULO_MODE:v,POW_PRECISION:M,FORMAT:A,ALPHABET:N}},E.isBigNumber=function(d){if(!d||d._isBigNumber!==!0)return!1;if(!E.DEBUG)return!0;var g,w,_=d.c,b=d.e,$=d.s;t:if({}.toString.call(_)=="[object Array]"){if(($===1||$===-1)&&b>=-rt&&b<=rt&&b===bt(b)){if(_[0]===0){if(b===0&&_.length===1)return!0;break t}if(g=(b+1)%U,g<1&&(g+=U),String(_[0]).length==g){for(g=0;g<_.length;g++)if(w=_[g],w<0||w>=At||w!==bt(w))break t;if(w!==0)return!0}}}else if(_===null&&b===null&&($===null||$===1||$===-1))return!0;throw Error(pt+"Invalid BigNumber: "+d)},E.maximum=E.max=function(){return C(arguments,-1)},E.minimum=E.min=function(){return C(arguments,1)},E.random=(function(){var d=9007199254740992,g=Math.random()*d&2097151?function(){return bt(Math.random()*d)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(w){var _,b,$,y,p,m=0,x=[],S=new E(s);if(w==null?w=o:Z(w,0,rt),y=ur(w/U),f)if(crypto.getRandomValues){for(_=crypto.getRandomValues(new Uint32Array(y*=2));m<y;)p=_[m]*131072+(_[m+1]>>>11),p>=9e15?(b=crypto.getRandomValues(new Uint32Array(2)),_[m]=b[0],_[m+1]=b[1]):(x.push(p%1e14),m+=2);m=y/2}else if(crypto.randomBytes){for(_=crypto.randomBytes(y*=7);m<y;)p=(_[m]&31)*281474976710656+_[m+1]*1099511627776+_[m+2]*4294967296+_[m+3]*16777216+(_[m+4]<<16)+(_[m+5]<<8)+_[m+6],p>=9e15?crypto.randomBytes(7).copy(_,m):(x.push(p%1e14),m+=7);m=y/7}else throw f=!1,Error(pt+"crypto unavailable");if(!f)for(;m<y;)p=g(),p<9e15&&(x[m++]=p%1e14);for(y=x[--m],w%=U,y&&w&&(p=hr[U-w],x[m]=bt(y/p)*p);x[m]===0;x.pop(),m--);if(m<0)x=[$=0];else{for($=-1;x[0]===0;x.splice(0,1),$-=U);for(m=1,p=x[0];p>=10;p/=10,m++);m<U&&($-=U-m)}return S.e=$,S.c=x,S}})(),E.sum=function(){for(var d=1,g=arguments,w=new E(g[0]);d<g.length;)w=w.plus(g[d++]);return w},n=(function(){var d="0123456789";function g(w,_,b,$){for(var y,p=[0],m,x=0,S=w.length;x<S;){for(m=p.length;m--;p[m]*=_);for(p[0]+=$.indexOf(w.charAt(x++)),y=0;y<p.length;y++)p[y]>b-1&&(p[y+1]==null&&(p[y+1]=0),p[y+1]+=p[y]/b|0,p[y]%=b)}return p.reverse()}return function(w,_,b,$,y){var p,m,x,S,T,R,L,z,F=w.indexOf("."),H=o,B=a;for(F>=0&&(S=M,M=0,w=w.replace(".",""),z=new E(_),R=z.pow(w.length-F),M=S,z.c=g(Kt(xt(R.c),R.e,"0"),10,b,d),z.e=z.c.length),L=g(w,_,b,y?(p=N,d):(p=d,N)),x=S=L.length;L[--S]==0;L.pop());if(!L[0])return p.charAt(0);if(F<0?--x:(R.c=L,R.e=x,R.s=$,R=t(R,z,H,B,b),L=R.c,T=R.r,x=R.e),m=x+H+1,F=L[m],S=b/2,T=T||m<0||L[m+1]!=null,T=B<4?(F!=null||T)&&(B==0||B==(R.s<0?3:2)):F>S||F==S&&(B==4||T||B==6&&L[m-1]&1||B==(R.s<0?8:7)),m<1||!L[0])w=T?Kt(p.charAt(1),-H,p.charAt(0)):p.charAt(0);else{if(L.length=m,T)for(--b;++L[--m]>b;)L[m]=0,m||(++x,L=[1].concat(L));for(S=L.length;!L[--S];);for(F=0,w="";F<=S;w+=p.charAt(L[F++]));w=Kt(w,x,p.charAt(0))}return w}})(),t=(function(){function d(_,b,$){var y,p,m,x,S=0,T=_.length,R=b%ne,L=b/ne|0;for(_=_.slice();T--;)m=_[T]%ne,x=_[T]/ne|0,y=L*m+x*R,p=R*m+y%ne*ne+S,S=(p/$|0)+(y/ne|0)+L*x,_[T]=p%$;return S&&(_=[S].concat(_)),_}function g(_,b,$,y){var p,m;if($!=y)m=$>y?1:-1;else for(p=m=0;p<$;p++)if(_[p]!=b[p]){m=_[p]>b[p]?1:-1;break}return m}function w(_,b,$,y){for(var p=0;$--;)_[$]-=p,p=_[$]<b[$]?1:0,_[$]=p*y+_[$]-b[$];for(;!_[0]&&_.length>1;_.splice(0,1));}return function(_,b,$,y,p){var m,x,S,T,R,L,z,F,H,B,G,W,dt,ae,ji,Lt,He,_t=_.s==b.s?1:-1,at=_.c,tt=b.c;if(!at||!at[0]||!tt||!tt[0])return new E(!_.s||!b.s||(at?tt&&at[0]==tt[0]:!tt)?NaN:at&&at[0]==0||!tt?_t*0:_t/0);for(F=new E(_t),H=F.c=[],x=_.e-b.e,_t=$+x+1,p||(p=At,x=Mt(_.e/U)-Mt(b.e/U),_t=_t/U|0),S=0;tt[S]==(at[S]||0);S++);if(tt[S]>(at[S]||0)&&x--,_t<0)H.push(1),T=!0;else{for(ae=at.length,Lt=tt.length,S=0,_t+=2,R=bt(p/(tt[0]+1)),R>1&&(tt=d(tt,R,p),at=d(at,R,p),Lt=tt.length,ae=at.length),dt=Lt,B=at.slice(0,Lt),G=B.length;G<Lt;B[G++]=0);He=tt.slice(),He=[0].concat(He),ji=tt[0],tt[1]>=p/2&&ji++;do{if(R=0,m=g(tt,B,Lt,G),m<0){if(W=B[0],Lt!=G&&(W=W*p+(B[1]||0)),R=bt(W/ji),R>1)for(R>=p&&(R=p-1),L=d(tt,R,p),z=L.length,G=B.length;g(L,B,z,G)==1;)R--,w(L,Lt<z?He:tt,z,p),z=L.length,m=1;else R==0&&(m=R=1),L=tt.slice(),z=L.length;if(z<G&&(L=[0].concat(L)),w(B,L,G,p),G=B.length,m==-1)for(;g(tt,B,Lt,G)<1;)R++,w(B,Lt<G?He:tt,G,p),G=B.length}else m===0&&(R++,B=[0]);H[S++]=R,B[0]?B[G++]=at[dt]||0:(B=[at[dt]],G=1)}while((dt++<ae||B[0]!=null)&&_t--);T=B[0]!=null,H[0]||H.splice(0,1)}if(p==At){for(S=1,_t=H[0];_t>=10;_t/=10,S++);O(F,$+(F.e=S+x*U-1)+1,y,T)}else F.e=x,F.r=+T;return F}})();function P(d,g,w,_){var b,$,y,p,m;if(w==null?w=a:Z(w,0,8),!d.c)return d.toString();if(b=d.c[0],y=d.e,g==null)m=xt(d.c),m=_==1||_==2&&(y<=l||y>=u)?Fn(m,y):Kt(m,y,"0");else if(d=O(new E(d),g,w),$=d.e,m=xt(d.c),p=m.length,_==1||_==2&&(g<=$||$<=l)){for(;p<g;m+="0",p++);m=Fn(m,$)}else if(g-=y+(_===2&&$>y),m=Kt(m,$,"0"),$+1>p){if(--g>0)for(m+=".";g--;m+="0");}else if(g+=$-p,g>0)for($+1==p&&(m+=".");g--;m+="0");return d.s<0&&b?"-"+m:m}function C(d,g){for(var w,_,b=1,$=new E(d[0]);b<d.length;b++)_=new E(d[b]),(!_.s||(w=ue($,_))===g||w===0&&$.s===g)&&($=_);return $}function k(d,g,w){for(var _=1,b=g.length;!g[--b];g.pop());for(b=g[0];b>=10;b/=10,_++);return(w=_+w*U-1)>c?d.c=d.e=null:w<h?d.c=[d.e=0]:(d.e=w,d.c=g),d}i=(function(){var d=/^(-?)0([xbo])(?=\w[\w.]*$)/i,g=/^([^.]+)\.$/,w=/^\.([^.]+)$/,_=/^-?(Infinity|NaN)$/,b=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function($,y,p,m){var x,S=p?y:y.replace(b,"");if(_.test(S))$.s=isNaN(S)?null:S<0?-1:1;else{if(!p&&(S=S.replace(d,function(T,R,L){return x=(L=L.toLowerCase())=="x"?16:L=="b"?2:8,!m||m==x?R:T}),m&&(x=m,S=S.replace(g,"$1").replace(w,"0.$1")),y!=S))return new E(S,x);if(E.DEBUG)throw Error(pt+"Not a"+(m?" base "+m:"")+" number: "+y);$.s=null}$.c=$.e=null}})();function O(d,g,w,_){var b,$,y,p,m,x,S,T=d.c,R=hr;if(T){t:{for(b=1,p=T[0];p>=10;p/=10,b++);if($=g-b,$<0)$+=U,y=g,m=T[x=0],S=bt(m/R[b-y-1]%10);else if(x=ur(($+1)/U),x>=T.length)if(_){for(;T.length<=x;T.push(0));m=S=0,b=1,$%=U,y=$-U+1}else break t;else{for(m=p=T[x],b=1;p>=10;p/=10,b++);$%=U,y=$-U+b,S=y<0?0:bt(m/R[b-y-1]%10)}if(_=_||g<0||T[x+1]!=null||(y<0?m:m%R[b-y-1]),_=w<4?(S||_)&&(w==0||w==(d.s<0?3:2)):S>5||S==5&&(w==4||_||w==6&&($>0?y>0?m/R[b-y]:0:T[x-1])%10&1||w==(d.s<0?8:7)),g<1||!T[0])return T.length=0,_?(g-=d.e+1,T[0]=R[(U-g%U)%U],d.e=-g||0):T[0]=d.e=0,d;if($==0?(T.length=x,p=1,x--):(T.length=x+1,p=R[U-$],T[x]=y>0?bt(m/R[b-y]%R[y])*p:0),_)for(;;)if(x==0){for($=1,y=T[0];y>=10;y/=10,$++);for(y=T[0]+=p,p=1;y>=10;y/=10,p++);$!=p&&(d.e++,T[0]==At&&(T[0]=1));break}else{if(T[x]+=p,T[x]!=At)break;T[x--]=0,p=1}for($=T.length;T[--$]===0;T.pop());}d.e>c?d.c=d.e=null:d.e<h&&(d.c=[d.e=0])}return d}function D(d){var g,w=d.e;return w===null?d.toString():(g=xt(d.c),g=w<=l||w>=u?Fn(g,w):Kt(g,w,"0"),d.s<0?"-"+g:g)}return r.absoluteValue=r.abs=function(){var d=new E(this);return d.s<0&&(d.s=1),d},r.comparedTo=function(d,g){return ue(this,new E(d,g))},r.decimalPlaces=r.dp=function(d,g){var w,_,b,$=this;if(d!=null)return Z(d,0,rt),g==null?g=a:Z(g,0,8),O(new E($),d+$.e+1,g);if(!(w=$.c))return null;if(_=((b=w.length-1)-Mt(this.e/U))*U,b=w[b])for(;b%10==0;b/=10,_--);return _<0&&(_=0),_},r.dividedBy=r.div=function(d,g){return t(this,new E(d,g),o,a)},r.dividedToIntegerBy=r.idiv=function(d,g){return t(this,new E(d,g),0,1)},r.exponentiatedBy=r.pow=function(d,g){var w,_,b,$,y,p,m,x,S,T=this;if(d=new E(d),d.c&&!d.isInteger())throw Error(pt+"Exponent not an integer: "+D(d));if(g!=null&&(g=new E(g)),p=d.e>14,!T.c||!T.c[0]||T.c[0]==1&&!T.e&&T.c.length==1||!d.c||!d.c[0])return S=new E(Math.pow(+D(T),p?d.s*(2-Bn(d)):+D(d))),g?S.mod(g):S;if(m=d.s<0,g){if(g.c?!g.c[0]:!g.s)return new E(NaN);_=!m&&T.isInteger()&&g.isInteger(),_&&(T=T.mod(g))}else{if(d.e>9&&(T.e>0||T.e<-1||(T.e==0?T.c[0]>1||p&&T.c[1]>=24e7:T.c[0]<8e13||p&&T.c[0]<=9999975e7)))return $=T.s<0&&Bn(d)?-0:0,T.e>-1&&($=1/$),new E(m?1/$:$);M&&($=ur(M/U+2))}for(p?(w=new E(.5),m&&(d.s=1),x=Bn(d)):(b=Math.abs(+D(d)),x=b%2),S=new E(s);;){if(x){if(S=S.times(T),!S.c)break;$?S.c.length>$&&(S.c.length=$):_&&(S=S.mod(g))}if(b){if(b=bt(b/2),b===0)break;x=b%2}else if(d=d.times(w),O(d,d.e+1,1),d.e>14)x=Bn(d);else{if(b=+D(d),b===0)break;x=b%2}T=T.times(T),$?T.c&&T.c.length>$&&(T.c.length=$):_&&(T=T.mod(g))}return _?S:(m&&(S=s.div(S)),g?S.mod(g):$?O(S,M,a,y):S)},r.integerValue=function(d){var g=new E(this);return d==null?d=a:Z(d,0,8),O(g,g.e+1,d)},r.isEqualTo=r.eq=function(d,g){return ue(this,new E(d,g))===0},r.isFinite=function(){return!!this.c},r.isGreaterThan=r.gt=function(d,g){return ue(this,new E(d,g))>0},r.isGreaterThanOrEqualTo=r.gte=function(d,g){return(g=ue(this,new E(d,g)))===1||g===0},r.isInteger=function(){return!!this.c&&Mt(this.e/U)>this.c.length-2},r.isLessThan=r.lt=function(d,g){return ue(this,new E(d,g))<0},r.isLessThanOrEqualTo=r.lte=function(d,g){return(g=ue(this,new E(d,g)))===-1||g===0},r.isNaN=function(){return!this.s},r.isNegative=function(){return this.s<0},r.isPositive=function(){return this.s>0},r.isZero=function(){return!!this.c&&this.c[0]==0},r.minus=function(d,g){var w,_,b,$,y=this,p=y.s;if(d=new E(d,g),g=d.s,!p||!g)return new E(NaN);if(p!=g)return d.s=-g,y.plus(d);var m=y.e/U,x=d.e/U,S=y.c,T=d.c;if(!m||!x){if(!S||!T)return S?(d.s=-g,d):new E(T?y:NaN);if(!S[0]||!T[0])return T[0]?(d.s=-g,d):new E(S[0]?y:a==3?-0:0)}if(m=Mt(m),x=Mt(x),S=S.slice(),p=m-x){for(($=p<0)?(p=-p,b=S):(x=m,b=T),b.reverse(),g=p;g--;b.push(0));b.reverse()}else for(_=($=(p=S.length)<(g=T.length))?p:g,p=g=0;g<_;g++)if(S[g]!=T[g]){$=S[g]<T[g];break}if($&&(b=S,S=T,T=b,d.s=-d.s),g=(_=T.length)-(w=S.length),g>0)for(;g--;S[w++]=0);for(g=At-1;_>p;){if(S[--_]<T[_]){for(w=_;w&&!S[--w];S[w]=g);--S[w],S[_]+=At}S[_]-=T[_]}for(;S[0]==0;S.splice(0,1),--x);return S[0]?k(d,S,x):(d.s=a==3?-1:1,d.c=[d.e=0],d)},r.modulo=r.mod=function(d,g){var w,_,b=this;return d=new E(d,g),!b.c||!d.s||d.c&&!d.c[0]?new E(NaN):!d.c||b.c&&!b.c[0]?new E(b):(v==9?(_=d.s,d.s=1,w=t(b,d,0,3),d.s=_,w.s*=_):w=t(b,d,0,v),d=b.minus(w.times(d)),!d.c[0]&&v==1&&(d.s=b.s),d)},r.multipliedBy=r.times=function(d,g){var w,_,b,$,y,p,m,x,S,T,R,L,z,F,H,B=this,G=B.c,W=(d=new E(d,g)).c;if(!G||!W||!G[0]||!W[0])return!B.s||!d.s||G&&!G[0]&&!W||W&&!W[0]&&!G?d.c=d.e=d.s=null:(d.s*=B.s,!G||!W?d.c=d.e=null:(d.c=[0],d.e=0)),d;for(_=Mt(B.e/U)+Mt(d.e/U),d.s*=B.s,m=G.length,T=W.length,m<T&&(z=G,G=W,W=z,b=m,m=T,T=b),b=m+T,z=[];b--;z.push(0));for(F=At,H=ne,b=T;--b>=0;){for(w=0,R=W[b]%H,L=W[b]/H|0,y=m,$=b+y;$>b;)x=G[--y]%H,S=G[y]/H|0,p=L*x+S*R,x=R*x+p%H*H+z[$]+w,w=(x/F|0)+(p/H|0)+L*S,z[$--]=x%F;z[$]=w}return w?++_:z.splice(0,1),k(d,z,_)},r.negated=function(){var d=new E(this);return d.s=-d.s||null,d},r.plus=function(d,g){var w,_=this,b=_.s;if(d=new E(d,g),g=d.s,!b||!g)return new E(NaN);if(b!=g)return d.s=-g,_.minus(d);var $=_.e/U,y=d.e/U,p=_.c,m=d.c;if(!$||!y){if(!p||!m)return new E(b/0);if(!p[0]||!m[0])return m[0]?d:new E(p[0]?_:b*0)}if($=Mt($),y=Mt(y),p=p.slice(),b=$-y){for(b>0?(y=$,w=m):(b=-b,w=p),w.reverse();b--;w.push(0));w.reverse()}for(b=p.length,g=m.length,b-g<0&&(w=m,m=p,p=w,g=b),b=0;g;)b=(p[--g]=p[g]+m[g]+b)/At|0,p[g]=At===p[g]?0:p[g]%At;return b&&(p=[b].concat(p),++y),k(d,p,y)},r.precision=r.sd=function(d,g){var w,_,b,$=this;if(d!=null&&d!==!!d)return Z(d,1,rt),g==null?g=a:Z(g,0,8),O(new E($),d,g);if(!(w=$.c))return null;if(b=w.length-1,_=b*U+1,b=w[b]){for(;b%10==0;b/=10,_--);for(b=w[0];b>=10;b/=10,_++);}return d&&$.e+1>_&&(_=$.e+1),_},r.shiftedBy=function(d){return Z(d,-cr,cr),this.times("1e"+d)},r.squareRoot=r.sqrt=function(){var d,g,w,_,b,$=this,y=$.c,p=$.s,m=$.e,x=o+4,S=new E("0.5");if(p!==1||!y||!y[0])return new E(!p||p<0&&(!y||y[0])?NaN:y?$:1/0);if(p=Math.sqrt(+D($)),p==0||p==1/0?(g=xt(y),(g.length+m)%2==0&&(g+="0"),p=Math.sqrt(+g),m=Mt((m+1)/2)-(m<0||m%2),p==1/0?g="5e"+m:(g=p.toExponential(),g=g.slice(0,g.indexOf("e")+1)+m),w=new E(g)):w=new E(p+""),w.c[0]){for(m=w.e,p=m+x,p<3&&(p=0);;)if(b=w,w=S.times(b.plus(t($,b,x,1))),xt(b.c).slice(0,p)===(g=xt(w.c)).slice(0,p))if(w.e<m&&--p,g=g.slice(p-3,p+1),g=="9999"||!_&&g=="4999"){if(!_&&(O(b,b.e+o+2,0),b.times(b).eq($))){w=b;break}x+=4,p+=4,_=1}else{(!+g||!+g.slice(1)&&g.charAt(0)=="5")&&(O(w,w.e+o+2,1),d=!w.times(w).eq($));break}}return O(w,w.e+o+1,a,d)},r.toExponential=function(d,g){return d!=null&&(Z(d,0,rt),d++),P(this,d,g,1)},r.toFixed=function(d,g){return d!=null&&(Z(d,0,rt),d=d+this.e+1),P(this,d,g)},r.toFormat=function(d,g,w){var _,b=this;if(w==null)d!=null&&g&&typeof g=="object"?(w=g,g=null):d&&typeof d=="object"?(w=d,d=g=null):w=A;else if(typeof w!="object")throw Error(pt+"Argument not an object: "+w);if(_=b.toFixed(d,g),b.c){var $,y=_.split("."),p=+w.groupSize,m=+w.secondaryGroupSize,x=w.groupSeparator||"",S=y[0],T=y[1],R=b.s<0,L=R?S.slice(1):S,z=L.length;if(m&&($=p,p=m,m=$,z-=$),p>0&&z>0){for($=z%p||p,S=L.substr(0,$);$<z;$+=p)S+=x+L.substr($,p);m>0&&(S+=x+L.slice($)),R&&(S="-"+S)}_=T?S+(w.decimalSeparator||"")+((m=+w.fractionGroupSize)?T.replace(new RegExp("\\d{"+m+"}\\B","g"),"$&"+(w.fractionGroupSeparator||"")):T):S}return(w.prefix||"")+_+(w.suffix||"")},r.toFraction=function(d){var g,w,_,b,$,y,p,m,x,S,T,R,L=this,z=L.c;if(d!=null&&(p=new E(d),!p.isInteger()&&(p.c||p.s!==1)||p.lt(s)))throw Error(pt+"Argument "+(p.isInteger()?"out of range: ":"not an integer: ")+D(p));if(!z)return new E(L);for(g=new E(s),x=w=new E(s),_=m=new E(s),R=xt(z),$=g.e=R.length-L.e-1,g.c[0]=hr[(y=$%U)<0?U+y:y],d=!d||p.comparedTo(g)>0?$>0?g:x:p,y=c,c=1/0,p=new E(R),m.c[0]=0;S=t(p,g,0,1),b=w.plus(S.times(_)),b.comparedTo(d)!=1;)w=_,_=b,x=m.plus(S.times(b=x)),m=b,g=p.minus(S.times(b=g)),p=b;return b=t(d.minus(w),_,0,1),m=m.plus(b.times(x)),w=w.plus(b.times(_)),m.s=x.s=L.s,$=$*2,T=t(x,_,$,a).minus(L).abs().comparedTo(t(m,w,$,a).minus(L).abs())<1?[x,_]:[m,w],c=y,T},r.toNumber=function(){return+D(this)},r.toPrecision=function(d,g){return d!=null&&Z(d,1,rt),P(this,d,g,2)},r.toString=function(d){var g,w=this,_=w.s,b=w.e;return b===null?_?(g="Infinity",_<0&&(g="-"+g)):g="NaN":(d==null?g=b<=l||b>=u?Fn(xt(w.c),b):Kt(xt(w.c),b,"0"):d===10&&I?(w=O(new E(w),o+b+1,a),g=Kt(xt(w.c),w.e,"0")):(Z(d,2,N.length,"Base"),g=n(Kt(xt(w.c),b,"0"),10,d,_,!0)),_<0&&w.c[0]&&(g="-"+g)),g},r.valueOf=r.toJSON=function(){return D(this)},r._isBigNumber=!0,r[Symbol.toStringTag]="BigNumber",r[Symbol.for("nodejs.util.inspect.custom")]=r.valueOf,e!=null&&E.set(e),E}function Mt(e){var t=e|0;return e>0||e===t?t:t-1}function xt(e){for(var t,n,i=1,r=e.length,s=e[0]+"";i<r;){for(t=e[i++]+"",n=U-t.length;n--;t="0"+t);s+=t}for(r=s.length;s.charCodeAt(--r)===48;);return s.slice(0,r+1||1)}function ue(e,t){var n,i,r=e.c,s=t.c,o=e.s,a=t.s,l=e.e,u=t.e;if(!o||!a)return null;if(n=r&&!r[0],i=s&&!s[0],n||i)return n?i?0:-a:o;if(o!=a)return o;if(n=o<0,i=l==u,!r||!s)return i?0:!r^n?1:-1;if(!i)return l>u^n?1:-1;for(a=(l=r.length)<(u=s.length)?l:u,o=0;o<a;o++)if(r[o]!=s[o])return r[o]>s[o]^n?1:-1;return l==u?0:l>u^n?1:-1}function Z(e,t,n,i){if(e<t||e>n||e!==bt(e))throw Error(pt+(i||"Argument")+(typeof e=="number"?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function Bn(e){var t=e.c.length-1;return Mt(e.e/U)==t&&e.c[t]%2!=0}function Fn(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function Kt(e,t,n){var i,r;if(t<0){for(r=n+".";++t;r+=n);e=r+e}else if(i=e.length,++t>i){for(r=n,t-=i;--t;r+=n);e+=r}else t<i&&(e=e.slice(0,t)+"."+e.slice(t));return e}var ig=nu();const rg=24,rn=32,sg=()=>typeof globalThis<"u"&&globalThis.crypto&&typeof globalThis.crypto.getRandomValues=="function"?()=>{const e=new Uint32Array(1);return globalThis.crypto.getRandomValues(e),e[0]/4294967296}:Math.random,ks=sg(),Wr=(e=4,t=ks)=>{let n="";for(;n.length<e;)n=n+Math.floor(t()*36).toString(36);return n};function og(e){let t=new ig(0);for(const n of e.values())t=t.multipliedBy(256).plus(n);return t}const iu=(e="")=>{const t=new TextEncoder;return og(eg(t.encode(e))).toString(36).slice(1)},sa=Array.from({length:26},(e,t)=>String.fromCharCode(t+97)),ag=e=>sa[Math.floor(e()*sa.length)],lg=({globalObj:e=typeof global<"u"?global:typeof window<"u"?window:{},random:t=ks}={})=>{const n=Object.keys(e).toString(),i=n.length?n+Wr(rn,t):Wr(rn,t);return iu(i).substring(0,rn)},ug=e=>()=>e++,cg=476782367,Os=({random:e=ks,counter:t=ug(Math.floor(e()*cg)),length:n=rg,fingerprint:i=lg({random:e})}={})=>{if(n>rn)throw new Error(`Length must be between 2 and ${rn}. Received: ${n}`);return function(){const s=ag(e),o=Date.now().toString(36),a=t().toString(36),l=Wr(n,e),u=`${o+l+a+i}`;return`${s+iu(u).substring(1,n)}`}};Os();const hg=Os({length:5});function ru({S:e,C:t}){e.world=Hi();const n=oe/(t.config.numSystems-1),i=-oe/2,r=oe/2;Pe("Generating map...");const s=Math.min(.08,Math.sqrt(Math.PI/t.config.numSystems));for(let h=i;h<r;h+=n){const c=Math.asin(h/(oe/2))*(180/Math.PI),v=[Math.random()*360-180,c],M=dg(v),A=Dl(e.world,M.location);if(A){if(xi(v,A.location)<s){h-=n;continue}Vr(e.world,M,A)}Ll(e.world,M)}const o=Array.from(e.world.systemMap.values()),a=[o[o.length-1]];for(let h=o.length-2;h>=0;h--){const c=o[h],f=Ts(c.location,a);f&&Vr(e.world,c,f),a.push(c)}qi(e.world),Pe(`Generated ${e.world.systemMap.size} systems and ${e.world.laneMap.size} lanes.`);const l=[...o],u=Math.max(hc*t.config.numSystems,qn+t.config.numBots);for(let h=0;h<u&&l.length!==0;h++){const c=Math.floor(Math.random()*l.length);if(c===0){h--;continue}const f=l[c];f.ownerId=null,f.type="INHABITED",f.ships=Aa+Math.floor(Math.random()*10),f.homeworld=null,l.splice(c,1)}}function fg(e,t){const n=Array.from(e.world.systemMap.values()).filter(s=>!s.ownerId&&s.type==="INHABITED");if(n.length===0)throw"No available homeworlds to join.";const i=Math.floor(Math.random()*n.length),r=n[i];return r.ships=1,r.ownerId=r.homeworld=t,r.type="INHABITED",r}function dg(e){return{id:"s"+hg(),type:"UNINHABITED",location:e,ownerId:null,ships:0,homeworld:null,moveQueue:[],lastMove:null,movement:[0,0]}}function pg(e){const t=Ns();return ru({...e,S:t}),t}const gg=Object.freeze(Object.defineProperty({__proto__:null,addLane:Vr,addPlayer:Bl,addSystem:Ll,assignSystem:fg,buildNeighborMap:qi,checkVictory:Np,createWorld:Hi,defaultConfig:zl,doQueuedMoves:Xl,eliminatePlayer:ql,findClosestSystem:Dl,findClosestSystemInList:Ts,gameTick:Cp,generateMap:ru,getAdjacentSystems:mt,getPlayersHomeworld:Cs,hasLane:Gi,initalState:Ns,moveShips:Hl,orderToMove:Kl,queueMove:Ul,revealAllSystems:Fl,roundUpdate:Wl,setup:pg,takeOrder:Sp,turnUpdate:jl,updateStats:Vl,visitSystem:Xi,worldFromJson:wp,worldToJson:_p},Symbol.toStringTag,{value:"Module"})),it={all:new Set,last:null};function de(){it.all.clear(),it.last=null}function mn(e){it.all.add(e),it.last=e}function mg(e){it.all.clear(),it.all.add(e),it.last=e}function yg(e){it.all.delete(e),it.last===e&&(it.last=null)}function su(e){return it.all.has(e)}function vg(e){su(e)?yg(e):mn(e)}function wg({S:e,C:t},n){if(it.last==null)return;const i=[[it.last]],r=new Set;for(r.add(it.last);i.length>0;){const s=i.shift(),o=s[s.length-1];if(o===n){s.forEach(a=>it.all.add(a)),it.last=n;return}for(const a of mt(e.world,o))!r.has(a.id)&&a.ownerId===t.playerId&&(r.add(a.id),i.push([...s,a.id]))}}function oa(e,t){const{S:n,C:i}=globalThis.gameManager.getFnContext();if(i.status==="PLAYING")switch(e.button){case 0:break;case 2:{let r=n.world.systemMap.get(t.fromId),s=n.world.systemMap.get(t.toId);if(r.ownerId!==i.playerId&&s.ownerId!==i.playerId)return;if(r.ownerId!==i.playerId){const o=r;r=s,s=o}else if(r.ownerId===r.ownerId&&s.ships>r.ships){const o=r;r=s,s=o}if(_g(r.id,s.id),s.ownerId!==i.playerId)return;e.altKey||(!e.ctrlKey&&!e.shiftKey&&de(),mn(r.id),s.ownerId===i.playerId&&mn(s.id));break}}}function Ii(e,t){const n=globalThis.gameManager.getFnContext();if(n.C.status==="PLAYING")switch(Ta&&e.altKey&&(Pe(""+t.id,t.lastMove?.message??"none",t.lastMove?.ships??0),console.log(t)),e.button){case 0:if(t.ownerId!==n.C.playerId)return;e.ctrlKey||e.metaKey?vg(t.id):e.shiftKey?wg(n,t.id):mg(t.id);break;case-1:case 2:{const i=Array.from(it.all);if(i.length===0)return;i.forEach(r=>{xg(r,t.id),t.ownerId===n.C.playerId&&(e.altKey||(!e.ctrlKey&&!e.shiftKey&&de(),mn(t.id)))});break}}}function _g(e,t){const{S:n,E:i,C:r}=globalThis.gameManager.getFnContext();if(!Gi(n.world,e,t))return;const s={type:"BALANCED_MOVE",message:`Balanced move from ${e} to ${t}`,toId:t,fromId:e,playerId:r.playerId};i.emit("TAKE_ORDER",s)}function xg(e,t){const{S:n,E:i,C:r}=globalThis.gameManager.getFnContext();if(!Gi(n.world,e,t))return;const s={type:"MASS_MOVE",toId:t,fromId:e,playerId:r.playerId,message:`Mass move from ${e} to ${t}`};i.emit("TAKE_ORDER",s)}let ou=0;const Ti=[];function bg(){ou=0,Ti.length=0;const{E:e}=globalThis.gameManager.getFnContext();e.emit("MESSAGES_UPDATED",{messages:Ti})}function Un(e){const{C:t,E:n}=globalThis.gameManager.getFnContext();Ti.push({id:ou++,message:e,tick:t.tick}),n.emit("MESSAGES_UPDATED",{messages:Ti})}const Rs=Math.PI,aa=Rs/2,la=180/Rs,ua=Rs/180,Mg=Math.atan2,ca=Math.cos,Sg=Math.max,$g=Math.min,ha=Math.sin,Eg=Math.sign||function(e){return e>0?1:e<0?-1:0},au=Math.sqrt;function Ag(e){return e>1?aa:e<-1?-aa:Math.asin(e)}function lu(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function yt(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Ni(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]}function Ci(e){var t=au(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]}function Ls(e){return[Mg(e[1],e[0])*la,Ag(Sg(-1,$g(1,e[2])))*la]}function Ht(e){const t=e[0]*ua,n=e[1]*ua,i=ca(n);return[i*ca(t),i*ha(t),ha(n)]}function Ds(e){return e=e.map(t=>Ht(t)),lu(e[0],yt(e[2],e[1]))}function Ig(e){const t=Ng(e),n=Pg(t),i=Cg(n,e),r=Og(n,e.length),s=Tg(r,e),o=kg(n,e),{polygons:a,centers:l}=Rg(o,n,e),u=Lg(a),h=zg(n,e),c=Dg(i,n);return{delaunay:t,edges:i,triangles:n,centers:l,neighbors:r,polygons:a,mesh:u,hull:h,urquhart:c,find:s}}function Tg(e,t){function n(i,r){let s=i[0]-r[0],o=i[1]-r[1],a=i[2]-r[2];return s*s+o*o+a*a}return function(r,s,o){o===void 0&&(o=0);let a,l,u=o;const h=Ht([r,s]);do a=o,o=null,l=n(h,Ht(t[a])),e[a].forEach(c=>{let f=n(h,Ht(t[c]));if(f<l){l=f,o=c,u=c;return}});while(o!==null);return u}}function Ng(e){if(e.length<2)return{};let t=0;for(;isNaN(e[t][0]+e[t][1])&&t++<e.length;);const n=_i(e[t]),i=kl().translate([0,0]).scale(1).rotate(n.invert([180,0]));e=e.map(i);const r=[];let s=1;for(let c=0,f=e.length;c<f;c++){let v=e[c][0]**2+e[c][1]**2;!isFinite(v)||v>1e32?r.push(c):v>s&&(s=v)}const o=1e6*au(s);r.forEach(c=>e[c]=[o,0]),e.push([0,o]),e.push([-o,0]),e.push([0,-o]);const a=_s.from(e);a.projection=i;const{triangles:l,halfedges:u,inedges:h}=a;for(let c=0,f=u.length;c<f;c++)if(u[c]<0){const v=c%3==2?c-2:c+1,M=c%3==0?c+2:c-1,A=u[v],N=u[M];u[A]=N,u[N]=A,u[v]=u[M]=-1,l[c]=l[v]=l[M]=t,h[l[A]]=A%3==0?A+2:A-1,h[l[N]]=N%3==0?N+2:N-1,c+=2-c%3}else l[c]>e.length-3-1&&(l[c]=t);return a}function Cg(e,t){const n=new Set;return t.length===2?[[0,1]]:(e.forEach(i=>{if(i[0]!==i[1]&&!(Ds(i.map(r=>t[r]))<0))for(let r=0,s;r<3;r++)s=(r+1)%3,n.add(Na([i[r],i[s]]).join("-"))}),Array.from(n,i=>i.split("-").map(Number)))}function Pg(e){const{triangles:t}=e;if(!t)return[];const n=[];for(let i=0,r=t.length/3;i<r;i++){const s=t[3*i],o=t[3*i+1],a=t[3*i+2];s!==o&&o!==a&&n.push([s,a,o])}return n}function kg(e,t){return e.map(n=>{const i=n.map(s=>t[s]).map(Ht),r=Ni(Ni(yt(i[1],i[0]),yt(i[2],i[1])),yt(i[0],i[2]));return Ls(Ci(r))})}function Og(e,t){const n=[];return e.forEach(i=>{for(let r=0;r<3;r++){const s=i[r],o=i[(r+1)%3];n[s]=n[s]||[],n[s].push(o)}}),e.length===0&&(t===2?(n[0]=[1],n[1]=[0]):t===1&&(n[0]=[])),n}function Rg(e,t,n){const i=[],r=e.slice();if(t.length===0){if(n.length<2)return{polygons:i,centers:r};if(n.length===2){const a=Ht(n[0]),l=Ht(n[1]),u=Ci(Ni(a,l)),h=Ci(yt(a,l)),c=yt(u,h),f=[u,yt(u,c),yt(yt(u,c),c),yt(yt(yt(u,c),c),c)].map(Ls).map(o);return i.push(f),i.push(f.slice().reverse()),{polygons:i,centers:r}}}t.forEach((a,l)=>{for(let u=0;u<3;u++){const h=a[u],c=a[(u+1)%3],f=a[(u+2)%3];i[h]=i[h]||[],i[h].push([c,f,l,[h,c,f]])}});const s=i.map(a=>{const l=[a[0][2]];let u=a[0][1];for(let h=1;h<a.length;h++)for(let c=0;c<a.length;c++)if(a[c][0]==u){u=a[c][1],l.push(a[c][2]);break}if(l.length>2)return l;if(l.length==2){const h=fa(n[a[0][3][0]],n[a[0][3][1]],r[l[0]]),c=fa(n[a[0][3][2]],n[a[0][3][0]],r[l[0]]),f=o(h),v=o(c);return[l[0],v,l[1],f]}});function o(a){let l=-1;return r.slice(t.length,1/0).forEach((u,h)=>{u[0]===a[0]&&u[1]===a[1]&&(l=h+t.length)}),l<0&&(l=r.length,r.push(a)),l}return{polygons:s,centers:r}}function fa(e,t,n){e=Ht(e),t=Ht(t),n=Ht(n);const i=Eg(lu(yt(t,e),n));return Ls(Ci(Ni(e,t)).map(r=>i*r))}function Lg(e){const t=[];return e.forEach(n=>{if(!n)return;let i=n[n.length-1];for(let r of n)r>i&&t.push([i,r]),i=r}),t}function Dg(e,t){return function(n){const i=new Map,r=new Map;return e.forEach((s,o)=>{const a=s.join("-");i.set(a,n[o]),r.set(a,!0)}),t.forEach(s=>{let o=0,a=-1;for(let l=0;l<3;l++){let u=Na([s[l],s[(l+1)%3]]).join("-");i.get(u)>o&&(o=i.get(u),a=u)}r.set(a,!1)}),e.map(s=>r.get(s.join("-")))}}function zg(e,t){const n=new Set,i=[];e.map(a=>{if(!(Ds(a.map(l=>t[l>t.length?0:l]))>1e-12))for(let l=0;l<3;l++){let u=[a[l],a[(l+1)%3]],h=`${u[0]}-${u[1]}`;n.has(h)?n.delete(h):n.add(`${u[1]}-${u[0]}`)}});const r=new Map;let s;if(n.forEach(a=>{a=a.split("-").map(Number),r.set(a[0],a[1]),s=a[0]}),s===void 0)return i;let o=s;do{i.push(o);let a=r.get(o);r.set(o,-1),o=a}while(o>-1&&o!==s);return i}function Bg(e){const t=function(n){if(t.delaunay=null,t._data=n,typeof t._data=="object"&&t._data.type==="FeatureCollection"&&(t._data=t._data.features),typeof t._data=="object"){const i=t._data.map(r=>[t._vx(r),t._vy(r),r]).filter(r=>isFinite(r[0]+r[1]));t.points=i.map(r=>[r[0],r[1]]),t.valid=i.map(r=>r[2]),t.delaunay=Ig(t.points)}return t};return t._vx=function(n){if(typeof n=="object"&&"type"in n)return ko(n)[0];if(0 in n)return n[0]},t._vy=function(n){if(typeof n=="object"&&"type"in n)return ko(n)[1];if(1 in n)return n[1]},t.x=function(n){return n?(t._vx=n,t):t._vx},t.y=function(n){return n?(t._vy=n,t):t._vy},t.polygons=function(n){if(n!==void 0&&t(n),!t.delaunay)return!1;const i={type:"FeatureCollection",features:[]};return t.valid.length===0||(t.delaunay.polygons.forEach((r,s)=>i.features.push({type:"Feature",geometry:r?{type:"Polygon",coordinates:[[...r,r[0]].map(o=>t.delaunay.centers[o])]}:null,properties:{site:t.valid[s],sitecoordinates:t.points[s],neighbours:t.delaunay.neighbors[s]}})),t.valid.length===1&&i.features.push({type:"Feature",geometry:{type:"Sphere"},properties:{site:t.valid[0],sitecoordinates:t.points[0],neighbours:[]}})),i},t.triangles=function(n){return n!==void 0&&t(n),t.delaunay?{type:"FeatureCollection",features:t.delaunay.triangles.map((i,r)=>(i=i.map(s=>t.points[s]),i.center=t.delaunay.centers[r],i)).filter(i=>Ds(i)>0).map(i=>({type:"Feature",properties:{circumcenter:i.center},geometry:{type:"Polygon",coordinates:[[...i,i[0]]]}}))}:!1},t.links=function(n){if(n!==void 0&&t(n),!t.delaunay)return!1;const i=t.delaunay.edges.map(s=>xi(t.points[s[0]],t.points[s[1]])),r=t.delaunay.urquhart(i);return{type:"FeatureCollection",features:t.delaunay.edges.map((s,o)=>({type:"Feature",properties:{source:t.valid[s[0]],target:t.valid[s[1]],length:i[o],urquhart:!!r[o]},geometry:{type:"LineString",coordinates:[t.points[s[0]],t.points[s[1]]]}}))}},t.mesh=function(n){return n!==void 0&&t(n),t.delaunay?{type:"MultiLineString",coordinates:t.delaunay.edges.map(i=>[t.points[i[0]],t.points[i[1]]])}:!1},t.cellMesh=function(n){if(n!==void 0&&t(n),!t.delaunay)return!1;const{centers:i,polygons:r}=t.delaunay,s=[];for(const o of r)if(o)for(let a=o.length,l=o[a-1],u=o[0],h=0;h<a;l=u,u=o[++h])u>l&&s.push([i[l],i[u]]);return{type:"MultiLineString",coordinates:s}},t._found=void 0,t.find=function(n,i,r){if(t._found=t.delaunay.find(n,i,t._found),!r||xi([n,i],t.points[t._found])<r)return t._found},t.hull=function(n){n!==void 0&&t(n);const i=t.delaunay.hull,r=t.points;return i.length===0?null:{type:"Polygon",coordinates:[[...i.map(s=>r[s]),r[i[0]]]]}},e?t(e):t}const uu=Math.acos,Fg=Math.asin,da=Math.atan2,pe=Math.cos,pa=Math.hypot,Qr=Math.max,Zr=Math.min,cu=Math.PI,ge=Math.sin,sn=cu/180,fr=180/cu;class It{static fromCartesian([t,n,i]){return[0,i,-n,t]}static fromAngles([t,n,i]){t*=sn/2,n*=sn/2,i=(i||0)*sn/2;const r=ge(t),s=pe(t),o=ge(n),a=pe(n),l=ge(i),u=pe(i);return[s*a*u+r*o*l,r*a*u-s*o*l,s*o*u+r*a*l,s*a*l-r*o*u]}static toAngles([t,n,i,r]){return[da(2*(t*n+i*r),1-2*(n*n+i*i))*fr,Fg(Qr(-1,Zr(1,2*(t*i-r*n))))*fr,da(2*(t*r+n*i),1-2*(i*i+r*r))*fr]}static interpolateAngles(t,n){const i=It.interpolate(It.fromAngles(t),It.fromAngles(n));return r=>It.toAngles(i(r))}static interpolateLinear([t,n,i,r],[s,o,a,l]){s-=t,o-=n,a-=i,l-=r;const u=new Array(4);return h=>{const c=pa(u[0]=t+s*h,u[1]=n+o*h,u[2]=i+a*h,u[3]=r+l*h);return u[0]/=c,u[1]/=c,u[2]/=c,u[3]/=c,u}}static interpolate([t,n,i,r],[s,o,a,l]){let u=It.dot([t,n,i,r],[s,o,a,l]);if(u<0&&(s=-s,o=-o,a=-a,l=-l,u=-u),u>.9995)return It.interpolateLinear([t,n,i,r],[s,o,a,l]);const h=uu(Qr(-1,Zr(1,u))),c=new Array(4),f=pa(s-=t*u,o-=n*u,a-=i*u,l-=r*u);return s/=f,o/=f,a/=f,l/=f,v=>{const M=h*v,A=ge(M),N=pe(M);return c[0]=t*N+s*A,c[1]=n*N+o*A,c[2]=i*N+a*A,c[3]=r*N+l*A,c}}static dot([t,n,i,r],[s,o,a,l]){return t*s+n*o+i*a+r*l}static multiply([t,n,i,r],[s,o,a,l]){return[t*s-n*o-i*a-r*l,t*o+n*s+i*l-r*a,t*a-n*l+i*s+r*o,t*l+n*a-i*o+r*s]}}const St=It.fromAngles;St.multiply=It.multiply;St.rotation=It.toAngles;St.interpolate=It.interpolateAngles;St.cartesian=function(e){const t=e[0]*sn,n=e[1]*sn,i=pe(n);return[i*pe(t),i*ge(t),ge(n)]};St.delta=function(e,t,n){arguments.length==2&&(n=1);const i=Math.sqrt;function r(h,c){return[h[1]*c[2]-h[2]*c[1],h[2]*c[0]-h[0]*c[2],h[0]*c[1]-h[1]*c[0]]}function s(h,c){return h[0]*c[0]+h[1]*c[1]+h[2]*c[2]}const o=r(e,t),a=i(s(o,o));if(!a)return[1,0,0,0];const l=n*uu(Qr(-1,Zr(1,s(e,t))))/2,u=ge(l);return[pe(l),o[2]/a*u,-o[1]/a*u,o[0]/a*u]};const ga=.5,Ug=.25,Hg=100,qg=20,Gg=bs(".3~s"),ze={Orthographic:cp,Stereographic:kl,Mercator:up,TransverseMercator:hp};let Jr,Tt,Be=ze[nc],J=Be().translate([0,0]),te=J.scale(),Yi=Ss().projection(J),Qn;const Xg=Bg().x(e=>e.location[0]).y(e=>e.location[1]);function Yg(){const e=Object.keys(ze),n=(e.findIndex(i=>ze[i]===Be)+1)%e.length;Kg(e[n])}function Kg(e){Be=ze[e],J=Be(),J.translate([0,0]).rotate([0,0,0]).scale(te),te=J.scale(),Yi=Ss().projection(J)}function Me(e){const t=J.rotate();t[0]+=e[0],t[1]+=e[1],e.length===3&&(t[2]+=e[2]),J.rotate(t)}function Vg(e,t){Jr=Nt(e),Tt=Jr.select("svg"),Tt.attr("width","100vw").attr("height","100vh").attr("viewBox",`-${ei/2} -${oe/2} ${ei} ${oe}`).on("contextmenu",o=>o.preventDefault()),ts(t.S),fu(t),du(t),hu(t),Tt.call(n()),Tt.call(i()),window.addEventListener("resize",s);function n(){return r().on("drag.render",()=>j()).on("end.render",()=>j())}function i(){return vp().filter(o=>o.type==="wheel").on("zoom",o=>{if(o.transform.k>ga){const a=te*o.transform.k;J.scale(a),j()}else o.transform.k=ga})}function r(){let o,a,l,u,h;function c(A,N){const I=Zh(A,N);if(I.length!==h&&(h=I.length,h>1&&(u=Math.atan2(I[1][1]-I[0][1],I[1][0]-I[0][0])),f.apply(N,[A,N])),h>1){const E=Zs(I,k=>k[0]),P=Zs(I,k=>k[1]),C=Math.atan2(I[1][1]-I[0][1],I[1][0]-I[0][0]);return[E,P,C]}return I[0]}function f({x:A,y:N}){const I=M([A,N]);o=St.cartesian(J.invert(I)),l=J.rotate(),a=St(l)}function v(A){const N=M([A.x,A.y]),I=St.cartesian(J.rotate(l).invert(N)),E=St.delta(o,I);let P=St.multiply(a,E);const C=c(A,this);if(C[2]){const k=(C[2]-u)/2,O=-Math.sin(k),D=Math.sign(Math.cos(k));P=St.multiply([Math.sqrt(1-O*O),0,0,D*O],P)}J.rotate(St.rotation(P)),E[0]<.7&&f.apply(this,[A,this])}function M(A){const N=parseInt(Tt.style("width")),I=parseInt(Tt.style("height"));return[A[0]-N/2,A[1]-I/2]}return sf().filter(A=>A.button===1||A.touches).on("start",f).on("drag",v)}function s(){ts(globalThis.gameManager.getState())}}function ts(e){const t=Tt.node()?.getBoundingClientRect(),n=window.devicePixelRatio||1,i=t?.height||oe,r=t?.width||ei,a=Jr.selectAll("canvas").data([null]).join(h=>h.append("canvas").style("position","absolute").style("top",0).style("left",0).style("z-index",-1).style("pointer-events","none")).attr("width",r*n).attr("height",i*n).style("width",`${r}px`).style("height",`${i}px`).node().getContext("2d");a.setTransform(1,0,0,1,0,0),a.scale(n,n),a.translate(r/2,i/2);const l=Math.min(r/ei,i/oe);a.scale(l,l);const u="#FFFFFF48";if(Be===ze.Orthographic){const h=J.scale();a.strokeStyle=u,a.lineWidth=1,a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=10,a.shadowColor=u,a.beginPath(),a.arc(0,0,h,0,Math.PI*2),a.stroke(),a.fill()}{a.shadowBlur=0,a.strokeStyle="rgba(51, 51, 51, 0.5)";const h=jg(e),c=Ss().projection(J).context(a);a.beginPath(),c(h),a.stroke()}}function jg(e){const t=Ud(),n=Cs(e);if(n){if(!Qn){const i=_i([0,90+n.location[1],0]),r=_i([n.location[0],0,0]);Qn={type:"FeatureCollection",features:t.lines().map(s=>({type:"Feature",geometry:{type:"LineString",coordinates:s.coordinates.map(o=>r(i(o)))}}))}}return Qn}return t()}function ma(e){const t=J.scale()*e;t<te*Ug||t>te*Hg||(J.scale(t),j())}function es(){const e=globalThis.gameManager.getState(),t=Cs(e);if(!t)return;Qn=null;const n=t.location;Be===ze.Orthographic?ns([n[0],n[1]-45]):ns(n),J.scale(te)}function Wg(e){const n=globalThis.gameManager.getState().world.systemMap.get(e);n&&(ns(n.location),J.scale(te))}function ns(e){J.rotate([-e[0],-e[1],0]),j()}let ya=null;function j(){return cancelAnimationFrame(ya),ya=requestAnimationFrame(()=>e());function e(t){Tt&&(t??=globalThis.gameManager.getFnContext(),fu(t),ts(t.S),hu(t),du(t))}}function hu({S:e,C:t,P:n}){const r=J.scale()/te<1;let s=e.world.systemMap.values();n&&t.config.fow&&(s=n.revealedSystems.values().map(l=>e.world.systemMap.get(l))),s=s.filter(l=>!!Yi({type:"Point",coordinates:l.location}));const a=Tt.selectAll("g#systems").data([null]).join(l=>l.append("g").attr("id","systems")).classed("reduced-size",r).classed("hidden",!1).selectAll(".system").data(s,l=>l.id).join(l=>{const u=l.append("g").attr("class","system").attr("id",h=>h.id).on("click",(h,c)=>{Ii(h,c),j()}).on("contextmenu",(h,c)=>{h.preventDefault(),Ii(h,c),j()});return u.append("circle").attr("class","system-outline").attr("cx",0).attr("cy",0).attr("r",qg/2),u.append("text").attr("class","ship-count").attr("y",-10).attr("x",0).attr("text-anchor","start"),u.append("text").attr("class","system-icon").attr("y",0).attr("x",0).attr("text-anchor","end"),u});a.style("--owner-color",l=>e.playerMap.get(l.ownerId)?.color??null).classed("own",l=>l.ownerId===t.playerId).classed("selected",l=>su(l.id)).classed("moved",l=>l.movement[0]>0||l.movement[1]>0).classed("inhabited",l=>l.type==="INHABITED").classed("homeworld",l=>!!l.homeworld&&l.ownerId===l.homeworld).classed("visited",l=>n?n.visitedSystems.has(l.id):!0).attr("transform",l=>`translate(${J(l.location)})`),a.select(".system-icon").text(l=>l.homeworld&&l.ownerId===l.homeworld?"":l.type==="INHABITED"?"":""),a.select(".ship-count").text(l=>r?"":(l.type==="INHABITED"?"":"")+(l.ships?Gg(l.ships):""))}const Qg=(()=>{let e=[],t;return n=>{if(!e||t!==n.world.systemMap){t=n.world.systemMap;const i=Array.from(t.values());e=Xg.polygons(i).features}return e}})();function fu({S:e,C:t,P:n}){const r=J.scale()/te<1;let s=Qg(e);n&&t.config.fow&&(s=s.filter(l=>{const u=l.properties?.site;return n.revealedSystems.has(u.id)})),Tt.selectAll("g#mesh").data([null]).join(l=>l.append("g").attr("id","mesh")).classed("reduced-size",r).classed("hidden",!1).selectAll("path").data(s).join(l=>l.append("path").classed("region",!0).on("click",(u,h)=>{Ii(u,h),j()}).on("contextmenu",(u,h)=>{u.preventDefault(),Ii(u,h),j()})).attr("d",l=>Yi(l)).datum(l=>l.properties.site).classed("visited",l=>n?n.visitedSystems.has(l.id):!0).style("--owner-color",l=>e.playerMap.get(l.ownerId)?.color??null)}function du({S:e,C:t,P:n}){let i=e.world.laneMap.values();n&&t.config.fow&&(i=i.filter(o=>n.revealedSystems.has(o.fromId)&&n.revealedSystems.has(o.toId)));const s=Tt.selectAll("g#lanes").data([null]).join(o=>o.append("g").attr("id","lanes")).selectAll("g.lane-group").data(i,o=>o.id).join(o=>{const a=o.append("g").attr("class","lane-group").attr("id",l=>l.id).on("click",(l,u)=>{oa(l,u),j()}).on("contextmenu",(l,u)=>{l.preventDefault(),oa(l,u),j()});return a.append("path").attr("class","lane"),a.append("path").attr("class","pulse"),a}).datum(o=>{const a=e.world.systemMap.get(o.toId),l=e.world.systemMap.get(o.fromId),u=Yi({type:"LineString",coordinates:[l.location,a.location]});return{...o,from:e.world.systemMap.get(o.fromId),to:e.world.systemMap.get(o.toId),path:u}});s.style("--owner-color",o=>{const a=o.from;if(!a.ownerId)return null;const l=o.to;return!l.ownerId||a.ownerId!==l.ownerId?null:e.playerMap.get(a.ownerId)?.color??null}),s.select("path.lane").attr("d",o=>o.path).classed("own",o=>{const a=o.from,l=o.to;return a.ownerId===t.playerId||l.ownerId===t.playerId}).style("--path-length",o=>{const a=Nt(`#${o.id} .lane`).node();return a?a.getTotalLength():200}),s.select("path.pulse").attr("d",o=>o.path).classed("moved",o=>o.movement[0]>0||o.movement[1]>0).style("stroke-width",o=>{if(o.movement[0]===0&&o.movement[1]===0)return null;const a=2,l=Math.floor(Math.log2(Math.max(o.movement[0],o.movement[1])));return`${(a+l)*2}px`}).classed("moved--fwd",o=>o.movement[0]>o.movement[1]).classed("moved--bak",o=>o.movement[1]>o.movement[0])}class Zg{constructor(){this.listeners={}}on(t,n){return this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(n),()=>{this.listeners[t]=this.listeners[t].filter(i=>i!==n)}}emit(t,n){const i=this.listeners[t];if(i)for(const r of i)try{r(n)}catch(s){console.error(`Error in listener for event ${String(t)}:`,s)}}clear(){this.listeners={}}}class pu{constructor(){this.events=new Zg,this.game=gg,this.state=Ns(),this.config=zl(),this.tick=0,this.status="WAITING",this.runningInterval=null,this.#e()}getState(){return ni?Object.freeze({...this.state}):this.state}getConfig(){return ni?Object.freeze({...this.config}):this.config}async setConfig(t){this.config={...this.config,...t},this.events.emit("CONFIG_UPDATED",{config:this.config})}getPlayer(){return this.state.playerMap.get(this.playerId)??null}getContext(){return{tick:this.tick,status:this.status,playerId:this.playerId,config:this.getConfig()}}getFnContext(){return{S:this.state,E:this.events,P:this.state.playerMap.get(this.playerId),C:this.getContext()}}addPlayer(t){if(this.state.playerMap.has(t.id))return this.state.playerMap.get(t.id);const n=t.score??{userId:t.id,playerName:t.name??`Player ${this.state.playerMap.size+1}`,score:0,tick:0,timestamp:Date.now()},i={name:t.name??`Player ${this.state.playerMap.size+1}`,score:n,color:"#000000",...t,stats:{playerId:t.id,systems:0,ships:0,homeworld:0},isAlive:!0,visitedSystems:new Set,revealedSystems:new Set};return Bl(this.state,i),i}gameStart(){this.status="PLAYING",this.tick=0,this.events.emit("GAME_START",void 0),this.#t()}gameStop(){this.status="FINISHED",this.stopGameLoop()}gameTick(){this.tick++,this.game.gameTick(this.getFnContext()),this.game.checkVictory(this.getFnContext()),this.events.emit("STATE_UPDATED",{state:this.state,status:this.status})}#t(){if(this.status!=="PLAYING"){this.gameStop();return}this.stopGameLoop(),this.gameTick(),this.events.emit("GAME_TICK",{tick:this.tick}),this.runningInterval=setTimeout(()=>this.#t(),ic/this.config.timeScale)}startGameLoop(){this.#t()}stopGameLoop(){this.runningInterval&&(clearTimeout(this.runningInterval),this.runningInterval=null)}#e(){this.events.on("GAME_STOP",()=>{this.gameStop()}),this.events.on("TAKE_ORDER",t=>{this.game.takeOrder(this.getFnContext(),t),this.events.emit("STATE_UPDATED",{state:this.state,status:this.status})})}}const Ki=pu,Jg=Symbol("config"),gu=Symbol("state"),tm=Symbol("player"),em=Symbol("context"),nm=`
<dialog id="helpDialog">
  <article>
    <h2>Introduction</h2>

    <p>
      This is a simple strategy game where you control a number of star
      systems and try to conquer the the Bubble. The Bubble is a cluster of
      star systems connected by hyperspace lanes. You start with one system
      and must expand your control by sending ships to capture other systems.
    </p>

    <h3>Gameplay</h3>
    <ul>
      <li>The game is played in real-time, with each turn lasting 1 second.</li>
      <li>You begin the game controlling one system, your homeworld.</li>
      <li>Each turn, your homeworld and any other inhabited systems you control, will produce an additional ship.
      </li>
      <li>You can send these ships to other systems to capture them.</li>
      <li>Each controlled system receives an additional ship each 25 turns.</li>
      <li>To transfer ships, left click on a system you control and then right click on a target system.</li>
      <li>This will send all available ships, less one, from the source system to the target system.</li>
      <li>Right click on the hyperspace lane between the systems to send half of the available ships.</li>
      <li>If the target system is uninhabited, you will capture it automatically.</li>
      <li>If the target system is controlled by another player, a battle will ensue.</li>
      <li>The player with the most ships on the target system after all ships have arrived will take control of the
        system.</li>
    </ul>
    <h3>Objective</h3>
    <p>
      The goal is to eliminate all other player's homeworlds and control the
      entire Bubble.
    </p>

    <p>
      <a href="https://github.com/Hypercubed/starz">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" stroke="currentColor"
          fill="currentColor" width="24" height="24" viewBox="0 0 24 24">
          <path
            d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z">
          </path>
        </svg>
      </a>
    </p>

    <form method="dialog">
      <button>Exit</button>
    </form>
  </article>
</dialog>
<dialog id="optionsDialog">
  <form id="optionsForm" method="dialog">
    <label for="numBotsInput">
      Number of Bots

      <div class="btn-group" data-toggle="buttons" role="group">
        <label role="button" class="btn btn-primary">
          <input type="radio" name="numBots" id="option1" value="0">
          None
        </label>
        <label role="button" class="btn btn-primary">
          <input type="radio" name="numBots" id="option2" value="1">
          1
        </label>
        <label role="button" class="btn btn-primary">
          <input type="radio" name="numBots" id="option2" value="1">
          2
        </label>
        <label role="button" class="btn btn-primary">
          <input type="radio" name="numBots" id="option3" value="4" checked>
          4
        </label>
        <label role="button" class="btn btn-primary">
          <input type="radio" name="numBots" id="option3" value="8">
          8
        </label>
      </div>

    </label>

    <label for="fowInput">
      Fog of War
      <input name="fow" type="checkbox" role="switch" checked />
    </label>

    <label for="numSystemsInput">
      Bubble Size
      <input name="numSystems" min="0" max="4" step="1" type="range" list="steplist">
      <datalist id="steplist">
        <option value="48">Tiny</option>
        <option value="96"></option>
        <option value="192">Med</option>
        <option value="384"></option>
        <option value="768">Large</option>
      </datalist>
    </label>

    <p />&nbsp;
    <p />
    <button id="optionsOkButton">OK</button>
    <button id="optionsCancelButton" type="reset">Reset</button>
  </form>
</dialog>`;var im=Object.defineProperty,rm=Object.getOwnPropertyDescriptor,mu=e=>{throw TypeError(e)},ee=(e,t,n,i)=>{for(var r=i>1?void 0:i?rm(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(r=(i?o(t,n,r):o(r))||r);return i&&r&&im(t,n,r),r},sm=(e,t,n)=>t.has(e)||mu("Cannot "+n),om=(e,t,n)=>t.has(e)?mu("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),va=(e,t,n)=>(sm(e,t,"access private method"),n),Zn,yu,vu;const Se=5;let qt=class extends Ft{constructor(){super(...arguments),om(this,Zn)}connectedCallback(){super.connectedCallback(),va(this,Zn,yu).call(this),va(this,Zn,vu).call(this)}createRenderRoot(){return this}render(){return Et`
      <dialog id="startDialog" closedby="none">
        <start-dialog-content
          @startClicked=${this.onStart}
        ></start-dialog-content>
      </dialog>
      <dialog id="endDialog">
        <p id="endMessage"></p>
        <form method="dialog">
          <button id="restartButton">Yes</button>
        </form>
      </dialog>
      ${ds(nm)}
      <game-canvas id="app"></game-canvas>
      <tick-box id="tickBox" tick="${this.context?.tick}"></tick-box>
      <leaderboard-element #leaderbox></leaderboard-element>
      <message-box id="messagebox"></message-box>
      <button id="helpButton" @click=${this.showHelp}>?</button>
    `}showStartDialog(){this.startDialog?.showModal()}onStart(){this.startDialog.close(),this.gameManager.start()}async onKeyup(e){switch(e.key){case"?":this.showHelp();return;case"Escape":de(),j();return;case"x":{if(!e.ctrlKey)return;this.gameManager.quit();return}}if(Ta&&e.altKey){e.preventDefault();const{S:t,C:n}=globalThis.gameManager.getFnContext();switch(e.code){case"KeyC":for(const i of t.world.systemMap.values())i.ownerId===n.playerId&&(i.ships*=2);j();return;case"KeyR":Fl(t),j();return;case"NumpadAdd":case"Equal":{const i=Math.min(16,n.config.timeScale*2);globalThis.gameManager.setConfig({timeScale:i}),Pe(`Time scale increased to ${n.config.timeScale}x`);return}case"NumpadSubtract":case"Minus":{const i=Math.max(.25,n.config.timeScale/2);globalThis.gameManager.setConfig({timeScale:i}),Pe(`Time scale decreased to ${n.config.timeScale}x`);return}}}}async onKeypress(e){switch(e.code){case"Space":"pauseToggle"in globalThis.gameManager&&globalThis.gameManager.pauseToggle();return;case"Equal":case"NumpadAdd":ma(1.2),j();return;case"Minus":case"NumpadSubtract":ma(.8),j();return;case"KeyW":Me([0,Se]),j();return;case"KeyA":Me([-Se,0]),j();return;case"KeyS":Me([0,-Se]),j();return;case"KeyD":Me([Se,0]),j();return;case"KeyQ":Me([0,0,Se]),j();break;case"KeyE":Me([0,0,-Se]),j();break;case"KeyH":es(),j();return;case"KeyC":it.last&&(Wg(it.last),j());return;case"KeyP":Yg(),es(),j();return}}showHelp(){this.helpDialog.showModal()}async showEndGame(e){return this.endDialog.showModal(),this.endDialog.querySelector("p#endMessage").textContent=e,new Promise(t=>{this.endDialog.addEventListener("close",()=>t(!0)),this.endDialog.addEventListener("cancel",()=>t(!1))})}};Zn=new WeakSet;yu=function(){window.document.addEventListener("keyup",e=>this.onKeyup(e)),window.document.addEventListener("keypress",e=>this.onKeypress(e))};vu=function(){this.config=this.gameManager.getConfig(),this.state=this.gameManager.getState(),this.player=this.gameManager.getPlayer(),this.context=this.gameManager.getContext(),this.gameManager.events.on("GAME_INIT",()=>{this.config=this.gameManager.getConfig(),this.state=this.gameManager.getState(),this.player=this.gameManager.getPlayer(),this.context=this.gameManager.getContext()}),this.gameManager.events.on("CONFIG_UPDATED",({config:e})=>{this.config=e,this.player=this.gameManager.getPlayer(),this.context=this.gameManager.getContext()}),this.gameManager.events.on("STATE_UPDATED",({state:e})=>this.state=e),this.gameManager.events.on("GAME_TICK",()=>{this.context=this.gameManager.getContext()})};ee([yn({context:Ki}),fs({attribute:!1})],qt.prototype,"gameManager",2);ee([yn({context:Jg}),Ot()],qt.prototype,"config",2);ee([yn({context:gu}),Ot()],qt.prototype,"state",2);ee([yn({context:tm}),Ot()],qt.prototype,"player",2);ee([yn({context:em}),Ot()],qt.prototype,"context",2);ee([Li("#helpDialog")],qt.prototype,"helpDialog",2);ee([Li("#startDialog")],qt.prototype,"startDialog",2);ee([Li("#endDialog")],qt.prototype,"endDialog",2);qt=ee([Ue("app-root")],qt);var am=Object.defineProperty,lm=Object.getOwnPropertyDescriptor,wu=(e,t,n,i)=>{for(var r=i>1?void 0:i?lm(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(r=(i?o(t,n,r):o(r))||r);return i&&r&&am(t,n,r),r};const um=bs(".3~s");let is=class extends Ft{createRenderRoot(){return this}render(){return Et`
      <table id="leaderbox">
        ${this.renderHeader()} ${this.renderBody()}
      </table>
    `}renderBody(){const e=Array.from(this.state.playerMap.values()).sort((n,i)=>i.stats.systems-n.stats.systems||i.stats.ships-n.stats.ships),t="";return Et`<tbody>
      ${e.map(n=>Et`<tr
            style="--owner-color: ${n.color||null}"
            title="${n.bot?n.bot.name:"Human"}"
            class="${n.isAlive?"":"eliminated"}"
          >
            <td>${t}${n.name}${t}</td>
            <td>${t}${n.stats.systems}${t}</td>
            <td>${t}${um(n.stats.ships)}${t}</td>
          </tr>`)}
    </tbody>`}renderHeader(){return Et`<thead>
        <tr>
          <th>Player</th>
          <th>Systems</th>
          <th>Ships</th>
        </tr>
      </thead>
      <tbody></tbody>`}};wu([ki({context:gu,subscribe:!0}),Ot()],is.prototype,"state",2);is=wu([Ue("leaderboard-element")],is);var cm=Object.defineProperty,hm=Object.getOwnPropertyDescriptor,_u=(e,t,n,i)=>{for(var r=i>1?void 0:i?hm(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(r=(i?o(t,n,r):o(r))||r);return i&&r&&cm(t,n,r),r};let rs=class extends Ft{constructor(){super(...arguments),this.tick=0}createRenderRoot(){return this}render(){const e=~~(this.tick/2),t=this.tick%2===1?".":"";return Et`${e}${t}`}};_u([fs({type:Number})],rs.prototype,"tick",2);rs=_u([Ue("tick-box")],rs);const fm=`<div class="lore">
  <p>
    Nobody knows why <i>The Bubble</i> exists, or who built the lattice
    of hyperspace lanes threading its hundreds of star systems together
    like a cosmic web. Its discovery was accidental - a distortion
    ripple detected on the edge of settled space, leading explorers to
    the shimmering boundary of a region where physics seemed... wrong.
  </p>
  <p>
    What <i>is</i> known is this: control of <i>The Bubble</i> means
    control of immense resources and power. Rival factions flood its
    systems, each desperate to carve out their claim before somebody
    else does.
  </p>
  <p>
    As a commander, you are the spearhead of your faction's ambitions:
    tasked with expanding your influence, capturing systems, and
    ultimately dominating <i>The Bubble</i>.
  </p>
</div>

<h3>Protect our homeworld. Capture the enemy systems.</h3>`;var dm=Object.defineProperty,pm=Object.getOwnPropertyDescriptor,xu=e=>{throw TypeError(e)},Mn=(e,t,n,i)=>{for(var r=i>1?void 0:i?pm(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(r=(i?o(t,n,r):o(r))||r);return i&&r&&dm(t,n,r),r},gm=(e,t,n)=>t.has(e)||xu("Cannot "+n),mm=(e,t,n)=>t.has(e)?xu("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),ym=(e,t,n)=>(gm(e,t,"access private method"),n),ss,bu;const dr=new Map;function vm(e){if(dr.has(e))return dr.get(e);const t=n(e);return dr.set(e,t),t;function n(i){const r=Array.from(i).reduce((s,o)=>(s<<5)-s+o.charCodeAt(0),0);return Math.abs(r).toString(36).substring(0,4)}}let Fe=class extends Ft{constructor(){super(...arguments),mm(this,ss),this.version=_a,this.keyText="Use this key to restore your player data later.  Click to copy."}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),ym(this,ss,bu).call(this)}render(){const e=vm(this.player?.id??""),t=this.generateToken(this.gameManager.playerToken);return Et`
      <article>
        <h1>STARZ!</h1>
        <small class="version">v${this.version}</small>

        ${ds(fm)}

        <form method="dialog">
          <div class="grid">
            <div>
              <input
                name="playerName"
                id="playerNameInput"
                type="text"
                .value=${this.player?.name??""}
                @keydown="${this.onKeydown}"
                placeholder="Name or Save Key"
                minlength="1"
                maxlength="3000"
                required
              />
              <small>(Name will be used in leaderboard)</small>
            </div>
            <div>
              ${this.player?.name??""} [${e}]
              ${this.player?.score?Et`<span> ${this.player.score.score}</span>`:""}
              <br /><small
                >${this.player?.score?.rank?`Rank: ${this.player.score.rank}`:""}</small
              >
              <small
                data-tooltip="${this.keyText}"
                @click="${()=>this.copyText(t)}"
                style="cursor: copy;"
              >
                ${t?"Token":""}</small
              >
            </div>
          </div>

          <br /><button type="button" @click="${this.onPlay}">
            Start Game
          </button>
          <br /><button type="button" @click="${this.onOptions}">
            Options
          </button>
        </form>
      </article>
    `}async onPlay(){let e=this.playerNameInput.value.trim()||"Anonymous";e=e.substring(0,30),await this.gameManager.setConfig({playerName:e}),this.dispatchEvent(new Event("startClicked"))}async onOptions(){if(await this.showOptions()){const t=document.getElementById("optionsForm"),n=new FormData(t),i=globalThis.gameManager,r=+n.get("numBots"),s=n.get("playerName"),o=n.get("fow")==="on",a=+n.get("numSystems");i.setConfig({numBots:r,playerName:s,fow:o,numSystems:48*2**a})}}showOptions(){const e=document.getElementById("optionsDialog");return e.showModal(),new Promise(t=>{e.addEventListener("close",()=>t(!0)),e.addEventListener("cancel",()=>t(!1))})}onKeydown(e){if(e.key==="Enter"){e.preventDefault();const n=this.querySelector("#playerNameInput").value.trim();this.setName(n)}}async setName(e){await this.gameManager.setConfig({playerName:e}),this.requestUpdate()}generateToken(e){return e?`${this.player?.id}::${e}`:""}async copyText(e){try{await navigator.clipboard.writeText(e),this.keyText="Copied to clipboard!",this.requestUpdate(),setTimeout(()=>{this.keyText="Use this key to restore your player data later.  Click to copy.",this.requestUpdate()},2e3)}catch{}}};ss=new WeakSet;bu=function(){this.player=this.gameManager.getPlayer(),this.gameManager.events.on("CONFIG_UPDATED",()=>{this.player=this.gameManager.getPlayer()}),this.gameManager.events.on("GAME_INIT",()=>{this.player=this.gameManager.getPlayer()})};Mn([ki({context:Ki}),Ot()],Fe.prototype,"gameManager",2);Mn([Ot()],Fe.prototype,"player",2);Mn([Ot()],Fe.prototype,"version",2);Mn([Li("#playerNameInput")],Fe.prototype,"playerNameInput",2);Fe=Mn([Ue("start-dialog-content")],Fe);var wm=Object.defineProperty,_m=Object.getOwnPropertyDescriptor,zs=(e,t,n,i)=>{for(var r=i>1?void 0:i?_m(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(r=(i?o(t,n,r):o(r))||r);return i&&r&&wm(t,n,r),r};let Pi=class extends Ft{constructor(){super(...arguments),this.messages=[]}connectedCallback(){super.connectedCallback(),this.gameManager.events.on("MESSAGES_UPDATED",({messages:e})=>{this.messages=(e??[]).slice(-5)})}createRenderRoot(){return this}render(){return this.messages.length>0?Et`${this.messages.map(e=>{const t=~~(e.tick/2),n=e.tick%2===1?".":"";return Et`<div>
          ${ds(e.message)} <small>${t}${n}</small>
        </div>`})}`:Et``}};zs([ki({context:Ki}),Ot()],Pi.prototype,"gameManager",2);zs([Ot()],Pi.prototype,"messages",2);Pi=zs([Ue("message-box")],Pi);var xm=Object.defineProperty,bm=Object.getOwnPropertyDescriptor,Mu=(e,t,n,i)=>{for(var r=i>1?void 0:i?bm(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(r=(i?o(t,n,r):o(r))||r);return i&&r&&xm(t,n,r),r};let os=class extends Ft{connectedCallback(){super.connectedCallback(),this.gameManager.events.on("GAME_START",()=>{Vg(document.getElementById("app"),this.gameManager.getFnContext())}),this.gameManager.events.on("STATE_UPDATED",()=>{j()}),this.gameManager.events.on("GAME_TICK",()=>{j()})}createRenderRoot(){return this}render(){return Et`
      <canvas></canvas>
      <svg></svg>
    `}};Mu([ki({context:Ki}),Ot()],os.prototype,"gameManager",2);os=Mu([Ue("game-canvas")],os);const wa=Os({length:5});class Mm extends pu{mount(t){this.appRoot=t,this.appRoot.gameManager=this,this.#t()}async connect(){this.gameStop(),this.status="WAITING";const t=await this.initializePlayer();this.thisPlayer=this.addPlayer(t),this.playerId=this.thisPlayer.id,this.events.emit("GAME_INIT",void 0),this.appRoot.showStartDialog()}async start(){localStorage.setItem("starz_playerId",this.playerId),localStorage.setItem("starz_playerName",this.thisPlayer.name),localStorage.setItem("starz_score",this.thisPlayer.score?.toString()??"0"),this.gameSetup(this.thisPlayer),this.gameStart(),j()}gameSetup(t){const n=this.getFnContext();this.state=this.game.setup(n),bg(),t.name=this.config.playerName;const i=this.onPlayerJoin(1,t);this.game.assignSystem(this.state,t.id);const r=qn+ +this.config.numBots;for(let s=2;s<=r;s++){const o=this.onPlayerJoin(s);this.game.assignSystem(this.state,o.id)}this.setupThisPlayer(i.id),localStorage.setItem("starz_playerId",i.id),localStorage.setItem("starz_playerName",i.name),localStorage.setItem("starz_score",i.score.score.toString())}async initializePlayer(){const t=this.playerId=localStorage.getItem("starz_playerId")??wa(),n=localStorage.getItem("starz_playerName")??this.config.playerName,i=+(localStorage.getItem("starz_score")??0);return localStorage.setItem("starz_playerId",t),localStorage.setItem("starz_playerName",n),localStorage.setItem("starz_score",i.toString()),{id:t,name:n,score:{score:i}}}gameStart(){Qi("starz_gamesStarted"),super.gameStart(),Un("Game started.");const t=this.state.playerMap.get(this.playerId);t&&Un(`You are ${t.name}.`)}gameStop(){super.gameStop(),de(),j()}onPlayerJoin(t,n={}){const i=gc[t],r=t-qn,s=n.name??`Bot ${r}`,o=wa(),a=t>qn?new Ip({playerIndex:r,id:o,name:s}):void 0;return this.addPlayer({id:o,name:s,bot:a,color:i,...n})}pauseToggle(){this.status==="PAUSED"?(this.status="PLAYING",super.startGameLoop()):this.status==="PLAYING"&&(this.status="PAUSED",super.stopGameLoop())}showEndGame(t){return this.appRoot.showEndGame(t)}async quit(){await this.showEndGame("Are you sure you want to quit?")&&this.game.eliminatePlayer(this.getFnContext(),this.playerId)}async onPlayerWin(t,n){n&&Un(n),this.game.revealAllSystems(this.state),de();let i=!1;t===this.playerId?(Qi("starz_gamesWon"),i=await this.showEndGame("You have conquered The Bubble!")):(Qi("starz_gamesLost",{winnerId:t}),i=await this.showEndGame("You have lost your homeworld! Click to return to lobby.  ESC to spectate.")),i&&this.restart()}restart(){this.stopGameLoop(),de(),this.tick=0,this.state=this.game.initalState(),this.connect()}onEliminatePlayer(t,n){const i=this.state.playerMap.get(t),r=this.state.playerMap.get(n),s=n===null?`${i.name} has been eliminated!`:`${r.name} has eliminated ${i.name}!`;Un(s),t===this.playerId?(this.submitWinLoss(-1),this.onPlayerWin(n)):n===this.playerId&&this.submitWinLoss(1)}async submitWinLoss(t){const n=+(localStorage.getItem("starz_score")??0)+t;localStorage.setItem("starz_score",n.toString())}addPlayer(t){const n=super.addPlayer({color:t.color??Sm(),...t});return document.documentElement.style.setProperty(`--player-${n.id}`,n.color),n}setupThisPlayer(t){this.playerId=t;const n=this.state.playerMap.get(t),i=this.game.getPlayersHomeworld(this.state);this.game.visitSystem(this.state,i),es(),n.bot||(de(),mn(i.id))}#t(){this.events.on("PLAYER_WIN",({playerId:t,message:n})=>{this.onPlayerWin(t,n)}),this.events.on("PLAYER_ELIMINATED",({loserId:t,winnerId:n})=>{this.onEliminatePlayer(t,n)})}}function Sm(){const e="0123456789ABCDEF";let t="#";for(let n=0;n<6;n++)t+=e[Math.floor(Math.random()*16)];return t}const Bs=document.createElement("app-root"),Vi=new Mm;globalThis.gameManager=Vi;Bs.gameManager=Vi;document.body.appendChild(Bs);Vi.mount(Bs);console.log(`starz.io version ${_a}`);Vi.connect();

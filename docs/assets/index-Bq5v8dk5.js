(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();const fa="0.0.6";let da=class extends Event{constructor(t,n,i,r){super("context-request",{bubbles:!0,composed:!0}),this.context=t,this.contextTarget=n,this.callback=i,this.subscribe=r??!1}};let ks=class{constructor(t,n,i,r){if(this.subscribe=!1,this.provided=!1,this.value=void 0,this.t=(s,o)=>{this.unsubscribe&&(this.unsubscribe!==o&&(this.provided=!1,this.unsubscribe()),this.subscribe||this.unsubscribe()),this.value=s,this.host.requestUpdate(),this.provided&&!this.subscribe||(this.provided=!0,this.callback&&this.callback(s,o)),this.unsubscribe=o},this.host=t,n.context!==void 0){const s=n;this.context=s.context,this.callback=s.callback,this.subscribe=s.subscribe??!1}else this.context=n,this.callback=i,this.subscribe=r??!1;this.host.addController(this)}hostConnected(){this.dispatchRequest()}hostDisconnected(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=void 0)}dispatchRequest(){this.host.dispatchEvent(new da(this.context,this.host,this.t,this.subscribe))}};let cu=class{get value(){return this.o}set value(t){this.setValue(t)}setValue(t,n=!1){const i=n||!Object.is(t,this.o);this.o=t,i&&this.updateObservers()}constructor(t){this.subscriptions=new Map,this.updateObservers=()=>{for(const[n,{disposer:i}]of this.subscriptions)n(this.o,i)},t!==void 0&&(this.value=t)}addCallback(t,n,i){if(!i)return void t(this.value);this.subscriptions.has(t)||this.subscriptions.set(t,{disposer:()=>{this.subscriptions.delete(t)},consumerHost:n});const{disposer:r}=this.subscriptions.get(t);t(this.value,r)}clearCallbacks(){this.subscriptions.clear()}};let hu=class extends Event{constructor(t,n){super("context-provider",{bubbles:!0,composed:!0}),this.context=t,this.contextTarget=n}},Os=class extends cu{constructor(t,n,i){super(n.context!==void 0?n.initialValue:i),this.onContextRequest=r=>{if(r.context!==this.context)return;const s=r.contextTarget??r.composedPath()[0];s!==this.host&&(r.stopPropagation(),this.addCallback(r.callback,s,r.subscribe))},this.onProviderRequest=r=>{if(r.context!==this.context||(r.contextTarget??r.composedPath()[0])===this.host)return;const s=new Set;for(const[o,{consumerHost:a}]of this.subscriptions)s.has(o)||(s.add(o),a.dispatchEvent(new da(this.context,a,o,!0)));r.stopPropagation()},this.host=t,n.context!==void 0?this.context=n.context:this.context=n,this.attachListeners(),this.host.addController?.(this)}attachListeners(){this.host.addEventListener("context-request",this.onContextRequest),this.host.addEventListener("context-provider",this.onProviderRequest)}hostConnected(){this.host.dispatchEvent(new hu(this.context,this.host))}};function fu({context:e}){return(t,n)=>{const i=new WeakMap;if(typeof n=="object")return{get(){return t.get.call(this)},set(r){return i.get(this).setValue(r),t.set.call(this,r)},init(r){return i.set(this,new Os(this,{context:e,initialValue:r})),r}};{t.constructor.addInitializer((o=>{i.set(o,new Os(o,{context:e}))}));const r=Object.getOwnPropertyDescriptor(t,n);let s;if(r===void 0){const o=new WeakMap;s={get(){return o.get(this)},set(a){i.get(this).setValue(a),o.set(this,a)},configurable:!0,enumerable:!0}}else{const o=r.set;s={...r,set(a){i.get(this).setValue(a),o?.call(this,a)}}}return void Object.defineProperty(t,n,s)}}}function yn({context:e,subscribe:t}){return(n,i)=>{typeof i=="object"?i.addInitializer((function(){new ks(this,{context:e,callback:r=>{n.set.call(this,r)},subscribe:t})})):n.constructor.addInitializer((r=>{new ks(r,{context:e,callback:s=>{r[i]=s},subscribe:t})}))}}const Hn=globalThis,es=Hn.ShadowRoot&&(Hn.ShadyCSS===void 0||Hn.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,pa=Symbol(),Ls=new WeakMap;let du=class{constructor(t,n,i){if(this._$cssResult$=!0,i!==pa)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=n}get styleSheet(){let t=this.o;const n=this.t;if(es&&t===void 0){const i=n!==void 0&&n.length===1;i&&(t=Ls.get(n)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),i&&Ls.set(n,t))}return t}toString(){return this.cssText}};const pu=e=>new du(typeof e=="string"?e:e+"",void 0,pa),gu=(e,t)=>{if(es)e.adoptedStyleSheets=t.map((n=>n instanceof CSSStyleSheet?n:n.styleSheet));else for(const n of t){const i=document.createElement("style"),r=Hn.litNonce;r!==void 0&&i.setAttribute("nonce",r),i.textContent=n.cssText,e.appendChild(i)}},Rs=es?e=>e:e=>e instanceof CSSStyleSheet?(t=>{let n="";for(const i of t.cssRules)n+=i.cssText;return pu(n)})(e):e;const{is:mu,defineProperty:yu,getOwnPropertyDescriptor:vu,getOwnPropertyNames:wu,getOwnPropertySymbols:_u,getPrototypeOf:xu}=Object,Ci=globalThis,Ds=Ci.trustedTypes,Mu=Ds?Ds.emptyScript:"",Su=Ci.reactiveElementPolyfillSupport,nn=(e,t)=>e,Wn={toAttribute(e,t){switch(t){case Boolean:e=e?Mu:null;break;case Object:case Array:e=e==null?e:JSON.stringify(e)}return e},fromAttribute(e,t){let n=e;switch(t){case Boolean:n=e!==null;break;case Number:n=e===null?null:Number(e);break;case Object:case Array:try{n=JSON.parse(e)}catch{n=null}}return n}},ns=(e,t)=>!mu(e,t),zs={attribute:!0,type:String,converter:Wn,reflect:!1,useDefault:!1,hasChanged:ns};Symbol.metadata??=Symbol("metadata"),Ci.litPropertyMetadata??=new WeakMap;let $e=class extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,n=zs){if(n.state&&(n.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((n=Object.create(n)).wrapped=!0),this.elementProperties.set(t,n),!n.noAccessor){const i=Symbol(),r=this.getPropertyDescriptor(t,i,n);r!==void 0&&yu(this.prototype,t,r)}}static getPropertyDescriptor(t,n,i){const{get:r,set:s}=vu(this.prototype,t)??{get(){return this[n]},set(o){this[n]=o}};return{get:r,set(o){const a=r?.call(this);s?.call(this,o),this.requestUpdate(t,a,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??zs}static _$Ei(){if(this.hasOwnProperty(nn("elementProperties")))return;const t=xu(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(nn("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(nn("properties"))){const n=this.properties,i=[...wu(n),..._u(n)];for(const r of i)this.createProperty(r,n[r])}const t=this[Symbol.metadata];if(t!==null){const n=litPropertyMetadata.get(t);if(n!==void 0)for(const[i,r]of n)this.elementProperties.set(i,r)}this._$Eh=new Map;for(const[n,i]of this.elementProperties){const r=this._$Eu(n,i);r!==void 0&&this._$Eh.set(r,n)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const n=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const r of i)n.unshift(Rs(r))}else t!==void 0&&n.push(Rs(t));return n}static _$Eu(t,n){const i=n.attribute;return i===!1?void 0:typeof i=="string"?i:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((t=>t(this)))}addController(t){(this._$EO??=new Set).add(t),this.renderRoot!==void 0&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,n=this.constructor.elementProperties;for(const i of n.keys())this.hasOwnProperty(i)&&(t.set(i,this[i]),delete this[i]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return gu(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((t=>t.hostConnected?.()))}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach((t=>t.hostDisconnected?.()))}attributeChangedCallback(t,n,i){this._$AK(t,i)}_$ET(t,n){const i=this.constructor.elementProperties.get(t),r=this.constructor._$Eu(t,i);if(r!==void 0&&i.reflect===!0){const s=(i.converter?.toAttribute!==void 0?i.converter:Wn).toAttribute(n,i.type);this._$Em=t,s==null?this.removeAttribute(r):this.setAttribute(r,s),this._$Em=null}}_$AK(t,n){const i=this.constructor,r=i._$Eh.get(t);if(r!==void 0&&this._$Em!==r){const s=i.getPropertyOptions(r),o=typeof s.converter=="function"?{fromAttribute:s.converter}:s.converter?.fromAttribute!==void 0?s.converter:Wn;this._$Em=r;const a=o.fromAttribute(n,s.type);this[r]=a??this._$Ej?.get(r)??a,this._$Em=null}}requestUpdate(t,n,i){if(t!==void 0){const r=this.constructor,s=this[t];if(i??=r.getPropertyOptions(t),!((i.hasChanged??ns)(s,n)||i.useDefault&&i.reflect&&s===this._$Ej?.get(t)&&!this.hasAttribute(r._$Eu(t,i))))return;this.C(t,n,i)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(t,n,{useDefault:i,reflect:r,wrapped:s},o){i&&!(this._$Ej??=new Map).has(t)&&(this._$Ej.set(t,o??n??this[t]),s!==!0||o!==void 0)||(this._$AL.has(t)||(this.hasUpdated||i||(n=void 0),this._$AL.set(t,n)),r===!0&&this._$Em!==t&&(this._$Eq??=new Set).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(n){Promise.reject(n)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[r,s]of this._$Ep)this[r]=s;this._$Ep=void 0}const i=this.constructor.elementProperties;if(i.size>0)for(const[r,s]of i){const{wrapped:o}=s,a=this[r];o!==!0||this._$AL.has(r)||a===void 0||this.C(r,void 0,s,a)}}let t=!1;const n=this._$AL;try{t=this.shouldUpdate(n),t?(this.willUpdate(n),this._$EO?.forEach((i=>i.hostUpdate?.())),this.update(n)):this._$EM()}catch(i){throw t=!1,this._$EM(),i}t&&this._$AE(n)}willUpdate(t){}_$AE(t){this._$EO?.forEach((n=>n.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&=this._$Eq.forEach((n=>this._$ET(n,this[n]))),this._$EM()}updated(t){}firstUpdated(t){}};$e.elementStyles=[],$e.shadowRootOptions={mode:"open"},$e[nn("elementProperties")]=new Map,$e[nn("finalized")]=new Map,Su?.({ReactiveElement:$e}),(Ci.reactiveElementVersions??=[]).push("2.1.1");const is=globalThis,Qn=is.trustedTypes,Bs=Qn?Qn.createPolicy("lit-html",{createHTML:e=>e}):void 0,ga="$lit$",ie=`lit$${Math.random().toFixed(9).slice(2)}$`,ma="?"+ie,bu=`<${ma}>`,ye=document,on=()=>ye.createComment(""),an=e=>e===null||typeof e!="object"&&typeof e!="function",rs=Array.isArray,$u=e=>rs(e)||typeof e?.[Symbol.iterator]=="function",Xi=`[ 	
\f\r]`,Fe=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Us=/-->/g,Hs=/>/g,le=RegExp(`>|${Xi}(?:([^\\s"'>=/]+)(${Xi}*=${Xi}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),qs=/'/g,Fs=/"/g,ya=/^(?:script|style|textarea|title)$/i,Eu=e=>(t,...n)=>({_$litType$:e,strings:t,values:n}),Bt=Eu(1),ve=Symbol.for("lit-noChange"),et=Symbol.for("lit-nothing"),Gs=new WeakMap,ce=ye.createTreeWalker(ye,129);function va(e,t){if(!rs(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return Bs!==void 0?Bs.createHTML(t):t}const Au=(e,t)=>{const n=e.length-1,i=[];let r,s=t===2?"<svg>":t===3?"<math>":"",o=Fe;for(let a=0;a<n;a++){const l=e[a];let u,h,c=-1,f=0;for(;f<l.length&&(o.lastIndex=f,h=o.exec(l),h!==null);)f=o.lastIndex,o===Fe?h[1]==="!--"?o=Us:h[1]!==void 0?o=Hs:h[2]!==void 0?(ya.test(h[2])&&(r=RegExp("</"+h[2],"g")),o=le):h[3]!==void 0&&(o=le):o===le?h[0]===">"?(o=r??Fe,c=-1):h[1]===void 0?c=-2:(c=o.lastIndex-h[2].length,u=h[1],o=h[3]===void 0?le:h[3]==='"'?Fs:qs):o===Fs||o===qs?o=le:o===Us||o===Hs?o=Fe:(o=le,r=void 0);const v=o===le&&e[a+1].startsWith("/>")?" ":"";s+=o===Fe?l+bu:c>=0?(i.push(u),l.slice(0,c)+ga+l.slice(c)+ie+v):l+ie+(c===-2?a:v)}return[va(e,s+(e[n]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),i]};class ln{constructor({strings:t,_$litType$:n},i){let r;this.parts=[];let s=0,o=0;const a=t.length-1,l=this.parts,[u,h]=Au(t,n);if(this.el=ln.createElement(u,i),ce.currentNode=this.el.content,n===2||n===3){const c=this.el.content.firstChild;c.replaceWith(...c.childNodes)}for(;(r=ce.nextNode())!==null&&l.length<a;){if(r.nodeType===1){if(r.hasAttributes())for(const c of r.getAttributeNames())if(c.endsWith(ga)){const f=h[o++],v=r.getAttribute(c).split(ie),S=/([.?@])?(.*)/.exec(f);l.push({type:1,index:s,name:S[2],strings:v,ctor:S[1]==="."?Tu:S[1]==="?"?Nu:S[1]==="@"?Pu:ki}),r.removeAttribute(c)}else c.startsWith(ie)&&(l.push({type:6,index:s}),r.removeAttribute(c));if(ya.test(r.tagName)){const c=r.textContent.split(ie),f=c.length-1;if(f>0){r.textContent=Qn?Qn.emptyScript:"";for(let v=0;v<f;v++)r.append(c[v],on()),ce.nextNode(),l.push({type:2,index:++s});r.append(c[f],on())}}}else if(r.nodeType===8)if(r.data===ma)l.push({type:2,index:s});else{let c=-1;for(;(c=r.data.indexOf(ie,c+1))!==-1;)l.push({type:7,index:s}),c+=ie.length-1}s++}}static createElement(t,n){const i=ye.createElement("template");return i.innerHTML=t,i}}function Pe(e,t,n=e,i){if(t===ve)return t;let r=i!==void 0?n._$Co?.[i]:n._$Cl;const s=an(t)?void 0:t._$litDirective$;return r?.constructor!==s&&(r?._$AO?.(!1),s===void 0?r=void 0:(r=new s(e),r._$AT(e,n,i)),i!==void 0?(n._$Co??=[])[i]=r:n._$Cl=r),r!==void 0&&(t=Pe(e,r._$AS(e,t.values),r,i)),t}class Iu{constructor(t,n){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:n},parts:i}=this._$AD,r=(t?.creationScope??ye).importNode(n,!0);ce.currentNode=r;let s=ce.nextNode(),o=0,a=0,l=i[0];for(;l!==void 0;){if(o===l.index){let u;l.type===2?u=new vn(s,s.nextSibling,this,t):l.type===1?u=new l.ctor(s,l.name,l.strings,this,t):l.type===6&&(u=new Cu(s,this,t)),this._$AV.push(u),l=i[++a]}o!==l?.index&&(s=ce.nextNode(),o++)}return ce.currentNode=ye,r}p(t){let n=0;for(const i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(t,i,n),n+=i.strings.length-2):i._$AI(t[n])),n++}}class vn{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,n,i,r){this.type=2,this._$AH=et,this._$AN=void 0,this._$AA=t,this._$AB=n,this._$AM=i,this.options=r,this._$Cv=r?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const n=this._$AM;return n!==void 0&&t?.nodeType===11&&(t=n.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,n=this){t=Pe(this,t,n),an(t)?t===et||t==null||t===""?(this._$AH!==et&&this._$AR(),this._$AH=et):t!==this._$AH&&t!==ve&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):$u(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==et&&an(this._$AH)?this._$AA.nextSibling.data=t:this.T(ye.createTextNode(t)),this._$AH=t}$(t){const{values:n,_$litType$:i}=t,r=typeof i=="number"?this._$AC(t):(i.el===void 0&&(i.el=ln.createElement(va(i.h,i.h[0]),this.options)),i);if(this._$AH?._$AD===r)this._$AH.p(n);else{const s=new Iu(r,this),o=s.u(this.options);s.p(n),this.T(o),this._$AH=s}}_$AC(t){let n=Gs.get(t.strings);return n===void 0&&Gs.set(t.strings,n=new ln(t)),n}k(t){rs(this._$AH)||(this._$AH=[],this._$AR());const n=this._$AH;let i,r=0;for(const s of t)r===n.length?n.push(i=new vn(this.O(on()),this.O(on()),this,this.options)):i=n[r],i._$AI(s),r++;r<n.length&&(this._$AR(i&&i._$AB.nextSibling,r),n.length=r)}_$AR(t=this._$AA.nextSibling,n){for(this._$AP?.(!1,!0,n);t!==this._$AB;){const i=t.nextSibling;t.remove(),t=i}}setConnected(t){this._$AM===void 0&&(this._$Cv=t,this._$AP?.(t))}}class ki{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,n,i,r,s){this.type=1,this._$AH=et,this._$AN=void 0,this.element=t,this.name=n,this._$AM=r,this.options=s,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=et}_$AI(t,n=this,i,r){const s=this.strings;let o=!1;if(s===void 0)t=Pe(this,t,n,0),o=!an(t)||t!==this._$AH&&t!==ve,o&&(this._$AH=t);else{const a=t;let l,u;for(t=s[0],l=0;l<s.length-1;l++)u=Pe(this,a[i+l],n,l),u===ve&&(u=this._$AH[l]),o||=!an(u)||u!==this._$AH[l],u===et?t=et:t!==et&&(t+=(u??"")+s[l+1]),this._$AH[l]=u}o&&!r&&this.j(t)}j(t){t===et?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class Tu extends ki{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===et?void 0:t}}class Nu extends ki{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==et)}}class Pu extends ki{constructor(t,n,i,r,s){super(t,n,i,r,s),this.type=5}_$AI(t,n=this){if((t=Pe(this,t,n,0)??et)===ve)return;const i=this._$AH,r=t===et&&i!==et||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,s=t!==et&&(i===et||r);r&&this.element.removeEventListener(this.name,this,i),s&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class Cu{constructor(t,n,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=n,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){Pe(this,t)}}const ku=is.litHtmlPolyfillSupport;ku?.(ln,vn),(is.litHtmlVersions??=[]).push("3.3.1");const Ou=(e,t,n)=>{const i=n?.renderBefore??t;let r=i._$litPart$;if(r===void 0){const s=n?.renderBefore??null;i._$litPart$=r=new vn(t.insertBefore(on(),s),s,void 0,n??{})}return r._$AI(e),r};const ss=globalThis;let Ut=class extends $e{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const n=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=Ou(n,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return ve}};Ut._$litElement$=!0,Ut.finalized=!0,ss.litElementHydrateSupport?.({LitElement:Ut});const Lu=ss.litElementPolyfillSupport;Lu?.({LitElement:Ut});(ss.litElementVersions??=[]).push("4.2.1");const Ue=e=>(t,n)=>{n!==void 0?n.addInitializer((()=>{customElements.define(e,t)})):customElements.define(e,t)};const Ru={attribute:!0,type:String,converter:Wn,reflect:!1,hasChanged:ns},Du=(e=Ru,t,n)=>{const{kind:i,metadata:r}=n;let s=globalThis.litPropertyMetadata.get(r);if(s===void 0&&globalThis.litPropertyMetadata.set(r,s=new Map),i==="setter"&&((e=Object.create(e)).wrapped=!0),s.set(n.name,e),i==="accessor"){const{name:o}=n;return{set(a){const l=t.get.call(this);t.set.call(this,a),this.requestUpdate(o,l,e)},init(a){return a!==void 0&&this.C(o,void 0,e,a),a}}}if(i==="setter"){const{name:o}=n;return function(a){const l=this[o];t.call(this,a),this.requestUpdate(o,l,e)}}throw Error("Unsupported decorator location: "+i)};function pt(e){return(t,n)=>typeof n=="object"?Du(e,t,n):((i,r,s)=>{const o=r.hasOwnProperty(s);return r.constructor.createProperty(s,i),o?Object.getOwnPropertyDescriptor(r,s):void 0})(e,t,n)}function zu(e){return pt({...e,state:!0,attribute:!1})}const He=Symbol("game-manager"),Sn=BigInt(2**32-1),Xs=BigInt(32);function Bu(e,t=!1){return t?{h:Number(e&Sn),l:Number(e>>Xs&Sn)}:{h:Number(e>>Xs&Sn)|0,l:Number(e&Sn)|0}}function Uu(e,t=!1){const n=e.length;let i=new Uint32Array(n),r=new Uint32Array(n);for(let s=0;s<n;s++){const{h:o,l:a}=Bu(e[s],t);[i[s],r[s]]=[o,a]}return[i,r]}const Hu=(e,t,n)=>e<<n|t>>>32-n,qu=(e,t,n)=>t<<n|e>>>32-n,Fu=(e,t,n)=>t<<n-32|e>>>64-n,Gu=(e,t,n)=>e<<n-32|t>>>64-n;function Xu(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Ys(e,t=""){if(!Number.isSafeInteger(e)||e<0){const n=t&&`"${t}" `;throw new Error(`${n}expected integer >= 0, got ${e}`)}}function lr(e,t,n=""){const i=Xu(e),r=e?.length;if(!i||t!==void 0){const o=n&&`"${n}" `,a="",l=i?`length=${r}`:`type=${typeof e}`;throw new Error(o+"expected Uint8Array"+a+", got "+l)}return e}function Vs(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Yu(e,t){lr(e,void 0,"digestInto() output");const n=t.outputLen;if(e.length<n)throw new Error('"digestInto() output" expected to be of length >='+n)}function Vu(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function wa(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}const Ku=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ju(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function Wu(e){for(let t=0;t<e.length;t++)e[t]=ju(e[t]);return e}const Ks=Ku?e=>e:Wu;function Qu(e,t={}){const n=(r,s)=>e(s).update(r).digest(),i=e(void 0);return n.outputLen=i.outputLen,n.blockLen=i.blockLen,n.create=r=>e(r),Object.assign(n,t),Object.freeze(n)}const Zu=e=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,e])}),Ju=BigInt(0),Ge=BigInt(1),tc=BigInt(2),ec=BigInt(7),nc=BigInt(256),ic=BigInt(113),_a=[],xa=[],Ma=[];for(let e=0,t=Ge,n=1,i=0;e<24;e++){[n,i]=[i,(2*n+3*i)%5],_a.push(2*(5*i+n)),xa.push((e+1)*(e+2)/2%64);let r=Ju;for(let s=0;s<7;s++)t=(t<<Ge^(t>>ec)*ic)%nc,t&tc&&(r^=Ge<<(Ge<<BigInt(s))-Ge);Ma.push(r)}const Sa=Uu(Ma,!0),rc=Sa[0],sc=Sa[1],js=(e,t,n)=>n>32?Fu(e,t,n):Hu(e,t,n),Ws=(e,t,n)=>n>32?Gu(e,t,n):qu(e,t,n);function oc(e,t=24){const n=new Uint32Array(10);for(let i=24-t;i<24;i++){for(let o=0;o<10;o++)n[o]=e[o]^e[o+10]^e[o+20]^e[o+30]^e[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,l=(o+2)%10,u=n[l],h=n[l+1],c=js(u,h,1)^n[a],f=Ws(u,h,1)^n[a+1];for(let v=0;v<50;v+=10)e[o+v]^=c,e[o+v+1]^=f}let r=e[2],s=e[3];for(let o=0;o<24;o++){const a=xa[o],l=js(r,s,a),u=Ws(r,s,a),h=_a[o];r=e[h],s=e[h+1],e[h]=l,e[h+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=e[o+a];for(let a=0;a<10;a++)e[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}e[0]^=rc[i],e[1]^=sc[i]}wa(n)}class os{state;pos=0;posOut=0;finished=!1;state32;destroyed=!1;blockLen;suffix;outputLen;enableXOF=!1;rounds;constructor(t,n,i,r=!1,s=24){if(this.blockLen=t,this.suffix=n,this.outputLen=i,this.enableXOF=r,this.rounds=s,Ys(i,"outputLen"),!(0<t&&t<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Vu(this.state)}clone(){return this._cloneInto()}keccak(){Ks(this.state32),oc(this.state32,this.rounds),Ks(this.state32),this.posOut=0,this.pos=0}update(t){Vs(this),lr(t);const{blockLen:n,state:i}=this,r=t.length;for(let s=0;s<r;){const o=Math.min(n-this.pos,r-s);for(let a=0;a<o;a++)i[this.pos++]^=t[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:n,pos:i,blockLen:r}=this;t[i]^=n,(n&128)!==0&&i===r-1&&this.keccak(),t[r-1]^=128,this.keccak()}writeInto(t){Vs(this,!1),lr(t),this.finish();const n=this.state,{blockLen:i}=this;for(let r=0,s=t.length;r<s;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,s-r);t.set(n.subarray(this.posOut,this.posOut+o),r),this.posOut+=o,r+=o}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return Ys(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(Yu(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,wa(this.state)}_cloneInto(t){const{blockLen:n,suffix:i,outputLen:r,rounds:s,enableXOF:o}=this;return t||=new os(n,i,r,o,s),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=s,t.suffix=i,t.outputLen=r,t.enableXOF=o,t.destroyed=this.destroyed,t}}const ac=(e,t,n,i={})=>Qu(()=>new os(t,e,n),i),lc=ac(6,72,64,Zu(10));var uc=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Yi=Math.ceil,bt=Math.floor,mt="[BigNumber Error] ",Qs=mt+"Number primitive has more than 15 significant digits: ",It=1e14,H=14,Vi=9007199254740991,Ki=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],ee=1e7,rt=1e9;function ba(e){var t,n,i,r=E.prototype={constructor:E,toString:null,valueOf:null},s=new E(1),o=20,a=4,l=-7,u=21,h=-1e7,c=1e7,f=!1,v=1,S=0,A={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},N="0123456789abcdefghijklmnopqrstuvwxyz",I=!0;function E(d,g){var w,_,M,$,y,p,m,x,b=this;if(!(b instanceof E))return new E(d,g);if(g==null){if(d&&d._isBigNumber===!0){b.s=d.s,!d.c||d.e>c?b.c=b.e=null:d.e<h?b.c=[b.e=0]:(b.e=d.e,b.c=d.c.slice());return}if((p=typeof d=="number")&&d*0==0){if(b.s=1/d<0?(d=-d,-1):1,d===~~d){for($=0,y=d;y>=10;y/=10,$++);$>c?b.c=b.e=null:(b.e=$,b.c=[d]);return}x=String(d)}else{if(!uc.test(x=String(d)))return i(b,x,p);b.s=x.charCodeAt(0)==45?(x=x.slice(1),-1):1}($=x.indexOf("."))>-1&&(x=x.replace(".","")),(y=x.search(/e/i))>0?($<0&&($=y),$+=+x.slice(y+1),x=x.substring(0,y)):$<0&&($=x.length)}else{if(Z(g,2,N.length,"Base"),g==10&&I)return b=new E(d),O(b,o+b.e+1,a);if(x=String(d),p=typeof d=="number"){if(d*0!=0)return i(b,x,p,g);if(b.s=1/d<0?(x=x.slice(1),-1):1,E.DEBUG&&x.replace(/^0\.0*|\./,"").length>15)throw Error(Qs+d)}else b.s=x.charCodeAt(0)===45?(x=x.slice(1),-1):1;for(w=N.slice(0,g),$=y=0,m=x.length;y<m;y++)if(w.indexOf(_=x.charAt(y))<0){if(_=="."){if(y>$){$=m;continue}}else if(!M&&(x==x.toUpperCase()&&(x=x.toLowerCase())||x==x.toLowerCase()&&(x=x.toUpperCase()))){M=!0,y=-1,$=0;continue}return i(b,String(d),p,g)}p=!1,x=n(x,g,10,b.s),($=x.indexOf("."))>-1?x=x.replace(".",""):$=x.length}for(y=0;x.charCodeAt(y)===48;y++);for(m=x.length;x.charCodeAt(--m)===48;);if(x=x.slice(y,++m)){if(m-=y,p&&E.DEBUG&&m>15&&(d>Vi||d!==bt(d)))throw Error(Qs+b.s*d);if(($=$-y-1)>c)b.c=b.e=null;else if($<h)b.c=[b.e=0];else{if(b.e=$,b.c=[],y=($+1)%H,$<0&&(y+=H),y<m){for(y&&b.c.push(+x.slice(0,y)),m-=H;y<m;)b.c.push(+x.slice(y,y+=H));y=H-(x=x.slice(y)).length}else y-=m;for(;y--;x+="0");b.c.push(+x)}}else b.c=[b.e=0]}E.clone=ba,E.ROUND_UP=0,E.ROUND_DOWN=1,E.ROUND_CEIL=2,E.ROUND_FLOOR=3,E.ROUND_HALF_UP=4,E.ROUND_HALF_DOWN=5,E.ROUND_HALF_EVEN=6,E.ROUND_HALF_CEIL=7,E.ROUND_HALF_FLOOR=8,E.EUCLID=9,E.config=E.set=function(d){var g,w;if(d!=null)if(typeof d=="object"){if(d.hasOwnProperty(g="DECIMAL_PLACES")&&(w=d[g],Z(w,0,rt,g),o=w),d.hasOwnProperty(g="ROUNDING_MODE")&&(w=d[g],Z(w,0,8,g),a=w),d.hasOwnProperty(g="EXPONENTIAL_AT")&&(w=d[g],w&&w.pop?(Z(w[0],-rt,0,g),Z(w[1],0,rt,g),l=w[0],u=w[1]):(Z(w,-rt,rt,g),l=-(u=w<0?-w:w))),d.hasOwnProperty(g="RANGE"))if(w=d[g],w&&w.pop)Z(w[0],-rt,-1,g),Z(w[1],1,rt,g),h=w[0],c=w[1];else if(Z(w,-rt,rt,g),w)h=-(c=w<0?-w:w);else throw Error(mt+g+" cannot be zero: "+w);if(d.hasOwnProperty(g="CRYPTO"))if(w=d[g],w===!!w)if(w)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))f=w;else throw f=!w,Error(mt+"crypto unavailable");else f=w;else throw Error(mt+g+" not true or false: "+w);if(d.hasOwnProperty(g="MODULO_MODE")&&(w=d[g],Z(w,0,9,g),v=w),d.hasOwnProperty(g="POW_PRECISION")&&(w=d[g],Z(w,0,rt,g),S=w),d.hasOwnProperty(g="FORMAT"))if(w=d[g],typeof w=="object")A=w;else throw Error(mt+g+" not an object: "+w);if(d.hasOwnProperty(g="ALPHABET"))if(w=d[g],typeof w=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(w))I=w.slice(0,10)=="0123456789",N=w;else throw Error(mt+g+" invalid: "+w)}else throw Error(mt+"Object expected: "+d);return{DECIMAL_PLACES:o,ROUNDING_MODE:a,EXPONENTIAL_AT:[l,u],RANGE:[h,c],CRYPTO:f,MODULO_MODE:v,POW_PRECISION:S,FORMAT:A,ALPHABET:N}},E.isBigNumber=function(d){if(!d||d._isBigNumber!==!0)return!1;if(!E.DEBUG)return!0;var g,w,_=d.c,M=d.e,$=d.s;t:if({}.toString.call(_)=="[object Array]"){if(($===1||$===-1)&&M>=-rt&&M<=rt&&M===bt(M)){if(_[0]===0){if(M===0&&_.length===1)return!0;break t}if(g=(M+1)%H,g<1&&(g+=H),String(_[0]).length==g){for(g=0;g<_.length;g++)if(w=_[g],w<0||w>=It||w!==bt(w))break t;if(w!==0)return!0}}}else if(_===null&&M===null&&($===null||$===1||$===-1))return!0;throw Error(mt+"Invalid BigNumber: "+d)},E.maximum=E.max=function(){return P(arguments,-1)},E.minimum=E.min=function(){return P(arguments,1)},E.random=(function(){var d=9007199254740992,g=Math.random()*d&2097151?function(){return bt(Math.random()*d)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(w){var _,M,$,y,p,m=0,x=[],b=new E(s);if(w==null?w=o:Z(w,0,rt),y=Yi(w/H),f)if(crypto.getRandomValues){for(_=crypto.getRandomValues(new Uint32Array(y*=2));m<y;)p=_[m]*131072+(_[m+1]>>>11),p>=9e15?(M=crypto.getRandomValues(new Uint32Array(2)),_[m]=M[0],_[m+1]=M[1]):(x.push(p%1e14),m+=2);m=y/2}else if(crypto.randomBytes){for(_=crypto.randomBytes(y*=7);m<y;)p=(_[m]&31)*281474976710656+_[m+1]*1099511627776+_[m+2]*4294967296+_[m+3]*16777216+(_[m+4]<<16)+(_[m+5]<<8)+_[m+6],p>=9e15?crypto.randomBytes(7).copy(_,m):(x.push(p%1e14),m+=7);m=y/7}else throw f=!1,Error(mt+"crypto unavailable");if(!f)for(;m<y;)p=g(),p<9e15&&(x[m++]=p%1e14);for(y=x[--m],w%=H,y&&w&&(p=Ki[H-w],x[m]=bt(y/p)*p);x[m]===0;x.pop(),m--);if(m<0)x=[$=0];else{for($=-1;x[0]===0;x.splice(0,1),$-=H);for(m=1,p=x[0];p>=10;p/=10,m++);m<H&&($-=H-m)}return b.e=$,b.c=x,b}})(),E.sum=function(){for(var d=1,g=arguments,w=new E(g[0]);d<g.length;)w=w.plus(g[d++]);return w},n=(function(){var d="0123456789";function g(w,_,M,$){for(var y,p=[0],m,x=0,b=w.length;x<b;){for(m=p.length;m--;p[m]*=_);for(p[0]+=$.indexOf(w.charAt(x++)),y=0;y<p.length;y++)p[y]>M-1&&(p[y+1]==null&&(p[y+1]=0),p[y+1]+=p[y]/M|0,p[y]%=M)}return p.reverse()}return function(w,_,M,$,y){var p,m,x,b,T,L,R,z,U=w.indexOf("."),q=o,B=a;for(U>=0&&(b=S,S=0,w=w.replace(".",""),z=new E(_),L=z.pow(w.length-U),S=b,z.c=g(Xt(St(L.c),L.e,"0"),10,M,d),z.e=z.c.length),R=g(w,_,M,y?(p=N,d):(p=d,N)),x=b=R.length;R[--b]==0;R.pop());if(!R[0])return p.charAt(0);if(U<0?--x:(L.c=R,L.e=x,L.s=$,L=t(L,z,q,B,M),R=L.c,T=L.r,x=L.e),m=x+q+1,U=R[m],b=M/2,T=T||m<0||R[m+1]!=null,T=B<4?(U!=null||T)&&(B==0||B==(L.s<0?3:2)):U>b||U==b&&(B==4||T||B==6&&R[m-1]&1||B==(L.s<0?8:7)),m<1||!R[0])w=T?Xt(p.charAt(1),-q,p.charAt(0)):p.charAt(0);else{if(R.length=m,T)for(--M;++R[--m]>M;)R[m]=0,m||(++x,R=[1].concat(R));for(b=R.length;!R[--b];);for(U=0,w="";U<=b;w+=p.charAt(R[U++]));w=Xt(w,x,p.charAt(0))}return w}})(),t=(function(){function d(_,M,$){var y,p,m,x,b=0,T=_.length,L=M%ee,R=M/ee|0;for(_=_.slice();T--;)m=_[T]%ee,x=_[T]/ee|0,y=R*m+x*L,p=L*m+y%ee*ee+b,b=(p/$|0)+(y/ee|0)+R*x,_[T]=p%$;return b&&(_=[b].concat(_)),_}function g(_,M,$,y){var p,m;if($!=y)m=$>y?1:-1;else for(p=m=0;p<$;p++)if(_[p]!=M[p]){m=_[p]>M[p]?1:-1;break}return m}function w(_,M,$,y){for(var p=0;$--;)_[$]-=p,p=_[$]<M[$]?1:0,_[$]=p*y+_[$]-M[$];for(;!_[0]&&_.length>1;_.splice(0,1));}return function(_,M,$,y,p){var m,x,b,T,L,R,z,U,q,B,G,j,gt,ae,Gi,Lt,qe,Mt=_.s==M.s?1:-1,lt=_.c,tt=M.c;if(!lt||!lt[0]||!tt||!tt[0])return new E(!_.s||!M.s||(lt?tt&&lt[0]==tt[0]:!tt)?NaN:lt&&lt[0]==0||!tt?Mt*0:Mt/0);for(U=new E(Mt),q=U.c=[],x=_.e-M.e,Mt=$+x+1,p||(p=It,x=$t(_.e/H)-$t(M.e/H),Mt=Mt/H|0),b=0;tt[b]==(lt[b]||0);b++);if(tt[b]>(lt[b]||0)&&x--,Mt<0)q.push(1),T=!0;else{for(ae=lt.length,Lt=tt.length,b=0,Mt+=2,L=bt(p/(tt[0]+1)),L>1&&(tt=d(tt,L,p),lt=d(lt,L,p),Lt=tt.length,ae=lt.length),gt=Lt,B=lt.slice(0,Lt),G=B.length;G<Lt;B[G++]=0);qe=tt.slice(),qe=[0].concat(qe),Gi=tt[0],tt[1]>=p/2&&Gi++;do{if(L=0,m=g(tt,B,Lt,G),m<0){if(j=B[0],Lt!=G&&(j=j*p+(B[1]||0)),L=bt(j/Gi),L>1)for(L>=p&&(L=p-1),R=d(tt,L,p),z=R.length,G=B.length;g(R,B,z,G)==1;)L--,w(R,Lt<z?qe:tt,z,p),z=R.length,m=1;else L==0&&(m=L=1),R=tt.slice(),z=R.length;if(z<G&&(R=[0].concat(R)),w(B,R,G,p),G=B.length,m==-1)for(;g(tt,B,Lt,G)<1;)L++,w(B,Lt<G?qe:tt,G,p),G=B.length}else m===0&&(L++,B=[0]);q[b++]=L,B[0]?B[G++]=lt[gt]||0:(B=[lt[gt]],G=1)}while((gt++<ae||B[0]!=null)&&Mt--);T=B[0]!=null,q[0]||q.splice(0,1)}if(p==It){for(b=1,Mt=q[0];Mt>=10;Mt/=10,b++);O(U,$+(U.e=b+x*H-1)+1,y,T)}else U.e=x,U.r=+T;return U}})();function C(d,g,w,_){var M,$,y,p,m;if(w==null?w=a:Z(w,0,8),!d.c)return d.toString();if(M=d.c[0],y=d.e,g==null)m=St(d.c),m=_==1||_==2&&(y<=l||y>=u)?$n(m,y):Xt(m,y,"0");else if(d=O(new E(d),g,w),$=d.e,m=St(d.c),p=m.length,_==1||_==2&&(g<=$||$<=l)){for(;p<g;m+="0",p++);m=$n(m,$)}else if(g-=y+(_===2&&$>y),m=Xt(m,$,"0"),$+1>p){if(--g>0)for(m+=".";g--;m+="0");}else if(g+=$-p,g>0)for($+1==p&&(m+=".");g--;m+="0");return d.s<0&&M?"-"+m:m}function P(d,g){for(var w,_,M=1,$=new E(d[0]);M<d.length;M++)_=new E(d[M]),(!_.s||(w=ue($,_))===g||w===0&&$.s===g)&&($=_);return $}function k(d,g,w){for(var _=1,M=g.length;!g[--M];g.pop());for(M=g[0];M>=10;M/=10,_++);return(w=_+w*H-1)>c?d.c=d.e=null:w<h?d.c=[d.e=0]:(d.e=w,d.c=g),d}i=(function(){var d=/^(-?)0([xbo])(?=\w[\w.]*$)/i,g=/^([^.]+)\.$/,w=/^\.([^.]+)$/,_=/^-?(Infinity|NaN)$/,M=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function($,y,p,m){var x,b=p?y:y.replace(M,"");if(_.test(b))$.s=isNaN(b)?null:b<0?-1:1;else{if(!p&&(b=b.replace(d,function(T,L,R){return x=(R=R.toLowerCase())=="x"?16:R=="b"?2:8,!m||m==x?L:T}),m&&(x=m,b=b.replace(g,"$1").replace(w,"0.$1")),y!=b))return new E(b,x);if(E.DEBUG)throw Error(mt+"Not a"+(m?" base "+m:"")+" number: "+y);$.s=null}$.c=$.e=null}})();function O(d,g,w,_){var M,$,y,p,m,x,b,T=d.c,L=Ki;if(T){t:{for(M=1,p=T[0];p>=10;p/=10,M++);if($=g-M,$<0)$+=H,y=g,m=T[x=0],b=bt(m/L[M-y-1]%10);else if(x=Yi(($+1)/H),x>=T.length)if(_){for(;T.length<=x;T.push(0));m=b=0,M=1,$%=H,y=$-H+1}else break t;else{for(m=p=T[x],M=1;p>=10;p/=10,M++);$%=H,y=$-H+M,b=y<0?0:bt(m/L[M-y-1]%10)}if(_=_||g<0||T[x+1]!=null||(y<0?m:m%L[M-y-1]),_=w<4?(b||_)&&(w==0||w==(d.s<0?3:2)):b>5||b==5&&(w==4||_||w==6&&($>0?y>0?m/L[M-y]:0:T[x-1])%10&1||w==(d.s<0?8:7)),g<1||!T[0])return T.length=0,_?(g-=d.e+1,T[0]=L[(H-g%H)%H],d.e=-g||0):T[0]=d.e=0,d;if($==0?(T.length=x,p=1,x--):(T.length=x+1,p=L[H-$],T[x]=y>0?bt(m/L[M-y]%L[y])*p:0),_)for(;;)if(x==0){for($=1,y=T[0];y>=10;y/=10,$++);for(y=T[0]+=p,p=1;y>=10;y/=10,p++);$!=p&&(d.e++,T[0]==It&&(T[0]=1));break}else{if(T[x]+=p,T[x]!=It)break;T[x--]=0,p=1}for($=T.length;T[--$]===0;T.pop());}d.e>c?d.c=d.e=null:d.e<h&&(d.c=[d.e=0])}return d}function D(d){var g,w=d.e;return w===null?d.toString():(g=St(d.c),g=w<=l||w>=u?$n(g,w):Xt(g,w,"0"),d.s<0?"-"+g:g)}return r.absoluteValue=r.abs=function(){var d=new E(this);return d.s<0&&(d.s=1),d},r.comparedTo=function(d,g){return ue(this,new E(d,g))},r.decimalPlaces=r.dp=function(d,g){var w,_,M,$=this;if(d!=null)return Z(d,0,rt),g==null?g=a:Z(g,0,8),O(new E($),d+$.e+1,g);if(!(w=$.c))return null;if(_=((M=w.length-1)-$t(this.e/H))*H,M=w[M])for(;M%10==0;M/=10,_--);return _<0&&(_=0),_},r.dividedBy=r.div=function(d,g){return t(this,new E(d,g),o,a)},r.dividedToIntegerBy=r.idiv=function(d,g){return t(this,new E(d,g),0,1)},r.exponentiatedBy=r.pow=function(d,g){var w,_,M,$,y,p,m,x,b,T=this;if(d=new E(d),d.c&&!d.isInteger())throw Error(mt+"Exponent not an integer: "+D(d));if(g!=null&&(g=new E(g)),p=d.e>14,!T.c||!T.c[0]||T.c[0]==1&&!T.e&&T.c.length==1||!d.c||!d.c[0])return b=new E(Math.pow(+D(T),p?d.s*(2-bn(d)):+D(d))),g?b.mod(g):b;if(m=d.s<0,g){if(g.c?!g.c[0]:!g.s)return new E(NaN);_=!m&&T.isInteger()&&g.isInteger(),_&&(T=T.mod(g))}else{if(d.e>9&&(T.e>0||T.e<-1||(T.e==0?T.c[0]>1||p&&T.c[1]>=24e7:T.c[0]<8e13||p&&T.c[0]<=9999975e7)))return $=T.s<0&&bn(d)?-0:0,T.e>-1&&($=1/$),new E(m?1/$:$);S&&($=Yi(S/H+2))}for(p?(w=new E(.5),m&&(d.s=1),x=bn(d)):(M=Math.abs(+D(d)),x=M%2),b=new E(s);;){if(x){if(b=b.times(T),!b.c)break;$?b.c.length>$&&(b.c.length=$):_&&(b=b.mod(g))}if(M){if(M=bt(M/2),M===0)break;x=M%2}else if(d=d.times(w),O(d,d.e+1,1),d.e>14)x=bn(d);else{if(M=+D(d),M===0)break;x=M%2}T=T.times(T),$?T.c&&T.c.length>$&&(T.c.length=$):_&&(T=T.mod(g))}return _?b:(m&&(b=s.div(b)),g?b.mod(g):$?O(b,S,a,y):b)},r.integerValue=function(d){var g=new E(this);return d==null?d=a:Z(d,0,8),O(g,g.e+1,d)},r.isEqualTo=r.eq=function(d,g){return ue(this,new E(d,g))===0},r.isFinite=function(){return!!this.c},r.isGreaterThan=r.gt=function(d,g){return ue(this,new E(d,g))>0},r.isGreaterThanOrEqualTo=r.gte=function(d,g){return(g=ue(this,new E(d,g)))===1||g===0},r.isInteger=function(){return!!this.c&&$t(this.e/H)>this.c.length-2},r.isLessThan=r.lt=function(d,g){return ue(this,new E(d,g))<0},r.isLessThanOrEqualTo=r.lte=function(d,g){return(g=ue(this,new E(d,g)))===-1||g===0},r.isNaN=function(){return!this.s},r.isNegative=function(){return this.s<0},r.isPositive=function(){return this.s>0},r.isZero=function(){return!!this.c&&this.c[0]==0},r.minus=function(d,g){var w,_,M,$,y=this,p=y.s;if(d=new E(d,g),g=d.s,!p||!g)return new E(NaN);if(p!=g)return d.s=-g,y.plus(d);var m=y.e/H,x=d.e/H,b=y.c,T=d.c;if(!m||!x){if(!b||!T)return b?(d.s=-g,d):new E(T?y:NaN);if(!b[0]||!T[0])return T[0]?(d.s=-g,d):new E(b[0]?y:a==3?-0:0)}if(m=$t(m),x=$t(x),b=b.slice(),p=m-x){for(($=p<0)?(p=-p,M=b):(x=m,M=T),M.reverse(),g=p;g--;M.push(0));M.reverse()}else for(_=($=(p=b.length)<(g=T.length))?p:g,p=g=0;g<_;g++)if(b[g]!=T[g]){$=b[g]<T[g];break}if($&&(M=b,b=T,T=M,d.s=-d.s),g=(_=T.length)-(w=b.length),g>0)for(;g--;b[w++]=0);for(g=It-1;_>p;){if(b[--_]<T[_]){for(w=_;w&&!b[--w];b[w]=g);--b[w],b[_]+=It}b[_]-=T[_]}for(;b[0]==0;b.splice(0,1),--x);return b[0]?k(d,b,x):(d.s=a==3?-1:1,d.c=[d.e=0],d)},r.modulo=r.mod=function(d,g){var w,_,M=this;return d=new E(d,g),!M.c||!d.s||d.c&&!d.c[0]?new E(NaN):!d.c||M.c&&!M.c[0]?new E(M):(v==9?(_=d.s,d.s=1,w=t(M,d,0,3),d.s=_,w.s*=_):w=t(M,d,0,v),d=M.minus(w.times(d)),!d.c[0]&&v==1&&(d.s=M.s),d)},r.multipliedBy=r.times=function(d,g){var w,_,M,$,y,p,m,x,b,T,L,R,z,U,q,B=this,G=B.c,j=(d=new E(d,g)).c;if(!G||!j||!G[0]||!j[0])return!B.s||!d.s||G&&!G[0]&&!j||j&&!j[0]&&!G?d.c=d.e=d.s=null:(d.s*=B.s,!G||!j?d.c=d.e=null:(d.c=[0],d.e=0)),d;for(_=$t(B.e/H)+$t(d.e/H),d.s*=B.s,m=G.length,T=j.length,m<T&&(z=G,G=j,j=z,M=m,m=T,T=M),M=m+T,z=[];M--;z.push(0));for(U=It,q=ee,M=T;--M>=0;){for(w=0,L=j[M]%q,R=j[M]/q|0,y=m,$=M+y;$>M;)x=G[--y]%q,b=G[y]/q|0,p=R*x+b*L,x=L*x+p%q*q+z[$]+w,w=(x/U|0)+(p/q|0)+R*b,z[$--]=x%U;z[$]=w}return w?++_:z.splice(0,1),k(d,z,_)},r.negated=function(){var d=new E(this);return d.s=-d.s||null,d},r.plus=function(d,g){var w,_=this,M=_.s;if(d=new E(d,g),g=d.s,!M||!g)return new E(NaN);if(M!=g)return d.s=-g,_.minus(d);var $=_.e/H,y=d.e/H,p=_.c,m=d.c;if(!$||!y){if(!p||!m)return new E(M/0);if(!p[0]||!m[0])return m[0]?d:new E(p[0]?_:M*0)}if($=$t($),y=$t(y),p=p.slice(),M=$-y){for(M>0?(y=$,w=m):(M=-M,w=p),w.reverse();M--;w.push(0));w.reverse()}for(M=p.length,g=m.length,M-g<0&&(w=m,m=p,p=w,g=M),M=0;g;)M=(p[--g]=p[g]+m[g]+M)/It|0,p[g]=It===p[g]?0:p[g]%It;return M&&(p=[M].concat(p),++y),k(d,p,y)},r.precision=r.sd=function(d,g){var w,_,M,$=this;if(d!=null&&d!==!!d)return Z(d,1,rt),g==null?g=a:Z(g,0,8),O(new E($),d,g);if(!(w=$.c))return null;if(M=w.length-1,_=M*H+1,M=w[M]){for(;M%10==0;M/=10,_--);for(M=w[0];M>=10;M/=10,_++);}return d&&$.e+1>_&&(_=$.e+1),_},r.shiftedBy=function(d){return Z(d,-Vi,Vi),this.times("1e"+d)},r.squareRoot=r.sqrt=function(){var d,g,w,_,M,$=this,y=$.c,p=$.s,m=$.e,x=o+4,b=new E("0.5");if(p!==1||!y||!y[0])return new E(!p||p<0&&(!y||y[0])?NaN:y?$:1/0);if(p=Math.sqrt(+D($)),p==0||p==1/0?(g=St(y),(g.length+m)%2==0&&(g+="0"),p=Math.sqrt(+g),m=$t((m+1)/2)-(m<0||m%2),p==1/0?g="5e"+m:(g=p.toExponential(),g=g.slice(0,g.indexOf("e")+1)+m),w=new E(g)):w=new E(p+""),w.c[0]){for(m=w.e,p=m+x,p<3&&(p=0);;)if(M=w,w=b.times(M.plus(t($,M,x,1))),St(M.c).slice(0,p)===(g=St(w.c)).slice(0,p))if(w.e<m&&--p,g=g.slice(p-3,p+1),g=="9999"||!_&&g=="4999"){if(!_&&(O(M,M.e+o+2,0),M.times(M).eq($))){w=M;break}x+=4,p+=4,_=1}else{(!+g||!+g.slice(1)&&g.charAt(0)=="5")&&(O(w,w.e+o+2,1),d=!w.times(w).eq($));break}}return O(w,w.e+o+1,a,d)},r.toExponential=function(d,g){return d!=null&&(Z(d,0,rt),d++),C(this,d,g,1)},r.toFixed=function(d,g){return d!=null&&(Z(d,0,rt),d=d+this.e+1),C(this,d,g)},r.toFormat=function(d,g,w){var _,M=this;if(w==null)d!=null&&g&&typeof g=="object"?(w=g,g=null):d&&typeof d=="object"?(w=d,d=g=null):w=A;else if(typeof w!="object")throw Error(mt+"Argument not an object: "+w);if(_=M.toFixed(d,g),M.c){var $,y=_.split("."),p=+w.groupSize,m=+w.secondaryGroupSize,x=w.groupSeparator||"",b=y[0],T=y[1],L=M.s<0,R=L?b.slice(1):b,z=R.length;if(m&&($=p,p=m,m=$,z-=$),p>0&&z>0){for($=z%p||p,b=R.substr(0,$);$<z;$+=p)b+=x+R.substr($,p);m>0&&(b+=x+R.slice($)),L&&(b="-"+b)}_=T?b+(w.decimalSeparator||"")+((m=+w.fractionGroupSize)?T.replace(new RegExp("\\d{"+m+"}\\B","g"),"$&"+(w.fractionGroupSeparator||"")):T):b}return(w.prefix||"")+_+(w.suffix||"")},r.toFraction=function(d){var g,w,_,M,$,y,p,m,x,b,T,L,R=this,z=R.c;if(d!=null&&(p=new E(d),!p.isInteger()&&(p.c||p.s!==1)||p.lt(s)))throw Error(mt+"Argument "+(p.isInteger()?"out of range: ":"not an integer: ")+D(p));if(!z)return new E(R);for(g=new E(s),x=w=new E(s),_=m=new E(s),L=St(z),$=g.e=L.length-R.e-1,g.c[0]=Ki[(y=$%H)<0?H+y:y],d=!d||p.comparedTo(g)>0?$>0?g:x:p,y=c,c=1/0,p=new E(L),m.c[0]=0;b=t(p,g,0,1),M=w.plus(b.times(_)),M.comparedTo(d)!=1;)w=_,_=M,x=m.plus(b.times(M=x)),m=M,g=p.minus(b.times(M=g)),p=M;return M=t(d.minus(w),_,0,1),m=m.plus(M.times(x)),w=w.plus(M.times(_)),m.s=x.s=R.s,$=$*2,T=t(x,_,$,a).minus(R).abs().comparedTo(t(m,w,$,a).minus(R).abs())<1?[x,_]:[m,w],c=y,T},r.toNumber=function(){return+D(this)},r.toPrecision=function(d,g){return d!=null&&Z(d,1,rt),C(this,d,g,2)},r.toString=function(d){var g,w=this,_=w.s,M=w.e;return M===null?_?(g="Infinity",_<0&&(g="-"+g)):g="NaN":(d==null?g=M<=l||M>=u?$n(St(w.c),M):Xt(St(w.c),M,"0"):d===10&&I?(w=O(new E(w),o+M+1,a),g=Xt(St(w.c),w.e,"0")):(Z(d,2,N.length,"Base"),g=n(Xt(St(w.c),M,"0"),10,d,_,!0)),_<0&&w.c[0]&&(g="-"+g)),g},r.valueOf=r.toJSON=function(){return D(this)},r._isBigNumber=!0,r[Symbol.toStringTag]="BigNumber",r[Symbol.for("nodejs.util.inspect.custom")]=r.valueOf,e!=null&&E.set(e),E}function $t(e){var t=e|0;return e>0||e===t?t:t-1}function St(e){for(var t,n,i=1,r=e.length,s=e[0]+"";i<r;){for(t=e[i++]+"",n=H-t.length;n--;t="0"+t);s+=t}for(r=s.length;s.charCodeAt(--r)===48;);return s.slice(0,r+1||1)}function ue(e,t){var n,i,r=e.c,s=t.c,o=e.s,a=t.s,l=e.e,u=t.e;if(!o||!a)return null;if(n=r&&!r[0],i=s&&!s[0],n||i)return n?i?0:-a:o;if(o!=a)return o;if(n=o<0,i=l==u,!r||!s)return i?0:!r^n?1:-1;if(!i)return l>u^n?1:-1;for(a=(l=r.length)<(u=s.length)?l:u,o=0;o<a;o++)if(r[o]!=s[o])return r[o]>s[o]^n?1:-1;return l==u?0:l>u^n?1:-1}function Z(e,t,n,i){if(e<t||e>n||e!==bt(e))throw Error(mt+(i||"Argument")+(typeof e=="number"?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function bn(e){var t=e.c.length-1;return $t(e.e/H)==t&&e.c[t]%2!=0}function $n(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function Xt(e,t,n){var i,r;if(t<0){for(r=n+".";++t;r+=n);e=r+e}else if(i=e.length,++t>i){for(r=n,t-=i;--t;r+=n);e+=r}else t<i&&(e=e.slice(0,t)+"."+e.slice(t));return e}var cc=ba();const hc=24,rn=32,fc=()=>typeof globalThis<"u"&&globalThis.crypto&&typeof globalThis.crypto.getRandomValues=="function"?()=>{const e=new Uint32Array(1);return globalThis.crypto.getRandomValues(e),e[0]/4294967296}:Math.random,as=fc(),ur=(e=4,t=as)=>{let n="";for(;n.length<e;)n=n+Math.floor(t()*36).toString(36);return n};function dc(e){let t=new cc(0);for(const n of e.values())t=t.multipliedBy(256).plus(n);return t}const $a=(e="")=>{const t=new TextEncoder;return dc(lc(t.encode(e))).toString(36).slice(1)},Zs=Array.from({length:26},(e,t)=>String.fromCharCode(t+97)),pc=e=>Zs[Math.floor(e()*Zs.length)],gc=({globalObj:e=typeof global<"u"?global:typeof window<"u"?window:{},random:t=as}={})=>{const n=Object.keys(e).toString(),i=n.length?n+ur(rn,t):ur(rn,t);return $a(i).substring(0,rn)},mc=e=>()=>e++,yc=476782367,ls=({random:e=as,counter:t=mc(Math.floor(e()*yc)),length:n=hc,fingerprint:i=gc({random:e})}={})=>{if(n>rn)throw new Error(`Length must be between 2 and ${rn}. Received: ${n}`);return function(){const s=pc(e),o=Date.now().toString(36),a=t().toString(36),l=ur(n,e),u=`${o+l+a+i}`;return`${s+$a(u).substring(1,n)}`}};ls();const vc={DEV:!1,PROD:!0},Zn=750,se=750,wc="Orthographic",_c=500,xc=2,Mc=25,Sc=1,bc=1,Ea=40,$c=!0,Ec=384,cr=1,Ac=4,Ic=.1,Aa=vc||{},Jn=Aa.DEV??!0,Tc=Aa.PROD??!1,Nc=Tc,Pc=Jn,Ia=Jn,Cc=["#c0392b","#f1c40f","#9b59b6","#00b386","#cc6600","#0a4c8c"];function Ta(e,t){let n,i;for(const r of e)r!=null&&(n===void 0?r>=r&&(n=i=r):(n>r&&(n=r),i<r&&(i=r)));return[n,i]}class kt{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let i=0;for(let r=0;r<this._n&&r<32;r++){const s=n[r],o=t+s,a=Math.abs(t)<Math.abs(s)?t-(o-s):s-(o-t);a&&(n[i++]=a),t=o}return n[i]=t,this._n=i+1,this}valueOf(){const t=this._partials;let n=this._n,i,r,s,o=0;if(n>0){for(o=t[--n];n>0&&(i=o,r=t[--n],o=i+r,s=r-(o-i),!s););n>0&&(s<0&&t[n-1]<0||s>0&&t[n-1]>0)&&(r=s*2,i=o+r,r==i-o&&(o=i))}return o}}function Js(e,t){let n=0,i=0;if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(++n,i+=r);else{let r=-1;for(let s of e)(s=t(s,++r,e))!=null&&(s=+s)>=s&&(++n,i+=s)}if(n)return i/n}function*kc(e){for(const t of e)yield*t}function Na(e){return Array.from(kc(e))}function Ee(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((t-e)/n))|0,s=new Array(r);++i<r;)s[i]=e+i*n;return s}var Oc={value:()=>{}};function Oi(){for(var e=0,t=arguments.length,n={},i;e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new qn(n)}function qn(e){this._=e}function Lc(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}qn.prototype=Oi.prototype={constructor:qn,on:function(e,t){var n=this._,i=Lc(e+"",n),r,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((r=(e=i[s]).type)&&(r=Rc(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<o;)if(r=(e=i[s]).type)n[r]=to(n[r],e.name,t);else if(t==null)for(r in n)n[r]=to(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new qn(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],i=0,r=s.length;i<r;++i)s[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,s=i.length;r<s;++r)i[r].value.apply(t,n)}};function Rc(e,t){for(var n=0,i=e.length,r;n<i;++n)if((r=e[n]).name===t)return r.value}function to(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=Oc,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}var hr="http://www.w3.org/1999/xhtml";const eo={svg:"http://www.w3.org/2000/svg",xhtml:hr,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Li(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),eo.hasOwnProperty(t)?{space:eo[t],local:e}:e}function Dc(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===hr&&t.documentElement.namespaceURI===hr?t.createElement(e):t.createElementNS(n,e)}}function zc(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Pa(e){var t=Li(e);return(t.local?zc:Dc)(t)}function Bc(){}function us(e){return e==null?Bc:function(){return this.querySelector(e)}}function Uc(e){typeof e!="function"&&(e=us(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s=t[r],o=s.length,a=i[r]=new Array(o),l,u,h=0;h<o;++h)(l=s[h])&&(u=e.call(l,l.__data__,h,s))&&("__data__"in l&&(u.__data__=l.__data__),a[h]=u);return new _t(i,this._parents)}function Hc(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function qc(){return[]}function Ca(e){return e==null?qc:function(){return this.querySelectorAll(e)}}function Fc(e){return function(){return Hc(e.apply(this,arguments))}}function Gc(e){typeof e=="function"?e=Fc(e):e=Ca(e);for(var t=this._groups,n=t.length,i=[],r=[],s=0;s<n;++s)for(var o=t[s],a=o.length,l,u=0;u<a;++u)(l=o[u])&&(i.push(e.call(l,l.__data__,u,o)),r.push(l));return new _t(i,r)}function ka(e){return function(){return this.matches(e)}}function Oa(e){return function(t){return t.matches(e)}}var Xc=Array.prototype.find;function Yc(e){return function(){return Xc.call(this.children,e)}}function Vc(){return this.firstElementChild}function Kc(e){return this.select(e==null?Vc:Yc(typeof e=="function"?e:Oa(e)))}var jc=Array.prototype.filter;function Wc(){return Array.from(this.children)}function Qc(e){return function(){return jc.call(this.children,e)}}function Zc(e){return this.selectAll(e==null?Wc:Qc(typeof e=="function"?e:Oa(e)))}function Jc(e){typeof e!="function"&&(e=ka(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s=t[r],o=s.length,a=i[r]=[],l,u=0;u<o;++u)(l=s[u])&&e.call(l,l.__data__,u,s)&&a.push(l);return new _t(i,this._parents)}function La(e){return new Array(e.length)}function th(){return new _t(this._enter||this._groups.map(La),this._parents)}function ti(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}ti.prototype={constructor:ti,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function eh(e){return function(){return e}}function nh(e,t,n,i,r,s){for(var o=0,a,l=t.length,u=s.length;o<u;++o)(a=t[o])?(a.__data__=s[o],i[o]=a):n[o]=new ti(e,s[o]);for(;o<l;++o)(a=t[o])&&(r[o]=a)}function ih(e,t,n,i,r,s,o){var a,l,u=new Map,h=t.length,c=s.length,f=new Array(h),v;for(a=0;a<h;++a)(l=t[a])&&(f[a]=v=o.call(l,l.__data__,a,t)+"",u.has(v)?r[a]=l:u.set(v,l));for(a=0;a<c;++a)v=o.call(e,s[a],a,s)+"",(l=u.get(v))?(i[a]=l,l.__data__=s[a],u.delete(v)):n[a]=new ti(e,s[a]);for(a=0;a<h;++a)(l=t[a])&&u.get(f[a])===l&&(r[a]=l)}function rh(e){return e.__data__}function sh(e,t){if(!arguments.length)return Array.from(this,rh);var n=t?ih:nh,i=this._parents,r=this._groups;typeof e!="function"&&(e=eh(e));for(var s=r.length,o=new Array(s),a=new Array(s),l=new Array(s),u=0;u<s;++u){var h=i[u],c=r[u],f=c.length,v=oh(e.call(h,h&&h.__data__,u,i)),S=v.length,A=a[u]=new Array(S),N=o[u]=new Array(S),I=l[u]=new Array(f);n(h,c,A,N,I,v,t);for(var E=0,C=0,P,k;E<S;++E)if(P=A[E]){for(E>=C&&(C=E+1);!(k=N[C])&&++C<S;);P._next=k||null}}return o=new _t(o,i),o._enter=a,o._exit=l,o}function oh(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function ah(){return new _t(this._exit||this._groups.map(La),this._parents)}function lh(e,t,n){var i=this.enter(),r=this,s=this.exit();return typeof e=="function"?(i=e(i),i&&(i=i.selection())):i=i.append(e+""),t!=null&&(r=t(r),r&&(r=r.selection())),n==null?s.remove():n(s),i&&r?i.merge(r).order():r}function uh(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,r=n.length,s=i.length,o=Math.min(r,s),a=new Array(r),l=0;l<o;++l)for(var u=n[l],h=i[l],c=u.length,f=a[l]=new Array(c),v,S=0;S<c;++S)(v=u[S]||h[S])&&(f[S]=v);for(;l<r;++l)a[l]=n[l];return new _t(a,this._parents)}function ch(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i=e[t],r=i.length-1,s=i[r],o;--r>=0;)(o=i[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function hh(e){e||(e=fh);function t(c,f){return c&&f?e(c.__data__,f.__data__):!c-!f}for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o=n[s],a=o.length,l=r[s]=new Array(a),u,h=0;h<a;++h)(u=o[h])&&(l[h]=u);l.sort(t)}return new _t(r,this._parents).order()}function fh(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function dh(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function ph(){return Array.from(this)}function gh(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null}function mh(){let e=0;for(const t of this)++e;return e}function yh(){return!this.node()}function vh(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var r=t[n],s=0,o=r.length,a;s<o;++s)(a=r[s])&&e.call(a,a.__data__,s,r);return this}function wh(e){return function(){this.removeAttribute(e)}}function _h(e){return function(){this.removeAttributeNS(e.space,e.local)}}function xh(e,t){return function(){this.setAttribute(e,t)}}function Mh(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Sh(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function bh(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function $h(e,t){var n=Li(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((t==null?n.local?_h:wh:typeof t=="function"?n.local?bh:Sh:n.local?Mh:xh)(n,t))}function Ra(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Eh(e){return function(){this.style.removeProperty(e)}}function Ah(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Ih(e,t,n){return function(){var i=t.apply(this,arguments);i==null?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function Th(e,t,n){return arguments.length>1?this.each((t==null?Eh:typeof t=="function"?Ih:Ah)(e,t,n??"")):Ce(this.node(),e)}function Ce(e,t){return e.style.getPropertyValue(t)||Ra(e).getComputedStyle(e,null).getPropertyValue(t)}function Nh(e){return function(){delete this[e]}}function Ph(e,t){return function(){this[e]=t}}function Ch(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function kh(e,t){return arguments.length>1?this.each((t==null?Nh:typeof t=="function"?Ch:Ph)(e,t)):this.node()[e]}function Da(e){return e.trim().split(/^|\s+/)}function cs(e){return e.classList||new za(e)}function za(e){this._node=e,this._names=Da(e.getAttribute("class")||"")}za.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Ba(e,t){for(var n=cs(e),i=-1,r=t.length;++i<r;)n.add(t[i])}function Ua(e,t){for(var n=cs(e),i=-1,r=t.length;++i<r;)n.remove(t[i])}function Oh(e){return function(){Ba(this,e)}}function Lh(e){return function(){Ua(this,e)}}function Rh(e,t){return function(){(t.apply(this,arguments)?Ba:Ua)(this,e)}}function Dh(e,t){var n=Da(e+"");if(arguments.length<2){for(var i=cs(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?Rh:t?Oh:Lh)(n,t))}function zh(){this.textContent=""}function Bh(e){return function(){this.textContent=e}}function Uh(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Hh(e){return arguments.length?this.each(e==null?zh:(typeof e=="function"?Uh:Bh)(e)):this.node().textContent}function qh(){this.innerHTML=""}function Fh(e){return function(){this.innerHTML=e}}function Gh(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Xh(e){return arguments.length?this.each(e==null?qh:(typeof e=="function"?Gh:Fh)(e)):this.node().innerHTML}function Yh(){this.nextSibling&&this.parentNode.appendChild(this)}function Vh(){return this.each(Yh)}function Kh(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function jh(){return this.each(Kh)}function Wh(e){var t=typeof e=="function"?e:Pa(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Qh(){return null}function Zh(e,t){var n=typeof e=="function"?e:Pa(e),i=t==null?Qh:typeof t=="function"?t:us(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function Jh(){var e=this.parentNode;e&&e.removeChild(this)}function tf(){return this.each(Jh)}function ef(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function nf(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function rf(e){return this.select(e?nf:ef)}function sf(e){return arguments.length?this.property("__data__",e):this.node().__data__}function of(e){return function(t){e.call(this,t,this.__data__)}}function af(e){return e.trim().split(/^|\s+/).map(function(t){var n="",i=t.indexOf(".");return i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),{type:t,name:n}})}function lf(e){return function(){var t=this.__on;if(t){for(var n=0,i=-1,r=t.length,s;n<r;++n)s=t[n],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.options):t[++i]=s;++i?t.length=i:delete this.__on}}}function uf(e,t,n){return function(){var i=this.__on,r,s=of(t);if(i){for(var o=0,a=i.length;o<a;++o)if((r=i[o]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),r.value=t;return}}this.addEventListener(e.type,s,n),r={type:e.type,name:e.name,value:t,listener:s,options:n},i?i.push(r):this.__on=[r]}}function cf(e,t,n){var i=af(e+""),r,s=i.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,u=a.length,h;l<u;++l)for(r=0,h=a[l];r<s;++r)if((o=i[r]).type===h.type&&o.name===h.name)return h.value}return}for(a=t?uf:lf,r=0;r<s;++r)this.each(a(i[r],t,n));return this}function Ha(e,t,n){var i=Ra(e),r=i.CustomEvent;typeof r=="function"?r=new r(t,n):(r=i.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function hf(e,t){return function(){return Ha(this,e,t)}}function ff(e,t){return function(){return Ha(this,e,t.apply(this,arguments))}}function df(e,t){return this.each((typeof t=="function"?ff:hf)(e,t))}function*pf(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,s=i.length,o;r<s;++r)(o=i[r])&&(yield o)}var qa=[null];function _t(e,t){this._groups=e,this._parents=t}function wn(){return new _t([[document.documentElement]],qa)}function gf(){return this}_t.prototype=wn.prototype={constructor:_t,select:Uc,selectAll:Gc,selectChild:Kc,selectChildren:Zc,filter:Jc,data:sh,enter:th,exit:ah,join:lh,merge:uh,selection:gf,order:ch,sort:hh,call:dh,nodes:ph,node:gh,size:mh,empty:yh,each:vh,attr:$h,style:Th,property:kh,classed:Dh,text:Hh,html:Xh,raise:Vh,lower:jh,append:Wh,insert:Zh,remove:tf,clone:rf,datum:sf,on:cf,dispatch:df,[Symbol.iterator]:pf};function st(e){return typeof e=="string"?new _t([[document.querySelector(e)]],[document.documentElement]):new _t([[e]],qa)}function Fa(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Rt(e,t){if(e=Fa(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}}return[e.pageX,e.pageY]}function mf(e,t){return e.target&&(e=Fa(e),t===void 0&&(t=e.currentTarget),e=e.touches||[e]),Array.from(e,n=>Rt(n,t))}const yf={passive:!1},un={capture:!0,passive:!1};function ji(e){e.stopImmediatePropagation()}function Te(e){e.preventDefault(),e.stopImmediatePropagation()}function Ga(e){var t=e.document.documentElement,n=st(e).on("dragstart.drag",Te,un);"onselectstart"in t?n.on("selectstart.drag",Te,un):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Xa(e,t){var n=e.document.documentElement,i=st(e).on("dragstart.drag",null);t&&(i.on("click.drag",Te,un),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const En=e=>()=>e;function fr(e,{sourceEvent:t,subject:n,target:i,identifier:r,active:s,x:o,y:a,dx:l,dy:u,dispatch:h}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:h}})}fr.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function vf(e){return!e.ctrlKey&&!e.button}function wf(){return this.parentNode}function _f(e,t){return t??{x:e.x,y:e.y}}function xf(){return navigator.maxTouchPoints||"ontouchstart"in this}function Mf(){var e=vf,t=wf,n=_f,i=xf,r={},s=Oi("start","drag","end"),o=0,a,l,u,h,c=0;function f(P){P.on("mousedown.drag",v).filter(i).on("touchstart.drag",N).on("touchmove.drag",I,yf).on("touchend.drag touchcancel.drag",E).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function v(P,k){if(!(h||!e.call(this,P,k))){var O=C(this,t.call(this,P,k),P,k,"mouse");O&&(st(P.view).on("mousemove.drag",S,un).on("mouseup.drag",A,un),Ga(P.view),ji(P),u=!1,a=P.clientX,l=P.clientY,O("start",P))}}function S(P){if(Te(P),!u){var k=P.clientX-a,O=P.clientY-l;u=k*k+O*O>c}r.mouse("drag",P)}function A(P){st(P.view).on("mousemove.drag mouseup.drag",null),Xa(P.view,u),Te(P),r.mouse("end",P)}function N(P,k){if(e.call(this,P,k)){var O=P.changedTouches,D=t.call(this,P,k),d=O.length,g,w;for(g=0;g<d;++g)(w=C(this,D,P,k,O[g].identifier,O[g]))&&(ji(P),w("start",P,O[g]))}}function I(P){var k=P.changedTouches,O=k.length,D,d;for(D=0;D<O;++D)(d=r[k[D].identifier])&&(Te(P),d("drag",P,k[D]))}function E(P){var k=P.changedTouches,O=k.length,D,d;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),D=0;D<O;++D)(d=r[k[D].identifier])&&(ji(P),d("end",P,k[D]))}function C(P,k,O,D,d,g){var w=s.copy(),_=Rt(g||O,k),M,$,y;if((y=n.call(P,new fr("beforestart",{sourceEvent:O,target:f,identifier:d,active:o,x:_[0],y:_[1],dx:0,dy:0,dispatch:w}),D))!=null)return M=y.x-_[0]||0,$=y.y-_[1]||0,function p(m,x,b){var T=_,L;switch(m){case"start":r[d]=p,L=o++;break;case"end":delete r[d],--o;case"drag":_=Rt(b||x,k),L=o;break}w.call(m,P,new fr(m,{sourceEvent:x,subject:y,target:f,identifier:d,active:L,x:_[0]+M,y:_[1]+$,dx:_[0]-T[0],dy:_[1]-T[1],dispatch:w}),D)}}return f.filter=function(P){return arguments.length?(e=typeof P=="function"?P:En(!!P),f):e},f.container=function(P){return arguments.length?(t=typeof P=="function"?P:En(P),f):t},f.subject=function(P){return arguments.length?(n=typeof P=="function"?P:En(P),f):n},f.touchable=function(P){return arguments.length?(i=typeof P=="function"?P:En(!!P),f):i},f.on=function(){var P=s.on.apply(s,arguments);return P===s?f:P},f.clickDistance=function(P){return arguments.length?(c=(P=+P)*P,f):Math.sqrt(c)},f}function hs(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Ya(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function _n(){}var cn=.7,ei=1/cn,Ne="\\s*([+-]?\\d+)\\s*",hn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ht="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Sf=/^#([0-9a-f]{3,8})$/,bf=new RegExp(`^rgb\\(${Ne},${Ne},${Ne}\\)$`),$f=new RegExp(`^rgb\\(${Ht},${Ht},${Ht}\\)$`),Ef=new RegExp(`^rgba\\(${Ne},${Ne},${Ne},${hn}\\)$`),Af=new RegExp(`^rgba\\(${Ht},${Ht},${Ht},${hn}\\)$`),If=new RegExp(`^hsl\\(${hn},${Ht},${Ht}\\)$`),Tf=new RegExp(`^hsla\\(${hn},${Ht},${Ht},${hn}\\)$`),no={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};hs(_n,fn,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:io,formatHex:io,formatHex8:Nf,formatHsl:Pf,formatRgb:ro,toString:ro});function io(){return this.rgb().formatHex()}function Nf(){return this.rgb().formatHex8()}function Pf(){return Va(this).formatHsl()}function ro(){return this.rgb().formatRgb()}function fn(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Sf.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?so(t):n===3?new yt(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?An(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?An(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=bf.exec(e))?new yt(t[1],t[2],t[3],1):(t=$f.exec(e))?new yt(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Ef.exec(e))?An(t[1],t[2],t[3],t[4]):(t=Af.exec(e))?An(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=If.exec(e))?lo(t[1],t[2]/100,t[3]/100,1):(t=Tf.exec(e))?lo(t[1],t[2]/100,t[3]/100,t[4]):no.hasOwnProperty(e)?so(no[e]):e==="transparent"?new yt(NaN,NaN,NaN,0):null}function so(e){return new yt(e>>16&255,e>>8&255,e&255,1)}function An(e,t,n,i){return i<=0&&(e=t=n=NaN),new yt(e,t,n,i)}function Cf(e){return e instanceof _n||(e=fn(e)),e?(e=e.rgb(),new yt(e.r,e.g,e.b,e.opacity)):new yt}function dr(e,t,n,i){return arguments.length===1?Cf(e):new yt(e,t,n,i??1)}function yt(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}hs(yt,dr,Ya(_n,{brighter(e){return e=e==null?ei:Math.pow(ei,e),new yt(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?cn:Math.pow(cn,e),new yt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new yt(me(this.r),me(this.g),me(this.b),ni(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:oo,formatHex:oo,formatHex8:kf,formatRgb:ao,toString:ao}));function oo(){return`#${he(this.r)}${he(this.g)}${he(this.b)}`}function kf(){return`#${he(this.r)}${he(this.g)}${he(this.b)}${he((isNaN(this.opacity)?1:this.opacity)*255)}`}function ao(){const e=ni(this.opacity);return`${e===1?"rgb(":"rgba("}${me(this.r)}, ${me(this.g)}, ${me(this.b)}${e===1?")":`, ${e})`}`}function ni(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function me(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function he(e){return e=me(e),(e<16?"0":"")+e.toString(16)}function lo(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Pt(e,t,n,i)}function Va(e){if(e instanceof Pt)return new Pt(e.h,e.s,e.l,e.opacity);if(e instanceof _n||(e=fn(e)),!e)return new Pt;if(e instanceof Pt)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),s=Math.max(t,n,i),o=NaN,a=s-r,l=(s+r)/2;return a?(t===s?o=(n-i)/a+(n<i)*6:n===s?o=(i-t)/a+2:o=(t-n)/a+4,a/=l<.5?s+r:2-s-r,o*=60):a=l>0&&l<1?0:o,new Pt(o,a,l,e.opacity)}function Of(e,t,n,i){return arguments.length===1?Va(e):new Pt(e,t,n,i??1)}function Pt(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}hs(Pt,Of,Ya(_n,{brighter(e){return e=e==null?ei:Math.pow(ei,e),new Pt(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?cn:Math.pow(cn,e),new Pt(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new yt(Wi(e>=240?e-240:e+120,r,i),Wi(e,r,i),Wi(e<120?e+240:e-120,r,i),this.opacity)},clamp(){return new Pt(uo(this.h),In(this.s),In(this.l),ni(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=ni(this.opacity);return`${e===1?"hsl(":"hsla("}${uo(this.h)}, ${In(this.s)*100}%, ${In(this.l)*100}%${e===1?")":`, ${e})`}`}}));function uo(e){return e=(e||0)%360,e<0?e+360:e}function In(e){return Math.max(0,Math.min(1,e||0))}function Wi(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Ka=e=>()=>e;function Lf(e,t){return function(n){return e+n*t}}function Rf(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function Df(e){return(e=+e)==1?ja:function(t,n){return n-t?Rf(t,n,e):Ka(isNaN(t)?n:t)}}function ja(e,t){var n=t-e;return n?Lf(e,n):Ka(isNaN(e)?t:e)}const co=(function e(t){var n=Df(t);function i(r,s){var o=n((r=dr(r)).r,(s=dr(s)).r),a=n(r.g,s.g),l=n(r.b,s.b),u=ja(r.opacity,s.opacity);return function(h){return r.r=o(h),r.g=a(h),r.b=l(h),r.opacity=u(h),r+""}}return i.gamma=e,i})(1);function ne(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var pr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Qi=new RegExp(pr.source,"g");function zf(e){return function(){return e}}function Bf(e){return function(t){return e(t)+""}}function Uf(e,t){var n=pr.lastIndex=Qi.lastIndex=0,i,r,s,o=-1,a=[],l=[];for(e=e+"",t=t+"";(i=pr.exec(e))&&(r=Qi.exec(t));)(s=r.index)>n&&(s=t.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(i=i[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,l.push({i:o,x:ne(i,r)})),n=Qi.lastIndex;return n<t.length&&(s=t.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?Bf(l[0].x):zf(t):(t=l.length,function(u){for(var h=0,c;h<t;++h)a[(c=l[h]).i]=c.x(u);return a.join("")})}var ho=180/Math.PI,gr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Wa(e,t,n,i,r,s){var o,a,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*i)&&(n-=e*l,i-=t*l),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,l/=a),e*i<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(t,e)*ho,skewX:Math.atan(l)*ho,scaleX:o,scaleY:a}}var Tn;function Hf(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?gr:Wa(t.a,t.b,t.c,t.d,t.e,t.f)}function qf(e){return e==null||(Tn||(Tn=document.createElementNS("http://www.w3.org/2000/svg","g")),Tn.setAttribute("transform",e),!(e=Tn.transform.baseVal.consolidate()))?gr:(e=e.matrix,Wa(e.a,e.b,e.c,e.d,e.e,e.f))}function Qa(e,t,n,i){function r(u){return u.length?u.pop()+" ":""}function s(u,h,c,f,v,S){if(u!==c||h!==f){var A=v.push("translate(",null,t,null,n);S.push({i:A-4,x:ne(u,c)},{i:A-2,x:ne(h,f)})}else(c||f)&&v.push("translate("+c+t+f+n)}function o(u,h,c,f){u!==h?(u-h>180?h+=360:h-u>180&&(u+=360),f.push({i:c.push(r(c)+"rotate(",null,i)-2,x:ne(u,h)})):h&&c.push(r(c)+"rotate("+h+i)}function a(u,h,c,f){u!==h?f.push({i:c.push(r(c)+"skewX(",null,i)-2,x:ne(u,h)}):h&&c.push(r(c)+"skewX("+h+i)}function l(u,h,c,f,v,S){if(u!==c||h!==f){var A=v.push(r(v)+"scale(",null,",",null,")");S.push({i:A-4,x:ne(u,c)},{i:A-2,x:ne(h,f)})}else(c!==1||f!==1)&&v.push(r(v)+"scale("+c+","+f+")")}return function(u,h){var c=[],f=[];return u=e(u),h=e(h),s(u.translateX,u.translateY,h.translateX,h.translateY,c,f),o(u.rotate,h.rotate,c,f),a(u.skewX,h.skewX,c,f),l(u.scaleX,u.scaleY,h.scaleX,h.scaleY,c,f),u=h=null,function(v){for(var S=-1,A=f.length,N;++S<A;)c[(N=f[S]).i]=N.x(v);return c.join("")}}}var Ff=Qa(Hf,"px, ","px)","deg)"),Gf=Qa(qf,", ",")",")"),Xf=1e-12;function fo(e){return((e=Math.exp(e))+1/e)/2}function Yf(e){return((e=Math.exp(e))-1/e)/2}function Vf(e){return((e=Math.exp(2*e))-1)/(e+1)}const Kf=(function e(t,n,i){function r(s,o){var a=s[0],l=s[1],u=s[2],h=o[0],c=o[1],f=o[2],v=h-a,S=c-l,A=v*v+S*S,N,I;if(A<Xf)I=Math.log(f/u)/t,N=function(D){return[a+D*v,l+D*S,u*Math.exp(t*D*I)]};else{var E=Math.sqrt(A),C=(f*f-u*u+i*A)/(2*u*n*E),P=(f*f-u*u-i*A)/(2*f*n*E),k=Math.log(Math.sqrt(C*C+1)-C),O=Math.log(Math.sqrt(P*P+1)-P);I=(O-k)/t,N=function(D){var d=D*I,g=fo(k),w=u/(n*E)*(g*Vf(t*d+k)-Yf(k));return[a+w*v,l+w*S,u*g/fo(t*d+k)]}}return N.duration=I*1e3*t/Math.SQRT2,N}return r.rho=function(s){var o=Math.max(.001,+s),a=o*o,l=a*a;return e(o,a,l)},r})(Math.SQRT2,2,4);var ke=0,Ke=0,Xe=0,Za=1e3,ii,je,ri=0,we=0,Ri=0,dn=typeof performance=="object"&&performance.now?performance:Date,Ja=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function fs(){return we||(Ja(jf),we=dn.now()+Ri)}function jf(){we=0}function si(){this._call=this._time=this._next=null}si.prototype=tl.prototype={constructor:si,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?fs():+n)+(t==null?0:+t),!this._next&&je!==this&&(je?je._next=this:ii=this,je=this),this._call=e,this._time=n,mr()},stop:function(){this._call&&(this._call=null,this._time=1/0,mr())}};function tl(e,t,n){var i=new si;return i.restart(e,t,n),i}function Wf(){fs(),++ke;for(var e=ii,t;e;)(t=we-e._time)>=0&&e._call.call(void 0,t),e=e._next;--ke}function po(){we=(ri=dn.now())+Ri,ke=Ke=0;try{Wf()}finally{ke=0,Zf(),we=0}}function Qf(){var e=dn.now(),t=e-ri;t>Za&&(Ri-=t,ri=e)}function Zf(){for(var e,t=ii,n,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:ii=n);je=e,mr(i)}function mr(e){if(!ke){Ke&&(Ke=clearTimeout(Ke));var t=e-we;t>24?(e<1/0&&(Ke=setTimeout(po,e-dn.now()-Ri)),Xe&&(Xe=clearInterval(Xe))):(Xe||(ri=dn.now(),Xe=setInterval(Qf,Za)),ke=1,Ja(po))}}function go(e,t,n){var i=new si;return t=t==null?0:+t,i.restart(r=>{i.stop(),e(r+t)},t,n),i}var Jf=Oi("start","end","cancel","interrupt"),t0=[],el=0,mo=1,yr=2,Fn=3,yo=4,vr=5,Gn=6;function Di(e,t,n,i,r,s){var o=e.__transition;if(!o)e.__transition={};else if(n in o)return;e0(e,n,{name:t,index:i,group:r,on:Jf,tween:t0,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:el})}function ds(e,t){var n=Ot(e,t);if(n.state>el)throw new Error("too late; already scheduled");return n}function Ft(e,t){var n=Ot(e,t);if(n.state>Fn)throw new Error("too late; already running");return n}function Ot(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function e0(e,t,n){var i=e.__transition,r;i[t]=n,n.timer=tl(s,0,n.time);function s(u){n.state=mo,n.timer.restart(o,n.delay,n.time),n.delay<=u&&o(u-n.delay)}function o(u){var h,c,f,v;if(n.state!==mo)return l();for(h in i)if(v=i[h],v.name===n.name){if(v.state===Fn)return go(o);v.state===yo?(v.state=Gn,v.timer.stop(),v.on.call("interrupt",e,e.__data__,v.index,v.group),delete i[h]):+h<t&&(v.state=Gn,v.timer.stop(),v.on.call("cancel",e,e.__data__,v.index,v.group),delete i[h])}if(go(function(){n.state===Fn&&(n.state=yo,n.timer.restart(a,n.delay,n.time),a(u))}),n.state=yr,n.on.call("start",e,e.__data__,n.index,n.group),n.state===yr){for(n.state=Fn,r=new Array(f=n.tween.length),h=0,c=-1;h<f;++h)(v=n.tween[h].value.call(e,e.__data__,n.index,n.group))&&(r[++c]=v);r.length=c+1}}function a(u){for(var h=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(l),n.state=vr,1),c=-1,f=r.length;++c<f;)r[c].call(e,h);n.state===vr&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){n.state=Gn,n.timer.stop(),delete i[t];for(var u in i)return;delete e.__transition}}function Xn(e,t){var n=e.__transition,i,r,s=!0,o;if(n){t=t==null?null:t+"";for(o in n){if((i=n[o]).name!==t){s=!1;continue}r=i.state>yr&&i.state<vr,i.state=Gn,i.timer.stop(),i.on.call(r?"interrupt":"cancel",e,e.__data__,i.index,i.group),delete n[o]}s&&delete e.__transition}}function n0(e){return this.each(function(){Xn(this,e)})}function i0(e,t){var n,i;return function(){var r=Ft(this,e),s=r.tween;if(s!==n){i=n=s;for(var o=0,a=i.length;o<a;++o)if(i[o].name===t){i=i.slice(),i.splice(o,1);break}}r.tween=i}}function r0(e,t,n){var i,r;if(typeof n!="function")throw new Error;return function(){var s=Ft(this,e),o=s.tween;if(o!==i){r=(i=o).slice();for(var a={name:t,value:n},l=0,u=r.length;l<u;++l)if(r[l].name===t){r[l]=a;break}l===u&&r.push(a)}s.tween=r}}function s0(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i=Ot(this.node(),n).tween,r=0,s=i.length,o;r<s;++r)if((o=i[r]).name===e)return o.value;return null}return this.each((t==null?i0:r0)(n,e,t))}function ps(e,t,n){var i=e._id;return e.each(function(){var r=Ft(this,i);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return Ot(r,i).value[t]}}function nl(e,t){var n;return(typeof t=="number"?ne:t instanceof fn?co:(n=fn(t))?(t=n,co):Uf)(e,t)}function o0(e){return function(){this.removeAttribute(e)}}function a0(e){return function(){this.removeAttributeNS(e.space,e.local)}}function l0(e,t,n){var i,r=n+"",s;return function(){var o=this.getAttribute(e);return o===r?null:o===i?s:s=t(i=o,n)}}function u0(e,t,n){var i,r=n+"",s;return function(){var o=this.getAttributeNS(e.space,e.local);return o===r?null:o===i?s:s=t(i=o,n)}}function c0(e,t,n){var i,r,s;return function(){var o,a=n(this),l;return a==null?void this.removeAttribute(e):(o=this.getAttribute(e),l=a+"",o===l?null:o===i&&l===r?s:(r=l,s=t(i=o,a)))}}function h0(e,t,n){var i,r,s;return function(){var o,a=n(this),l;return a==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),l=a+"",o===l?null:o===i&&l===r?s:(r=l,s=t(i=o,a)))}}function f0(e,t){var n=Li(e),i=n==="transform"?Gf:nl;return this.attrTween(e,typeof t=="function"?(n.local?h0:c0)(n,i,ps(this,"attr."+e,t)):t==null?(n.local?a0:o0)(n):(n.local?u0:l0)(n,i,t))}function d0(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function p0(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function g0(e,t){var n,i;function r(){var s=t.apply(this,arguments);return s!==i&&(n=(i=s)&&p0(e,s)),n}return r._value=t,r}function m0(e,t){var n,i;function r(){var s=t.apply(this,arguments);return s!==i&&(n=(i=s)&&d0(e,s)),n}return r._value=t,r}function y0(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var i=Li(e);return this.tween(n,(i.local?g0:m0)(i,t))}function v0(e,t){return function(){ds(this,e).delay=+t.apply(this,arguments)}}function w0(e,t){return t=+t,function(){ds(this,e).delay=t}}function _0(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?v0:w0)(t,e)):Ot(this.node(),t).delay}function x0(e,t){return function(){Ft(this,e).duration=+t.apply(this,arguments)}}function M0(e,t){return t=+t,function(){Ft(this,e).duration=t}}function S0(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?x0:M0)(t,e)):Ot(this.node(),t).duration}function b0(e,t){if(typeof t!="function")throw new Error;return function(){Ft(this,e).ease=t}}function $0(e){var t=this._id;return arguments.length?this.each(b0(t,e)):Ot(this.node(),t).ease}function E0(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Ft(this,e).ease=n}}function A0(e){if(typeof e!="function")throw new Error;return this.each(E0(this._id,e))}function I0(e){typeof e!="function"&&(e=ka(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s=t[r],o=s.length,a=i[r]=[],l,u=0;u<o;++u)(l=s[u])&&e.call(l,l.__data__,u,s)&&a.push(l);return new Wt(i,this._parents,this._name,this._id)}function T0(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,r=n.length,s=Math.min(i,r),o=new Array(i),a=0;a<s;++a)for(var l=t[a],u=n[a],h=l.length,c=o[a]=new Array(h),f,v=0;v<h;++v)(f=l[v]||u[v])&&(c[v]=f);for(;a<i;++a)o[a]=t[a];return new Wt(o,this._parents,this._name,this._id)}function N0(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function P0(e,t,n){var i,r,s=N0(t)?ds:Ft;return function(){var o=s(this,e),a=o.on;a!==i&&(r=(i=a).copy()).on(t,n),o.on=r}}function C0(e,t){var n=this._id;return arguments.length<2?Ot(this.node(),n).on.on(e):this.each(P0(n,e,t))}function k0(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function O0(){return this.on("end.remove",k0(this._id))}function L0(e){var t=this._name,n=this._id;typeof e!="function"&&(e=us(e));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var a=i[o],l=a.length,u=s[o]=new Array(l),h,c,f=0;f<l;++f)(h=a[f])&&(c=e.call(h,h.__data__,f,a))&&("__data__"in h&&(c.__data__=h.__data__),u[f]=c,Di(u[f],t,n,f,u,Ot(h,n)));return new Wt(s,this._parents,t,n)}function R0(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Ca(e));for(var i=this._groups,r=i.length,s=[],o=[],a=0;a<r;++a)for(var l=i[a],u=l.length,h,c=0;c<u;++c)if(h=l[c]){for(var f=e.call(h,h.__data__,c,l),v,S=Ot(h,n),A=0,N=f.length;A<N;++A)(v=f[A])&&Di(v,t,n,A,f,S);s.push(f),o.push(h)}return new Wt(s,o,t,n)}var D0=wn.prototype.constructor;function z0(){return new D0(this._groups,this._parents)}function B0(e,t){var n,i,r;return function(){var s=Ce(this,e),o=(this.style.removeProperty(e),Ce(this,e));return s===o?null:s===n&&o===i?r:r=t(n=s,i=o)}}function il(e){return function(){this.style.removeProperty(e)}}function U0(e,t,n){var i,r=n+"",s;return function(){var o=Ce(this,e);return o===r?null:o===i?s:s=t(i=o,n)}}function H0(e,t,n){var i,r,s;return function(){var o=Ce(this,e),a=n(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(e),Ce(this,e))),o===l?null:o===i&&l===r?s:(r=l,s=t(i=o,a))}}function q0(e,t){var n,i,r,s="style."+t,o="end."+s,a;return function(){var l=Ft(this,e),u=l.on,h=l.value[s]==null?a||(a=il(t)):void 0;(u!==n||r!==h)&&(i=(n=u).copy()).on(o,r=h),l.on=i}}function F0(e,t,n){var i=(e+="")=="transform"?Ff:nl;return t==null?this.styleTween(e,B0(e,i)).on("end.style."+e,il(e)):typeof t=="function"?this.styleTween(e,H0(e,i,ps(this,"style."+e,t))).each(q0(this._id,e)):this.styleTween(e,U0(e,i,t),n).on("end.style."+e,null)}function G0(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}function X0(e,t,n){var i,r;function s(){var o=t.apply(this,arguments);return o!==r&&(i=(r=o)&&G0(e,o,n)),i}return s._value=t,s}function Y0(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;return this.tween(i,X0(e,t,n??""))}function V0(e){return function(){this.textContent=e}}function K0(e){return function(){var t=e(this);this.textContent=t??""}}function j0(e){return this.tween("text",typeof e=="function"?K0(ps(this,"text",e)):V0(e==null?"":e+""))}function W0(e){return function(t){this.textContent=e.call(this,t)}}function Q0(e){var t,n;function i(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&W0(r)),t}return i._value=e,i}function Z0(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Q0(e))}function J0(){for(var e=this._name,t=this._id,n=rl(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],a=o.length,l,u=0;u<a;++u)if(l=o[u]){var h=Ot(l,t);Di(l,e,n,u,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new Wt(i,this._parents,e,n)}function td(){var e,t,n=this,i=n._id,r=n.size();return new Promise(function(s,o){var a={value:o},l={value:function(){--r===0&&s()}};n.each(function(){var u=Ft(this,i),h=u.on;h!==e&&(t=(e=h).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),u.on=t}),r===0&&s()})}var ed=0;function Wt(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function rl(){return++ed}var Yt=wn.prototype;Wt.prototype={constructor:Wt,select:L0,selectAll:R0,selectChild:Yt.selectChild,selectChildren:Yt.selectChildren,filter:I0,merge:T0,selection:z0,transition:J0,call:Yt.call,nodes:Yt.nodes,node:Yt.node,size:Yt.size,empty:Yt.empty,each:Yt.each,on:C0,attr:f0,attrTween:y0,style:F0,styleTween:Y0,text:j0,textTween:Z0,remove:O0,tween:s0,delay:_0,duration:S0,ease:$0,easeVarying:A0,end:td,[Symbol.iterator]:Yt[Symbol.iterator]};function nd(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var id={time:null,delay:0,duration:250,ease:nd};function rd(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function sd(e){var t,n;e instanceof Wt?(t=e._id,e=e._name):(t=rl(),(n=id).time=fs(),e=e==null?null:e+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],a=o.length,l,u=0;u<a;++u)(l=o[u])&&Di(l,e,t,u,o,n||rd(l,t));return new Wt(i,this._parents,e,t)}wn.prototype.interrupt=n0;wn.prototype.transition=sd;const jt=11102230246251565e-32,ot=134217729,od=(3+8*jt)*jt;function Zi(e,t,n,i,r){let s,o,a,l,u=t[0],h=i[0],c=0,f=0;h>u==h>-u?(s=u,u=t[++c]):(s=h,h=i[++f]);let v=0;if(c<e&&f<n)for(h>u==h>-u?(o=u+s,a=s-(o-u),u=t[++c]):(o=h+s,a=s-(o-h),h=i[++f]),s=o,a!==0&&(r[v++]=a);c<e&&f<n;)h>u==h>-u?(o=s+u,l=o-s,a=s-(o-l)+(u-l),u=t[++c]):(o=s+h,l=o-s,a=s-(o-l)+(h-l),h=i[++f]),s=o,a!==0&&(r[v++]=a);for(;c<e;)o=s+u,l=o-s,a=s-(o-l)+(u-l),u=t[++c],s=o,a!==0&&(r[v++]=a);for(;f<n;)o=s+h,l=o-s,a=s-(o-l)+(h-l),h=i[++f],s=o,a!==0&&(r[v++]=a);return(s!==0||v===0)&&(r[v++]=s),v}function ad(e,t){let n=t[0];for(let i=1;i<e;i++)n+=t[i];return n}function xn(e){return new Float64Array(e)}const ld=(3+16*jt)*jt,ud=(2+12*jt)*jt,cd=(9+64*jt)*jt*jt,xe=xn(4),vo=xn(8),wo=xn(12),_o=xn(16),ut=xn(4);function hd(e,t,n,i,r,s,o){let a,l,u,h,c,f,v,S,A,N,I,E,C,P,k,O,D,d;const g=e-r,w=n-r,_=t-s,M=i-s;P=g*M,f=ot*g,v=f-(f-g),S=g-v,f=ot*M,A=f-(f-M),N=M-A,k=S*N-(P-v*A-S*A-v*N),O=_*w,f=ot*_,v=f-(f-_),S=_-v,f=ot*w,A=f-(f-w),N=w-A,D=S*N-(O-v*A-S*A-v*N),I=k-D,c=k-I,xe[0]=k-(I+c)+(c-D),E=P+I,c=E-P,C=P-(E-c)+(I-c),I=C-O,c=C-I,xe[1]=C-(I+c)+(c-O),d=E+I,c=d-E,xe[2]=E-(d-c)+(I-c),xe[3]=d;let $=ad(4,xe),y=ud*o;if($>=y||-$>=y||(c=e-g,a=e-(g+c)+(c-r),c=n-w,u=n-(w+c)+(c-r),c=t-_,l=t-(_+c)+(c-s),c=i-M,h=i-(M+c)+(c-s),a===0&&l===0&&u===0&&h===0)||(y=cd*o+od*Math.abs($),$+=g*h+M*a-(_*u+w*l),$>=y||-$>=y))return $;P=a*M,f=ot*a,v=f-(f-a),S=a-v,f=ot*M,A=f-(f-M),N=M-A,k=S*N-(P-v*A-S*A-v*N),O=l*w,f=ot*l,v=f-(f-l),S=l-v,f=ot*w,A=f-(f-w),N=w-A,D=S*N-(O-v*A-S*A-v*N),I=k-D,c=k-I,ut[0]=k-(I+c)+(c-D),E=P+I,c=E-P,C=P-(E-c)+(I-c),I=C-O,c=C-I,ut[1]=C-(I+c)+(c-O),d=E+I,c=d-E,ut[2]=E-(d-c)+(I-c),ut[3]=d;const p=Zi(4,xe,4,ut,vo);P=g*h,f=ot*g,v=f-(f-g),S=g-v,f=ot*h,A=f-(f-h),N=h-A,k=S*N-(P-v*A-S*A-v*N),O=_*u,f=ot*_,v=f-(f-_),S=_-v,f=ot*u,A=f-(f-u),N=u-A,D=S*N-(O-v*A-S*A-v*N),I=k-D,c=k-I,ut[0]=k-(I+c)+(c-D),E=P+I,c=E-P,C=P-(E-c)+(I-c),I=C-O,c=C-I,ut[1]=C-(I+c)+(c-O),d=E+I,c=d-E,ut[2]=E-(d-c)+(I-c),ut[3]=d;const m=Zi(p,vo,4,ut,wo);P=a*h,f=ot*a,v=f-(f-a),S=a-v,f=ot*h,A=f-(f-h),N=h-A,k=S*N-(P-v*A-S*A-v*N),O=l*u,f=ot*l,v=f-(f-l),S=l-v,f=ot*u,A=f-(f-u),N=u-A,D=S*N-(O-v*A-S*A-v*N),I=k-D,c=k-I,ut[0]=k-(I+c)+(c-D),E=P+I,c=E-P,C=P-(E-c)+(I-c),I=C-O,c=C-I,ut[1]=C-(I+c)+(c-O),d=E+I,c=d-E,ut[2]=E-(d-c)+(I-c),ut[3]=d;const x=Zi(m,wo,4,ut,_o);return _o[x-1]}function Nn(e,t,n,i,r,s){const o=(t-s)*(n-r),a=(e-r)*(i-s),l=o-a,u=Math.abs(o+a);return Math.abs(l)>=ld*u?l:-hd(e,t,n,i,r,s,u)}const xo=Math.pow(2,-52),Pn=new Uint32Array(512);class oi{static from(t,n=md,i=yd){const r=t.length,s=new Float64Array(r*2);for(let o=0;o<r;o++){const a=t[o];s[2*o]=n(a),s[2*o+1]=i(a)}return new oi(s)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const i=Math.max(2*n-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:i,_hullTri:r,_hullHash:s}=this,o=t.length>>1;let a=1/0,l=1/0,u=-1/0,h=-1/0;for(let g=0;g<o;g++){const w=t[2*g],_=t[2*g+1];w<a&&(a=w),_<l&&(l=_),w>u&&(u=w),_>h&&(h=_),this._ids[g]=g}const c=(a+u)/2,f=(l+h)/2;let v,S,A;for(let g=0,w=1/0;g<o;g++){const _=Ji(c,f,t[2*g],t[2*g+1]);_<w&&(v=g,w=_)}const N=t[2*v],I=t[2*v+1];for(let g=0,w=1/0;g<o;g++){if(g===v)continue;const _=Ji(N,I,t[2*g],t[2*g+1]);_<w&&_>0&&(S=g,w=_)}let E=t[2*S],C=t[2*S+1],P=1/0;for(let g=0;g<o;g++){if(g===v||g===S)continue;const w=pd(N,I,E,C,t[2*g],t[2*g+1]);w<P&&(A=g,P=w)}let k=t[2*A],O=t[2*A+1];if(P===1/0){for(let _=0;_<o;_++)this._dists[_]=t[2*_]-t[0]||t[2*_+1]-t[1];Ae(this._ids,this._dists,0,o-1);const g=new Uint32Array(o);let w=0;for(let _=0,M=-1/0;_<o;_++){const $=this._ids[_],y=this._dists[$];y>M&&(g[w++]=$,M=y)}this.hull=g.subarray(0,w),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(Nn(N,I,E,C,k,O)<0){const g=S,w=E,_=C;S=A,E=k,C=O,A=g,k=w,O=_}const D=gd(N,I,E,C,k,O);this._cx=D.x,this._cy=D.y;for(let g=0;g<o;g++)this._dists[g]=Ji(t[2*g],t[2*g+1],D.x,D.y);Ae(this._ids,this._dists,0,o-1),this._hullStart=v;let d=3;i[v]=n[A]=S,i[S]=n[v]=A,i[A]=n[S]=v,r[v]=0,r[S]=1,r[A]=2,s.fill(-1),s[this._hashKey(N,I)]=v,s[this._hashKey(E,C)]=S,s[this._hashKey(k,O)]=A,this.trianglesLen=0,this._addTriangle(v,S,A,-1,-1,-1);for(let g=0,w,_;g<this._ids.length;g++){const M=this._ids[g],$=t[2*M],y=t[2*M+1];if(g>0&&Math.abs($-w)<=xo&&Math.abs(y-_)<=xo||(w=$,_=y,M===v||M===S||M===A))continue;let p=0;for(let L=0,R=this._hashKey($,y);L<this._hashSize&&(p=s[(R+L)%this._hashSize],!(p!==-1&&p!==i[p]));L++);p=n[p];let m=p,x;for(;x=i[m],Nn($,y,t[2*m],t[2*m+1],t[2*x],t[2*x+1])>=0;)if(m=x,m===p){m=-1;break}if(m===-1)continue;let b=this._addTriangle(m,M,i[m],-1,-1,r[m]);r[M]=this._legalize(b+2),r[m]=b,d++;let T=i[m];for(;x=i[T],Nn($,y,t[2*T],t[2*T+1],t[2*x],t[2*x+1])<0;)b=this._addTriangle(T,M,x,r[M],-1,r[T]),r[M]=this._legalize(b+2),i[T]=T,d--,T=x;if(m===p)for(;x=n[m],Nn($,y,t[2*x],t[2*x+1],t[2*m],t[2*m+1])<0;)b=this._addTriangle(x,M,m,-1,r[m],r[x]),this._legalize(b+2),r[x]=b,i[m]=m,d--,m=x;this._hullStart=n[M]=m,i[m]=n[T]=M,i[M]=T,s[this._hashKey($,y)]=M,s[this._hashKey(t[2*m],t[2*m+1])]=m}this.hull=new Uint32Array(d);for(let g=0,w=this._hullStart;g<d;g++)this.hull[g]=w,w=i[w];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(fd(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:i,coords:r}=this;let s=0,o=0;for(;;){const a=i[t],l=t-t%3;if(o=l+(t+2)%3,a===-1){if(s===0)break;t=Pn[--s];continue}const u=a-a%3,h=l+(t+1)%3,c=u+(a+2)%3,f=n[o],v=n[t],S=n[h],A=n[c];if(dd(r[2*f],r[2*f+1],r[2*v],r[2*v+1],r[2*S],r[2*S+1],r[2*A],r[2*A+1])){n[t]=A,n[a]=f;const I=i[c];if(I===-1){let C=this._hullStart;do{if(this._hullTri[C]===c){this._hullTri[C]=t;break}C=this._hullPrev[C]}while(C!==this._hullStart)}this._link(t,I),this._link(a,i[o]),this._link(o,c);const E=u+(a+1)%3;s<Pn.length&&(Pn[s++]=E)}else{if(s===0)break;t=Pn[--s]}}return o}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,i,r,s,o){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=n,this._triangles[a+2]=i,this._link(a,r),this._link(a+1,s),this._link(a+2,o),this.trianglesLen+=3,a}}function fd(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function Ji(e,t,n,i){const r=e-n,s=t-i;return r*r+s*s}function dd(e,t,n,i,r,s,o,a){const l=e-o,u=t-a,h=n-o,c=i-a,f=r-o,v=s-a,S=l*l+u*u,A=h*h+c*c,N=f*f+v*v;return l*(c*N-A*v)-u*(h*N-A*f)+S*(h*v-c*f)<0}function pd(e,t,n,i,r,s){const o=n-e,a=i-t,l=r-e,u=s-t,h=o*o+a*a,c=l*l+u*u,f=.5/(o*u-a*l),v=(u*h-a*c)*f,S=(o*c-l*h)*f;return v*v+S*S}function gd(e,t,n,i,r,s){const o=n-e,a=i-t,l=r-e,u=s-t,h=o*o+a*a,c=l*l+u*u,f=.5/(o*u-a*l),v=e+(u*h-a*c)*f,S=t+(o*c-l*h)*f;return{x:v,y:S}}function Ae(e,t,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){const s=e[r],o=t[s];let a=r-1;for(;a>=n&&t[e[a]]>o;)e[a+1]=e[a--];e[a+1]=s}else{const r=n+i>>1;let s=n+1,o=i;Ye(e,r,s),t[e[n]]>t[e[i]]&&Ye(e,n,i),t[e[s]]>t[e[i]]&&Ye(e,s,i),t[e[n]]>t[e[s]]&&Ye(e,n,s);const a=e[s],l=t[a];for(;;){do s++;while(t[e[s]]<l);do o--;while(t[e[o]]>l);if(o<s)break;Ye(e,s,o)}e[n+1]=e[o],e[o]=a,i-s+1>=o-n?(Ae(e,t,s,i),Ae(e,t,n,o-1)):(Ae(e,t,n,o-1),Ae(e,t,s,i))}}function Ye(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function md(e){return e[0]}function yd(e){return e[1]}const Mo=1e-6;class fe{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,i){t=+t,n=+n,i=+i;const r=t+i,s=n;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${r},${s}`:(Math.abs(this._x1-r)>Mo||Math.abs(this._y1-s)>Mo)&&(this._+="L"+r+","+s),i&&(this._+=`A${i},${i},0,1,1,${t-i},${n}A${i},${i},0,1,1,${this._x1=r},${this._y1=s}`)}rect(t,n,i,r){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+i}v${+r}h${-i}Z`}value(){return this._||null}}class wr{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}class vd{constructor(t,[n,i,r,s]=[0,0,960,500]){if(!((r=+r)>=(n=+n))||!((s=+s)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=r,this.xmin=n,this.ymax=s,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:i},vectors:r}=this;let s,o;const a=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let A=0,N=0,I=i.length,E,C;A<I;A+=3,N+=2){const P=i[A]*2,k=i[A+1]*2,O=i[A+2]*2,D=t[P],d=t[P+1],g=t[k],w=t[k+1],_=t[O],M=t[O+1],$=g-D,y=w-d,p=_-D,m=M-d,x=($*m-y*p)*2;if(Math.abs(x)<1e-9){if(s===void 0){s=o=0;for(const T of n)s+=t[T*2],o+=t[T*2+1];s/=n.length,o/=n.length}const b=1e9*Math.sign((s-D)*m-(o-d)*p);E=(D+_)/2-b*m,C=(d+M)/2+b*p}else{const b=1/x,T=$*$+y*y,L=p*p+m*m;E=D+(m*T-y*L)*b,C=d+($*L-p*T)*b}a[N]=E,a[N+1]=C}let l=n[n.length-1],u,h=l*4,c,f=t[2*l],v,S=t[2*l+1];r.fill(0);for(let A=0;A<n.length;++A)l=n[A],u=h,c=f,v=S,h=l*4,f=t[2*l],S=t[2*l+1],r[u+2]=r[h]=v-S,r[u+3]=r[h+1]=f-c}render(t){const n=t==null?t=new fe:void 0,{delaunay:{halfedges:i,inedges:r,hull:s},circumcenters:o,vectors:a}=this;if(s.length<=1)return null;for(let h=0,c=i.length;h<c;++h){const f=i[h];if(f<h)continue;const v=Math.floor(h/3)*2,S=Math.floor(f/3)*2,A=o[v],N=o[v+1],I=o[S],E=o[S+1];this._renderSegment(A,N,I,E,t)}let l,u=s[s.length-1];for(let h=0;h<s.length;++h){l=u,u=s[h];const c=Math.floor(r[u]/3)*2,f=o[c],v=o[c+1],S=l*4,A=this._project(f,v,a[S+2],a[S+3]);A&&this._renderSegment(f,v,A[0],A[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new fe:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const i=n==null?n=new fe:void 0,r=this._clip(t);if(r===null||!r.length)return;n.moveTo(r[0],r[1]);let s=r.length;for(;r[0]===r[s-2]&&r[1]===r[s-1]&&s>1;)s-=2;for(let o=2;o<s;o+=2)(r[o]!==r[o-2]||r[o+1]!==r[o-1])&&n.lineTo(r[o],r[o+1]);return n.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,i=t.length/2;n<i;++n){const r=this.cellPolygon(n);r&&(r.index=n,yield r)}}cellPolygon(t){const n=new wr;return this.renderCell(t,n),n.value()}_renderSegment(t,n,i,r,s){let o;const a=this._regioncode(t,n),l=this._regioncode(i,r);a===0&&l===0?(s.moveTo(t,n),s.lineTo(i,r)):(o=this._clipSegment(t,n,i,r,a,l))&&(s.moveTo(o[0],o[1]),s.lineTo(o[2],o[3]))}contains(t,n,i){return n=+n,n!==n||(i=+i,i!==i)?!1:this.delaunay._step(t,n,i)===t}*neighbors(t){const n=this._clip(t);if(n)for(const i of this.delaunay.neighbors(t)){const r=this._clip(i);if(r){t:for(let s=0,o=n.length;s<o;s+=2)for(let a=0,l=r.length;a<l;a+=2)if(n[s]===r[a]&&n[s+1]===r[a+1]&&n[(s+2)%o]===r[(a+l-2)%l]&&n[(s+3)%o]===r[(a+l-1)%l]){yield i;break t}}}}_cell(t){const{circumcenters:n,delaunay:{inedges:i,halfedges:r,triangles:s}}=this,o=i[t];if(o===-1)return null;const a=[];let l=o;do{const u=Math.floor(l/3);if(a.push(n[u*2],n[u*2+1]),l=l%3===2?l-2:l+1,s[l]!==t)break;l=r[l]}while(l!==o&&l!==-1);return a}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:i}=this,r=t*4;return this._simplify(i[r]||i[r+1]?this._clipInfinite(t,n,i[r],i[r+1],i[r+2],i[r+3]):this._clipFinite(t,n))}_clipFinite(t,n){const i=n.length;let r=null,s,o,a=n[i-2],l=n[i-1],u,h=this._regioncode(a,l),c,f=0;for(let v=0;v<i;v+=2)if(s=a,o=l,a=n[v],l=n[v+1],u=h,h=this._regioncode(a,l),u===0&&h===0)c=f,f=0,r?r.push(a,l):r=[a,l];else{let S,A,N,I,E;if(u===0){if((S=this._clipSegment(s,o,a,l,u,h))===null)continue;[A,N,I,E]=S}else{if((S=this._clipSegment(a,l,s,o,h,u))===null)continue;[I,E,A,N]=S,c=f,f=this._edgecode(A,N),c&&f&&this._edge(t,c,f,r,r.length),r?r.push(A,N):r=[A,N]}c=f,f=this._edgecode(I,E),c&&f&&this._edge(t,c,f,r,r.length),r?r.push(I,E):r=[I,E]}if(r)c=f,f=this._edgecode(r[0],r[1]),c&&f&&this._edge(t,c,f,r,r.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return r}_clipSegment(t,n,i,r,s,o){const a=s<o;for(a&&([t,n,i,r,s,o]=[i,r,t,n,o,s]);;){if(s===0&&o===0)return a?[i,r,t,n]:[t,n,i,r];if(s&o)return null;let l,u,h=s||o;h&8?(l=t+(i-t)*(this.ymax-n)/(r-n),u=this.ymax):h&4?(l=t+(i-t)*(this.ymin-n)/(r-n),u=this.ymin):h&2?(u=n+(r-n)*(this.xmax-t)/(i-t),l=this.xmax):(u=n+(r-n)*(this.xmin-t)/(i-t),l=this.xmin),s?(t=l,n=u,s=this._regioncode(t,n)):(i=l,r=u,o=this._regioncode(i,r))}}_clipInfinite(t,n,i,r,s,o){let a=Array.from(n),l;if((l=this._project(a[0],a[1],i,r))&&a.unshift(l[0],l[1]),(l=this._project(a[a.length-2],a[a.length-1],s,o))&&a.push(l[0],l[1]),a=this._clipFinite(t,a))for(let u=0,h=a.length,c,f=this._edgecode(a[h-2],a[h-1]);u<h;u+=2)c=f,f=this._edgecode(a[u],a[u+1]),c&&f&&(u=this._edge(t,c,f,a,u),h=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,n,i,r,s){for(;n!==i;){let o,a;switch(n){case 5:n=4;continue;case 4:n=6,o=this.xmax,a=this.ymin;break;case 6:n=2;continue;case 2:n=10,o=this.xmax,a=this.ymax;break;case 10:n=8;continue;case 8:n=9,o=this.xmin,a=this.ymax;break;case 9:n=1;continue;case 1:n=5,o=this.xmin,a=this.ymin;break}(r[s]!==o||r[s+1]!==a)&&this.contains(t,o,a)&&(r.splice(s,0,o,a),s+=2)}return s}_project(t,n,i,r){let s=1/0,o,a,l;if(r<0){if(n<=this.ymin)return null;(o=(this.ymin-n)/r)<s&&(l=this.ymin,a=t+(s=o)*i)}else if(r>0){if(n>=this.ymax)return null;(o=(this.ymax-n)/r)<s&&(l=this.ymax,a=t+(s=o)*i)}if(i>0){if(t>=this.xmax)return null;(o=(this.xmax-t)/i)<s&&(a=this.xmax,l=n+(s=o)*r)}else if(i<0){if(t<=this.xmin)return null;(o=(this.xmin-t)/i)<s&&(a=this.xmin,l=n+(s=o)*r)}return[a,l]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}_simplify(t){if(t&&t.length>4){for(let n=0;n<t.length;n+=2){const i=(n+2)%t.length,r=(n+4)%t.length;(t[n]===t[i]&&t[i]===t[r]||t[n+1]===t[i+1]&&t[i+1]===t[r+1])&&(t.splice(i,2),n-=2)}t.length||(t=null)}return t}}const wd=2*Math.PI,Me=Math.pow;function _d(e){return e[0]}function xd(e){return e[1]}function Md(e){const{triangles:t,coords:n}=e;for(let i=0;i<t.length;i+=3){const r=2*t[i],s=2*t[i+1],o=2*t[i+2];if((n[o]-n[r])*(n[s+1]-n[r+1])-(n[s]-n[r])*(n[o+1]-n[r+1])>1e-10)return!1}return!0}function Sd(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class gs{static from(t,n=_d,i=xd,r){return new gs("length"in t?bd(t,n,i,r):Float64Array.from($d(t,n,i,r)))}constructor(t){this._delaunator=new oi(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&Md(t)){this.collinear=Int32Array.from({length:n.length/2},(f,v)=>v).sort((f,v)=>n[2*f]-n[2*v]||n[2*f+1]-n[2*v+1]);const l=this.collinear[0],u=this.collinear[this.collinear.length-1],h=[n[2*l],n[2*l+1],n[2*u],n[2*u+1]],c=1e-8*Math.hypot(h[3]-h[1],h[2]-h[0]);for(let f=0,v=n.length/2;f<v;++f){const S=Sd(n[2*f],n[2*f+1],c);n[2*f]=S[0],n[2*f+1]=S[1]}this._delaunator=new oi(n)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let l=0,u=i.length;l<u;++l){const h=s[l%3===2?l-2:l+1];(i[l]===-1||o[h]===-1)&&(o[h]=l)}for(let l=0,u=r.length;l<u;++l)a[r[l]]=l;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],o[r[0]]=1,r.length===2&&(o[r[1]]=0,this.triangles[1]=r[1],this.triangles[2]=r[1]))}voronoi(t){return new vd(this,t)}*neighbors(t){const{inedges:n,hull:i,_hullIndex:r,halfedges:s,triangles:o,collinear:a}=this;if(a){const c=a.indexOf(t);c>0&&(yield a[c-1]),c<a.length-1&&(yield a[c+1]);return}const l=n[t];if(l===-1)return;let u=l,h=-1;do{if(yield h=o[u],u=u%3===2?u-2:u+1,o[u]!==t)return;if(u=s[u],u===-1){const c=i[(r[t]+1)%i.length];c!==h&&(yield c);return}}while(u!==l)}find(t,n,i=0){if(t=+t,t!==t||(n=+n,n!==n))return-1;const r=i;let s;for(;(s=this._step(i,t,n))>=0&&s!==i&&s!==r;)i=s;return s}_step(t,n,i){const{inedges:r,hull:s,_hullIndex:o,halfedges:a,triangles:l,points:u}=this;if(r[t]===-1||!u.length)return(t+1)%(u.length>>1);let h=t,c=Me(n-u[t*2],2)+Me(i-u[t*2+1],2);const f=r[t];let v=f;do{let S=l[v];const A=Me(n-u[S*2],2)+Me(i-u[S*2+1],2);if(A<c&&(c=A,h=S),v=v%3===2?v-2:v+1,l[v]!==t)break;if(v=a[v],v===-1){if(v=s[(o[t]+1)%s.length],v!==S&&Me(n-u[v*2],2)+Me(i-u[v*2+1],2)<c)return v;break}}while(v!==f);return h}render(t){const n=t==null?t=new fe:void 0,{points:i,halfedges:r,triangles:s}=this;for(let o=0,a=r.length;o<a;++o){const l=r[o];if(l<o)continue;const u=s[o]*2,h=s[l]*2;t.moveTo(i[u],i[u+1]),t.lineTo(i[h],i[h+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n){n===void 0&&(!t||typeof t.moveTo!="function")&&(n=t,t=null),n=n==null?2:+n;const i=t==null?t=new fe:void 0,{points:r}=this;for(let s=0,o=r.length;s<o;s+=2){const a=r[s],l=r[s+1];t.moveTo(a+n,l),t.arc(a,l,n,0,wd)}return i&&i.value()}renderHull(t){const n=t==null?t=new fe:void 0,{hull:i,points:r}=this,s=i[0]*2,o=i.length;t.moveTo(r[s],r[s+1]);for(let a=1;a<o;++a){const l=2*i[a];t.lineTo(r[l],r[l+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new wr;return this.renderHull(t),t.value()}renderTriangle(t,n){const i=n==null?n=new fe:void 0,{points:r,triangles:s}=this,o=s[t*=3]*2,a=s[t+1]*2,l=s[t+2]*2;return n.moveTo(r[o],r[o+1]),n.lineTo(r[a],r[a+1]),n.lineTo(r[l],r[l+1]),n.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,i=t.length/3;n<i;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new wr;return this.renderTriangle(t,n),n.value()}}function bd(e,t,n,i){const r=e.length,s=new Float64Array(r*2);for(let o=0;o<r;++o){const a=e[o];s[o*2]=t.call(i,a,o,e),s[o*2+1]=n.call(i,a,o,e)}return s}function*$d(e,t,n,i){let r=0;for(const s of e)yield t.call(i,s,r,e),yield n.call(i,s,r,e),++r}function Ed(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function ai(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function Ad(e){return e=ai(Math.abs(e)),e?e[1]:NaN}function Id(e,t){return function(n,i){for(var r=n.length,s=[],o=0,a=e[0],l=0;r>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),s.push(n.substring(r-=a,r+a)),!((l+=a+1)>i));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function Td(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var Nd=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function _r(e){if(!(t=Nd.exec(e)))throw new Error("invalid format: "+e);var t;return new ms({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}_r.prototype=ms.prototype;function ms(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}ms.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Pd(e){t:for(var t=e.length,n=1,i=-1,r;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+e[n])break t;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(r+1):e}var sl;function Cd(e,t){var n=ai(e,t);if(!n)return e+"";var i=n[0],r=n[1],s=r-(sl=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+ai(e,Math.max(0,t+s-1))[0]}function So(e,t){var n=ai(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const bo={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:Ed,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>So(e*100,t),r:So,s:Cd,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function $o(e){return e}var Eo=Array.prototype.map,Ao=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"];function kd(e){var t=e.grouping===void 0||e.thousands===void 0?$o:Id(Eo.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?$o:Td(Eo.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"â":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function u(c){c=_r(c);var f=c.fill,v=c.align,S=c.sign,A=c.symbol,N=c.zero,I=c.width,E=c.comma,C=c.precision,P=c.trim,k=c.type;k==="n"?(E=!0,k="g"):bo[k]||(C===void 0&&(C=12),P=!0,k="g"),(N||f==="0"&&v==="=")&&(N=!0,f="0",v="=");var O=A==="$"?n:A==="#"&&/[boxX]/.test(k)?"0"+k.toLowerCase():"",D=A==="$"?i:/[%p]/.test(k)?o:"",d=bo[k],g=/[defgprs%]/.test(k);C=C===void 0?6:/[gprs]/.test(k)?Math.max(1,Math.min(21,C)):Math.max(0,Math.min(20,C));function w(_){var M=O,$=D,y,p,m;if(k==="c")$=d(_)+$,_="";else{_=+_;var x=_<0||1/_<0;if(_=isNaN(_)?l:d(Math.abs(_),C),P&&(_=Pd(_)),x&&+_==0&&S!=="+"&&(x=!1),M=(x?S==="("?S:a:S==="-"||S==="("?"":S)+M,$=(k==="s"?Ao[8+sl/3]:"")+$+(x&&S==="("?")":""),g){for(y=-1,p=_.length;++y<p;)if(m=_.charCodeAt(y),48>m||m>57){$=(m===46?r+_.slice(y+1):_.slice(y))+$,_=_.slice(0,y);break}}}E&&!N&&(_=t(_,1/0));var b=M.length+_.length+$.length,T=b<I?new Array(I-b+1).join(f):"";switch(E&&N&&(_=t(T+_,T.length?I-$.length:1/0),T=""),v){case"<":_=M+_+$+T;break;case"=":_=M+T+_+$;break;case"^":_=T.slice(0,b=T.length>>1)+M+_+$+T.slice(b);break;default:_=T+M+_+$;break}return s(_)}return w.toString=function(){return c+""},w}function h(c,f){var v=u((c=_r(c),c.type="f",c)),S=Math.max(-8,Math.min(8,Math.floor(Ad(f)/3)))*3,A=Math.pow(10,-S),N=Ao[8+S/3];return function(I){return v(A*I)+N}}return{format:u,formatPrefix:h}}var Cn,ys;Od({thousands:",",grouping:[3],currency:["$",""]});function Od(e){return Cn=kd(e),ys=Cn.format,Cn.formatPrefix,Cn}var Y=1e-6,xr=1e-12,V=Math.PI,at=V/2,Io=V/4,xt=V*2,ct=180/V,K=V/180,Q=Math.abs,zi=Math.atan,Qt=Math.atan2,X=Math.cos,kn=Math.ceil,ol=Math.exp,Mr=Math.hypot,al=Math.log,F=Math.sin,Ld=Math.sign||function(e){return e>0?1:e<0?-1:0},Gt=Math.sqrt,ll=Math.tan;function Rd(e){return e>1?0:e<-1?V:Math.acos(e)}function Zt(e){return e>1?at:e<-1?-at:Math.asin(e)}function nt(){}function li(e,t){e&&No.hasOwnProperty(e.type)&&No[e.type](e,t)}var To={Feature:function(e,t){li(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)li(n[i].geometry,t)}},No={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){Sr(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)Sr(n[i],t,0)},Polygon:function(e,t){Po(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)Po(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)li(n[i],t)}};function Sr(e,t,n){var i=-1,r=e.length-n,s;for(t.lineStart();++i<r;)s=e[i],t.point(s[0],s[1],s[2]);t.lineEnd()}function Po(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)Sr(e[n],t,1);t.polygonEnd()}function re(e,t){e&&To.hasOwnProperty(e.type)?To[e.type](e,t):li(e,t)}function br(e){return[Qt(e[1],e[0]),Zt(e[2])]}function Oe(e){var t=e[0],n=e[1],i=X(n);return[i*X(t),i*F(t),F(n)]}function On(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function ui(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function tr(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Ln(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function $r(e){var t=Gt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var We,ci,hi,fi,di,pi,gi,mi,Er,Ar,Ir,ul,cl,ht,ft,dt,Ct={sphere:nt,point:vs,lineStart:Co,lineEnd:ko,polygonStart:function(){Ct.lineStart=Bd,Ct.lineEnd=Ud},polygonEnd:function(){Ct.lineStart=Co,Ct.lineEnd=ko}};function vs(e,t){e*=K,t*=K;var n=X(t);Mn(n*X(e),n*F(e),F(t))}function Mn(e,t,n){++We,hi+=(e-hi)/We,fi+=(t-fi)/We,di+=(n-di)/We}function Co(){Ct.point=Dd}function Dd(e,t){e*=K,t*=K;var n=X(t);ht=n*X(e),ft=n*F(e),dt=F(t),Ct.point=zd,Mn(ht,ft,dt)}function zd(e,t){e*=K,t*=K;var n=X(t),i=n*X(e),r=n*F(e),s=F(t),o=Qt(Gt((o=ft*s-dt*r)*o+(o=dt*i-ht*s)*o+(o=ht*r-ft*i)*o),ht*i+ft*r+dt*s);ci+=o,pi+=o*(ht+(ht=i)),gi+=o*(ft+(ft=r)),mi+=o*(dt+(dt=s)),Mn(ht,ft,dt)}function ko(){Ct.point=vs}function Bd(){Ct.point=Hd}function Ud(){hl(ul,cl),Ct.point=vs}function Hd(e,t){ul=e,cl=t,e*=K,t*=K,Ct.point=hl;var n=X(t);ht=n*X(e),ft=n*F(e),dt=F(t),Mn(ht,ft,dt)}function hl(e,t){e*=K,t*=K;var n=X(t),i=n*X(e),r=n*F(e),s=F(t),o=ft*s-dt*r,a=dt*i-ht*s,l=ht*r-ft*i,u=Mr(o,a,l),h=Zt(u),c=u&&-h/u;Er.add(c*o),Ar.add(c*a),Ir.add(c*l),ci+=h,pi+=h*(ht+(ht=i)),gi+=h*(ft+(ft=r)),mi+=h*(dt+(dt=s)),Mn(ht,ft,dt)}function Oo(e){We=ci=hi=fi=di=pi=gi=mi=0,Er=new kt,Ar=new kt,Ir=new kt,re(e,Ct);var t=+Er,n=+Ar,i=+Ir,r=Mr(t,n,i);return r<xr&&(t=pi,n=gi,i=mi,ci<Y&&(t=hi,n=fi,i=di),r=Mr(t,n,i),r<xr)?[NaN,NaN]:[Qt(n,t)*ct,Zt(i/r)*ct]}function Tr(e,t){function n(i,r){return i=e(i,r),t(i[0],i[1])}return e.invert&&t.invert&&(n.invert=function(i,r){return i=t.invert(i,r),i&&e.invert(i[0],i[1])}),n}function Nr(e,t){return Q(e)>V&&(e-=Math.round(e/xt)*xt),[e,t]}Nr.invert=Nr;function fl(e,t,n){return(e%=xt)?t||n?Tr(Ro(e),Do(t,n)):Ro(e):t||n?Do(t,n):Nr}function Lo(e){return function(t,n){return t+=e,Q(t)>V&&(t-=Math.round(t/xt)*xt),[t,n]}}function Ro(e){var t=Lo(e);return t.invert=Lo(-e),t}function Do(e,t){var n=X(e),i=F(e),r=X(t),s=F(t);function o(a,l){var u=X(l),h=X(a)*u,c=F(a)*u,f=F(l),v=f*n+h*i;return[Qt(c*r-v*s,h*n-f*i),Zt(v*r+c*s)]}return o.invert=function(a,l){var u=X(l),h=X(a)*u,c=F(a)*u,f=F(l),v=f*r-c*s;return[Qt(c*r+f*s,h*n+v*i),Zt(v*n-h*i)]},o}function yi(e){e=fl(e[0]*K,e[1]*K,e.length>2?e[2]*K:0);function t(n){return n=e(n[0]*K,n[1]*K),n[0]*=ct,n[1]*=ct,n}return t.invert=function(n){return n=e.invert(n[0]*K,n[1]*K),n[0]*=ct,n[1]*=ct,n},t}function qd(e,t,n,i,r,s){if(n){var o=X(t),a=F(t),l=i*n;r==null?(r=t+i*xt,s=t-l/2):(r=zo(o,r),s=zo(o,s),(i>0?r<s:r>s)&&(r+=i*xt));for(var u,h=r;i>0?h>s:h<s;h-=l)u=br([o,-a*X(h),-a*F(h)]),e.point(u[0],u[1])}}function zo(e,t){t=Oe(t),t[0]-=e,$r(t);var n=Rd(-t[1]);return((-t[2]<0?-n:n)+xt-Y)%xt}function dl(){var e=[],t;return{point:function(n,i,r){t.push([n,i,r])},lineStart:function(){e.push(t=[])},lineEnd:nt,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function Yn(e,t){return Q(e[0]-t[0])<Y&&Q(e[1]-t[1])<Y}function Rn(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function pl(e,t,n,i,r){var s=[],o=[],a,l;if(e.forEach(function(S){if(!((A=S.length-1)<=0)){var A,N=S[0],I=S[A],E;if(Yn(N,I)){if(!N[2]&&!I[2]){for(r.lineStart(),a=0;a<A;++a)r.point((N=S[a])[0],N[1]);r.lineEnd();return}I[0]+=2*Y}s.push(E=new Rn(N,S,null,!0)),o.push(E.o=new Rn(N,null,E,!1)),s.push(E=new Rn(I,S,null,!1)),o.push(E.o=new Rn(I,null,E,!0))}}),!!s.length){for(o.sort(t),Bo(s),Bo(o),a=0,l=o.length;a<l;++a)o[a].e=n=!n;for(var u=s[0],h,c;;){for(var f=u,v=!0;f.v;)if((f=f.n)===u)return;h=f.z,r.lineStart();do{if(f.v=f.o.v=!0,f.e){if(v)for(a=0,l=h.length;a<l;++a)r.point((c=h[a])[0],c[1]);else i(f.x,f.n.x,1,r);f=f.n}else{if(v)for(h=f.p.z,a=h.length-1;a>=0;--a)r.point((c=h[a])[0],c[1]);else i(f.x,f.p.x,-1,r);f=f.p}f=f.o,h=f.z,v=!v}while(!f.v);r.lineEnd()}}}function Bo(e){if(t=e.length){for(var t,n=0,i=e[0],r;++n<t;)i.n=r=e[n],r.p=i,i=r;i.n=r=e[0],r.p=i}}function er(e){return Q(e[0])<=V?e[0]:Ld(e[0])*((Q(e[0])+V)%xt-V)}function Fd(e,t){var n=er(t),i=t[1],r=F(i),s=[F(n),-X(n),0],o=0,a=0,l=new kt;r===1?i=at+Y:r===-1&&(i=-at-Y);for(var u=0,h=e.length;u<h;++u)if(f=(c=e[u]).length)for(var c,f,v=c[f-1],S=er(v),A=v[1]/2+Io,N=F(A),I=X(A),E=0;E<f;++E,S=P,N=O,I=D,v=C){var C=c[E],P=er(C),k=C[1]/2+Io,O=F(k),D=X(k),d=P-S,g=d>=0?1:-1,w=g*d,_=w>V,M=N*O;if(l.add(Qt(M*g*F(w),I*D+M*X(w))),o+=_?d+g*xt:d,_^S>=n^P>=n){var $=ui(Oe(v),Oe(C));$r($);var y=ui(s,$);$r(y);var p=(_^d>=0?-1:1)*Zt(y[2]);(i>p||i===p&&($[0]||$[1]))&&(a+=_^d>=0?1:-1)}}return(o<-Y||o<Y&&l<-xr)^a&1}function gl(e,t,n,i){return function(r){var s=t(r),o=dl(),a=t(o),l=!1,u,h,c,f={point:v,lineStart:A,lineEnd:N,polygonStart:function(){f.point=I,f.lineStart=E,f.lineEnd=C,h=[],u=[]},polygonEnd:function(){f.point=v,f.lineStart=A,f.lineEnd=N,h=Na(h);var P=Fd(u,i);h.length?(l||(r.polygonStart(),l=!0),pl(h,Xd,P,n,r)):P&&(l||(r.polygonStart(),l=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),l&&(r.polygonEnd(),l=!1),h=u=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function v(P,k){e(P,k)&&r.point(P,k)}function S(P,k){s.point(P,k)}function A(){f.point=S,s.lineStart()}function N(){f.point=v,s.lineEnd()}function I(P,k){c.push([P,k]),a.point(P,k)}function E(){a.lineStart(),c=[]}function C(){I(c[0][0],c[0][1]),a.lineEnd();var P=a.clean(),k=o.result(),O,D=k.length,d,g,w;if(c.pop(),u.push(c),c=null,!!D){if(P&1){if(g=k[0],(d=g.length-1)>0){for(l||(r.polygonStart(),l=!0),r.lineStart(),O=0;O<d;++O)r.point((w=g[O])[0],w[1]);r.lineEnd()}return}D>1&&P&2&&k.push(k.pop().concat(k.shift())),h.push(k.filter(Gd))}}return f}}function Gd(e){return e.length>1}function Xd(e,t){return((e=e.x)[0]<0?e[1]-at-Y:at-e[1])-((t=t.x)[0]<0?t[1]-at-Y:at-t[1])}const Uo=gl(function(){return!0},Yd,Kd,[-V,-at]);function Yd(e){var t=NaN,n=NaN,i=NaN,r;return{lineStart:function(){e.lineStart(),r=1},point:function(s,o){var a=s>0?V:-V,l=Q(s-t);Q(l-V)<Y?(e.point(t,n=(n+o)/2>0?at:-at),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(a,n),e.point(s,n),r=0):i!==a&&l>=V&&(Q(t-i)<Y&&(t-=i*Y),Q(s-a)<Y&&(s-=a*Y),n=Vd(t,n,s,o),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(a,n),r=0),e.point(t=s,n=o),i=a},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-r}}}function Vd(e,t,n,i){var r,s,o=F(e-n);return Q(o)>Y?zi((F(t)*(s=X(i))*F(n)-F(i)*(r=X(t))*F(e))/(r*s*o)):(t+i)/2}function Kd(e,t,n,i){var r;if(e==null)r=n*at,i.point(-V,r),i.point(0,r),i.point(V,r),i.point(V,0),i.point(V,-r),i.point(0,-r),i.point(-V,-r),i.point(-V,0),i.point(-V,r);else if(Q(e[0]-t[0])>Y){var s=e[0]<t[0]?V:-V;r=n*s/2,i.point(-s,r),i.point(0,r),i.point(s,r)}else i.point(t[0],t[1])}function jd(e){var t=X(e),n=2*K,i=t>0,r=Q(t)>Y;function s(h,c,f,v){qd(v,e,n,f,h,c)}function o(h,c){return X(h)*X(c)>t}function a(h){var c,f,v,S,A;return{lineStart:function(){S=v=!1,A=1},point:function(N,I){var E=[N,I],C,P=o(N,I),k=i?P?0:u(N,I):P?u(N+(N<0?V:-V),I):0;if(!c&&(S=v=P)&&h.lineStart(),P!==v&&(C=l(c,E),(!C||Yn(c,C)||Yn(E,C))&&(E[2]=1)),P!==v)A=0,P?(h.lineStart(),C=l(E,c),h.point(C[0],C[1])):(C=l(c,E),h.point(C[0],C[1],2),h.lineEnd()),c=C;else if(r&&c&&i^P){var O;!(k&f)&&(O=l(E,c,!0))&&(A=0,i?(h.lineStart(),h.point(O[0][0],O[0][1]),h.point(O[1][0],O[1][1]),h.lineEnd()):(h.point(O[1][0],O[1][1]),h.lineEnd(),h.lineStart(),h.point(O[0][0],O[0][1],3)))}P&&(!c||!Yn(c,E))&&h.point(E[0],E[1]),c=E,v=P,f=k},lineEnd:function(){v&&h.lineEnd(),c=null},clean:function(){return A|(S&&v)<<1}}}function l(h,c,f){var v=Oe(h),S=Oe(c),A=[1,0,0],N=ui(v,S),I=On(N,N),E=N[0],C=I-E*E;if(!C)return!f&&h;var P=t*I/C,k=-t*E/C,O=ui(A,N),D=Ln(A,P),d=Ln(N,k);tr(D,d);var g=O,w=On(D,g),_=On(g,g),M=w*w-_*(On(D,D)-1);if(!(M<0)){var $=Gt(M),y=Ln(g,(-w-$)/_);if(tr(y,D),y=br(y),!f)return y;var p=h[0],m=c[0],x=h[1],b=c[1],T;m<p&&(T=p,p=m,m=T);var L=m-p,R=Q(L-V)<Y,z=R||L<Y;if(!R&&b<x&&(T=x,x=b,b=T),z?R?x+b>0^y[1]<(Q(y[0]-p)<Y?x:b):x<=y[1]&&y[1]<=b:L>V^(p<=y[0]&&y[0]<=m)){var U=Ln(g,(-w+$)/_);return tr(U,D),[y,br(U)]}}}function u(h,c){var f=i?e:V-e,v=0;return h<-f?v|=1:h>f&&(v|=2),c<-f?v|=4:c>f&&(v|=8),v}return gl(o,a,s,i?[0,-e]:[-V,e-V])}function Wd(e,t,n,i,r,s){var o=e[0],a=e[1],l=t[0],u=t[1],h=0,c=1,f=l-o,v=u-a,S;if(S=n-o,!(!f&&S>0)){if(S/=f,f<0){if(S<h)return;S<c&&(c=S)}else if(f>0){if(S>c)return;S>h&&(h=S)}if(S=r-o,!(!f&&S<0)){if(S/=f,f<0){if(S>c)return;S>h&&(h=S)}else if(f>0){if(S<h)return;S<c&&(c=S)}if(S=i-a,!(!v&&S>0)){if(S/=v,v<0){if(S<h)return;S<c&&(c=S)}else if(v>0){if(S>c)return;S>h&&(h=S)}if(S=s-a,!(!v&&S<0)){if(S/=v,v<0){if(S>c)return;S>h&&(h=S)}else if(v>0){if(S<h)return;S<c&&(c=S)}return h>0&&(e[0]=o+h*f,e[1]=a+h*v),c<1&&(t[0]=o+c*f,t[1]=a+c*v),!0}}}}}var Qe=1e9,Dn=-Qe;function Qd(e,t,n,i){function r(u,h){return e<=u&&u<=n&&t<=h&&h<=i}function s(u,h,c,f){var v=0,S=0;if(u==null||(v=o(u,c))!==(S=o(h,c))||l(u,h)<0^c>0)do f.point(v===0||v===3?e:n,v>1?i:t);while((v=(v+c+4)%4)!==S);else f.point(h[0],h[1])}function o(u,h){return Q(u[0]-e)<Y?h>0?0:3:Q(u[0]-n)<Y?h>0?2:1:Q(u[1]-t)<Y?h>0?1:0:h>0?3:2}function a(u,h){return l(u.x,h.x)}function l(u,h){var c=o(u,1),f=o(h,1);return c!==f?c-f:c===0?h[1]-u[1]:c===1?u[0]-h[0]:c===2?u[1]-h[1]:h[0]-u[0]}return function(u){var h=u,c=dl(),f,v,S,A,N,I,E,C,P,k,O,D={point:d,lineStart:M,lineEnd:$,polygonStart:w,polygonEnd:_};function d(p,m){r(p,m)&&h.point(p,m)}function g(){for(var p=0,m=0,x=v.length;m<x;++m)for(var b=v[m],T=1,L=b.length,R=b[0],z,U,q=R[0],B=R[1];T<L;++T)z=q,U=B,R=b[T],q=R[0],B=R[1],U<=i?B>i&&(q-z)*(i-U)>(B-U)*(e-z)&&++p:B<=i&&(q-z)*(i-U)<(B-U)*(e-z)&&--p;return p}function w(){h=c,f=[],v=[],O=!0}function _(){var p=g(),m=O&&p,x=(f=Na(f)).length;(m||x)&&(u.polygonStart(),m&&(u.lineStart(),s(null,null,1,u),u.lineEnd()),x&&pl(f,a,p,s,u),u.polygonEnd()),h=u,f=v=S=null}function M(){D.point=y,v&&v.push(S=[]),k=!0,P=!1,E=C=NaN}function $(){f&&(y(A,N),I&&P&&c.rejoin(),f.push(c.result())),D.point=d,P&&h.lineEnd()}function y(p,m){var x=r(p,m);if(v&&S.push([p,m]),k)A=p,N=m,I=x,k=!1,x&&(h.lineStart(),h.point(p,m));else if(x&&P)h.point(p,m);else{var b=[E=Math.max(Dn,Math.min(Qe,E)),C=Math.max(Dn,Math.min(Qe,C))],T=[p=Math.max(Dn,Math.min(Qe,p)),m=Math.max(Dn,Math.min(Qe,m))];Wd(b,T,e,t,n,i)?(P||(h.lineStart(),h.point(b[0],b[1])),h.point(T[0],T[1]),x||h.lineEnd(),O=!1):x&&(h.lineStart(),h.point(p,m),O=!1)}E=p,C=m,P=x}return D}}var Pr,Cr,Vn,Kn,Le={sphere:nt,point:nt,lineStart:Zd,lineEnd:nt,polygonStart:nt,polygonEnd:nt};function Zd(){Le.point=tp,Le.lineEnd=Jd}function Jd(){Le.point=Le.lineEnd=nt}function tp(e,t){e*=K,t*=K,Cr=e,Vn=F(t),Kn=X(t),Le.point=ep}function ep(e,t){e*=K,t*=K;var n=F(t),i=X(t),r=Q(e-Cr),s=X(r),o=F(r),a=i*o,l=Kn*n-Vn*i*s,u=Vn*n+Kn*i*s;Pr.add(Qt(Gt(a*a+l*l),u)),Cr=e,Vn=n,Kn=i}function np(e){return Pr=new kt,re(e,Le),+Pr}var kr=[null,null],ip={type:"LineString",coordinates:kr};function vi(e,t){return kr[0]=e,kr[1]=t,np(ip)}function Ho(e,t,n){var i=Ee(e,t-Y,n).concat(t);return function(r){return i.map(function(s){return[r,s]})}}function qo(e,t,n){var i=Ee(e,t-Y,n).concat(t);return function(r){return i.map(function(s){return[s,r]})}}function rp(){var e,t,n,i,r,s,o,a,l=10,u=l,h=90,c=360,f,v,S,A,N=2.5;function I(){return{type:"MultiLineString",coordinates:E()}}function E(){return Ee(kn(i/h)*h,n,h).map(S).concat(Ee(kn(a/c)*c,o,c).map(A)).concat(Ee(kn(t/l)*l,e,l).filter(function(C){return Q(C%h)>Y}).map(f)).concat(Ee(kn(s/u)*u,r,u).filter(function(C){return Q(C%c)>Y}).map(v))}return I.lines=function(){return E().map(function(C){return{type:"LineString",coordinates:C}})},I.outline=function(){return{type:"Polygon",coordinates:[S(i).concat(A(o).slice(1),S(n).reverse().slice(1),A(a).reverse().slice(1))]}},I.extent=function(C){return arguments.length?I.extentMajor(C).extentMinor(C):I.extentMinor()},I.extentMajor=function(C){return arguments.length?(i=+C[0][0],n=+C[1][0],a=+C[0][1],o=+C[1][1],i>n&&(C=i,i=n,n=C),a>o&&(C=a,a=o,o=C),I.precision(N)):[[i,a],[n,o]]},I.extentMinor=function(C){return arguments.length?(t=+C[0][0],e=+C[1][0],s=+C[0][1],r=+C[1][1],t>e&&(C=t,t=e,e=C),s>r&&(C=s,s=r,r=C),I.precision(N)):[[t,s],[e,r]]},I.step=function(C){return arguments.length?I.stepMajor(C).stepMinor(C):I.stepMinor()},I.stepMajor=function(C){return arguments.length?(h=+C[0],c=+C[1],I):[h,c]},I.stepMinor=function(C){return arguments.length?(l=+C[0],u=+C[1],I):[l,u]},I.precision=function(C){return arguments.length?(N=+C,f=Ho(s,r,90),v=qo(t,e,N),S=Ho(a,o,90),A=qo(i,n,N),I):N},I.extentMajor([[-180,-90+Y],[180,90-Y]]).extentMinor([[-180,-80-Y],[180,80+Y]])}const Or=e=>e;var nr=new kt,Lr=new kt,ml,yl,Rr,Dr,Vt={point:nt,lineStart:nt,lineEnd:nt,polygonStart:function(){Vt.lineStart=sp,Vt.lineEnd=ap},polygonEnd:function(){Vt.lineStart=Vt.lineEnd=Vt.point=nt,nr.add(Q(Lr)),Lr=new kt},result:function(){var e=nr/2;return nr=new kt,e}};function sp(){Vt.point=op}function op(e,t){Vt.point=vl,ml=Rr=e,yl=Dr=t}function vl(e,t){Lr.add(Dr*e-Rr*t),Rr=e,Dr=t}function ap(){vl(ml,yl)}var Re=1/0,wi=Re,pn=-Re,_i=pn,xi={point:lp,lineStart:nt,lineEnd:nt,polygonStart:nt,polygonEnd:nt,result:function(){var e=[[Re,wi],[pn,_i]];return pn=_i=-(wi=Re=1/0),e}};function lp(e,t){e<Re&&(Re=e),e>pn&&(pn=e),t<wi&&(wi=t),t>_i&&(_i=t)}var zr=0,Br=0,Ze=0,Mi=0,Si=0,Ie=0,Ur=0,Hr=0,Je=0,wl,_l,Dt,zt,At={point:_e,lineStart:Fo,lineEnd:Go,polygonStart:function(){At.lineStart=hp,At.lineEnd=fp},polygonEnd:function(){At.point=_e,At.lineStart=Fo,At.lineEnd=Go},result:function(){var e=Je?[Ur/Je,Hr/Je]:Ie?[Mi/Ie,Si/Ie]:Ze?[zr/Ze,Br/Ze]:[NaN,NaN];return zr=Br=Ze=Mi=Si=Ie=Ur=Hr=Je=0,e}};function _e(e,t){zr+=e,Br+=t,++Ze}function Fo(){At.point=up}function up(e,t){At.point=cp,_e(Dt=e,zt=t)}function cp(e,t){var n=e-Dt,i=t-zt,r=Gt(n*n+i*i);Mi+=r*(Dt+e)/2,Si+=r*(zt+t)/2,Ie+=r,_e(Dt=e,zt=t)}function Go(){At.point=_e}function hp(){At.point=dp}function fp(){xl(wl,_l)}function dp(e,t){At.point=xl,_e(wl=Dt=e,_l=zt=t)}function xl(e,t){var n=e-Dt,i=t-zt,r=Gt(n*n+i*i);Mi+=r*(Dt+e)/2,Si+=r*(zt+t)/2,Ie+=r,r=zt*e-Dt*t,Ur+=r*(Dt+e),Hr+=r*(zt+t),Je+=r*3,_e(Dt=e,zt=t)}function Ml(e){this._context=e}Ml.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,xt);break}}},result:nt};var qr=new kt,ir,Sl,bl,tn,en,gn={point:nt,lineStart:function(){gn.point=pp},lineEnd:function(){ir&&$l(Sl,bl),gn.point=nt},polygonStart:function(){ir=!0},polygonEnd:function(){ir=null},result:function(){var e=+qr;return qr=new kt,e}};function pp(e,t){gn.point=$l,Sl=tn=e,bl=en=t}function $l(e,t){tn-=e,en-=t,qr.add(Gt(tn*tn+en*en)),tn=e,en=t}let Xo,bi,Yo,Vo;class Ko{constructor(t){this._append=t==null?El:gp(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,n){switch(this._point){case 0:{this._append`M${t},${n}`,this._point=1;break}case 1:{this._append`L${t},${n}`;break}default:{if(this._append`M${t},${n}`,this._radius!==Yo||this._append!==bi){const i=this._radius,r=this._;this._="",this._append`m0,${i}a${i},${i} 0 1,1 0,${-2*i}a${i},${i} 0 1,1 0,${2*i}z`,Yo=i,bi=this._append,Vo=this._,this._=r}this._+=Vo;break}}}result(){const t=this._;return this._="",t.length?t:null}}function El(e){let t=1;this._+=e[0];for(const n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function gp(e){const t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return El;if(t!==Xo){const n=10**t;Xo=t,bi=function(r){let s=1;this._+=r[0];for(const o=r.length;s<o;++s)this._+=Math.round(arguments[s]*n)/n+r[s]}}return bi}function ws(e,t){let n=3,i=4.5,r,s;function o(a){return a&&(typeof i=="function"&&s.pointRadius(+i.apply(this,arguments)),re(a,r(s))),s.result()}return o.area=function(a){return re(a,r(Vt)),Vt.result()},o.measure=function(a){return re(a,r(gn)),gn.result()},o.bounds=function(a){return re(a,r(xi)),xi.result()},o.centroid=function(a){return re(a,r(At)),At.result()},o.projection=function(a){return arguments.length?(r=a==null?(e=null,Or):(e=a).stream,o):e},o.context=function(a){return arguments.length?(s=a==null?(t=null,new Ko(n)):new Ml(t=a),typeof i!="function"&&s.pointRadius(i),o):t},o.pointRadius=function(a){return arguments.length?(i=typeof a=="function"?a:(s.pointRadius(+a),+a),o):i},o.digits=function(a){if(!arguments.length)return n;if(a==null)n=null;else{const l=Math.floor(a);if(!(l>=0))throw new RangeError(`invalid digits: ${a}`);n=l}return t===null&&(s=new Ko(n)),o},o.projection(e).digits(n).context(t)}function _s(e){return function(t){var n=new Fr;for(var i in e)n[i]=e[i];return n.stream=t,n}}function Fr(){}Fr.prototype={constructor:Fr,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function xs(e,t,n){var i=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),i!=null&&e.clipExtent(null),re(n,e.stream(xi)),t(xi.result()),i!=null&&e.clipExtent(i),e}function Al(e,t,n){return xs(e,function(i){var r=t[1][0]-t[0][0],s=t[1][1]-t[0][1],o=Math.min(r/(i[1][0]-i[0][0]),s/(i[1][1]-i[0][1])),a=+t[0][0]+(r-o*(i[1][0]+i[0][0]))/2,l=+t[0][1]+(s-o*(i[1][1]+i[0][1]))/2;e.scale(150*o).translate([a,l])},n)}function mp(e,t,n){return Al(e,[[0,0],t],n)}function yp(e,t,n){return xs(e,function(i){var r=+t,s=r/(i[1][0]-i[0][0]),o=(r-s*(i[1][0]+i[0][0]))/2,a=-s*i[0][1];e.scale(150*s).translate([o,a])},n)}function vp(e,t,n){return xs(e,function(i){var r=+t,s=r/(i[1][1]-i[0][1]),o=-s*i[0][0],a=(r-s*(i[1][1]+i[0][1]))/2;e.scale(150*s).translate([o,a])},n)}var jo=16,wp=X(30*K);function Wo(e,t){return+t?xp(e,t):_p(e)}function _p(e){return _s({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function xp(e,t){function n(i,r,s,o,a,l,u,h,c,f,v,S,A,N){var I=u-i,E=h-r,C=I*I+E*E;if(C>4*t&&A--){var P=o+f,k=a+v,O=l+S,D=Gt(P*P+k*k+O*O),d=Zt(O/=D),g=Q(Q(O)-1)<Y||Q(s-c)<Y?(s+c)/2:Qt(k,P),w=e(g,d),_=w[0],M=w[1],$=_-i,y=M-r,p=E*$-I*y;(p*p/C>t||Q((I*$+E*y)/C-.5)>.3||o*f+a*v+l*S<wp)&&(n(i,r,s,o,a,l,_,M,g,P/=D,k/=D,O,A,N),N.point(_,M),n(_,M,g,P,k,O,u,h,c,f,v,S,A,N))}}return function(i){var r,s,o,a,l,u,h,c,f,v,S,A,N={point:I,lineStart:E,lineEnd:P,polygonStart:function(){i.polygonStart(),N.lineStart=k},polygonEnd:function(){i.polygonEnd(),N.lineStart=E}};function I(d,g){d=e(d,g),i.point(d[0],d[1])}function E(){c=NaN,N.point=C,i.lineStart()}function C(d,g){var w=Oe([d,g]),_=e(d,g);n(c,f,h,v,S,A,c=_[0],f=_[1],h=d,v=w[0],S=w[1],A=w[2],jo,i),i.point(c,f)}function P(){N.point=I,i.lineEnd()}function k(){E(),N.point=O,N.lineEnd=D}function O(d,g){C(r=d,g),s=c,o=f,a=v,l=S,u=A,N.point=C}function D(){n(c,f,h,v,S,A,s,o,r,a,l,u,jo,i),N.lineEnd=P,P()}return N}}var Mp=_s({point:function(e,t){this.stream.point(e*K,t*K)}});function Sp(e){return _s({point:function(t,n){var i=e(t,n);return this.stream.point(i[0],i[1])}})}function bp(e,t,n,i,r){function s(o,a){return o*=i,a*=r,[t+e*o,n-e*a]}return s.invert=function(o,a){return[(o-t)/e*i,(n-a)/e*r]},s}function Qo(e,t,n,i,r,s){if(!s)return bp(e,t,n,i,r);var o=X(s),a=F(s),l=o*e,u=a*e,h=o/e,c=a/e,f=(a*n-o*t)/e,v=(a*t+o*n)/e;function S(A,N){return A*=i,N*=r,[l*A-u*N+t,n-u*A-l*N]}return S.invert=function(A,N){return[i*(h*A-c*N+f),r*(v-c*A-h*N)]},S}function Ms(e){return $p(function(){return e})()}function $p(e){var t,n=150,i=480,r=250,s=0,o=0,a=0,l=0,u=0,h,c=0,f=1,v=1,S=null,A=Uo,N=null,I,E,C,P=Or,k=.5,O,D,d,g,w;function _(p){return d(p[0]*K,p[1]*K)}function M(p){return p=d.invert(p[0],p[1]),p&&[p[0]*ct,p[1]*ct]}_.stream=function(p){return g&&w===p?g:g=Mp(Sp(h)(A(O(P(w=p)))))},_.preclip=function(p){return arguments.length?(A=p,S=void 0,y()):A},_.postclip=function(p){return arguments.length?(P=p,N=I=E=C=null,y()):P},_.clipAngle=function(p){return arguments.length?(A=+p?jd(S=p*K):(S=null,Uo),y()):S*ct},_.clipExtent=function(p){return arguments.length?(P=p==null?(N=I=E=C=null,Or):Qd(N=+p[0][0],I=+p[0][1],E=+p[1][0],C=+p[1][1]),y()):N==null?null:[[N,I],[E,C]]},_.scale=function(p){return arguments.length?(n=+p,$()):n},_.translate=function(p){return arguments.length?(i=+p[0],r=+p[1],$()):[i,r]},_.center=function(p){return arguments.length?(s=p[0]%360*K,o=p[1]%360*K,$()):[s*ct,o*ct]},_.rotate=function(p){return arguments.length?(a=p[0]%360*K,l=p[1]%360*K,u=p.length>2?p[2]%360*K:0,$()):[a*ct,l*ct,u*ct]},_.angle=function(p){return arguments.length?(c=p%360*K,$()):c*ct},_.reflectX=function(p){return arguments.length?(f=p?-1:1,$()):f<0},_.reflectY=function(p){return arguments.length?(v=p?-1:1,$()):v<0},_.precision=function(p){return arguments.length?(O=Wo(D,k=p*p),y()):Gt(k)},_.fitExtent=function(p,m){return Al(_,p,m)},_.fitSize=function(p,m){return mp(_,p,m)},_.fitWidth=function(p,m){return yp(_,p,m)},_.fitHeight=function(p,m){return vp(_,p,m)};function $(){var p=Qo(n,0,0,f,v,c).apply(null,t(s,o)),m=Qo(n,i-p[0],r-p[1],f,v,c);return h=fl(a,l,u),D=Tr(t,m),d=Tr(h,D),O=Wo(D,k),y()}function y(){return g=w=null,_}return function(){return t=e.apply(this,arguments),_.invert=t.invert&&M,$()}}function Il(e){return function(t,n){var i=Gt(t*t+n*n),r=e(i),s=F(r),o=X(r);return[Qt(t*s,i*o),Zt(i&&n*s/i)]}}function Ss(e,t){return[e,al(ll((at+t)/2))]}Ss.invert=function(e,t){return[e,2*zi(ol(t))-at]};function Ep(){return Tl(Ss).scale(961/xt)}function Tl(e){var t=Ms(e),n=t.center,i=t.scale,r=t.translate,s=t.clipExtent,o=null,a,l,u;t.scale=function(c){return arguments.length?(i(c),h()):i()},t.translate=function(c){return arguments.length?(r(c),h()):r()},t.center=function(c){return arguments.length?(n(c),h()):n()},t.clipExtent=function(c){return arguments.length?(c==null?o=a=l=u=null:(o=+c[0][0],a=+c[0][1],l=+c[1][0],u=+c[1][1]),h()):o==null?null:[[o,a],[l,u]]};function h(){var c=V*i(),f=t(yi(t.rotate()).invert([0,0]));return s(o==null?[[f[0]-c,f[1]-c],[f[0]+c,f[1]+c]]:e===Ss?[[Math.max(f[0]-c,o),a],[Math.min(f[0]+c,l),u]]:[[o,Math.max(f[1]-c,a)],[l,Math.min(f[1]+c,u)]])}return h()}function Nl(e,t){return[X(t)*F(e),F(t)]}Nl.invert=Il(Zt);function Ap(){return Ms(Nl).scale(249.5).clipAngle(90+Y)}function Pl(e,t){var n=X(t),i=1+X(e)*n;return[n*F(e)/i,F(t)/i]}Pl.invert=Il(function(e){return 2*zi(e)});function Cl(){return Ms(Pl).scale(250).clipAngle(142)}function kl(e,t){return[al(ll((at+t)/2)),-e]}kl.invert=function(e,t){return[-t,2*zi(ol(e))-at]};function Ip(){var e=Tl(kl),t=e.center,n=e.rotate;return e.center=function(i){return arguments.length?t([-i[1],i[0]]):(i=t(),[i[1],-i[0]])},e.rotate=function(i){return arguments.length?n([i[0],i[1],i.length>2?i[2]+90:90]):(i=n(),[i[0],i[1],i[2]-90])},n([0,0,90]).scale(159.155)}const zn=e=>()=>e;function Tp(e,{sourceEvent:t,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function Kt(e,t,n){this.k=e,this.x=t,this.y=n}Kt.prototype={constructor:Kt,scale:function(e){return e===1?this:new Kt(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Kt(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Ol=new Kt(1,0,0);Kt.prototype;function rr(e){e.stopImmediatePropagation()}function Ve(e){e.preventDefault(),e.stopImmediatePropagation()}function Np(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function Pp(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function Zo(){return this.__zoom||Ol}function Cp(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function kp(){return navigator.maxTouchPoints||"ontouchstart"in this}function Op(e,t,n){var i=e.invertX(t[0][0])-n[0][0],r=e.invertX(t[1][0])-n[1][0],s=e.invertY(t[0][1])-n[0][1],o=e.invertY(t[1][1])-n[1][1];return e.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function Lp(){var e=Np,t=Pp,n=Op,i=Cp,r=kp,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,l=Kf,u=Oi("start","zoom","end"),h,c,f,v=500,S=150,A=0,N=10;function I(y){y.property("__zoom",Zo).on("wheel.zoom",d,{passive:!1}).on("mousedown.zoom",g).on("dblclick.zoom",w).filter(r).on("touchstart.zoom",_).on("touchmove.zoom",M).on("touchend.zoom touchcancel.zoom",$).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}I.transform=function(y,p,m,x){var b=y.selection?y.selection():y;b.property("__zoom",Zo),y!==b?k(y,p,m,x):b.interrupt().each(function(){O(this,arguments).event(x).start().zoom(null,typeof p=="function"?p.apply(this,arguments):p).end()})},I.scaleBy=function(y,p,m,x){I.scaleTo(y,function(){var b=this.__zoom.k,T=typeof p=="function"?p.apply(this,arguments):p;return b*T},m,x)},I.scaleTo=function(y,p,m,x){I.transform(y,function(){var b=t.apply(this,arguments),T=this.__zoom,L=m==null?P(b):typeof m=="function"?m.apply(this,arguments):m,R=T.invert(L),z=typeof p=="function"?p.apply(this,arguments):p;return n(C(E(T,z),L,R),b,o)},m,x)},I.translateBy=function(y,p,m,x){I.transform(y,function(){return n(this.__zoom.translate(typeof p=="function"?p.apply(this,arguments):p,typeof m=="function"?m.apply(this,arguments):m),t.apply(this,arguments),o)},null,x)},I.translateTo=function(y,p,m,x,b){I.transform(y,function(){var T=t.apply(this,arguments),L=this.__zoom,R=x==null?P(T):typeof x=="function"?x.apply(this,arguments):x;return n(Ol.translate(R[0],R[1]).scale(L.k).translate(typeof p=="function"?-p.apply(this,arguments):-p,typeof m=="function"?-m.apply(this,arguments):-m),T,o)},x,b)};function E(y,p){return p=Math.max(s[0],Math.min(s[1],p)),p===y.k?y:new Kt(p,y.x,y.y)}function C(y,p,m){var x=p[0]-m[0]*y.k,b=p[1]-m[1]*y.k;return x===y.x&&b===y.y?y:new Kt(y.k,x,b)}function P(y){return[(+y[0][0]+ +y[1][0])/2,(+y[0][1]+ +y[1][1])/2]}function k(y,p,m,x){y.on("start.zoom",function(){O(this,arguments).event(x).start()}).on("interrupt.zoom end.zoom",function(){O(this,arguments).event(x).end()}).tween("zoom",function(){var b=this,T=arguments,L=O(b,T).event(x),R=t.apply(b,T),z=m==null?P(R):typeof m=="function"?m.apply(b,T):m,U=Math.max(R[1][0]-R[0][0],R[1][1]-R[0][1]),q=b.__zoom,B=typeof p=="function"?p.apply(b,T):p,G=l(q.invert(z).concat(U/q.k),B.invert(z).concat(U/B.k));return function(j){if(j===1)j=B;else{var gt=G(j),ae=U/gt[2];j=new Kt(ae,z[0]-gt[0]*ae,z[1]-gt[1]*ae)}L.zoom(null,j)}})}function O(y,p,m){return!m&&y.__zooming||new D(y,p)}function D(y,p){this.that=y,this.args=p,this.active=0,this.sourceEvent=null,this.extent=t.apply(y,p),this.taps=0}D.prototype={event:function(y){return y&&(this.sourceEvent=y),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(y,p){return this.mouse&&y!=="mouse"&&(this.mouse[1]=p.invert(this.mouse[0])),this.touch0&&y!=="touch"&&(this.touch0[1]=p.invert(this.touch0[0])),this.touch1&&y!=="touch"&&(this.touch1[1]=p.invert(this.touch1[0])),this.that.__zoom=p,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(y){var p=st(this.that).datum();u.call(y,this.that,new Tp(y,{sourceEvent:this.sourceEvent,target:I,transform:this.that.__zoom,dispatch:u}),p)}};function d(y,...p){if(!e.apply(this,arguments))return;var m=O(this,p).event(y),x=this.__zoom,b=Math.max(s[0],Math.min(s[1],x.k*Math.pow(2,i.apply(this,arguments)))),T=Rt(y);if(m.wheel)(m.mouse[0][0]!==T[0]||m.mouse[0][1]!==T[1])&&(m.mouse[1]=x.invert(m.mouse[0]=T)),clearTimeout(m.wheel);else{if(x.k===b)return;m.mouse=[T,x.invert(T)],Xn(this),m.start()}Ve(y),m.wheel=setTimeout(L,S),m.zoom("mouse",n(C(E(x,b),m.mouse[0],m.mouse[1]),m.extent,o));function L(){m.wheel=null,m.end()}}function g(y,...p){if(f||!e.apply(this,arguments))return;var m=y.currentTarget,x=O(this,p,!0).event(y),b=st(y.view).on("mousemove.zoom",z,!0).on("mouseup.zoom",U,!0),T=Rt(y,m),L=y.clientX,R=y.clientY;Ga(y.view),rr(y),x.mouse=[T,this.__zoom.invert(T)],Xn(this),x.start();function z(q){if(Ve(q),!x.moved){var B=q.clientX-L,G=q.clientY-R;x.moved=B*B+G*G>A}x.event(q).zoom("mouse",n(C(x.that.__zoom,x.mouse[0]=Rt(q,m),x.mouse[1]),x.extent,o))}function U(q){b.on("mousemove.zoom mouseup.zoom",null),Xa(q.view,x.moved),Ve(q),x.event(q).end()}}function w(y,...p){if(e.apply(this,arguments)){var m=this.__zoom,x=Rt(y.changedTouches?y.changedTouches[0]:y,this),b=m.invert(x),T=m.k*(y.shiftKey?.5:2),L=n(C(E(m,T),x,b),t.apply(this,p),o);Ve(y),a>0?st(this).transition().duration(a).call(k,L,x,y):st(this).call(I.transform,L,x,y)}}function _(y,...p){if(e.apply(this,arguments)){var m=y.touches,x=m.length,b=O(this,p,y.changedTouches.length===x).event(y),T,L,R,z;for(rr(y),L=0;L<x;++L)R=m[L],z=Rt(R,this),z=[z,this.__zoom.invert(z),R.identifier],b.touch0?!b.touch1&&b.touch0[2]!==z[2]&&(b.touch1=z,b.taps=0):(b.touch0=z,T=!0,b.taps=1+!!h);h&&(h=clearTimeout(h)),T&&(b.taps<2&&(c=z[0],h=setTimeout(function(){h=null},v)),Xn(this),b.start())}}function M(y,...p){if(this.__zooming){var m=O(this,p).event(y),x=y.changedTouches,b=x.length,T,L,R,z;for(Ve(y),T=0;T<b;++T)L=x[T],R=Rt(L,this),m.touch0&&m.touch0[2]===L.identifier?m.touch0[0]=R:m.touch1&&m.touch1[2]===L.identifier&&(m.touch1[0]=R);if(L=m.that.__zoom,m.touch1){var U=m.touch0[0],q=m.touch0[1],B=m.touch1[0],G=m.touch1[1],j=(j=B[0]-U[0])*j+(j=B[1]-U[1])*j,gt=(gt=G[0]-q[0])*gt+(gt=G[1]-q[1])*gt;L=E(L,Math.sqrt(j/gt)),R=[(U[0]+B[0])/2,(U[1]+B[1])/2],z=[(q[0]+G[0])/2,(q[1]+G[1])/2]}else if(m.touch0)R=m.touch0[0],z=m.touch0[1];else return;m.zoom("touch",n(C(L,R,z),m.extent,o))}}function $(y,...p){if(this.__zooming){var m=O(this,p).event(y),x=y.changedTouches,b=x.length,T,L;for(rr(y),f&&clearTimeout(f),f=setTimeout(function(){f=null},v),T=0;T<b;++T)L=x[T],m.touch0&&m.touch0[2]===L.identifier?delete m.touch0:m.touch1&&m.touch1[2]===L.identifier&&delete m.touch1;if(m.touch1&&!m.touch0&&(m.touch0=m.touch1,delete m.touch1),m.touch0)m.touch0[1]=this.__zoom.invert(m.touch0[0]);else if(m.end(),m.taps===2&&(L=Rt(L,this),Math.hypot(c[0]-L[0],c[1]-L[1])<N)){var R=st(this).on("dblclick.zoom");R&&R.apply(this,arguments)}}}return I.wheelDelta=function(y){return arguments.length?(i=typeof y=="function"?y:zn(+y),I):i},I.filter=function(y){return arguments.length?(e=typeof y=="function"?y:zn(!!y),I):e},I.touchable=function(y){return arguments.length?(r=typeof y=="function"?y:zn(!!y),I):r},I.extent=function(y){return arguments.length?(t=typeof y=="function"?y:zn([[+y[0][0],+y[0][1]],[+y[1][0],+y[1][1]]]),I):t},I.scaleExtent=function(y){return arguments.length?(s[0]=+y[0],s[1]=+y[1],I):[s[0],s[1]]},I.translateExtent=function(y){return arguments.length?(o[0][0]=+y[0][0],o[1][0]=+y[1][0],o[0][1]=+y[0][1],o[1][1]=+y[1][1],I):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},I.constrain=function(y){return arguments.length?(n=y,I):n},I.duration=function(y){return arguments.length?(a=+y,I):a},I.interpolate=function(y){return arguments.length?(l=y,I):l},I.on=function(){var y=u.on.apply(u,arguments);return y===u?I:y},I.clickDistance=function(y){return arguments.length?(A=(y=+y)*y,I):Math.sqrt(A)},I.tapDistance=function(y){return arguments.length?(N=+y,I):N},I}function Bi(){return{systemMap:new Map,laneMap:new Map,neighborMap:new Map}}function Ll(e,t){e.systemMap.set(t.id,t)}function Gr(e,t,n){const i=[t.id,n.id].sort((s,o)=>s.localeCompare(o)).join("-");if(e.laneMap.has(i))return;const r={id:i,fromId:t.id,toId:n.id,movement:[0,0]};e.laneMap.set(i,r)}function Ui(e){const t=new Map;for(const n of e.laneMap.values())t.has(n.fromId)||t.set(n.fromId,[]),t.get(n.fromId)?.push(n.toId),t.has(n.toId)||t.set(n.toId,[]),t.get(n.toId)?.push(n.fromId);e.neighborMap=t}function vt(e,t){const n=e.systemMap.get(t);if(!n)return[];(!e.neighborMap||e.neighborMap.size===0)&&Ui(e);const i=e.neighborMap.get(n.id);return i?i.map(r=>e.systemMap.get(r)).filter(r=>!!r):[]}function Hi(e,t,n){return e.neighborMap.get(t)?.includes(n)||!1}function Rl(e,t){return bs(t,Array.from(e.systemMap.values()))}function bs(e,t){if(t.length===0)return null;let n=null,i=1/0;return t.forEach(r=>{if(r.location[0]===e[0]&&r.location[1]===e[1])return;const s=vi(e,r.location);s<i&&(i=s,n=r)}),n}function Rp(e){console.log("Loading world from JSON...",e);const t=Bi();return t.systemMap=new Map(e.systems),t.laneMap=new Map(e.lanes),Ui(t),t}function Dp(e){return{systems:Array.from(e.systemMap.entries()),lanes:Array.from(e.laneMap.entries())}}function Dl(){return{playerName:localStorage.getItem("starz_playerName")??"",numBots:Ac,fow:$c,numSystems:Ec,timeScale:1}}function $s(){return{world:Bi(),playerMap:new Map}}function zl(e,t){e.playerMap.set(t.id,t)}function Es(e){const{C:t}=globalThis.gameManager.getContext();if(!t.playerId)return null;for(const n of e.world.systemMap.values())if(n.homeworld===t.playerId)return n;return null}function qi(e,t){const{P:n}=globalThis.gameManager.getContext();if(!n)return;n.revealedSystems.add(t.id),n.visitedSystems.add(t.id);const i=vt(e.world,t.id);if(i)return i.forEach(r=>n.revealedSystems.add(r.id)),e}function Bl(e){const{P:t}=globalThis.gameManager.getContext();if(t)for(const n of e.world.systemMap.values())t.revealedSystems.add(n.id)}function Ul(e,t,n,i,r){e.moveQueue.push({ships:n,toId:t.id,fromId:e.id,playerId:i,message:r})}const Bn=100,sr={territory:{aggression:.3,expansion:1,defensiveness:.5,riskTolerance:.4,speed:Bn},rusher:{aggression:1,expansion:.4,defensiveness:.1,riskTolerance:.7,speed:Bn},turtle:{aggression:.1,expansion:.3,defensiveness:.95,riskTolerance:.2,speed:Bn},balanced:{aggression:.5,expansion:.5,defensiveness:.5,riskTolerance:.5,speed:Bn}};function zp({S:e}){for(const t of e.playerMap.values())t.bot?.makeMoves()}let Bp=0;class Up{constructor(t={}){this.queuedMoves=0,this.threatLevels=new Map,this.frontline=new Set,this.backline=new Set;const n=t.playerIndex??Bp++;this.id=t.id??`${n}`;let i=t.personality;if(!i){const r=Object.keys(sr);i=r[n%r.length]}this.name=t.name??i,this.personality=i==="idle"?sr.balanced:sr[i]}makeMoves(){if(this.name==="idle")return;const n=gameManager.getState().world.systemMap.values();if(this.botSystems=Array.from(n).filter(l=>l.ownerId===this.id),this.botSystems.length===0)return;for(const l of this.botSystems)l.moveQueue=[];this.queuedMoves=0,this.analyzeMap();const i=this.getDefensiveMoves();if(this.chooseMoves(i,1-this.personality.defensiveness),this.queuedMoves>=this.personality.speed)return;const r=this.getCoordinatedAttackMoves();if(this.chooseMoves(r,this.personality.aggression),this.queuedMoves>=this.personality.speed)return;const s=this.getExterminateMoves();if(this.chooseMoves(s,this.personality.defensiveness),this.queuedMoves>=this.personality.speed)return;const o=this.getExploreMoves();if(this.chooseMoves(o,this.personality.expansion),this.queuedMoves>=this.personality.speed)return;const a=this.getLogisticsMoves();this.chooseMoves(a,1),this.queuedMoves>=this.personality.speed}analyzeMap(){this.threatLevels.clear(),this.frontline.clear(),this.backline.clear();const t=gameManager.getState();this.botSystems.forEach(n=>{const i=vt(t.world,n.id),r=i.filter(a=>a.ownerId&&a.ownerId!==this.id),s=i.filter(a=>!a.ownerId),o=r.reduce((a,l)=>a+l.ships,0);this.threatLevels.set(n.id,o),r.length>0||s.length>0?this.frontline.add(n.id):this.backline.add(n.id)})}getDefensiveMoves(){const t=gameManager.getState();return this.botSystems.map(n=>{if(n.moveQueue.length>0)return[];const i=[],r=this.threatLevels.get(n.id)??0;if(r>0){const s=r*1.1;if(n.ships<s)if(n.ships<r*.5){const o=vt(t.world,n.id).filter(a=>a.ownerId===this.id).sort((a,l)=>(this.threatLevels.get(a.id)||0)-(this.threatLevels.get(l.id)||0))[0];o&&i.push({message:`Retreating from ${n.id}`,from:n,to:o,units:n.ships-1,score:1e3})}else i.push({message:`Holding ${n.id}`,from:n,to:n,units:0,score:r});else n.ships<s*1.5&&i.push({message:`Defending ${n.id} from threat level ${r}`,from:n,to:n,units:0,score:r})}return i})}getCoordinatedAttackMoves(){const t=gameManager.getState(),n=new Map;this.botSystems.forEach(r=>{if(r.moveQueue.length>0||r.ships<5)return;const s=vt(t.world,r.id);s&&s.forEach(o=>{if(o.ownerId!==null&&o.ownerId!==this.id){if(vt(t.world,r.id).filter(l=>l.ownerId&&l.ownerId!==this.id&&l.id!==o.id).length>0)return;n.has(o.id)||n.set(o.id,{target:o,attackers:[]}),n.get(o.id).attackers.push(r)}})});const i=[];return n.forEach(({target:r,attackers:s})=>{const a=vt(t.world,r.id).filter(c=>c.ownerId===r.ownerId).length===0?1.5:1,l=s.reduce((c,f)=>{const v=this.threatLevels.get(f.id)||0,S=Math.max(0,f.ships-v*1.1);return c+Math.floor(S*(1-this.personality.defensiveness))},0),h=(r.ships+(r.homeworld?10:0))*(1.3-this.personality.riskTolerance);l>h&&s.forEach(c=>{if(c.moveQueue.length>0)return;const f=this.threatLevels.get(c.id)||0,v=Math.max(0,c.ships-f*1.1),S=Math.floor(v*(1-this.personality.defensiveness)),A=this.getBestMoveAmount(c,r,S);A>0&&i.push([{message:`Coordinated attack on ${r.id}`,from:c,to:r,units:A,score:(100+(r.homeworld?50:0))*a}])})}),i}getExterminateMoves(){const t=gameManager.getState();return this.botSystems.map(n=>n.moveQueue.length>0?[]:n.ships<3?[]:vt(t.world,n.id).flatMap(r=>{if(r.ownerId===this.id)return[];if(r.ownerId===null&&r.type==="UNINHABITED")return[];if(n.ships>r.ships*1.5+5){const s=n.ships-2;return[{message:`Crushing weak neighbor ${r.id}`,from:n,to:r,units:s,score:40}]}return[]}))}getExploreMoves(){const t=gameManager.getState();return this.botSystems.map(n=>n.moveQueue.length>0?[]:n.ships<2?[]:vt(t.world,n.id).flatMap(r=>{if(r.ownerId!==null)return[];if(r.type==="INHABITED")return[];const s=Math.max(1,Math.floor(n.ships*.3));return[{message:`Exploring ${r.id}`,from:n,to:r,units:s,score:30}]}))}getLogisticsMoves(){const t=gameManager.getState();return this.botSystems.map(n=>{if(n.moveQueue.length>0)return[];if(n.ships<2)return[];if(this.backline.has(n.id)){const i=vt(t.world,n.id).filter(o=>this.frontline.has(o.id)&&o.ownerId===this.id);if(i.length>0){const o=i.sort((a,l)=>a.ships-l.ships)[0];return[{message:"Logistics: Frontline Support",from:n,to:o,units:n.ships-1,score:10}]}const s=vt(t.world,n.id).filter(o=>o.ownerId===this.id).sort((o,a)=>o.ships-a.ships)[0];if(s&&s.ships<n.ships-2)return[{message:"Logistics: Balancing",from:n,to:s,units:Math.floor((n.ships-s.ships)/2),score:5}]}if(this.frontline.has(n.id)){const i=vt(t.world,n.id).filter(r=>r.ownerId===this.id&&(this.threatLevels.get(r.id)||0)>r.ships);if(i.length>0&&(this.threatLevels.get(n.id)||0)<n.ships){const r=i[0];return[{message:"Logistics: Emergency Reinforce",from:n,to:r,units:Math.floor(n.ships/2),score:50}]}}return[]})}getBestMoveAmount(t,n,i){const r=Math.max(0,t.ships-1);let s=0;return n.ownerId===t.ownerId?s=Math.floor((t.ships-n.ships)/2):s=Math.floor(t.ships/2),s=Math.max(0,s),Math.abs(r-i)<Math.abs(s-i)?r:s}chooseMoves(t,n=1){if(t.length===0)return;const i=t.flat().sort(Hp);for(const r of i){if(this.queuedMoves>=this.personality.speed)return;if(Math.random()<n){if(r.from.moveQueue.length>0)continue;Ul(r.from,r.to,r.units,this.id,r.message),r.units>0&&this.queuedMoves++}}}}function Hp(e,t){return e.score!==t.score?t.score-e.score:Math.random()-.5}function De(e,...t){const n=globalThis.gameManager?.getContext?.().C;Pc&&console.log(`[DEBUG][Tick ${n?.tick??null}] ${e}`,...t)}function or(e,t={}){if(!Nc)return;const n=globalThis.gameManager?.getContext?.().C;let i=1;try{i=parseInt(localStorage.getItem(e)??"0",10)+1}catch(r){console.error("Error reading event count from localStorage:",r)}if(localStorage.setItem(e,i+""),window&&window.sa_event)try{window.sa_event(e,{[e]:i,tick:n?.tick??null,...t})}catch(r){console.error("Error tracking event:",r)}}function Hl(e,t,n,i){if(i!==0){if(i<0){if(t.ownerId!==n.ownerId)return;const r=t;t=n,n=r,i=-i}t.ships<i||(n.ownerId===t.ownerId?Gp(e,t,n,i):qp(e,t,n,i))}}function qp(e,t,n,i){const r=t.ownerId,s=n.ships??0;if(Fl(e.S.world,t,n,i),i>s){const o=i-s;t.ships=t.ships-i,n.ships=o,Fp(e,r,n)}else t.ships=t.ships-i,n.ships=s-i}function Fp(e,t,n){n.ownerId=t,n.moveQueue=[],t===e.C.playerId&&qi(e.S,n),n.homeworld&&n.homeworld!==t&&ql(e,n.homeworld,t)}function ql({S:e,E:t,C:n},i,r=null){for(const o of e.world.systemMap.values())o.ownerId===i&&(o.ownerId=r,o.ships=Math.max(Math.floor((o.ships??0)/2),1),o.homeworld=null,o.moveQueue=[],r===n.playerId&&qi(e,o)),o.homeworld===i&&(o.homeworld=null);const s=e.playerMap.get(i);s.isAlive=!1,t.emit("PLAYER_ELIMINATED",{loserId:i,winnerId:r})}function Fl(e,t,n,i){t.movement=[t.movement[0],t.movement[1]+i],n.movement=[n.movement[0]+i,n.movement[1]];for(const r of e.laneMap.values())r.fromId===t.id&&r.toId===n.id?r.movement=[r.movement[0]+i,r.movement[1]]:r.fromId===n.id&&r.toId===t.id&&(r.movement=[r.movement[0],r.movement[1]+i])}function Gp({S:e,C:t},n,i,r){n.ships<r||(n.ships-=r,i.ships+=r,Fl(e.world,n,i,r),i.ownerId===t.playerId&&qi(e,i))}function Gl(e){for(const t of e.S.world.systemMap.values())for(t.lastMove=null;t.moveQueue.length>0;){const n=t.moveQueue.shift();n&&Xl(e,n)}}function Xl(e,t){t.playerId===e.C.playerId&&De(`player move: ${JSON.stringify(t)}`);const n=e.S.world.systemMap.get(t.fromId),i=e.S.world.systemMap.get(t.toId);Hl(e,n,i,t.ships),n.lastMove=t,e.E.emit("MAKE_MOVE",t)}function Xp(e,t){const n=Yl(e.S,t);n&&Xl(e,n)}function Yp(e,t){const n=e.world.systemMap.get(t.fromId);return!(n.ownerId!==t.playerId||!Hi(e.world,t.fromId,t.toId)||n.ships<=1)}function Yl(e,t){if(!Yp(e,t))return null;switch(t.type){case"MASS_MOVE":return n(t.fromId,t.toId);case"BALANCED_MOVE":return i(t.fromId,t.toId)}return null;function n(r,s){const{C:o}=globalThis.gameManager.getContext(),l=e.world.systemMap.get(r).ships-1;return l<=0?null:{message:`Move ${l} ships from ${r} to ${s}`,ships:l,toId:s,fromId:r,playerId:o.playerId}}function i(r,s){const{C:o}=globalThis.gameManager.getContext(),a=e.world.systemMap.get(r),l=e.world.systemMap.get(s),u=l.ownerId===a.ownerId?Math.floor((a.ships-l.ships)/2):Math.floor(a.ships/2);return u<=0?null:{message:`Move ${u} ships from ${a.id} to ${l.id}`,ships:u,toId:l.id,fromId:a.id,playerId:o.playerId}}}function Vl(e){for(const t of e.playerMap.values()){const n={playerId:t.id,systems:0,ships:0,homeworld:0};for(const i of e.world.systemMap.values())i.ownerId===t.id&&(n.systems+=1,n.ships+=i.ships??0,i.homeworld===t.id&&(n.homeworld=i.ships??0));t.stats=n}}function Kl(e){for(const t of e.world.systemMap.values())t.type==="INHABITED"&&(t.ownerId||t.ships<Ea)&&(t.ships=(t.ships??0)+Sc)}function jl(e){for(const t of e.world.systemMap.values())t.ownerId!=null&&(t.ships=(t.ships??0)+bc)}function Vp({S:e,C:t,E:n,P:i}){if(t.status==="PLAYING"&&i)if(e.playerMap.size>1){const r=Array.from(e.playerMap.values());if(r.reduce((o,a)=>(o+=a.stats.homeworld>0?1:0,o),0)===1){const o=r.find(l=>l.stats.homeworld>0).id,a=e.playerMap.get(o);n.emit("PLAYER_WIN",{playerId:o,message:`${a.name} has conquered The Bubble!`}),n.emit("GAME_STOP",void 0)}}else Array.from(e.world.systemMap.values()).filter(s=>s.ownerId!==t.playerId).length===0&&(n.emit("PLAYER_WIN",{playerId:t.playerId,message:`${i.name} has conquered The Bubble!`}),n.emit("GAME_STOP",void 0))}function Kp(e,t=!1){const{S:n,C:i}=e;i.tick%xc===0&&Kl(n),i.tick%Mc===0&&jl(n);for(const r of n.world.systemMap.values())r.movement=[0,0];for(const r of n.world.laneMap.values())r.movement=[0,0];t||(zp(e),Gl(e)),Vl(n)}const jp=ls({length:5});function Wl({S:e,C:t}){e.world=Bi();const n=se/(t.config.numSystems-1),i=-se/2,r=se/2;De("Generating map...");const s=Math.min(.08,Math.sqrt(Math.PI/t.config.numSystems));for(let h=i;h<r;h+=n){const c=Math.asin(h/(se/2))*(180/Math.PI),v=[Math.random()*360-180,c],S=Qp(v),A=Rl(e.world,S.location);if(A){if(vi(v,A.location)<s){h-=n;continue}Gr(e.world,S,A)}Ll(e.world,S)}const o=Array.from(e.world.systemMap.values()),a=[o[o.length-1]];for(let h=o.length-2;h>=0;h--){const c=o[h],f=bs(c.location,a);f&&Gr(e.world,c,f),a.push(c)}Ui(e.world),De(`Generated ${e.world.systemMap.size} systems and ${e.world.laneMap.size} lanes.`);const l=[...o],u=Math.max(Ic*t.config.numSystems,cr+t.config.numBots);for(let h=0;h<u&&l.length!==0;h++){const c=Math.floor(Math.random()*l.length);if(c===0){h--;continue}const f=l[c];f.ownerId=null,f.type="INHABITED",f.ships=Ea+Math.floor(Math.random()*10),f.homeworld=null,l.splice(c,1)}}function Wp(e,t){const n=Array.from(e.world.systemMap.values()).filter(s=>!s.ownerId&&s.type==="INHABITED");if(n.length===0)throw"No available homeworlds to join.";const i=Math.floor(Math.random()*n.length),r=n[i];return r.ships=1,r.ownerId=r.homeworld=t,r.type="INHABITED",r}function Qp(e){return{id:"s"+jp(),type:"UNINHABITED",location:e,ownerId:null,ships:0,homeworld:null,moveQueue:[],lastMove:null,movement:[0,0]}}function Zp(e){const t=$s();return Wl({...e,S:t}),t}const Jp=Object.freeze(Object.defineProperty({__proto__:null,addLane:Gr,addPlayer:zl,addSystem:Ll,assignSystem:Wp,buildNeighborMap:Ui,checkVictory:Vp,createWorld:Bi,defaultConfig:Dl,doQueuedMoves:Gl,eliminatePlayer:ql,findClosestSystem:Rl,findClosestSystemInList:bs,gameTick:Kp,generateMap:Wl,getAdjacentSystems:vt,getPlayersHomeworld:Es,hasLane:Hi,initalState:$s,moveShips:Hl,orderToMove:Yl,queueMove:Ul,revealAllSystems:Bl,roundUpdate:jl,setup:Zp,takeOrder:Xp,turnUpdate:Kl,updateStats:Vl,visitSystem:qi,worldFromJson:Rp,worldToJson:Dp},Symbol.toStringTag,{value:"Module"})),As=Math.PI,Jo=As/2,ta=180/As,ea=As/180,tg=Math.atan2,na=Math.cos,eg=Math.max,ng=Math.min,ia=Math.sin,ig=Math.sign||function(e){return e>0?1:e<0?-1:0},Ql=Math.sqrt;function rg(e){return e>1?Jo:e<-1?-Jo:Math.asin(e)}function Zl(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function wt(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function $i(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]}function Ei(e){var t=Ql(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]}function Is(e){return[tg(e[1],e[0])*ta,rg(eg(-1,ng(1,e[2])))*ta]}function qt(e){const t=e[0]*ea,n=e[1]*ea,i=na(n);return[i*na(t),i*ia(t),ia(n)]}function Ts(e){return e=e.map(t=>qt(t)),Zl(e[0],wt(e[2],e[1]))}function sg(e){const t=ag(e),n=ug(t),i=lg(n,e),r=hg(n,e.length),s=og(r,e),o=cg(n,e),{polygons:a,centers:l}=fg(o,n,e),u=dg(a),h=gg(n,e),c=pg(i,n);return{delaunay:t,edges:i,triangles:n,centers:l,neighbors:r,polygons:a,mesh:u,hull:h,urquhart:c,find:s}}function og(e,t){function n(i,r){let s=i[0]-r[0],o=i[1]-r[1],a=i[2]-r[2];return s*s+o*o+a*a}return function(r,s,o){o===void 0&&(o=0);let a,l,u=o;const h=qt([r,s]);do a=o,o=null,l=n(h,qt(t[a])),e[a].forEach(c=>{let f=n(h,qt(t[c]));if(f<l){l=f,o=c,u=c;return}});while(o!==null);return u}}function ag(e){if(e.length<2)return{};let t=0;for(;isNaN(e[t][0]+e[t][1])&&t++<e.length;);const n=yi(e[t]),i=Cl().translate([0,0]).scale(1).rotate(n.invert([180,0]));e=e.map(i);const r=[];let s=1;for(let c=0,f=e.length;c<f;c++){let v=e[c][0]**2+e[c][1]**2;!isFinite(v)||v>1e32?r.push(c):v>s&&(s=v)}const o=1e6*Ql(s);r.forEach(c=>e[c]=[o,0]),e.push([0,o]),e.push([-o,0]),e.push([0,-o]);const a=gs.from(e);a.projection=i;const{triangles:l,halfedges:u,inedges:h}=a;for(let c=0,f=u.length;c<f;c++)if(u[c]<0){const v=c%3==2?c-2:c+1,S=c%3==0?c+2:c-1,A=u[v],N=u[S];u[A]=N,u[N]=A,u[v]=u[S]=-1,l[c]=l[v]=l[S]=t,h[l[A]]=A%3==0?A+2:A-1,h[l[N]]=N%3==0?N+2:N-1,c+=2-c%3}else l[c]>e.length-3-1&&(l[c]=t);return a}function lg(e,t){const n=new Set;return t.length===2?[[0,1]]:(e.forEach(i=>{if(i[0]!==i[1]&&!(Ts(i.map(r=>t[r]))<0))for(let r=0,s;r<3;r++)s=(r+1)%3,n.add(Ta([i[r],i[s]]).join("-"))}),Array.from(n,i=>i.split("-").map(Number)))}function ug(e){const{triangles:t}=e;if(!t)return[];const n=[];for(let i=0,r=t.length/3;i<r;i++){const s=t[3*i],o=t[3*i+1],a=t[3*i+2];s!==o&&o!==a&&n.push([s,a,o])}return n}function cg(e,t){return e.map(n=>{const i=n.map(s=>t[s]).map(qt),r=$i($i(wt(i[1],i[0]),wt(i[2],i[1])),wt(i[0],i[2]));return Is(Ei(r))})}function hg(e,t){const n=[];return e.forEach(i=>{for(let r=0;r<3;r++){const s=i[r],o=i[(r+1)%3];n[s]=n[s]||[],n[s].push(o)}}),e.length===0&&(t===2?(n[0]=[1],n[1]=[0]):t===1&&(n[0]=[])),n}function fg(e,t,n){const i=[],r=e.slice();if(t.length===0){if(n.length<2)return{polygons:i,centers:r};if(n.length===2){const a=qt(n[0]),l=qt(n[1]),u=Ei($i(a,l)),h=Ei(wt(a,l)),c=wt(u,h),f=[u,wt(u,c),wt(wt(u,c),c),wt(wt(wt(u,c),c),c)].map(Is).map(o);return i.push(f),i.push(f.slice().reverse()),{polygons:i,centers:r}}}t.forEach((a,l)=>{for(let u=0;u<3;u++){const h=a[u],c=a[(u+1)%3],f=a[(u+2)%3];i[h]=i[h]||[],i[h].push([c,f,l,[h,c,f]])}});const s=i.map(a=>{const l=[a[0][2]];let u=a[0][1];for(let h=1;h<a.length;h++)for(let c=0;c<a.length;c++)if(a[c][0]==u){u=a[c][1],l.push(a[c][2]);break}if(l.length>2)return l;if(l.length==2){const h=ra(n[a[0][3][0]],n[a[0][3][1]],r[l[0]]),c=ra(n[a[0][3][2]],n[a[0][3][0]],r[l[0]]),f=o(h),v=o(c);return[l[0],v,l[1],f]}});function o(a){let l=-1;return r.slice(t.length,1/0).forEach((u,h)=>{u[0]===a[0]&&u[1]===a[1]&&(l=h+t.length)}),l<0&&(l=r.length,r.push(a)),l}return{polygons:s,centers:r}}function ra(e,t,n){e=qt(e),t=qt(t),n=qt(n);const i=ig(Zl(wt(t,e),n));return Is(Ei($i(e,t)).map(r=>i*r))}function dg(e){const t=[];return e.forEach(n=>{if(!n)return;let i=n[n.length-1];for(let r of n)r>i&&t.push([i,r]),i=r}),t}function pg(e,t){return function(n){const i=new Map,r=new Map;return e.forEach((s,o)=>{const a=s.join("-");i.set(a,n[o]),r.set(a,!0)}),t.forEach(s=>{let o=0,a=-1;for(let l=0;l<3;l++){let u=Ta([s[l],s[(l+1)%3]]).join("-");i.get(u)>o&&(o=i.get(u),a=u)}r.set(a,!1)}),e.map(s=>r.get(s.join("-")))}}function gg(e,t){const n=new Set,i=[];e.map(a=>{if(!(Ts(a.map(l=>t[l>t.length?0:l]))>1e-12))for(let l=0;l<3;l++){let u=[a[l],a[(l+1)%3]],h=`${u[0]}-${u[1]}`;n.has(h)?n.delete(h):n.add(`${u[1]}-${u[0]}`)}});const r=new Map;let s;if(n.forEach(a=>{a=a.split("-").map(Number),r.set(a[0],a[1]),s=a[0]}),s===void 0)return i;let o=s;do{i.push(o);let a=r.get(o);r.set(o,-1),o=a}while(o>-1&&o!==s);return i}function mg(e){const t=function(n){if(t.delaunay=null,t._data=n,typeof t._data=="object"&&t._data.type==="FeatureCollection"&&(t._data=t._data.features),typeof t._data=="object"){const i=t._data.map(r=>[t._vx(r),t._vy(r),r]).filter(r=>isFinite(r[0]+r[1]));t.points=i.map(r=>[r[0],r[1]]),t.valid=i.map(r=>r[2]),t.delaunay=sg(t.points)}return t};return t._vx=function(n){if(typeof n=="object"&&"type"in n)return Oo(n)[0];if(0 in n)return n[0]},t._vy=function(n){if(typeof n=="object"&&"type"in n)return Oo(n)[1];if(1 in n)return n[1]},t.x=function(n){return n?(t._vx=n,t):t._vx},t.y=function(n){return n?(t._vy=n,t):t._vy},t.polygons=function(n){if(n!==void 0&&t(n),!t.delaunay)return!1;const i={type:"FeatureCollection",features:[]};return t.valid.length===0||(t.delaunay.polygons.forEach((r,s)=>i.features.push({type:"Feature",geometry:r?{type:"Polygon",coordinates:[[...r,r[0]].map(o=>t.delaunay.centers[o])]}:null,properties:{site:t.valid[s],sitecoordinates:t.points[s],neighbours:t.delaunay.neighbors[s]}})),t.valid.length===1&&i.features.push({type:"Feature",geometry:{type:"Sphere"},properties:{site:t.valid[0],sitecoordinates:t.points[0],neighbours:[]}})),i},t.triangles=function(n){return n!==void 0&&t(n),t.delaunay?{type:"FeatureCollection",features:t.delaunay.triangles.map((i,r)=>(i=i.map(s=>t.points[s]),i.center=t.delaunay.centers[r],i)).filter(i=>Ts(i)>0).map(i=>({type:"Feature",properties:{circumcenter:i.center},geometry:{type:"Polygon",coordinates:[[...i,i[0]]]}}))}:!1},t.links=function(n){if(n!==void 0&&t(n),!t.delaunay)return!1;const i=t.delaunay.edges.map(s=>vi(t.points[s[0]],t.points[s[1]])),r=t.delaunay.urquhart(i);return{type:"FeatureCollection",features:t.delaunay.edges.map((s,o)=>({type:"Feature",properties:{source:t.valid[s[0]],target:t.valid[s[1]],length:i[o],urquhart:!!r[o]},geometry:{type:"LineString",coordinates:[t.points[s[0]],t.points[s[1]]]}}))}},t.mesh=function(n){return n!==void 0&&t(n),t.delaunay?{type:"MultiLineString",coordinates:t.delaunay.edges.map(i=>[t.points[i[0]],t.points[i[1]]])}:!1},t.cellMesh=function(n){if(n!==void 0&&t(n),!t.delaunay)return!1;const{centers:i,polygons:r}=t.delaunay,s=[];for(const o of r)if(o)for(let a=o.length,l=o[a-1],u=o[0],h=0;h<a;l=u,u=o[++h])u>l&&s.push([i[l],i[u]]);return{type:"MultiLineString",coordinates:s}},t._found=void 0,t.find=function(n,i,r){if(t._found=t.delaunay.find(n,i,t._found),!r||vi([n,i],t.points[t._found])<r)return t._found},t.hull=function(n){n!==void 0&&t(n);const i=t.delaunay.hull,r=t.points;return i.length===0?null:{type:"Polygon",coordinates:[[...i.map(s=>r[s]),r[i[0]]]]}},e?t(e):t}const Jl=Math.acos,yg=Math.asin,sa=Math.atan2,de=Math.cos,oa=Math.hypot,Xr=Math.max,Yr=Math.min,tu=Math.PI,pe=Math.sin,sn=tu/180,ar=180/tu;class Tt{static fromCartesian([t,n,i]){return[0,i,-n,t]}static fromAngles([t,n,i]){t*=sn/2,n*=sn/2,i=(i||0)*sn/2;const r=pe(t),s=de(t),o=pe(n),a=de(n),l=pe(i),u=de(i);return[s*a*u+r*o*l,r*a*u-s*o*l,s*o*u+r*a*l,s*a*l-r*o*u]}static toAngles([t,n,i,r]){return[sa(2*(t*n+i*r),1-2*(n*n+i*i))*ar,yg(Xr(-1,Yr(1,2*(t*i-r*n))))*ar,sa(2*(t*r+n*i),1-2*(i*i+r*r))*ar]}static interpolateAngles(t,n){const i=Tt.interpolate(Tt.fromAngles(t),Tt.fromAngles(n));return r=>Tt.toAngles(i(r))}static interpolateLinear([t,n,i,r],[s,o,a,l]){s-=t,o-=n,a-=i,l-=r;const u=new Array(4);return h=>{const c=oa(u[0]=t+s*h,u[1]=n+o*h,u[2]=i+a*h,u[3]=r+l*h);return u[0]/=c,u[1]/=c,u[2]/=c,u[3]/=c,u}}static interpolate([t,n,i,r],[s,o,a,l]){let u=Tt.dot([t,n,i,r],[s,o,a,l]);if(u<0&&(s=-s,o=-o,a=-a,l=-l,u=-u),u>.9995)return Tt.interpolateLinear([t,n,i,r],[s,o,a,l]);const h=Jl(Xr(-1,Yr(1,u))),c=new Array(4),f=oa(s-=t*u,o-=n*u,a-=i*u,l-=r*u);return s/=f,o/=f,a/=f,l/=f,v=>{const S=h*v,A=pe(S),N=de(S);return c[0]=t*N+s*A,c[1]=n*N+o*A,c[2]=i*N+a*A,c[3]=r*N+l*A,c}}static dot([t,n,i,r],[s,o,a,l]){return t*s+n*o+i*a+r*l}static multiply([t,n,i,r],[s,o,a,l]){return[t*s-n*o-i*a-r*l,t*o+n*s+i*l-r*a,t*a-n*l+i*s+r*o,t*l+n*a-i*o+r*s]}}const Et=Tt.fromAngles;Et.multiply=Tt.multiply;Et.rotation=Tt.toAngles;Et.interpolate=Tt.interpolateAngles;Et.cartesian=function(e){const t=e[0]*sn,n=e[1]*sn,i=de(n);return[i*de(t),i*pe(t),pe(n)]};Et.delta=function(e,t,n){arguments.length==2&&(n=1);const i=Math.sqrt;function r(h,c){return[h[1]*c[2]-h[2]*c[1],h[2]*c[0]-h[0]*c[2],h[0]*c[1]-h[1]*c[0]]}function s(h,c){return h[0]*c[0]+h[1]*c[1]+h[2]*c[2]}const o=r(e,t),a=i(s(o,o));if(!a)return[1,0,0,0];const l=n*Jl(Xr(-1,Yr(1,s(e,t))))/2,u=pe(l);return[de(l),o[2]/a*u,-o[1]/a*u,o[0]/a*u]};const it={all:new Set,last:null};function ge(){it.all.clear(),it.last=null}function mn(e){it.all.add(e),it.last=e}function vg(e){it.all.clear(),it.all.add(e),it.last=e}function wg(e){it.all.delete(e),it.last===e&&(it.last=null)}function eu(e){return it.all.has(e)}function _g(e){eu(e)?wg(e):mn(e)}function xg({S:e,C:t},n){if(it.last==null)return;const i=[[it.last]],r=new Set;for(r.add(it.last);i.length>0;){const s=i.shift(),o=s[s.length-1];if(o===n){s.forEach(a=>it.all.add(a)),it.last=n;return}for(const a of vt(e.world,o))!r.has(a.id)&&a.ownerId===t.playerId&&(r.add(a.id),i.push([...s,a.id]))}}const aa=.5,Mg=.25,Sg=100,bg=20,$g=ys(".3~s"),ze={Orthographic:Ap,Stereographic:Cl,Mercator:Ep,TransverseMercator:Ip};let Vr,Nt,Be=ze[wc],J=Be().translate([0,0]),Jt=J.scale(),Fi=ws().projection(J),jn;const Eg=mg().x(e=>e.location[0]).y(e=>e.location[1]);function Ag(){const e=Object.keys(ze),n=(e.findIndex(i=>ze[i]===Be)+1)%e.length;Ig(e[n])}function Ig(e){Be=ze[e],J=Be(),J.translate([0,0]).rotate([0,0,0]).scale(Jt),Jt=J.scale(),Fi=ws().projection(J)}function Se(e){const t=J.rotate();t[0]+=e[0],t[1]+=e[1],e.length===3&&(t[2]+=e[2]),J.rotate(t)}function Tg(e,t){Vr=st(e),Nt=Vr.select("svg"),Nt.attr("width","100vw").attr("height","100vh").attr("viewBox",`-${Zn/2} -${se/2} ${Zn} ${se}`).on("contextmenu",o=>o.preventDefault()),Kr(t.S),iu(t),ru(t),nu(t),Nt.call(n()),Nt.call(i()),window.addEventListener("resize",s);function n(){return r().on("drag.render",()=>W()).on("end.render",()=>W())}function i(){return Lp().filter(o=>o.type==="wheel").on("zoom",o=>{if(o.transform.k>aa){const a=Jt*o.transform.k;J.scale(a),W()}else o.transform.k=aa})}function r(){let o,a,l,u,h;function c(A,N){const I=mf(A,N);if(I.length!==h&&(h=I.length,h>1&&(u=Math.atan2(I[1][1]-I[0][1],I[1][0]-I[0][0])),f.apply(N,[A,N])),h>1){const E=Js(I,k=>k[0]),C=Js(I,k=>k[1]),P=Math.atan2(I[1][1]-I[0][1],I[1][0]-I[0][0]);return[E,C,P]}return I[0]}function f({x:A,y:N}){const I=S([A,N]);o=Et.cartesian(J.invert(I)),l=J.rotate(),a=Et(l)}function v(A){const N=S([A.x,A.y]),I=Et.cartesian(J.rotate(l).invert(N)),E=Et.delta(o,I);let C=Et.multiply(a,E);const P=c(A,this);if(P[2]){const k=(P[2]-u)/2,O=-Math.sin(k),D=Math.sign(Math.cos(k));C=Et.multiply([Math.sqrt(1-O*O),0,0,D*O],C)}J.rotate(Et.rotation(C)),E[0]<.7&&f.apply(this,[A,this])}function S(A){const N=parseInt(Nt.style("width")),I=parseInt(Nt.style("height"));return[A[0]-N/2,A[1]-I/2]}return Mf().filter(A=>A.button===1||A.touches).on("start",f).on("drag",v)}function s(){const{S:o}=globalThis.gameManager.getContext();Kr(o)}}function Kr(e){const t=Nt.node()?.getBoundingClientRect(),n=window.devicePixelRatio||1,i=t?.height||se,r=t?.width||Zn,a=Vr.selectAll("canvas").data([null]).join(h=>h.append("canvas").style("position","absolute").style("top",0).style("left",0).style("z-index",-1).style("pointer-events","none")).attr("width",r*n).attr("height",i*n).style("width",`${r}px`).style("height",`${i}px`).node().getContext("2d");a.setTransform(1,0,0,1,0,0),a.scale(n,n),a.translate(r/2,i/2);const l=Math.min(r/Zn,i/se);a.scale(l,l);const u="#FFFFFF48";if(Be===ze.Orthographic){const h=J.scale();a.strokeStyle=u,a.lineWidth=1,a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=10,a.shadowColor=u,a.beginPath(),a.arc(0,0,h,0,Math.PI*2),a.stroke(),a.fill()}{a.shadowBlur=0,a.strokeStyle="rgba(51, 51, 51, 0.5)";const h=Ng(e),c=ws().projection(J).context(a);a.beginPath(),c(h),a.stroke()}}function Ng(e){const t=rp(),n=Es(e);if(n){if(!jn){const i=yi([0,90+n.location[1],0]),r=yi([n.location[0],0,0]);jn={type:"FeatureCollection",features:t.lines().map(s=>({type:"Feature",geometry:{type:"LineString",coordinates:s.coordinates.map(o=>r(i(o)))}}))}}return jn}return t()}function la(e){const t=J.scale()*e;t<Jt*Mg||t>Jt*Sg||(J.scale(t),W())}function jr(){const e=globalThis.gameManager.getContext(),t=Es(e.S);if(!t)return;jn=null;const n=t.location;Be===ze.Orthographic?Wr([n[0],n[1]-45]):Wr(n),J.scale(Jt)}function Pg(e){const n=globalThis.gameManager.getContext().S.world.systemMap.get(e);n&&(Wr(n.location),J.scale(Jt))}function Wr(e){J.rotate([-e[0],-e[1],0]),W()}let ua=null;function W(){return cancelAnimationFrame(ua),ua=requestAnimationFrame(()=>e());function e(t){Nt&&(t??=globalThis.gameManager.getContext(),iu(t),Kr(t.S),nu(t),ru(t))}}function nu({S:e,C:t,P:n}){const r=J.scale()/Jt<1;let s=e.world.systemMap.values();n&&t.config.fow&&(s=n.revealedSystems.values().map(l=>e.world.systemMap.get(l))),s=s.filter(l=>!!Fi({type:"Point",coordinates:l.location}));const a=Nt.selectAll("g#systems").data([null]).join(l=>l.append("g").attr("id","systems")).classed("reduced-size",r).classed("hidden",!1).selectAll(".system").data(s,l=>l.id).join(l=>{const u=l.append("g").attr("class","system").attr("id",h=>h.id).on("click",(h,c)=>{Ai(h,c),W()}).on("contextmenu",(h,c)=>{h.preventDefault(),Ai(h,c),W()});return u.append("circle").attr("class","system-outline").attr("cx",0).attr("cy",0).attr("r",bg/2),u.append("text").attr("class","ship-count").attr("y",-10).attr("x",0).attr("text-anchor","start"),u.append("text").attr("class","system-icon").attr("y",0).attr("x",0).attr("text-anchor","end"),u});a.style("--owner-color",l=>e.playerMap.get(l.ownerId)?.color??null).classed("own",l=>l.ownerId===t.playerId).classed("selected",l=>eu(l.id)).classed("moved",l=>l.movement[0]>0||l.movement[1]>0).classed("inhabited",l=>l.type==="INHABITED").classed("homeworld",l=>!!l.homeworld&&l.ownerId===l.homeworld).classed("visited",l=>n?n.visitedSystems.has(l.id):!0).attr("transform",l=>`translate(${J(l.location)})`),a.select(".system-icon").text(l=>l.homeworld&&l.ownerId===l.homeworld?"â¶":l.type==="INHABITED"?"â¦":"â"),a.select(".ship-count").text(l=>r?"":(l.type==="INHABITED"?"â´":"")+(l.ships?$g(l.ships):""))}const Cg=(()=>{let e=[],t;return n=>{if(!e||t!==n.world.systemMap){t=n.world.systemMap;const i=Array.from(t.values());e=Eg.polygons(i).features}return e}})();function iu({S:e,C:t,P:n}){const r=J.scale()/Jt<1;let s=Cg(e);n&&t.config.fow&&(s=s.filter(l=>{const u=l.properties?.site;return n.revealedSystems.has(u.id)})),Nt.selectAll("g#mesh").data([null]).join(l=>l.append("g").attr("id","mesh")).classed("reduced-size",r).classed("hidden",!1).selectAll("path").data(s).join(l=>l.append("path").classed("region",!0).on("click",(u,h)=>{Ai(u,h),W()}).on("contextmenu",(u,h)=>{u.preventDefault(),Ai(u,h),W()})).attr("d",l=>Fi(l)).datum(l=>l.properties.site).classed("visited",l=>n?n.visitedSystems.has(l.id):!0).style("--owner-color",l=>e.playerMap.get(l.ownerId)?.color??null)}function ru({S:e,C:t,P:n}){let i=e.world.laneMap.values();n&&t.config.fow&&(i=i.filter(o=>n.revealedSystems.has(o.fromId)&&n.revealedSystems.has(o.toId)));const s=Nt.selectAll("g#lanes").data([null]).join(o=>o.append("g").attr("id","lanes")).selectAll("g.lane-group").data(i,o=>o.id).join(o=>{const a=o.append("g").attr("class","lane-group").attr("id",l=>l.id).on("click",(l,u)=>{ca(l,u),W()}).on("contextmenu",(l,u)=>{l.preventDefault(),ca(l,u),W()});return a.append("path").attr("class","lane"),a.append("path").attr("class","pulse"),a}).datum(o=>{const a=e.world.systemMap.get(o.toId),l=e.world.systemMap.get(o.fromId),u=Fi({type:"LineString",coordinates:[l.location,a.location]});return{...o,from:e.world.systemMap.get(o.fromId),to:e.world.systemMap.get(o.toId),path:u}});s.style("--owner-color",o=>{const a=o.from;if(!a.ownerId)return null;const l=o.to;return!l.ownerId||a.ownerId!==l.ownerId?null:e.playerMap.get(a.ownerId)?.color??null}),s.select("path.lane").attr("d",o=>o.path).classed("own",o=>{const a=o.from,l=o.to;return a.ownerId===t.playerId||l.ownerId===t.playerId}).style("--path-length",o=>{const a=st(`#${o.id} .lane`).node();return a?a.getTotalLength():200}),s.select("path.pulse").attr("d",o=>o.path).classed("moved",o=>o.movement[0]>0||o.movement[1]>0).style("stroke-width",o=>{if(o.movement[0]===0&&o.movement[1]===0)return null;const a=2,l=Math.floor(Math.log2(Math.max(o.movement[0],o.movement[1])));return`${(a+l)*2}px`}).classed("moved--fwd",o=>o.movement[0]>o.movement[1]).classed("moved--bak",o=>o.movement[1]>o.movement[0])}function kg(){document.getElementById("optionsButton")?.addEventListener("click",su),document.getElementById("helpButton").addEventListener("click",ou)}async function su(){if(await Og()){const t=document.getElementById("optionsForm"),n=new FormData(t),i=globalThis.gameManager,r=+n.get("numBots"),s=n.get("playerName"),o=n.get("fow")==="on",a=+n.get("numSystems");i.setConfig({numBots:r,playerName:s,fow:o,numSystems:48*2**a})}}function Og(){const e=document.getElementById("optionsDialog");return e.showModal(),new Promise(t=>{e.addEventListener("close",()=>t(!0)),e.addEventListener("cancel",()=>t(!1))})}function ou(){document.getElementById("helpDialog").showModal()}function Qr(e){const t=document.getElementById("endDialog");return t.showModal(),t.querySelector("p#endMessage").textContent=e,new Promise(n=>{t.addEventListener("close",()=>n(!0)),t.addEventListener("cancel",()=>n(!1))})}function Lg(){const e=document.getElementById("startDialog");return e.showModal(),new Promise(t=>{e.addEventListener("close",()=>t(!0)),e.addEventListener("cancel",()=>t(!1))})}const be=5;function Rg(){st("body").on("keypress.controls",null),st("body").on("keyup.controls",null),st("body").on("keyup.cheats",null),Ia&&st("body").on("keyup.cheats",e=>{if(!e.altKey)return;e.preventDefault();const{S:t,C:n}=globalThis.gameManager.getContext();switch(e.code){case"KeyC":for(const i of t.world.systemMap.values())i.ownerId===n.playerId&&(i.ships*=2);W();return;case"KeyR":Bl(t),W();return;case"NumpadAdd":case"Equal":{const i=Math.min(16,n.config.timeScale*2);globalThis.gameManager.setConfig({timeScale:i}),De(`Time scale increased to ${n.config.timeScale}x`);return}case"NumpadSubtract":case"Minus":{const i=Math.max(.25,n.config.timeScale/2);globalThis.gameManager.setConfig({timeScale:i}),De(`Time scale decreased to ${n.config.timeScale}x`);return}}}),st("body").on("keyup.controls",async e=>{switch(e.key){case"Escape":ge(),W();return;case"?":ou();return;case"x":{if(!e.ctrlKey)return;if(await Qr("Are you sure you want to quit?")){const{C:n,E:i}=globalThis.gameManager.getContext();i.emit("PLAYER_QUIT",{playerId:n.playerId})}return}}}),st("body").on("keypress.controls",e=>{switch(e.code){case"Space":"pauseToggle"in globalThis.gameManager&&globalThis.gameManager.pauseToggle();return;case"Equal":case"NumpadAdd":la(1.2),W();return;case"Minus":case"NumpadSubtract":la(.8),W();return;case"KeyW":Se([0,be]),W();return;case"KeyA":Se([-be,0]),W();return;case"KeyS":Se([0,-be]),W();return;case"KeyD":Se([be,0]),W();return;case"KeyQ":Se([0,0,be]),W();break;case"KeyE":Se([0,0,-be]),W();break;case"KeyH":jr(),W();return;case"KeyC":it.last&&(Pg(it.last),W());return;case"KeyP":Ag(),jr(),W();return}})}function ca(e,t){const{S:n,C:i}=globalThis.gameManager.getContext();if(i.status==="PLAYING")switch(e.button){case 0:break;case 2:{let r=n.world.systemMap.get(t.fromId),s=n.world.systemMap.get(t.toId);if(r.ownerId!==i.playerId&&s.ownerId!==i.playerId)return;if(r.ownerId!==i.playerId){const o=r;r=s,s=o}else if(r.ownerId===r.ownerId&&s.ships>r.ships){const o=r;r=s,s=o}if(Dg(r.id,s.id),s.ownerId!==i.playerId)return;e.altKey||(!e.ctrlKey&&!e.shiftKey&&ge(),mn(r.id),s.ownerId===i.playerId&&mn(s.id));break}}}function Ai(e,t){const n=globalThis.gameManager.getContext();if(n.C.status==="PLAYING")switch(Ia&&e.altKey&&(De(""+t.id,t.lastMove?.message??"none",t.lastMove?.ships??0),console.log(t)),e.button){case 0:if(t.ownerId!==n.C.playerId)return;e.ctrlKey||e.metaKey?_g(t.id):e.shiftKey?xg(n,t.id):vg(t.id);break;case-1:case 2:{const i=Array.from(it.all);if(i.length===0)return;i.forEach(r=>{zg(r,t.id),t.ownerId===n.C.playerId&&(e.altKey||(!e.ctrlKey&&!e.shiftKey&&ge(),mn(t.id)))});break}}}function Dg(e,t){const{S:n,E:i,C:r}=globalThis.gameManager.getContext();if(!Hi(n.world,e,t))return;const s={type:"BALANCED_MOVE",message:`Balanced move from ${e} to ${t}`,toId:t,fromId:e,playerId:r.playerId};i.emit("TAKE_ORDER",s)}function zg(e,t){const{S:n,E:i,C:r}=globalThis.gameManager.getContext();if(!Hi(n.world,e,t))return;const s={type:"MASS_MOVE",toId:t,fromId:e,playerId:r.playerId,message:`Mass move from ${e} to ${t}`};i.emit("TAKE_ORDER",s)}let au=0;const Ii=[];function Bg(){au=0,Ii.length=0;const{E:e}=globalThis.gameManager.getContext();e.emit("MESSAGES_UPDATED",{messages:Ii})}function Un(e){const{C:t,E:n}=globalThis.gameManager.getContext();Ii.push({id:au++,message:e,tick:t.tick}),n.emit("MESSAGES_UPDATED",{messages:Ii})}class Ug{constructor(){this.listeners={}}on(t,n){return this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(n),()=>{this.listeners[t]=this.listeners[t].filter(i=>i!==n)}}emit(t,n){const i=this.listeners[t];if(i)for(const r of i)try{r(n)}catch(s){console.error(`Error in listener for event ${String(t)}:`,s)}}clear(){this.listeners={}}}class Hg{constructor(){this.events=new Ug,this.game=Jp,this.state=$s(),this.config=Dl(),this.tick=0,this.status="WAITING",this.runningInterval=null,this.#e()}getState(){return Jn?Object.freeze({...this.state}):this.state}getConfig(){return Jn?Object.freeze({...this.config}):this.config}setConfig(t){this.config={...this.config,...t}}getContext(){return{S:this.state,E:this.events,P:this.state.playerMap.get(this.playerId),C:{tick:this.tick,status:this.status,playerId:this.playerId,config:this.getConfig()}}}addPlayer(t){if(this.state.playerMap.has(t.id))return this.state.playerMap.get(t.id);const n=t.score??{userId:t.id,playerName:t.name??`Player ${this.state.playerMap.size+1}`,score:0,tick:0,timestamp:Date.now()},i={name:t.name??`Player ${this.state.playerMap.size+1}`,score:n,color:"#000000",...t,stats:{playerId:t.id,systems:0,ships:0,homeworld:0},isAlive:!0,visitedSystems:new Set,revealedSystems:new Set};return zl(this.state,i),i}gameStart(){this.status="PLAYING",this.tick=0,this.events.emit("GAME_START",void 0),this.#t()}gameStop(){this.status="FINISHED",this.stopGameLoop()}gameTick(){this.tick++,this.game.gameTick(this.getContext()),this.game.checkVictory(this.getContext()),this.events.emit("STATE_UPDATED",{state:this.state,status:this.status})}#t(){if(this.status!=="PLAYING"){this.gameStop();return}this.stopGameLoop(),this.gameTick(),this.events.emit("GAME_TICK",{tick:this.tick}),this.runningInterval=setTimeout(()=>this.#t(),_c/this.config.timeScale)}startGameLoop(){this.#t()}stopGameLoop(){this.runningInterval&&(clearTimeout(this.runningInterval),this.runningInterval=null)}#e(){this.events.on("GAME_STOP",()=>{this.gameStop()}),this.events.on("TAKE_ORDER",t=>{this.game.takeOrder(this.getContext(),t),this.events.emit("STATE_UPDATED",{state:this.state,status:this.status})})}}const ha=ls({length:5});class qg extends Hg{constructor(){super(),this.#t()}async connect(){this.gameStop(),this.status="WAITING";const t=await this.initializePlayer();this.addPlayer(t),this.playerId=t.id,this.events.emit("GAME_INIT",void 0),await Lg(),this.gameSetup(t),this.gameStart(),W()}gameSetup(t){const n=this.getContext();this.state=this.game.setup(n),Bg(),t.name=this.config.playerName;const i=this.onPlayerJoin(1,t);this.game.assignSystem(this.state,t.id);const r=cr+ +this.config.numBots;for(let s=2;s<=r;s++){const o=this.onPlayerJoin(s);this.game.assignSystem(this.state,o.id)}this.setupThisPlayer(i.id),localStorage.setItem("starz_playerId",i.id),localStorage.setItem("starz_playerName",i.name),localStorage.setItem("starz_score",i.score.score.toString())}async initializePlayer(){const t=this.playerId=localStorage.getItem("starz_playerId")??ha(),n=this.config.playerName,i=+(localStorage.getItem("starz_score")??0);return localStorage.setItem("starz_playerId",t),localStorage.setItem("starz_playerName",n),localStorage.setItem("starz_score",i.toString()),{id:t,name:n,score:{score:i}}}gameStart(){or("starz_gamesStarted"),super.gameStart(),Un("Game started.");const t=this.state.playerMap.get(this.playerId);t&&Un(`You are ${t.name}.`)}gameStop(){super.gameStop(),ge(),W()}onPlayerJoin(t,n={}){const i=Cc[t],r=n.name??`Bot ${t}`,s=ha(),o=t>cr?new Up({playerIndex:t,id:s,name:r}):void 0;return this.addPlayer({id:s,name:r,bot:o,color:i,...n})}pauseToggle(){this.status==="PAUSED"?(this.status="PLAYING",super.startGameLoop()):this.status==="PLAYING"&&(this.status="PAUSED",super.stopGameLoop())}async onPlayerWin(t,n){n&&Un(n),this.game.revealAllSystems(this.state),ge();let i=!1;t===this.playerId?(or("starz_gamesWon"),i=await Qr("You have conquered The Bubble!")):(or("starz_gamesLost",{winnerId:t}),i=await Qr("You have lost your homeworld! Click to return to lobby.  ESC to spectate.")),i&&this.restart()}restart(){this.stopGameLoop(),ge(),this.tick=0,this.state=this.game.initalState(),this.connect()}onEliminatePlayer(t,n){const i=this.state.playerMap.get(t),r=this.state.playerMap.get(n),s=n===null?`${i.name} has been eliminated!`:`${r.name} has eliminated ${i.name}!`;Un(s),t===this.playerId?(this.submitWinLoss(-1),this.onPlayerWin(n)):n===this.playerId&&this.submitWinLoss(1)}async submitWinLoss(t){const n=+(localStorage.getItem("starz_score")??0)+t;localStorage.setItem("starz_score",n.toString())}addPlayer(t){const n=super.addPlayer({color:t.color??Fg(),...t});return document.documentElement.style.setProperty(`--player-${n.id}`,n.color),n}setupThisPlayer(t){this.playerId=t;const n=this.state.playerMap.get(t),i=this.game.getPlayersHomeworld(this.state);this.game.visitSystem(this.state,i),jr(),n.bot||(ge(),mn(i.id))}#t(){kg(),Rg(),this.events.on("PLAYER_WIN",({playerId:t,message:n})=>{this.onPlayerWin(t,n)}),this.events.on("PLAYER_ELIMINATED",({loserId:t,winnerId:n})=>{this.onEliminatePlayer(t,n)}),this.events.on("PLAYER_QUIT",({playerId:t})=>{this.game.eliminatePlayer(this.getContext(),t)})}}function Fg(){const e="0123456789ABCDEF";let t="#";for(let n=0;n<6;n++)t+=e[Math.floor(Math.random()*16)];return t}var Gg=Object.defineProperty,Xg=Object.getOwnPropertyDescriptor,lu=(e,t,n,i)=>{for(var r=i>1?void 0:i?Xg(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(r=(i?o(t,n,r):o(r))||r);return i&&r&&Gg(t,n,r),r};let Zr=class extends Ut{constructor(){super(...arguments),this.gameManager=new qg}connectedCallback(){super.connectedCallback(),globalThis.gameManager=this.gameManager,this.gameManager.connect()}createRenderRoot(){return this}};lu([fu({context:He}),zu()],Zr.prototype,"gameManager",2);Zr=lu([Ue("app-root")],Zr);var Yg=Object.defineProperty,Vg=Object.getOwnPropertyDescriptor,Ns=(e,t,n,i)=>{for(var r=i>1?void 0:i?Vg(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(r=(i?o(t,n,r):o(r))||r);return i&&r&&Yg(t,n,r),r};const Kg=ys(".3~s");let Ti=class extends Ut{constructor(){super(...arguments),this.stats=[]}connectedCallback(){super.connectedCallback(),this.gameManager.events.on("STATE_UPDATED",({state:e})=>{const t=Array.from(e.playerMap.values());this.stats=t.sort((n,i)=>i.stats.systems-n.stats.systems||i.stats.ships-n.stats.ships)})}createRenderRoot(){return this}render(){return Bt`
      <table id="leaderbox">
        ${this.renderHeader()} ${this.renderBody()}
      </table>
    `}renderBody(){return Bt`<tbody>
      ${this.stats.map(t=>Bt`<tr
            style="--owner-color: ${t.color||null}"
            title="${t.bot?t.bot.name:"Human"}"
            class="${t.isAlive?"":"eliminated"}"
          >
            <td>${"Â "}${t.name}${"Â "}</td>
            <td>${"Â "}${t.stats.systems}${"Â "}</td>
            <td>${"Â "}${Kg(t.stats.ships)}${"Â "}</td>
          </tr>`)}
    </tbody>`}renderHeader(){return Bt`<thead>
        <tr>
          <th>Player</th>
          <th>Systems</th>
          <th>Ships</th>
        </tr>
      </thead>
      <tbody></tbody>`}};Ns([yn({context:He,subscribe:!0}),pt({attribute:!1})],Ti.prototype,"gameManager",2);Ns([pt()],Ti.prototype,"stats",2);Ti=Ns([Ue("leaderboard-element")],Ti);var jg=Object.defineProperty,Wg=Object.getOwnPropertyDescriptor,Ps=(e,t,n,i)=>{for(var r=i>1?void 0:i?Wg(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(r=(i?o(t,n,r):o(r))||r);return i&&r&&jg(t,n,r),r};let Ni=class extends Ut{constructor(){super(...arguments),this.tick=0}connectedCallback(){super.connectedCallback(),this.gameManager.events.on("GAME_TICK",({tick:e})=>{this.tick=e??0})}createRenderRoot(){return this}render(){const e=~~(this.tick/2),t=this.tick%2===1?".":"";return Bt`${e}${t}`}};Ps([yn({context:He,subscribe:!0}),pt({attribute:!1})],Ni.prototype,"gameManager",2);Ps([pt({type:Number})],Ni.prototype,"tick",2);Ni=Ps([Ue("tick-box")],Ni);var Qg=Object.defineProperty,Zg=Object.getOwnPropertyDescriptor,oe=(e,t,n,i)=>{for(var r=i>1?void 0:i?Zg(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(r=(i?o(t,n,r):o(r))||r);return i&&r&&Qg(t,n,r),r};let te=class extends Ut{constructor(){super(...arguments),this.version=fa,this.playerName="",this.playerScore=0,this.playerRank=null,this.playerToken="",this.shortId="",this.playerId="",this.keyText="Use this key to restore your player data later.  Click to copy."}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this.updatePlayerInfo(),this.gameManager.events.on("GAME_INIT",()=>{this.updatePlayerInfo()})}render(){return Bt`
      <article>
        <h1>STARZ!</h1>
        <small class="version">v${this.version}</small>

        <div class="lore">
          <p>
            Nobody knows why <i>The Bubble</i> exists, or who built the lattice
            of hyperspace lanes threading its hundreds of star systems together
            like a cosmic web. Its discovery was accidental - a distortion
            ripple detected on the edge of settled space, leading explorers to
            the shimmering boundary of a region where physics seemed... wrong.
          </p>
          <p>
            What <i>is</i> known is this: control of <i>The Bubble</i> means
            control of immense resources and power. Rival factions flood its
            systems, each desperate to carve out their claim before somebody
            else does.
          </p>
          <p>
            As a commander, you are the spearhead of your faction's ambitions:
            tasked with expanding your influence, capturing systems, and
            ultimately dominating <i>The Bubble</i>.
          </p>
        </div>

        <h3>Protect our homeworld. Capture the enemy systems.</h3>
        <form method="dialog">
          <div class="grid">
            <div>
              <input
                name="playerName"
                id="playerNameInput"
                type="text"
                .value=${this.playerName}
                @keydown="${this.onKeydown}"
                placeholder="Name or Save Key"
                minlength="1"
                maxlength="3000"
                required
              />
              <small>(Name will be used in leaderboard)</small>
            </div>
            <div>
              ${this.playerName} [${this.shortId}]
              <span>â¶ ${this.playerScore}</span>
              <br /><small
                >${this.playerRank?`Rank: ${this.playerRank}`:""}</small
              >
              <small
                data-tooltip="${this.keyText}"
                @click="${this.copyText}"
                style="cursor: copy;"
              >
                ${this.playerToken?"Token":""}</small
              >
            </div>
          </div>

          <br /><button type="button" @click="${this.onPlay}">Play</button>
          <br /><button type="button" @click="${this.onOptions}">
            Options
          </button>
        </form>
      </article>
    `}updatePlayerInfo(){const{P:e,C:t}=this.gameManager.getContext();this.playerName=e?.name??t.config?.playerName??"",this.playerScore=e?.score.score??0,this.playerRank=e?.score?.rank??null,this.playerId=t.playerId,this.shortId=t.playerId.length===4?t.playerId:Jg(t.playerId),this.playerToken=this.generateToken(this.gameManager.playerToken)}onPlay(){let t=this.querySelector("#playerNameInput").value.trim()||"Anonymous";t=t.substring(0,30),this.gameManager.setConfig({playerName:t}),this.closest("dialog").close()}onOptions(){su()}onKeydown(e){if(e.key==="Enter"){e.preventDefault();const t=this.querySelector("#playerNameInput"),n=t.value.trim();this.setName(n),t.value=this.playerName}}setName(e){this.gameManager.setConfig({playerName:e}),setTimeout(()=>{this.updatePlayerInfo(),this.requestUpdate()},600)}generateToken(e){return`${this.playerId}::${e}`}async copyText(){try{await navigator.clipboard.writeText(this.playerToken),this.keyText="Copied to clipboard!",this.requestUpdate(),setTimeout(()=>{this.keyText="Use this key to restore your player data later.  Click to copy.",this.requestUpdate()},2e3)}catch{}}};oe([yn({context:He,subscribe:!0}),pt({attribute:!1})],te.prototype,"gameManager",2);oe([pt()],te.prototype,"version",2);oe([pt()],te.prototype,"playerName",2);oe([pt()],te.prototype,"playerScore",2);oe([pt()],te.prototype,"playerRank",2);oe([pt()],te.prototype,"playerToken",2);oe([pt()],te.prototype,"shortId",2);te=oe([Ue("start-dialog-content")],te);function Jg(e){const t=e+name,n=Array.from(t).reduce((i,r)=>(i<<5)-i+r.charCodeAt(0),0);return Math.abs(n).toString(36).substring(0,4)}const tm={CHILD:2},em=e=>(...t)=>({_$litDirective$:e,values:t});class nm{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,n,i){this._$Ct=t,this._$AM=n,this._$Ci=i}_$AS(t,n){return this.update(t,n)}update(t,n){return this.render(...n)}}class Jr extends nm{constructor(t){if(super(t),this.it=et,t.type!==tm.CHILD)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(t){if(t===et||t==null)return this._t=void 0,this.it=t;if(t===ve)return t;if(typeof t!="string")throw Error(this.constructor.directiveName+"() called with a non-string value");if(t===this.it)return this._t;this.it=t;const n=[t];return n.raw=n,this._t={_$litType$:this.constructor.resultType,strings:n,values:[]}}}Jr.directiveName="unsafeHTML",Jr.resultType=1;const im=em(Jr);var rm=Object.defineProperty,sm=Object.getOwnPropertyDescriptor,Cs=(e,t,n,i)=>{for(var r=i>1?void 0:i?sm(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(r=(i?o(t,n,r):o(r))||r);return i&&r&&rm(t,n,r),r};let Pi=class extends Ut{constructor(){super(...arguments),this.messages=[]}connectedCallback(){super.connectedCallback(),this.gameManager.events.on("MESSAGES_UPDATED",({messages:e})=>{this.messages=(e??[]).slice(-5)})}createRenderRoot(){return this}render(){return this.messages.length>0?Bt`${this.messages.map(e=>{const t=~~(e.tick/2),n=e.tick%2===1?".":"";return Bt`<div>
          ${im(e.message)} <small>${t}${n}</small>
        </div>`})}`:Bt``}};Cs([yn({context:He,subscribe:!0}),pt({attribute:!1})],Pi.prototype,"gameManager",2);Cs([pt()],Pi.prototype,"messages",2);Pi=Cs([Ue("message-box")],Pi);var om=Object.defineProperty,am=Object.getOwnPropertyDescriptor,uu=(e,t,n,i)=>{for(var r=i>1?void 0:i?am(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(r=(i?o(t,n,r):o(r))||r);return i&&r&&om(t,n,r),r};let ts=class extends Ut{connectedCallback(){super.connectedCallback(),this.gameManager.events.on("GAME_START",()=>{Tg(document.getElementById("app"),this.gameManager.getContext())}),this.gameManager.events.on("STATE_UPDATED",()=>{W()})}createRenderRoot(){return this}render(){return Bt`
      <canvas></canvas>
      <svg></svg>
    `}};uu([yn({context:He,subscribe:!0}),pt({attribute:!1})],ts.prototype,"gameManager",2);ts=uu([Ue("game-canvas")],ts);console.log(`starz.io version ${fa}`);
